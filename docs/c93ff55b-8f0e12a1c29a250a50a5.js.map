{"version":3,"file":"c93ff55b-8f0e12a1c29a250a50a5.js","mappings":"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,GAAI,QACJC,GAAI,QACJC,GAAI,KACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,QACJC,GAAI,SAGRC,aAAc,CACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,KACV,IAAU,KACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,IACV,IAAU,KAEdC,oBAAqB,IAAIrQ,OAAO,6GAAsnB,KAOtpBsQ,+BAAgC,SAAU7P,EAAOzB,EAAKuR,EAAWC,EAAOC,GACpE,GAAKhQ,EAAMC,IAAIgQ,sBAAf,CACA,IAAIC,EAAQlQ,EAAMhB,IAAImR,cAAcC,IAChCF,EAAMG,WACDH,EAAMG,UAAUC,UACjBJ,EAAMG,UAAUC,QAAU/R,EAC1B2R,EAAMG,UAAUP,UAAYA,GAE3BI,EAAMK,YAAuC,4BAAzBL,EAAMG,UAAUG,MACjCR,IACAE,EAAMK,YAAa,EACdP,EAAMvN,MAAM,YACbzC,EAAMhB,IAAIyR,iBAAkB,KAOpCV,GAASA,EAAMW,YAAYC,QAAOC,GAAc,oBAATA,EAAE,KAA0BnQ,OAAS,GAErEsP,GAASA,EAAMc,QAAQrL,OAD9BxF,EAAMhB,IAAIyR,iBAAkB,EAGrBlS,IACHA,EAAIkE,MAAM,UACVzC,EAAMhB,IAAIyR,iBAAkB,EAE5BzQ,EAAMhB,IAAIyR,iBAAkB,EA1BI,CA8BhD,EAEAK,yBAA0B,SAAS9Q,EAAOkQ,GACtC,GAAKlQ,EAAMC,IAAIgQ,sBAAf,CACA,IAAIc,EACAC,EAAuC,4BAAzBd,EAAMG,UAAUG,KAClC,GAA6B,gBAAzBN,EAAMG,UAAUG,KAChBO,GAAWb,EAAMG,UAAUC,aACxB,GAA6B,yBAAzBJ,EAAMG,UAAUG,KACvBO,GAAWb,EAAMG,UAAUC,SAAWJ,EAAMG,UAAUC,QAAQxO,QAAQ,OAAS,OAC5E,GAAI,CAAC,aAAc,2BAA2BA,QAAQoO,EAAMG,UAAUG,OAAS,EAAG,CACrF,IAAIS,EAAcf,EAAMG,UAAUC,QAC9BY,GAAiB,EACjBhB,EAAMG,UAAUC,UAChBY,EAAiBhB,EAAMG,UAAUC,QAAQ/N,MAAM,EAAE,GAAGE,MAAMrE,EAAIwK,wBAK1DmI,EAHE/Q,EAAMhB,IAAIyR,gBAEZP,EAAMG,UAAUP,WACNkB,GACFC,IAEDC,GACGF,EACH,CAAC,SAAU,gBAAgBlP,QAAQ9B,EAAMC,IAAIkR,0BAA4B,IAMhFjB,EAAMG,UAAUP,cAERmB,IAEDC,GACGF,EACmC,WAAtChR,EAAMC,IAAIkR,yBAM7B,CACA,GAAIJ,EACA,IAAIK,GAAiB,OAEjBA,GAAiB,EAKzB,OAHIlB,EAAMG,UAAUgB,MAChBD,GAAkBA,GAEfA,CAhDqC,CAiDhD,EAEAE,YAAa,CACT,oCACA,6BACA,8BACA,sBACA,qCACA,uBACA,yBAGJpG,oBACQxN,EAAS,CACT,UACA,UACA,UACA,cACA,YACA,cACA,sBAEG,CACH+E,MAAO,IAAIlD,OAAO,IAAM7B,EAAOgD,KAAK,KAAO,IAAK,KAChDyK,WAAY,IAAI5L,OAAO,KAAO7B,EAAOgD,KAAK,KAAO,KACjDJ,MAAO,IAAIf,OAAO,MAAQ7B,EAAOgD,KAAK,KAAO,OAIrD6K,YAAa,SAAShN,GAClB,IAAKA,EACD,OAAOA,EAIX,IAFA,IAAIiE,EAAIjE,EAAIkE,MAAMrE,EAAI8M,mBAAmBzI,OACrCpC,EAAM9B,EAAI+B,MAAMlC,EAAI8M,mBAAmB5K,OAClCC,EAAEF,EAAII,OAAO,EAAGF,GAAG,EAAGA,IAC3BF,EAAIE,GAAKF,EAAIE,GAAGoD,OACZtD,EAAIE,IAAMF,EAAIE,GAAGgC,OAAO,GAAGlD,gBAAkBgB,EAAIE,GAAGgC,OAAO,IAE3DlC,EAAIE,GAAKF,EAAIE,GAAKiC,EAAEjC,GAAKF,EAAIE,EAAE,GAC/BF,EAAMA,EAAIkC,MAAM,EAAGhC,EAAE,GAAGsE,OAAOxE,EAAIkC,MAAMhC,EAAE,KAG3CF,EAAMA,EAAIkC,MAAM,EAAGhC,EAAE,GAAGsE,OAAO,CAACrC,EAAEjC,KAAKsE,OAAOxE,EAAIkC,MAAMhC,EAAE,IAGlE,OAAOF,CACX,EAEAkR,gBAAiB,SAASvR,EAAOgD,EAAMwO,GAEnC,IAAIC,EAAM,GACNC,EAAY,KACZrQ,EAAU2B,EAAK2O,aAAe3O,EAAK2O,aAAarR,MAAM,KAAK,GAAK,KAEhEsR,EAAY,0BAoBhB,OAnBIJ,IACAI,EAAY,qBAEZvQ,GAAW2B,EAAK0O,YACZ,iBAAoB1O,EAAK0O,UACzBA,EAAY1O,EAAK0O,UAEb1O,EAAK0O,UAAU,IAAM1O,EAAK0O,UAAU,GAAGlN,UACvCkN,EAAY1O,EAAK0O,UAAU,GAAGlN,UAItCkN,IACI3S,KAAKuC,MAAQtB,EAAM0B,OAAO3C,KAAKuC,MAAMK,KAAKiQ,IAAc5R,EAAM0B,OAAO3C,KAAKuC,MAAMK,KAAKiQ,GAAWvQ,IAAYrB,EAAM0B,OAAO3C,KAAKuC,MAAMK,KAAKiQ,GAAWvQ,GAASqQ,GAC7JD,EAAMzR,EAAM0B,OAAO3C,KAAKuC,MAAMK,KAAKiQ,GAAWvQ,GAASqQ,GAChD1R,EAAM0B,OAAO1B,EAAMC,IAAI,kBAAkB,IAAI0B,KAAKiQ,IAAc5R,EAAM0B,OAAO1B,EAAMC,IAAI,kBAAkB,IAAI0B,KAAKiQ,GAAWvQ,IAAYrB,EAAM0B,OAAO1B,EAAMC,IAAI,kBAAkB,IAAI0B,KAAKiQ,GAAWvQ,GAASqQ,KACtND,EAAMzR,EAAM0B,OAAO1B,EAAMC,IAAI,kBAAkB,IAAI0B,KAAKiQ,GAAWvQ,GAASqQ,KAG7ED,CACX,EAEAI,kBAAmB,SAAS7R,EAAOsB,EAAMwQ,EAAOC,GAE5C,IADA,IAAIC,EAAQF,EAAMG,eAAeF,EAAS,eACjCG,EAAM,EAAGC,EAAML,EAAMM,cAAcJ,GAAQE,EAAMC,EAAKD,GAAO,EAAG,CACrE,IAAIG,EAAaL,EAAME,GACnBI,EAAaR,EAAMQ,WAAWD,GAC9BZ,EAAMa,EAAW,SACjBjR,EAAUiR,EAAW,YACrBC,EAASD,EAAW,WAKpBV,EAAY,oBAKhB,GAJI5R,EAAMwS,WACNZ,EAAY,2BAGZH,GAAOpQ,GAAWkR,EAAQ,CAC1BA,EAASA,EAAO5O,OAAOrD,MAAM,OACxBN,EAAM0B,OAAOJ,GAAMK,KAAKiQ,KACzB5R,EAAM0B,OAAOJ,GAAMK,KAAKiQ,GAAa,CAAC,GAErC5R,EAAM0B,OAAOJ,GAAMK,KAAKiQ,GAAWvQ,KACpCrB,EAAM0B,OAAOJ,GAAMK,KAAKiQ,GAAWvQ,GAAW,CAAC,GAEnD,IAAK,IAAId,EAAE,EAAEC,EAAK+R,EAAO9R,OAAOF,EAAEC,EAAKD,IACnCP,EAAM0B,OAAOJ,GAAMK,KAAKiQ,GAAWvQ,GAASkR,EAAOhS,IAAMkR,CAEjE,CACJ,CACJ,EAEAgB,yBAA0B,SAAUzS,EAAOgD,EAAMf,EAAMyQ,GACnD,GAAI1P,EAAK,qBACL,OAAO,EAEX,IAAKhD,EAAM2S,IAAIC,sBAAwBxU,EAAIyB,cAAc6S,KAAe1P,EAAK2O,aACzE,OAAO,EAEX,IAAIkB,EAAmB7S,EAAM8S,oBAAoB9P,EAAK2O,cAEtD,IAAK3R,EAAMC,IAAI8S,mBAAmBF,EAAiB,IAAK,CACpD,IAAIG,EAAMhT,EAAMiT,wBAAwBJ,GAGxC,IAAK,IAAIlB,KAAgBqB,EAAK,CAC1B,IAAIE,EAAWlT,EAAMmT,gBAAgBxB,EAAcqB,EAAIrB,IACnDuB,IACKF,EAAIE,KACLE,OAAOC,OAAOL,EAAKhT,EAAMiT,wBAAwB,CAACC,KAClDlT,EAAMmT,gBAAgBD,EAAUF,EAAIE,IAAW,IAG3D,CACJ,CACIlT,EAAMC,IAAIqT,SAASC,SACdvT,EAAMsT,WACPtT,EAAMsT,SAAW,IAAIlV,EAAIoV,SAASxT,KAI1C,IAAK,IAAIO,EAAE,EAAEC,EAAKqS,EAAiBpS,OAAOF,EAAEC,EAAKD,IAAK,CAC9CoR,EAAekB,EAAiBtS,GAMpC,GALI0B,GACIjC,EAAMyT,MAAM9B,KAAkB1P,EAAK,sBAAwBjC,EAAMyT,MAAM9B,GAAc+B,MAAMtR,UAC3FY,EAAK,qBAAuB2O,GAGjC3R,EAAMyT,MAAM9B,IAAiB3R,EAAMyT,MAAM9B,GAAc+B,MAAM1Q,EAAKkB,MAEjE,OADAlB,EAAK,qBAAuB2O,GACrB,CAEf,CACA,OAAO,CACX,GA0BJvT,EAAIuV,QAAU,SAAU5B,GACpBhT,KAAKgT,QAAUA,EACfhT,KAAK6U,YAAc,CACfnP,KAAK,cACLoP,MAAM,CACF,oBAAoB,OACpB,UAAY,MAEhBC,SAAS,CACL,CACIrP,KAAK,mBACLoP,MAAM,CACFpP,KAAK,QAETqP,SAAS,KAIzB,EAKA1V,EAAIuV,QAAQI,UAAUC,MAAQ,SAAUC,GACpC,OAAOA,CACX,EAMA7V,EAAIuV,QAAQI,UAAUG,WAAa,SAAUC,EAAQC,GACjD,IAAIC,EAAU,KACVD,IACAC,EAAU,SAId,IAFA,IAAI7K,EAAM,GACNsK,EAAWK,EAAOL,SACbvT,EAAE,EAAEC,EAAKsT,EAASrT,OAAOF,EAAEC,EAAKD,IACrC,GAAyB,SAArBuT,EAASvT,GAAGkE,KAEZ,IADA,IAAI6P,EAAYR,EAASvT,GAAGuT,SACnBjS,EAAE,EAAE4B,EAAK6Q,EAAU7T,OAAOoB,EAAE4B,EAAK5B,IAClCyS,EAAUzS,GAAG4C,OAAS4P,IACtB7K,EAAM8K,EAAUzS,GAAGiS,SAAS,IAK5C,OAAOtK,CACX,EAEApL,EAAIuV,QAAQI,UAAUD,SAAW,SAAUK,GAEvC,SAAIA,IAAUA,EAAOL,SAASrT,SACnB0T,EAAOL,SAASvR,OAI/B,EAEAnE,EAAIuV,QAAQI,UAAUQ,SAAW,SAAUJ,GAEvC,OAAOA,EAASA,EAAO1P,KAAO,IAClC,EAEArG,EAAIuV,QAAQI,UAAUzB,WAAa,SAAU6B,GAEzC,IAAI3K,EAAM,CAAC,EACX,IAAK,IAAIgL,KAAYL,EAAON,MACxBrK,EAAI,IAAIgL,GAAYL,EAAON,MAAMW,GAErC,OAAOhL,CACX,EAGApL,EAAIuV,QAAQI,UAAUU,QAAU,SAAUN,GAGtC,IAAI3K,EAAM,GAGV,IAAK2K,IAAWA,EAAOL,SACnB,OAAOtK,EAEX,IAAK,IAAIjJ,EAAE,EAAGC,EAAK2T,EAAOL,SAASrT,OAAQF,EAAIC,EAAMD,GAAK,EAClD,iBAAoB4T,EAAOL,SAASvT,KACpCiJ,GAAO2K,EAAOL,SAASvT,IAG/B,OAAOiJ,CACX,EAGApL,EAAIuV,QAAQI,UAAUW,UAAY,CAAC,EAEnCtW,EAAIuV,QAAQI,UAAU3B,cAAgB,SAAU+B,GAE5C,OAAIA,GAAU,iBAAmBA,EAAO1T,OAC7B0T,EAAO1T,OAEP,CAEf,EAIArC,EAAIuV,QAAQI,UAAUY,kBAAoB,SAAUR,EAAO1P,EAAKiQ,GAE5D,IAAIlL,EAAM,GAaV,OAZIkL,IACAjQ,EAAOiQ,EAAU,IAAIjQ,GAErB0P,GACIA,EAAON,QAEHrK,EADA2K,EAAON,MAAMpP,GACP0P,EAAON,MAAMpP,GAEb,IAIX+E,CACX,EAEApL,EAAIuV,QAAQI,UAAUa,aAAe,SAAUT,EAAO1P,GAElD,IAAI+E,EAAM,GACV,GAAI/E,EACA,IAAK,IAAIlE,EAAE,EAAGC,EAAK2T,EAAOL,SAASrT,OAAQF,EAAIC,EAAMD,GAAK,EAClD4T,EAAOL,SAASvT,GAAGkE,OAASA,IAGxB+E,EADA2K,EAAOL,SAASvT,GAAGuT,SAASrT,OACtB0T,EAAOL,SAASvT,GAEhB,SAIX4T,IACP3K,EAAM2K,GAOV,OAHI3K,GAAOA,EAAIsK,UAAmC,GAAvBtK,EAAIsK,SAASrT,QAAe,iBAAoB+I,EAAIsK,SAAS,KACpFtK,EAAMA,EAAIsK,SAAS,IAEhBtK,CACX,EAEApL,EAAIuV,QAAQI,UAAUc,4CAA8C,SAAUV,EAAOI,EAASO,EAASN,EAASvQ,GAGhF,MAAxBuQ,EAASjS,MAAM,EAAE,KACjBiS,EAAWA,EAASjS,MAAM,IAG9B,IAAK,IAAIhC,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAQF,EAAEC,EAAMD,GAAK,EAC/C4T,EAAOL,SAASvT,GAAGkE,OAAS8P,GAAYJ,EAAOL,SAASvT,GAAGsT,MAAMpP,OAASqQ,IAC1EX,EAAOL,SAASvT,GAAGsT,MAAMW,GAAYvQ,EAGjD,EAEA7F,EAAIuV,QAAQI,UAAUgB,0BAA4B,SAAUZ,EAAOlQ,GAE/D,IAAI1D,EAAGC,EACP,IAAKD,EAAI,EAAGC,EAAO2T,EAAOL,SAASrT,OAAQF,EAAIC,EAAMD,GAAK,EACjD4T,EAAOL,SAASvT,IAAM,iBAAoB4T,EAAOL,SAASvT,IAG3D4T,EAAOL,SAASvT,GAAGsT,MAAMpP,MAAQR,IACjCkQ,EAAOL,SAAWK,EAAOL,SAASvR,MAAM,EAAEhC,GAAGsE,OAAOsP,EAAOL,SAASvR,MAAMhC,EAAE,IAGxF,EAEAnC,EAAIuV,QAAQI,UAAUiB,gBAAkB,SAAUb,EAAOK,QAGjD,IAAuBL,EAAON,MAAMW,IACpCL,EAAON,MAAM9J,IAAIyK,EAEzB,EAEApW,EAAIuV,QAAQI,UAAUkB,aAAe,SAAUd,EAAOe,EAAKjR,GAGvD,OADAkQ,EAAON,MAAMqB,GAAQjR,GACd,CACX,EAEA7F,EAAIuV,QAAQI,UAAUoB,SAAW,SAAUhB,EAAOiB,GAE9C,IAAKA,EACGA,EAAQ,CAAC,EAEjB,GAAI,iBAAoBA,QAAS,IAAuBA,EAAM3U,OAE1D,IAAK,IAAIuD,KAAOmQ,EACR,iBAAoBA,EAAOnQ,GAC3BoR,EAAMpR,GAAOmQ,EAAOnQ,GACb,iBAAoBmQ,EAAOnQ,UAC9B,IAAuBmQ,EAAOnQ,GAAKvD,OACnC2U,EAAMpR,GAAOjF,KAAKoW,SAAShB,EAAOnQ,GAAK,CAAC,GAExCoR,EAAMpR,GAAOjF,KAAKoW,SAAShB,EAAOnQ,GAAK,UAMnD,IAAK,IAAIzD,EAAE,EAAEC,EAAK2T,EAAO1T,OAAOF,EAAEC,EAAMD,GAAK,EACrC,iBAAoB4T,EAAO5T,GAC3B6U,EAAM7U,GAAK4T,EAAO5T,GAGlB6U,EAAM7U,GAAKxB,KAAKoW,SAAShB,EAAO5T,GAAG,CAAC,GAIhD,OAAO6U,CACX,EAEAhX,EAAIuV,QAAQI,UAAU9B,eAAiB,SAAUkC,EAAO1P,EAAK4Q,EAAY7L,GAGrE,IAAKA,EACGA,EAAM,GAEd,IAAK2K,IAAWA,EAAOL,SACnB,OAAOtK,EAEP/E,IAAS0P,EAAO1P,OACZ4Q,EACIA,IAAgBlB,EAAON,MAAMpP,MAC7B+E,EAAI9F,KAAKyQ,GAGb3K,EAAI9F,KAAKyQ,IAGjB,IAAK,IAAI5T,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC3C,iBAAoB4T,EAAOL,SAASvT,IAGxCxB,KAAKkT,eAAekC,EAAOL,SAASvT,GAAGkE,EAAK4Q,EAAY7L,GAE5D,OAAOA,CACX,EAEApL,EAAIuV,QAAQI,UAAUuB,WAAa,SAAUnB,EAAO1P,GAEhD,YAAsB,IAAX0P,GAGP1P,GAAQ0P,EAAO1P,IAIvB,EAEArG,EAAIuV,QAAQI,UAAUwB,QAAU,SAAUpB,GAStC,MAPI,iBAAoBA,IAEhBA,EADuB,MAAvBA,EAAO5R,MAAM,EAAG,GACPxD,KAAKyW,iBAAiBC,aAAatB,GAEnCuB,KAAKC,MAAMxB,IAGrBA,CACX,EAEA/V,EAAIuV,QAAQI,UAAU6B,qBAAuB,SAAUC,EAAOC,EAAK5D,EAAI6D,GAGnE,IAAK,IAAIxV,EAAE,EAAEC,EAAKqV,EAAO/B,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC/C,GAAIuV,IAASD,EAAO/B,SAASvT,GAAI,CAC7BsV,EAAO/B,SAAW+B,EAAO/B,SAASvR,MAAM,EAAEhC,GAAGsE,OAAO,CAACkR,IAAWlR,OAAOgR,EAAO/B,SAASvR,MAAMhC,EAAE,IAC/F,KACJ,CAEJ,OAAOsV,CACX,EAGAzX,EAAIuV,QAAQI,UAAUiC,wBAA0B,SAAS7B,GACrD,GAAoB,UAAhBA,EAAO1P,KAAkB,CAGzB,IAFA,IAAIwR,GAAQ,EACRC,EAAY,CAAC,YAAY,mBACpB3V,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAClD,IAAI4V,EAAcD,EAAUpU,QAAQqS,EAAOL,SAASvT,GAAGsT,MAAMuC,UAE7D,KADyC,SAA5BjC,EAAOL,SAASvT,GAAGkE,MAClB0R,GAAe,IAAMhC,EAAOL,SAASvT,GAAGsT,MAAM9O,QAAWoP,EAAOL,SAASvT,GAAGsT,MAAMrO,OAEzF,CACHyQ,GAAQ,EACR,KACJ,CAJIC,EAAYA,EAAU3T,MAAM,EAAE4T,GAAatR,OAAOqR,EAAU3T,MAAM4T,EAAY,GAKtF,CACIF,IAAUC,EAAUzV,SACpB0T,EAAON,MAAM,sCAAuC,EAE5D,CACA,IAAStT,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC3C,iBAAoB4T,EAAOL,SAASvT,IACpCxB,KAAKiX,wBAAwB7B,EAAOL,SAASvT,GAGzD,EA0CAnC,EAAIuV,QAAQI,UAAUsC,oBAAsB,SAASC,GACjD,GAAIA,EAAQ7V,OAAS,EAAG,CACpB,IAAI8V,EAAYD,EAAQ/T,QAExB,MAAe,eADFgU,EAAUxM,OAIZhL,KAAKsX,oBAAoBE,EAExC,CACA,OAAO,CACX,EAEAnY,EAAIuV,QAAQI,UAAUyC,oBAAsB,SAASrC,EAAOmC,GAIxD,GAHKA,IACDA,EAAU,IAEM,UAAhBnC,EAAO1P,OAEF1F,KAAKsX,oBAAoBC,GAAU,CAEpC,IADA,IAAIG,GAAU,EACLlW,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,IAC5C,GAAgC,SAA5B4T,EAAOL,SAASvT,GAAGkE,KAAiB,CACpCgS,GAAU,EACV,KACJ,CAEAA,IACAtC,EAAOL,SAAW,CAAC,CAACrP,KAAK,OAAOoP,MAAM,CAAC,EAAEC,SAAS,KAAKjP,OAAOsP,EAAOL,UAE7E,CAEJwC,EAAQ5S,KAAKyQ,EAAO1P,MACpB,IAASlE,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC3C,iBAAoB4T,EAAOL,SAASvT,IACpCxB,KAAKyX,oBAAoBrC,EAAOL,SAASvT,GAAG+V,GAGpDA,EAAQvM,KACZ,EAGA3L,EAAIuV,QAAQI,UAAU2C,oBAAsB,SAASvC,GAMjD,GAAoB,UAAhBA,EAAO1P,KAAkB,CAIzB,IAFA,IAAI6N,EAAa,CAAC,EACdqE,GAAa,EACRpW,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAClD,GAA+B,QAA3B4T,EAAOL,SAASvT,GAAGkE,KAAgB,CACnC,IAAK,IAAIT,KAAOmQ,EAAOL,SAASvT,GAAGsT,MAC/BvB,EAAWtO,GAAOmQ,EAAOL,SAASvT,GAAGsT,MAAM7P,GAE/CsO,EAAWsE,UAAYzC,EAAOL,SAASvT,GAAGsT,MAAM+C,UAChDtE,EAAWuE,IAAM1C,EAAOL,SAASvT,GAAGsT,MAAMgD,IAC1CF,EAAYpW,EACZ,IAAK,IAAIuW,EAAE,EAAEC,EAAK5C,EAAOL,SAASvT,GAAGuT,SAASrT,OAAOqW,EAAEC,EAAKD,GAAG,EAC3D,GAAkD,WAA9C3C,EAAOL,SAASvT,GAAGuT,SAASgD,GAAGjD,MAAMpP,KAGzC,IAAK,IAAIT,KAAOmQ,EAAOL,SAASvT,GAAGuT,SAASgD,GAAGjD,MAC3CvB,EAAWtO,GAAOmQ,EAAOL,SAASvT,GAAGuT,SAASgD,GAAGjD,MAAM7P,EAGnE,CACA,GAA+B,eAA3BmQ,EAAOL,SAASvT,GAAGkE,KAAuB,CAC1CkS,GAAa,EACb,KACJ,CACJ,CACA,GAAIA,GAAa,EAAG,CAChB,IAAI/C,EAAc7U,KAAKoW,SAASpW,KAAK6U,aACrC,IAASrT,EAAE,EAAEC,EAAOpC,EAAIwO,iBAAiBnM,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CACzD,IAAIiU,EAAWpW,EAAIwO,iBAAiBrM,QAChC,IAAuB+R,EAAWkC,KAClCZ,EAAYE,SAAS,GAAGD,MAAMW,GAAYlC,EAAWkC,IAErDlC,EAAWsE,YACXhD,EAAYC,MAAM+C,UAAYtE,EAAWsE,WAEzCtE,EAAWuE,MACXjD,EAAYC,MAAMgD,IAAMvE,EAAWuE,IAE3C,CACA1C,EAAOL,SAAWK,EAAOL,SAASvR,MAAM,EAAEoU,EAAU,GAAG9R,OAAO,CAAC+O,IAAc/O,OAAOsP,EAAOL,SAASvR,MAAMoU,EAAU,GACxH,CACJ,CACA,IAASpW,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC3C,iBAAoB4T,EAAOL,SAASvT,IAIxCxB,KAAK2X,oBAAoBvC,EAAOL,SAASvT,GAEjD,EACAnC,EAAIuV,QAAQI,UAAUiD,eAAiB,SAAS7C,GAE5C,IAAK,IAAI5T,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EACf,UAA5B4T,EAAOL,SAASvT,GAAGkE,MACf1F,KAAKkY,kBAAkB9C,EAAOL,SAASvT,MACvC4T,EAAOL,SAASvT,GAAGsT,MAAM,kBAAoB,OAI7D,EACAzV,EAAIuV,QAAQI,UAAUkD,kBAAoB,SAAS9C,GAE/C,IAAKA,IAAWA,EAAOL,SACnB,OAAO,EAEX,GAAoB,SAAhBK,EAAO1P,KACP,OAAO,EAEP,IAAK,IAAIlE,EAAE,EAAEC,EAAK2T,EAAOL,SAASrT,OAAOF,EAAEC,EAAKD,GAAG,EAC/C,GAAIxB,KAAKkY,kBAAkB9C,EAAOL,SAASvT,IACvC,OAAO,EAInB,OAAO,CACX,EAKAnC,EAAI8Y,8BAAgC,SAAUC,GAC1C,OAAKA,EAMLA,GADAA,GADAA,GADAA,EAAMA,EAAItU,QAAQ,eAAgB,KACxBA,QAAQ,gBAAiB,KACzBA,QAAQ,QAAS,KACjBA,QAAQ,QAAS,IALhBsU,CAOf,EAMA/Y,EAAIgZ,SAAW,SAAS7Y,GAEpB,IACI8Y,EAAO,CAACvD,SAAS,IACjBwD,EAAS,CAACD,EAAKvD,UA4CnB,SAASyD,EAAoBhZ,GACzB,OAAOA,EACF+B,MAAM,SAASI,KAAK,KACpBJ,MAAM,UAAUI,KAAK,KACrBJ,MAAM,QAAQI,KAAK,KAAKJ,MAAM,QAAQI,KAAK,KAC3CmC,QAAQ,qBAAqB,SAASJ,EAAO+U,GAC1C,IAAIC,EAAMC,SAASF,EAAQ,IAC3B,OAAOG,OAAOC,aAAaH,EAC/B,IACC5U,QAAQ,yBAAyB,SAASJ,EAAO+U,GAC9C,IAAIC,EAAMC,SAASF,EAAQ,IAC3B,OAAOG,OAAOC,aAAaH,EAC/B,GACR,CAYA,SAASI,EAAcC,EAAM5C,GACzB,IAAI6C,EAAMxY,OAAO,YAAa2V,EAAO,oCACjC1S,EAAIsV,EAAKrV,MAAMsV,GACnB,OAAOvV,EAAIA,EAAE,GAAGD,MAAM,GAAI,GAAK,IACnC,CAEA,SAASyV,EAAYF,GACjB,IAAIC,EAAMxY,OAAO,iBACbiD,EAAIsV,EAAKrV,MAAMsV,GACnB,OAAOvV,EAAIA,EAAE,GAAK,IACtB,CAGA,SAASyV,EAA0BH,GAC/B,IAAII,EAAM,CAAC,EACXA,EAAIzT,KAAOuT,EAAYF,GACvBI,EAAIrE,MAAQ,CAAC,EACb,IAAIvB,EA3BR,SAAwBwF,GACpB,IAAItV,EAAIsV,EAAKrV,MAAM,4CACnB,GAAID,EACA,IAAK,IAAIjC,EAAE,EAAEC,EAAKgC,EAAE/B,OAAOF,EAAEC,EAAKD,IAC9BiC,EAAEjC,GAAKiC,EAAEjC,GAAGsC,QAAQ,MAAO,IAGnC,OAAOL,CACX,CAmBqB2V,CAAeL,GAChC,GAAIxF,EACA,IAAK,IAAI/R,EAAE,EAAEC,EAAK8R,EAAW7R,OAAOF,EAAEC,EAAKD,IAAK,CAC5C,IAAI2U,EAAO,CACPzQ,KAAM6N,EAAW/R,GACjByP,MAAO6H,EAAcC,EAAMxF,EAAW/R,KAE1C2X,EAAIrE,MAAMqB,EAAKzQ,MAAQ8S,EAAoBrC,EAAKlF,MACpD,CAGJ,OADAkI,EAAIpE,SAAW,GACRoE,CACX,CAEA,SAASE,EAAiCN,GAEtC,OAAOP,EADCO,EAAKrV,MAAM,mBACU,GACjC,CAEA,SAAS4V,EAAkBH,GACvBZ,EAAO/U,OAAO,GAAG,GAAGmB,KAAKwU,EAC7B,CAMA,SAASI,EAAeR,GACpB,IAAII,EACAJ,EAAKvV,MAAM,GAAGT,QAAQ,MAAQ,IAG9BoW,EAAMD,EADIH,EAAKvV,MAAM,EAAGuV,EAAKhW,QAAQ,KAAK,KAEtCgS,SAAW,CAACsE,EAAiCN,IACjDO,EAAkBH,IACQ,OAAnBJ,EAAKvV,OAAO,IAEnB2V,EAAMD,EAA0BH,GAEN,SAAtBE,EAAYF,IACZI,EAAIpE,SAASpQ,KAAK,IAEtB2U,EAAkBH,IACU,OAArBJ,EAAKvV,MAAM,EAAG,GAErB+U,EAAOvN,OAIPsO,EADAH,EAAMD,EAA0BH,IAzBxC,SAAqCI,GACjCZ,EAAO5T,KAAKwU,EAAIpE,SACpB,CAyBQyE,CAA4BL,GAEpC,CAIA,IAFA,IAAI7X,EA1IJ,SAAwB9B,GAIpB,IAFA,IAAI8B,GADJ9B,EAAMA,EAAI+B,MAAM,kBAAkBI,KAAK,KAAKmC,QAAQ,WAAY,MAAMA,QAAQ,eAAgB,KAChFvC,MAAM,MAChBkY,EAAW,KACNjY,EAAE,EAAEC,EAAKH,EAAII,OAAOF,EAAEC,EAAKD,IAC5BA,EAAI,IACJF,EAAIE,GAAK,IAAMF,EAAIE,IAEnBA,EAAKF,EAAII,OAAO,IAChBJ,EAAIE,GAAKF,EAAIE,GAAK,KAElB,iBAAmBiY,IACQ,YAAvBnY,EAAIE,GAAGgC,MAAM,EAAG,IAA0C,YAAtBlC,EAAIE,GAAGgC,MAAM,EAAG,KACpDiW,EAAWjY,IAQvB,IAASA,GAJTF,EAAMA,EAAIkC,MAAMiW,IAID/X,OAAO,EAAEF,GAAG,EAAEA,IACzB,IAAsC,IAAlCF,EAAIE,GAAGgC,MAAM,GAAGT,QAAQ,KAAa,CACrC,IAAI2W,EAAOpY,EAAIE,GAAGgC,MAAM,EAAG,GACF,OAArBlC,EAAIE,GAAGgC,OAAO,KACD,UAATkW,EAC6B,WAAzBpY,EAAIE,EAAE,GAAGgC,MAAM,EAAG,KAClBlC,EAAIE,GAAKF,EAAIE,GAAKF,EAAIE,EAAE,GACxBF,EAAMA,EAAIkC,MAAM,EAAGhC,EAAE,GAAGsE,OAAOxE,EAAIkC,MAAMhC,EAAE,KAExC,CAAC,QAAS,SAASuB,QAAQ2W,IAAS,GAClB,OAArBpY,EAAIE,GAAGgC,OAAO,IAAwC,MAAzBlC,EAAIE,EAAE,GAAGgC,MAAM,EAAG,KAC/ClC,EAAIE,GAAKF,EAAIE,GAAKF,EAAIE,EAAE,GACxBF,EAAMA,EAAIkC,MAAM,EAAGhC,EAAE,GAAGsE,OAAOxE,EAAIkC,MAAMhC,EAAE,KAI3D,CAEJ,OAAOF,CACX,CAkGUqY,CAAena,GAEhBgC,EAAE,EAAEC,EAAKH,EAAII,OAAOF,EAAEC,EAAKD,IAAK,CAErC+X,EADWjY,EAAIE,GAEnB,CACA,OAAO8W,EAAKvD,SAAS,EACzB,EAMA1V,EAAIua,OAAS,SAAU5G,GACnBhT,KAAKgT,QAAUA,EACX,oBAAsB6G,WACtBA,UAAY,WAAY,EACxBA,UAAU7E,UAAU8E,gBAAkB,SAASta,EAAKua,GAE5C,IAKIC,EANR,MAAI,oBAAsBC,gBAClBD,EAAU,IAAIC,cAAc,sBACxBC,OAAQ,EAChBF,EAAQG,QAAQ3a,GACTwa,GACA,oBAAsBI,gBAExBL,IACDA,EAAc,aAFdC,EAAU,IAAII,gBAIVC,KAAK,MAAO,QAAUN,EAAc,kBAAoBO,mBAAmB9a,IAAM,GACtFwa,EAAQO,kBACPP,EAAQO,iBAAiBR,GAE7BC,EAAQQ,KAAK,MACNR,EAAQS,aACR,oBAAsBC,UAChB,IAAIA,SAASC,QACZ/D,MAAMpX,QAFjB,CAIX,EACAQ,KAAK4a,cAAgB,SAAU7D,GAO3B,SALIA,EAAKxD,aAAcwD,EAAKxD,WAAW7R,OAM3C,GAOA1B,KAAK4a,cAAgB,SAAU7D,GAO3B,SALIA,EAAKxD,aAAcwD,EAAKxD,WAAW7R,OAM3C,EAEJ1B,KAAK6a,WAAa,SAAUC,EAAKC,GAO7B,YALI,IAAsBD,EAAID,WACpB7a,KAAKgb,YAAYF,EAAKC,GAAY,GAElCD,EAAID,WAAWE,GAAY,EAGzC,EAKA/a,KAAKgb,YAAc,SAASF,EAAK/D,EAAMkE,GACnC,GAES,IAFDlE,EAAKmE,SAET,CACI,IAAIC,EAAUL,EAAIM,cAAcrE,EAAKsE,UACrC,GAAItE,EAAKxD,YAAcwD,EAAKxD,WAAW7R,OAAS,EAC5C,IAAK,IAAIF,EAAI,EAAG8Z,EAAKvE,EAAKxD,WAAW7R,OAAQF,EAAI8Z,GAC7CH,EAAQjF,aAAaa,EAAKxD,WAAW/R,GAAG6Z,SAAUtE,EAAKwE,aAAaxE,EAAKxD,WAAW/R,KAAK6Z,WAC7F,GAAIJ,GAAelE,EAAKyE,YAAczE,EAAKyE,WAAW9Z,OAAS,EAC3D,IAASF,EAAI,EAAG8Z,EAAKvE,EAAKyE,WAAW9Z,OAAQF,EAAI8Z,GAC7CH,EAAQM,YAAYzb,KAAKgb,YAAYF,EAAK/D,EAAKyE,WAAWha,KAAMyZ,IAC5E,OAAOE,CACF,CAQjB,EACAnb,KAAK0b,OAAS,IAAI7B,UAIlB,IACI8B,EAAW3b,KAAK0b,OAAO5B,gBADjB,0JACsC,YAC5C8B,EAAYD,EAASE,qBAAqB,eAC9C7b,KAAK6U,YAAc+G,EAAU1Y,KAAK,GAClC,IAAI4Y,EAAiBH,EAASE,qBAAqB,oBACnD7b,KAAK+b,gBAAkBD,EAAe5Y,KAAK,GAC3ClD,KAAKgc,GAAK,iCACd,EAMA3c,EAAIua,OAAO5E,UAAUC,MAAQ,SAAUmD,GAMnC,OADAA,GADAA,GADAA,GADAA,GADAA,EAAMA,EAAItU,QAAQ,eAAgB,KACxBA,QAAQ,YAAa,KACrBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,GAE9B,EAMAzE,EAAIua,OAAO5E,UAAUG,WAAa,SAAUpC,EAAOsC,GAC/C,IAAI4G,EAAO,GACP3G,EAAU,KACVD,IACAC,EAAU,SAEd,IAAIyB,EAAOhE,EAAM8I,qBAAqBvG,GAgBtC,OAfIyB,GAAQA,EAAKrV,SACbqV,EAAOA,EAAK7T,KAAK,IAEjB6T,IAEAkF,EAAOlF,EAAKmF,aAEXD,IAEDA,EAAOlF,EAAKoF,WAEXF,IAEDA,EAAOlF,EAAKqF,WAETH,CACX,EAEA5c,EAAIua,OAAO5E,UAAUD,SAAW,SAAUhC,GACtC,IAAIgC,EAAU5B,EAAKC,EAAK3I,EACxB,GAAIsI,EAAO,CAGP,IAFAtI,EAAM,GAED0I,EAAM,EAAGC,GADd2B,EAAWhC,EAAMyI,YACY9Z,OAAQyR,EAAMC,EAAKD,GAAO,EACrB,SAA1B4B,EAAS5B,GAAKkI,UACd5Q,EAAI9F,KAAKoQ,EAAS5B,IAG1B,OAAO1I,CACX,CACI,MAAO,EAEf,EAEApL,EAAIua,OAAO5E,UAAUQ,SAAW,SAAUzC,GAEtC,OADUA,EAAMsI,QAEpB,EAEAhc,EAAIua,OAAO5E,UAAUzB,WAAa,SAAUR,GACxC,IAAItI,EAAKqK,EAAOqB,EAAgBhD,EAAKC,EAErC,GADA3I,EAAM,IAAI4J,OACNtB,GAAS/S,KAAK4a,cAAc7H,GAE5B,IAAKI,EAAM,EAAGC,GADd0B,EAAQ/B,EAAMQ,YACU7R,OAAQyR,EAAMC,EAAKD,GAAO,EAE9C1I,EAAI,KADJ0L,EAAOrB,EAAM3B,IACEzN,MAAQyQ,EAAKlF,MAGpC,OAAOxG,CACX,EAGApL,EAAIua,OAAO5E,UAAUU,QAAU,SAAU3C,GASrC,YAPI,IAAsBA,EAAMmJ,YACtBnJ,EAAMmJ,iBACL,IAAsBnJ,EAAMoJ,UAC7BpJ,EAAMoJ,UAENpJ,EAAMtF,GAGpB,EAGApO,EAAIua,OAAO5E,UAAUW,UAAY,CAC7B,IAAM,wCAGVtW,EAAIua,OAAO5E,UAAU3B,cAAgB,SAAUN,GAC3C,OAAIA,EACOA,EAAMrR,OAEN,CAEf,EAEArC,EAAIua,OAAO5E,UAAUqH,iBAAmB,SAAUlG,GAE9C,OADUA,EAAKzQ,IAEnB,EAEArG,EAAIua,OAAO5E,UAAUY,kBAAoB,SAAU7C,EAAMrN,EAAKiQ,GAC1D,IAAIlL,EAAM,GAOV,OANIkL,IACAjQ,EAAOiQ,EAAU,IAAIjQ,GAErBqN,GAAS/S,KAAK4a,cAAc7H,IAAUA,EAAMwI,aAAa7V,KACzD+E,EAAMsI,EAAMwI,aAAa7V,IAEtB+E,CACX,EAKApL,EAAIua,OAAO5E,UAAUa,aAAe,SAAU9C,EAAMrN,GAChD,IAAI+E,EAAM,KACV,GAAI/E,EAAK,CACL,IAAIkG,EAAOmH,EAAM8I,qBAAqBnW,GAClCkG,EAAKlK,OAAS,IAEV+I,OADA,IAAsBmB,EAAK,GAAGsQ,YACxBtQ,EAAK,GAAGsQ,iBACP,IAAsBtQ,EAAK,GAAGuQ,UAC/BvQ,EAAK,GAAGuQ,UAERvQ,EAAK,GAAGqQ,KAG1B,CAaA,OAZY,OAARxR,GAAgBsI,GAASA,EAAMyI,aAA0C,GAA3BzI,EAAMyI,WAAW9Z,QAA2C,GAA3BqR,EAAMyI,WAAW9Z,QAA4C,SAA7BqR,EAAMuJ,WAAWjB,YAE5H5Q,OADA,IAAsBsI,EAAMmJ,YACtBnJ,EAAMmJ,iBACL,IAAsBnJ,EAAMoJ,UAC7BpJ,EAAMoJ,UAENpJ,EAAMkJ,MAGR,OAARxR,IACAA,EAAMsI,GAEHtI,CACX,EAEApL,EAAIua,OAAO5E,UAAUc,4CAA8C,SAAU/C,EAAMyC,EAASO,EAASN,EAASvQ,GAC1G,IAAIiO,EAAKC,EAAUH,EAAO8D,EAK1B,IAJ4B,MAAxBtB,EAASjS,MAAM,EAAE,KACjBiS,EAAWA,EAASjS,MAAM,IAGzB2P,EAAM,EAAGC,GADdH,EAAQF,EAAM8I,qBAAqBrG,IACT9T,OAAQyR,EAAMC,EAAKD,GAAO,GAChD4D,EAAO9D,EAAME,IACJoI,aAAa,SAAWxF,GAGjCgB,EAAKb,aAAaT,EAAUvQ,EAEpC,EAEA7F,EAAIua,OAAO5E,UAAUgB,0BAA4B,SAAUjD,EAAM7N,GAC7D,IAAIiO,EAAKC,EAAK2D,EAAM9D,EAEpB,IAAKE,EAAM,EAAGC,GADdH,EAAQF,EAAMyI,YACY9Z,OAAQyR,EAAMC,EAAKD,GAAO,GAChD4D,EAAO9D,EAAME,KACA4D,EAAKmE,UAAYnE,EAAKwF,WAG/Bvc,KAAK4a,cAAc7D,IAASA,EAAKwE,aAAa,SAAWrW,GACzD6N,EAAMyJ,YAAYvJ,EAAME,GAGpC,EAEA9T,EAAIua,OAAO5E,UAAUiB,gBAAkB,SAAUlD,EAAMoD,GACnDpD,EAAM0J,gBAAgBtG,EAC1B,EAEA9W,EAAIua,OAAO5E,UAAUkB,aAAe,SAAUnD,EAAMoD,EAAKjR,GAWrD,OAVK6N,EAAM2J,gBACP3J,EAAQA,EAAMuJ,YAMd,CAAC,WAAY,WAAWvZ,eAAegQ,EAAMmD,eAAiB,GAC9DnD,EAAMmD,aAAaC,EAAMjR,IAEtB,CACX,EAEA7F,EAAIua,OAAO5E,UAAUoB,SAAW,SAAUrD,GAEtC,OADkBA,EAAM4J,WAAU,EAEtC,EAEAtd,EAAIua,OAAO5E,UAAU9B,eAAiB,SAAUH,EAAMrN,EAAK4Q,GACvD,IAAI7L,EAAKwI,EAAO8D,EAAM5D,EAAKC,EAG3B,IAFA3I,EAAM,GAED0I,EAAM,EAAGC,GADdH,EAAQF,EAAM8I,qBAAqBnW,IACThE,OAAQyR,EAAMC,EAAKD,GAAO,EAChD4D,EAAO9D,EAAM/P,KAAKiQ,KACdmD,GAAiBtW,KAAK4a,cAAc7D,IAASA,EAAKwE,aAAa,SAAWjF,IAI9E7L,EAAI9F,KAAKoS,GAEb,OAAOtM,CACX,EAEApL,EAAIua,OAAO5E,UAAUuB,WAAa,SAAUxD,EAAMrN,GAC9C,OAAIA,GAAQqN,EAAMsI,QAItB,EAEAhc,EAAIua,OAAO5E,UAAUwB,QAAU,SAAUzD,GAOrC,OALKA,IACDA,EAAQ,2BAEZA,EAAQA,EAAMjP,QAAQ,wBAAyB,IAChC9D,KAAK0b,OAAO5B,gBAAgB/G,EAAO,mBAClCuJ,UACpB,EAEAjd,EAAIua,OAAO5E,UAAU6B,qBAAuB,SAAUC,EAAOC,EAAK5D,EAAIyJ,GAClE,IAAI7J,EAGH,OAFDA,EAAQ/S,KAAK6a,WAAW9D,EAAK2F,cAAeE,GAC5C9F,EAAO+F,aAAa9J,EAAOgE,GACnBD,CACZ,EAEAzX,EAAIua,OAAO5E,UAAUiC,wBAA0B,SAASlE,GAEpD,IADA,IAAI+J,EAAQ/J,EAAM8I,qBAAqB,SAC9Bra,EAAI,EAAGC,EAAOqb,EAAMpb,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAGnD,IAFA,IAAIuV,EAAO+F,EAAM5Z,KAAK1B,GAClBub,EAAW,GACNja,EAAI,EAAG4B,EAAOqS,EAAKyE,WAAW9Z,OAAQoB,EAAI4B,EAAM5B,GAAK,EACjB,IAArCiU,EAAKyE,WAAWtY,KAAKJ,GAAGoY,UACxB6B,EAASpY,KAAK7B,GAGtB,GAAIiU,EAAKyE,WAAW9Z,OAASqb,EAASrb,QAAW,EAAG,CAChD,IAAIsb,EAAU,GACd,IAASla,EAAI,EAAG4B,EAAO,EAAG5B,EAAI4B,EAAM5B,GAAK,EACrC,KAAIia,EAASha,QAAQD,IAAM,GAA3B,CAKA,IAFA,IAAIma,EAAQlG,EAAKyE,WAAWtY,KAAKJ,GAC7Boa,EAAc,GACTnF,EAAI,EAAGC,EAAOiF,EAAMzB,WAAW9Z,OAAQqW,EAAIC,EAAMD,GAAK,EACjB,IAAtCkF,EAAMzB,WAAWtY,KAAK6U,GAAGmD,UACzBgC,EAAYvY,KAAKoT,GAGzB,GAAIkF,EAAMzB,WAAW9Z,OAASwb,EAAYxb,QAAW,IACjDsb,EAAQrY,KAAKsY,EAAM1B,aAAa,aAC5B0B,EAAM1B,aAAa,WAChB0B,EAAM1B,aAAa,WAAW,CACjCyB,EAAU,GACV,KACJ,CAdJ,CAiBAA,EAAQja,QAAQ,cAAgB,GAAKia,EAAQja,QAAQ,oBAAsB,GAC3EgU,EAAKb,aAAa,qCAAqC,EAE/D,CACJ,CACJ,EAEA7W,EAAIua,OAAO5E,UAAUsC,oBAAsB,SAASP,GAChD,QAAIA,EAAKoG,aACyC,eAA1CpG,EAAKoG,WAAW7H,QAAQhV,eAGjBN,KAAKsX,oBAAoBP,EAAKoG,YAIjD,EAEA9d,EAAIua,OAAO5E,UAAUyC,oBAAsB,SAAS1E,GAEhD,IADA,IAAIqK,EAAYrK,EAAM8I,qBAAqB,SAClCra,EAAI,EAAGC,EAAO2b,EAAU1b,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACvD,IAAIuD,EAAQqY,EAAUla,KAAK1B,GACvB6b,EAAWtY,EAAM8W,qBAAqB,QAC1C,KAAMwB,GAAgC,IAApBA,EAAS3b,QACnB1B,KAAKsX,oBAAoBvS,IAAQ,CAErC,IACIW,EADMX,EAAM2X,cACDtB,cAAc,QAC7BrW,EAAM0W,YAAY/V,EACtB,CACJ,CACJ,EAGArG,EAAIua,OAAO5E,UAAU2C,oBAAsB,SAAS5E,GAChD,IAAIhO,EAAOuY,EAAuBC,EAAgBC,EAAoB9X,EAAM+X,EAActK,EAAKC,EAE/F,IAAKD,EAAM,EAAGC,GADdrO,EAAQgO,EAAM8I,qBAAqB,UACTna,OAAQyR,EAAMC,EAAKD,GAAO,EAGhD,GAAmB,IADnBzN,GADA4X,EAAWvY,EAAM7B,KAAKiQ,IACN0I,qBAAqB,SAC5Bna,QAIiB,GADZ4b,EAASzB,qBAAqB,eAC5Bna,OAAa,CAEzB8b,GADAD,EAAiBvd,KAAK6a,WAAW9H,EAAM2J,cAAe1c,KAAK6U,cACvBgH,qBAAqB,oBAAoB3Y,KAAK,GAClFua,EAAU/X,EAAKxC,KAAK,GACpBoa,EAASI,aAAaH,EAAgBE,EAAQE,aAC9C,IAAK,IAAI7a,EAAI,EAAG4B,EAAOrF,EAAIwO,iBAAiBnM,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CAClE,IAAI2S,EAAWpW,EAAIwO,iBAAiB/K,IAChC8a,EAAUH,EAAQlC,aAAa9F,KAE/B+H,EAAmBtH,aAAaT,EAAUmI,EAElD,CACA,IAAIC,EAAYJ,EAAQ5B,qBAAqB,aAC7C,IAAS/Y,EAAI,EAAG4B,EAAOmZ,EAAUnc,OAAQoB,EAAI4B,EAAM5B,GAAK,EACpD,GAAI,WAAa+a,EAAU/a,GAAGyY,aAAa,QACvC,IAAK,IAAIxD,EAAI,EAAGC,EAAO3Y,EAAIwO,iBAAiBnM,OAAQqW,EAAIC,EAAMD,GAAK,EAAG,CAClE,IACI6F,EADAnI,EAAWpW,EAAIwO,iBAAiBkK,IAChC6F,EAAUC,EAAU/a,GAAGyY,aAAa9F,KAEpC+H,EAAmBtH,aAAaT,EAAUmI,EAElD,CAGZ,CAER,EAGAve,EAAIua,OAAO5E,UAAUiD,eAAiB,SAASlF,GAC3C,IAAII,EAAKC,EAAK0K,EACV7K,EAAQF,EAAM8I,qBAAqB,SACvC,IAAK1I,EAAM,EAAGC,EAAMH,EAAMvR,OAAQyR,EAAMC,EAAKD,GAAO,GAChD2K,EAAU7K,EAAM/P,KAAKiQ,IACH0I,qBAAqB,QAC3Bna,QACRoc,EAAQ5H,aAAa,iBAAkB,OAGnD,EAKA7W,EAAI0e,SAAW,SAASC,GACpB,IAAIhL,EAAU,CAAC,EACX0I,EAAS,KA6Bb,YA5BI,IAAuBsC,EACnB,iBAAoBA,GAKhBhL,EAF0B,OAF9BgL,EAAYA,EAAUla,QAAQ,UAAW,IACpCA,QAAQ,OAAQ,KACPN,MAAM,EAAG,GAETnE,EAAIgZ,SAAS2F,GAGbrH,KAAKC,MAAMoH,GAEzBtC,EAAS,IAAIrc,EAAIuV,QAAQ5B,IAGzB0I,OAFO,IAAuBsC,EAAUzC,aAE/B,IAAIlc,EAAIua,OAAOoE,QACjB,IAAuBA,EAAUC,YAE/B,IAAI5e,EAAI6e,OAAOF,GAGf,IAAI3e,EAAIuV,QAAQoJ,GAG7B3e,EAAIE,MAAM,6BAETmc,GACDrc,EAAIE,MAAM,iEAEPmc,CACX,EAIArc,EAAI8e,eAAiB,SAAUC,GAC3B,GAAI/e,EAAIgf,cACJ,OAAOhf,EAAIgf,cAEf,IACIC,EADAC,EAAKve,KAELwe,EAAc,CACdC,YAAY,OACZC,mBAAkB,EAClBC,SAAQ,GAKPP,IACDA,EAAiB,SAKrB,IAAIQ,EAAa,SAAUpf,GACvB,OAAOA,EAAIsE,QAAQ,gBAAiB,GACxC,EAUI+a,KAfJP,EAAS,SAAUQ,EAAGC,GAClB,OAAO1f,EAAIgB,kBAAkB2e,KAAKT,EAAIO,GAAGG,cAAc5f,EAAIgB,kBAAkB2e,KAAKT,EAAIQ,GAAGX,EAAeI,EAC5G,GAKgB,KAAK,MAGN,SAAUM,EAAGC,GAChB,OAAOT,EAAOM,EAAWE,GAAIF,EAAWG,GAC5C,EAWR,OAPkB,SAAUD,EAAGC,GAC3B,OAAIF,EACOA,EAAeC,EAAGC,GAElBT,EAAOQ,EAAGC,EAEzB,CAEJ,EAIA1f,EAAI6f,gBAAkB,SAASJ,EAAGC,GAC9B,IAAI5L,EAAKC,EAAK+L,EAAMC,EAEpB,GAAIN,EAAE/Z,MAAMrD,SAAWqd,EAAEha,MAAMrD,OAE3B,OAAO,EAEP,IAAKyR,EAAM,EAAGC,EAAM0L,EAAE/Z,MAAMrD,OAAQyR,EAAMC,EAAKD,GAAO,EAAG,CACrD,GAAI2L,EAAE/Z,MAAMoO,KAAS4L,EAAEha,MAAMoO,GAEzB,OAAO,EAEP,IAAKgM,EAAO,EAAGC,EAAON,EAAEO,OAAOlM,GAAMgM,EAAOC,EAAMD,GAAQ,EACtD,GAAIL,EAAEO,OAAOlM,GAAKgM,KAAUJ,EAAEM,OAAOlM,GAAKgM,GAEtC,OAAO,CAIvB,CAEJ,OAAIL,EAAEQ,cAAgBP,EAAEO,cAIpBR,EAAES,cAAgBR,EAAEQ,YAFb,EAMJ,CACX,EAEAlgB,EAAImgB,iBAAmB,SAAUC,EAAQC,GACrC,IAAIle,EAAGC,EAAMqB,EAAG4B,EAAMib,EAClBlV,EAAM,CACVA,MAAY,GACZA,OAAa,GACbA,aAAkB,EAClBA,cAAmB,GACnB,IAAKjJ,EAAI,EAAGC,EAAOge,EAAO1a,MAAMrD,OAAQF,EAAIC,EAAMD,GAAK,EACnDme,EAAQF,EAAO1a,MAAMvD,GAIrBiJ,EAAI1F,MAAMvD,GAAKme,EAEnB,IAAKne,EAAK,EAAGC,EAAOge,EAAOJ,OAAO3d,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAExD,IADAme,EAAQ,GACH7c,EAAI,EAAG4B,EAAO+a,EAAOJ,OAAO7d,GAAGE,OAAQoB,EAAI4B,EAAM5B,GAAK,EAGvD6c,EAAMhb,KAAK8a,EAAOJ,OAAO7d,GAAGsB,IAEhC2H,EAAI4U,OAAO1a,KAAKgb,EACpB,CASA,OAPID,GACAjV,EAAI8U,YAAcG,EAAUH,YAC5B9U,EAAI6U,aAAeI,EAAUJ,eAE7B7U,EAAI8U,YAAcE,EAAOF,YACzB9U,EAAI6U,aAAeG,EAAOH,cAEvB7U,CACX,EAKApL,EAAIugB,eAAiB,WACjB,IAAIH,EAMJ,OALAA,EAASzf,KAAKC,IAAI4f,oBAEdJ,EAASzf,KAAKC,IAAI6f,mBAEZzgB,EAAImgB,iBAAiBC,EAEnC,EAKApgB,EAAI0gB,WAAa,WACb,OAAO/f,KAAKC,IAAI+f,UAAUC,QAAQzc,OACtC,EAKAnE,EAAI6gB,UAAY,WACZ,OAAOlgB,KAAKC,IAAI,YACpB,EAUAZ,EAAI8gB,UAAY,SAAUnP,EAAO/M,EAAMf,GAEnC,IAAIkd,EAAMC,EAEVD,EAAOpP,EAAMoP,KACbC,GAAY,EA2BRrP,EAAMS,OACN2O,EAVS,SAAUE,GACnB,OAAIA,GACAtgB,KAAKC,IAAIsgB,KAAKzc,QAAQ,WACfkN,EAAMwP,UAEbxgB,KAAKC,IAAIsgB,KAAKzc,QAAQ,QACfkN,EAAMyP,KAErB,EAEkBzB,KAAKhf,KAAKgR,EAAMS,KAAKxN,EAAMf,KAE7C,IAAK,IAAI1B,EAAE,EAAEC,EAAKuP,EAAM0P,MAAMhf,OAAOF,EAAEC,EAAKD,KAExC6e,EADOrP,EAAM0P,MAAMlf,GACFwd,KAAKhO,EAAOhR,KAAMiE,EAAMf,MAErCkd,EAAOC,GAQf,OAAOD,CACX,EAMA/gB,EAAIshB,YAAc,SAAUC,EAAiBC,GACzC,IAAIC,EAAMC,EAAaC,EAEvBF,EAAOF,EAAgBK,gBAEvB,IAAIC,EAAiBN,EAAgB9O,QAAQoP,eAG7CN,EAAkB,IAAIvhB,EAAI8hB,MAAM,QAAS9hB,EAAI0H,OAE7C,IAAIqa,GAAU,EACVC,GAAU,GACdN,EAAc/gB,KAAKshB,OAAOpO,eAAelT,KAAKshB,OAAOtO,QAAS,QAAS8N,IACvDpf,SACZ2f,EAAUrhB,KAAKshB,OAAO1L,kBAAkBmL,EAAY,GAAG,SACvDK,EAAUphB,KAAKshB,OAAO1L,kBAAkBmL,EAAY,GAAI,mBAExDK,IACAN,EAAOA,EAAO,IAAM9gB,KAAKuhB,MAAMC,uBAC/BC,EAAO,SAAUxgB,GACTA,EAAMhB,IAAIyhB,YACVzgB,EAAMhB,IAAI,0BAA2B,EAE7C,EACA2gB,EAAgBF,MAAM/b,KAAK8c,IAG3BzhB,KAAKuhB,MAAMI,YAAY5e,QAAQ+d,IAAS,EACxCzhB,EAAIE,MAAM,uCAA0CuhB,EAAO,kCAE3D9gB,KAAKuhB,MAAMI,YAAYhd,KAAKmc,GAGhCF,EAAgBgB,MAAQP,EAEpBhiB,EAAIyB,cAAcggB,KAClBF,EAAgBlM,MAAQoM,EACxB9gB,KAAKkB,IAAI2gB,YAAcxiB,EAAIsJ,UAG/BtJ,EAAIyiB,KAAKhF,MAAMyE,MAAMvC,KAAK4B,EAAiB5gB,KAAM6gB,GAAQ,GAGpD7gB,KAAKshB,OAAOzL,aAAakL,IAC1B1hB,EAAIE,MAAM,qCAAwCuhB,EAAO,KAI7D,IAMyBiB,EANrBC,EAAW3iB,EAAI4iB,eAAejD,KAAKhf,KAAM8gB,GAK7C,GAJIkB,IACA3iB,EAAI6iB,WAAWlD,KAAKhf,KAAMgiB,EAAUjB,GACpC1hB,EAAI8iB,eAAenD,KAAKhf,KAAMgiB,KAE7BhiB,KAAKuhB,MAAMG,UAAW,CACvB,IAAID,GAAiBM,EAOnBjB,EANS,SAAU7f,EAAOgD,EAAMf,GAE1B,IADA,IAAIkd,EAAO,EACJA,EAAOnf,EAAMmhB,OAAOL,GAAYrgB,QACnC0e,EAAO/gB,EAAI8gB,UAAUnB,KAAK/d,EAAOA,EAAMmhB,OAAOL,GAAY3B,GAAOnc,EAAMf,EAE/E,GAEAmf,EAAY,IAAIhjB,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WAC1Cob,EAAU3B,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAK0d,EAChB,EAGArB,EAAe,IAAI3hB,EAAI8hB,MAAM,QAAS9hB,EAAI2H,MAC7B8K,QAAQoP,eAAiBA,EAElCE,IACAK,EAAO,SAAUxgB,GACTA,EAAMhB,IAAIyhB,YACVzgB,EAAMhB,IAAI,0BAA2B,EAE7C,EACA+gB,EAAaN,MAAM/b,KAAK8c,IAExBb,EAAgBlM,QAChBsM,EAAatM,MAAQoM,GAGzBzhB,EAAIyiB,KAAKhF,MAAMyE,MAAMvC,KAAKgC,EAAchhB,KAAM6gB,GAAQ,GAEtD7gB,KAAKuhB,MAAMI,YAAY3W,KAC3B,EAEA3L,EAAI4iB,eAAiB,SAAUnB,GAC3B,IAAIkB,GAAW,EAOf,OANIhiB,KAAKuhB,MAAMG,UACXM,EAAWhiB,KAAKA,KAAKuhB,MAAMe,KAAOtiB,KAAKuhB,MAAMG,WAAWa,OAChDviB,KAAKoiB,OAAOtB,KACpBkB,EAAW,GACXhiB,KAAKoiB,OAAOtB,GAAQkB,GAEjBA,CACX,EAEA3iB,EAAI6iB,WAAa,SAAUF,EAAUjB,GACnB1hB,EAAImjB,YAAYxiB,KAAMgiB,EAOpCS,MALI,IAAuB1B,EAAYrf,OAC1Bqf,EAEAA,EAAY,GAG7B,EAEA1hB,EAAI8iB,eAAiB,SAAUH,GACtBhiB,KAAKuhB,MAAMG,WACZ1hB,KAAK0iB,mBAAmBV,EAEhC,EAkBA3iB,EAAIsjB,WAAa,SAAU1hB,EAAO2hB,EAAWC,EAAgBC,GACzD,IAAIpd,EAAM+H,EAAgB8F,EAAY5B,EAAaX,EAAY6P,EAG/D,GAFAnb,EAAOzE,EAAMqgB,OAAO9L,SAASxV,OAEzBiB,EAAMsgB,MAAMwB,MAAQ9hB,EAAMsgB,MAAMwB,OAASrd,EAG7C,GAAKA,EAAL,CAcA,GAPKrG,EAAIyiB,KAAK7gB,EAAMqgB,OAAO9L,SAASxV,QAChCX,EAAIE,MAAM,wBAA2BmG,EAAO,MAEpC,GACZ6N,EAAatS,EAAMqgB,OAAO/N,WAAWvT,MACrC2R,EAActS,EAAI2jB,eAAehE,KAAKhf,KAAMiB,EAAOsS,GACnDvC,EAAQ,IAAI3R,EAAI8hB,MAAMzb,EAAMkd,GACxBA,IAAcvjB,EAAI2H,KAAgB,OAATtB,GAA0B,YAATA,GAA+B,WAATA,EAAmB,CAInF,IAAK,IAAIT,KAAOsO,EACZ,GAAIA,EAAW0P,eAAehe,GAAM,CAChC,GAAI2d,IAAcvjB,EAAI2H,KAAe,cAAR/B,GAA+B,YAARA,EAChD,SAEJ,GAAIsO,EAAW0P,eAAehe,GAC1B,GAAI5F,EAAI6jB,WAAWje,GACf,IACI5F,EAAI6jB,WAAWje,GAAK+Z,KAAKhO,EAAO/P,EAAO,GAAKsS,EAAWtO,GAC3D,CAAE,MAAO9E,GACLd,EAAIE,MAAM0F,EAAM,eAAiB9E,EACrC,MAEAd,EAAIK,MAAM,iCAAkCuF,EAAI,aAG5D,CAEJ+L,EAAMW,YAAcA,EAChBtS,EAAI+F,eAAerC,QAAQwQ,EAAW,eAAiB,GACvDuP,EAAUne,KAAKqM,EAAMmS,UAE7B,MAAWP,IAAcvjB,EAAI2H,KAAOuM,EAAW,eAC3CvC,EAAMoS,aAAc,EAChB/jB,EAAI+F,eAAerC,QAAQwQ,EAAW,eAAiB,IACvDvC,EAAMmS,UAAYL,EAAU9X,QAShC6V,EADAgC,GAGS5hB,EAAMA,EAAMsgB,MAAMlU,MAAMkV,OAGrCljB,EAAIyiB,KAAKpc,GAAM6b,MAAMvC,KAAKhO,EAAO/P,EAAO4f,GAAQ,EAnDhD,MALIpT,EAAMxM,EAAMqgB,OAAO5L,QAAQ1V,SAEvBiB,EAAMsgB,MAAMtF,KAAOxO,EAuD/B,EAOApO,EAAIgG,WAAa,WAgBb,IATA,IAAIge,EAAa,CACb,CAAC,KAAgB,MACjB,CAAC,KAAgB,MACjB,CAAC,KAAgB,MACjB,CAAC,KAAgB,OAIjBC,EAAkB,CAAC,EACd9hB,EAAE,EAAEC,EAAK4hB,EAAW3hB,OAAQF,EAAEC,EAAMD,IAAK,CAC9C,IAAIyD,EAAMoe,EAAW7hB,GAAG,GACpB0D,EAAMme,EAAW7hB,GAAG,GACxB8hB,EAAgBre,GAAOC,CAC3B,CAEA,IAAIqe,EAAoB,GACpBC,EAAW,CAAC,EAChB,IAAShiB,EAAE,EAAEC,EAAK4hB,EAAW3hB,OAAQF,EAAEC,EAAMD,IAAK,CAC9C,IAAIiiB,EAAOJ,EAAW7hB,GAClB0D,EAAMue,EAAK,GACfF,EAAkB5e,KAAKO,GACvBse,EAASC,EAAK,IAAMA,EAAK,EAC7B,CACA,IAAIC,EAAmBH,EAAkB5hB,KAAK,KAI1CgiB,EAAgB,IAAInjB,OAAO,MAAQkjB,EAAmB,eACtDE,EAAe,IAAIpjB,OAAO,MAAQkjB,EAAmB,cAAe,KAGpEG,EAAgB,mBAGhBC,EAAY,UAGZC,EAAa,UAUbC,EAAY,2IAEZC,EAAU,IAAIzjB,OAAOwjB,EAAUlgB,QAAQ,YAAa,KAAKA,QAAQ,aAAc,MAC/EogB,EAAe,IAAI1jB,OAAOwjB,EAAUlgB,QAAQ,YAAa,KAAKA,QAAQ,aAAc,MACpFqgB,EAAe,IAAI3jB,OAAOwjB,EAAUlgB,QAAQ,YAAa,KAAMA,QAAQ,aAAc,MAQzF9D,KAAKokB,aADa,gIACc7iB,MAAM,KAMtCvB,KAAKqkB,iBAAmB,WAEpBrkB,KAAKskB,WAAa,EAClBtkB,KAAKukB,SAAW,CACpB,EAEAvkB,KAAKwkB,iBAAmB,WAEpBxkB,KAAKskB,WAAa,EAClBtkB,KAAKukB,SAAW,CACpB,EAEAvkB,KAAKykB,sBAAwB,WAEzBzkB,KAAK0kB,UAAY,GACjB,IAAK,IAAIljB,EAAE,EAAEC,EAAKzB,KAAKokB,aAAa1iB,OAAQF,EAAEC,EAAMD,IAChDxB,KAAK0kB,UAAU/f,KAAK,CAAC3E,KAAKokB,aAAa5iB,KAE3CxB,KAAK2kB,aAAe,GACpB,IAASnjB,EAAE,EAAEC,EAAKzB,KAAK0kB,UAAUhjB,OAAQF,EAAEC,EAAMD,IAAK,CAClDxB,KAAK2kB,aAAahgB,KAAK,IACvB,IAAK,IAAI7B,EAAE,EAAE4B,EAAK1E,KAAK0kB,UAAUljB,GAAGE,OAAQoB,EAAE4B,EAAM5B,IAChD9C,KAAK2kB,aAAanjB,GAAGmD,KAAK3E,KAAK0kB,UAAUljB,GAAG,GAAGgC,MAAM,EAAG,GAEhE,CACAxD,KAAK4kB,WAAa,GAClB,IAASpjB,EAAE,EAAEC,EAAKzB,KAAK2kB,aAAajjB,OAAQF,EAAEC,EAAMD,IAChDxB,KAAK4kB,WAAWjgB,KAAK,IAAInE,OAAO,MAAQR,KAAK2kB,aAAanjB,GAAGG,KAAK,KAAO,KAEjF,EAEA3B,KAAK6kB,oBAAsB,SAASvjB,GAUhC,GALI,iBAAoBA,IACpBA,EAAMA,EAAIC,MAAM,QAID,KAAfD,EAAII,QAAgC,KAAfJ,EAAII,OAA7B,CAOA,IAAK,IAAIF,EAAE,EAAEC,EAAKH,EAAII,OAAQF,EAAEC,EAAMD,IAAK,CAKvC,IAJA,IAAIsjB,EAAe,KACf/B,GAAO,EACPgC,EAAS,EACTC,EAAe,CAAC,EACXliB,EAAE,EAAE4B,EAAK1E,KAAK2kB,aAAajjB,OAAQoB,EAAE4B,EAAM5B,IAAK,CAErD,GADAkiB,EAAaliB,GAAK,CAAC,EACfA,IAAMtB,GAEN,IAAK,IAAIuW,EAAE,EAAEC,EAAKhY,KAAK2kB,aAAanjB,GAAGE,OAAQqW,EAAEC,EAAMD,IACnD,GAAI/X,KAAK2kB,aAAanjB,GAAGuW,KAAOzW,EAAIE,GAAGgC,MAAM,EAAGxD,KAAK2kB,aAAanjB,GAAGuW,GAAGrW,QAAS,CAC7EqhB,GAAO,EACP,KACJ,OAIJ,IAAShL,EAAE,EAAEC,EAAKhY,KAAK2kB,aAAa7hB,GAAGpB,OAAQqW,EAAEC,EAAMD,IAEnD,GADA+M,EAAe9kB,KAAK2kB,aAAa7hB,GAAGiV,GAAGrW,OACnC1B,KAAK2kB,aAAa7hB,GAAGiV,KAAOzW,EAAIE,GAAGgC,MAAM,EAAGshB,GAAe,CAC3D,KAAO9kB,KAAK0kB,UAAU5hB,GAAGiV,GAAGvU,MAAM,EAAGshB,KAAkBxjB,EAAIE,GAAGgC,MAAM,EAAGshB,IAAe,CAElF,GAAIA,EAAexjB,EAAIE,GAAGE,QAAUojB,EAAe9kB,KAAK0kB,UAAU5hB,GAAGiV,GAAGrW,OAAQ,CAC5ErC,EAAIK,MAAM,uDAAuD4B,EAAIE,IACrE,KACJ,CAEIsjB,GAAgB,CAExB,CACAC,EAASD,EACTE,EAAaliB,GAAGiV,GAAK+M,CACzB,CAGR,IAAK,IAAIG,KAAQD,EACb,IAAK,IAAIE,KAAQF,EAAaC,GAC1BH,EAAeE,EAAaC,GAAMC,GAClCD,EAAOtM,SAASsM,EAAM,IACtBC,EAAOvM,SAASuM,EAAM,IACtBllB,KAAK2kB,aAAaM,GAAMC,GAAQllB,KAAK0kB,UAAUO,GAAMC,GAAM1hB,MAAM,EAAGshB,EAGhF,CAEK/B,IACD/iB,KAAK0kB,UAAUljB,GAAGmD,KAAKrD,EAAIE,IAC3BxB,KAAK2kB,aAAanjB,GAAGmD,KAAKrD,EAAIE,GAAGgC,MAAM,EAAGuhB,IAElD,CAGA/kB,KAAK4kB,WAAa,GAClB5kB,KAAKmlB,aAAe,GACpB,IAAS3jB,EAAE,EAAEC,EAAKzB,KAAK2kB,aAAajjB,OAAQF,EAAEC,EAAMD,IAChDxB,KAAK4kB,WAAWjgB,KAAK,IAAInE,OAAO,OAASR,KAAK2kB,aAAanjB,GAAGG,KAAK,KAAO,MAC1E3B,KAAKmlB,aAAaxgB,KAAK,OAAS3E,KAAK2kB,aAAanjB,GAAGG,KAAK,KAAO,KAErE,GAAiC,KAA7B3B,KAAK2kB,aAAajjB,OAClB,IAASF,EAAE,GAAGC,EAAK,GAAID,EAAEC,EAAMD,IAC3BxB,KAAK4kB,WAAWpjB,EAAE,GAAK,IAAIhB,OAAO,OAASR,KAAK2kB,aAAanjB,GAAGG,KAAK,KAAO,KAC5E3B,KAAKmlB,aAAa3jB,EAAE,GAAK,OAASxB,KAAK2kB,aAAanjB,GAAGG,KAAK,KAAO,GAjE3E,MAFItC,EAAIK,MAAM,2BAA2B4B,EAAII,OAAO,iCAsExD,EAMA1B,KAAKolB,yBAA2B,SAAUC,GAEtCA,EAAQ,cAAgB,GACxBA,EAAQ,cAAc1gB,KAAK,IAG3B,IAFA,IACI2gB,EADAC,EAAW,EAEN/jB,EAAE,EAAEC,EAAK,EAAGD,EAAEC,GAEd4jB,EADLC,EAAO,CAAC,OAAQ,QAAS,OAAO9jB,IADPA,IAKzB+jB,GAAY,EACZF,EAAQ,cAAc,GAAG1gB,KAAK0gB,EAAQC,WAC/BD,EAAQC,GAEnBD,EAAQ,cAAc1gB,KAAK,IAC3B,IAASnD,EAAE,EAAGC,EAAK8jB,EAAU/jB,EAAEC,GAEtB4jB,EADLC,EAAO,CAAC,WAAY,YAAa,WAAW9jB,IADXA,IAKjC6jB,EAAQ,cAAc,GAAG1gB,KAAK0gB,EAAQC,WAC/BD,EAAQC,GAKnB,OAHID,EAAQ,cAAc,GAAG3jB,SAAW2jB,EAAQ,cAAc,GAAG3jB,QAC7D2jB,EAAQ,cAAcra,MAEnBqa,CACX,EAGArlB,KAAKwlB,0BAA4B,SAASH,GAGtC,IADA,IAAI5a,EAAM,GACDjJ,EAAI,EAAaA,EAAH,GACf6jB,EAAQhmB,EAAIyJ,eAAetH,IADCA,GAAK,EAEjCiJ,EAAI9F,KAAK0gB,EAAQhmB,EAAIyJ,eAAetH,KAK5C,OAAOiJ,EAAI9I,KAAK,IACpB,EAMA3B,KAAKylB,kBAAoB,SAAUhb,EAAKib,EAAOC,EAAMlY,GAC5CkY,IACDA,EAAO,IAIX,IAFA,IAAIrkB,EAAMmM,EAAIlM,MAAMmkB,GAEXlkB,EAAE,EAAGC,EAAKH,EAAII,OAAQF,EAAEC,EAAMD,IACnC,GAAsB,IAAlBF,EAAIE,GAAGE,OAAc,CACrB+I,EAAK,OAASkb,GAASrkB,EAAIE,GAAGsC,QAAQ,MAAO,IAIzCxC,EAHCE,EAGKF,EAAIkC,MAAM,EAAGhC,GAFbF,EAAIkC,MAAM,GAIpB,KACJ,CAEJ,IAAShC,EAAE,EAAEC,EAAKH,EAAII,OAAQF,EAAEC,EAAMD,IAClCF,EAAIE,GAAKmX,SAASrX,EAAIE,GAAI,IAE9B,GAAmB,IAAfF,EAAII,QAAgC,IAAfJ,EAAII,SAAiBJ,EAAI,IAC1CskB,EAAQtkB,EAAI,MAEZmJ,EAAK,QAAUkb,GAAS,GAAKrkB,EAAI,SAElC,GAAmB,IAAfA,EAAII,OACX,GAAIJ,EAAItB,KAAKskB,YAAc,GAAI,CAC3B,IAAIsB,EAAQtkB,EAAItB,KAAKukB,UACjBsB,EAAMvkB,EAAItB,KAAKskB,YACfsB,IACAnb,EAAK,QAAUkb,GAAS,GAAKC,EACzBC,IACApb,EAAK,MAAQkb,GAAS,GAAKE,GAGvC,KAAO,CACCD,EAAQtkB,EAAItB,KAAKskB,YACjBuB,EAAMvkB,EAAItB,KAAKukB,UACfqB,IACAnb,EAAK,QAAUkb,GAAS,GAAKC,EACzBC,IACApb,EAAK,MAAQkb,GAAS,GAAKE,GAGvC,CAER,EAMA7lB,KAAK6D,kBAAoB,SAAU4J,GAI/B,IAIInM,EAJAwkB,EAAOrY,EACPsY,GAAY,EACZC,GAAW,EACXC,GAAiB,EAErB,GAAIxY,EAAK,CASL,GANwB,OAFxBA,EAAMA,EAAI3J,QAAQ,qBAAsB,OAEhCN,MAAM,EAAG,KACbyiB,GAAiB,EACjBxY,EAAMA,EAAIjK,MAAM,IAIhBiK,EAAI/J,MAAM,gBACV,KAAO+J,EAAI/L,OAAS,GAChB+L,EAAM,IAAMA,EASpB,GADIhK,GADJgK,GAFAA,EAAM,GAAKA,GAED3J,QAAQ,kCAAkC,KACxCJ,MAAMmgB,GACX,CASH,IAAIqC,GAHJzY,GADAA,GADAA,GADAA,GADAA,GADAA,EAAMA,EAAI3J,QAAQ,OAAQ,KAChBA,QAAQggB,EAAW,KACnBhgB,QAAQ+f,EAAe,MACvB/f,QAAQigB,EAAY,MACpBjgB,QAAQ,QAAS,MACjBA,QAAQ,MAAM,KAGTvC,MAAMoiB,GACrBriB,EAAM,GACN,IAAI0D,EAAKyI,EAAI/J,MAAMkgB,GACnB,GAAI5e,EAAI,CAEJ,IADA,IAAImhB,EAAM,GACD3kB,EAAE,EAAEC,EAAKuD,EAAGtD,OAAQF,EAAEC,EAAMD,IACjC2kB,EAAMA,EAAIrgB,OAAOd,EAAGxD,GAAGkC,MAAM,qBAAqBF,MAAM,IAE5D,IAAShC,EAAE,EAAEC,EAAKykB,EAAKxkB,OAAQF,EAAEC,EAAMD,IAEnC,GADAF,EAAIqD,KAAKuhB,EAAK1kB,IACVA,IAAOC,EAAO,EAAI,CAElB,IAAI2kB,EAAa,EAAJ5kB,EACbF,EAAIqD,KAAKwhB,EAAIC,IACb9kB,EAAIqD,KAAKwhB,EAAIC,EAAQ,GACzB,CAER,MACI9kB,EAAM4kB,EAGV,IAAS1kB,EAAE,EAAEC,EAAKH,EAAII,OAAQF,EAAEC,EAAMD,GAAG,EACrCF,EAAIE,EAAI,GAAKgiB,EAASliB,EAAIE,IAAMmX,SAASrX,EAAIE,EAAI,GAAI,IACrDF,EAAIE,GAAK,GAYbukB,GAFAtY,GAHAA,GAJAA,GADAA,EAAMnM,EAAIK,KAAK,KACLmC,QAAQ,WAAY,IAAIA,QAAQ,YAAa,MAI7CA,QAAQ,SAAU,KAGlBA,QAAQ,UAAW,KAEdf,QAAQ,KACvBijB,EAAUvY,EAAI1K,QAAQ,IAC1B,CACJ,CAIA,IAGIsjB,EACAC,EAJAtkB,EAAS,GACToC,EAAO,GACPihB,EAAU,CAAC,EAGf,GAAwB,OAPxB5X,EAAMA,EAAI3J,QAAQ,gBAAiB,OAO3BN,MAAM,EAAG,IAAiC,MAAlBiK,EAAIjK,OAAO,GAEvC,OADA6hB,EAAQ5f,QAAUgI,EAAIjK,MAAM,GAAI,GACzB6hB,EAEPU,GAAY,GAAKC,GAAW,EACXvY,EAAIlM,MAAM,KACZG,OAAS,GACpB2kB,EAAa,IAEbC,EAAY,IACZhlB,GAFAmM,EAAMA,EAAI3J,QAAQ,MAAO,MAEfvC,MAAM4iB,KAEhBkC,EAAa,IAEbC,EAAY,IACZhlB,GAFAmM,EAAMA,EAAI3J,QAAQ,MAAO,MAEfvC,MAAM2iB,KAKpBmC,EAAa,IACbC,EAAY,IACZhlB,GAHAmM,GADAA,EAAMA,EAAI3J,QAAQ,MAAO,MACfA,QAAQ,MAAO,MAGfvC,MAAM0iB,IAEpB,IAAIxZ,EAAM,GACV,IAASjJ,EAAE,EAAEC,EAAKH,EAAII,OAAQF,EAAEC,EAAMD,IAAK,CACvC,IAAIiC,KAAInC,EAAIE,GAAGkC,MAAM,iDAEjB+G,EAAI9F,KAAKlB,EAAE,GAEnB,CAIA,IAAI8iB,EAAW9b,EAAI1H,QAAQsjB,GACvBG,EAAS,GACTC,GAAU,EACVF,GAAY,GACZC,EAAO7hB,KAAK,CAAC,EAAG4hB,IAChBC,EAAO7hB,KAAK,CAAE4hB,EAAW,EAAI9b,EAAI/I,SACjC+kB,GAAU,GAEVD,EAAO7hB,KAAK,CAAC,EAAG8F,EAAI/I,SAKxB,IAAIikB,EAAO,GAEX,IAASnkB,EAAE,EAAEC,EAAK+kB,EAAO9kB,OAAQF,EAAEC,EAAMD,IAAK,CAC1C,IAAIkkB,EAAQc,EAAOhlB,GAIfklB,EAAOjc,EAAIjH,MAAMkiB,EAAM,GAAIA,EAAM,IACrCiB,EACA,IAAK,IAAI7jB,EAAE,EAAE4B,EAAKgiB,EAAKhlB,OAAQoB,EAAE4B,EAAM5B,IAAK,CACxC,IAAI8jB,EAAUF,EAAK5jB,GAInB,GAAI8jB,EAAQ7jB,QAAQujB,IAAc,EAC9BtmB,KAAKylB,kBAAkBJ,EAASiB,EAAWX,EAAMiB,QAMrD,GAAIA,EAAQljB,MAAM,YACd2hB,EAAS,OAASM,GAASiB,EAAQ9iB,QAAQ,MAAO,QADtD,EAOgB,MAAZ8iB,GAA+B,MAAZA,GAA+B,MAAZA,GAAmBA,EAAQljB,MAAM,WACvE2hB,EAAQwB,OAAQ,GAKpB,IAAK,IAAI9O,EAAE,EAAEC,EAAKhY,KAAK4kB,WAAWljB,OAAQqW,EAAEC,EAAMD,IAC9C,GAAI6O,EAAQvmB,oBAAoBqD,MAAM1D,KAAK4kB,WAAW7M,IAAK,CACvDsN,EAAS,QAAUM,GAAS,IAAMhN,SAASZ,EAAG,IAAM,GACpD,SAAS4O,CACb,CAKAC,EAAQljB,MAAM,cACd1B,EAAS4kB,GAOTA,EAAQvmB,oBAAoBqD,MAAM,QAAU1B,GAC5CqjB,EAAS,OAASM,GAAS,IAAgB,EAAV3jB,EACjCA,EAAS,IAGT4kB,EAAQvmB,oBAAoBqD,MAAM,QAAU1B,GAC5CqjB,EAAS,OAASM,GAAS,GAAK3jB,EAChCA,EAAS,KAMT4kB,EAAQvmB,oBAAoBqD,MAAM,wBAA2B2hB,EAAS,SAAWM,KACjFvhB,EAAOwiB,EAzCX,CA4CJ,CAKI5kB,IACAqjB,EAAS,MAAQM,GAAS3jB,EAC1BA,EAAS,IAOToC,IAASihB,EAAS,SAAWM,KAC7BN,EAAS,SAAWM,GAASvhB,EAAKQ,OAClCR,EAAO,IAEXuhB,EAAO,MACX,CAKA,GAAIc,EACA,IAAS3jB,EAAE,EAAE4B,EAAKrF,EAAIyJ,eAAepH,OAAQoB,EAAE4B,EAAM5B,IAAK,CACtD,IAAII,EAAO7D,EAAIyJ,eAAehG,GAC1BuiB,EAAQniB,KAAUmiB,EAASniB,EAAO,QAClCmiB,EAASniB,EAAO,QAAWmiB,EAAQniB,IAC3BmiB,EAAQniB,IAASmiB,EAASniB,EAAO,UACzCmiB,EAAQniB,GAAQmiB,EAASniB,EAAO,QAExC,GAKCmiB,EAAQyB,MAASzB,EAAQyB,MAAQzB,EAAQQ,MAAQR,EAAQO,SAC1DP,EAAU,CAAE,QAAWS,IAE3B,IAAIiB,EAAQ,CAAC,OAAQ,QAAS,MAAO,WAAY,YAAa,WAC9D,IAASvlB,EAAE,EAAEC,EAAKslB,EAAMrlB,OAAQF,EAAEC,EAAMD,IAAK,CACzC,IAAI8jB,EAAOyB,EAAMvlB,GACb,iBAAoB6jB,EAAQC,IAASD,EAAQC,GAAM5hB,MAAM,cACzD2hB,EAAQC,GAAQ3M,SAAS0M,EAAQC,GAAO,IAGhD,CAIA,OAHIW,GAAkB5R,OAAO7J,KAAK6a,GAAStiB,QAAQ,SAAW,IAC1DsiB,EAAQyB,MAAwB,EAAhBzB,EAAQyB,MAErBzB,CACX,EAEArlB,KAAKsF,iBAAmB,SAASmI,GAC7B,OAAOzN,KAAKolB,yBAAyBplB,KAAK6D,kBAAkB4J,GAChE,EAEAzN,KAAKgnB,kBAAoB,SAASvZ,GAC9B,OAAOzN,KAAKwlB,0BAA0BxlB,KAAK6D,kBAAkB4J,GACjE,EAEAzN,KAAK4W,MAAQ,SAASnJ,GAClB,OAAOzN,KAAK6D,kBAAkB4J,EAClC,EAOAzN,KAAKwkB,mBACLxkB,KAAKykB,uBACT,EACAplB,EAAIgG,WAAa,IAAIhG,EAAIgG,WAIzBhG,EAAI4nB,OAAS,SAAUrT,EAAKsT,EAAO3kB,EAAM4kB,GACrC,IAAWC,EA6LS9lB,EAxGpB,IAAK,IAAIE,KApFTxB,KAAKqnB,kBAAoBhoB,EAAIC,kBAC7BU,KAAKsnB,YAAc,MACnBtnB,KAAK4T,IAAMA,EAEiB,mBAAjBS,OAAOC,QAEdD,OAAOkT,eAAelT,OAAQ,SAAU,CACpCpD,MAAO,SAAgB4P,GAEnB,GAAc,MAAVA,EACA,MAAM,IAAI2G,UAAU,8CAKxB,IAFA,IAAIC,EAAKpT,OAAOwM,GAEP6G,EAAQ,EAAGA,EAAQC,UAAUjmB,OAAQgmB,IAAS,CACnD,IAAIE,EAAaD,UAAUD,GAE3B,GAAkB,MAAdE,EACA,IAAK,IAAIC,KAAWD,EAEZvT,OAAOW,UAAUiO,eAAejE,KAAK4I,EAAYC,KACjDJ,EAAGI,GAAWD,EAAWC,GAIzC,CACA,OAAOJ,CACX,EACAK,UAAU,EACVC,cAAc,IAOlBnU,EAAIoU,kBACJ3oB,EAAI4oB,8BAAgC,IAAIznB,OAAO,MAAQ,CAAC,KAAKsF,OAAOzG,EAAImJ,sBAAsB7G,KAAK,IAAM,YAGzGtC,EAAIwU,sBACJ7T,KAAK4T,IAAIC,oBAAsBxU,EAAIwU,qBAEnCxU,EAAI6oB,kBACJloB,KAAK4T,IAAIsU,gBAAkB7oB,EAAI6oB,iBAE/BloB,KAAK4T,IAAIyK,gBACThf,EAAIgf,cAAgBre,KAAK4T,IAAIyK,eAEjCre,KAAK4T,IAAI9R,qBAAuBzC,EAAIyC,qBAEpC9B,KAAKmoB,UAAY,IAAI9oB,EAAI+oB,UAAUpoB,MAEnCA,KAAKqoB,cAAgB,SAAUnjB,GAC3BlF,KAAKkB,IAAI,eAAiBgE,CAC9B,EAEAlF,KAAKkB,IAAM,IAAI7B,EAAI4nB,OAAOqB,IAC1BtoB,KAAKC,IAAM,IAAIZ,EAAI4nB,OAAOsB,IAC1BvoB,KAAKuhB,MAAQ,IAAIliB,EAAI4nB,OAAOuB,MAC5BxoB,KAAK2D,IAAM,IAAItE,EAAI4nB,OAAOwB,IAAIzoB,MAE9BA,KAAK0oB,UAAY,IAAIrpB,EAAI4nB,OAAO0B,UAIhC3oB,KAAK4oB,cAAgB,IAAIvpB,EAAI4nB,OAAO4B,aACpC7oB,KAAK8oB,kBAAoB,IAAIzpB,EAAI4nB,OAAO8B,iBACxC/oB,KAAKgpB,SAAW,IAAI3pB,EAAI4nB,OAAOgC,SAASjpB,MACxCA,KAAKkpB,aAAe,IAAI7pB,EAAI4nB,OAAOkC,aACnCnpB,KAAKopB,OAAS,IAAI/pB,EAAI4nB,OAAOoC,OAE7BrpB,KAAKspB,OAAS,IAAIjqB,EAAI2N,OAAOuc,MAAMvpB,MAOnCA,KAAKwpB,QAAU,IAAInqB,EAAI2N,OAAOuc,MAAMvpB,MAEpCA,KAAKshB,OAASjiB,EAAI0e,SAASmJ,GAEb7nB,EAAIkT,YAAa,CAC3B,IAAIkX,EAASpqB,EAAIkT,YAAY/Q,GACzB,kBAAqBxB,KAAK4T,IAAI6V,KAC9BzpB,KAAKkB,IAAIiC,uBAAuBsmB,GAAUzpB,KAAK4T,IAAI6V,GAG3D,EACIzpB,KAAKkB,IAAIiC,uBAAuBgK,qBAAuBnN,KAAKkB,IAAIiC,uBAAuBsJ,wBACvFzM,KAAKkB,IAAIiC,uBAAuBumB,6BAA8B,GAE9D1pB,KAAKkB,IAAIiC,uBAAuBwmB,6BAChC3pB,KAAKuhB,MAAMqI,UAAY,EACvB5pB,KAAK6pB,cAAgB,SAAS9W,EAAOyC,GACjC,IAAIT,EAAW/U,KAAKshB,OAAOvM,SAAShC,GACpC/S,KAAKshB,OAAOpL,aAAanD,EAAO,QAAS/S,KAAKuhB,MAAMqI,WACpD5pB,KAAKkB,IAAI4oB,UAAUnlB,KAAK6Q,GACxBxV,KAAKuhB,MAAMqI,WAAa,EACxB,IAAK,IAAIpoB,EAAI,EAAGC,EAAOzB,KAAKshB,OAAOjO,cAAc0B,GAAWvT,EAAIC,EAAMD,GAAK,GACvEgU,EAAWxV,KAAKshB,OAAO9L,SAAST,EAASvT,MAErCxB,KAAK6pB,cAAc9U,EAASvT,GAAIgU,EAG5C,EACAxV,KAAK6pB,cAAc7pB,KAAKshB,OAAOtO,QAAS,UAG5ChT,KAAKshB,OAAO7J,oBAAoBzX,KAAKshB,OAAOtO,SAC5ChT,KAAKshB,OAAO3J,oBAAoB3X,KAAKshB,OAAOtO,SAC5ChT,KAAKshB,OAAOrK,wBAAwBjX,KAAKshB,OAAOtO,SAChDhT,KAAKshB,OAAOrJ,eAAejY,KAAKshB,OAAOtO,cAEnC,IADIhT,KAAKshB,OAAO/N,WAAWvT,KAAKshB,OAAOtO,SACV,oBAC7BhT,KAAKshB,OAAOpL,aAAalW,KAAKshB,OAAOtO,QAAS,iBAAkB,MAGpEhT,KAAKkB,IAAI,2BAA4B,EASrClB,KAAK+pB,qBAEL/pB,KAAKkB,IAAIC,OAASnB,KAAKshB,OAAO1L,kBAAkB5V,KAAKshB,OAAOtO,QAAS,SACrEhT,KAAKkB,IAAW,MAAIlB,KAAKkB,IAAIC,OAC7BnB,KAAKkB,IAAI8oB,QAAUhqB,KAAKshB,OAAOnM,WAAWnV,KAAKshB,OAAOtO,SACtDhT,KAAKkB,IAAImU,UAAYrV,KAAKshB,OAAOnM,WAAWnV,KAAKshB,OAAOtO,SAAS,GAE7B,SAAhChT,KAAKkB,IAAI+oB,QAAQzmB,MAAM,EAAE,KACzBxD,KAAKkB,IAAIiC,uBAAuB+mB,yBAA0B,EAC1DlqB,KAAKkB,IAAIiC,uBAAuBgnB,6BAA8B,EAC9DnqB,KAAKkB,IAAIiC,uBAAuBumB,6BAA8B,EAC9D1pB,KAAKkB,IAAIiC,uBAAuBinB,wBAAyB,EACzDpqB,KAAKkB,IAAIiC,uBAAuBknB,yCAA0C,EAC1ErqB,KAAKkB,IAAIiC,uBAAuBmnB,oBAAqB,EACrDtqB,KAAKkB,IAAIiC,uBAAuBonB,6BAA8B,GAM9DhoB,IACAA,EAAOA,EAAKuB,QAAQ,IAAK,KACzBvB,EAAOlD,EAAI0E,mBAAmBxB,IAE9BvC,KAAKkB,IAAI,kBAAkB,KAC3BlB,KAAKkB,IAAI,kBAAkB,GAAKlB,KAAKkB,IAAI,kBAAkB,GAAG4C,QAAQ,IAAK,KAC3E9D,KAAKkB,IAAI,kBAAkB,GAAK7B,EAAI0E,mBAAmB/D,KAAKkB,IAAI,kBAAkB,KAElFqB,GAAQ4kB,IACRnnB,KAAKkB,IAAI,kBAAoB,CAACqB,IAE9BA,IAAS4kB,GAAannB,KAAKkB,IAAI,kBAAkB,KACjDqB,EAAOvC,KAAKkB,IAAI,kBAAkB,IAEI,IAAtClB,KAAKkB,IAAI,kBAAkBQ,SACtBa,IACDA,EAAO,SAEXvC,KAAKkB,IAAI,kBAAkByD,KAAK,UAE/BpC,IACDA,EAAOvC,KAAKkB,IAAI,kBAAkB,IAEtCkmB,EAAW/nB,EAAImrB,cAAcjoB,GAC7BvC,KAAKkB,IAAIqB,KAAO6kB,EAASqD,KACzBzqB,KAAKkB,IAAI,kBAAkB,GAAKkmB,EAASqD,KACzCzqB,KAAK2C,OAAS,CAAC,EACV3C,KAAKkB,IAAI,yBACVlB,KAAKkB,IAAI,uBAAyBlB,KAAKkB,IAAI,kBAAkB,IAG7D,QAAQ+d,cAAc,QAASjf,KAAKkB,IAAI,yBAA2B,EACnElB,KAAKkB,IAAIwpB,SAAW,IAEpB1qB,KAAKkB,IAAIwpB,SAAW,IAExB1qB,KAAK2qB,gBAAgBvD,GAQrBpnB,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAK,sBAJxBtB,GADYA,EAK8CtB,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAK,eAJhFY,QACJ,IAAIhD,OAAQ,2BAA6Bc,EAAIK,KAAK,KAAO,uBAAwB,MAK/F3B,KAAKspB,OAAOsB,OAAS,IAAIvrB,EAAI2N,OAAOuc,MAAMqB,OAAO5qB,KAAK6qB,OAAO,yBAE7D7qB,KAAKyT,SAAW,IAAIpU,EAAIyrB,SAAS9qB,MAOjCA,KAAKoiB,OAAS,CAAC,EAEfpiB,KAAKuhB,MAAMlU,KAAO,WAClB,IAAI0d,EAAa/qB,KAAKshB,OAAOpO,eAAelT,KAAKshB,OAAOtO,QAAShT,KAAKuhB,MAAMlU,MAC5ErN,KAAKgrB,gBAAgBD,EAAY/qB,KAAKA,KAAKuhB,MAAMlU,MAAMkV,QAEvDviB,KAAKuhB,MAAMlU,KAAO,eACd0d,EAAa/qB,KAAKshB,OAAOpO,eAAelT,KAAKshB,OAAOtO,QAAShT,KAAKuhB,MAAMlU,MAC5ErN,KAAKgrB,gBAAgBD,EAAY/qB,KAAKA,KAAKuhB,MAAMlU,MAAMkV,QAEvDviB,KAAKuhB,MAAMlU,KAAO,SACd0d,EAAa/qB,KAAKshB,OAAOpO,eAAelT,KAAKshB,OAAOtO,QAAShT,KAAKuhB,MAAMlU,MAC5ErN,KAAKgrB,gBAAgBD,EAAY/qB,KAAKA,KAAKuhB,MAAMlU,MAAMkV,QAEnDviB,KAAKkB,IAAIqT,SAASC,SAClBxU,KAAKuU,SAAW,IAAIlV,EAAIoV,SAASzU,OAGrCA,KAAK0U,MAAQ,CAAC,EAEd1U,KAAKirB,sBAELjrB,KAAKsf,aAAe,IAAIjgB,EAAI6rB,eAAelrB,MAE3CA,KAAKmrB,kBAAmB,EAKxBnrB,KAAK2D,IAAIC,WAAavE,EAAIgG,WAI1BrF,KAAK2D,IAAIynB,YAAc,IAAI/rB,EAAIgsB,KAAKC,YAAYtrB,MAIhDA,KAAKurB,sBAILvrB,KAAK2D,IAAI6nB,YAAYC,KAAKzrB,MAI1BA,KAAK2D,IAAI+nB,iBAAiBD,KAAKzrB,MAI/BA,KAAK2D,IAAIgoB,aAAetsB,EAAIgsB,KAAKO,iBAAiBC,YAAY7rB,KAAM,QACpEA,KAAK2D,IAAImoB,aAAezsB,EAAIgsB,KAAKO,iBAAiBC,YAAY7rB,KAAM,QAEpEA,KAAK+rB,gBAAgB,OACzB,EAEA1sB,EAAI4nB,OAAOjS,UAAUuW,oBAAsB,WACvC,IAAI9gB,GACJA,EAAM,IACF9F,KAAK3E,KAAKgsB,QAAQ,gBACtBvhB,EAAI9F,KAAK3E,KAAKgsB,QAAQ,sBACtBvhB,EAAI9F,KAAK,KACT8F,EAAI9F,KAAK,KACT3E,KAAKkB,IAAI+qB,mBAAqBxhB,CAClC,EAGApL,EAAImjB,YAAc,SAAUjE,EAAIsC,GAC5B,IAAIiC,EAAY,GACZoJ,EAAa,GACjB,SAASC,EAAUpV,GACfmV,EAAWvnB,KAAKoS,GAChB1X,EAAIsjB,WAAW3D,KAAKjI,EAAMwH,EAAIlf,EAAI0H,MAAO8Z,EAAQiC,EACrD,CACA,SAASsJ,IACL,IAAIrV,EAAOmV,EAAWlhB,MACtB3L,EAAIsjB,WAAW3D,KAAKjI,EAAMwH,EAAIlf,EAAI2H,IAAK6Z,EAAQiC,EACnD,CACA,SAASuJ,EAAWtV,GAChB1X,EAAIsjB,WAAW3D,KAAKjI,EAAMwH,EAAIlf,EAAI4H,UAAW4Z,EAAQiC,EACzD,CA6BA,OA5BA,SAASwJ,EAAYrZ,EAAO6D,EAAQoV,GAC3BA,IACDA,EAAa,IAEZjZ,IACDA,EAAQ,SAER,IAAuBA,EAAMvR,SAC7BuR,EAAQ,CAACA,IAEb,IAAK,IAAIzR,EAAE,EAAGA,EAAEyR,EAAMvR,OAAQF,IAAK,CAC/B,IAAIuV,EAAO9D,EAAMzR,GACgB,OAA7B+c,EAAG+C,OAAO9L,SAASuB,KAGnBD,GAAuC,SAA7ByH,EAAG+C,OAAO9L,SAASuB,KAC7B1X,EAAIgsB,KAAKkB,YAAYvN,KAAKT,EAAIzH,EAAQtV,EAAGuV,GACzCA,EAAOwH,EAAG+C,OAAOvM,SAAS+B,GAAQtV,IAElC+c,EAAG+C,OAAOjO,cAAckL,EAAG+C,OAAOvM,SAASgC,KAC3CoV,EAASpV,GACTuV,EAAW/N,EAAG+C,OAAOvM,SAASgC,GAAOA,EAAMmV,GAC3CE,KAEAC,EAAUtV,GAElB,CACJ,CAEJ,EAGA1X,EAAI4nB,OAAOjS,UAAUgW,gBAAkB,SAAUD,EAAYlK,GACpD7gB,KAAKshB,OAAOzL,aAAakV,IAGhB1rB,EAAImjB,YAAYxiB,KAAM6gB,EAOpC4B,MALI,IAAuBsI,EAAWrpB,OACzBqpB,EAEAA,EAAW,GAG5B,EAGA1rB,EAAI4nB,OAAOjS,UAAU+U,mBAAqB,WACtC,IAAWxW,EAAYkC,EASnB+W,EAAQ,CAAC,EAGb,IAAK/W,KAFL+W,EAAM9mB,KAAO1F,KAAKshB,OAAO9L,SAASxV,KAAKshB,OAAOtO,SAC9CO,EAAavT,KAAKshB,OAAO/N,WAAWvT,KAAKshB,OAAOtO,SAExCO,EAAW0P,eAAexN,IAE1BpW,EAAI6jB,WAAWzN,GAAUuJ,KAAKwN,EAAOxsB,KAAMuT,EAAWkC,GAGlE,EAEApW,EAAI4nB,OAAOjS,UAAUgX,QAAU,SAAUS,EAAMC,EAAMC,EAAQC,EAAQpf,EAAMqf,GAKvE,IAAItqB,EAJAkqB,GAAQA,EAAK/oB,MAAM,UAAY+oB,IAASA,EAAKrsB,gBAC7Cf,EAAIK,MAAM,2CAA2C+sB,GACrDA,EAAOA,EAAKnsB,eAIZiC,EADAsqB,EACO7sB,KAAKkB,IAAI,kBAAkB,GAE3BlB,KAAKkB,IAAIqB,KAEpB,IAAIkI,EAAMpL,EAAI4nB,OAAO6F,SAASztB,EAAI+J,MAAOpJ,KAAK2C,OAAOJ,GAAMwqB,MAAON,EAAMC,EAAMC,EAAQC,GAgBtF,OAdKniB,GAAgB,oBAATgiB,IACRhiB,EAAM,UAGS,IAARA,IACH+C,IAASnO,EAAIgK,OACbhK,EAAIE,MAAM,2BAA8BktB,EAAO,qBACxCjf,IAASnO,EAAIiK,WACpBmB,EAAM,KAGVA,IACAzK,KAAKC,IAAI+sB,sBAAuB,GAE7BviB,CACX,EAEApL,EAAI4nB,OAAOjS,UAAUiY,QAAU,SAAUP,EAAMG,GAC3C,IAAItqB,EAMJ,OAJIA,EADAsqB,EACO7sB,KAAKkB,IAAI,kBAETlB,KAAKkB,IAAIqB,OAEhBvC,KAAK2C,OAAOJ,GAAM2qB,MAAMR,IACjB1sB,KAAK2C,OAAOJ,GAAM2qB,MAAMR,EAIvC,EAEArtB,EAAI4nB,OAAOjS,UAAU6V,OAAS,SAAUsC,GACpC,YAAI,IAAuBntB,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAKuqB,IAChDntB,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAKuqB,EAI/C,EAIA9tB,EAAI4nB,OAAOjS,UAAUoY,YAAc,SAAUnpB,EAAMopB,EAASX,EAAMC,GAC9D,OAAOttB,EAAI4nB,OAAO6F,SAASztB,EAAI+J,MAAOnF,EAAMopB,EAASX,EAAMC,EAC/D,EAEAttB,EAAI4nB,OAAOjS,UAAUsY,WAAa,SAAUC,EAAWxX,GACnD,YAAI,IAAuBwX,EAChB,EAEAA,EAAUxX,EAEzB,EAEA1W,EAAI4nB,OAAO6F,SAAW,SAAUtf,EAAMggB,EAAMf,EAAMC,EAAMC,EAAQC,GAC5D,IAAIniB,EAAKgjB,EAAOC,EAAGva,EAAKC,EAAKua,EAE7B,GADAljB,EAAM,QACF,IAAuB+iB,EAAKf,GAAO,CACnC,GAAIjf,IAASnO,EAAIgK,OAGb,OAFAhK,EAAIE,MAAM,4BAA+BktB,EAAO,oBAIxD,CAgBA,IAdIkB,EADAf,GAAUY,EAAKf,GAAMG,GACVY,EAAKf,GAAMG,GAEXY,EAAKf,GAEpBgB,EAAQ,GACK,WAATf,EACAe,EAAQ,CAAC,SAAU,SACH,eAATf,EACPe,EAAQ,CAAC,aAAc,QACP,SAATf,IACPe,EAAQ,CAACf,IAGbtZ,GADAqa,EAAQA,EAAM3nB,OAAO,CAAC,UACVpE,OACPyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAE5B,GADAua,EAAID,EAAMta,GACN,iBAAoBwa,GAAY,iBAAoBA,EACpDljB,EAAMkjB,OACH,QAAI,IAAuBA,EAASD,GAAI,CAEvCjjB,EADA,iBAAoBkjB,EAASD,IAAM,iBAAoBC,EAASD,GAC1DC,EAASD,GAEX,iBAAoBf,EACdgB,EAASD,GAAGf,GAEZgB,EAASD,GAAG,GAG1B,KACJ,CAEJ,OAAOjjB,CACX,EAEApL,EAAI4nB,OAAOjS,UAAUiW,oBAAsB,WACvC,IAAU9X,EAAKC,EAGf,IADAA,EAAM/T,EAAIiJ,MAAM5G,OACXyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAAG,CAG/B,IAAIoP,EAASviB,KADNX,EAAIiJ,MAAM6K,IACOoP,OACxBviB,KAAK0iB,mBAAmBH,EAC5B,CAEA,OADAviB,KAAKiqB,QAAU5qB,EAAI4qB,QACZjqB,KAAKiB,KAChB,EAEA5B,EAAI4nB,OAAOjS,UAAU0N,mBAAqB,SAAUH,GAChD,IAAIqL,EAAkB5c,EAAO6c,EAAiB1O,EAAM2O,EAAaC,EAGjE,IAFAH,EAAmB,CAAC,OAAQ,QAAS,OAEhCzO,EADEoD,EAAO7gB,OAAS,EACLyd,GAAQ,EAAGA,IAAS,EAAG,CAOrC,GAHI,UAHJnO,EAAQuR,EAAOpD,IAGMzZ,MAAQrG,EAAI2H,MAAQgK,EAAM4R,YAC3CiL,EAAY,IAEZ,cAAgB7c,EAAMtL,MAAQsL,EAAMc,QAAQpM,KAE5C,IADAqoB,EAAQH,EAAiBlsB,OACpBosB,EAAQ,EAAGA,EAAQC,EAAOD,GAAS,EAC7BF,EAAiBE,KACX9c,EAAMc,QAAQpM,MACvBmoB,EAAUlpB,KAAKqM,EAAMc,QAAQpM,MAIrC,SAAWsL,EAAMtL,MAAQrG,EAAI0H,QAAUiK,EAAM4R,YAC7CiL,EAAU/iB,UACVkG,EAAM6c,UAAYA,GAEtB7c,EAAMoP,KAAQjB,EAAO,EACjBnO,EAAMtL,MAAQrG,EAAIyiB,KAAK9Q,EAAMtL,MAAMgjB,WACnCrpB,EAAIyiB,KAAK9Q,EAAMtL,MAAMgjB,UAAU1J,KAAKhO,EAAOhR,KAAMmf,EAEzD,CACJ,EAEA9f,EAAI4nB,OAAOjS,UAAUgZ,aAAe,SAAUC,GAE1C,IADA,IAAIxjB,EAAM,GACDjJ,EAAI,EAAGC,EAAOwsB,EAAIvsB,OAAQF,EAAIC,EAAMD,GAAK,EAC9CiJ,EAAI9F,KAAK3E,KAAKkuB,YAAY,GAAKD,EAAIzsB,KAEvC,OAAOiJ,CACX,EAEApL,EAAI8uB,UAAY,EAKhB9uB,EAAI4nB,OAAOjS,UAAUoZ,aAAe,SAAUC,GAC1C,IAAIpqB,EA+FIR,EA7FR,GAAKzD,KAAKC,IAAIquB,cAAcD,GAGxB,OAAOruB,KAAKyT,SAAS8a,QAAQF,GAGjC,GALIruB,KAAKC,IAAIquB,cAAcD,IAAM,EAK7BruB,KAAKkB,IAAIiC,uBAAuBqrB,kCAChC,kBAAqBxuB,KAAKkB,IAAIiC,uBAAuBqrB,iCAAkC,CAEvF,IAAK,IAAIhtB,EAAE,EAAEC,EAAKzB,KAAKkB,IAAI,kBAAkBQ,OAAQF,EAAEC,EAAMD,GAAG,EAC5DxB,KAAKkB,IAAI,kBAAkBM,GAAKxB,KAAKkB,IAAI,kBAAkBM,GAAGlB,cAElE,IAASkB,EAAE,EAAEC,EAAKzB,KAAKkB,IAAI,mBAAmBQ,OAAQF,EAAEC,EAAMD,GAAG,EAC7DxB,KAAKkB,IAAI,mBAAmBM,GAAKxB,KAAKkB,IAAI,mBAAmBM,GAAGlB,cAEpE,IAASkB,EAAE,EAAEC,EAAKzB,KAAKkB,IAAI,mBAAmBQ,OAAQF,EAAEC,EAAMD,GAAG,EAC7DxB,KAAKkB,IAAI,mBAAmBM,GAAKxB,KAAKkB,IAAI,mBAAmBM,GAAGlB,cAEpEN,KAAKkB,IAAIiC,uBAAuBqrB,iCAAmC,GACvE,CAQA,GALAnvB,EAAI8uB,WAAa,EAEjBlqB,EAAO0S,KAAKC,MAAMD,KAAK8X,UAAUzuB,KAAK4T,IAAIwa,aAAa,GAAKC,KAGxDruB,KAAKkB,IAAIiC,uBAAuBqrB,iCAAkC,CAClE,GAAIvqB,EAAKwH,MAAO,CACZ,GAAIxH,EAAKwH,MAAMC,MACX,IAAK,IAAIgjB,KAASzqB,EAAKwH,MAAMC,MACzB,IAAK,IAAIzG,KAAOhB,EAAKwH,MAAMC,MAAMgjB,GACzBzpB,IAAQA,EAAI3E,gBACZ2D,EAAKwH,MAAMC,MAAMgjB,GAAOzpB,EAAI3E,eAAiB2D,EAAKwH,MAAMC,MAAMgjB,GAAOzpB,UAC9DhB,EAAKwH,MAAMC,MAAMgjB,GAAOzpB,IAK/C,GAAIhB,EAAKwH,MAAMI,KACX,IAAK,IAAI6iB,KAASzqB,EAAKwH,MAAMI,KACzB5H,EAAKwH,MAAMI,KAAK6iB,GAASzqB,EAAKwH,MAAMI,KAAK6iB,GAAOpuB,aAG5D,CACA,IAASkB,EAAE,EAAGC,EAAKpC,EAAImG,eAAe9D,OAAQF,EAAEC,EAAMD,GAAG,EAAG,CACxD,IAAImtB,EAAQtvB,EAAImG,eAAehE,GAC/B,GAAIyC,EAAK0qB,IAAU1qB,EAAK0qB,GAAOljB,MAC3B,IAAK,IAAI3I,EAAE,EAAG4B,EAAKT,EAAK0qB,GAAOjtB,OAAQoB,EAAE4B,EAAM5B,GAAG,EAAG,CACjD,IAAI8rB,EAAU3qB,EAAK0qB,GAAO7rB,GAC1B,GAAI8rB,EAAQnjB,MAAO,CACf,GAAImjB,EAAQnjB,MAAMojB,KACd,IAAK,IAAI5pB,KAAO2pB,EAAQnjB,MAAMojB,KACtB5pB,IAAQA,EAAI3E,gBACZsuB,EAAQnjB,MAAMojB,KAAK5pB,EAAI3E,eAAiBsuB,EAAQnjB,MAAMojB,KAAK5pB,UACpD2pB,EAAQnjB,MAAMojB,KAAK5pB,IAIlC2pB,EAAQnjB,MAAMI,OACd+iB,EAAQnjB,MAAMI,KAAO+iB,EAAQnjB,MAAMI,KAAKvL,cAEhD,CACJ,CAER,CACJ,CAGI2D,EAAK6qB,UAAY7qB,EAAK6qB,SAASprB,MAAM,UAGxB,OADTD,EAAIQ,EAAK6qB,SAASprB,MAAM,oBACtB,IACFO,EAAK,iBAAmBR,EAAE,GAC1BQ,EAAK,0BAA4BR,EAAE,KAEnCQ,EAAK,iBAAmBR,EAAE,GAC1BQ,EAAK,0BAA4BR,EAAE,IAEnCzD,KAAKkB,IAAI6tB,aACL9qB,EAAK,4BACLA,EAAK6qB,SAAW7qB,EAAK,2BAGrBA,EAAK,mBACLA,EAAK6qB,SAAW7qB,EAAK,mBAK7BA,EAAK+qB,OACL/qB,EAAK,cAAgBA,EAAK+qB,KAGH,QADnBvrB,GADM,GAAKQ,EAAK+qB,MACRztB,MAAM,4BACZ,GAAGiC,OAAO,KACZS,EAAK,cAAgBR,EAAE,KAS/B,IAAK,IAAIwB,KALLjF,KAAKkB,IAAIiC,uBAAuB8rB,YAAchrB,EAAKG,MAEnD/E,EAAI2E,oBAAoBC,GAAM,EAAOjE,KAAKkB,IAAIiC,uBAAuB+rB,gCAGzDjrB,EACZ,GAAI5E,EAAI+F,eAAerC,QAAQkC,EAAInB,QAAQ,QAAS,MAAQ,EAAG,CAC3D,IAAIqrB,EAAUlrB,EAAKgB,GACfkqB,IAEInvB,KAAKkB,IAAIiC,uBAAuBisB,oBAC5BD,EAAQE,KAASF,EAAQ,eAAkD,IAAjCA,EAAQ,cAAcztB,SAChEytB,EAAUnvB,KAAK2D,IAAIC,WAAWC,kBAAkBsrB,EAAQE,OAGhEprB,EAAKgB,GAAOjF,KAAKsvB,eAAeH,GAExC,CAEJ,GAAInvB,KAAKkB,IAAIiC,uBAAuB+mB,yBAC5BjmB,EAAKkB,MAAQ,CAAC,OAAO,UAAU,cAAc,aAAa,UAAUpC,QAAQkB,EAAKkB,OAAS,EAAG,CAC7F,IAEIoqB,EAAiB,GACrB,IAAS/tB,EAAI,EAAGC,GAFZ+tB,EAAW,CAAC,OAAQ,QAAS,eAAgB,QAAS,SAAU,oBAEpC9tB,OAAQF,EAAIC,EAAMD,GAAK,EAE3DyC,EADQopB,EAAUmC,EAAShuB,KAE9B+tB,EAAe5qB,KAAKV,EAAKopB,IAI3B,IAAS7rB,EAAI,EAAGC,GADP+tB,EAAW,CAAC,gBAAiB,WACR9tB,OAAQF,EAAIC,EAAMD,GAAK,EAEpD,GAAIyC,EADQopB,EAAUmC,EAAShuB,KACVyC,EAAKopB,GAASvG,KAAM,CACxC,IAAI7V,EAAQhN,EAAKopB,GAASvG,KAC1ByI,EAAe5qB,KAAKsM,GACpB,KACD,CAEDhN,EAAKsrB,eAAiBA,EAAe5tB,KAAK,KACrC,CAEJ,GAAI3B,KAAKkpB,aAAahoB,IAAIuuB,uBAClBzvB,KAAKkpB,aAAahoB,IAAIuuB,sBAAsB1sB,QAAQkB,EAAKkB,OAAS,EAAG,CACrE,IAAIkoB,EACAmC,EACAE,EAAe,GACnB,IAASluB,EAAI,EAAGC,GAFZ+tB,EAAW,CAAC,OAAQ,kBAAmB,YAAa,YAExB9tB,OAAQF,EAAIC,EAAMD,GAAK,EAE3DyC,EADQopB,EAAUmC,EAAShuB,KAE9BkuB,EAAa/qB,KAAKV,EAAKopB,IAGzBppB,EAAKyrB,aAAeA,EAAa/tB,KAAK,KACjC,CAGJ,GAAI3B,KAAKkB,IAAIiC,uBAAuBmnB,oBAC5B,iBAAoBrmB,EAAK0O,YACzB1O,EAAK0O,UAAY,CACb,CACIlN,QAASxB,EAAK0O,UACdlH,MAAO,CACHojB,KAAM,CAAC,KAIf5qB,EAAKwH,OAASxH,EAAKwH,MAAMC,OAASzH,EAAKwH,MAAMC,MAAMiH,WAEnD,IAAK,IAAI1N,KADThB,EAAK0O,UAAU,GAAGlH,MAAMojB,KAAO,CAAC,EAChB5qB,EAAKwH,MAAMC,MAAMiH,UAC7B1O,EAAK0O,UAAU,GAAGlH,MAAMojB,KAAK5pB,GAAO,CAChCQ,QAASxB,EAAKwH,MAAMC,MAAMiH,UAAU1N,IAWxD,GAJKhB,EAAK,iBACNA,EAAK,eAAiBA,EAAK8H,YAG3B/L,KAAKkB,IAAIiC,uBAAuBumB,4BAA6B,CAC7D,IAAIte,EAAgF,OAA5DpL,KAAKkB,IAAI,kBAAkB,GAAGsC,MAAM,EAAG,GAAGlD,cAClEjB,EAAI8L,wBAAwB6T,KAAKhf,KAAMiE,EAAMmH,EACjD,CACA,IAMIukB,EANAC,EAAc,CAAC,OAAO,aAAa,cAAc,UAAU,cAAc7sB,QAAQkB,EAAKkB,OAAS,EAOnG,GANInF,KAAKkB,IAAIiC,uBAAuBmnB,oBAAsBsF,IACjD3rB,EAAK2O,eACN3O,EAAK2O,aAAe,QAIvBgd,GAAe3rB,EAAKhC,OAASjC,KAAK4T,IAAIsU,gBAAiB,CAEnDjkB,EAAK2O,eACI,EAGT+c,EADD3vB,KAAK4T,IAAIic,oBACQ7vB,KAAK4T,IAAIic,oBAAoB,QAAS5rB,EAAKhC,OAE5CgC,EAAKhC,MAEzB,IAAI2Q,EAAe5S,KAAKmoB,UAAU2H,iBAAiB7rB,EAAK2O,aAAc,QAAS+c,EAAe1rB,EAAK6qB,UAC/F9uB,KAAKmoB,UAAU4H,QAAQnd,GAAc3Q,OACjCjC,KAAKmoB,UAAU4H,QAAQnd,GAAc3Q,MAAM0tB,KAC3C1rB,EAAK,eAAiBjE,KAAKmoB,UAAU4H,QAAQnd,GAAc3Q,MAAM0tB,GAG7E,CAIA,GAHK1rB,EAAK,2BACNA,EAAK,yBAA2BA,EAAK+rB,qBAErC/rB,EAAK,oBAAsBjE,KAAK4T,IAAIsU,gBAAiB,CAEjDyH,EADA3vB,KAAK4T,IAAIic,oBACO7vB,KAAK4T,IAAIic,oBAAoB5rB,EAAK,oBAElCA,EAAK,mBAErB2O,EAAe5S,KAAKmoB,UAAU2H,iBAAiB7rB,EAAK2O,aAAc,kBAAmB+c,EAAe1rB,EAAK6qB,UACzG9uB,KAAKmoB,UAAU4H,QAAQnd,GAAc,oBACjC5S,KAAKmoB,UAAU4H,QAAQnd,GAAc,mBAAmB+c,KACxD1rB,EAAK,yBAA2BjE,KAAKmoB,UAAU4H,QAAQnd,GAAc,mBAAmB+c,GAGpG,CAIA,GAHI1rB,EAAK2O,eACL3O,EAAK3B,QAAU2B,EAAK2O,aAAarR,MAAM,KAAK,IAE5CvB,KAAKyT,SAAS8a,QAAQF,IACtB,GAAI1X,KAAK8X,UAAUzuB,KAAKyT,SAAS8a,QAAQF,KAAQ1X,KAAK8X,UAAUxqB,GAAO,CACnE,IAAK,IAAIgB,KAAOjF,KAAKyT,SAAS8a,QAAQF,UAC3BruB,KAAKyT,SAAS8a,QAAQF,GAAIppB,GAErCjF,KAAKC,IAAIgwB,eAAehsB,EAAKoqB,KAAM,EACnCha,OAAOC,OAAOtU,KAAKyT,SAAS8a,QAAQF,GAAKpqB,EAC7C,OAEAjE,KAAKyT,SAAS8a,QAAQF,GAAMpqB,EAEhC,OAAOjE,KAAKyT,SAAS8a,QAAQF,EACjC,EAEAhvB,EAAI4nB,OAAOjS,UAAUkZ,YAAc,SAAUG,GACzC,OAAOruB,KAAKyT,SAAS8a,QAAQF,EACjC,EAGAhvB,EAAI4nB,OAAOjS,UAAUkb,OAAS,SAAUlf,EAAOtL,EAAMuL,GAC9B,UAAfD,EAAMtL,MAAmC,aAAfsL,EAAMtL,MAChC1F,KAAKkB,IAAIivB,oBAAoBzqB,GAAQuL,EACrCjR,KAAKgpB,SAAS9nB,IAAIivB,oBAAoBzqB,GAAQuL,EAC9CjR,KAAKkpB,aAAahoB,IAAIivB,oBAAoBzqB,GAAQuL,GAC3C,CAAC,WAAY,gBAAgBlO,QAAQiO,EAAMtL,OAAS,EAC3D1F,KAAKgR,EAAMtL,MAAMxE,IAAIivB,oBAAoBzqB,GAAQuL,EAEjDD,EAAMc,QAAQpM,GAAQuL,CAE9B,EAGA5R,EAAI4nB,OAAOjS,UAAUob,WAAa,SAAUpf,EAAOyE,EAAU4a,EAAYC,GACrE,QAAI,IAAuBtf,EAAMc,QAAQ2D,GACrC,OAAOzE,EAAMc,QAAQ2D,GAErB,IAAI8a,EAAcvwB,KAAKA,KAAKC,IAAIqiB,MAAMphB,IAAIivB,oBAAoBE,GAA0B5a,GACxF,YAAI,IAAuB8a,EAChBA,EAEAD,CAGnB,EAEAjxB,EAAI4nB,OAAOjS,UAAUwb,qBAAuB,SAAUC,GAUlD,IAAK,IAAIjvB,EAAI,EAAGC,EAAOgvB,EAAU/uB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACvD,IAAIyC,EAAOwsB,EAAUjvB,GAAG,GACpB0B,EAAOutB,EAAUjvB,GAAG,GAExB,GAAI,CAAC,OAAO,UAAU,cAAc,aAAa,UAAUuB,QAAQkB,EAAKkB,OAAS,EAAG,CAGhF,GAAIjC,EAAKG,QACLH,EAAKG,QAAUH,EAAKG,QAAQuB,QACxBnB,EAAIP,EAAKG,QAAQK,MAAMrE,EAAIqB,qCAEvBwC,EAAKwtB,MACLxtB,EAAKG,QAAUhE,EAAIuB,+BAA+BsC,EAAKwtB,OAAS,IAAMxtB,EAAKG,QAE3EH,EAAKG,QAAU,MAAQH,EAAKG,SAMxC,IAAIstB,EAAqB,KACzB,GAAI1sB,EAAK2sB,QACL3sB,EAAK2sB,QAAU3sB,EAAK2sB,QAAQhsB,QACxBnB,EAAIQ,EAAK2sB,QAAQltB,MAAMrE,EAAIqB,mCAK3BiwB,EAAqBltB,EAAE,GAAGmB,QAH1BX,EAAK2sB,QAAU,QAAU3sB,EAAK2sB,QAC9BD,EAAqB,QAO7B,GAAI1sB,EAAK2sB,QAGL,GAAK1tB,EAAKG,QAEH,CAIH,IAAII,EACAotB,EAAQ,KADRptB,EAAIP,EAAKG,QAAQK,MAAM,qBAGV,OAATD,EAAE,IAAsC,OAAvBktB,IACjBztB,EAAKG,QAAUI,EAAE,IAEjB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAKV,QAAQG,EAAKG,QAAQG,MAAM,EAAG,KAAO,IACzEqtB,EAAQ,KAGbA,EAAQ,GAEX3tB,EAAKG,QAAUY,EAAK2sB,QAAUC,EAAQ3tB,EAAKG,OAC/C,MAlBIH,EAAKG,QAAUY,EAAK2sB,QAqB5B1tB,EAAKwtB,MAAQ,EAEjB,CACJ,CACJ,EAGArxB,EAAI4nB,OAAOjS,UAAU8b,gBAAkB,SAAU7sB,GAC5C,GAAIA,EAAKjC,QACH,CAAC,OAAQ,UAAW,cAAc,aAAa,UAAUe,QAAQkB,EAAKkB,OAAS,GAC/EnF,KAAKkB,IAAIiC,uBAAuB+mB,0BAC/BlqB,KAAKC,IAAI8wB,eAAuB,OAAG,CAEvC/wB,KAAKC,IAAI8wB,eAAuB,OAAI,CAAC,EACrC/wB,KAAKC,IAAI8wB,eAAuB,OAAEC,OAAS,GAC3ChxB,KAAKC,IAAI8wB,eAAuB,OAAEpE,OAAS,EAC3C3sB,KAAKC,IAAI8wB,eAAuB,OAAEpS,SAAU,EAC5C3e,KAAKC,IAAI8wB,eAAuB,OAAEL,OAAQ,EAG1C,IAAIzf,EAAQ,GAAKhN,EAAKjC,OAGlBivB,GAFJhgB,EAAQA,EAAM1P,MAAM,MAAMI,KAAK,KAETJ,MAAM,OAAO,GAC/B2vB,EAAa7xB,EAAIsB,uBAAuBswB,GAC5C,GAAIC,EAAY,CAEZ,IAAIzsB,EAAOwM,EAAM1P,MAAMlC,EAAIoB,4BAC3B,GAAIgE,EAAK/C,OAAS,EAAG,CAGjB,IADA,IAAIJ,EAAM,GACDwB,EAAE,EAAG4B,EAAKD,EAAK/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC3CxB,EAAIqD,KAAKF,EAAK3B,GAAGgB,QAAQ,OAAQ,IAAIA,QAAQ,OAAQ,KAGzDmN,EAAQ3P,EAAIK,KAAK,IACrB,MACIsP,EAAQxM,EAAK,GAEjBzE,KAAKC,IAAI8wB,eAAuB,OAAEL,MAAQQ,EAC1ClxB,KAAKC,IAAI8wB,eAAuB,OAAEC,OAAOrsB,KAAK,CAAC,OAAQsM,GAAO,IAC9DjR,KAAKC,IAAI8wB,eAAuB,OAAEpS,SAAU,CAChD,MACI3e,KAAKC,IAAI8wB,eAAuB,OAAEC,OAAOrsB,KAAK,CAAC,OAAQsM,GAAO,IAC9DjR,KAAKC,IAAI8wB,eAAuB,OAAEpS,SAAU,CAEpD,CACJ,EAIAtf,EAAI8xB,cAAgB,SAAUC,GAC1B,OAAO,SAAUnwB,EAAOowB,GACpB,OAAKA,EAIMD,EAASttB,QAAQ,aAAcutB,GAH/B,EAKf,CACJ,EAcAhyB,EAAIiyB,cAAgB,SAAUF,GAC1B,OAAO,SAAUzR,GACb,IAAI4R,EAAYH,EAASttB,QAAQ,YAAa6b,GAC9C,OAAO,SAAU1e,EAAOowB,GACpB,OAAKA,EAIME,EAAUztB,QAAQ,aAAcutB,GAHhC,EAKf,CACJ,CACJ,EAOAhyB,EAAImyB,KAAO,SAAUhkB,GACjB,IAAImE,EAAa8f,EAAQ9R,EAAO8B,EAAMvc,EAAKwsB,EAG3C,IAAK/R,KAFLhO,EAAc,CAAC,EACf8f,EAASpyB,EAAI2N,OAAOU,QAAQF,GAIhB,MAAQmS,EAAMnc,MAAM,EAAG,IAI3Bie,GAAO,EACPvc,EAAMusB,EAAO9R,GACb+R,EAAO/R,EAAMpe,MAAM,KAEA,iBAAR2D,GAAoBA,EAAInC,QAAQ,eAAiB,EAEpD0e,EADAvc,EAAInC,QAAQ,cAAgB,EACrB1D,EAAIiyB,cAAcpsB,GAElB7F,EAAI8xB,cAAcjsB,GAEP,kBAARA,GAAsBA,EAEd,mBAARA,EACduc,EAAOvc,EAEP7F,EAAIE,MAAM,OAASiO,EAAO,qBAAuBmS,EAAQ,KAAOza,GAJhEuc,EAAOpiB,EAAI2N,OAAOC,WAAW0kB,YAOb,IAAhBD,EAAKhwB,OACLiQ,EAAY+f,EAAK,IAAMjQ,EACA,IAAhBiQ,EAAKhwB,SACPiQ,EAAY+f,EAAK,MAClB/f,EAAY+f,EAAK,IAAM,CAAC,GAE5B/f,EAAY+f,EAAK,IAAIA,EAAK,IAAMjQ,IA3BhC9P,EAAYgO,GAAS8R,EAAO9R,GA+BxC,OAAOhO,CACX,EAgBAtS,EAAI2jB,eAAiB,SAAU/hB,EAAOsS,GAClC,IAAI9I,EAAU0I,EAGd,IAAKA,KADL1I,EAAM,GACMpL,EAAIuO,oBAAqB,CAE7B,IAAI3I,EACAsO,EADAtO,EAAM5F,EAAIuO,oBAAoBuF,MAE9B1I,EAAI9F,KAAK,CAACM,EAAKsO,EAAWtO,YACnBsO,EAAWtO,GAG9B,CACA,OAAOwF,CACX,EAEApL,EAAIuyB,SAAW,SAASC,EAAQC,GAC5B,IAAIC,EAAW,IAAIvxB,OAAO,IAAMqxB,EAAS,IAAK,KAC1CG,EAAW,IAAIxxB,OAAOqxB,EAAQ,KAClC7xB,KAAKuB,MAAQ,SAAU/B,GAEfsyB,IACAtyB,EAAMsyB,EAActyB,IAExB,IAAIkE,EAAQlE,EAAIkE,MAAMquB,GACtB,IAAKruB,EACD,MAAO,CACHuuB,KAAM,GACNngB,QAAS,CAACtS,IAIlB,IADA,IAAI+B,EAAQ/B,EAAI+B,MAAMywB,GACbxwB,EAAEkC,EAAMhC,OAAO,EAAGF,GAAI,EAAGA,IAAK,CACX,iBAAbkC,EAAMlC,KACbkC,EAAMlC,GAAK,IAGH,MADFkC,EAAMlC,IACID,EAAMC,EAAE,GAAGE,OAAS,IAEpCH,EAAMC,EAAE,GAAKkC,EAAMlC,GAAKD,EAAMC,EAAE,GAChCkC,EAAMlC,GAAK,GAEnB,CACA,MAAO,CACHywB,KAAMvuB,EACNoO,QAASvQ,EACT2wB,YAAa3wB,EAAMiC,QAE3B,EACAxD,KAAK2B,KAAO,SAAUwX,GAElB,IADA,IAAI7X,EAAM6X,EAAIrH,QAAQtO,OAAO,GACpBhC,EAAE2X,EAAI8Y,KAAKvwB,OAAO,EAAGF,GAAG,EAAGA,IAChCF,EAAIqD,KAAKwU,EAAI8Y,KAAKzwB,IAClBF,EAAIqD,KAAKwU,EAAIrH,QAAQtQ,IAGzB,OADAF,EAAIwJ,UACGxJ,EAAIK,KAAK,GACpB,CACJ,EAEAtC,EAAI4nB,OAAOjS,UAAUmd,oBAAsB,SAAUC,EAAMX,GAEvD,GAAkB,WAAdA,EAAO,GAAiB,CAQxB,IAPA,IACIY,EADAC,GAAY,EAOPva,GAJLsa,EADkB,aAAlBryB,KAAKC,IAAIoN,KACO,CAACrN,KAAKgpB,SAAS9nB,IAAIqxB,oBAAoBzsB,OAAOssB,EAAKI,UAEnDJ,EAAKI,UAEE9wB,OAAS,EAAGqW,GAAK,EAAGA,IAAM,EAEjD,IAAK,IAAI0a,EAAIJ,EAActa,GAAGrW,OAAS,EAAG+wB,GAAK,EAAGA,IAAM,EAEhDJ,EAActa,GAAG0a,GAAG,KAAOhB,EAAO,IAEH,WAA3BY,EAActa,GAAG0a,GAAG,KACpBH,GAAY,GAK5B,IAAKA,EACD,OAAO,CAEf,CACA,OAAO,CACX,EAKAjzB,EAAI4nB,OAAOjS,UAAU0d,iBAAmB,SAAUzuB,GAC9C,IAAIysB,EAAQ,GACRe,EAASzxB,KAAK2yB,oBACdlT,EAASgS,EAAO,GAChBmB,EAAS5yB,KAAKgsB,QAAQ,YAAa,QAAS,QAC5C,IAAuB4G,IACvBA,EAAS,aAGbA,GADAA,EAASA,EAAO9uB,QAAQ,IAAK,KACbN,MAAM,EAAG,GAAGpD,cAAgBwyB,EAAOpvB,MAAM,GACzD,IAAK,IAAIhC,EAAI,EAAGC,EAAOpC,EAAImG,eAAe9D,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAChE,IAAIixB,EAAIpzB,EAAImG,eAAehE,GAC3B,GAAIyC,EAAKwuB,GAAI,CACT,IAAI1tB,EAAQd,EAAKwuB,GAEbhT,EADA1a,EAAMrD,OAAS+vB,EAAO/vB,OACb+vB,EAAOA,EAAO/vB,OAAS,GAEvB+vB,EAAO1sB,EAAMrD,OAAS,GAEnC,IAAK,IAAIoB,EAAI,EAAG4B,EAAOK,EAAMrD,OAAQoB,EAAI4B,GACjC5B,IAAM2c,EAAOoT,QAAQnxB,OADkBoB,GAAK,EAAG,CAInD,IACI4C,EADM1F,KAAK8yB,WAAWC,QAAQhuB,EAAMjC,GAAI,mBAAmB,GAChD4C,KACXA,GAAQA,EAAKC,OAEbitB,GADAA,EAASltB,EAAKC,QACE7B,QAAQ,wBAAyB,IAE1C4B,GAAQA,EAAKD,UACpBmtB,EAASltB,EAAKD,SAElB,IAAIhC,EAAImvB,EAAOtyB,cAAcoD,MAAM,wBAKnC,GAJID,IACAmvB,EAASA,EAAOpvB,MAAMC,EAAE,GAAG/B,WAE/BkxB,EAASA,EAAO9uB,QAAQzE,EAAIuK,sBAAuB,KAE/C,OAEJgpB,EAASA,EAAOpvB,MAAM,EAAGic,EAAOoT,QAAQ/vB,KAC7BpB,OAAS,EAChBkxB,EAASA,EAAOpvB,MAAM,EAAG,GAAGpD,cAAgBwyB,EAAOpvB,MAAM,GAAGlD,cACnC,IAAlBsyB,EAAOlxB,SACdkxB,EAASA,EAAOxyB,eAEpBswB,GAASkC,CACb,CACA,KACJ,CACJ,CACA,IAAKlC,GAEGzsB,EAAKhC,MAAO,CACZ,IAAI+wB,EAAYhzB,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAK,cAC5CtB,EAAM2C,EAAKhC,MAAMV,MAAM,OAC3B,IAASC,EAAIF,EAAII,OAAS,EAAGF,GAAK,EAAGA,IAC7BwxB,EAAUjwB,QAAQzB,EAAIE,KAAO,IAC7BF,EAAMA,EAAIkC,MAAM,EAAGhC,GAAGsE,OAAOxE,EAAIkC,MAAMhC,EAAI,KAGnD,IAAIhC,EAAM8B,EAAIK,KAAK,KACnBnC,EAAMA,EAAIgE,MAAM,EAAGiuB,EAAO,GAAGoB,QAAQ,KAC7BnxB,OAAS,EACblC,EAAMA,EAAIgE,MAAM,EAAG,GAAGpD,cAAgBZ,EAAIgE,MAAM,GAAGlD,cAC7B,IAAfd,EAAIkC,SACXlC,EAAMA,EAAIY,eAEdswB,EAAQlxB,CACZ,CAEJ,IAAIsnB,EAAO,OAQX,OAPI7iB,EAAKgvB,QACDhvB,EAAKgvB,OAAOnM,OACZA,EAAO,GAAK7iB,EAAKgvB,OAAOnM,MAIhC4J,GADA5J,EAAOA,EAAKtjB,OAAsB,EAAfic,EAAOqH,KAG9B,EAEAznB,EAAI4nB,OAAOjS,UAAU2d,kBAAoB,WACrC,IAAIlB,EAAS,GACTyB,EAAOlzB,KAAKkB,IAAIiyB,SAAS5xB,MAAM,KAC9BvB,KAAKkB,IAAIiyB,UAA6C,MAAjCnzB,KAAKkB,IAAIiyB,SAAS3vB,MAAM,EAAE,IAChDnE,EAAIE,MAAM,4BAA4BS,KAAKkB,IAAIiyB,UAEnD,IAAK,IAAI3xB,EAAI,EAAGC,EAAOyxB,EAAKxxB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAGlD,IAFA,IAAIhC,EAAM0zB,EAAK1xB,GACXie,EAAS,CAACoT,QAAQ,GAAI/L,KAAK,GACtBhkB,EAAI,EAAG4B,EAAOlF,EAAIkC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC9C,OAAQtD,EAAIgE,MAAMV,EAAEA,EAAE,IACtB,IAAK,IACD2c,EAAOoT,QAAQluB,KAAK,GACpB,MACJ,IAAK,IACD8a,EAAOoT,QAAQpT,EAAOoT,QAAQnxB,OAAS,IAAM,EAC7C,MACJ,IAAK,IACD+d,EAAOqH,MAAQ,EACf,MACJ,QACIznB,EAAIE,MAAM,6CAA6CS,KAAKkB,IAAIiyB,UAGxE1B,EAAO9sB,KAAK8a,EAChB,CACA,OAAOgS,CACX,EAIApyB,EAAI4nB,OAAOjS,UAAU+W,gBAAkB,SAAUve,GAC7CxN,KAAKkB,IAAIsM,KAAOA,EAChBxN,KAAK2D,IAAIyvB,SAAW/zB,EAAImyB,KAAKhkB,GACxBxN,KAAKspB,OAAO9b,KACbxN,KAAKspB,OAAO9b,GAAQ,CAAC,EACrBxN,KAAKspB,OAAO9b,GAAMvN,IAAM,CAAC,EAEjC,EAEAZ,EAAI4nB,OAAOjS,UAAUqe,YAAc,WAC/B,OAAO,SAAUvU,EAAEC,GAGf,OAFAD,EAAIA,EAAEvd,MAAM,KACZwd,EAAIA,EAAExd,MAAM,KACRud,EAAEpd,OAASqd,EAAErd,OACN,EACAod,EAAEpd,OAASqd,EAAErd,QACZ,GAERod,EAAIA,EAAEtb,OAAO,GAAG,GAChBub,EAAIA,EAAEvb,OAAO,GAAG,GACZsb,EAAEpd,OAASqd,EAAErd,OACN,EACAod,EAAEpd,OAASqd,EAAErd,QACZ,EAED,EAGnB,CACJ,EAEArC,EAAI4nB,OAAOjS,UAAUse,sBAAwB,SAAUrB,GACnD,IAAIzwB,EAAGC,EACP,GAAIwwB,EAEA,IADAjyB,KAAKkB,IAAI,eAAiB,GACrBM,EAAI,EAAGC,EAAOwwB,EAAKvwB,OAAQF,EAAIC,EAAMD,GAAK,EAC3CxB,KAAKkB,IAAI,eAAeyD,KAAKstB,EAAKzwB,IAG1CxB,KAAKkB,IAAI,eAAeqyB,KAAKvzB,KAAKqzB,cACtC,EAEAh0B,EAAI4nB,OAAOjS,UAAUwe,iCAAmC,SAAUvB,GAC9D,IAAIzwB,EAAGC,EAEP,GADAzB,KAAKkB,IAAI,mBAAqB,GAC1B+wB,EACA,IAAKzwB,EAAI,EAAGC,EAAOwwB,EAAKvwB,OAAQF,EAAIC,EAAMD,GAAK,EAC3CxB,KAAKkB,IAAI,mBAAmByD,KAAKstB,EAAKzwB,IAG9CxB,KAAKkB,IAAI,mBAAmBqyB,KAAKvzB,KAAKqzB,cAC1C,EAEAh0B,EAAI4nB,OAAOjS,UAAUye,6BAA+B,SAAUxB,GAC1D,IAAIzwB,EAAGC,EAEP,GADAzB,KAAKkB,IAAI,mBAAqB,GAC1B+wB,EACA,IAAKzwB,EAAI,EAAGC,EAAOwwB,EAAKvwB,OAAQF,EAAIC,EAAMD,GAAK,EAC3CxB,KAAKkB,IAAI,mBAAmByD,KAAKstB,EAAKzwB,IAG9CxB,KAAKkB,IAAI,mBAAmBqyB,KAAKvzB,KAAKqzB,cAC1C,EAEAh0B,EAAI4nB,OAAOjS,UAAU0e,qBAAuB,SAAUva,EAAKwa,GACvD,IAAIzyB,EAAMlB,KAAKkB,IAAI,mBACdyyB,IACDA,EAAO,SAAU1uB,GACb,OAAOA,EAAI3E,aACf,GAIJ,IAFA,IAAIgL,EAAW,CAAC,UAAW,eAAgB,SAAU,WAAY,aAAc,UAEtE9J,EAAI,EAAGC,EAAO6J,EAAS5J,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACtD,IAAIoyB,EAAgBD,EAAKroB,EAAS9J,IAC9BqyB,EAAkBvoB,EAAS9J,GAAGlB,cAClC,GAAK6Y,EAAIya,GAAT,CAQA,IADA,IAAIE,EAAc,GACX3a,EAAIya,GAAelyB,OAAS,GAC/BoyB,EAAYnvB,KAAKwU,EAAIya,GAAe5oB,OAExC,IAAI+oB,EAAU,CAACjO,KAAK,EAAEkO,SAAS,EAAEC,SAAS,GAI1C,IAH2B,IAAvBH,EAAYpyB,QAAgBqyB,EAAQD,EAAY,IAAMC,EAAQD,EAAY,KAC1EA,EAAYhpB,UAETgpB,EAAYpyB,QACfyX,EAAIya,GAAejvB,KAAKmvB,EAAY9oB,OAMxC,IADA,IAAI1J,EAAMJ,EAAI2yB,GACPvyB,EAAII,QACPJ,EAAI0J,MAER,IAAK,IAAIlI,EAAI,EAAG4B,EAAOyU,EAAIya,GAAelyB,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC7DxB,EAAIqD,KAAKwU,EAAIya,GAAe9wB,GAxBhC,CA0BJ,CACJ,EAEAzD,EAAI4nB,OAAOjS,UAAUkf,2BAA6B,SAAUC,GACxD,GAAIA,GAAkC,KAArBA,EAAUzyB,OAAe,CAMtC,IALA,IAIIuP,EAJAmjB,EAAUp0B,KAAKkB,IAAImzB,YACnBC,EAAQ,EACRC,EAAW,CAAC,UAAW,eAAgB,SAAU,WAAY,aAAc,UAC3E9G,EAAQ,CAAC,WAAY,OAAQ,WAAY,YAEpCjsB,EAAI,EAAGC,EAAO8yB,EAAS7yB,OAAQF,EAAIC,EAAMD,GAAK,EACnD,IAAK,IAAIsB,EAAI,EAAG4B,EAAO+oB,EAAM/rB,OAAQoB,EAAI4B,EAAM5B,GAAK,EAChDmO,EAAQ,GACHqjB,EAAQ,GAAO,IACXF,EAAQG,EAAS/yB,IAAI,UAAUisB,EAAM3qB,IAAIkD,QACtCouB,EAAQG,EAAS/yB,IAAI,UAAUisB,EAAM3qB,IAAI2D,UAQjDwK,EAAQkjB,EAAUG,GAASH,EAAUG,GAAS,GAC9CF,EAAQG,EAAS/yB,IAAI,UAAYisB,EAAM3qB,IAAIkD,OAASiL,EACpDA,EAAQkjB,EAAUG,GAASH,EAAUG,EAAQ,GAAK,GAClDF,EAAQG,EAAS/yB,IAAI,UAAYisB,EAAM3qB,IAAI2D,OAASwK,GAExDqjB,GAAS,EAGjBt0B,KAAKkB,IAAImzB,YAAcD,CAC3B,CACJ,EAEA/0B,EAAI4nB,OAAOjS,UAAUwf,6BAA+B,SAAUrH,GAEtDntB,KAAKkB,IAAI,2BADTisB,CAKR,EAEA9tB,EAAI4nB,OAAOjS,UAAUyf,iBAAmB,SAAUtH,GAC1CntB,KAAK4T,IAAI6gB,kBACTz0B,KAAK4T,IAAI6gB,iBAAiBtH,EAElC,EAEA9tB,EAAI4nB,OAAOjS,UAAU0f,+BAAiC,SAAUvH,GAC5DntB,KAAKgpB,SAAS9nB,IAAIyzB,8BAAgCxH,CACtD,EAIA9tB,EAAI2N,OAAS,CAAC,EAKd3N,EAAI2N,OAAOuc,MAAQ,SAAUtoB,GACzBjB,KAAK40B,UAAY,CAAC,OAClB50B,KAAKiB,MAAQA,EACbjB,KAAK60B,MAAQ,GACb70B,KAAK80B,MAAQ,IAAIz1B,EAAI8hB,MAAM,SAC3B,IAAI4T,EAAa,CAAC,EAClBA,EAAWD,MAAQ90B,KAAK80B,MACxB90B,KAAKg1B,QAAU,IAAI31B,EAAI41B,MAAMF,GAC7B/0B,KAAKk1B,QAAU,IAAI71B,EAAI41B,MAAMj1B,KAAK60B,MACtC,EAOAx1B,EAAI2N,OAAOuc,MAAMvU,UAAUhK,IAAM,WAG7B,IAAImqB,EAAOn1B,KAAKk1B,QAAQjkB,QACxB,OAAIkkB,EAAKzzB,OACEyzB,EAAKnqB,MAELmqB,EAAKC,MAAMpqB,KAE1B,EAEA3L,EAAI2N,OAAOuc,MAAMvU,UAAUqgB,SAAW,SAAU3vB,GAE5C,OADU1F,KAAKg1B,QAAQ/jB,QAAQvL,EAEnC,EAEArG,EAAI2N,OAAOuc,MAAMvU,UAAUsgB,kBAAoB,SAAUC,EAAMC,GAC3D,IAAIC,EAAYC,EAAgBjrB,EAIhC,GADAA,EAFAgrB,EAAaz1B,KAAKg1B,QAAQ/jB,QAAQskB,GAClCG,EAAiB11B,KAAKg1B,QAAQ/jB,QAAQukB,GAElB,CACXC,KACDA,EAAa,IAAIp2B,EAAI8hB,MAAMoU,EAAMl2B,EAAI4H,YAC1B0K,YAAc,IAE7BlH,EAAM,IAAIpL,EAAI8hB,MAAMoU,EAAMl2B,EAAI4H,WAC9B,IAAIhC,EAAM,GACV,IAAK,IAAIA,KAAOwwB,EAAW3jB,QACnB2jB,EAAW3jB,QAAQmR,eAAehe,KAClCwF,EAAIqH,QAAQ7M,GAAOwwB,EAAW3jB,QAAQ7M,IAG9C,IAAK,IAAIA,KAAOywB,EAAe5jB,QACvB4jB,EAAe5jB,QAAQmR,eAAehe,KACtCwF,EAAIqH,QAAQ7M,GAAOywB,EAAe5jB,QAAQ7M,IAGlDwF,EAAIkH,YAAc8jB,EAAW9jB,YAAY7L,OAAO4vB,EAAe/jB,YACnE,CACA,OAAOlH,CACX,EAGApL,EAAI2N,OAAOuc,MAAMvU,UAAU2gB,SAAW,SAAUjwB,EAAM8vB,EAAUxkB,GAC5D,IAAI4kB,EAAQzf,EAKZ,GAJAyf,EAAS,IAAIv2B,EAAI8hB,MAAM,UACnB,iBAAoBnQ,IACpBA,EAAQhR,KAAKg1B,QAAQ/jB,QAAQD,IAE7BA,GAASA,EAAMc,QAAS,CACxB,IAAKqE,KAAQnF,EAAMc,QACXd,EAAMc,QAAQmR,eAAe9M,KAC7Byf,EAAO9jB,QAAQqE,GAAQnF,EAAMc,QAAQqE,IAG7Cyf,EAAOjkB,YAAcX,EAAMW,WAE/B,CACI,iBAAoB6jB,IACpBI,EAAO9jB,QAAQ+F,UAAY2d,GAE/Bx1B,KAAKg1B,QAAQ/jB,QAAQvL,GAAQkwB,CACjC,EAKAv2B,EAAI2N,OAAOuc,MAAMvU,UAAU6gB,YAAc,SAAUd,GAC1CA,IACDA,EAAa,CAAC,GAElBA,EAAWD,MAAQ90B,KAAK80B,MACxB90B,KAAKg1B,QAAQrwB,KAAKowB,EACtB,EAGA11B,EAAI2N,OAAOuc,MAAMvU,UAAU8gB,WAAa,WACpC91B,KAAKg1B,QAAQhqB,KACjB,EAEA3L,EAAI2N,OAAOuc,MAAMvU,UAAU+gB,SAAW,SAAUrwB,EAAMsL,GAClD,IAAI+jB,EAAa,CAAC,EACd/0B,KAAKiB,MAAMhB,IAAI,0BAA4BD,KAAKiB,MAAMhB,IAAIyhB,YAC1D1Q,EAAQhR,KAAK80B,MACbpvB,EAAO,SAEXqvB,EAAWrvB,GAAQsL,EACnBhR,KAAK61B,YAAYd,GACjB/0B,KAAKg2B,UAAUtwB,EACnB,EAEArG,EAAI2N,OAAOuc,MAAMvU,UAAUihB,OAAS,SAAUvwB,GAC1C1F,KAAKk2B,WAAWxwB,GAChB1F,KAAK81B,YACT,EAOAz2B,EAAI2N,OAAOuc,MAAMvU,UAAUghB,UAAY,SAAUhlB,GAC7C,IAAIohB,EAAM+D,EACN,iBAAoBnlB,EAEpBohB,EAAO,IAAI/yB,EAAI+2B,UAAKC,EAAWrlB,QACxB,IAAuBA,EAC9BohB,EAAO,IAAI/yB,EAAI+2B,UAAKC,EAAWr2B,KAAKg1B,QAAQ/jB,QAAQ6jB,MAAO,UAEtD90B,KAAKg1B,QAAQ/jB,SAAYjR,KAAKg1B,QAAQ/jB,QAAQD,IAC/C3R,EAAIE,MAAM,0DAA6DyR,EAAQ,KAGnFohB,EAAO,IAAI/yB,EAAI+2B,UAAKC,EAAWr2B,KAAKg1B,QAAQ/jB,QAAQD,GAAQA,IAEhEmlB,EAAOn2B,KAAKk1B,QAAQjkB,SACfjR,KAAKiB,MAAMhB,IAAIq2B,cAAgBt2B,KAAKgB,mBACrCoxB,EAAKtgB,QAAQ9L,OAAShG,KAAKgB,iBAAiBK,OAAO+wB,EAAKtgB,QAAQ9L,SAEpEmwB,EAAKxxB,KAAKytB,GACVpyB,KAAKk1B,QAAQvwB,KAAKytB,EACtB,EAKA/yB,EAAI2N,OAAOuc,MAAMvU,UAAUkhB,WAAa,SAAUxwB,GAO1CA,GAAQA,IAAS1F,KAAKk1B,QAAQjkB,QAAQ2jB,WACtCv1B,EAAIE,MAAM,iCAAmCmG,EAAO,cAAgB1F,KAAKk1B,QAAQjkB,QAAQ2jB,WAE7F,IAAIxC,EAAOpyB,KAAKk1B,QAAQlqB,OACnBhL,KAAKiB,MAAMhB,IAAIq2B,cAAgBt2B,KAAKgB,mBACrCoxB,EAAKtgB,QAAQrL,OAASzG,KAAKgB,iBAAiBK,OAAO+wB,EAAKtgB,QAAQrL,QAExE,EAOApH,EAAI2N,OAAOuc,MAAMvU,UAAUuhB,OAAS,SAAU/2B,EAAKg3B,EAASC,EAAYC,EAAmBC,GACvF,IAAI3lB,EAAOohB,EAAM+D,EACbS,GAAU,EAOd,GANIH,IACAC,GAAoB,GAKpB12B,KAAKiB,MAAMhB,IAAI,2BAA6Bw2B,EAAY,CACxD,GAAgB,oBAAZD,EACA,OAAO,EAEK,oBAAZA,IACAA,EAAU,QAElB,CACA,QAAI,IAAuBh3B,EACvB,OAAO,EAKX,GAHI,iBAAoBA,IACpBA,EAAM,GAAKA,IAEVi3B,GACEz2B,KAAKiB,MAAMhB,IAAI42B,eAC0B,gBAAzC72B,KAAKiB,MAAMhB,IAAI42B,cAAc5lB,QAEhC,OAAO,EAiEX,GA/DAmhB,GAAO,EACFoE,EAEkB,YAAZA,GACPxlB,GAAQ,EACR4lB,GAAU,GAEV5lB,EADO,iBAAoBwlB,EACnBx2B,KAAKg1B,QAAQ/jB,QAAQulB,GAErBA,EAPRxlB,EAAQhR,KAAKg1B,QAAQ/jB,QAAQ6jB,MAS5B9jB,GACD3R,EAAIE,MAAM,mDAAqDi3B,GAK/DxlB,EAAMc,cAAW,IAAuBd,EAAMc,QAAQ+F,YACtD7G,EAAMc,QAAQ+F,UAAY,IAE1B,iBAAoBrY,GAAOA,EAAIkC,SAI/BlC,EAAMA,EAAIsE,QAAQ,mBAAoB,OAAYA,QAAQ,WAAY,MAEtE9D,KAAK82B,mBAAqBt3B,EAAIgE,OAAO,GAGrChE,EAAMA,EAAIsE,QAAQ,QAAS,MACtB2yB,IAEDj3B,EAAMA,EAAIsE,QAAQ,MAAO,OAIxB4yB,EAGMD,IACPz2B,KAAKiB,MAAMhB,IAAI82B,uBAAwB,IAHvC/2B,KAAKiB,MAAMhB,IAAIsG,kBAAmB,EAClCvG,KAAKiB,MAAMhB,IAAI+2B,qBAAsB,IAK7C5E,EAAO,IAAI/yB,EAAI+2B,KAAK52B,EAAKwR,QAErB,KADJmlB,EAAOn2B,KAAKk1B,QAAQjkB,UAC+C,IAAhCjR,KAAKk1B,QAAQjV,QAAQve,SAGpD1B,KAAKk1B,QAAQjV,QAAQtb,KAAK,IAC1BwxB,EAAOn2B,KAAKk1B,QAAQjkB,SAEpB,iBAAoBmhB,EAAKgD,QACpBsB,EAGMD,IACPz2B,KAAKiB,MAAMhB,IAAI82B,uBAAwB,IAHvC/2B,KAAKiB,MAAMhB,IAAIsG,kBAAmB,EAClCvG,KAAKiB,MAAMhB,IAAI+2B,qBAAsB,IASzC,iBAAoBx3B,EAAK,CACzB,GAAI,iBAAoB4yB,EAAKgD,OACM,MAA3BhD,EAAKgD,MAAM5xB,MAAM,EAAG,GAAY,CAGhC,IAFA,IAAIyzB,EAAa,GACbC,EAAY9E,EAAKgD,MACd/1B,EAAIgH,qBAAqBtD,QAAQm0B,EAAU1zB,MAAM,EAAG,KAAO,GAC9DyzB,GAA0BC,EAAU1zB,MAAM,EAAG,GAC7C0zB,EAAYA,EAAU1zB,MAAM,GAE5B0zB,GAAaD,IACb7E,EAAKtgB,QAAQ9L,OAASosB,EAAKtgB,QAAQ9L,OAASixB,EAC5C7E,EAAKgD,MAAQ8B,EAErB,CAEA9E,EAAKtgB,QAAQ,eASbsgB,EAAKgD,MAAQ/1B,EAAI2N,OAAOC,WAAWmlB,EAAKtgB,QAAQ,cAAc9R,KAAKiB,MAAOzB,IAE1EQ,KAAKiB,MAAMhB,IAAIk3B,gBAAkBR,IACjCvE,EAAKgD,MAAQhD,EAAKgD,MAAMtxB,QAAQ,gBAAiB,OAErD,IAAK,IAAItC,EAAI4wB,EAAKzgB,YAAYjQ,OAAS,EAAGF,GAAK,EAAGA,IAAM,EACrB,YAA3B4wB,EAAKzgB,YAAYnQ,GAAG,IAA+C,UAA3B4wB,EAAKzgB,YAAYnQ,GAAG,KAC5D4wB,EAAKgF,qBAAuBp3B,KAAKiB,MAAM4pB,OAAO,yBAE7CuH,EAAKgD,MAAM1xB,MAAMrE,EAAIsK,oBACS,gBAA3ByoB,EAAKzgB,YAAYnQ,GAAG,KACpB4wB,EAAKzgB,YAAcygB,EAAKzgB,YAAYnO,MAAM,EAAGhC,GAAGsE,OAAOssB,EAAKzgB,YAAYnO,MAAMhC,EAAI,KAS9F20B,EAAKxxB,KAAKytB,GACVpyB,KAAKiB,MAAM0C,IAAIynB,YAAYiM,YAAYjF,EAC3C,MAAWwE,EACPT,EAAKxxB,KAAKytB,GAEV+D,EAAKxxB,KAAKnF,GAEd,OAAO,CACX,EAEAH,EAAI2N,OAAOuc,MAAMvU,UAAUsiB,OAAS,SAAUr2B,EAAOs2B,EAASnF,GAC1D,IAAsBrT,EAKlByY,EAAUn4B,EAAI+N,cAAcpN,KAAKiB,OACjCm0B,EAAQmC,EAAQ/zB,QAChBiH,EAAM,GAEV,GAAqB,IAAjB2qB,EAAM1zB,OACN,OAAO+I,EAGX,IAcIgtB,EAAQC,EAAYC,EAAYlG,EAdhCmG,EAAiB,GACjBxF,EACAwF,EAAiBxF,EAAKtgB,QAAQ+F,WAG9B5W,EAAMhB,IAAI43B,yBAA0B,EACpC52B,EAAMhB,IAAI63B,kBAAoB,GAG9B1F,GAAQA,EAAK2F,aACb3F,EAAK4F,WAAa/2B,EAAMC,IAAIqB,KAC5BtB,EAAMC,IAAIqB,KAAO6vB,EAAK2F,YAI1B,IAAK,IAAIv2B,EAAI,EAAGC,EAAO2zB,EAAM1zB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CASnD,IARAi2B,EAASrC,EAAM5zB,IAEJsQ,QAAQmmB,aAGfh3B,EAAMhB,IAAI43B,wBAA0BJ,EAAO3lB,QAAQmmB,YAGnD,iBAAoBR,EAAOrC,OAC3B,GAAI,iBAAoBqC,EAAO/e,IAC3BjO,EAAI9F,KAAK8yB,QACN,GAAIA,EAAOrC,MAAO,CACjBqC,EAAOS,WACPT,EAAOrC,MAAQqC,EAAOS,SAAWT,EAAOrC,MACxCqC,EAAOS,SAAW,IAKtB,IAAIC,GADJpZ,EAAIyY,EAAQC,EAAOrC,QACN1zB,OAEb,IAAKT,EAAMhB,IAAIm4B,qBACX,IAAKt1B,EAAI,EAAG4B,EAAO+yB,EAAO9lB,YAAYjQ,OAAQoB,EAAI4B,EAAM5B,GAAK,EAEvC,aADlB2uB,EAASgG,EAAO9lB,YAAY7O,IACjB,KAGP7B,EAAMkxB,oBAAoBsF,EAAQhG,KAGtC1S,EAAI9d,EAAM0C,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzS,KAAKyY,EAAQx2B,EAAO8d,EAAG0S,EAAO,MAQnF,GAAI1S,GAAKA,EAAErd,OAAQ,CAEf,GADAqd,EAAIyY,EAAQC,EAAO3lB,QAAQ9L,QAAU+Y,EAAIyY,EAAQC,EAAO3lB,QAAQrL,QAC5DxF,EAAMC,IAAIiC,uBAAuBwmB,6BAA+B1oB,EAAMhB,IAAIm4B,qBAC1E,IAAKt1B,EAAI,EAAG4B,EAAO+yB,EAAO9lB,YAAYjQ,OAAQoB,EAAI4B,EAAM5B,GAAK,EAGvC,aAFlB2uB,EAASgG,EAAO9lB,YAAY7O,IAEjB,KACPic,EAAI9d,EAAM0C,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzS,KAAKyY,EAAQx2B,EAAO8d,EAAG0S,EAAO,KAIvFhnB,EAAI9F,KAAKoa,GACL9d,EAAMhB,IAAI43B,0BACV52B,EAAMhB,IAAI63B,mBAAsBK,EAAOV,EAAO3lB,QAAQrL,OAAO/E,OAAS+1B,EAAO3lB,QAAQ9L,OAAOtE,OAEpG,CACJ,OACG,GAAI+1B,EAAOrC,MAAM1zB,OAAQ,CAC5B,IAAI22B,EAAWp3B,EAAMqoB,OAAOgO,OAAOr2B,EAAOw2B,EAAOrC,MAAOqC,GACxD,GAAIrF,GAEI,WAAaiG,GAAYA,EAAS32B,OAAS,GAAK+1B,EAAO3lB,QAAQ+F,UAE/D,IADA,IAAIygB,GAAa,EACRx1B,EAAE,EAAE4B,EAAK2zB,EAAS32B,OAAOoB,EAAE4B,EAAK5B,IACjC,iBAAoBu1B,EAASv1B,GAC7Bw1B,GAAa,EACNA,IACPD,EAASv1B,GAAM20B,EAAO3lB,QAAQ+F,UAAYwgB,EAASv1B,IAKnE2H,EAAMA,EAAI3E,OAAOuyB,EACrB,CACIZ,EAAO3lB,QAAQmmB,YAAch3B,EAAMwS,SAASA,SAASgkB,EAAO3lB,QAAQmmB,cAEpEh3B,EAAMwS,SAASA,SAASgkB,EAAO3lB,QAAQmmB,YAAYnzB,OAAS7D,EAAMhB,IAAI63B,kBACtE72B,EAAMhB,IAAI43B,yBAA0B,EAE5C,CAGA,IAAKr2B,EAAE,EAAEC,EAAKgJ,EAAI/I,OAAS,EAAEF,EAAEC,EAAKD,GAAG,EAC/B,iBAAoBiJ,EAAIjJ,GAAGkX,KAAO,iBAAoBjO,EAAIjJ,EAAE,GAAGkX,KAAQjO,EAAIjJ,EAAE,GAAG+2B,+BAEhF9tB,EAAIjJ,GAAGsQ,QAAQrL,OAASgE,EAAIjJ,GAAGsQ,QAAQrL,QAAUmxB,GAAkC,IACnFntB,EAAIjJ,EAAE,GAAGg3B,iBAAmB,GAC5B/tB,EAAIjJ,EAAE,GAAG+2B,8BAA+B,GAIhD,IAAIE,EAAa,EACjB,IAASj3B,EAAI,EAAGC,EAAOgJ,EAAI/I,OAAQF,EAAIC,EAAMD,GAAK,EAC1C,iBAAoBiJ,EAAIjJ,KACxBi3B,EAAc9f,SAASnX,EAAG,IAAM,EAC5BA,EAAIiJ,EAAI/I,OAAS,GAAM,iBAAoB+I,EAAIjJ,EAAI,KAC/Co2B,IAAmBntB,EAAIjJ,EAAI,GAAG+2B,+BAC9B9tB,EAAIjJ,IAAMg2B,EAAQI,IAGtBntB,EAAIjJ,EAAI,GAAG+2B,8BAA+B,IAWtD,GAAInG,IAASA,EAAKzgB,YAAYjQ,QAAU0wB,EAAKtgB,QAAQrL,QACjDgyB,EAAahuB,EAAI/I,YACd,GAAI0wB,GAAQA,EAAKtgB,QAAQ9L,OAC5B,IAASxE,EAAE,EAAEC,EAAKgJ,EAAI/I,OAAOF,EAAEC,EAAKD,IAChC,QAAI,IAAuBiJ,EAAIjJ,GAAGkX,IAAK,CACnC+f,EAAaj3B,EACH,IAANA,IACAiJ,EAAIjJ,GAAGsQ,QAAQ9L,OAASosB,EAAKtgB,QAAQ9L,OAASyE,EAAIjJ,GAAGsQ,QAAQ9L,QAEjE,KACJ,CAIR,IAAI0yB,EAAcz3B,EAAMqoB,OAAOqP,YAAYluB,EAAIjH,MAAM,EAAGi1B,GAAab,GAAgB,EAAOxF,GAC5F,GAAIsG,GAAetG,IAASA,EAAKzgB,YAAYjQ,QAAU0wB,EAAKtgB,QAAQrL,QAAU2rB,EAAKtgB,QAAQ9L,QAAS,CAChG,IAAK/E,EAAMhB,IAAIm4B,qBACX,IAAS52B,EAAI,EAAGC,EAAO2wB,EAAKzgB,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3DiwB,EAASW,EAAKzgB,YAAYnQ,GACtB,CAAC,QAAQ,gBAAiB,WAAY,WAAWuB,QAAQ0uB,EAAO,KAAO,GAGvExwB,EAAMkxB,oBAAoBsF,EAAQhG,IAGjCA,EAAO,IACR,iBAAoBiH,IACpBA,EAAcz3B,EAAM0C,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzS,KAAKoT,EAAMnxB,EAAOy3B,EAAajH,EAAO,KAiBzG,GAVA1S,EAAI2Z,EACJhB,EAAatF,EAAKtgB,QAAQrL,OACtBsY,GAAKA,EAAErd,SAEPqd,EAAIyY,EADJG,EAAavF,EAAKtgB,QAAQ9L,QACA+Y,EAAIyY,EAAQE,GAClCz2B,EAAMhB,IAAI43B,0BACV52B,EAAMhB,IAAI63B,mBAAsBH,EAAWj2B,OAASg2B,EAAWh2B,SAGvEg3B,EAAc3Z,GACT9d,EAAMhB,IAAIm4B,qBACX,IAAS52B,EAAI,EAAGC,EAAO2wB,EAAKzgB,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3DiwB,EAASW,EAAKzgB,YAAYnQ,IACmD,IAAzE,CAAC,QAAQ,gBAAiB,WAAY,WAAWuB,QAAQ0uB,EAAO,KAGhE,iBAAoBiH,IACpBA,EAAcz3B,EAAM0C,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzS,KAAKoT,EAAMnxB,EAAOy3B,EAAajH,EAAO,IAI7G,CAEA,IAAImH,EAAYnuB,EAAIjH,MAAMi1B,EAAYhuB,EAAI/I,QA4B1C,OA3BKk3B,EAAUl3B,QAAUg3B,EACrBjuB,EAAM,CAACiuB,GACAE,EAAUl3B,SAAWg3B,EAC5BjuB,EAAMmuB,EACCF,GAAeE,EAAUl3B,SAChC+I,EAAM,CAACiuB,GAAa5yB,OAAO8yB,SAK3B,IAAuBxG,GACvBpyB,KAAK60B,MAAQ,GACb70B,KAAKk1B,QAAQjV,QAAU,GACvBjgB,KAAKk1B,QAAQjV,QAAQtb,KAAK3E,KAAK60B,OAC3B5zB,EAAMhB,IAAIm4B,uBACV3tB,EAAMxJ,EAAMqoB,OAAOqP,YAAYluB,OAAK4rB,GAAW,KAE5C,kBAAqBjE,IAC5B3nB,EAAMxJ,EAAMqoB,OAAOqP,YAAYluB,OAAK4rB,GAAW,IAG/CjE,GAAQA,EAAK2F,aACb92B,EAAMC,IAAIqB,KAAO6vB,EAAK4F,YAKnBvtB,CACX,EAEApL,EAAI2N,OAAOuc,MAAMvU,UAAU6jB,WAAa,WACpC,IAAIzG,EAAMjf,EAAKC,EAGf,IADAA,GADAgf,EAAOpyB,KAAKk1B,QAAQjkB,SACTmkB,MAAM1zB,OACZyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5Bif,EAAKgD,MAAMpqB,KAEnB,EAEA3L,EAAI2N,OAAOuc,MAAMvU,UAAU2jB,YAAc,SAAUvD,EAAO1P,EAAOoT,EAAShiB,GACtE,IAAI7V,EAAOwJ,EAAoBsuB,EAAW3G,EAAMjf,EAAKC,EAAK+L,EAAMC,EAAM5f,EAAKiyB,EAAQ+F,EAUnF,GATAA,EAAUn4B,EAAI+N,cAAcpN,KAAKiB,OAC5BykB,IACDA,EAAQ,IAEZzkB,EAAQjB,KAAKiB,MACbwJ,EAAM,GACU,GAChBsuB,EAAY,GACZ3lB,EAAMgiB,EAAM1zB,OACgB,aAAxB1B,KAAKiB,MAAMhB,IAAIoN,OAAwBrN,KAAKiB,MAAMhB,IAAIq2B,cAAwB,IAARljB,GAAiC,iBAAbgiB,EAAM,IAAmBte,EAKnH,OAJAse,EAAM,GAAGtjB,QAAQ9L,OAAS8Q,EAAOhF,QAAQ9L,OAASovB,EAAM,GAAGtjB,QAAQ9L,OACnEovB,EAAM,GAAGtjB,QAAQrL,OAAS2uB,EAAM,GAAGtjB,QAAQrL,OAASqQ,EAAOhF,QAAQrL,OACnE2uB,EAAM,GAAGzjB,YAAcyjB,EAAM,GAAGzjB,YAAY7L,OAAOgR,EAAOnF,aAC1DyjB,EAAM,GAAG3D,OAAS3a,EAAO2a,OAClB2D,EAAM,GAEjB,IAAInqB,GAAQ,EACZ,IAAKkI,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EACxBiiB,EAAMjiB,GAAK6lB,WACX5D,EAAMjiB,GAAK6lB,UAAU5D,EAAMjiB,EAAM,GAAGlI,GACpCA,GAAQ,GAERA,GADOmqB,EAAMjiB,EAAI,KAAMiiB,EAAMjiB,EAAI,GAAG8lB,cAU5C,IAAIC,GAAO,EACX,IAAK/lB,EAAMiiB,EAAM1zB,OAAS,EAAGyR,EAAM,EAAGA,IAAQ,EACtCiiB,EAAMjiB,GAAKgmB,UACPD,GAAQ9D,EAAMjiB,GAAKgmB,UAAU/D,EAAMjiB,EAAM,MACzC+lB,GAAO,GAGXA,GAAO,EAIf,IADA9lB,EAAMgiB,EAAM1zB,OACPyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAK5B,GAHI1I,IACAsuB,EAAYrT,GAEZ,iBAJJ0M,EAAOgD,EAAMjiB,IAKT1I,GAAO+sB,EAAQuB,GAIftuB,GAAO2nB,EACHnxB,EAAMhB,IAAI43B,0BAEV52B,EAAMhB,IAAI63B,mBAAsBiB,EAAgB,aAEjD,GAAID,EAIHruB,EADAA,EACM,CAACA,EAAK2nB,GAEN,CAACA,QAER,GAAIA,EAAKgH,SAAW/5B,EAAIgI,SAAU,CAOrC,IAAIgyB,GALA75B,EADA4yB,EAAK8F,SACC9F,EAAK8F,SAAW9F,EAAK1Z,IAErB0Z,EAAKkH,UAAUC,OAAOnH,EAAK1Z,IAAK0Z,EAAKxF,SAG9B9oB,QAAQ,WAAY,IAAIpC,OAEzC1B,KAAKu2B,OAAO/2B,EAAK,SAAS,GAC1B,IAAIg6B,EAAWx5B,KAAKgL,MAChB6sB,EAA0B52B,EAAMhB,IAAI43B,wBASxC,GARAr4B,EAAMQ,KAAKs3B,OAAOr2B,EAAO,CAACu4B,IAAW,GACrCv4B,EAAMhB,IAAI43B,wBAA0BA,EAChCzF,EAAKtgB,QAAQ,eACbtS,EAAMH,EAAI2N,OAAOC,WAAWmlB,EAAKtgB,QAAQ,cAAc9R,KAAKiB,MAAOzB,IAEnEA,GAAOQ,KAAKiB,MAAMhB,IAAIk3B,gBACtB33B,EAAMA,EAAIsE,QAAQ,gBAAiB,QAElC7C,EAAMhB,IAAIm4B,qBAEX,IADAhZ,EAAOgT,EAAKzgB,YAAYjQ,OACnByd,EAAO,EAAGA,EAAOC,EAAMD,GAAQ,EAChCsS,EAASW,EAAKzgB,YAAYwN,GACtBle,EAAMkxB,oBAAoBC,EAAMX,KAGpCjyB,EAAMyB,EAAM0C,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzS,KAAKoT,EAAMnxB,EAAOzB,EAAKiyB,EAAO,KAGrFjyB,EAAMg4B,EAAQpF,EAAKtgB,QAAQ9L,QAAUxG,EAAMg4B,EAAQpF,EAAKtgB,QAAQrL,QAChE,IAAIgzB,EAAQ,GACRrH,EAAKgH,SAAW/5B,EAAI2H,IAEpByyB,EAAQjC,EAAQpF,EAAKsH,cACdtH,EAAKgH,SAAW/5B,EAAI8H,UAE3BsyB,EAAQjC,EAAQpF,EAAKoG,kBACdpG,EAAKgH,SAAW/5B,EAAI0H,MAGvB0yB,EADAtmB,EAAM,IAAMif,EAAKuH,uBACTnC,EAAQpF,EAAK6G,eAEb,GAEL7G,EAAKgH,SAAW/5B,EAAI6H,OAK3BuyB,EAAQjC,EAAQpF,EAAK6G,gBAEzBxuB,GAAOgvB,EACPhvB,GAAOjL,EACHyB,EAAMhB,IAAI43B,0BACV52B,EAAMhB,IAAI63B,mBAAsB2B,EAAM/3B,OAAS0wB,EAAKtgB,QAAQ9L,OAAOtE,OAAS23B,EAASjH,EAAKtgB,QAAQrL,OAAO/E,OAEjH,CAEJ,OAAO+I,CACX,EAEApL,EAAI2N,OAAOuc,MAAMqQ,gBAAkB,SAAU9iB,GAEzC,GAAI,iBAAoBA,GAAU,iBAAoBA,EAAOse,OAAUte,EAAOse,MAAM1zB,OAIpF,IAAK,IAAIF,EAAEsV,EAAOse,MAAM1zB,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACvCnC,EAAI2N,OAAOuc,MAAMqQ,gBAAgB9iB,EAAOse,MAAM5zB,IAC9C,IAAIyb,EAAQnG,EAAOse,MAAM5zB,GACzB,IAAKyb,IAAUA,EAAMmY,QAAUnY,EAAMmY,MAAM1zB,OAAQ,CAE/C,IADA,IAAIm4B,EAAM,GACF/iB,EAAOse,MAAM1zB,OAAO,EAAKF,GAC7Bq4B,EAAIl1B,KAAKmS,EAAOse,MAAMpqB,OAG1B,IADA8L,EAAOse,MAAMpqB,MACN6uB,EAAIn4B,QACPoV,EAAOse,MAAMzwB,KAAKk1B,EAAI7uB,MAE9B,CACJ,CAEJ,EAOA3L,EAAI2N,OAAOuc,MAAMqB,OAAS,SAAUkP,GAEhC,IAAIC,EAAa,CACb,KAAK,EACL,KAAK,GAGLC,EAAc,CACd,KAAK,EACL,KAAK,EACL,KAAK,GAGLC,EAAW,CACX,IAAK,CACD,IAAK,IACL,IAAK,KACL,IAAK,IACL,IAAK,KACL,IAAK,MAET,IAAK,CACD,IAAK,KACL,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,MAET,IAAK,CACD,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,MAET,IAAK,CACD,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,MAET,IAAK,CACD,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK,MAET,IAAK,CACD,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,KACL,IAAK,MAITC,EAAU,CAAC,EACXC,EAAW,CAAC,EACZC,EAAQ,CAAC,EACTC,EAAiB,CAAC,EACtB,IAAK,IAAIp1B,KAAOg1B,EACZG,EAAMn1B,IAAO,EACbo1B,EAAep1B,IAAO,EACjB80B,EAAW90B,KACZi1B,EAAQj1B,IAAO,GAEd+0B,EAAY/0B,KACbk1B,EAASl1B,IAAO,GAGxBo1B,EAAe,MAAO,EACtBA,EAAe,MAAO,EAEtB,IAAIC,EAAW,CAAC,EAChB,IAAK,IAAIr1B,KAAOg1B,EACZ,IAAK,IAAIM,KAAUN,EAASh1B,GACnBq1B,EAASC,KACVD,EAASC,GAAU,CAAC,GAExBD,EAASC,GAAQt1B,GAAOg1B,EAASh1B,GAAKs1B,GAI9C,SAASC,EAAapI,GAClB,MAAQ,iBAAoBA,EAAK1Z,KAAQ0Z,EAAKgD,OAA+B,IAAtBhD,EAAKgD,MAAM1zB,QAAgB,iBAAoB0wB,EAAKgD,MAAM,GAAG1c,GACxH,CAEA,SAAS+hB,EAAiBrI,GACtB,MAAI,iBAAoBA,EAAK1Z,QAGxB0Z,EAAKgD,OAAS,iBAAqBhD,EAAKgD,WAGzCqF,EAAiBrI,EAAKgD,MAAMhD,EAAKgD,MAAM1zB,OAAO,UAAlD,EAGJ,CAEA,SAASg5B,EAAmBtI,EAAKuI,GAC7B,IAAIlwB,GAAM,EACNmwB,EAAY,CAAC,cAAc,gBAAgB,eAAe,mBAAmB,mBAIjF,GAHID,GACAC,EAAUj2B,KAAK,WAEfytB,EAAKzgB,YACL,IAAK,IAAInQ,EAAE,EAAEC,EAAK2wB,EAAKzgB,YAAYjQ,OAAOF,EAAEC,EAAKD,IAC7C,GAAIo5B,EAAU73B,QAAQqvB,EAAKzgB,YAAYnQ,GAAG,KAAO,EAAG,CAChDiJ,GAAM,EACN,KACJ,CAGR,OAAOA,CACX,CAEA,SAASowB,EAAwBzI,GAC7B,GAAIA,EAAKzgB,YACL,IAAK,IAAInQ,EAAE,EAAEC,EAAK2wB,EAAKzgB,YAAYjQ,OAAOF,EAAEC,EAAKD,IAC7C,GAA+B,YAA3B4wB,EAAKzgB,YAAYnQ,GAAG,IAA+C,UAA3B4wB,EAAKzgB,YAAYnQ,GAAG,GAC5D,OAAO,EAInB,MAAI,iBAAoB4wB,EAAKgD,OAGtByF,EAAwBzI,EAAKgD,MAAMhD,EAAKgD,MAAM1zB,OAAO,GAKhE,CAEA,SAASo5B,EAAoCC,EAAW3I,GACpD,IAAI4I,EAAY5I,EAAKtgB,QAAQrL,OAAOjD,OAAO,GACtCw3B,GAAa,iBAAoB5I,EAAKgD,QACvC4F,EAAY5I,EAAKgD,MAAM5xB,OAAO,IAElC,IAAIy3B,EAAcX,EAASS,GAAYC,GACvC,SAAIC,GAAsC,IAAvBA,EAAYv5B,SAG3B,iBAAoB0wB,EAAKgD,SAGzB0F,EAAoCC,EAAW3I,EAAKgD,MAAMhD,EAAKgD,MAAM1zB,OAAO,GAIpF,CAEA,SAASw5B,EAAc9I,EAAM+I,GACzB,IAAKf,EAAMe,GACP,OAAO,EAEX,GAAI,iBAAoB/I,EAAKgD,MAEzB,OAAIhD,EAAKgD,MAAM5xB,OAAO,KAAO23B,EAM7B,IAAIle,EAAQmV,EAAKgD,MAAMhD,EAAKgD,MAAM1zB,OAAO,GACzC,QAAIub,IACgBA,EAAMnL,QAAQrL,OAAOjD,OAAO,GAGjCyZ,EAAMnL,QAAQrL,OAAOjD,OAAO,IAAM23B,EADlCD,EAAcje,EAAMke,GAU3C,CAEA,SAASC,EAAYC,EAAOC,EAAOC,EAAQC,EAAQC,GAC/C,IAAIC,EAAe,UAAYJ,EAAQD,EAAQA,EAAMvpB,QACjD6pB,EAAgB,UAAYH,EAASD,EAAQA,EAAOzpB,QACpD8pB,EAAYF,EAAaJ,GAAO93B,OAAO,GACvCq4B,EAAaF,EAAcH,GAAQh4B,MAAM,EAAE,GAC/C,SAASs4B,IACLH,EAAcH,GAAUG,EAAcH,GAAQh4B,MAAM,EACxD,CACA,SAASu4B,IACLL,EAAaJ,GAASI,EAAaJ,GAAO93B,MAAM,GAAG,EACvD,CACA,SAASw4B,EAAUb,GACfQ,EAAcH,GAAUL,EAAMQ,EAAcH,EAChD,CACA,SAASS,EAASd,GACdO,EAAaJ,IAAUH,CAC3B,CAQA,IAAIz3B,EAAQ+3B,EAHZ,WACI,OAAOxB,EAAS2B,EACpB,EALA,WACI,OAAOtB,EAASuB,EACpB,EA2BA,IAAIK,EAAQT,EAtBZ,WACI,IAAIN,EAAMlB,EAAS2B,GAAWC,GAC1B,iBAAoBV,GACpBY,IACAD,IACAE,EAASb,KAETa,EAASJ,GACTG,IAER,EACA,WACI,IAAIZ,EAAMb,EAASuB,GAAYD,GAC3B,iBAAoBT,GACpBY,IACAD,IACAG,EAAQd,KAERc,EAAQJ,GACRC,IAER,EAGkBF,IAAcC,GAhCrBJ,EAAcM,EAAWD,KAoC5Bp4B,KACAw4B,GAGZ,CA2PA,SAASC,EAAelf,GACpB,IAAI+d,EAAY/d,EAAMnL,QAAQrL,OAAOjD,MAAM,EAAE,GAC7C,GAAI,iBAAoByZ,EAAMmY,MAC1B,KAAO8E,EAAQc,IACXI,EAAWne,EAAO,QAASA,EAAO,UAClC+d,EAAY/d,EAAMnL,QAAQrL,OAAOjD,MAAM,EAAE,QAG7C,KAAO02B,EAAQc,IACXI,EAAWne,EAAMmY,MAAMnY,EAAMmY,MAAM1zB,OAAO,GAAI,SAAUub,EAAO,UAC/D+d,EAAY/d,EAAMnL,QAAQrL,OAAOjD,MAAM,EAAE,EAGrD,CACA,SAAS44B,EAAgBnf,GACrB,GAAI,iBAAoBA,EAAMmY,MAE1B,IADA,IAAI4F,EAAY/d,EAAMmY,MAAM5xB,OAAO,GAC5B22B,EAASa,IACZI,EAAWne,EAAO,QAASA,EAAO,UAAU,GAC5C+d,EAAY/d,EAAMmY,MAAM5xB,OAAO,QAInC,IADIw3B,EAAY/d,EAAMmY,MAAMnY,EAAMmY,MAAM1zB,OAAO,GAAGoQ,QAAQrL,OAAOjD,OAAO,GACjE22B,EAASa,IACZI,EAAWne,EAAMmY,MAAMnY,EAAMmY,MAAM1zB,OAAO,GAAI,SAAUub,EAAO,UAAU,GACzE+d,EAAY/d,EAAMmY,MAAMnY,EAAMmY,MAAM1zB,OAAO,GAAGoQ,QAAQrL,OAAOjD,OAAO,EAGhF,CAuCAxD,KAAKq8B,OA5TL,SAAiBvlB,GAGb,GAAIA,EAAOse,OAAS,iBAAmBte,EAAOse,MACtCgF,EAAMtjB,EAAOhF,QAAQrL,OAAOjD,MAAM,EAAE,KACjCsT,EAAOhF,QAAQrL,OAAOjD,MAAM,EAAE,KAAOsT,EAAOse,MAAM5xB,OAAO,KAE5DsT,EAAOhF,QAAQrL,OAASqQ,EAAOhF,QAAQrL,OAAOjD,MAAM,SAGrD,GAAI,iBAAoBsT,GAAU,iBAAoBA,EAAOse,OAAUte,EAAOse,MAAM1zB,OAM3F,IADA,IAAI46B,EAAoB5B,EAAmB5jB,GAAO,GACzCtV,EAAEsV,EAAOse,MAAM1zB,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACvCxB,KAAKq8B,OAAOvlB,EAAOse,MAAM5zB,IACzB,IAAI+6B,EAAgBzlB,EAAOhF,QACvB0qB,EAAe1lB,EAAOse,MAAM5zB,GAAGsQ,QACnC,GAAU,IAANtQ,EAAS,CAEL,MAAQ+6B,EAAcv2B,OAAOxC,OAAO,IAAM,MAAQg5B,EAAax2B,OAAOxC,MAAM,EAAG,KAC/Eg5B,EAAax2B,OAASw2B,EAAax2B,OAAOxC,MAAM,IAGpD,IAAIw3B,EAAYwB,EAAax2B,OAAOxC,MAAM,EAAG,GACxC84B,IAAqBjC,EAAeW,IAAeuB,EAAcv2B,SAClEu2B,EAAcv2B,QAAUg1B,EACxBwB,EAAax2B,OAASw2B,EAAax2B,OAAOxC,MAAM,GAExD,CACA,GAAIhC,IAAOsV,EAAOse,MAAM1zB,OAAS,EAAI,CAE7Bs5B,EAAYwB,EAAa/1B,OAAOjD,OAAO,IAEtC84B,GAAqB,CAAC,KAAKv5B,QAAQi4B,IAAc,IAC9CuB,EAAc91B,OAAOjD,MAAM,EAAE,KAAOw3B,IACpCuB,EAAc91B,OAASu0B,EAAYuB,EAAc91B,QAErD+1B,EAAa/1B,OAAS+1B,EAAa/1B,OAAOjD,MAAM,GAAI,GAE5D,CACI+4B,EAAc1kB,WAAarW,EAAI,GAE3B64B,EAAekC,EAAc1kB,UAAUrU,OAAO,KAC3C+4B,EAAc1kB,UAAUrU,OAAO,KAAOg5B,EAAax2B,OAAOxC,MAAM,EAAG,KAEtEg5B,EAAax2B,OAASw2B,EAAax2B,OAAOxC,MAAM,GAI5D,CAEJ,EAuQAxD,KAAKy8B,SArQL,SAAmB3lB,GAEf,GAAI,iBAAoBA,GAAU,iBAAoBA,EAAOse,OAAUte,EAAOse,MAAM1zB,OAIpF,IAAK,IAAIF,EAAEsV,EAAOse,MAAM1zB,OAAO,EAAEF,GAAG,EAAEA,IAalC,GAZAxB,KAAKy8B,SAAS3lB,EAAOse,MAAM5zB,IAYtBA,EAAIsV,EAAOse,MAAM1zB,OAAQ,IAAOoV,EAAOhF,QAAQ+F,UAAW,CAG3D,IAAIoF,EAAQnG,EAAOse,MAAM5zB,GACrBw5B,EAAY/d,EAAMnL,QAAQrL,OAAOjD,OAAO,GACxCk5B,EAAU5lB,EAAOse,MAAM5zB,EAAE,GACzBm7B,EAAcD,EAAQ5qB,QAAQ9L,OAAOxC,MAAM,EAAG,GAE9Co5B,EAAY,iBAAoB5B,GAAa,iBAAoB2B,EAErE,KAHqBjC,EAAmBzd,IAAUyd,EAAmBgC,MAG7CE,GAAaxC,EAAMuC,KAAiBC,EAAW,CACnE,IAAIC,EAAuBF,IAAgB1f,EAAMnL,QAAQrL,OAAOjD,OAAO,GACnEs5B,GAAwB7f,EAAMnL,QAAQrL,QAAU,iBAAoBwW,EAAMmY,OAASnY,EAAMmY,MAAM5xB,OAAO,KAAOm5B,EAC5GE,GAAyBC,EAI1BJ,EAAQ5qB,QAAQ9L,OAAS02B,EAAQ5qB,QAAQ9L,OAAOxC,MAAM,GAHtD43B,EAAWne,EAAO,SAAUyf,EAAS,SAK7C,CACJ,CAER,EA6NA18B,KAAK+8B,SA3NL,SAAmBjmB,GAGf,GAAIA,EAAOse,OAAS,iBAAmBte,EAAOse,MACtCgF,EAAMtjB,EAAOhF,QAAQrL,OAAOjD,MAAM,EAAE,KACjCsT,EAAOhF,QAAQrL,OAAOjD,MAAM,EAAE,KAAOsT,EAAOse,MAAM5xB,OAAO,KAE5DsT,EAAOhF,QAAQrL,OAASqQ,EAAOhF,QAAQrL,OAAOjD,MAAM,SAGrD,GAAI,iBAAoBsT,GAAU,iBAAoBA,EAAOse,OAAUte,EAAOse,MAAM1zB,OAApF,CAUP,IAHA,IAAI66B,EAAgBzlB,EAAOhF,QAGlBtQ,EAAE,EAAEC,EAAKqV,EAAOse,MAAM1zB,OAAOF,EAAEC,EAAKD,IACzC,GAAIg5B,EAAa1jB,EAAOse,MAAM5zB,IAAK,EACN,EACzB,KACJ,CAIA,GAAI+6B,EAAc1kB,WAAauiB,EAAMmC,EAAc1kB,UAAUrU,MAAM,EAAG,IAAK,CACvE,IAAIw5B,EAAYT,EAAc1kB,UAAUrU,MAAM,EAAG,GACjD,IAAShC,EAAEsV,EAAOse,MAAM1zB,OAAO,EAAEF,GAAG,EAAEA,IAAK,EACnCg7B,EAAe1lB,EAAOse,MAAM5zB,GAAGsQ,SAClBrL,OAAOjD,OAAO,KAAOw5B,IAClCR,EAAa/1B,QAAUu2B,EAE/B,CACAT,EAAc1kB,UAAY0kB,EAAc1kB,UAAUrU,MAAM,EAC5D,CAGJ,IAAShC,EAAEsV,EAAOse,MAAM1zB,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACvC,IAAIyb,EAAQnG,EAAOse,MAAM5zB,GACrBg7B,EAAe1lB,EAAOse,MAAM5zB,GAAGsQ,QAC/BmrB,EAAmBvC,EAAmBzd,GAAO,GAC7CigB,EAAgB1C,EAAavd,GAEjC,GAAIzb,IAAOsV,EAAOse,MAAM1zB,OAAS,EAAI,CAW7B,IAAIq5B,EAAawB,EAAc91B,OAAOjD,MAAM,EAAG,GAM3C25B,GAAiB,EACjB/C,EAAMW,MACNoC,EAAiBrC,EAAoCC,EAAW9d,KACzC6c,IACnBqD,EAAiBtC,EAAwB5d,IAG7CkgB,GACI/C,EAAMW,KACDN,EAAiBxd,KACd,iBAAoBA,EAAMmY,MAC1BgG,EAAWne,EAAO,QAASnG,EAAQ,UAEnCskB,EAAWne,EAAO,SAAUnG,EAAQ,UAEA,MAApCylB,EAAc91B,OAAOjD,MAAM,EAAE,KAC7Bg5B,EAAa/1B,QAAU81B,EAAc91B,OAAOjD,MAAM,EAAE,GACpD+4B,EAAc91B,OAAS81B,EAAc91B,OAAOjD,MAAM,MAK5B,MAAlCg5B,EAAa/1B,OAAOjD,OAAO,IAAkD,MAApC+4B,EAAc91B,OAAOjD,MAAM,EAAE,KACtE+4B,EAAc91B,OAAS81B,EAAc91B,OAAOjD,MAAM,IAGlD62B,EAAemC,EAAa/1B,OAAOjD,MAAM,EAAE,MACvC,iBAAoByZ,EAAMmY,OAASnY,EAAMmY,MAAM5xB,OAAO,KAAOg5B,EAAa/1B,OAAOjD,MAAM,EAAE,KAEzFg5B,EAAa/1B,OAAS+1B,EAAa/1B,OAAOjD,MAAM,IAEhDg5B,EAAa/1B,OAAOjD,OAAO,KAAO+4B,EAAc91B,OAAOjD,MAAM,EAAG,KAEhE+4B,EAAc91B,OAAS81B,EAAc91B,OAAOjD,MAAM,GAAI,KAK9D03B,EAAcpkB,EAAOA,EAAOhF,QAAQrL,OAAOjD,MAAM,EAAE,MACnDsT,EAAOhF,QAAQrL,OAASqQ,EAAOhF,QAAQrL,OAAOjD,MAAM,GAE5D,MAAO,GAAI+4B,EAAc1kB,UAEjBwiB,EAAekC,EAAc1kB,UAAUrU,MAAM,EAAE,KAC5C+4B,EAAc1kB,UAAUrU,MAAM,EAAG,KAAOg5B,EAAa/1B,OAAOjD,OAAO,KAEtEsT,EAAOse,MAAM5zB,GAAGsQ,QAAQrL,OAASqQ,EAAOse,MAAM5zB,GAAGsQ,QAAQrL,OAAOjD,MAAM,GAAI,QAG3E,CAEH,IAAI45B,EAAiBtmB,EAAOse,MAAM5zB,EAAE,GAAGsQ,QAClC0oB,EAAavd,IACVggB,IACD5C,EAAemC,EAAa/1B,OAAOjD,OAAO,KAC1Cg5B,EAAa/1B,OAAOjD,OAAO,KAAO45B,EAAep3B,OAAOxC,MAAM,EAAG,KAEpE45B,EAAep3B,OAASo3B,EAAep3B,OAAOxC,MAAM,GAE5D,CAEK05B,GAAkBD,IAAoB7C,EAAMoC,EAAa/1B,OAAOjD,MAAM,EAAE,KACtE,iBAAoByZ,EAAMmY,OAE7BgG,EAAWne,EAAO,QAASA,EAAO,UAEtCjd,KAAK+8B,SAASjmB,EAAOse,MAAM5zB,GAC/B,CAtHA,CAwIJ,EAwEAxB,KAAKq9B,IAxCL,SAAcvmB,GAEV,GAAI,iBAAoBA,GAAU,iBAAoBA,EAAOse,OAAUte,EAAOse,MAAM1zB,OAApF,CAYA,IANA,IAAI47B,EAMK97B,EAAE,EAAEC,EAAKqV,EAAOse,MAAM1zB,OAAOF,EAAEC,EAAKD,IAAK,CAG9C,IAFA,IAAIyb,EAAQnG,EAAOse,MAAM5zB,GACrB+7B,GAAY,EACPz6B,EAAE,EAAE4B,EAAKuY,EAAMtL,YAAYjQ,OAAOoB,EAAE4B,EAAK5B,IAAK,CACnD,IAAI06B,EAAavgB,EAAMtL,YAAY7O,GACb,YAAlB06B,EAAW,IAAsC,UAAlBA,EAAW,KAC1CD,GAAY,EAEpB,CACIA,IACIzD,EACAqC,EAAclf,GAEdmf,EAAenf,IAGvBqgB,EAAWt9B,KAAKq9B,IAAIvmB,EAAOse,MAAM5zB,IAC7Byb,EAAMmY,OAAS,iBAAoBnY,EAAMmY,QACzCkI,EAAWrgB,EAAMmY,MAAM5xB,OAAO,GAEtC,CACA,OAAO85B,CA/BP,CAgCJ,CAKJ,EAIAj+B,EAAI4nB,OAAOqB,IAAM,WACbtoB,KAAKuU,SAAW,CACZC,QAAQ,GAEZxU,KAAKy9B,kBAAmB,EACxBz9B,KAAKwN,KAAO,OACZxN,KAAKktB,MAAQ,CAAC,EACdltB,KAAKgU,mBAAqB,CAAC,EAC3BhU,KAAK09B,wBAA0B,CAAC,EAChC19B,KAAKmwB,oBAAsB,CAAC,EAC5BnwB,KAAK,eAAiB,GACtBA,KAAK,mBAAqB,GAC1BA,KAAK,mBAAqB,GAC1BA,KAAKq0B,YAAc,CACfsJ,QAAQ,CACJ,cAAc,CACV33B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,KAGfm3B,aAAa,CACT,cAAc,CACV53B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,KAGfo3B,OAAO,CACH,cAAc,CACV73B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,KAGfq3B,SAAS,CACL,cAAc,CACV93B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,KAGfs3B,WAAW,CACP,cAAc,CACV/3B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,KAGfu3B,OAAO,CACH,cAAc,CACVh4B,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,IAEX,kBAAkB,CACdT,OAAO,GACPS,OAAO,MAInBzG,KAAK,kBAAoB,GACzBA,KAAK6hB,YAAcxiB,EAAIoJ,KACvBzI,KAAKi+B,SAAW5+B,EAAIoJ,KACpBzI,KAAKk+B,gBAAiB,EAQtBl+B,KAAK,aAAe,EACpBA,KAAK,mBAAqB,EAC1BA,KAAK,mBAAoB,EACzBA,KAAK,yBAA0B,EAC/BA,KAAK,+BAAgC,EAErCA,KAAK,gCAAkC,mBAIvCA,KAAK,gBAAiB,EAGtBA,KAAKm+B,sBAAuB,EAC5Bn+B,KAAKmzB,SAAW,8BAEhBnzB,KAAK8pB,UAAY,GAEjB9pB,KAAK4sB,OAAS,CAAC,EACf5sB,KAAK,mBAAqB,CACtB29B,QAAQ,CAAC,QACTC,aAAa,CAAC,QACdC,OAAO,CAAC,QACRC,SAAS,CAAC,QACVC,WAAW,CAAC,QACZC,OAAO,CAAC,QACRh8B,OAAO,CAAC,SAGZhC,KAAKo+B,mBAAoB,EACzBp+B,KAAKq+B,mCAAqC,GAC1Cr+B,KAAKkR,uBAAwB,EAE7BlR,KAAKs+B,uBAAyB,CAAC,EAE/Bt+B,KAAKmD,uBAAyB,CAAC,EAC/BnD,KAAKmD,uBAAuB8rB,YAAa,EACzCjvB,KAAKmD,uBAAuB+rB,gCAAiC,EAC7DlvB,KAAKmD,uBAAuBC,2BAA4B,EACxDpD,KAAKmD,uBAAuBo7B,qBAAsB,EAClDv+B,KAAKmD,uBAAuBisB,kBAAmB,EAC/CpvB,KAAKmD,uBAAuBq7B,oBAAqB,EACjDx+B,KAAKmD,uBAAuB+mB,yBAA0B,EACtDlqB,KAAKmD,uBAAuBwmB,4BAA6B,EACzD3pB,KAAKmD,uBAAuBs7B,kBAAmB,EAC/Cz+B,KAAKmD,uBAAuBoK,mCAAoC,EAChEvN,KAAKmD,uBAAuBu7B,wBAAyB,EACrD1+B,KAAKmD,uBAAuBumB,6BAA8B,EAC1D1pB,KAAKmD,uBAAuBgK,qBAAsB,EAClDnN,KAAKmD,uBAAuBqrB,kCAAmC,EAC/DxuB,KAAKmD,uBAAuBw7B,0BAA2B,EACvD3+B,KAAKmD,uBAAuBinB,wBAAyB,EACrDpqB,KAAKmD,uBAAuBknB,yCAA0C,EACtErqB,KAAKmD,uBAAuBy7B,kCAAmC,EAC/D5+B,KAAKmD,uBAAuBmnB,oBAAqB,EACjDtqB,KAAKmD,uBAAuB07B,aAAc,EAC1C7+B,KAAKmD,uBAAuB27B,8BAA+B,EAC3D9+B,KAAKmD,uBAAuB47B,gBAAiB,EAC7C/+B,KAAKmD,uBAAuB67B,eAAgB,EAC5Ch/B,KAAKmD,uBAAuB87B,mCAAoC,EAChEj/B,KAAKmD,uBAAuBmJ,oCAAqC,EACjEtM,KAAKmD,uBAAuBsJ,sBAAuB,EACnDzM,KAAKmD,uBAAuBonB,6BAA8B,EAC1DvqB,KAAKmD,uBAAuBoI,uBAAwB,EACpDvL,KAAKmD,uBAAuB+7B,kCAAmC,EAC/Dl/B,KAAKmD,uBAAuBg8B,6BAA8B,CAC9D,EAEA9/B,EAAI4nB,OAAOsB,IAAM,WAObvoB,KAAKggB,UAAY,IAAI3gB,EAAI41B,MACzBj1B,KAAKo/B,WAAa,IAAI//B,EAAI41B,MAC1Bj1B,KAAKq/B,YAAc,IAAIhgC,EAAI41B,MAK3Bj1B,KAAKiR,MAAQ,GAKbjR,KAAKs/B,qBAAuB,CAAC,EAK7Bt/B,KAAKu/B,eAAgB,EAMrBv/B,KAAKqN,KAAO,WACZrN,KAAKsiB,KAAO,WACZtiB,KAAK0hB,UAAY,GAQjB1hB,KAAKw/B,eAAiB,IAAIngC,EAAI41B,MAAM,EAAG51B,EAAImI,SAK3CxH,KAAKy/B,qBAAsB,EAK3Bz/B,KAAK62B,cAAgB,IAAIx3B,EAAI41B,MAAM,SAGnCj1B,KAAK0/B,gBAAkB,EAOvB1/B,KAAKoR,cAAgB,IAAI/R,EAAI41B,MAAM,CAC/B0K,eAAe,EACfC,kBAAkB,EAClBC,kBAAkB,EAClBC,gBAAYzJ,EACZ0J,gBAAa1J,EACb2J,oBAAgB3J,EAChB4J,mBAAe5J,EACf6J,iCAA6B7J,EAC7B/kB,WAAW,EACXe,gBAAgB,EAChB8tB,UAAW,KAOfngC,KAAKuG,kBAAmB,EAKxBvG,KAAKg3B,qBAAsB,EAI3Bh3B,KAAKugB,KAAO,IAAIlhB,EAAI41B,MAAM,EAAG51B,EAAImI,SAIjCxH,KAAK2R,YAAc,IAAItS,EAAI41B,MAG3Bj1B,KAAKogC,iBAAmB,IAAI/gC,EAAI41B,MAGhCj1B,KAAKqgC,iBAAmB,GACxBrgC,KAAKsgC,gBAAkB,GACvBtgC,KAAKugC,gBAAkB,GACvBvgC,KAAKwgC,WAAa,GAClBxgC,KAAKygC,WAAa,GAElBzgC,KAAKiwB,eAAiB,CAAC,EACvBjwB,KAAK0gC,mBAAqB,CAAC,EAG3B1gC,KAAK2gC,gBAAkB,IAAIthC,EAAI41B,MAY/Bj1B,KAAK6f,kBAAmB,EAKxB7f,KAAK,uBAAwB,EAI7BA,KAAKo4B,sBAAuB,EAI5Bp4B,KAAK8f,kBAAoB,IAAIzgB,EAAIuhC,YAGjC5gC,KAAK6gC,cAAgB,GAIrB7gC,KAAKgG,OAAS,IAAI3G,EAAI41B,MAAM,GAAI51B,EAAImI,SAIpCxH,KAAKyG,OAAS,IAAIpH,EAAI41B,MAAM,GAAI51B,EAAImI,SAIpCxH,KAAK6X,UAAY,IAAIxY,EAAI41B,MAAM,GAAI51B,EAAImI,SAGvCxH,KAAK8gC,aAAe,GACpB9gC,KAAK+gC,aAAe,CAChB/X,UAAU,EACVE,cAAc,EACdN,eAAe,EACfE,mBAAmB,GAEvB9oB,KAAKm3B,cAAgB,EACrBn3B,KAAK+wB,eAAiB,CAAC,EACvB/wB,KAAKghC,oBAAsB,EAC3BhhC,KAAKsuB,cAAgB,CAAC,EAYtBtuB,KAAKihC,kBAAoB,EACzBjhC,KAAKkhC,uBAAyB,GAC9BlhC,KAAKmhC,2BAA6B,EACtC,EAGA9hC,EAAI4nB,OAAOwB,IAAM,SAAUxnB,GAGvBjB,KAAK0D,MAAQ,IAAIrE,EAAIgsB,KAAK+V,MAG1BphC,KAAKqhC,WAAa,IAAIhiC,EAAIgsB,KAAKiW,WAAWjiC,EAAIyO,cAG9C9N,KAAKuhC,UAAY,IAAIliC,EAAIgsB,KAAKmW,UAG9BxhC,KAAKwrB,YAAc,IAAInsB,EAAIgsB,KAAKoW,YAAYxgC,GAG5CjB,KAAK0rB,iBAAmB,IAAIrsB,EAAIgsB,KAAKqW,eACzC,EAGAriC,EAAI4nB,OAAOuB,MAAQ,WAMfxoB,KAAK,mBAAoB,EAIzBA,KAAK2hC,iBAAkB,EAIvB3hC,KAAK4hC,UAAW,EAGhB5hC,KAAK+iB,MAAO,EASZ/iB,KAAKihB,iBAAkB,EAIvBjhB,KAAK6hC,aAAc,EAKnB7hC,KAAK0F,MAAO,EACZ1F,KAAK8hC,gBAAkB,CAAC,IACxB9hC,KAAK+hC,WAAa,CAAC,CAAC,GAKpB/hC,KAAK0sB,MAAO,EACZ1sB,KAAKysB,MAAO,EAGZzsB,KAAKgiC,MAAQ,CAAC,EAIdhiC,KAAK2hB,YAAc,GAGnB3hB,KAAKic,MAAO,EAIZjc,KAAKuC,MAAO,EAIZvC,KAAKqN,KAAO,WACZrN,KAAKsiB,KAAO,WACZtiB,KAAK0hB,UAAY,GAQjB1hB,KAAKiiC,iBAAmB,IAAI5iC,EAAI41B,MAAM,EAAG51B,EAAImI,SAC7CxH,KAAKkiC,YAAc,EACnBliC,KAAKmiC,qBAAuB,EAC5BniC,KAAKoiC,aAAc,EACnBpiC,KAAKqiC,qBAAuB,CAChC,EAGAhjC,EAAI4nB,OAAO0B,UAAY,WAInB3oB,KAAKsiC,MAAQ,GACbtiC,KAAKygB,KAAO,GACZzgB,KAAKwgB,QAAU,EACnB,EAGAnhB,EAAI4nB,OAAOgC,SAAW,SAAUhoB,GAK5BjB,KAAKkB,IAAM,CACPivB,oBAAqB,CAAC,GAG1BnwB,KAAKuiB,OAAS,GAEdviB,KAAKuiC,IAAM,IAAIljC,EAAIyrB,SAAS0X,YAAYvhC,EAAO,iBAI/CjB,KAAKkB,IAAIuhC,SAAW,GAGpBziC,KAAKkB,IAAI,2BAA4B,EACrClB,KAAKkB,IAAI,+BAAgC,EACzClB,KAAKkB,IAAI,iCAAkC,EAC3ClB,KAAKkB,IAAI,iCAAmC,UAC5ClB,KAAKkB,IAAI,sBAAwB,EAEjClB,KAAKkB,IAAIwhC,SAAW,GACpB1iC,KAAKkB,IAAIqxB,mBAAqB,GAC9BvyB,KAAKkB,IAAIyhC,cAAgB,GACzB3iC,KAAKkB,IAAI0hC,cAAgB,GACzB5iC,KAAKkB,IAAI2hC,iBAAmB,GAG5B7iC,KAAKkB,IAAI4hC,aAAe,GACxB9iC,KAAKkB,IAAI6hC,oBAAsB,EAC/B/iC,KAAKsiB,KAAO,UAChB,EAGAjjB,EAAI4nB,OAAOkC,aAAe,WACtBnpB,KAAKkB,IAAM,CACPivB,oBAAqB,CAAC,GAE1BnwB,KAAKuiB,OAAS,GAEdviB,KAAKkB,IAAIuhC,SAAW,GAEpBziC,KAAKkB,IAAIwhC,SAAW,GACpB1iC,KAAKkB,IAAIqxB,mBAAqB,GAC9BvyB,KAAKkB,IAAIyhC,cAAgB,GACzB3iC,KAAKkB,IAAI0hC,cAAgB,GACzB5iC,KAAKkB,IAAI2hC,iBAAmB,GAC5B7iC,KAAKkB,IAAI,gBAAkB,EAC3BlB,KAAKkB,IAAI,iBAAmB,EAG5BlB,KAAKkB,IAAI4hC,aAAe,GACxB9iC,KAAKkB,IAAI6hC,oBAAsB,EAC/B/iC,KAAKsiB,KAAO,cAChB,EAGAjjB,EAAI4nB,OAAO8B,iBAAmB,WAC1B/oB,KAAKuiB,OAAS,GACdviB,KAAKkB,IAAM,CAAC,EACZlB,KAAKkB,IAAI8hC,gBAAkB,GAC3BhjC,KAAKkB,IAAIwhC,SAAW,GAIpB1iC,KAAKkB,IAAI+hC,+BAAiC5jC,EAAIuI,UAC9C5H,KAAKkB,IAAIgiC,2BAA4B,EACrCljC,KAAKC,IAAM,CAAC,EACZD,KAAKwK,KAAO,GACZxK,KAAKsiB,KAAO,cAChB,EAGAjjB,EAAI4nB,OAAO4B,aAAe,WACtB7oB,KAAKuiB,OAAS,GACdviB,KAAKkB,IAAM,CAAC,EACZlB,KAAKkB,IAAI8hC,gBAAkB,GAC3BhjC,KAAKwK,KAAO,GACZxK,KAAKkB,IAAIwhC,SAAW,GACpB1iC,KAAKsiB,KAAO,UAChB,EAEAjjB,EAAI4nB,OAAOoC,OAAS,WAKhBrpB,KAAKkB,IAAM,CACPivB,oBAAqB,CAAC,GAG1BnwB,KAAKuiB,OAAS,GAMdviB,KAAKkB,IAAIuhC,SAAW,GAGpBziC,KAAKkB,IAAI,2BAA4B,EACrClB,KAAKkB,IAAI,+BAAgC,EACzClB,KAAKkB,IAAI,iCAAkC,EAC3ClB,KAAKkB,IAAI,iCAAmC,UAC5ClB,KAAKkB,IAAI,sBAAwB,EAEjClB,KAAKkB,IAAIwhC,SAAW,GACpB1iC,KAAKkB,IAAIqxB,mBAAqB,GAC9BvyB,KAAKkB,IAAIyhC,cAAgB,GACzB3iC,KAAKkB,IAAI0hC,cAAgB,GACzB5iC,KAAKkB,IAAI2hC,iBAAmB,GAG5B7iC,KAAKkB,IAAI4hC,aAAe,GACxB9iC,KAAKkB,IAAI6hC,oBAAsB,EAC/B/iC,KAAKsiB,KAAO,QAChB,EAIAjjB,EAAI4nB,OAAOjS,UAAUmuB,uBAAyB,SAAUna,EAAUoa,EAAcC,EAAeC,GAI3F,IAAIC,EAAUvjC,KAAKkB,IAAIsM,KACvBxN,KAAK+rB,gBAAgBuX,GAEpBta,EAASwa,mBACLxa,EAASwa,WAEd,IAAI/4B,EAAMzK,KAAKyjC,uBAAuBza,EAAUoa,EAAcC,EAAehkC,EAAIwH,SAGjF,OADA7G,KAAK+rB,gBAAgBwX,GACd94B,EAAI,EACf,EAEApL,EAAI4nB,OAAOjS,UAAU0uB,sBAAwB,SAAU1a,GAGnD,IAFA,IAAIoa,EAAe,GACfhwB,EAAMpT,KAAKyT,SAASkwB,YAAYC,gBAAgBliC,OAC3CyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAAG,CACnC,IAAI0wB,EAAI7jC,KAAKyT,SAASkwB,YAAYC,gBAAgBzwB,GAClDiwB,EAAaz+B,KAAK,CAAC,GAAKk/B,EAAEL,WAAYK,EAAEC,WAAWC,WACvD,CAEA,OAAO/jC,KAAKyjC,uBAAuBza,EAAUoa,EAAc,IAAI,EACnE,EAGA/jC,EAAI4nB,OAAOjS,UAAUyuB,uBAAyB,SAAUza,EAAUoa,EAAcC,EAAeW,GAC3F,IAAIH,EAAGI,EAAaC,EAAuBphC,EAAG4B,EAAMqT,EAAGC,EAAMya,EAAG0R,EAAWlgC,EAAMf,EAAMkhC,EAAeC,EAAkBC,EAcpHC,EACAC,EACAC,EACJ,GAhBAzkC,KAAKN,OAAQ,EACbM,KAAKC,IAAIquB,cAAgB,CAAC,EAM1BtuB,KAAKC,IAAIykC,gBAAkB,GAC3B1kC,KAAKyT,SAASkxB,YAAc,CAAC,WAAa,GAG1C3kC,KAAK4kC,cAAc5b,GAKfgb,IAAS3kC,EAAIwH,QAAS,CAElB7G,KAAKN,OACLL,EAAIK,MAAM,qCAOd6kC,EAAkBvkC,KAAKyT,SAASkwB,YAAYC,gBAAgBpgC,QAG5DghC,EAAcxkC,KAAKyT,SAASoxB,QAAQrhC,QAcpC,IARA,IAAIshC,EAAkB1B,EAAat9B,OAAOu9B,GAMtC0B,EAAa,CAAC,EACdC,EAAiB,GACZxjC,EAAI,EAAGC,EAAOqjC,EAAgBpjC,OAAQF,EAAIC,EAAMD,GAAK,EAE1D,IAAKsB,EAAI,EAAG4B,GADZm/B,EAAI7jC,KAAKyT,SAASkwB,YAAYsB,aAAaH,EAAgBtjC,GAAG,KACzC0jC,cAAcxjC,OAAQoB,EAAI4B,EAAM5B,GAAK,EACtDiiC,EAAWlB,EAAEqB,cAAcpiC,GAAGurB,KAAM,EACpC2W,EAAergC,KAAK,GAAKk/B,EAAEqB,cAAcpiC,GAAGurB,IAGpD,IAAKvrB,EAAI,EAAG4B,EAAOskB,EAASkc,cAAcxjC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC7DiiC,EAAW/b,EAASkc,cAAcpiC,GAAGurB,KAAM,EAC3C2W,EAAergC,KAAK,GAAKqkB,EAASkc,cAAcpiC,GAAGurB,IAIvDoW,EAAY,CAAC,EACb,IAASjjC,EAAI,EAAGC,EAAO+iC,EAAY9iC,OAAQF,EAAIC,EAAMD,GAAK,EACtD,IAAKujC,EAAWP,EAAYhjC,GAAG6sB,IAAK,CAChC,IAAI8W,EAAUnlC,KAAKyT,SAASA,SAAS+wB,EAAYhjC,GAAG6sB,IAAI+W,MACpDnX,EAAMjuB,KAAKyT,SAAS4xB,WAAWF,GACnC,GAAIlX,EACA,IAAKnrB,EAAI,EAAG4B,EAAOupB,EAAIvsB,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC1C2hC,EAAUxW,EAAInrB,IAAMzD,EAAImgB,iBAAiBxf,KAAKyT,SAASA,SAASwa,EAAInrB,IAAIwiC,SAGpF,CAQAtlC,KAAKN,OACLL,EAAIK,MAAM,kCAGlB,CAEAM,KAAKC,IAAIygC,mBAAqB,CAAC,EAC/B,IAAI6E,EAAc,GASdC,EAAa,CAAC,EAIlB,IAAShkC,EAAI,EAAGC,EAAOunB,EAASkc,cAAcxjC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAGpE,IAAK,IAAIyD,KADT/B,EAAO,CAAC,EACQ8lB,EAASkc,cAAc1jC,GACnC0B,EAAK+B,GAAO+jB,EAASkc,cAAc1jC,GAAGyD,GAYlC,IAAIxB,EAFZ,IARAQ,EAAOjE,KAAKouB,aAAa,GAAKlrB,EAAKmrB,KAC1BA,IACLruB,KAAKmoB,UAAU2H,iBAAiB,UAAW,cAAe7rB,EAAKoqB,GAAIpqB,EAAK6qB,UAE5E5rB,EAAO7D,EAAI4D,aAAa+b,KAAKhf,KAAMkD,GAC/BlD,KAAKkB,IAAIiC,uBAAuB+mB,yBAChClqB,KAAKwwB,qBAAqB,CAAC,CAACvsB,EAAKf,KAEjClD,KAAKkB,IAAIiC,uBAAuBo7B,oBAChC,GAAIr7B,EAAKG,UAA0F,IAA/E,CAAC,OAAO,UAAU,cAAc,aAAa,UAAUN,QAAQkB,EAAKkB,SAAkBjC,EAAKwtB,OAAwB,SAAfxtB,EAAKwtB,OAEzH,GADIjtB,EAAIpE,EAAIkB,sBAAsB8L,KAAKnJ,EAAKG,SACrC,CACH,IAAIoiC,EAAWpmC,EAAIwB,mBAAmB4C,EAAE,IACpCzD,KAAKgsB,QAAQyZ,KACbviC,EAAKwtB,MAAQ+U,EACbviC,EAAKG,QAAUI,EAAE,GAEzB,CAGR,IAAIiiC,EAAU,CAACzhC,EAAMf,GACrBqiC,EAAY5gC,KAAK+gC,GACjB1c,EAASkc,cAAc1jC,GAAG0B,KAAOe,CACrC,CAKA+kB,EAASuc,YAAcA,EAGvB,IAEII,EAFA/B,EAAkB,GAClBqB,EAAe,CAAC,EAEpB,IAAKzjC,EAAE,EAAGC,EAAK2hC,EAAa1hC,OAAQF,EAAEC,EAAMD,GAAK,EAC7CyiC,EAAcb,EAAa5hC,GACvBxB,KAAKkB,IAAIiC,uBAAuB67B,gBAC5BiG,EAAahB,EAAY,KACzB5kC,EAAIE,MAAM,oCAAsC0kC,EAAY,GAAK,gCAEjEA,EAAY,KACR0B,EAAc1B,EAAY,IAC1B5kC,EAAIK,MAAM,mDAAqD8B,EAAI,KAEvEmkC,EAAc1B,EAAY,KAGlCjkC,KAAKyT,SAASkwB,YAAYsB,aAAahB,EAAY,IAAIH,WAAWC,UAAYE,EAAY,GAC1FL,EAAgBj/B,KAAK3E,KAAKyT,SAASkwB,YAAYsB,aAAahB,EAAY,KACxEgB,EAAahB,EAAY,IAAMjkC,KAAKyT,SAASkwB,YAAYsB,aAAahB,EAAY,IAoBtF,IAlBKjb,EAAS8a,aACV9a,EAAS8a,WAAa,CAClBC,UAAW,IAGf/jC,KAAKkB,IAAIiC,uBAAuB67B,gBAC5BiG,EAAajc,EAASwa,aACtBnkC,EAAIE,MAAM,kDAAoDypB,EAASwa,YAEvExa,EAAS8a,WAAWC,YAChB4B,EAAc3c,EAAS8a,WAAWC,WAClC1kC,EAAIK,MAAM,gDAAkDspB,EAASwa,YAEzEmC,EAAc3c,EAAS8a,WAAWC,YAG1CH,EAAgBj/B,KAAKqkB,GACrBic,EAAajc,EAASwa,YAAcxa,EAC/BxnB,EAAE,EAAGC,EAAK4hC,EAAc3hC,OAAQF,EAAEC,EAAMD,GAAK,EAC9C0iC,EAAeb,EAAc7hC,GACzBxB,KAAKkB,IAAIiC,uBAAuB67B,gBAC5BiG,EAAaf,EAAa,KAC1B7kC,EAAIE,MAAM,oCAAsC2kC,EAAa,GAAK,iCAElEA,EAAa,KACTyB,EAAczB,EAAa,IAC3B7kC,EAAIK,MAAM,mDAAqD8B,EAAI,KAEvEmkC,EAAczB,EAAa,KAGnClkC,KAAKyT,SAASkwB,YAAYsB,aAAaf,EAAa,IAAIJ,WAAWC,UAAYG,EAAa,GAC5FN,EAAgBj/B,KAAK3E,KAAKyT,SAASkwB,YAAYsB,aAAaf,EAAa,KACzEe,EAAaf,EAAa,IAAMlkC,KAAKyT,SAASkwB,YAAYsB,aAAaf,EAAa,IAExFlkC,KAAKyT,SAASkwB,YAAYC,gBAAkBA,EAC5C5jC,KAAKyT,SAASkwB,YAAYsB,aAAeA,EA2BzCjlC,KAAKyT,SAASkwB,YAAYiC,kBAAoB,CAAC,EAC3C5lC,KAAKkB,IAAI2gB,cAAgBxiB,EAAIsJ,WAC7B07B,EAAgB,GAChBD,EAAgB,GAChBE,EAAkB,CAAC,GAEvB,IAkGIuB,EAlGAC,EAAe,GACnB,IAAStkC,EAAI,EAAGC,EAAOmiC,EAAgBliC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAE7D,IADAoiC,EAAgBpiC,GAAGsiC,WAAWpc,MAAQlmB,EACjCsB,EAAI,EAAG4B,EAAOk/B,EAAgBpiC,GAAG+jC,YAAY7jC,OAAQoB,EAAI4B,EAAM5B,GAAK,EACrEI,EAAO0gC,EAAgBpiC,GAAG+jC,YAAYziC,GACjC9C,KAAKyT,SAASkwB,YAAYiC,kBAAkB1iC,EAAK,GAAGmrB,MACrDruB,KAAKyT,SAASkwB,YAAYiC,kBAAkB1iC,EAAK,GAAGmrB,IAAM,GAC1DyX,EAAanhC,KAAK,GAAKzB,EAAK,GAAGmrB,MAE0D,IAAzFruB,KAAKyT,SAASkwB,YAAYiC,kBAAkB1iC,EAAK,GAAGmrB,IAAItrB,QAAQ6gC,EAAgBpiC,KAChFxB,KAAKyT,SAASkwB,YAAYiC,kBAAkB1iC,EAAK,GAAGmrB,IAAI1pB,KAAKi/B,EAAgBpiC,IAGjFxB,KAAKkB,IAAI2gB,cAAgBxiB,EAAIsJ,WACzBi7B,EAAgBpiC,GAAGsiC,WAAWC,UAC9BK,EAAcz/B,KAAKi/B,EAAgBpiC,KAEnCoiC,EAAgBpiC,GAAGsiC,WAAWC,UAAY,EAC1CM,EAAc1/B,KAAKi/B,EAAgBpiC,KAG/C,CAmBA,GAfIwiC,IAAS3kC,EAAIyH,8BAET9G,KAAKN,OACLL,EAAIK,MAAM,uCAIdM,KAAK+lC,YAAYD,EAAc,KAAM,MAAM,GAEvC9lC,KAAKN,OACLL,EAAIK,MAAM,wCAKbM,KAAKkB,IAAI8kC,sBAAwBT,GAAeA,EAAY7jC,OAAS,GAAK1B,KAAK4oB,cAAcrG,OAAO7gB,OAAS,EAAG,CACjH,IAASF,EAAI,EAAGC,EAAO8jC,EAAY7jC,OAAQF,EAAIC,EAAMD,GAAK,EACtD+jC,EAAY/jC,GAAG,GAAGykC,SAAW5mC,EAAI6mC,YAAYlnB,KAAKhf,KAAMulC,EAAY/jC,GAAG,GAAI,iBAO/E,GAAIxB,KAAKkB,IAAIilC,eAAkBnd,EAAS8a,WAAWsC,SAAU,CAEzD,IAAS5kC,EAAI,EAAGC,EAAO8jC,EAAY7jC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACzD,IAAIykC,EAAWV,EAAY/jC,GAAG,GAAGykC,SACjCjmC,KAAKC,IAAIomC,sBAAuB,EAGhC,IAAIC,EAAatmC,KAAKyT,SAASA,SAAS8xB,EAAY/jC,GAAG,GAAG6sB,IAAIiX,SAE9DtlC,KAAKC,IAAIomC,sBAAuB,EAChChnC,EAAIknC,iBAAiBvnB,KAAKhf,KAAMulC,EAAY/jC,GAAG,GAAI8kC,GACnD,IAAIE,EAAexmC,KAAKyT,SAASgzB,cAAclB,EAAY/jC,GAAG,GAAG6sB,IACjEruB,KAAKC,IAAIomC,sBAAuB,EAEhCd,EAAY/jC,GAAG,GAAGykC,SAAW,CAACO,GAAc1gC,OAAOmgC,EACvD,CAEAV,EAAYhS,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,sBAKnC,IAAIC,GAAa,EACbC,GAAU,EACVC,GAAa,EACjB,IAASrlC,EAAI,EAAGC,EAAO8jC,EAAY7jC,OAAQF,EAAIC,EAAMD,GAAK,EAClD+jC,EAAY/jC,GAAG,GAAGykC,SAAS,KAAOU,IAClCE,EAAatB,EAAY/jC,GAAG,GAAGykC,SAAS,GACxCW,EAAWrB,EAAY/jC,GAAG,GAAGykC,SAAS,IAE1CV,EAAY/jC,GAAG,GAAGykC,SAAS,GAAK,GAAKW,EAAUplC,EAC/CmlC,EAAaE,CAErB,CAKK7d,EAAS8a,WAAWsC,UACrBb,EAAYhS,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,qBAE3C,CASA,GALI1mC,KAAKkB,IAAIqT,SAASC,QAClBxU,KAAKuU,SAASuyB,cAAc9d,EAASuc,aAIrCvlC,KAAKkB,IAAI2gB,cAAgBxiB,EAAIsJ,SAC7B,IAASnH,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC3B,IAAIulC,EAAY,CAAC,EACbC,EAAW,CAAC,EACZC,EAAsB,CAAC,EAE3B,IAAKnkC,EAAI,EAAG4B,GADZmhC,EAAY,CAACxB,EAAeD,GAAe5iC,IACdE,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CACnD,IAAIokC,EAAcrB,EAAU/iC,GAW5B,IAVK+iC,EAAU/iC,GAAGghC,WAAWC,YACzB8B,EAAU/iC,GAAGghC,WAAWC,UAAY,GAExC8B,EAAU/iC,GAAGghC,WAAWC,UAAYprB,SAASktB,EAAU/iC,GAAGghC,WAAWC,UAAW,IAC5EjhC,EAAI,GAAKokC,EAAYpD,WAAWC,WAAa8B,EAAU/iC,EAAI,GAAGghC,WAAWC,UAAYmD,EAAYpD,WAAWC,YAC5GO,EAAkB,CAAC,EACnByC,EAAY,CAAC,EACbC,EAAW,CAAC,EACZC,EAAsB,CAAC,GAEtBlvB,EAAI,EAAGC,EAAOkvB,EAAY3B,YAAY7jC,OAAQqW,EAAIC,EAAMD,GAAK,EAC1DmvB,EAAY3B,YAAYxtB,GAAG,GAAGxD,UAAuD,UAA3C2yB,EAAY3B,YAAYxtB,GAAG,GAAGxD,WAGvE+vB,EAAgB4C,EAAYpD,WAAWC,WAGxCO,EAAgB4C,EAAYpD,WAAWC,YAAc,EAFrDO,EAAgB4C,EAAYpD,WAAWC,WAAa,GAkB5D,IAAKhsB,EAAI,EAAGC,EAAO6tB,EAAU/iC,GAAGyiC,YAAY7jC,OAAQqW,EAAIC,EAAMD,GAAK,EAAG,CAQlE,IAMIovB,EACAC,EAPAC,GAPJnkC,EAAO2iC,EAAU/iC,GAAGyiC,YAAYxtB,IAOb,GAAGsW,GAClBiZ,EAAWpkC,EAAK,GAAGqsB,eAAiBrsB,EAAK,GAAGqsB,eAAiBrsB,EAAK,GAAGmrB,GACrEkZ,GAAUrkC,EAAK,GAAGqsB,eAAiBrsB,EAAK,GAAGqsB,eAAiBrsB,EAAK,GAAGwsB,aAAexsB,EAAK,GAAGwsB,aAAexsB,EAAK,GAAGmrB,GAClHmZ,GAAStkC,EAAK,GAAG,iBACjBukC,GAAYvkC,EAAK,GAAGG,QACpBqkC,GAAUxkC,EAAK,GAAGwtB,MAGtB,GAAI3Y,EAAI,EAIJ,GAAImvB,EAAY3B,YAAYxtB,EAAI,GAAG,GAAGwX,eAClC4X,EAAeD,EAAY3B,YAAYxtB,EAAI,GAAG,GAAGwX,mBAC9C,CACH4X,EAAeD,EAAY3B,YAAYxtB,EAAI,GAAG,GAAGsW,GACjD+Y,EAAiBF,EAAY3B,YAAYxtB,EAAI,GAAG,GAAG,iBAE/C,IAAK,IAAI4vB,GAAE5vB,EAAE,EAAG4vB,IAAG,EAAGA,KAC6B,UAA3CT,EAAY3B,YAAYoC,IAAG,GAAGpzB,WAC9B4yB,EAAeD,EAAY3B,YAAYoC,IAAG,GAAGtZ,GAC7C+Y,EAAiBF,EAAY3B,YAAYoC,IAAG,GAAG,iBAI/D,CAGJ,GAAI3D,IAAS3kC,EAAIwH,SACTqgC,EAAY1D,YAAcxa,EAASwa,WAD3C,CAWA,IA8BIoE,GACAC,GA/BAC,GAAW,CAAC,EAQhB,GAPAA,GAASC,SAAW7kC,EAAK,GAAG6kC,SAC5BD,GAAS,+BAAiC5kC,EAAK,GAAG,+BAClD4kC,GAAS,yCAA2C5kC,EAAK,GAAG,yCAC5D4kC,GAAS,aAAe5kC,EAAK,GAAG,aAChCA,EAAK,GAAG,+BAAiC,EACzCA,EAAK,GAAG,yCAA2C,EACnDA,EAAK,GAAG,cAAe,EACnBlD,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,IACpB,SAApBrnC,KAAKkB,IAAIC,QAAqBnB,KAAKkB,IAAIu8B,iBAAkB,CACzD,IAAIuK,GAAWhoC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI,kBAC9C4Z,GAAWjoC,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAAS3lC,OAEpE,GADA1B,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI,kBAAoBruB,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAAS3lC,OACxG,iBAAoBsmC,IAGpB,GAFqBA,GAAW,IACXC,GAAW,EAEvB,CAAIN,GAAE,EAAX,IAAK,IAAQvoB,GAAKpf,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAAS3lC,OAAOimC,GAAEvoB,GAAKuoB,KACjFnC,EAAWxlC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI+W,QAAS,EACvDplC,KAAKC,IAAIygC,mBAAmB1gC,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAASM,IAAGnE,aAAc,CAF/B9hC,OAM3E,IAASimC,GAAE,EAAEvoB,GAAKpf,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAAS3lC,OAAOimC,GAAEvoB,GAAKuoB,KACjFnC,EAAWxlC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI+W,QAAS,EACvDplC,KAAKC,IAAIygC,mBAAmB1gC,KAAKyT,SAASkwB,YAAYiC,kBAAkByB,GAASM,IAAGnE,aAAc,CAG9G,CAkBJ,QAAI,IAAuBwD,EAASO,KAA4C,gBAAhCL,EAAYpD,WAAWt2B,KACnEu5B,EAAUO,GAAYJ,EAAYpD,WAAWC,UAC7CiD,EAASO,IAAWL,EAAYpD,WAAWC,UAC3CkD,EAAoBM,IAAWL,EAAYpD,WAAWC,UACtD7gC,EAAK,GAAG6kC,SAAW1oC,EAAI0I,mBACpB,CAMH,IAAImgC,IAAS,EACTC,IAAU,EACVC,GAAe,KACnB,GAAItlC,EAAI,EACAslC,GAAevC,EAAU/iC,EAAE,GAEnC,IAiEIulC,GAAMC,GAAcC,GAAYC,GAjEhCC,GAAe5C,EAAU/iC,GAE7B,GAAIA,EAAI,EAAG,CACP,IAAI4lC,GAAqB,EACY,gBAAjCN,GAAatE,WAAWt2B,MAA0B1K,EAAI,IACtD4lC,GAAqB,GAEzB,IAAIC,GAAmB7lC,EAAI4lC,GACvB7C,EAAU8C,IAAiBpD,YAAY7jC,SACvCkmC,GAAa/B,EAAU8C,IAAiBpD,YAAY/hC,OAAO,GAAG,GAAG,GAAG6qB,GACpEwZ,GAAehC,EAAU/iC,EAAI4lC,IAAoBnD,YAAY/hC,OAAO,GAAG,GAAG,GAAG,kBAE7E4kC,GAAa7C,YAAY7jC,QACrB0mC,GAAa7C,YAAY,GAAG/hC,OAAO,GAAG,GAAG+rB,iBACzCqY,GAAYQ,GAAa7C,YAAY,GAAG/hC,OAAO,GAAG,GAAG+rB,eAGjE,CACA,GAAIzsB,EAAI,GAAW,IAANiV,GAAWqwB,GAAatE,WAAWC,YAAc0E,GAAa3E,WAAWC,UAAW,CAS7F,IAAI7sB,IAAQ,EAER0xB,GAAQR,GAAa7C,YAAY,GAAG,GAAGlX,GAI3C,GAHI+Z,GAAa7C,YAAY,GAAG,GAAGhW,iBAC/BqZ,GAAQR,GAAa7C,YAAY,GAAG,GAAGhW,gBAEtCqZ,IAAUtB,GAAYc,GAAatE,WAAWC,WAAc0E,GAAa3E,WAAWC,UAAY,EAAK,CACtG,IAAI8E,GAAWT,GAAa7C,YAAY,GAAG,GAAG,iBAC1CuD,GAAWL,GAAalD,YAAY,GAAG,GAAG,iBACc,IAAvDjB,EAAgB8D,GAAatE,WAAWC,YAA0D,IAAtCqE,GAAatE,WAAWC,WAAoB8E,KAAaC,KACtH5xB,IAAQ,EAEhB,CACIA,GACAgxB,IAAS,EAETC,IAAU,CAElB,MAAWpwB,EAAI,GAAKovB,GAAgBG,GAAYF,GAAkBI,IAMjD,IAANzvB,GAAWjV,EAAI,GAAKslC,GAAatE,WAAWC,WAAa0E,GAAa3E,WAAWC,WAC9EqE,GAAa7C,YAAY7jC,QACzBkmC,IAAaN,GAAYO,IAAeL,GAHlDU,IAAS,EAYTC,IAAU,EAIVD,MAEIG,GADAtwB,EAAI,EACGmvB,EAAY3B,YAAaxtB,EAAI,GAAI,GAEjC8tB,EAAW/iC,EAAI,GAAIyiC,YAAY,GAAG,IAEpCliC,SAEDklC,GADAF,GAAK3X,MACQ2X,GAAK3X,MAEL,GAEjB4X,GAAe,GAAKD,GAAKhlC,QAAUklC,IAEnCD,GAAeD,GAAKhlC,QAQpBmlC,GANAf,GAMe,GAAKA,IALhBC,IAGa,IAIFD,IAInBS,IAAUI,KAAiBE,KAC3BN,IAAS,EACTC,IAAU,GAGVD,MACKI,IAAgBE,GAGjBtlC,EAAK,GAAG6kC,SAAW1oC,EAAI6I,2BACfogC,IAAiBE,GAKlBF,IAAgBE,KAAiBF,GAKxCplC,EAAK,GAAG6kC,SAAW1oC,EAAI4I,cAEhBqgC,IAAgBE,IAAgBA,KAAiBF,GAIxDplC,EAAK,GAAG6kC,SAAW1oC,EAAI6I,4BAMvBggC,IAAS,EACTC,IAAU,GApBVjlC,EAAK,GAAG6kC,SAAW1oC,EAAI4I,eAuB3BkgC,KACAjlC,EAAK,GAAG6kC,SAAW1oC,EAAI8I,mCACnB,IAAuB4+B,EAAUO,GACjCP,EAAUO,GAAYJ,EAAYpD,WAAWC,UAE7C7gC,EAAK,GAAG6kC,SAAW1oC,EAAI2I,sBAG3BmgC,IAAWD,MACyB,gBAAhChB,EAAYpD,WAAWt2B,OACvBtK,EAAK,GAAG6kC,SAAW1oC,EAAI0I,gBAEvBk/B,EAAoBM,KAAYL,EAAYpD,WAAWC,YACvD7gC,EAAK,GAAG,yCAA2C+jC,EAAoBM,IACnEvnC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,MAC/BruB,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI,yCAA2C4Y,EAAoBM,MAGtGR,EAAUO,IAAaJ,EAAYpD,WAAWC,YAC9C7gC,EAAK,GAAG,+BAAiC6jC,EAAUO,GAC/CtnC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,MAQ/BruB,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI,+BAAiC0Y,EAAUO,KAI9F,CACA,GAAIJ,EAAYpD,WAAWC,UAAW,CAClC,IAAIgF,GAAgBpwB,SAASuuB,EAAYpD,WAAWC,UAAW,IAAMprB,SAASquB,EAASO,IAAU,IAC7FrkC,EAAK,GAAG6kC,WAAa1oC,EAAI0I,gBACtBghC,IAAiB/oC,KAAKgpB,SAAS9nB,IAAI,wBACtCgC,EAAK,GAAG,cAAe,GAE3B8jC,EAASO,IAAWL,EAAYpD,WAAWC,SAC/C,MAAW7gC,EAAK,GAAG6kC,WAAa1oC,EAAI0I,iBAChC7E,EAAK,GAAG,cAAe,GAE3B,GAAIgkC,EAAY1D,YAAcxa,EAASwa,WACnC,IAAK/Q,EAAI,EAAG0R,EAAO9kC,EAAIgJ,mBAAmB3G,OAAQ+wB,EAAI0R,EAAM1R,GAAK,EAAG,CAChE,IAAI9S,GAAQtgB,EAAIgJ,mBAAmBoqB,GAC/BvvB,EAAK,GAAGyc,MAAWmoB,GAASnoB,MACxB3f,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,KACjB,gCAAV1O,KACA6lB,EAAWxlC,KAAKyT,SAASA,SAASvQ,EAAK,GAAGmrB,IAAI+W,QAAS,EACvDplC,KAAKC,IAAIgwB,eAAe/sB,EAAK,GAAGmrB,KAAM,GAG9CruB,KAAKC,IAAIygC,mBAAmBwG,EAAY1D,aAAc,EAE9D,CAEAxjC,KAAK4T,IAAIoU,kBACT9kB,EAAK,GAAGwkB,MAAQwf,EAAYpD,WAAWpc,MACvCxkB,EAAK,GAAG6gC,UAAYmD,EAAYpD,WAAWC,UA7P/C,WARY,IAAuBgD,EAAU7jC,EAAK,GAAGmrB,KACzC0Y,EAAUO,GAAYJ,EAAYpD,WAAWC,UAC7CiD,EAASO,IAAWL,EAAYpD,WAAWC,WAE3CiD,EAASO,IAAWL,EAAYpD,WAAWC,SAmQ3D,CACJ,CACJ,CAEJ,GAAI/jC,KAAKkB,IAAI8kC,sBAAwBT,GAAeA,EAAY7jC,OAAS,GAAK1B,KAAK4oB,cAAcrG,OAAO7gB,OAAS,IACxGsnB,EAAS8a,WAAWsC,SAAU,CAC/B,IAAS5kC,EAAI,EAAGC,EAAO8jC,EAAY7jC,OAAQF,EAAIC,EAAMD,GAAK,EACtD+jC,EAAY/jC,GAAG,GAAGykC,SAAW5mC,EAAI6mC,YAAYlnB,KAAKhf,KAAMulC,EAAY/jC,GAAG,GAAI,iBAE/E+jC,EAAYhS,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,qBACvC,CAEJ,IAAK,IAAIzhC,KAAOjF,KAAKC,IAAIgwB,eACrB,GAAIjwB,KAAKC,IAAIgwB,eAAehN,eAAehe,KACvC4gC,EAAY7lC,KAAKyT,SAASkwB,YAAYiC,kBAAkB3gC,IAIpD,IAASzD,EAAI,EAAGC,EAAOokC,EAAUnkC,OAAQF,EAAIC,EAAMD,GAAK,EACpDxB,KAAKC,IAAIygC,mBAAmBmF,EAAUrkC,GAAGgiC,aAAc,EAMvE,IAAI/4B,GAAM,GACV,GAAIu5B,IAAS3kC,EAAIwH,QAAS,CAGlB7G,KAAKN,OACLL,EAAIK,MAAM,wCAGd,IACI+K,GAAMzK,KAAKgpC,wBAAwBhqB,KAAKhf,KAAMgpB,EAASuc,YAAavc,EACxE,CAAE,MAAO7oB,IACLd,EAAIE,MAAM,4CAA4CY,GAC1D,CAGIH,KAAKN,QACLL,EAAIK,MAAM,sCACVL,EAAIK,MAAM,yCAUdM,KAAKyT,SAASkwB,YAAYC,gBAAkBW,EAC5CvkC,KAAKyT,SAASkwB,YAAYsB,aAAe,CAAC,EAC1C,IAASzjC,EAAI,EAAGC,EAAO8iC,EAAgB7iC,OAAQF,EAAIC,EAAMD,GAAK,EAC1DxB,KAAKyT,SAASkwB,YAAYsB,aAAaV,EAAgB/iC,GAAGgiC,YAAce,EAAgB/iC,GAIxFxB,KAAKN,OACLL,EAAIK,MAAM,uCAGd,IAAIupC,GAAa,GACjB,IAASznC,EAAI,EAAGC,EAAO+iC,EAAY9iC,OAAQF,EAAIC,EAAMD,GAAK,EACtDynC,GAAWtkC,KAAK,GAAK6/B,EAAYhjC,GAAG6sB,IASxC,IAAK,IAAIppB,KAPTjF,KAAK+lC,YAAYkD,GAAY,KAAM,MAAM,GAErCjpC,KAAKN,OACLL,EAAIK,MAAM,qCAIE+kC,EACRA,EAAUxhB,eAAehe,KACzBjF,KAAKyT,SAASA,SAASxO,GAAKqgC,SAAWb,EAAUx/B,IAIrDjF,KAAKN,OACLL,EAAIK,MAAM,qCAGlB,KAAO,CAKH,IAAK,IAAIwpC,MAAa1D,EAClBxlC,KAAKsf,aAAa6pB,IAAID,GAAWlgB,GAMrC,IAAI7P,GACJ,IAAK,IAAIlU,KAAOjF,KAAKC,IAAIygC,mBACrB,GAAIz7B,GAAO+jB,EAASwa,WAApB,CAGA,IAAI4F,GAAappC,KAAKyT,SAASkwB,YAAYsB,aAAahgC,GACxD,IAAKmkC,GAAWtF,WAAWsC,SAAU,CACjC,IAAS5kC,EAAI,EAAGC,EAAO2nC,GAAW7D,YAAY7jC,OAAQF,EAAIC,EAAMD,GAAK,EACjE4nC,GAAW7D,YAAY/jC,GAAG,GAAGykC,SAAW5mC,EAAI6mC,YAAYlnB,KAAKhf,KAAMopC,GAAW7D,YAAY/jC,GAAG,GAAI,iBAErG4nC,GAAW7D,YAAYhS,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,qBAClD,CAEA1mC,KAAKC,IAAIopC,aAAeD,GAAWtF,WAAWpc,MAC9C1nB,KAAKC,IAAIqpC,oBAAsBF,GAAWtF,WAAWC,UACrD/jC,KAAKC,IAAIspC,YAAc,GAAKH,GAAW5F,YACvCrqB,GAAM,IACFxU,KAAKykC,GAAWtF,WAAWpc,OAC/BvO,GAAIxU,KAAK3E,KAAKgpC,wBAAwBhqB,KAAKhf,KAAMopC,GAAW7D,YAAa6D,KACzEjwB,GAAIxU,KAAKykC,GAAW5F,YACpB/4B,GAAI9F,KAAKwU,GAhBT,CAkBJnZ,KAAKC,IAAIgwB,eAAiB,CAAC,EAC3BjwB,KAAKC,IAAIygC,mBAAqB,CAAC,EAG/B1gC,KAAKC,IAAIopC,aAAergB,EAAS8a,WAAWpc,MAC5C1nB,KAAKC,IAAIqpC,oBAAsBtgB,EAAS8a,WAAWC,UACnD/jC,KAAKC,IAAIspC,YAAc,GAAKvgB,EAASwa,YAErCrqB,GAAM,IACFxU,KAAKy+B,EAAa1hC,QACtByX,GAAIxU,KAAK3E,KAAKgpC,wBAAwBhqB,KAAKhf,KAAMulC,EAAavc,IAC9D7P,GAAIxU,KAAKqkB,EAASwa,YAClB/4B,GAAI9F,KAAKwU,IAOT1O,GAAI8oB,MAAK,SAAUzU,EAAGC,GAClB,OAAID,EAAE,GAAKC,EAAE,GACF,EACAD,EAAE,GAAKC,EAAE,IACR,EAED,CAEf,GAKJ,CAEA,OADA/e,KAAKyT,SAASkxB,YAAYD,gBAAkB1kC,KAAKC,IAAIykC,gBAAgBlhC,QAC9D,CAACxD,KAAKyT,SAASkxB,YAAal6B,GACvC,EAEApL,EAAI4nB,OAAOjS,UAAUg0B,wBAA0B,SAAUzD,EAAavc,GAClE,IAAIxpB,EAAM,GACV,GAAIwpB,GAAYA,EAAS8a,YAA2C,cAA7B9a,EAAS8a,WAAWt2B,KAAsB,CAC7Ewb,EAAS8a,WAAWt2B,KAAO,cAC3B,IAAIg8B,EAAanqC,EAAIoqC,mBAAmBzqB,KAAKhf,KAAMulC,EAAavc,GAChEA,EAAS8a,WAAWt2B,KAAO,kBAC3B,IAAIk8B,EAAc,GACd1gB,EAAS8a,WAAW6F,QACpB3pC,KAAKspB,OAAOiN,OAAOvN,EAAS8a,WAAW6F,OAGnC,iBAFJD,EAAc1pC,KAAKspB,OAAOgO,OAAOt3B,KAAMA,KAAKspB,OAAOuL,UAG/C6U,EAAcA,EAAY/nC,KAAK,MAGvC,IAAIioC,EAAavqC,EAAIoqC,mBAAmBzqB,KAAKhf,KAAMulC,EAAavc,GAChEA,EAAS8a,WAAWt2B,KAAO,YACvBg8B,GAAcE,GAAerqC,EAAImJ,qBAAqB1C,OAAO,CAAC,IAAU,MAAO/C,QAAQ2mC,EAAY,KAAO,IAC1GF,GAAcE,EACdA,GAAc,GAElBlqC,EAAM,CAACgqC,EAAYE,EAAaE,GAAYh4B,QAAO,SAASuH,GACxD,OAAOA,CACX,IAAGxX,KAAK,IACZ,MACInC,EAAMH,EAAIoqC,mBAAmBzqB,KAAKhf,KAAMulC,EAAavc,GAEzD,OAAOxpB,CACX,EAEAH,EAAI4nB,OAAOjS,UAAU60B,oBAAsB,SAAUC,GACjD,IAAIrZ,EAAWiV,EAAcvyB,EAAKC,EAAKlQ,EAAMe,EAG7C,IAFAwsB,EAAY,GACZrd,EAAM02B,EAAQpoC,OACTyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAAG,CAE/B,IAAK,IAAIlO,KADT/B,EAAO,CAAC,EACQ4mC,EAAQ32B,GACpBjQ,EAAK+B,GAAO6kC,EAAQ32B,GAAKlO,GAI7B,GAFAhB,EAAOjE,KAAKouB,aAAa,GAAKlrB,EAAKmrB,IAE/BruB,KAAKkB,IAAIiC,uBAAuBo7B,qBAC5Br7B,EAAKG,UAA0F,IAA/E,CAAC,OAAO,UAAU,cAAc,aAAa,UAAUN,QAAQkB,EAAKkB,SAAkBjC,EAAKwtB,OAAwB,SAAfxtB,EAAKwtB,OAAmB,CAC5I,IAAIjtB,EAAIpE,EAAIkB,sBAAsB8L,KAAKnJ,EAAKG,SAC5C,GAAII,EAAG,CACH,IAAIgiC,EAAWpmC,EAAIwB,mBAAmB4C,EAAE,IACpCzD,KAAKgsB,QAAQyZ,KACbviC,EAAKwtB,MAAQ+U,EACbviC,EAAKG,QAAUI,EAAE,GAEzB,CACJ,CAEAP,EAAKG,UACLH,EAAKG,SAAW,GAAKH,EAAKG,SAASS,QAAQ,OAAQ,KAEvD4hC,EAAU,CAACzhC,EAAMf,GACjButB,EAAU9rB,KAAK+gC,EACnB,CAIA,GAHI1lC,KAAKkB,IAAIiC,uBAAuB+mB,yBAChClqB,KAAKwwB,qBAAqBC,GAE1BA,GAAaA,EAAU/uB,OAAS,GAAK1B,KAAK4oB,cAAcrG,OAAO7gB,OAAS,EAAG,CAE3E,IADA0R,EAAMqd,EAAU/uB,OACXyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5Bsd,EAAUtd,GAAK,GAAG8yB,SAAW5mC,EAAI6mC,YAAYlnB,KAAKhf,KAAMywB,EAAUtd,GAAK,GAAI,iBAE/Esd,EAAU8C,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,qBACrC,CAGA,OAFA1mC,KAAKC,IAAIykC,gBAAkB,GACjBrlC,EAAIoqC,mBAAmBzqB,KAAKhf,KAAMywB,EAEhD,EAWApxB,EAAIknC,iBAAmB,SAAUtiC,EAAMqhC,EAAUyE,EAAY7mC,GACzD,IACIiO,EAAQnR,KAAKC,IAAImR,cAAcC,IAC/B24B,EAAsB,CACtBrK,cAAexuB,EAAMwuB,cACrBC,iBAAkBzuB,EAAMyuB,iBACxBC,iBAAkB1uB,EAAM0uB,iBACxBC,WAAY3uB,EAAM2uB,WAClBC,WAAY5uB,EAAM4uB,WAClBkK,aAAc94B,EAAM84B,aACpBhK,cAAe9uB,EAAM8uB,cACrBD,eAAgB7uB,EAAM6uB,eACtBkK,uBAAwB/4B,EAAM+4B,uBAC9BhK,4BAA6B/uB,EAAM+uB,4BACnCiK,wCAAyCh5B,EAAMg5B,wCAC/C74B,UAAWH,EAAMG,UACjBe,eAAgBlB,EAAMkB,eACtB8tB,UAAWhvB,EAAMgvB,UAAU38B,SAG3BxD,KAAKC,IAAI4f,iBADTylB,IAG4B,EAEhC,IAAI8E,EAAW,CACXrC,SAAU1oC,EAAI2I,oBACd,aAAa,GAGb9E,IACAknC,EAAS/mC,QAAUH,EAAKG,QACxB+mC,EAAS1Z,MAAQxtB,EAAKwtB,OAGtB1wB,KAAKyT,SAASA,SAASxP,EAAKoqB,KACzBruB,KAAKyT,SAASkwB,YAAYiC,mBAC1B5lC,KAAKyT,SAASkwB,YAAYiC,kBAAkB3hC,EAAKoqB,KACjDruB,KAAKyT,SAASkwB,YAAYiC,kBAAkB3hC,EAAKoqB,IAAI3sB,QACrDqoC,GACwD,YAAvD/pC,KAAKgpB,SAAS9nB,IAAI,mCAClBkpC,EAAS,+BAAiCpqC,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAI,gCAGlFruB,KAAKC,IAAIoN,KAAO,WAChBrN,KAAKC,IAAIqiB,KAAO,WAChB,IAAI+nB,EAA0BrqC,KAAKC,IAAIm4B,qBACvCp4B,KAAKC,IAAIm4B,sBAAuB,EAChCp4B,KAAKC,IAAIq2B,cAAe,EAExBj3B,EAAIirC,QAAQtrB,KAAKhf,KAAMiE,EAAMmmC,EAAU,MAAM,GAE7C,IAAK,IAAI5oC,EAAE,EAAEC,EAAKzB,KAAKspB,OAAOuL,MAAMnzB,OAAOF,EAAEC,EAAKD,GAAG,EACjDnC,EAAI2N,OAAOuc,MAAMqQ,gBAAgB55B,KAAKspB,OAAOuL,MAAMrzB,IAEvD,GAAIxB,KAAKkB,IAAIiC,uBAAuBq7B,mBAChC,IAAK,IAAI17B,EAAE,EAAE4B,EAAK1E,KAAKspB,OAAOuL,MAAMnzB,OAAOoB,EAAE4B,EAAK5B,GAAG,EACjD9C,KAAKspB,OAAOsB,OAAOyR,OAAOr8B,KAAKspB,OAAOuL,MAAM/xB,IAC5C9C,KAAKspB,OAAOsB,OAAO6R,SAASz8B,KAAKspB,OAAOuL,MAAM/xB,IAC9C9C,KAAKspB,OAAOsB,OAAOmS,SAAS/8B,KAAKspB,OAAOuL,MAAM/xB,IAC9C9C,KAAKspB,OAAOsB,OAAOyS,IAAIr9B,KAAKspB,OAAOuL,MAAM/xB,IAGjD,IAAI2H,EAAMzK,KAAKspB,OAAOgO,OAAOt3B,KAAMA,KAAKspB,OAAOuL,OAK/C,OAJA70B,KAAKC,IAAIq2B,cAAe,EACxBt2B,KAAKC,IAAIm4B,qBAAuBiS,EAEhCrqC,KAAKC,IAAImR,cAActN,QAAQkmC,GACxBv/B,CACX,EAgBApL,EAAIkrC,mBAAqB,SAAUC,EAAcC,EAAgBt3B,GAE7D,QAAIkjB,IAAcr2B,KAAKgpB,SAAS9nB,IAAI,4BAC5BspC,GAEOC,IAAmBzqC,KAAKC,IAAIyqC,eADnC1qC,KAAKC,IAAIkrB,iBAAmBnrB,KAAKgpB,SAAS9nB,IAAI,4BAGtCupC,GAAmBzqC,KAAKC,IAAIyqC,gBAAiD,gBAA/B1qC,KAAKgpB,SAAS9nB,IAAIuhC,SAGxEziC,KAAKC,IAAIkrB,iBAAmBnrB,KAAKgpB,SAAS9nB,IAAI2hC,iBAF9C7iC,KAAKC,IAAIkrB,iBAAmBnrB,KAAKgpB,SAAS9nB,IAAI,iCAI/C,GAAIlB,KAAKC,IAAI0qC,yBAChB3qC,KAAKC,IAAIkrB,iBAAmBnrB,KAAKgpB,SAAS9nB,IAAI0pC,0BAE9C,GAAI5qC,KAAKC,IAAIyqC,gBAAsC,YAApB1qC,KAAKkB,IAAIC,QAAwBnB,KAAKkB,IAAI2gB,cAAgBxiB,EAAIqJ,QACzF1I,KAAKC,IAAIkrB,iBAAmB,UACzB,GAAInrB,KAAKC,IAAI6gC,aAAa3tB,EAAM,GAAI,CAGvC,IAAI03B,EAAc7qC,KAAKC,IAAI8gC,aAAa/gC,KAAKC,IAAIoN,MAAMrN,KAAKC,IAAI6gC,aAAa3tB,EAAM,IAC/E03B,GAAeA,EAAYhzB,YAC3B7X,KAAKC,IAAIkrB,iBAAmB0f,EAAYhzB,UAEhD,MAAY7X,KAAKC,IAAIkrB,mBAEjBnrB,KAAKC,IAAIkrB,iBAAmB,IA+BpC,OAAOnrB,KAAKC,IAAIkrB,gBACpB,EAMA9rB,EAAIoqC,mBAAqB,SAAUhZ,EAAWzH,GAC1C,IAAI1I,EAAQwqB,EAASC,EAAU33B,EAAKD,EAAKjQ,EAAMunC,EAAgBhZ,EAAiBuZ,EAAWC,EAAQ1T,EAAStzB,EAAMmb,EAAMD,EAAMhG,EAAK+xB,EAAgB1T,EAAS2T,EAAc3H,EAAY4H,EAAYC,EAC9LC,EAAkB,GACtBtrC,KAAKspB,OAAOtoB,iBAAmB,IAAI3B,EAAI2B,iBAAiBhB,MACpDgpB,IACAwa,EAAaxa,EAASwa,WACtB4H,EAA0C,gBAA7BpiB,EAAS8a,WAAWt2B,QAA2Bwb,EAAS8a,WAAWt2B,KACxD,SAApBxN,KAAKkB,IAAIC,SACTkqC,EAA8C,oBAA7BriB,EAAS8a,WAAWt2B,QAA+Bwb,EAAS8a,WAAWt2B,MAExFwb,EAAS8a,WAAW99B,SACpBslC,EAAkBjsC,EAAI0G,uBAAuB/F,KAAMgpB,EAAS8a,WAAW99B,UAG/EyqB,EAAYA,GAAwB,GACpCzwB,KAAKC,IAAIsrC,2BAA4B,EACrC/T,EAAUn4B,EAAI+N,cAAcpN,MAC5BA,KAAKC,IAAIoN,KAAO,WAChBrN,KAAKC,IAAIqiB,KAAO,WAChBhC,EAAS,GACTwqB,EAAU,GACV9qC,KAAKC,IAAIogC,iBAAmB,GAC5BrgC,KAAKC,IAAIqgC,gBAAkB,GAC3BtgC,KAAKC,IAAIsgC,gBAAkB,GAC3BvgC,KAAKC,IAAIurC,cAAgB,GACzBxrC,KAAKC,IAAI6gC,aAAe,GACnB9gC,KAAKC,IAAIq2B,eACVt2B,KAAKC,IAAIwrC,eAAiB,CACtBC,QAAS,CAAC,IAIlB,IAAIC,EAAoB3rC,KAAKspB,OAAOtoB,iBAAiBK,OAAOrB,KAAKgpB,SAAS9nB,IAAIyhC,cAAgB2I,GAG1F3W,GAA8B,EAalC,GAZI30B,KAAKgpB,SAAS9nB,IAAIyzB,8BAClBA,GAA8B,GAE9B6O,GAGIxjC,KAAKyT,SAASkwB,YAAYsB,aAAazB,GAAYM,WAAW,mCAC9DnP,GAA8B,GAKd,SAApB30B,KAAKkB,IAAIC,OAAmB,CAM5B,IALA,IAAIyqC,EAAW,GACXC,GAAY,EAEZC,GAAS,EACTxqC,EAAM,GACDE,EAAE,EAAGC,EAAOgvB,EAAU/uB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACrD,IAAI2D,EAAOsrB,EAAUjvB,GAAG,GAAG2D,KACvBlD,EAAQwuB,EAAUjvB,GAAG,GAAGS,MACxB8lC,EAAWtX,EAAUjvB,GAAG,GAAGumC,SAC3B1Z,EAAKoC,EAAUjvB,GAAG,GAAG6sB,GACrBpsB,GAAkB,eAATkD,GAAyBkpB,IAAOyd,GAAU/D,IAE/C9lC,IAAU4pC,GAAiC,IAApBD,EAASlqC,SAChCJ,EAAM,GACNsqC,EAASjnC,KAAKrD,IAElBA,EAAIqD,KAAK8rB,EAAUjvB,GAAG,KAE1BqqC,EAAY5pC,EACG8lC,EACf+D,EAASzd,CACb,CAEA,IAAK7sB,EAAE,EAAGC,EAAKmqC,EAASlqC,OAAQF,EAAIC,EAAMD,GAAK,EAE3C,MADAF,EAAMsqC,EAASpqC,IACPE,OAAS,GAAjB,CAIA,IAAIqqC,EAAwBzqC,EAAIkC,OAAO,GAAG,GAAGH,QAC7C,GAAI0oC,EACA,IAAK,IAAIjpC,EAAE,EAAG4B,EAAKpD,EAAII,OAAS,EAAGoB,EAAI4B,EAAM5B,GAAK,EAC1CxB,EAAIwB,GAAGO,UACP0oC,GAAwB,GAKhCA,IACAzqC,EAAI,GAAG+B,QAAU0oC,SACVzqC,EAAIkC,OAAO,GAAG,GAAGH,QACxB/B,EAAI,GAAGovB,MAAQpvB,EAAIkC,OAAO,GAAG,GAAGktB,MAC5BpvB,EAAIkC,OAAO,GAAG,GAAGktB,cACVpvB,EAAIkC,OAAO,GAAG,GAAGktB,MAhBhC,CAoBR,CAeA,IAdAqa,EAAW,GACX33B,EAAMqd,EAAU/uB,OACZ+uB,EAAU,IAAMA,EAAU,GAAG,KACzB2a,UACO3a,EAAU,GAAG,GAAG,mBACvBA,EAAU,GAAG,GAAG,gBAAiB,GAC1B4a,WACA5a,EAAU,GAAG,GAAG,eACvBA,EAAU,GAAG,GAAG,oBAAqB,IAGzCzwB,KAAKkB,IAAIqT,SAASC,QAClBxU,KAAKuU,SAASuyB,cAAcrW,GAE3Btd,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAAG,CAG/BnT,KAAKC,IAAI+rC,WAAa74B,EAEtBlP,EAAOwsB,EAAUtd,GAAK,GACtBjQ,EAAOutB,EAAUtd,GAAK,GACtBjQ,EAAO7D,EAAI4D,aAAa+b,KAAKhf,KAAMkD,GACnCunC,EAAiBzqC,KAAKC,IAAIyqC,eAC1B,IAAIF,GAAe,EAQnB,GAPIr3B,EAAM,GAAKsd,EAAUtd,EAAI,GAAG,KAC5Bq3B,IAAiB/Z,EAAUtd,EAAI,GAAG,GAAG9P,SAEzCouB,EAAS,CAAC,EAGVzxB,KAAKC,IAAI8wB,eAAiB,CAAC,GACtB/wB,KAAKC,IAAIq2B,cAAgBt2B,KAAKkB,IAAI+qC,mBAAoB,CACvD,IAAI3iB,EAAStpB,KAAKspB,OAClBtpB,KAAKspB,OAAS,IAAIjqB,EAAI2N,OAAOuc,MAAMvpB,MACnCA,KAAKspB,OAAOsB,OAAS,IAAIvrB,EAAI2N,OAAOuc,MAAMqB,OAC1CvrB,EAAIknC,iBAAiBvnB,KAAKhf,KAAMiE,EAAM,MAAM,EAAOf,GACnDlD,KAAKspB,OAASA,CAClB,CA+BA,GA7BAtpB,KAAKC,IAAI+2B,qBAAsB,EAI3B7jB,EAAM,EACN9T,EAAIirC,QAAQtrB,KAAKhf,KAAMiE,EAAMf,EAAM,GAAKutB,EAAWtd,EAAM,GAAI,GAAGkb,IAAI,IAEpEruB,KAAKC,IAAIsG,kBAAmB,EAC5BlH,EAAIirC,QAAQtrB,KAAKhf,KAAMiE,EAAMf,EAAM,MAAM,IAIxClD,KAAKC,IAAI+sB,uBACVme,EAAe,CACX3H,WAAY,GAAKxjC,KAAKC,IAAIspC,YAC1B7hB,MAAO1nB,KAAKC,IAAIopC,aAChBtF,UAAW/jC,KAAKC,IAAIqpC,oBACpB4C,OAAQ,GAAKjoC,EAAKoqB,GAClB8d,kBAAmBh5B,EACnBi5B,WAAY/sC,EAAIuH,wBAEpB5G,KAAKC,IAAIykC,gBAAgB//B,KAAKwmC,IAElC1Z,EAAOtG,iBAAmB9rB,EAAIkrC,mBAAmBvrB,KAAKhf,KAAMwqC,EAAcC,EAAgBt3B,GAEtFjQ,GAAQA,EAAK,iBACblD,KAAKC,IAAIm4B,sBAAuB,GAGhCjlB,EAAM,EAAG,CAKT,IAAIk5B,GAJJnB,EAAiBza,EAAUtd,EAAM,GAAG,IAIc1M,QAAU,CAAC,IAAK,IAAK,KAAK1D,QAAQmoC,EAAezkC,OAAOjD,OAAO,KAAO,EACpH8oC,GAAkCpB,EAAezkC,QAAUvD,EAAK8C,QAAU,CAAC,IAAK,IAAK,KAAKjD,QAAQG,EAAK8C,OAAOxC,MAAM,EAAG,KAAO,EAClI,GAAI6oC,GAAgCC,EAAgC,CAChE,IAAIC,EAAW9a,EAAOtG,iBAAiBpoB,QAAQ,KAE3C0uB,EAAOtG,iBADPohB,GAAY,IAAMD,EACQ7a,EAAOtG,iBAAiB3nB,MAAM+oC,GAE9B,EAElC,CACJ,CASA,GARA9a,EAAO2G,qBAAuBp4B,KAAKC,IAAIm4B,qBACvC3G,EAAOiZ,eAAiB1qC,KAAKC,IAAIyqC,eAMjCK,EAASpmC,KAAK8sB,GACVvuB,EAAK,eACL,KAER,CAOAq0B,EAAUv3B,KAAKspB,OAAOuL,MAAMrxB,QAE5B,IAAIgpC,EAAkB,GAClBxjB,IACAwjB,EAAkBntC,EAAImH,wBAAwBxG,KAAMgpB,EAAS8a,WAAWr9B,SAE5E,IAAIA,EAASzG,KAAKgpB,SAAS9nB,IAAI0hC,cAC3B6J,EAAczsC,KAAKC,IAAI6gC,aAAa9gC,KAAKC,IAAI6gC,aAAap/B,OAAS,GAGnE+qC,GAAezsC,KAAKC,IAAI8gC,aAAa/gC,KAAKC,IAAIoN,MAAMo/B,IAAgBzsC,KAAKC,IAAI8gC,aAAa/gC,KAAKC,IAAIoN,MAAMo/B,GAAahmC,SACtHA,EAASzG,KAAKC,IAAI8gC,aAAa/gC,KAAKC,IAAIoN,MAAMo/B,GAAahmC,QAE3DpH,EAAIgH,qBAAqB7C,MAAM,GAAI,GAAGT,QAAQ0D,EAAOjD,MAAM,EAAG,KAAO,IACrEiD,EAASA,EAAOjD,MAAM,EAAG,IAG7BiD,EAASzG,KAAKspB,OAAOtoB,iBAAiBK,OAAOmrC,EAAkB/lC,GAG/D,IAASjF,EAAE,EAAEC,EAAKzB,KAAKspB,OAAOuL,MAAMnzB,OAAOF,EAAEC,EAAKD,GAAG,EACjDnC,EAAI2N,OAAOuc,MAAMqQ,gBAAgB55B,KAAKspB,OAAOuL,MAAMrzB,IAcvD,IAZKxB,KAAKC,IAAIm4B,sBAAwBp4B,KAAKspB,OAAOuL,MAAMnzB,SAC9C1B,KAAKkB,IAAIiC,uBAAuBu7B,wBAC7B1+B,KAAK4T,IAAI84B,oBACP1sC,KAAKC,IAAIq2B,cACO,aAAlBt2B,KAAKC,IAAIoN,OAETsnB,IACD30B,KAAKspB,OAAOuL,MAAM70B,KAAKspB,OAAOuL,MAAMnzB,OAAS,GAAGoQ,QAAQrL,OAASA,GAErEzG,KAAKspB,OAAOuL,MAAM,GAAG/iB,QAAQ9L,OAAS2lC,IAG1C3rC,KAAKkB,IAAIiC,uBAAuBq7B,mBAChC,IAAS17B,EAAE,EAAE4B,EAAK1E,KAAKspB,OAAOuL,MAAMnzB,OAAOoB,EAAE4B,EAAK5B,GAAG,EAEjD9C,KAAKspB,OAAOsB,OAAOyR,OAAOr8B,KAAKspB,OAAOuL,MAAM/xB,IAE5C9C,KAAKspB,OAAOsB,OAAO6R,SAASz8B,KAAKspB,OAAOuL,MAAM/xB,IAE9C9C,KAAKspB,OAAOsB,OAAOmS,SAAS/8B,KAAKspB,OAAOuL,MAAM/xB,IAE9C9C,KAAKC,IAAI0sC,SAAW3sC,KAAKspB,OAAOsB,OAAOyS,IAAIr9B,KAAKspB,OAAOuL,MAAM/xB,IAKrE,IAAKqQ,EAAM,EAAGC,EAAMmkB,EAAQ71B,OAAQyR,EAAMC,EAAKD,GAAO,EAAG,CACrD,IAAIy5B,EAAS,GAkBb,GAjBA5sC,KAAKspB,OAAOuL,MAAQ,CAAC0C,EAAQpkB,IAC7BnT,KAAKC,IAAIm4B,qBAAuB2S,EAAS53B,GAAKilB,qBAC9Cp4B,KAAKC,IAAIkrB,iBAAmB4f,EAAS53B,GAAKgY,iBAKtCoM,EAAQpkB,GAAK05B,qBACb7sC,KAAKC,IAAIkrB,iBAAmBoM,EAAQpkB,GAAK05B,oBAE7C7sC,KAAKC,IAAIyqC,eAAiBK,EAAS53B,GAAKu3B,eAExCM,EAAYhrC,KAAKspB,OAAOgO,OAAOt3B,KAAMA,KAAKspB,OAAOuL,OAEjD70B,KAAKC,IAAIm4B,sBAAuB,EAG5B,iBAAoB4S,EASpB,OARAhrC,KAAKC,IAAIm4B,sBAAuB,EAC3B4S,IACGhrC,KAAKkB,IAAIiC,uBAAuB47B,eAChC1/B,EAAIE,MAAM,oCAEVyrC,EAAY,qBAGbA,EAEX,GAAI,iBAAoBA,GAAkC,IAArBA,EAAUtpC,SAAiBwB,EAAK,mBACjE,GAAY,IAARiQ,EAAW,CACX,IACI25B,EAAiB,IAAR35B,EAAYqkB,EAAQx3B,KAAKgpB,SAAS9nB,IAAIyhC,eAAiB,GAChEoK,EAAS55B,IAASokB,EAAQ71B,OAAS,EAAK81B,EAAQx3B,KAAKgpB,SAAS9nB,IAAI0hC,eAAiB,GACvFoI,EAAUrmC,KAAKmoC,EAHF,qDAGoBC,EACrC,MAAO,GAAI55B,IAAQokB,EAAQ71B,OAAS,EAAG,CACnC,IAAIsrC,EAASlC,EAAQA,EAAQppC,OAAS,GAChB,iBAAXsrC,EACPlC,EAAQA,EAAQppC,OAAQ,IAAO81B,EAAQx3B,KAAKgpB,SAAS9nB,IAAI0hC,eAChC,iBAAXoK,IACdA,EAAOl7B,QAAQrL,QAAW+wB,EAAQx3B,KAAKgpB,SAAS9nB,IAAI0hC,eAE5D,CAEJ,GAAIgK,EAAOlrC,QAAU,iBAAoBspC,EAAU,GAAI,CACnDA,EAAUlgC,UACV,IAAImiC,EAASjC,EAAUhgC,MACnBiiC,GAAiC,MAAvBA,EAAOzpC,MAAM,EAAG,GAC1BopC,EAAOjoC,KAAKsoC,GACL,iBAAmBL,EAAOppC,OAAO,GAAG,IAAwC,MAAlCopC,EAAOppC,OAAO,GAAG,GAAGA,OAAO,GAC5EopC,EAAOjoC,KAAK,IAAMsoC,GACXA,GACPL,EAAOjoC,KAAK6yB,EAAQx3B,KAAKC,IAAIkrB,kBAAoB8hB,EAEzD,MACIjC,EAAUlgC,eAEN,KADJmgC,EAASD,EAAUhgC,SAEX4hC,EAAOlrC,QAAU,iBAAoBkrC,EAAOA,EAAOlrC,OAAS,KAC5DkrC,EAAOA,EAAOlrC,OAAS,IAAMupC,EAAOzS,kBAExCoU,EAAOjoC,KAAKsmC,IAMpB,IADA7rB,EAAO4rB,EAAUtpC,OACZyd,EAAO,EAAGA,EAAOC,EAAMD,GAAQ,EAE5B,iBADJhG,EAAM6xB,EAAU7rB,SAMZ,KADJ8rB,EAASD,EAAUhgC,QAEf4hC,EAAOjoC,KAAKsmC,GALZ2B,EAAOjoC,KAAK6yB,EAAQx3B,KAAKC,IAAIkrB,kBAAoBhS,GAQnC,IAAlByzB,EAAOlrC,QAAiB+uB,EAAUtd,GAAK,GAAG,oBAC/B,EAEXy5B,EAAOlrC,OAAS,GAA0B,iBAAdkrC,EAAO,KACnCA,EAAS,CAAC5sC,KAAKspB,OAAOqP,YAAYiU,KAElCA,EAAOlrC,SACH,iBAAoBkrC,EAAO,GACvBz5B,EAAM,IACNy5B,EAAO,GAAKpV,EAAQx3B,KAAKC,IAAIkrB,kBAAoByhB,EAAO,IAIxDA,EAAO,GAAG3T,cADV9lB,EAAM,EACoBnT,KAAKC,IAAIkrB,iBAET,IAItC2f,EAAUA,EAAQhlC,OAAO8mC,EAC7B,CAIA,IAFAtsB,GAAUtgB,KAAKspB,OAAOqP,YAAYmS,MAOzB9qC,KAAKC,IAAIm4B,qBAEV,IADAhlB,EAAMpT,KAAKgpB,SAAS9nB,IAAIqxB,mBAAmB7wB,OACtCyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAKV,YAJlBse,EAASzxB,KAAKgpB,SAAS9nB,IAAIqxB,mBAAmBpf,IAInC,KAGNjQ,GAASA,EAAK,iBACfod,EAAStgB,KAAK2D,IAAIyvB,SAAS3B,EAAO,IAAIA,EAAO,IAAIzxB,KAAMsgB,KAavE,OARAtgB,KAAKC,IAAIm4B,sBAAuB,EAC3B9X,IACGtgB,KAAKkB,IAAIiC,uBAAuB47B,eAChC1/B,EAAIE,MAAM,oCAEV+gB,EAAS,qBAGVA,CACX,EAcAjhB,EAAIirC,QAAU,SAAUrmC,EAAMf,EAAMgqC,EAAYC,GAC5C,IAAI/sB,EAAM+qB,EACNiC,EAAWptC,KAAKC,IAAIoN,KAcxB,IAbInK,GAAQA,EAAK,gBAAkBlD,KAAKopB,QAAUppB,KAAKopB,OAAO7G,OAAO7gB,OAAS,IACtE1B,KAAKC,IAAIoN,KAAO,UAExBrN,KAAKC,IAAI+sB,sBAAuB,EAChChtB,KAAKC,IAAIotC,6BAA8B,EACvCrtC,KAAKC,IAAIitC,WAAaA,EAEtB7tC,EAAIiuC,UAAUtuB,KAAKhf,KAAMiE,EAAMf,EAAMiqC,GACrC/sB,EAAO,EACPpgB,KAAKC,IAAIstC,UAAY,CAAC,EACtBvtC,KAAK8yB,WAAa,IAAIzzB,EAAImuC,WAAWxtC,KAAMiE,EAAMf,GAG1Ckd,EAAOpgB,KAAKA,KAAKC,IAAIoN,MAAMkV,OAAO7gB,QACrC0e,EAAO/gB,EAAI8gB,UAAUnB,KAAKhf,KAAMA,KAAKA,KAAKC,IAAIoN,MAAMkV,OAAOnC,GAAOnc,EAAMf,GAgB5E,OAbA7D,EAAIouC,QAAQzuB,KAAKhf,KAAMiE,EAAMf,GAExBlD,KAAKC,IAAI+sB,sBAAyBhtB,KAAKC,IAAIq2B,cACtB,iBAAlBt2B,KAAKC,IAAIoN,OACT89B,EAAe,CACXzjB,MAAO1nB,KAAKC,IAAIytC,iBAChBxB,OAAQ,GAAKjoC,EAAKoqB,GAClB+d,WAAY/sC,EAAIuH,wBAEpB5G,KAAKC,IAAI0tC,oBAAoBhpC,KAAKwmC,IAG1CnrC,KAAKC,IAAIoN,KAAO+/B,EACT,GAAKnpC,EAAKoqB,EACrB,EAGAhvB,EAAIiuC,UAAY,SAAUrpC,EAAMf,EAAMiqC,GAElC,GADAntC,KAAKC,IAAIC,WAAa,GAClB+D,EAAK6qB,SAAU,CAEf,IAAIrrB,EAAIQ,EAAK6qB,SAASprB,MAAM,kBACxBD,GACAzD,KAAKC,IAAIC,WAAWyE,KAAKlB,EAAE,GAAGnD,cAEtC,CA8BA,GA7BAN,KAAKC,IAAIC,WAAWyE,KAAK3E,KAAKkB,IAAIqB,MAC7B4qC,IACDntC,KAAKC,IAAI8wB,eAAiB,CAAC,GAG/B/wB,KAAKC,IAAI2tC,mBAAqB,EAC9B5tC,KAAKC,IAAI4tC,oBAAsB,EAC/B7tC,KAAKC,IAAI6tC,8BAA+B,EACnC9tC,KAAKC,IAAIm4B,qBAGVp4B,KAAKC,IAAI8tC,iCAAkC,EAF3C/tC,KAAKC,IAAI8tC,iCAAkC,EAI/C/tC,KAAKC,IAAI+tC,QAAU,GACG,aAAlBhuC,KAAKC,IAAIoN,MAAuBrN,KAAKgpB,SAAS9nB,IAAIuhC,UAAYziC,KAAKgpB,SAAS9nB,IAAIuhC,SAAS/gC,OAEzF1B,KAAKC,IAAIyqC,gBAAiB,EAE1B1qC,KAAKC,IAAIyqC,gBAAiB,EAE9B1qC,KAAKC,IAAImiC,aAAc,EACnBpiC,KAAKC,IAAI4f,mBAAuB7f,KAAKC,IAAIguC,kBACzCjuC,KAAKC,IAAI6f,kBAAoB9f,KAAKC,IAAI4f,iBAC/B7f,KAAKyT,SAASA,SAASxP,EAAKoqB,MAASruB,KAAKC,IAAIguC,mBACrDjuC,KAAKC,IAAI4f,iBAAmB7f,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAC5DtlC,KAAKC,IAAI6f,kBAAoB9f,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,UAE7DtlC,KAAKC,IAAI6f,kBAAoB,IAAIzgB,EAAIuhC,YAEnB,aAAlB5gC,KAAKC,IAAIoN,KACT,GAAKrN,KAAKyT,SAASA,SAASxP,EAAKoqB,KAI7B,GADAruB,KAAKC,IAAIiuC,iBAAmB7uC,EAAImgB,iBAAiBxf,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,UAC3D,iBAAlBtlC,KAAKC,IAAIoN,MAA2BrN,KAAKC,IAAI6f,mBAAqB9f,KAAKC,IAAIguC,oBACvEjuC,KAAKkB,IAAI,4BACTlB,KAAKC,IAAI6f,kBAAkB/a,MAAQ/E,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASvgC,MAAMvB,QAC9ExD,KAAKC,IAAI4f,mBACT7f,KAAKC,IAAI4f,iBAAiB9a,MAAQ/E,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASvgC,MAAMvB,UAGrFxD,KAAKkB,IAAI,+BAA+B,CAExClB,KAAKC,IAAI4f,iBAAmB7f,KAAKC,IAAI6f,kBACrC9f,KAAKC,IAAI6f,kBAAkBT,OAASrf,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7b,QACpFxD,KAAKC,IAAI4f,iBAAiBR,OAASrf,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7b,QACnF,IAAK,IAAIhC,EAAE,EAAEC,EAAKzB,KAAKC,IAAI6f,kBAAkBT,OAAO3d,OAAOF,EAAEC,EAAKD,GAAG,EACjExB,KAAKC,IAAI6f,kBAAkBT,OAAO7d,GAAKxB,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7d,GAAGgC,QAE9F,IAAShC,EAAE,EAAEC,EAAKzB,KAAKC,IAAI4f,iBAAiBR,OAAO3d,OAAOF,EAAEC,EAAKD,GAAG,EAChExB,KAAKC,IAAI4f,iBAAiBR,OAAO7d,GAAKxB,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7d,GAAGgC,OAEjG,OArBJxD,KAAKC,IAAIiuC,iBAAmB,IAAI7uC,EAAIuhC,YA0B5C5gC,KAAKC,IAAIwgC,WAAa,GACtBzgC,KAAKC,IAAIy/B,gBAAkB,EAC3B1/B,KAAKC,IAAIugC,WAAa,GACtBxgC,KAAKC,IAAI+f,UAAUmuB,QACdnuC,KAAKC,IAAIq2B,cACLpzB,GAA0B,UAAlBA,EAAKqR,UAAyBrR,EAAKqR,WAC5CvU,KAAKC,IAAIwrC,eAAiB,CACtBC,QAAS,CAAC,IAKtB1rC,KAAKC,IAAIkrB,iBAAmBnrB,KAAKA,KAAKC,IAAIoN,MAAMnM,IAAI2hC,iBAGpD7iC,KAAK8oB,kBAAkBte,KAAO,GAC9BxK,KAAK4oB,cAAcpe,KAAO,GAE1BxK,KAAKC,IAAImuC,sBAAuB,EAChCpuC,KAAKC,IAAIouC,kBAAmB,GAGvBruC,KAAKC,IAAIq2B,cAAgBpzB,IAASA,EAAK6kC,UAAY/nC,KAAKyT,SAASA,SAASxP,EAAKoqB,MAChFruB,KAAKC,IAAIiuC,iBAAmB7uC,EAAImgB,iBAAiBxf,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,WAIrFtlC,KAAKC,IAAIquC,mBAAoB,EAC7BtuC,KAAKC,IAAI+gC,oBAAsB,CACnC,EAEA3hC,EAAIouC,QAAU,SAAUxpC,EAAMf,GAE1B,GAAIlD,KAAKC,IAAIiuC,kBAAoBluC,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAK,CAC9DruB,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASvgC,MAAQ/E,KAAKC,IAAIiuC,iBAAiBnpC,MAAMvB,QACjFxD,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAASrf,KAAKC,IAAIiuC,iBAAiB7uB,OAAO7b,QACnF,IAAK,IAAIhC,EAAE,EAAEC,EAAKzB,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO3d,OAAOF,EAAEC,EAAKD,GAAG,EAC/ExB,KAAKyT,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7d,GAAKxB,KAAKC,IAAIiuC,iBAAiB7uB,OAAO7d,GAAGgC,OAEjG,CAyBA,GAxBAxD,KAAKC,IAAIiuC,kBAAmB,EAExBhrC,GAAQA,EAAKuD,OAEbzG,KAAKC,IAAIogC,iBAAmBn9B,EAAKuD,OAEjCzG,KAAKC,IAAIogC,iBAAmB,GAEhCrgC,KAAKC,IAAIsgC,gBAAkBvgC,KAAKC,IAAIugC,WAAWh9B,QAC/CxD,KAAKC,IAAIqgC,gBAAkBtgC,KAAKC,IAAIwgC,WAAWj9B,QAC/CxD,KAAKC,IAAIsuC,SAAU,EAUnBvuC,KAAKC,IAAI4f,kBAAmB,EAE5B7f,KAAKC,IAAI6gC,aAAan8B,KAAK3E,KAAKC,IAAIouC,kBAEhCruC,KAAKC,IAAIuuC,aAAexuC,KAAKC,IAAIwuC,0BAA2B,CAC5D,IAAI5U,EAAM,GACV,IAASr4B,EAAIxB,KAAKC,IAAIuuC,YAAYnd,KAAK3vB,OAAS,EAAGF,EAAIxB,KAAKC,IAAIuuC,YAAYr7B,IAAK3R,IAAM,EACnFq4B,EAAIl1B,KAAK3E,KAAKC,IAAIuuC,YAAYnd,KAAKrmB,OAKvC,IAFAhL,KAAKC,IAAIuuC,YAAYnd,KAAKrmB,MAErBxJ,EAAIq4B,EAAIn4B,OAAS,EAAGF,GAAK,EAAGA,IAAM,EACnCxB,KAAKC,IAAIuuC,YAAYnd,KAAK1sB,KAAKk1B,EAAI7uB,MAE3C,CACAhL,KAAKC,IAAIuuC,aAAc,EACvBxuC,KAAKC,IAAIwuC,2BAA4B,CAEzC,EAIApvC,EAAI4nB,OAAOjS,UAAU05B,iBAAmB,SAAUC,GAC9C,IAAWlkC,EAAKgnB,EAAmBvuB,EAAMkQ,EAAKD,EAAuBy7B,EAAWC,EAEhF,IADQ,GACHF,IAAe3uC,KAAKkpB,aAAahoB,IAAI4tC,eAAiB9uC,KAAKkpB,aAAahoB,IAAI6tC,qBAAsB,CAInG,GAHAJ,EAAa,CACTK,QAAS,IAEThvC,KAAKkpB,aAAahoB,IAAI4tC,cACtB,IAAK,IAAIttC,KAAKxB,KAAKkpB,aAAahoB,IAAI4tC,cAAe,CAC/C,IAAI5pC,EAAMlF,KAAKkpB,aAAahoB,IAAI4tC,cAActtC,GAC9CmtC,EAAWK,QAAQrqC,KAAK,CACpB+pB,MAAO,OACPzd,MAAO/L,GAEf,CAEJ,GAAIlF,KAAKkpB,aAAahoB,IAAI6tC,oBACtB,IAAK,IAAIvtC,KAAKxB,KAAKkpB,aAAahoB,IAAI6tC,oBAAqB,CACrD,IAAIrgB,EAAQ1uB,KAAKkpB,aAAahoB,IAAI6tC,oBAAoBvtC,GACtDmtC,EAAWK,QAAQrqC,KAAK,CACpB+pB,MAAOA,EAAOzd,OAAO,GAE7B,CAER,CAEA,IAAKjR,KAAKkpB,aAAa3G,OAAO7gB,OAC1B,OAAO,EAEP,iBAAoBitC,IACpB3uC,KAAKkB,IAAIi9B,qBAAuBwQ,EAChCA,GAAa,GA0BjBC,GADAnkC,EAAMpL,EAAI4vC,uBAAuBjwB,KAAKhf,KAAM2uC,IAC5B,GAChBE,EAAgBpkC,EAAI,GAGpB,IAAIykC,EAAOzkC,EAAI,GAgBf,IAdAgnB,EAAS,CACL,UAAa,EACb,aAAgBzxB,KAAKkpB,aAAahoB,IAAI,iBACtC,YAAelB,KAAKkpB,aAAahoB,IAAI,gBACrC,sBAAsB,EACtB,UAAa0tC,EACb,oBAAuB5uC,KAAKC,IAAI0tC,oBAAoBnqC,QACpD,KAAQ0rC,GAERlvC,KAAKkpB,aAAahoB,IAAI,wBACtBuwB,EAAO,sBAAwBzxB,KAAKkpB,aAAahoB,IAAI,uBAE7C,EACZkS,EAAMpT,KAAKyT,SAASoxB,QAAQnjC,OACvByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,GAC5BjQ,EAAOlD,KAAKyT,SAASoxB,QAAQ1xB,IACpBrO,OAAS2sB,EAAO0d,YACrB1d,EAAO0d,UAAYjsC,EAAK4B,QAUhC,OAPI9E,KAAKkpB,aAAahoB,IAAIkuC,gBACtB3d,EAAO2d,cAAgBpvC,KAAKkpB,aAAahoB,IAAIkuC,eAEjD3d,EAAO4d,SAAWrvC,KAAK2D,IAAIyvB,SAASic,SACpC5d,EAAO6d,OAAStvC,KAAK2D,IAAIyvB,SAASkc,OAElCtvC,KAAKkB,IAAIi9B,sBAAuB,EACzB,CAAC1M,EAAQod,EACpB,EAKAxvC,EAAI4vC,uBAAyB,SAAUN,GACnC,IAAIlkC,EAAK8kC,EAAOC,EAASC,EAAUC,EAAUC,EAAW17B,EAAK/Q,EAAM0sC,EAAM7hB,EAAOD,EAAO+hB,EAAUC,EAAuBtuC,EAAGC,EAAMsuC,EAAUC,EAAOzK,EAAqB0K,EAuDnKC,EApCJ,SAASC,EAAYrxB,EAAGC,GACpB,OAAID,IAAMC,CAId,CAUA,SAASqxB,EAAUtxB,EAAGC,GAClB,MAAI,kBAAqBD,GAAMA,EAOvB,iBAAoBC,EACboxB,EAAYrxB,EAAGC,KACdA,GAnBpB,SAAmBD,EAAGxd,GAElB,IADAysB,EAAQzsB,EAAII,OACPosB,EAAQ,EAAGA,EAAQC,EAAOD,GAAS,EACpC,GAAIqiB,EAAYrxB,EAAGxd,EAAIwsB,IACnB,OAAO,EAGf,OAAO,CACX,CAcmBuiB,CAAUvxB,EAAGC,GAXpBD,IACSC,GAEDA,CAWpB,CAMA,GAvDAtU,EAAM,GACNwlC,EAAkB,GAClBjwC,KAAKC,IAAIoN,KAAO,eAChBrN,KAAKC,IAAIqiB,KAAO,eAChBtiB,KAAKC,IAAIqwC,oBAAqB,EAC9BtwC,KAAKC,IAAI0tC,oBAAsB,GAC/B3tC,KAAKC,IAAIytC,iBAAmB,EAMxB6B,EADAZ,GAAcA,EAAW4B,YAAc5B,EAAW6B,YAC1CxwC,KAAKyT,SAASg9B,eAEdzwC,KAAKguB,aAAahuB,KAAKyT,SAASg9B,gBAG5CzwC,KAAKC,IAAIguC,mBAAoB,EAkC7B+B,EAAQ,CAAC,EAILrB,GAAcA,EAAW4B,YAAc5B,EAAW6B,cAClDN,EAAkB,GACY,IAA1BvB,EAAW4B,YACX,IAAK/uC,EAAI,EAAGC,EAAO8tC,EAAM7tC,OAAQF,EAAIC,IACjCuuC,EAAMT,EAAM/tC,KAAM,EACdmtC,EAAW4B,YAAchB,EAAM/tC,IAFIA,GAAK,GASxD,IAAIkvC,EAAqB,GAErBC,EAAkB,CAAC,EA4BvB,IA3BA3wC,KAAKC,IAAI2wC,qBAAuB,CAAC,EACjCrB,EAAQA,EAAM39B,QAAOC,IACjB,IAAIpH,EAAMoH,EAoBV,OAnBIA,EAAE0d,eACEohB,EAAgB9+B,EAAE0d,gBAClB9kB,GAAM,EAENkmC,EAAgB9+B,EAAE0d,iBAAkB,EAEjC1d,EAAE6d,eACJ1vB,KAAKC,IAAI2wC,qBAAqB/+B,EAAE6d,gBACjC1vB,KAAKC,IAAI2wC,qBAAqB/+B,EAAE6d,cAAgB,GAEpD1vB,KAAKC,IAAI2wC,qBAAqB/+B,EAAE6d,gBAC5B1vB,KAAKkpB,aAAahoB,IAAI2vC,uBAAuB9tC,QAAQ8O,EAAE1M,OAAS,IAC5DwrC,EAAgB9+B,EAAE6d,cAClBjlB,GAAM,EAENkmC,EAAgB9+B,EAAE6d,eAAgB,IAIvCjlB,CAAG,IAGdzK,KAAKC,IAAI6wC,mBAAqB,CAAC,EAE1BtvC,EAAI,EAAGC,EAAO8tC,EAAM7tC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAG/C,GAAImtC,GAAcA,EAAW4B,YAAc5B,EAAW6B,YAAa,CAC/D,GAAIR,EAAMT,EAAM/tC,IACZ,SAGJ,GADA0B,EAAOlD,KAAKkuB,YAAYqhB,EAAM/tC,IAC1B0uC,IAAoBvB,EAAW6B,YAC/B,KAER,MAEI,GAAIR,GADJ9sC,EAAOqsC,EAAM/tC,IACE6sB,IACX,SAGR,GAAIsgB,EAAY,CAEZ,GADAa,GAAU,EACNb,EAAWa,SAKX,IADAA,GAAU,EACL1sC,EAAI,EAAG4B,EAAOiqC,EAAWa,QAAQ9tC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAEzD,GAAIstC,GADJR,EAAOjB,EAAWa,QAAQ1sC,IACPmO,MAAO/N,EAAK0sC,EAAKlhB,QAAS,CACzC8gB,GAAU,EACV,KACJ,OAED,GAAIb,EAAWK,QAAS,CAK3B,IADAS,GAAW,EACN3sC,EAAI,EAAG4B,EAAOiqC,EAAWK,QAAQttC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAEzD,GAAIstC,GADJR,EAAOjB,EAAWK,QAAQlsC,IACPmO,MAAO/N,EAAK0sC,EAAKlhB,QAAS,CACzC+gB,GAAW,EACX,KACJ,CAEAA,IACAD,GAAU,EAElB,MAAO,GAAIb,EAAWoC,OAAQ,CAM1B,IAFAvB,GAAU,EACVE,GAAW,EACN5sC,EAAI,EAAG4B,EAAOiqC,EAAWoC,OAAOrvC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAEnDstC,GADLR,EAAOjB,EAAWoC,OAAOjuC,IACLmO,MAAO/N,EAAK0sC,EAAKlhB,UACjCghB,GAAW,GAGfA,IACAF,GAAU,EAElB,CACA,GAAIb,EAAWqC,MAAO,CAKlB,IADAtB,GAAW,EACN5sC,EAAI,EAAG4B,EAAOiqC,EAAWqC,MAAMtvC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAElDstC,GADLR,EAAOjB,EAAWqC,MAAMluC,IACJmO,MAAO/N,EAAK0sC,EAAKlhB,UACjCghB,GAAW,GAGfA,IACAF,GAAU,EAElB,CACA,IAAKA,EACD,QAER,CA0BA,GApBItsC,EAAKwsB,eACA1vB,KAAKC,IAAI6wC,mBAAmB5tC,EAAKwsB,gBAClC1vB,KAAKC,IAAI6wC,mBAAmB5tC,EAAKwsB,cAAgB,GAErD1vB,KAAKC,IAAI6wC,mBAAmB5tC,EAAKwsB,kBAIrCigB,EAAY,IAAItwC,EAAI8hB,MAAM,QAAS9hB,EAAI0H,QAC7B4K,YAAc,CAAC,CAAC,gBAAiB,UAAU7L,OAAO9F,KAAKkpB,aAAahoB,IAAIqxB,oBAClFvyB,KAAKspB,OAAOyM,SAAS,YAAa4Z,GAC9BzsC,EAAK+tC,WAAajxC,KAAK4T,IAAIs9B,uBAC3BlxC,KAAKspB,OAAO4L,QAAQjkB,QAAQo2B,QAAUnkC,EAAK+tC,UAE3CjxC,KAAKspB,OAAO4L,QAAQjkB,QAAQggC,UAAY/tC,EAAKmrB,GAKjDyhB,EAAiB,IACb9vC,KAAKyT,SAASA,SAASvQ,EAAKmrB,IAAI8iB,QAC3BxC,GAAcA,EAAW4B,YAAc5B,EAAW6B,YA2B/CxwC,KAAKyT,SAASA,SAASvQ,EAAKmrB,IAAI0hB,WACxC/vC,KAAKC,IAAIsG,kBAAmB,EAC5BvG,KAAKC,IAAI+rC,WAAa,EACtB8D,EAAenrC,KAAK,GAAKtF,EAAIirC,QAAQtrB,KAAKhf,KAAMkD,IAC5CyrC,GAAcA,EAAW4B,YAAc5B,EAAW6B,cAClDN,GAAmB,QAhC8C,CAErE3K,EAAc,CAAC,CAACriC,EAAM,CAACmrB,GAAInrB,EAAKmrB,MAEhC,IAAK,IAAIvrB,EAAE,EAAE4B,GADbqrC,EAAW/vC,KAAKyT,SAASA,SAASvQ,EAAKmrB,IAAI0hB,UAChBruC,OAAQoB,EAAE4B,EAAM5B,IACxCyiC,EAAY5gC,KAAK,CAAC3E,KAAKkuB,YAAY6hB,EAASjtC,IAAK,CAACurB,GAAI0hB,EAASjtC,MAYlE,IATA9C,KAAKuU,SAASuyB,cAAcvB,GACxBvlC,KAAKyT,SAASA,SAASvQ,EAAKmrB,IAAI6R,4BAChClgC,KAAKspB,OAAOuL,MAAM,GAAG/iB,QAAQ+F,UAAY7X,KAAKyT,SAASA,SAASvQ,EAAKmrB,IAAI6R,4BAEzElgC,KAAKspB,OAAOuL,MAAM,GAAG/iB,QAAQ+F,UAAY,KAE7C7X,KAAKC,IAAIsG,kBAAmB,EAC5BvG,KAAKC,IAAI+rC,WAAa,EAEjBlpC,EAAI,EAAG4B,EAAO6gC,EAAY7jC,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC9CA,EAAKyiC,EAAY7jC,OAAS,EAC1B1B,KAAKC,IAAImxC,uBAAwB,SAE1BpxC,KAAKC,IAAImxC,sBAEpBtB,EAAenrC,KAAK,GAAKtF,EAAIirC,QAAQtrB,KAAKhf,KAAMulC,EAAYziC,GAAG,GAAIyiC,EAAYziC,GAAG,KAClF9C,KAAKC,IAAI+rC,aACTgE,EAAMzK,EAAYziC,GAAG,GAAGurB,KAAM,CAEtC,CAsCA,IA5BA4hB,EAAgBtrC,KAAK,IAErB3E,KAAKC,IAAIytC,kBAAoB,EAE7BgD,EAAmB/rC,KAAKmrC,GAKxB9vC,KAAKspB,OAAO2M,OAAO,aAMfj2B,KAAKspB,OAAOuL,MAAM,GAAGO,MAAM1zB,QAAU1B,KAAKspB,OAAOuL,MAAM,GAAGO,MAAM,GAAGA,MAAM1zB,UASrEmuC,EAHC7vC,KAAKspB,OAAOuL,MAAM,GAAGO,MAAM,GAAGA,MAAM,GAAGtjB,QAG7B9R,KAAKspB,OAAOuL,MAAM,GAAGO,MAAM,GAAGA,MAF9Bp1B,KAAKspB,OAAOuL,MAAM,GAAGO,OAI3B,GAAGtjB,QAAQ9L,OAAShG,KAAKkpB,aAAahoB,IAAIyhC,cAAgBkN,EAAS,GAAG/9B,QAAQ9L,QAEtFlD,EAAE,EAAE4B,EAAK1E,KAAKspB,OAAOuL,MAAMnzB,OAAOoB,EAAE4B,EAAK5B,GAAG,EAC7CzD,EAAI2N,OAAOuc,MAAMqQ,gBAAgB55B,KAAKspB,OAAOuL,MAAM/xB,IAGvD,IAAKA,EAAE,EAAE4B,EAAK1E,KAAKspB,OAAOuL,MAAMnzB,OAAOoB,EAAE4B,EAAK5B,GAAG,EAC7C9C,KAAKspB,OAAOsB,OAAOyR,OAAOr8B,KAAKspB,OAAOuL,MAAM/xB,IAC5C9C,KAAKspB,OAAOsB,OAAO6R,SAASz8B,KAAKspB,OAAOuL,MAAM/xB,IAC9C9C,KAAKspB,OAAOsB,OAAOmS,SAAS/8B,KAAKspB,OAAOuL,MAAM/xB,IAAG,GACjD9C,KAAKspB,OAAOsB,OAAOyS,IAAIr9B,KAAKspB,OAAOuL,MAAM/xB,IAe7C,KAFAmR,EAAMjU,KAAKspB,OAAOgO,OAAOt3B,KAAMA,KAAKspB,OAAOuL,OAAO,KAEtC70B,KAAKkB,IAAI2gB,cAAgBxiB,EAAIqJ,QAAS,CAC9C,IAAI2oC,EAAO5mC,EAAI/I,OAAS,EAAK,uDAC7BuS,EAAM5U,EAAI2N,OAAOU,QAAQ1N,KAAKkB,IAAIsM,MAAM,uBAAuBxN,KAAMqxC,EACzE,CACIp9B,GACAxJ,EAAI9F,KAAKsP,EAEjB,CAEA,IAAIi7B,GAAO,EACX,GAAIP,GAAcA,EAAW4B,YAAc5B,EAAW6B,YAAa,CAC/D,IAAIc,EAAmB/B,EAAM/rC,OAAO,GAAG,GACnC+tC,EAAeb,EAAmBltC,OAAO,GAAG,GAC3C8tC,GAAqBC,GAAgBD,GAAoBC,IAC1DrC,GAAO,EAEf,CAIA,OAHAlvC,KAAKC,IAAIguC,mBAAoB,EAGtB,CAACyC,EAAoBjmC,EAAKykC,EACrC,EAKA7vC,EAAI4nB,OAAOjS,UAAU4vB,cAAgB,SAAU5b,EAAUwoB,GACrD,IAAI/mC,EAAK4jB,EAAIojB,EAEb,GADAhnC,GAAM,GACDue,EAASwa,YAAcgO,EAAO,CAE/B,IADAnjB,EAAKqjB,KAAKC,MAAsB,KAAhBD,KAAKE,YACR,CAET,GADAH,EAAY,GACPzxC,KAAKyT,SAASkwB,YAAYsB,aAAa5W,GAAK,CAI7CrF,EAASwa,WAAa,IAAMnV,EAAGwjB,SAAS,IACxC,KACJ,CAMIxjB,GADc,KAJdojB,GADQA,GAAapjB,EAAK,KACd,GAEC,GAGP,GAEC,CAEf,CACA5jB,EAAM,GAAK4jB,CACf,CAEA,OADAruB,KAAKyT,SAASkwB,YAAYsB,aAAajc,EAASwa,YAAcxa,EACvDve,CACX,EAEApL,EAAI4nB,OAAOjS,UAAU88B,sBAAwB,SAAUjM,EAAWr4B,EAAMukC,GAY/DlM,IACDA,EAAY,IAEXr4B,IACDA,EAAO,QAIX,IAFA,IAAIwkC,EAAU,CAAC,EACXC,EAAU,GACLzwC,EAAE,EAAEC,EAAKokC,EAAUnkC,OAAOF,EAAEC,EAAKD,GAAG,EACzC,IAAK,IAAIsB,EAAE,EAAE4B,EAAKmhC,EAAUrkC,GAAG0jC,cAAcxjC,OAAOoB,EAAE4B,EAAK5B,GAAG,EAAG,CAC7D,IAAIopC,EAAS,GAAKrG,EAAUrkC,GAAG0jC,cAAcpiC,GAAGurB,GAC3C2jB,EAAQ9F,IACT+F,EAAQttC,KAAKunC,GAEjB8F,EAAQ9F,IAAU,CACtB,CAEJlsC,KAAK+lC,YAAYkM,GACjB,IAAIC,EAAM,GACNC,EAAO,GACP1nC,EAAM,GACN84B,EAAUvjC,KAAKkB,IAAIsM,KACvBxN,KAAK+rB,gBAAgBve,GACrB,IAAShM,EAAE,EAAEC,EAAKokC,EAAUnkC,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAG5C,IAAIyS,EAAMjU,KAAKyjC,uBAAuBoC,EAAUrkC,GAAG0wC,EAAIC,EAAK9yC,EAAIyH,6BAChEorC,EAAIvtC,KAAK,CAACkhC,EAAUrkC,GAAGgiC,WAAWqC,EAAUrkC,GAAGsiC,WAAWC,YAC1D,IAASjhC,EAAE,EAAE4B,EAAKuP,EAAI,GAAGvS,OAAOoB,EAAE4B,EAAK5B,GAAG,EAAG,CACzC,IAAI4kB,EAAQzT,EAAI,GAAGnR,GAAG,GACtB2H,EAAIid,GAAS,CACTwqB,EAAIxqB,GAAO,GACXwqB,EAAIxqB,GAAO,GACXzT,EAAI,GAAGnR,GAAG,GAElB,CACJ,CAGA,OAFA9C,KAAKoyC,mBAAmBL,GACxB/xC,KAAK+rB,gBAAgBwX,GACd94B,CACX,EAGApL,EAAI4nB,OAAOjS,UAAUq9B,sBAAwB,SAAUxM,GACnD,IAAIrkC,EAAGC,EAAMqB,EAAG4B,EAAMxB,EAAMe,EAAMyhC,EAAS4M,EAAcC,EAAUhN,EAenE+M,EAAe,GACfC,EAAW,GACN1M,IACDA,EAAY,IAGhB,IAAI2M,EAAe,GACfC,EAAc,CAAC,EACnB,IAAKjxC,EAAI,EAAGC,EAAOokC,EAAUnkC,OAAQF,EAAIC,EAAMD,GAAK,EAC5CixC,EAAY5M,EAAUrkC,GAAGgiC,aACzBxjC,KAAK4kC,cAAciB,EAAUrkC,IAAI,GAErCixC,EAAY5M,EAAUrkC,GAAGgiC,aAAc,EACvCgP,EAAa7tC,KAAKkhC,EAAUrkC,GAAGsiC,WAAWpc,OAI9C,IAAIgrB,EAAe7M,EAAUriC,QAY7B,IAXAkvC,EAAanf,MACT,SAAUzU,EAAEC,GACR,OAAID,EAAEglB,WAAWpc,MAAQ3I,EAAE+kB,WAAWpc,OAC1B,EACD5I,EAAEglB,WAAWpc,MAAQ3I,EAAE+kB,WAAWpc,MAClC,EAEA,CAEf,IAEClmB,EAAI,EAAGC,EAAOixC,EAAahxC,OAAQF,EAAIC,EAAMD,GAAK,EACnDkxC,EAAalxC,GAAGsiC,WAAWpc,MAAQlmB,EAEvC,IAAKA,EAAI,EAAGC,EAAOixC,EAAahxC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAEtD,IADA+jC,EAAc,GACTziC,EAAI,EAAG4B,EAAOguC,EAAalxC,GAAG0jC,cAAcxjC,OAAQoB,EAAI4B,EAAM5B,GAAK,OAEhE,KADJI,EAAOwvC,EAAalxC,GAAG0jC,cAAcpiC,IACLmjC,WAC5B/iC,EAAK+iC,SAAW,IAGpBP,EAAU,CADVzhC,EAAOjE,KAAKouB,aAAa,GAAKlrB,EAAKmrB,IAClBnrB,GACjBqiC,EAAY5gC,KAAK+gC,GACjBgN,EAAalxC,GAAG0jC,cAAcpiC,GAAGI,KAAOe,EACxCsuC,EAAS5tC,KAAK,GAAKzB,EAAKmrB,IAEvBqkB,EAAalxC,GAAGsiC,WAAWsC,UAC5Bb,EAAYhS,KAAKvzB,KAAKgpB,SAASuZ,IAAImE,sBAEvCgM,EAAalxC,GAAG+jC,YAAcA,EAE9BvlC,KAAKyT,SAASkwB,YAAYsB,aAAayN,EAAalxC,GAAGgiC,YAAckP,EAAalxC,EACtF,CAKA,IAHAxB,KAAK+lC,YAAYwM,GAGZ/wC,EAAI,EAAGC,EAAOokC,EAAUnkC,OAAQF,EAAIC,EAAMD,GAAK,EAChD8wC,EAAa3tC,KAAK,CAAC,GAAKkhC,EAAUrkC,GAAGgiC,WAAYqC,EAAUrkC,GAAGsiC,WAAWC,YAG7E,IAAIt5B,EAAM,GAUV,OATIo7B,GAAaA,EAAUnkC,OAGvB+I,EAAMzK,KAAKyjC,uBAAuBoC,EAAU,GAAI,GAAIyM,EAAa9uC,MAAM,KAEvExD,KAAKyT,SAAW,IAAIpU,EAAIyrB,SAAS9qB,MACjCA,KAAKC,IAAM,IAAIZ,EAAI4nB,OAAOsB,IAC1BvoB,KAAKsf,aAAe,IAAIjgB,EAAI6rB,eAAelrB,OAExCyK,CACX,EAGApL,EAAI4nB,OAAOjS,UAAU+wB,YAAc,SAAU4M,EAAQC,EAAQC,EAAcC,GACvE,IACIC,EAAU/yC,KAAKC,IAAIoN,KACnB2lC,EAAUhzC,KAAKC,IAAIqiB,KACnB2wB,EAAejzC,KAAKC,IAAIyhB,UAkB/B,GAjBgD,IAAzC1hB,KAAK8oB,kBAAkBvG,OAAO7gB,SAC9BkxC,GAAS,GAEb5yC,KAAKC,IAAIoN,KAAO,WAChBrN,KAAKC,IAAIqiB,KAAO,WAChBtiB,KAAKC,IAAIyhB,UAAY,GAChBoxB,IACD9yC,KAAKC,IAAIquB,cAAgB,CAAC,GAQ9BtuB,KAAKyT,SAASgY,KAAKknB,GAElBE,EACH,IAAK,IAAIzN,KAASplC,KAAKyT,SAAS4xB,WAC/BrlC,KAAKyT,SAASy/B,cAAc9N,IAAS,EAgCpC,OA5BAplC,KAAKyT,SAAS0/B,UAAUnzC,KAAKyT,SAAS2/B,QAEtCpzC,KAAKyT,SAAS4/B,UAAUrzC,KAAKyT,SAAS6/B,QAEtCtzC,KAAKyT,SAAS8/B,cAGdvzC,KAAKyT,SAAS+/B,YAAYZ,GAE1B5yC,KAAKyT,SAASggC,cAGdzzC,KAAKyT,SAASigC,eAGd1zC,KAAKyT,SAASkgC,WAAWf,GAIzB5yC,KAAKyT,SAASmgC,WAKd5zC,KAAKC,IAAIyhB,UAAYuxB,EACrBjzC,KAAKC,IAAIoN,KAAO0lC,EAChB/yC,KAAKC,IAAIqiB,KAAO0wB,EAEThzC,KAAKyT,SAASg9B,cACzB,EAEApxC,EAAI4nB,OAAOjS,UAAUo9B,mBAAqB,SAAUO,EAAQC,GACxD,IAAIiB,EACAd,EAAU/yC,KAAKC,IAAIoN,KACnB2lC,EAAUhzC,KAAKC,IAAIqiB,KACnB2wB,EAAejzC,KAAKC,IAAIyhB,UAY5B,GAX6C,IAAzC1hB,KAAK8oB,kBAAkBvG,OAAO7gB,SAC9BkxC,GAAS,GAEb5yC,KAAKC,IAAIoN,KAAO,WAChBrN,KAAKC,IAAIqiB,KAAO,WAChBtiB,KAAKC,IAAIyhB,UAAY,GACrB1hB,KAAKC,IAAIquB,cAAgB,CAAC,EAErBqkB,IACDA,EAAS,IAET,iBAAmBA,EACnB,QAAI,IAAsBA,EAAOjxC,OAG7B,IAAK,IAAIuD,KAFT4uC,EAASlB,EACTA,EAAS,GACOkB,EACZlB,EAAOhuC,KAAKM,QAEb,GAAI,iBAAmB0tC,EAAOjxC,OAAQ,CACzCmyC,EAAS,CAAC,EACV,IAAK,IAAIryC,EAAE,EAAEC,EAAKkxC,EAAOjxC,OAAOF,EAAEC,EAAKD,GAAG,EACtCqyC,EAAOlB,EAAOnxC,KAAM,CAE5B,CA6BJ,OAzBAxB,KAAKyT,SAASgY,KAAKknB,GAAQ,GAI3B3yC,KAAKyT,SAASqgC,QAAQD,GAGtB7zC,KAAKyT,SAAS4/B,UAAUrzC,KAAKyT,SAAS6/B,QAEtCtzC,KAAKyT,SAAS8/B,cAEdvzC,KAAKyT,SAAS+/B,YAAYZ,GAE1B5yC,KAAKyT,SAASggC,cAEdzzC,KAAKyT,SAASigC,eAEd1zC,KAAKyT,SAASkgC,WAAWf,GAEzB5yC,KAAKyT,SAASmgC,WAEd5zC,KAAKC,IAAIyhB,UAAYuxB,EACrBjzC,KAAKC,IAAIoN,KAAO0lC,EAChB/yC,KAAKC,IAAIqiB,KAAO0wB,EAEThzC,KAAKyT,SAASg9B,cACzB,EAIApxC,EAAImrB,cAAgB,SAAUupB,EAASC,GACnC,IAAIvpC,EAAKwpC,EAaT,OAZKD,IACDA,EAAgB,SAEfD,IACDA,EAAUC,GAEdvpC,EAAM,CAAC,EAIPwpC,EAAUF,EAAQxyC,MAAM,SACxBkJ,EAAI8qB,KAAOl2B,EAAI4O,WAAWgmC,EAAQ,SAC9B,IAAuBxpC,EAAI8qB,KAEpB,CAACA,KAAKye,EAAevpB,KAAKspB,EAASG,KAAKD,EAAQ,KAEpC,IAAnBA,EAAQvyC,SACR+I,EAAI0pC,SAAU,GAEK,IAAnBF,EAAQvyC,QAA+B,MAAfuyC,EAAQ,GAChCxpC,EAAIggB,KAAOhgB,EAAI8qB,KAAKzxB,QAAQ,IAAK,KAEjC2G,EAAIggB,KAAOwpB,EAAQzwC,MAAM,EAAG,GAAG7B,KAAK,KAExC8I,EAAI8qB,KAAO9qB,EAAI8qB,KAAKzxB,QAAQ,IAAK,KACjC2G,EAAIypC,KAAOD,EAAQ,GACZxpC,EACX,EAGApL,EAAI4nB,OAAOjS,UAAU2V,gBAAkB,SAAUvD,EAAUgtB,GACvD,IAAIC,EACJ,KAAID,IAASp0C,KAAK2C,OAAOykB,EAASqD,SAGZ,UAAlBrD,EAASqD,MACT4pB,EAAYh1C,EAAI0e,SAAS/d,KAAK4T,IAAI0gC,eAAe,UACjDt0C,KAAKu0C,UAAUF,EAAW,QAASjtB,EAASqD,OACnB,UAAlBrD,EAASqD,OACZrD,EAASmO,OAASnO,EAASqD,OAC3B4pB,EAAYh1C,EAAI0e,SAAS/d,KAAK4T,IAAI0gC,eAAeltB,EAASmO,OAC1Dv1B,KAAKu0C,UAAUF,EAAWjtB,EAASmO,KAAMnO,EAASqD,OAEtD4pB,EAAYh1C,EAAI0e,SAAS/d,KAAK4T,IAAI0gC,eAAeltB,EAASqD,OAC1DzqB,KAAKu0C,UAAUF,EAAWjtB,EAASqD,KAAMrD,EAASqD,OAEtDzqB,KAAKu0C,UAAUv0C,KAAKshB,OAAQ,GAAI8F,EAASqD,MACzCzqB,KAAKu0C,UAAUv0C,KAAKshB,OAAQ8F,EAAS8sB,KAAM9sB,EAASqD,MAChDrD,EAASmO,OAASnO,EAASqD,MAC3BzqB,KAAKu0C,UAAUv0C,KAAKshB,OAAQ8F,EAASmO,KAAMnO,EAASqD,MAExDzqB,KAAKu0C,UAAUv0C,KAAKshB,OAAQ8F,EAASqD,KAAMrD,EAASqD,WAChD,IAAuBzqB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,0BACpD,CAAC,KAAM,MAAMhqB,QAAQqkB,EAASqD,KAAKjnB,MAAM,EAAG,GAAGlD,gBAAkB,EACjEN,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,wBAA0B,IAE3D/sB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,wBAA0B,UAG/D,IAAuB/sB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,0BACxD/sB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,wBAA0B,UAE3D,IAAuB/sB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,8BACxD/sB,KAAK2C,OAAOykB,EAASqD,MAAMsC,MAAM,4BAA8B,KAE/D/sB,KAAKkB,IAAIiC,uBAAuBqrB,kCAAkC,CAElE,IADA,IAAIgmB,EAAc,CAAC,iBAAiB,cAAc,kBAAkB,mBAC3DhzC,EAAE,EAAEC,EAAK+yC,EAAY9yC,OAAOF,EAAEC,EAAKD,GAAG,EAC3C,IAAK,IAAIsB,EAAE,EAAE4B,EAAK1E,KAAKkB,IAAIszC,EAAYhzC,IAAIE,OAAOoB,EAAE4B,EAAK5B,GAAG,EACxD9C,KAAKkB,IAAIszC,EAAYhzC,IAAIsB,GAAK9C,KAAKkB,IAAIszC,EAAYhzC,IAAIsB,GAAGxC,cAGlEN,KAAKkB,IAAIqB,KAAOvC,KAAKkB,IAAIqB,KAAKjC,aAClC,CACJ,EAOAjB,EAAI4nB,OAAOjS,UAAUu/B,UAAY,SAAUxhC,EAAO0hC,EAASC,GACvD,IAAItiB,EAAMzvB,EAAQsQ,EAAOM,EAAYJ,EAAKsZ,EAAMC,EAAMioB,EAAUC,EAAiBn/B,EAAUrC,EAAiByN,EA8B5G,GA7BA4zB,EAAUA,EAAQ3wC,QAAQ,IAAK,KAC/B4wC,EAAWA,EAAS5wC,QAAQ,IAAK,KAE7B9D,KAAKkB,IAAIiC,uBAAuBqrB,mCAChCimB,EAAUA,EAAQn0C,cAClBo0C,EAAWA,EAASp0C,eAGnBN,KAAK2C,OAAO+xC,KACb10C,KAAK2C,OAAO+xC,GAAY,CAAC,EACzB10C,KAAK2C,OAAO+xC,GAAU3nB,MAAQ,CAAC,EAC/B/sB,KAAK2C,OAAO+xC,GAAU9xC,KAAO,CAAC,EAE9B5C,KAAK2C,OAAO+xC,GAAU9xC,KAAK,cAAgBvD,EAAIwL,WAE1C7K,KAAK2C,OAAO+xC,GAAU9xC,KAAK,yBAC5B5C,KAAK2C,OAAO+xC,GAAU9xC,KAAK,uBAAyB,IAExD5C,KAAK2C,OAAO+xC,GAAUxnB,MAAQ,CAAC,EAE/BltB,KAAK2C,OAAO+xC,GAAUG,IAAM,CAAC,SAAQ,EAAMrqC,KAAK,CAAC,GACjDxK,KAAK2C,OAAO+xC,GAAU,gBAAkB,CAAC,GAO7C/xC,EAASoQ,EAAMyD,UACXzD,EAAMwD,WAAWxD,EAAMC,QAAS,UAChCrQ,EAASoQ,EAAMC,YACZ,CAIHC,EAAQF,EAAMG,eAAeH,EAAMC,QAAS,UAC5C,IAAI8hC,GAAc,EAClB,IAAK3hC,EAAM,EAAGC,EAAML,EAAMM,cAAcJ,GAAQE,EAAMC,EAAKD,GAAO,EAS9D,GARAif,EAAOnf,EAAME,GAQR2hC,GAAe/hC,EAAM6C,kBAAkBwc,EAAM,OAAQ,SAAWqiB,EAG9D,CACH,IAAIlyC,EAAOwQ,EAAM6C,kBAAkBwc,EAAM,OAAQ,OAC7C2iB,EAAgBhiC,EAAMG,eAAekf,EAAM,iBAC/C,GAAI7vB,GAAQwyC,GAAiBA,EAAcrzC,OAAQ,CAC/C,IAAIszC,EAAYjiC,EAAM6C,kBAAkBm/B,EAAc,GAAI,2BACtDC,IACKh1C,KAAK2C,OAAOJ,KACbvC,KAAK2C,OAAOJ,GAAQ,CAChBK,KAAM,CAAC,IAGf5C,KAAK2C,OAAOJ,GAAMK,KAAK,2BAA6BoyC,EAAUzzC,MAAM,OAE5E,CACJ,MAhBIoB,EAASyvB,EACT0iB,GAAc,CAiB1B,CAKA,IADA7hC,EAAQF,EAAMG,eAAevQ,EAAQ,QAChCnB,EAAI,EAAGC,EAAOsR,EAAMM,cAAcJ,GAAQzR,EAAIC,EAAMD,GAAK,EAAG,CAC7D,IAAIyzC,EAAWhiC,EAAMzR,GACjB2D,EAAO4N,EAAM6C,kBAAkBq/B,EAAU,QACzCroB,EAAS7Z,EAAM6C,kBAAkBq/B,EAAU,UAC/Cj1C,KAAKkB,IAAI0rB,OAAOznB,GAAQynB,CAC5B,CAQA,GADwB7Z,EAAMG,eAAevQ,EAAQ,OAAQ,WAAWjB,OACjD,CACnB,IAAK,IAAIuD,KAAOjF,KAAK2C,OAAO+xC,GAAUG,IAAIrqC,YAC/BxK,KAAK2C,OAAO+xC,GAAU3nB,MAAM9nB,GAEvCjF,KAAK2C,OAAO+xC,GAAUG,IAAM,CAAC,SAAQ,EAAMrqC,KAAK,CAAC,EACrD,CAEAyI,EAAQF,EAAMG,eAAevQ,EAAQ,QAErC,IAAIuyC,EAAc,CAAC,aAAa,CAAC,EAAE,kBAAkB,CAAC,EAAE,eAAe,CAAC,GACpEC,GAAqB,EACrBC,EAAmB,CAAC,EACxB,IAAKjiC,EAAM,EAAGC,EAAML,EAAMM,cAAcJ,GAAQE,EAAMC,EAAKD,GAAO,EAAG,CASjE,GARAsZ,EAAOxZ,EAAME,GAKI,eADjBwhC,EAAW5hC,EAAM6C,kBAAkB6W,EAAM,WAErCkoB,EAAW,aAEa,YAAxBA,EAASnxC,MAAM,EAAE,GAAkB,CACnC,GAAiB,YAAbmxC,EACAQ,GAAqB,MAClB,CACH,IAEIE,EAFA3xC,EAAQqP,EAAM6C,kBAAkB6W,EAAM,SACtC6oB,EAAWX,EAASnxC,MAAM,IAC1B6xC,EAAatiC,EAAM6C,kBAAkB6W,EAAM,kBAE3C4oB,EAAa,UAEZ3xC,IACDA,EAAQ,kBACoB,MAAxB4xC,EAAS9xC,MAAM,EAAE,KACjBE,EAAQ,eAGY,MAAxB4xC,EAAS9xC,MAAM,EAAE,KACjB8xC,EAAWA,EAAS9xC,MAAM,IAEzB0xC,EAAYxxC,GAAO4xC,KACpBJ,EAAYxxC,GAAO4xC,GAAY,CAAC,GAEpCJ,EAAYxxC,GAAO4xC,GAAUD,GAAcV,CAC/C,CACA30C,KAAK2C,OAAO+xC,GAAUG,IAAIrqC,KAAKmqC,IAAY,CAC/C,MACI,IAAuB30C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,KACnD30C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAY,CAAC,GAE7CjoB,EAAO,OACP2oB,GAAa,EAITtiC,EAAM6C,kBAAkB6W,EAAM,UAC9BC,EAAO3Z,EAAM6C,kBAAkB6W,EAAM,SAKrC1Z,EAAM6C,kBAAkB6W,EAAM,iBAC9B4oB,EAAatiC,EAAM6C,kBAAkB6W,EAAM,gBAM3C1Z,EAAM6C,kBAAkB6W,EAAM,YAC9BzsB,KAAK2C,OAAO+xC,GAAU,gBAAgBC,GAAY5hC,EAAM6C,kBAAkB6W,EAAM,WAGhF4oB,GACAr1C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GAAc,CAAC,EACrDr1C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GAAY3oB,GAAQ,GAC1D7L,EAAS7gB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GAC/CD,EAAiBT,IAAY,IAE7B30C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUjoB,GAAQ,GAC9C7L,EAAS7gB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,IAKrC5hC,EAAMM,cAAcN,EAAMG,eAAeuZ,EAAM,cAK/C5L,EAAO6L,GAAM,GAAK3Z,EAAM8C,aAAa4W,EAAM,UACvC5L,EAAO6L,GAAM,GAAG3pB,QAAQ,OAAS,IACjC/C,KAAKkB,IAAI+qC,oBAAqB,GAMlCprB,EAAO6L,GAAM,GAAK3Z,EAAM8C,aAAa4W,EAAM,YACvC5L,EAAO6L,GAAM,GAAG3pB,QAAQ,OAAS,IACjC/C,KAAKkB,IAAI+qC,oBAAqB,KAOlCprB,EAAO6L,GAAQ3Z,EAAM8C,aAAa4W,GAC9B5L,EAAO6L,GAAM3pB,QAAQ,OAAS,IAC9B/C,KAAKkB,IAAI+qC,oBAAqB,GAG1C,CASA,GARKjsC,KAAK2C,OAAO+xC,GAAU3nB,MAAMwoB,aAC7Bv1C,KAAK2C,OAAO+xC,GAAU3nB,MAAMwoB,WAAa,CAAC,GAEzCv1C,KAAK2C,OAAO+xC,GAAU3nB,MAAMwoB,WAAiB,OAC9Cv1C,KAAK2C,OAAO+xC,GAAU3nB,MAAMwoB,WAAiB,KAAI,CAAC,aAAc,gBAIhEJ,EAAoB,CACpB,IAAK,IAAIK,KAAQJ,EAAkB,CAC/B,IAAIK,EAAkB,CAAC,EACnBC,EAAgB,EACpB,IAAK,IAAIC,KAAQ31C,KAAK2C,OAAO+xC,GAAU3nB,MAAMyoB,GACrC,CAAC,YAAY,YAAYzyC,QAAQ4yC,IAAS,EAC1CF,EAAgBE,GAAQ31C,KAAK2C,OAAO+xC,GAAU3nB,MAAMyoB,GAAMG,GAE1DD,GAAiB,EAGzB,IAAKA,EACD,GAAID,EAAgBG,SAGhB,IAAK,IAAID,KAAQF,EAAgBG,SAC7B51C,KAAK2C,OAAO+xC,GAAU3nB,MAAMyoB,GAAMG,GAAQF,EAAgBG,SAASD,QAEpE,GAAIF,EAAgBI,UAEvB,IAAK,IAAIF,KAAQF,EAAgBI,UAC7B71C,KAAK2C,OAAO+xC,GAAU3nB,MAAMyoB,GAAMG,GAAQF,EAAgBI,UAAUF,EAIpF,CACA31C,KAAK2C,OAAO+xC,GAAUG,IAAI,SAAWK,CACzC,CAIA,IAAKP,KAAY30C,KAAK2C,OAAO+xC,GAAU3nB,MACnC,IAAKvrB,EAAI,EAAGC,EAAO,EAAGD,EAAIC,EAAMD,GAAK,EAEjC,GADA6zC,EAAah2C,EAAIsH,QAAQnF,GACrBxB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GACtC,IAAK3oB,KAAQ1sB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAChC30C,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GAAY3oB,KACnD1sB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUU,GAAY3oB,GAAQ1sB,KAAK2C,OAAO+xC,GAAU3nB,MAAM4nB,GAAUjoB,IAUpH,IADAzZ,EAAQF,EAAMG,eAAevQ,EAAQ,iBAChCwQ,EAAM,EAAGC,EAAML,EAAMM,cAAcJ,GAAQE,EAAMC,EAAKD,GAAO,EAO1D,IAAKsC,KALLm/B,EAAY3hC,EAAME,GAIlBI,EAAaR,EAAMQ,WAAWqhC,GAE1B,GAAIrhC,EAAW0P,eAAexN,GAC1B,GAAiB,0BAAbA,GAAqD,iCAAbA,EACX,SAAzBlC,EAAWkC,GAEXzV,KAAK2C,OAAO+xC,GAAU9xC,KAAK6S,EAASjS,MAAM,KAAM,EAGhDxD,KAAK2C,OAAO+xC,GAAU9xC,KAAK6S,EAASjS,MAAM,KAAM,OAEjD,GAAiB,6BAAbiS,EAAyC,CAChD,IAAIqgC,EAA0BviC,EAAWkC,GAAUlU,MAAM,OACzDvB,KAAK2C,OAAO+xC,GAAU9xC,KAAK6S,EAASjS,MAAM,IAAMsyC,CACpD,MAAO,GAAiB,gBAAbrgC,EAA4B,CACnC,IAAIsgC,EAAaxiC,EAAWkC,GAAUlU,MAAM,WAC5CvB,KAAK2C,OAAO+xC,GAAU9xC,KAAK6S,EAASjS,MAAM,IAAMuyC,CACpD,MAAO,GAAiB,yBAAbtgC,EAAqC,CAC5C,IAAIvQ,EAAMqO,EAAWkC,GAAUlU,MAAM,WACrCvB,KAAK2C,OAAO+xC,GAAU9xC,KAAK,uBAAyBsC,CACxD,MAAO,GAAiB,wBAAbuQ,EAAoC,CAE3CzV,KAAK2C,OAAO+xC,GAAU9xC,KAAK,sBAAwB,CAAC,EAEpD,IADA,IACSpB,EAAE,EAAEC,GADTH,EAAMiS,EAAWkC,GAAUlU,MAAM,QACfG,OAAOF,EAAEC,EAAKD,GAAG,EACnCxB,KAAK2C,OAAO+xC,GAAU9xC,KAAK,sBAAsBtB,EAAIE,KAAM,CAEnE,MAAO,GAAiB,2BAAbiU,EAAuC,CAE9CzV,KAAK2C,OAAO+xC,GAAU9xC,KAAK,yBAA2B,CAAC,EAEvD,IAASpB,EAAE,EAAEC,GADTH,EAAMiS,EAAWkC,GAAUlU,MAAM,QACfG,OAAOF,EAAEC,EAAKD,GAAG,EACnCxB,KAAK2C,OAAO+xC,GAAU9xC,KAAK,yBAAyBtB,EAAIE,KAAM,CAEtE,MAAO,GAAiB,sBAAbiU,EAAkC,CAEzCzV,KAAK2C,OAAO+xC,GAAU9xC,KAAK,oBAAsB,CAAC,EAClD,IAAItB,EACJ,IAASE,EAAE,EAAEC,GADTH,EAAMiS,EAAWkC,GAAUlU,MAAM,QACfG,OAAOF,EAAEC,EAAKD,GAAG,EACnCxB,KAAK2C,OAAO+xC,GAAU9xC,KAAK,oBAAoBtB,EAAIE,KAAM,CAEjE,CAShB,IADAyR,EAAQF,EAAMG,eAAevQ,EAAQ,QAChCwQ,EAAM,EAAGC,EAAML,EAAMM,cAAcJ,GAAQE,EAAMC,EAAKD,GAAO,EAAG,CAE7D,IAAIuT,EAAOzT,EAAME,GAIjBnT,KAAK2C,OAAO+xC,GAAUxnB,MAAMna,EAAM6C,kBAAkB8Q,EAAM,SAAWA,CAE7E,CAIArnB,EAAIyT,kBAAkB9S,KAAM00C,EAAU3hC,EAAOpQ,EACjD,EAGAtD,EAAI22C,eAAiB,SAAUjjC,EAAOkjC,GAClC,IAAIC,EAAW72C,EAAI0e,SAAShL,GAE5B,SAASojC,EAAiBC,EAAYzzC,GAClC,IAAI8qB,EAAQ,CAAC,OAAQ,QACrB,GAAI9qB,EAEA,IADA,IAAI0zC,EAAmBh3C,EAAImrB,cAAc7nB,GAChCnB,EAAE,EAAEC,EAAKgsB,EAAM/rB,OAAOF,EAAEC,EAAKD,IAC9B60C,EAAiB5oB,EAAMjsB,MAA2D,IAApD40C,EAAWrzC,QAAQszC,EAAiB5oB,EAAMjsB,MACxE40C,EAAWzxC,KAAK0xC,EAAiB5oB,EAAMjsB,IAIvD,CAEA,IAAI80C,EAAY,CAAC,SAEjB,SAASC,EAAyBl7B,GAE9B,IADA,IAAIpI,EAAQijC,EAAShjC,eAAegjC,EAASljC,QAASqI,GAC7C7Z,EAAE,EAAEC,EAAKwR,EAAMvR,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIg1C,EAAcN,EAAStgC,kBAAkB3C,EAAMzR,GAAI,UACvD,GAAIg1C,EAEA,IAAK,IAAI1zC,EAAE,EAAE4B,GADb8xC,EAAcA,EAAYj1C,MAAM,OACFG,OAAOoB,EAAE4B,EAAK5B,IACxC9C,KAAKm2C,iBAAiBG,EAAWE,EAAY1zC,GAGzD,CACJ,CAEAqzC,EAAiBG,EAAWL,GAE5B,IAAIQ,EAAYP,EAAShjC,eAAegjC,EAASljC,QAAS,SAAS,GAC/DghC,EAAgBkC,EAAStgC,kBAAkB6gC,EAAW,kBAC1DN,EAAiBG,EAAWtC,GAG5B,IADA,IAAI0C,EAAY,CAAC,SAAU,KAAM,UAAW,aACnCl1C,EAAE,EAAEC,EAAKi1C,EAAUh1C,OAAOF,EAAEC,EAAKD,IACtC+0C,EAAyBL,GAE7B,OAAOI,CACX,EAIAj3C,EAAIyiB,KAAO,CAAC,EAEZziB,EAAIyiB,KAAKoH,aAAe,CACpB3H,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI7gB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CAE9B9F,EAAMsgB,MAAMlU,KAAO,eACnBpM,EAAMsgB,MAAMe,KAAO,eACnBrhB,EAAMsgB,MAAMG,UAAY,GAOxB1hB,KAAK0gB,MAAM/b,MALA,SAAS1D,GAChBA,EAAMhB,IAAIoN,KAAO,eACjBpM,EAAMhB,IAAIqiB,KAAO,eACjBrhB,EAAMhB,IAAIyhB,UAAY,EAC1B,GAGJ,CACAb,EAAOlc,KAAK3E,KAChB,GAMJX,EAAIyiB,KAAK60B,OAAS,CACdp1B,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EACAzhB,KAAK4iB,YAAcvjB,EAAI0H,QAEvB0a,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIsgB,KAAK5b,UAAK0xB,EAAWh3B,EAAImI,QACvC,GAEAxH,KAAK4iB,YAAcvjB,EAAI2H,MAEvBya,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIsgB,KAAKvV,KACnB,GAEJhL,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,KAChB,EAEA0oB,UAAW,SAAUznB,EAAOkS,GACpBnT,KAAK4iB,YAAcvjB,EAAI2H,KACvB/F,EAAMynB,UAAUjI,KAAK9b,KAAK,GAC1B1D,EAAMynB,UAAUlI,QAAQ7b,KAAK,KAE7B1D,EAAMynB,UAAUjI,KAAKzV,MACrB/J,EAAMynB,UAAUlI,QAAQxV,MAEhC,GAKJ3L,EAAIyiB,KAAKkH,SAAW,CAChBzH,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI7gB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CAE9B9F,EAAMsgB,MAAMlU,KAAO,WACnBpM,EAAMsgB,MAAMe,KAAO,WACnBrhB,EAAMsgB,MAAMG,UAAY,GAQxB1hB,KAAK0gB,MAAM/b,MALA,SAAS1D,GAChBA,EAAMhB,IAAIoN,KAAO,WACjBpM,EAAMhB,IAAIqiB,KAAO,WACjBrhB,EAAMhB,IAAIyhB,UAAY,EAC1B,GAuBJ,CACA,GAAI1hB,KAAK4iB,YAAcvjB,EAAI2H,IAAK,CAa5B,GARA/F,EAAMC,IAAIilC,aAAoC,YAArBllC,EAAMC,IAAIC,QAC3BF,EAAM+nB,SAAS9nB,IAAIuhC,UAChBxhC,EAAM+nB,SAAS9nB,IAAIuhC,SAAS/gC,QAC/BT,EAAM+nB,SAAS9nB,IAAI0pC,sBAChB3pC,EAAM+nB,SAAS9nB,IAAI0pC,qBAAqBlpC,QAC5CT,EAAMC,IAAI2gB,cAAgBxiB,EAAIsJ,UAC9B1H,EAAMC,IAAI2gB,cAAgBxiB,EAAIqJ,QAEjCzH,EAAMC,IAAIilC,cACPllC,EAAM2nB,cAAc1nB,IAAI8hC,gBAAgBthC,OAAQ,CAEnD,IAAIk1C,EAAW31C,EAAM2nB,cAAc1nB,IAAI8hC,gBAAgB,GAAGx/B,QAE1DvC,EAAM2nB,cAAc1nB,IAAI8hC,gBAAkB,CAAC4T,GAAU9wC,OAAO7E,EAAM2nB,cAAc1nB,IAAI8hC,gBAExF,CAEA/hC,EAAM+nB,SAASuZ,IAAM,IAAIljC,EAAIyrB,SAAS0X,YAAYvhC,EAAO,gBAC7D,CACA4f,EAAOlc,KAAK3E,KAChB,GAMJX,EAAIyiB,KAAK,YAAc,CAEhBP,MAAO,WAGP,GAKPliB,EAAIyiB,KAAK4E,KAAO,CACZnF,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAAMo1B,EAAUzjC,EAAKD,EAAKmS,EAAMwxB,EAAK/vB,EAAOgwB,EAAO9rC,EAAOC,EAC1DlL,KAAK4iB,YAAcvjB,EAAI0H,OAAS/G,KAAK4iB,YAAcvjB,EAAI4H,YAIvDhG,EAAMuoB,QAAQ8N,OAAOr2B,EAAOA,EAAMuoB,QAAQqL,OAC1C5zB,EAAMhB,IAAI+2C,WAAa33C,EAAIgsB,KAAK4rB,WAAWj3C,MAC3CiB,EAAMhB,IAAI+2C,WAAWllC,QAAQ9L,OAAS,GACtC/E,EAAMhB,IAAI+2C,WAAWllC,QAAQrL,OAAS,GACtCxF,EAAMuoB,QAAQwM,UAAUh2B,MACxBiB,EAAMsgB,MAAM21B,WAAa,GACzBj2C,EAAMsgB,MAAM41B,eAAiBn3C,KAAKmjB,UAC7BliB,EAAMsgB,MAAMG,WACbriB,EAAIgsB,KAAK+rB,gBAAgBp4B,KAAKhf,KAAMiB,EAAO4f,GAG3CY,EADAxgB,EAAMsgB,MAAMG,UACLriB,EAAIg4C,mBAEJ,SAAUp2C,EAAOgD,EAAMf,GAC1B,IAAIo0C,EAMJ,GALAr2C,EAAMhB,IAAIw/B,qBAAsB,EAChCx+B,EAAMhB,IAAIs3C,SAAW,GACrBt2C,EAAMhB,IAAI4tB,UAAY,GACtBypB,EAAK,IAEDt3C,KAAKmjB,UAAUzhB,QACVT,EAAMhB,IAAIq2B,cACe,aAAtBt2B,KAAKmjB,UAAU,GAkFvBliB,EAAMhB,IAAIu3C,aAAc,MAlFmB,CA2B3C,SAxBI,KADJX,EAAW5yC,EAAKjE,KAAKmjB,UAAU,OAE3B0zB,EAAW,CAAC,aAAc,CAAC,CAAC,KACxB51C,EAAMC,IAAIiC,uBAAuBC,2BAC7BF,GAA8B,iBAAtBlD,KAAKmjB,UAAU,IAAyBjgB,EAAK,kBACrD2zC,EAAW3zC,EAAK,kBAI5BjC,EAAMhB,IAAIu3C,YAAcX,EAexBzjC,EAAMpT,KAAK6tB,UAAUnsB,OAChByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BmS,EAAOtlB,KAAK6tB,UAAU1a,SAClB,IAAuBlS,EAAMhB,IAAIu3C,YAAalyB,EAAQ,SAEtC,UAATA,QAAoB,IAAuBrkB,EAAMhB,IAAIu3C,YAAYC,aADxEH,EAAG3yC,KAAK2gB,GAQhB,IAHAwxB,EAAM,GAEN1jC,GADA2T,EAAQ,CAAC,OAAQ,QAAS,QACdrlB,OACPyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EACxBmkC,EAAGv0C,QAAQgkB,EAAM5T,KAAS,GAC1B2jC,EAAInyC,KAAKoiB,EAAM5T,IAUvB,IAPAmkC,EAAKR,EAAItzC,QAKTuzC,EAAQ,EACR3jC,EAAMkkC,EAAG51C,OACJyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAI5B,GAHAmS,EAAOgyB,EAAGnkC,GACVlI,EAAQhK,EAAMhB,IAAIu3C,YAAYlyB,GAC9Bpa,EAAMjK,EAAMhB,IAAIu3C,YAAalyB,EAAO,QAChCra,IAAUC,EAAK,CACf6rC,EAAQ5jC,EACR,KACJ,CASJlS,EAAMhB,IAAIy3C,iBAAmBJ,EAAG9zC,MAAMuzC,EAe1C,CAGJ,EAEJ/2C,KAAK0gB,MAAM/b,KAAK8c,GAGhBA,EAAO,SAAUxgB,EAAOgD,GACpB,GAAKA,EAAKjE,KAAKmjB,UAAU,MAGzBliB,EAAMqoB,OAAOyM,SAAS,OAAQ/1B,MACJ,WAAtBA,KAAKmjB,UAAU,KACG,eAAdlf,EAAKkB,MAAuC,gBAAdlB,EAAKkB,QACoC,IAAxElE,EAAMC,IAAIm9B,mCAAmCt7B,QAAQkB,EAAK3B,WACzDrB,EAAMhB,IAAIyhB,WACX,GAAKzd,EAAK,sBAAyB,GAAKhD,EAAMhB,IAAIu3C,YAAY1wB,MACpC,IAA1B9mB,KAAK6tB,UAAUnsB,QACO,SAAtB1B,KAAK6tB,UAAU,IASlB,IAAK,IAAI5oB,KAAOhE,EAAMhB,IAAIu3C,YACtB,GAAIv2C,EAAMhB,IAAIu3C,YAAYv0B,eAAehe,IACb,SAApBA,EAAIzB,MAAM,EAAG,GAAe,CAC5BvC,EAAMhB,IAAIuuC,YAAc,CAAC,EACzB,IAAIltC,EAAML,EAAMqoB,OAAO4L,QAAQjV,QAAQzc,OAAO,GAAG,GAAG4xB,MACpDn0B,EAAMhB,IAAIuuC,YAAYnd,KAAO/vB,EAC7BL,EAAMhB,IAAIuuC,YAAYr7B,IAAM7R,EAAII,OAAS,CAC7C,CAIhB,EACA1B,KAAK0gB,MAAM/b,KAAK8c,IAGfxgB,EAAMsgB,MAAMG,WAAc1hB,KAAK4iB,YAAcvjB,EAAI2H,KAAOhH,KAAK4iB,YAAcvjB,EAAI4H,YAEhFwa,EAAO,SAAUxgB,EAAOgD,GACfA,EAAKjE,KAAKmjB,UAAU,KAGzBliB,EAAMqoB,OAAO2M,QACjB,EACAj2B,KAAK0gB,MAAM/b,KAAK8c,IAEpBZ,EAAOlc,KAAK3E,MAERA,KAAK4iB,YAAcvjB,EAAI2H,KAAOhH,KAAK4iB,YAAcvjB,EAAI4H,WAChDhG,EAAMsgB,MAAMG,WACbriB,EAAIgsB,KAAKssB,cAAc34B,KAAKhf,KAAMiB,EAAO4f,EAGrD,GAKJxhB,EAAIyiB,KAAK,aAAe,CACpBP,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAAMtO,EAAKC,EAAKwkC,EAAY3mC,EAAO4mC,EAAWC,EAAMpN,EAAgBqN,EAASC,EAA0BC,EAAIC,EAAoBC,EAAOhiB,EAAMiiB,EAAOp2C,EAAQ0W,EAAK4gB,EAAWp2B,EAC1KlD,KAAK8R,QAAQ4a,OACd1sB,KAAK8R,QAAQ4a,KAAO,QAIxBzrB,EAAMsgB,MAAM21B,WAAWvyC,KAAK3E,KAAK8R,QAAQpM,MAKzC,IAAI2yC,EAAgBp3C,EAAMsgB,MAAM41B,eAAe,GAE/C,SAASmB,EAAeC,EAAQ3rB,EAAQ1nB,GACpC,IAAKA,EACD,OAAOA,EAGX,GADAA,EAAM,GAAK7F,EAAIgsB,KAAKmtB,MAAMx4C,KAAK8R,QAAQpM,MAAM6yC,GAAQt3C,EAAOiE,EAAK0nB,EAAQ5sB,KAAKoe,gBAC1E,UAAYpe,KAAK8R,QAAQpM,KACzB,GAAIzE,EAAMhB,IAAIk3B,cACVjyB,EAAMA,EAAIpB,QAAQ,MAAO,SAEzB,IAAK,IAAItC,EAAI,EAAGC,EAAOzB,KAAK2R,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3D,GAAI,mBAAqBxB,KAAK2R,YAAYnQ,GAAG,IAAM,SAAWxB,KAAK2R,YAAYnQ,GAAG,GAAI,CAClF0D,EAAMA,EAAIpB,QAAQ,MAAO,IACzB,KACJ,CAIZ,OAAOoB,CACX,CAEAuc,EAAO,SAAUxgB,EAAOgD,GAEpB,GAAKhD,EAAMhB,IAAIu3C,YAAf,CAGIv2C,EAAMhB,IAAIotC,6BAA8B,EAG5C,IAAIoL,EAAqB,GAiCzB,GA/BAb,GAAa,EACb3mC,EAAQ,GACR4mC,EAAY,GACZ52C,EAAMhB,IAAIs3C,SAAS5yC,KAAK3E,KAAK8R,QAAQpM,MAGjCzE,EAAMhB,IAAIu3C,YAAY/xC,SAAW,SAAWzF,KAAK8R,QAAQpM,OACzD+yC,EAAqBx3C,EAAMhB,IAAIu3C,YAAY/xC,QAC3CxE,EAAMqoB,OAAOiN,OAAOt1B,EAAMhB,IAAIu3C,YAAY/xC,QAASzF,OAGnDiB,EAAMhB,IAAIu3C,cACVvmC,EAAQhQ,EAAMhB,IAAIu3C,YAAYx3C,KAAK8R,QAAQpM,MAC3CmyC,EAAY52C,EAAMhB,IAAIu3C,YAAax3C,KAAK8R,QAAQpM,KAAO,SAEvD,SAAW1F,KAAK8R,QAAQpM,MAAkB,IAAVuL,GAAgBhQ,EAAMhB,IAAIm4B,uBAC1DnnB,GAAQ,GAEZ6mC,GAAQ72C,EAAMhB,IAAIm4B,qBAClBsS,EAAiBzpC,EAAMhB,IAAIyqC,eAC3BqN,EAAiD,gBAAvC92C,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIuhC,UAAqE,uBAAvCxhC,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIuhC,SAC5FuV,EAAe/2C,EAAMC,IAAI,gCACrB42C,GAAQE,GAAgBD,IACxB92C,EAAMhB,IAAIugC,WAAW77B,KAAKsM,GACbhQ,EAAMhB,IAAIsgC,gBAAgB7+B,QAAUT,EAAMhB,IAAIugC,WAAW9+B,QACpDgpC,GACVzpC,EAAMhB,IAAIsgC,gBAAiBt/B,EAAMhB,IAAIugC,WAAW9+B,OAAS,KAAQuP,IACjEA,GAAQ,SAIhB,IAAuBA,EAAO,CAC9BgnC,GAAK,EACLC,GAAK,GACI,GACA,EACL,SAAWl4C,KAAK8R,QAAQpM,OACpBiT,SAAS1H,EAAO,IAAM,KAAO0H,SAAS1H,EAAO,IAAM,IACnDinC,EAAKj3C,EAAM+qB,QAAQ,OAEnBrT,SAAS1H,EAAO,IAAM,IACtBgnC,EAAKh3C,EAAM+qB,QAAQ,MACnB/a,GAAgC,EAAvB0H,SAAS1H,EAAO,KAEzB4mC,IACIl/B,SAASk/B,EAAW,IAAM,KAAOl/B,SAASk/B,EAAW,IAAM,GAClD52C,EAAM+qB,QAAQ,MAEvBrT,SAASk/B,EAAW,IAAM,IACjB52C,EAAM+qB,QAAQ,MACvB6rB,GAAwC,EAA3Bl/B,SAASk/B,EAAW,OAO7C,IADA,IAAIa,EAAc,GAAGz3C,EAAMhB,IAAIu3C,YAAY5xB,MACpC8yB,EAAYh3C,OAAS,GACxBg3C,EAAc,IAAIA,EAEtBA,EAAc,SAASA,EACvB,IAAI9rB,EAAS3rB,EAAM0B,OAAO1B,EAAMC,IAAIqB,MAAM,gBAAgBm2C,GAC1D,GAAI14C,KAAK8R,QAAQ4a,KAAM,CACnB,IAAI6rB,EAASv4C,KAAK8R,QAAQ4a,KACtBisB,EAAa34C,KAAK8R,QAAQ4a,KACJ,QAAtB1sB,KAAK8R,QAAQpM,MACE,YAAX6yC,GAAwBt3C,EAAM0B,OAAO1B,EAAMC,IAAIqB,MAAMK,KAAK,iCAC7C,GAATqO,IACAsnC,EAAS,WAEI,GAAbV,IACAc,EAAa,YAIzB1nC,EAAQqnC,EAAet5B,KAAKhf,KAAMu4C,EAAQ3rB,EAAQ3b,GAClD4mC,EAAYS,EAAet5B,KAAKhf,KAAM24C,EAAY/rB,EAAQirB,EAC9D,CAEA,GADA52C,EAAMqoB,OAAO0M,UAAU,SACnB/0B,EAAMhB,IAAIy3C,iBAAiBh2C,OAAQ,CAInC,IAFAy2C,GAAQ,EACR/kC,EAAMnS,EAAMhB,IAAIy3C,iBAAiBh2C,OAC5ByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAE5B,GADAjQ,EAAOjC,EAAMhB,IAAIy3C,iBAAiBvkC,IACQ,IAAtClS,EAAMhB,IAAIs3C,SAASx0C,QAAQG,GAAc,CACzCi1C,GAAQ,EACR,KACJ,CAEJ,GAAIA,EAAO,CACP,GAAI,GAAKN,GAAc,IAAK,CAUxB,GATmC,IAA/B52C,EAAMuoB,QAAQqL,MAAMnzB,SACpBk2C,GAAa,GAQb32C,EAAMC,IAAI,sBAC4B,aAAnCD,EAAMC,IAAI,uBACTD,EAAMhB,IAAIu3C,YAAY3xB,MACtB5kB,EAAMhB,IAAIu3C,YAAY5xB,QACtB3kB,EAAMhB,IAAIu3C,YAAYoB,QACD,SAAtB54C,KAAK8R,QAAQpM,MACbuL,GAAS4mC,EAAW,CAIvBA,EAAY52C,EAAM0C,IAAImoB,aAAa7a,EAAQ,IAAM4mC,GAAW,GAC5D,IAAIgB,EAAkB53C,EAAM+qB,QAAQ,wBACpC6rB,EAAYA,EAAUr0C,MAAMq0C,EAAU90C,QAAQ81C,GAAmB,EACrE,CACAJ,EAAqBZ,EACrB52C,EAAMuoB,QAAQ+M,OAAOshB,EAAW73C,MAC5B43C,IACA32C,EAAMuoB,QAAQ0L,QAAQjkB,QAAQmkB,MAAM,GAAGtjB,QAAQ9L,OAAS,GAEhE,CACAyyC,EAAqBxnC,EACrBhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,OAC3Bm2B,EAAOl1B,EAAMqoB,OAAO4L,QAAQjkB,SACvBmkB,MAAOe,EAAKf,MAAM1zB,OAAS,GAAIoQ,QAAQrL,OAAS,GACjDzG,KAAK8R,QAAQ,mBACb7Q,EAAMqoB,OAAOiN,OAAOv2B,KAAK8R,QAAQ,oBAEjC7Q,EAAMqoB,OAAOiN,OAAOt1B,EAAM+qB,QAAQ,wBAAyB,SAE/D/qB,EAAMuoB,QAAQ0M,aACdkiB,EAAQn3C,EAAMuoB,QAAQ0L,QAAQjkB,QAC9BklB,EAAKf,MAAQe,EAAKf,MAAMtvB,OAAOsyC,GAI/Bn3C,EAAMuoB,QAAQ8N,OAAOr2B,EAAOA,EAAMuoB,QAAQqL,OAC1C5zB,EAAMuoB,QAAQwM,UAAU/0B,EAAMhB,IAAI+2C,YAClC/1C,EAAMhB,IAAIy3C,iBAAmB,EACjC,MACIe,EAAqBxnC,EACrBhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAEvBiB,EAAMhB,IAAIy3C,iBAAiB30C,QAAQ/C,KAAK8R,QAAQpM,OAAS,GAIrD,GAAKmyC,GAAc,MAKgB,IAA/B52C,EAAMuoB,QAAQqL,MAAMnzB,SACpBk2C,GAAa,GAEjB32C,EAAMuoB,QAAQwM,UAAU,SACxByiB,EAAqBZ,EACrB52C,EAAMuoB,QAAQ+M,OAAOshB,EAAW73C,MAC5B43C,IACA32C,EAAMuoB,QAAQ0L,QAAQjkB,QAAQmkB,MAAM,GAAGtjB,QAAQ9L,OAAS,IAExDiyC,IACAQ,EAAqBR,EACrBh3C,EAAMuoB,QAAQ+M,OAAO0hB,IAErBC,IACAO,EAAqBP,EACrBj3C,EAAMuoB,QAAQ+M,OAAO2hB,IAEzBj3C,EAAMuoB,QAAQ0M,aAI9B,MACIuiB,EAAqBxnC,EACrBhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAG3Bi4C,IACAQ,EAAqBR,EACrBh3C,EAAMqoB,OAAOiN,OAAO0hB,IAEpBC,IACAO,EAAqBP,EACrBj3C,EAAMqoB,OAAOiN,OAAO2hB,IAExBj3C,EAAMqoB,OAAO4M,YAEjB,KAAW,UAAYl2B,KAAK8R,QAAQpM,MAW5BzE,EAAMhB,IAAIu3C,YAAYoB,UACtB3nC,EAAQ,GAAKhQ,EAAMhB,IAAIu3C,YAAYoB,SACtB3nC,EAAMvN,MAAM,YAGrBzC,EAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EAC/C4Y,EAAqB,SACrBx3C,EAAMqoB,OAAOiN,OAAOt1B,EAAM+qB,QAAS,WAAa/a,GAASjR,OAClDiR,IACPwnC,EAAqBxnC,EACrBhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,QAIvCiB,EAAMhB,IAAIgR,MAAQ,IACdhN,EAAKo0C,KAAmBpnC,IAAShQ,EAAMhB,IAAIyqC,gBAAoBzpC,EAAMC,IAAI43C,iBAAmB,SAAW94C,KAAK8R,QAAQpM,MAASzE,EAAMhB,IAAIq2B,cACnIr1B,EAAMwS,SAASA,SAASxP,EAAKoqB,MAAiE,IAA1DptB,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,cAA0Bte,EAAMhB,IAAImuC,uBAClHntC,EAAMhB,IAAImuC,sBAAuB,EACjCqK,EAAqB,IACrB//B,EAAMC,SAAS1X,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,YAAa,IAEtEvd,EAAS,IAAI3C,EAAI05C,YAAY93C,GAAO,EAAOyX,EAAK1Y,KAAMiE,EAAKoqB,IAC3DruB,KAAKw4B,iBAAmBv3B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBACpD7iC,KAAKi5B,cAAgBh4B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBACjDvJ,EAAY,IAAIj6B,EAAIgsB,KAAKiW,WAAWjiC,EAAIyO,cACxC9L,EAAOg3C,aAAa1f,GACuB,uBAAvCr4B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIuhC,WAC1BzgC,EAAO03B,aAAez4B,EAAM+qB,QAAQ,6BAEpC/qB,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI0pC,qBAC1B5oC,EAAOw2B,iBAAmBv3B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI0pC,qBAC7C3pC,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,yBACjCc,EAAOw2B,iBAAmBv3B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,yBAEpDc,EAAOw2B,iBAAmBv3B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI2hC,iBAExD7gC,EAAOu2B,8BAA+B,EACtCt3B,EAAMqoB,OAAOiN,OAAOv0B,EAAQ,YAGhCy2C,IAAuBx3C,EAAMhB,IAAImR,cAAcC,IAAIC,YACnDrQ,EAAMhB,IAAIyR,gBAAkB+mC,EAAmB/0C,MAAM,UACjDzC,EAAMqoB,OAAO4L,QAAQ7jB,IAAIS,QAAQrL,SACjCxF,EAAMhB,IAAIyR,iBAAkB,GAtPpC,CAyPJ,EACA1R,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,KAChB,GAOJX,EAAIyiB,KAAK,WAAa,CAGlBP,MAAO,SAAUtgB,EAAO4f,GACpBxhB,EAAI45C,WAAWC,QAAQl6B,KAAKhf,KAAMiB,EAAO4f,GACzCA,EAAOlc,KAAK3E,KAChB,EACA0oB,UAAW,SAAUznB,EAAOkS,GACxB9T,EAAI45C,WAAWtwB,UAAU3J,KAAKhf,KAAMiB,EAAOkS,EAC/C,GAKJ9T,EAAIyiB,KAAW,KAAI,CACfP,MAAO,SAAUtgB,EAAO4f,GACpBA,EAAOlc,KAAK3E,KAChB,EACA0oB,UAAW,SAAUznB,EAAOkS,GACpBnT,KAAK4iB,YAAcvjB,EAAI0H,QACvB9F,EAAMynB,UAAUjI,KAAMxf,EAAMynB,UAAUjI,KAAK/e,OAAS,GAAMyR,EAElE,GAMJ9T,EAAIyiB,KAAK,SAAW,CAChBP,MAAO,SAAUtgB,EAAO4f,GACpB,GAAyB,aAArB5f,EAAMsgB,MAAMlU,MAA4C,iBAArBpM,EAAMsgB,MAAMlU,KAAyB,CAOxErN,KAAK0gB,MAAM/b,MANA,SAAU1D,GACjBA,EAAMhB,IAAIk5C,UAAYn5C,KAClB,iBAAoBA,KAAK8R,QAAQ2a,OACjCxrB,EAAMhB,IAAIm5C,UAAYp5C,KAAK8R,QAAQ2a,KAE3C,GAEJ,CACA5L,EAAOlc,KAAK3E,KAChB,GAKJX,EAAIyiB,KAAKhF,MAAQ,CACbyE,MAAO,SAAUtgB,EAAO4f,EAAQw4B,GAC5B,IAAI53B,EAAMf,EAiNgB/M,EA/M1B,GADA3T,KAAKq5C,UAAYA,EACbr5C,KAAK4iB,YAAcvjB,EAAI0H,QACvB1H,EAAIgsB,KAAK+rB,gBAAgBp4B,KAAKhf,KAAMiB,EAAO4f,GACvC5f,EAAMsgB,MAAM0gB,iBAAiBhxB,SAC7BhQ,EAAMsgB,MAAM0gB,iBAAiBn+B,QAAS7C,EAAMsgB,MAAM0gB,iBAAiBhxB,QAAU,GAE5EjR,KAAK0U,OACNmM,EAAOlc,KAAK3E,MAIhByhB,EAAO,SAAUxgB,GAeb,GAdAA,EAAMqoB,OAAOyM,SAAS,QAAS/1B,MAE3BA,KAAK8R,QAAQwnC,sBACRr4C,EAAMhB,IAAImR,cAAcC,IAAI0uB,aAC7B9+B,EAAMhB,IAAImR,cAAcC,IAAI0uB,WAAa//B,KAAK8R,QAAQwnC,sBAI1Dt5C,KAAK8R,QAAQynC,qCACRt4C,EAAMhB,IAAImR,cAAcC,IAAImoC,4BAC7Bv4C,EAAMhB,IAAImR,cAAcC,IAAImoC,0BAA4Bx5C,KAAK8R,QAAQynC,qCAIzEv5C,KAAKq5C,UAAW,CAEZp4C,EAAMhB,IAAImR,cAAcC,IAAIC,WAC5BjS,EAAIyR,+BAA+B7P,EAAOjB,KAAK8R,QAAQ9L,OAAQ,KAAMhG,MAGzE,IAAIsR,GAAY,EACZe,GAAiB,EAGjBpR,EAAMhB,IAAImR,cAAc6O,QAAQve,SAChCT,EAAMqoB,OAAO4L,QAAQjkB,QAAQ6F,OAAS7V,EAAMhB,IAAImR,cAAcC,IAAIyuB,YAItE,IAAIC,EAAa9+B,EAAMhB,IAAImR,cAAcC,IAAI0uB,WACxCA,IACDA,EAAa//B,KAAK8R,QAAQwnC,qBAG9B,IAAIE,EAA4Bv4C,EAAMhB,IAAImR,cAAcC,IAAImoC,0BACvDA,IACDA,EAA4Bx5C,KAAK8R,QAAQ0nC,2BAEzCv4C,EAAMhB,IAAImR,cAAcC,IAAIC,WAC5BA,EAAYrQ,EAAMhB,IAAImR,cAAcC,IAAIC,UACxCe,EAAiBpR,EAAMhB,IAAImR,cAAcC,IAAIgB,gBAEtCrS,KAAK8R,QAAQ2nC,OACpBnoC,EAAY,CACRG,KAAMzR,KAAK8R,QAAQ2nC,OACnBnnC,KAAK,GAEFtS,KAAK8R,QAAQ4nC,UACpBpoC,EAAY,CACRG,KAAMzR,KAAK8R,QAAQ4nC,QACnBpnC,KAAK,IAGb,IAAIqnC,EAAU,CACVC,qBAAsB34C,EAAMhB,IAAIsG,iBAChCo5B,eAAe,EACfC,kBAAkB,EAClBC,kBAAkB,EAClBga,wBAAyB54C,EAAMhB,IAAImR,cAAcC,IAAIwuB,iBACrDC,WAAY7+B,EAAMqoB,OAAO4L,QAAQ7jB,IACjC0uB,WAAYA,EACZ+Z,aAAc74C,EAAMhB,IAAImR,cAAcC,IAAIyoC,aAC1CN,0BAA2BA,EAC3BtZ,4BAA6BlgC,KAAK8R,QAAQioC,gCAC1C5P,wCAAyCnqC,KAAK8R,QAAQkoC,4CACtD1oC,UAAWA,EACXe,eAAgBA,EAChB8tB,UAAWl/B,EAAMhB,IAAImR,cAAcC,IAAI8uB,UAAU38B,SAErD,GAAGxD,KAAKiqC,aAAc,CAClB,IAAIA,EAAehpC,EAAMhB,IAAImR,cAAcC,IAAI44B,aAC1CA,IACDA,EAAe,CAAC,GAEpB51B,OAAOC,OAAO21B,EAAcjqC,KAAKiqC,cACjC0P,EAAQ1P,aAAeA,CAC3B,CACA,GAAGjqC,KAAKggC,eAAgB,CACpB,IAAIA,EAAiB/+B,EAAMhB,IAAImR,cAAcC,IAAI2uB,eAC5CA,IACDA,EAAiB,CAAC,GAEtB3rB,OAAOC,OAAO0rB,EAAgBhgC,KAAKggC,gBACnC2Z,EAAQ3Z,eAAiBA,CAC7B,CACA,GAAGhgC,KAAKigC,cAAe,CACnB,IAAIA,EAAgBh/B,EAAMhB,IAAImR,cAAcC,IAAI4uB,cAC3CA,IACDA,EAAgB,CAAC,GAErB5rB,OAAOC,OAAO2rB,EAAejgC,KAAKigC,eAClC0Z,EAAQ1Z,cAAgBA,CAC5B,CACA,GAAIh/B,EAAMhB,IAAIwrC,gBAAkBxqC,EAAMhB,IAAIwrC,eAAewO,eAAiBN,EAAQ1Z,cAI9E,IAAK,IAAI5S,KAHJssB,EAAQ3Z,iBACT2Z,EAAQ3Z,eAAiB,CAAC,GAEV/+B,EAAMhB,IAAIwrC,eAAewO,cACrCN,EAAQ1Z,cAAc5S,KACtBssB,EAAQ3Z,eAAe3S,IAAW,SAC3BssB,EAAQ1Z,cAAc5S,IAiBzC,GAFApsB,EAAMhB,IAAImR,cAAczM,KAAKg1C,GAEzB14C,EAAMhB,IAAIwrC,gBAAkBzrC,KAAKk6C,uBAIjC,IAAK,IAAI7sB,KAHJpsB,EAAMhB,IAAIwrC,eAAewO,gBAC1Bh5C,EAAMhB,IAAIwrC,eAAewO,cAAgB,CAAC,GAE1Bj6C,KAAKk6C,uBACrBj5C,EAAMhB,IAAIwrC,eAAewO,cAAc5sB,IAAW,CAO9D,CACJ,GAGA3M,EAAQ,IACF/b,KAAK8c,GACXzhB,KAAK0gB,MAAQA,EAAM5a,OAAO9F,KAAK0gB,OAO3B1gB,KAAK8R,QAAQ,uCAGb7Q,EAAMsgB,MAAM,sBAAuB,EAC/BvhB,KAAK8R,QAAQ,wBAIb2P,EAAO,SAAUxgB,EAAOgD,GACpB,GAAIA,EAAKk2C,WAAal2C,EAAK,mBAAoB,CAC3C,IAAIm2C,EAAgBn2C,EAAKk2C,UAAU54C,MAAM,QACrC84C,EAAsBp2C,EAAK,mBAAmB1C,MAAM,QACpD64C,EAAc14C,OAAS,GACpB04C,EAAc14C,SAAW24C,EAAoB34C,SAChDT,EAAMq5C,gBAAkB,IAAIj7C,EAAIk7C,gBAAgBt5C,EAAOjB,MACvDiB,EAAMq5C,gBAAgB,kBAAoBF,EAC1Cn5C,EAAMq5C,gBAAgB,wBAA0BD,EAExD,CACJ,EACAr6C,KAAK0gB,MAAM/b,KAAK8c,KAIpBzhB,KAAK0U,OAAO,CAyBZ,IAAI8lC,EAAe,IAAIn7C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC/C1H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKw7B,EAAcv5C,EAAO4f,GAEhD,IAAI45B,EAAW,IAAIp7C,EAAI8hB,MAAM,KAAM9hB,EAAI0H,OAErB4M,EAIhB3T,KAAK0U,MAJP+M,EACW,SAAUxd,EAAMf,GACnB,OAAO7D,EAAIqU,yBAAyBzS,EAAOgD,EAAMf,EAAMyQ,EAC3D,EAGJ8mC,EAASnY,QAAamY,EAASnY,MAAQ,IACvCmY,EAASnY,MAAM39B,KAAK8c,GACpBg5B,EAAShpC,KAAOxQ,EAAM0C,IAAID,MAAMg3C,IAAID,EAAUx5C,EAAOw5C,EAASnY,OAC9DzhB,EAAOlc,KAAK81C,GACZ,IAAIp4B,EAAY,IAAIhjB,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WAC1Cwa,EAAO,SAAUxgB,EAAOgD,EAAMf,GAE1B,IAAIy3C,EAAW12C,EACXf,GAAQA,EAAK,sBAAuC,kBAAflD,KAAK0U,QAC1CimC,EAAWz3C,GAEf,IAAIkd,EAAO,EACX,GAAInf,EAAMyT,MAAMimC,EAAS,sBAAsB36C,KAAK0U,OAChD,KAAO0L,EAAOnf,EAAMyT,MAAMimC,EAAS,sBAAsB36C,KAAK0U,OAAOhT,QACjE0e,EAAO/gB,EAAI8gB,UAAUnB,KAAK/d,EAAOA,EAAMyT,MAAMimC,EAAS,sBAAsB36C,KAAK0U,OAAO0L,GAAOnc,EAAMf,EAGjH,EACAmf,EAAU3N,MAAQ1U,KAAK0U,MACvB2N,EAAU3B,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAK0d,GAEZ,IAAIu4B,EAAS,IAAIv7C,EAAI8hB,MAAM,KAAM9hB,EAAI2H,KACrC3H,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAK47B,EAAQ35C,EAAO4f,GACzC,IAAIg6B,EAAa,IAAIx7C,EAAI8hB,MAAM,OAAQ9hB,EAAI0H,OAC3C1H,EAAIyiB,KAAW,KAAEP,MAAMvC,KAAK67B,EAAY55C,EAAO4f,EACnD,CAGJ,GAAI7gB,KAAK4iB,YAAcvjB,EAAI2H,MAOnB/F,EAAMsgB,MAAM,uBACZtgB,EAAMsgB,MAAM,sBAAuB,EACnCE,EAAO,SAAUxgB,GACTA,EAAMq5C,kBACNr5C,EAAMq5C,gBAAgBQ,SACtB75C,EAAMq5C,iBAAkB,EAEhC,EACAt6C,KAAK0gB,MAAM/b,KAAK8c,IAIpBA,EAAO,SAAUxgB,EAAOgD,EAAMf,GAO1B,GANKjC,EAAMhB,IAAImR,cAAcC,IAAIC,WACzBrQ,EAAMqoB,OAAO4L,QAAQ7jB,IAAIS,QAAQrL,SACjCxF,EAAMhB,IAAIyR,iBAAkB,GAGpCzQ,EAAMqoB,OAAO2M,SACTj2B,KAAKq5C,UAAW,CAChB,IAAIloC,EAAQlQ,EAAMhB,IAAImR,cAAcpG,MAUpC,GATImG,EAAM+uB,8BACNj/B,EAAMhB,IAAImR,cAAcC,IAAI6uB,4BAA8B/uB,EAAM+uB,6BAC3Dj/B,EAAMhB,IAAIq2B,cAAgBr1B,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI8iB,SAC5DlwC,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI6R,4BAA8B/uB,EAAM+uB,8BAGzE/uB,EAAMg5B,0CACNlpC,EAAMhB,IAAImR,cAAcC,IAAI84B,wCAA0Ch5B,EAAMg5B,yCAEzD,sBAAnBlpC,EAAMhB,IAAIoN,KAA8B,CACxC,IAAI0tC,EAAoB5pC,EAAMgvB,UAAUp9B,QAAQ,mBAC5C/C,KAAK8R,QAAQoP,gBAAkB65B,GAAqB,GAAyC,GAApC95C,EAAMhB,IAAImR,cAAc1P,WAC7E1B,KAAK8R,QAAQoP,iBAAmB7hB,EAAIsI,WACpC1G,EAAM6nB,kBAAkB5nB,IAAI+hC,+BAAiC5jC,EAAIsI,WAEjE1G,EAAM6nB,kBAAkB5nB,IAAI+hC,+BAAiC5jC,EAAIuI,UAErEuJ,EAAMgvB,UAAYhvB,EAAMgvB,UAAU38B,MAAM,EAAGu3C,GAAmBj1C,OAAOqL,EAAMgvB,UAAU38B,MAAMu3C,EAAoB,IAEvH,CAaA,GAPI5pC,EAAMG,YACNH,EAAMkB,eAAiBhT,EAAI0S,yBAAyB9Q,EAAOkQ,IAE3DlQ,EAAMhB,IAAImR,cAAcC,IAAIC,YAC5BrQ,EAAMhB,IAAImR,cAAcC,IAAIgB,eAAiBlB,EAAMkB,iBAGlDlB,EAAMkB,iBAAmBlB,EAAM0uB,kBAAqB1uB,EAAMwuB,gBAAkBxuB,EAAMyuB,kBAAoB,CAClG5/B,KAAKg7C,sBACN/5C,EAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,GAEnD,IAAIzK,EAAQn0B,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,MAC/Bn0B,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,MAAM1zB,OAE7C,IAAKT,EAAMhB,IAAIq2B,eAAiBnlB,EAAM84B,cAAgB94B,EAAM8uB,eAAiB9uB,EAAM6uB,gBAAkB7uB,EAAM+uB,6BAA+B/uB,EAAMg5B,yCAA0C,CAKtL,IAAI8Q,EAAYh6C,EAAMsT,SAAS2mC,aAAa/pC,GAM5C,GALI8pC,GACI7lB,GACAA,EAAMpqB,MAGV/J,EAAMhB,IAAI+rC,WAAa,IAAMiP,IAAe9pC,EAAM6uB,iBAAmB7uB,EAAM8uB,gBAAkB9uB,EAAM84B,cAAgB,CAEnH,IAAIkR,EAAOl6C,EAAMhB,IAAIm7C,iBAAiBn6C,EAAMhB,IAAI+rC,WAAW,GACvDiP,GAAa9pC,EAAMg5B,0CAA4CgR,EAAKE,SAAWF,EAAKG,QACpFr6C,EAAMqoB,OAAOuL,MAAMrxB,OAAO,GAAG,GAAGqpC,mBAAqB17B,EAAMg5B,wCACpDh5B,EAAM+uB,6BAA+Bib,EAAKE,UACjDp6C,EAAMqoB,OAAOuL,MAAMrxB,OAAO,GAAG,GAAGqpC,mBAAqB17B,EAAM+uB,4BAEnE,CACJ,CACJ,KAAO,CAOH,GANAj/B,EAAMhB,IAAIsG,iBAAmB4K,EAAMyoC,qBACnC34C,EAAMhB,IAAImR,cAAcC,IAAIuuB,iBAAmBzuB,EAAMyuB,iBACjDzuB,EAAMkB,iBAAmBpR,EAAMhB,IAAImR,cAAcC,IAAIC,YACrDrQ,EAAMhB,IAAImR,cAAcC,IAAIuuB,kBAAmB,EAC/C3+B,EAAMhB,IAAImR,cAAcC,IAAIwuB,iBAAmB1uB,EAAM0oC,yBAErD1oC,EAAMkB,eAON,IAAK,IAAI7Q,EAAE,EAAEC,EAAK0P,EAAMgvB,UAAUz+B,OAAOF,EAAEC,EAAKD,IAE5C,IADA,IAAI+5C,EAAUpqC,EAAMgvB,UAAU3+B,GACrBsB,EAAE,EAAE4B,EAAKzD,EAAMhB,IAAIkgC,UAAUz+B,OAAQoB,EAAE4B,EAAM5B,IAC9C7B,EAAMhB,IAAIkgC,UAAUr9B,KAAOy4C,IAC3Bt6C,EAAMhB,IAAIkgC,UAAYl/B,EAAMhB,IAAIkgC,UAAU38B,MAAM,EAAGV,GAAGgD,OAAO7E,EAAMhB,IAAIkgC,UAAU38B,MAAMV,EAAE,KAKrG7B,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,OAC7Bn0B,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,MAAMpqB,KAE3C,CACJ,CACJ,EACAhL,KAAK0gB,MAAM/b,KAAK8c,GAEZzhB,KAAK0U,OAAO,CACZ,IAAI8mC,EAAW,IAAIn8C,EAAI8hB,MAAM,OAAQ9hB,EAAI2H,KACzC3H,EAAIyiB,KAAW,KAAEP,MAAMvC,KAAKw8B,EAAUv6C,EAAO4f,GAC7C,IAAI46B,EAAa,IAAIp8C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KAC7C3H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKy8B,EAAYx6C,EAAO4f,EAClD,CAGA7gB,KAAK4iB,YAAcvjB,EAAI2H,MAClBhH,KAAK0U,OACNmM,EAAOlc,KAAK3E,MAEZiB,EAAMsgB,MAAM0gB,iBAAiBhxB,SAC7BhQ,EAAMsgB,MAAM0gB,iBAAiBn+B,QAAS7C,EAAMsgB,MAAM0gB,iBAAiBhxB,QAAU,GAEjF5R,EAAIgsB,KAAKssB,cAAc34B,KAAKhf,KAAMiB,EAAO4f,GAEjD,GAKJxhB,EAAIyiB,KAAS,GAAI,CACbP,MAAO,SAAUtgB,EAAO4f,GACpBxhB,EAAI45C,WAAWC,QAAQl6B,KAAKhf,KAAMiB,EAAO4f,GACzCA,EAAOlc,KAAK3E,KAChB,EACA0oB,UAAW,SAAUznB,EAAOkS,GACxB9T,EAAI45C,WAAWtwB,UAAU3J,KAAKhf,KAAMiB,EAAOkS,EAC/C,GAIJ9T,EAAIyiB,KAAiB,WAAI,CACrBP,MAAO,SAAUtgB,GACTjB,KAAK4iB,YAAcvjB,EAAI0H,OACvB9F,EAAMhB,IAAIy7C,WAAWC,SAAS37C,KAAK0D,OAEnC1D,KAAK4iB,YAAcvjB,EAAI2H,KACvB/F,EAAMhB,IAAIy7C,WAAWE,cAE7B,GAGJv8C,EAAIyiB,KAAgB,UAAI,CACpBP,MAAO,SAAUtgB,GACb,GAAIjB,KAAK4iB,YAAcvjB,EAAI4H,UAAW,CAClC,IAAIwK,EAAOxQ,EAAM0C,IAAID,MAAM1D,KAAK0D,OAAO1D,KAAMiB,EAAOjB,KAAKsiC,OACzDrhC,EAAMhB,IAAIy7C,WAAWG,QAAQpqC,EACjC,CACJ,GAGJpS,EAAI45C,WAAa,CAAC,EAElB55C,EAAI45C,WAAWC,QAAU,SAAUj4C,GAC/B,IAAIwgB,EACAzhB,KAAK4iB,YAAcvjB,EAAI0H,OAAS/G,KAAK4iB,YAAcvjB,EAAI4H,YACnDjH,KAAK2C,SACL1B,EAAMC,IAAIqB,KAAOvC,KAAK2C,QAErB3C,KAAKsiC,OAAUtiC,KAAKsiC,MAAM5gC,OAK3B1B,KAAKyR,KAAOxQ,EAAM0C,IAAID,MAAM1D,KAAK0D,OAAO1D,KAAMiB,EAAOjB,KAAKsiC,OAH1DrhC,EAAMhB,IAAIy7C,WAAa,IAAIr8C,EAAI45C,WAAWhyB,OAAOhmB,EAAOjB,MAKf,IAAzCiB,EAAMsgB,MAAM0gB,iBAAiBhxB,UAC7BwQ,EAAO,SAASxgB,GACZA,EAAMhB,IAAIghC,mBACd,EACAjhC,KAAK0gB,MAAM/b,KAAK8c,KAGpBzhB,KAAK4iB,YAAcvjB,EAAI2H,KAAOhH,KAAK4iB,YAAcvjB,EAAI4H,YACR,IAAzChG,EAAMsgB,MAAM0gB,iBAAiBhxB,UAC7BwQ,EAAO,SAAUxgB,IACbA,EAAMhB,IAAIghC,oBACNhgC,EAAMhB,IAAIkhC,2BAA2Bz/B,OAAS,KAChCT,EAAMhB,IAAIkhC,2BAA2B39B,OAAO,GAAG,KAC7CvC,EAAMhB,IAAIghC,oBACtBhgC,EAAMC,IAAIqB,KAAOtB,EAAMhB,IAAIihC,uBAAuBl2B,MAClD/J,EAAMhB,IAAIkhC,2BAA2Bn2B,QAGzChL,KAAK87C,iBAEL76C,EAAMqoB,OAAO4L,QAAQjkB,QAAQ+mB,WAAah4B,KAAK87C,eAC/C76C,EAAMqoB,OAAO4M,WAAW,SACxBj1B,EAAMC,IAAIqB,KAAOvC,KAAK87C,eAE9B,EACA97C,KAAK0gB,MAAM/b,KAAK8c,IAGpBA,EAAO,SAAUxgB,GAEb,OADWjB,KAAKiB,EAAMhB,IAAIsgB,KAAKtP,QAEnC,EACAjR,KAAK0gB,MAAM/b,KAAK8c,GACZzhB,KAAK87C,iBACL76C,EAAMC,IAAIqB,KAAOvC,KAAK87C,gBAGlC,EAEAz8C,EAAI45C,WAAWtwB,UAAY,SAAU1nB,EAAOkS,GACpCnT,KAAK4iB,YAAcvjB,EAAI0H,OAEvB/G,KAAKygB,KAAOxf,EAAMynB,UAAUjI,KAAKjd,OAAO,GAAG,GAC3CxD,KAAKwgB,QAAUxgB,KAAKogB,KACpBnf,EAAMynB,UAAUjI,KAAMxf,EAAMynB,UAAUjI,KAAK/e,OAAS,GAAMyR,GACnDnT,KAAK4iB,YAAcvjB,EAAI4H,WAE9BjH,KAAKygB,KAAOzgB,KAAKogB,KACjBpgB,KAAKwgB,QAAUvf,EAAMynB,UAAUlI,QAAQhd,OAAO,GAAG,GACjDvC,EAAMynB,UAAUjI,KAAMxf,EAAMynB,UAAUjI,KAAK/e,OAAS,GAAMyR,IAG1DnT,KAAKwgB,QAAUvf,EAAMynB,UAAUlI,QAAQhd,OAAO,GAAG,GACjDxD,KAAKygB,KAAOzgB,KAAKogB,KAEzB,EAEA/gB,EAAI45C,WAAWhyB,OAAS,SAAUhmB,EAAO+P,GACrChR,KAAKgR,MAAQA,EACbhR,KAAKiB,MAAQA,CACjB,EAEA5B,EAAI45C,WAAWhyB,OAAOjS,UAAU6mC,QAAU,SAAUpqC,GAChDzR,KAAKgR,MAAMsxB,QAAatiC,KAAKgR,MAAMsxB,MAAQ,IAC3CtiC,KAAKgR,MAAMsxB,MAAM39B,KAAK8M,EAC1B,EAEApS,EAAI45C,WAAWhyB,OAAOjS,UAAU2mC,SAAW,SAAUj4C,GACjD1D,KAAKgR,MAAMtN,MAAQA,CACvB,EAEArE,EAAI45C,WAAWhyB,OAAOjS,UAAU4mC,aAAe,WAC3C57C,KAAKgR,MAAMS,KAAOzR,KAAKiB,MAAM0C,IAAID,MAAM1D,KAAKgR,MAAMtN,OAAO1D,KAAKgR,MAAOhR,KAAKiB,MAAOjB,KAAKgR,MAAMsxB,MAChG,EAIAjjC,EAAIyiB,KAAKq5B,KAAO,CACZ55B,MAAO,SAAUtgB,GACTjB,KAAK4iB,YAAcvjB,EAAI0H,MACvB9F,EAAMsgB,MAAMwB,KAAO,OAEnB9hB,EAAMsgB,MAAMwB,MAAO,CAE3B,GAMJ1jB,EAAIyiB,KAAKjN,YAAc,CACnB0M,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI,CAACxhB,EAAI4H,UAAW5H,EAAI0H,OAAOhE,QAAQ/C,KAAK4iB,YAAc,EAAG,CAqEzD5iB,KAAK0gB,MAAM/b,MAnEA,SAAU1D,GACb,iBAAoBjB,KAAK8R,QAAQ+F,UACjC5W,EAAMhB,IAAI87C,sBAAwB/7C,KAAK8R,QAAQ+F,UAE/C5W,EAAMhB,IAAI87C,sBAAwB96C,EAAMhB,IAAI+7C,eAM5C,SAAW/6C,EAAMmvB,WAAWpwB,KAAM,OAClCA,KAAKi8C,SAAWh7C,EAAM+qB,QAAQ,MAAO,OAAQ,GACtC,WAAa/qB,EAAMmvB,WAAWpwB,KAAM,OACvCiB,EAAMC,IAAIiC,uBAAuBinB,uBACjCpqB,KAAKi8C,SAAWh7C,EAAM+qB,QAAQ,MAAO,SAAU,GAE/ChsB,KAAKi8C,SAAW,IAEb,SAAWh7C,EAAMmvB,WAAWpwB,KAAM,SACzCA,KAAKi8C,SAAWh7C,EAAMhB,IAAI87C,4BAE1B,IAAuB/7C,KAAKi8C,UAAYh7C,EAAMhB,IAAIg8C,WAElDj8C,KAAKi8C,SAAWh7C,EAAMhB,IAAIg8C,UAE1B58C,EAAIqH,6BAA6B+K,KAAKzR,KAAKi8C,WAC3Cj8C,KAAKk8C,kBAAoB,IACzBl8C,KAAKm8C,oBAAsB,KACvB,iBAAoBl7C,EAAMhB,IAAI87C,wBAC9B/7C,KAAKm8C,oBAAsBl7C,EAAMhB,IAAI87C,uBAEzC/7C,KAAKo8C,WAAa,MAElBp8C,KAAKk8C,kBAAoB,GACzBl8C,KAAKm8C,oBAAsB,GAC3Bn8C,KAAKo8C,WAAa,IAEoC,WAAtDn7C,EAAMmvB,WAAWpwB,KAAM,2BACvBA,KAAKk8C,kBAAoBj7C,EAAMhB,IAAI87C,sBAC0B,UAAtD96C,EAAMmvB,WAAWpwB,KAAM,4BAG1BA,KAAKm8C,sBACLn8C,KAAKm8C,oBAAsB,KAInCn8C,KAAK8X,IAAM,CAAC,OACR,IAAuB9X,KAAKi8C,UAC5Bh7C,EAAMqoB,OAAOiN,OAAOv2B,KAAKi8C,SAAU,SAAS,GAC5Cj8C,KAAK8X,IAAIukC,OAASp7C,EAAMqoB,OAAOte,MAC/BhL,KAAK8X,IAAIukC,OAAOvqC,QAAQ9L,OAAShG,KAAKk8C,kBACtCl8C,KAAK8X,IAAIukC,OAAOvqC,QAAQrL,OAASzG,KAAKo8C,WACtCn7C,EAAMqoB,OAAOiN,OAAOv2B,KAAKi8C,SAAU,SAAS,GAC5Cj8C,KAAK8X,IAAIwkC,SAAWr7C,EAAMqoB,OAAOte,MACjChL,KAAK8X,IAAIwkC,SAASxqC,QAAQ9L,OAAShG,KAAKm8C,oBACxCn8C,KAAK8X,IAAIwkC,SAASxqC,QAAQrL,OAASzG,KAAKo8C,YACjC,cAAgBp8C,KAAK8R,QAAQ+F,YACpC7X,KAAK8X,IAAIukC,OAAS,IAAIh9C,EAAI+2B,KAAKn1B,EAAMhB,IAAI87C,uBACzC/7C,KAAK8X,IAAIukC,OAAOvqC,QAAQ9L,OAAS,GACjChG,KAAK8X,IAAIukC,OAAOvqC,QAAQrL,OAAS,GACjCzG,KAAK8X,IAAIwkC,SAAW,IAAIj9C,EAAI+2B,KAAKn1B,EAAMhB,IAAI87C,uBAC3C/7C,KAAK8X,IAAIwkC,SAASxqC,QAAQ9L,OAAS,GACnChG,KAAK8X,IAAIwkC,SAASxqC,QAAQrL,OAAS,IAEvCxF,EAAM6xB,WAAWje,YAAc7U,IACnC,GAEJ,CACA6gB,EAAOlc,KAAK3E,KAChB,EACA0oB,UAAW,SAAUznB,GACb,CAAC5B,EAAI4H,UAAW5H,EAAI0H,OAAOhE,QAAQ/C,KAAK4iB,YAAc,IACtD3hB,EAAMsgB,MAAMg7B,iBAAkB,EAEtC,GAKJl9C,EAAIyiB,KAAK,oBAAsB,CAC3BP,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EACA,SAAWzhB,KAAK8R,QAAQpM,KAEpB+b,EADAzhB,KAAK8R,QAAQ,YACN,SAAU7Q,GACbA,EAAM6xB,WAAW/W,gBAAgB,mBAAqB/b,IAC1D,EAEO,SAAUiB,GACbA,EAAM6xB,WAAW/W,gBAAsB,KAAI/b,IAC/C,EAEG,UAAYA,KAAK8R,QAAQpM,OAChC+b,EAAO,SAAUxgB,GACbA,EAAM6xB,WAAW/W,gBAAuB,MAAI/b,IAChD,GAEJA,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,KAChB,GAKJX,EAAIyiB,KAAK7c,IAAM,CACXsc,MAAO,SAAUtgB,EAAO4f,GAIpB,IAAIY,EAFJZ,EAAS5f,EAAMA,EAAMsgB,MAAMe,KAAO,SAASC,OAG3C,IACIi6B,EAAY,IAAIn9C,EAAI8hB,MAAM,MAAO9hB,EAAI0H,OAEzC9F,EAAMhB,IAAIqiB,KAAOrhB,EAAMsgB,MAAMe,KAI7Bk6B,EAAU1qC,QAAQ,aAAe7Q,EAAMmvB,WAAWpwB,KAAM,aACxDw8C,EAAU1qC,QAAQ,mBAAqB7Q,EAAMmvB,WAAWpwB,KAAM,mBAC9Dw8C,EAAU1qC,QAAQ,kBAAoB7Q,EAAMmvB,WAAWpwB,KAAM,kBAI7DyhB,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIkgC,UAAY,EAC1B,EACAqc,EAAU97B,MAAM/b,KAAK8c,GAGrBA,EAAO,SAAUxgB,GACbA,EAAMqoB,OAAO0M,UAAU,QAC3B,EACAwmB,EAAU97B,MAAM/b,KAAK8c,GAGrB,IAAIP,EAAiB,GAoCrB,GAnCIlhB,KAAK8R,QAAQoP,iBAAmB7hB,EAAIsI,YAEpCuZ,EAAevc,KAAK,GACpBuc,EAAevc,MAAM,KAGrBuc,EAAevc,MAAM,GACrBuc,EAAevc,KAAK,IAExB1D,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI8hC,gBAAgBr+B,KAAKuc,GAE7C7hB,EAAI+F,eAAerC,QAAQ/C,KAAKmjB,UAAU,KAAO,IACjDliB,EAAMsgB,MAAMk7B,UAAW,GAI3Bh7B,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIy8C,eAAgB,EAEtBz7C,EAAMmvB,WAAWpwB,KAAM,eACvBiB,EAAMhB,IAAI,aAAegB,EAAMmvB,WAAWpwB,KAAM,cAEhDiB,EAAMmvB,WAAWpwB,KAAM,qBACvBiB,EAAMhB,IAAI,mBAAqBgB,EAAMmvB,WAAWpwB,KAAM,oBAEtD,kBAAqBiB,EAAMmvB,WAAWpwB,KAAM,oBAC5CiB,EAAMhB,IAAI,kBAAoBgB,EAAMmvB,WAAWpwB,KAAM,kBAG7D,EACAw8C,EAAU97B,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAK63C,GAIRx8C,KAAKmjB,UAAUzhB,OAAQ,CACvB,IAAI2V,EAAWrX,KAAKmjB,UAAU,GAC9B,GAAI9jB,EAAImG,eAAezC,QAAQsU,IAAa,EAAG,CAG3C,IAAIslC,EAAoB,IAAIt9C,EAAI8hB,MAAM,QAAS9hB,EAAI0H,OACnD41C,EAAkB/5B,UAAYvjB,EAAI0H,MAClC41C,EAAkBx5B,UAAYnjB,KAAKmjB,UACnC9jB,EAAIyiB,KAAK/c,MAAMwc,MAAMvC,KAAK29B,EAAmB17C,EAAO4f,GAGpD,IAAI+7B,EAAa,IAAIv9C,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WAC3C21C,EAAWh6B,UAAYvjB,EAAI4H,UAC3B21C,EAAW9qC,QAAQ,sBAAwB,MAC3C8qC,EAAW9qC,QAAQ,kBAAoB,IACvC8qC,EAAW9qC,QAAQ,kBAAoB7Q,EAAMmvB,WAAWpwB,KAAM,kBAC9D48C,EAAW9qC,QAAQ,aAAe7Q,EAAMmvB,WAAWpwB,KAAM,aACzD48C,EAAW9qC,QAAQ,mBAAqB7Q,EAAMmvB,WAAWpwB,KAAM,mBAC/DX,EAAIyiB,KAAKpc,KAAK6b,MAAMvC,KAAK49B,EAAY37C,EAAO4f,GAG5C,IAAIg8B,EAAoB,IAAIx9C,EAAI8hB,MAAM,cAAe9hB,EAAI4H,WACzD41C,EAAkBj6B,UAAYvjB,EAAI4H,UAClC5H,EAAIyiB,KAAKjN,YAAY0M,MAAMvC,KAAK69B,EAAmB57C,EAAO4f,GAG1D,IAAIi8B,EAAkB,IAAIz9C,EAAI8hB,MAAM,QAAS9hB,EAAI2H,KACjD81C,EAAgBl6B,UAAYvjB,EAAI2H,IAChC3H,EAAIyiB,KAAK/c,MAAMwc,MAAMvC,KAAK89B,EAAiB77C,EAAO4f,EACtD,KAAO,CACH,IAAIk8B,EAAc,IAAI19C,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WAG5C,GAFA81C,EAAYjrC,QAAQoP,eAAiBlhB,KAAK8R,QAAQoP,eAClD67B,EAAYlvB,UAAY7tB,KAAK6tB,UACzBxuB,EAAI+K,kBAAkBrH,QAAQsU,IAAa,EAKvCoK,EADa,oBAAbpK,EACO,SAAUpW,EAAOgD,GAQpB,GAPuB,sBAAnBhD,EAAMhB,IAAIoN,OACNrN,KAAK8R,QAAQoP,iBAAmB7hB,EAAIsI,WACpC1G,EAAM6nB,kBAAkB5nB,IAAI+hC,+BAAiC5jC,EAAIsI,WAEjE1G,EAAM6nB,kBAAkB5nB,IAAI+hC,+BAAiC5jC,EAAIuI,WAGlD,kBAAnB3G,EAAMhB,IAAIoN,MAA4BpM,EAAM6nB,kBAAkB7oB,IAAI+8C,oBAClE,IAAItkC,EAAMzX,EAAM6nB,kBAAkB7oB,IAAI+8C,oBAAoB/7C,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI4uB,UAEvFvkC,EAAMzX,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI4uB,IAE3CvkC,IAEAA,EAAMrZ,EAAIgsB,KAAK6xB,QAAQ,GAAKxkC,IAEhCzX,EAAMqoB,OAAOiN,OAAO7d,EAAK1Y,KAC7B,EAEO,SAAUiB,EAAOgD,GACpB,IAAIyU,GAAM,GACVA,EAAMzU,EAAKoT,MAIPqB,EAAMrZ,EAAIgsB,KAAK6xB,QAAQxkC,IAE3BzX,EAAMqoB,OAAOiN,OAAO7d,EAAK1Y,KAC7B,OAED,GAAiB,mBAAbqX,EACPoK,EAAO,SAAUxgB,EAAOgD,GACpB,IAAIkvB,EAAWlyB,EAAMyxB,iBAAiBzuB,GACtChD,EAAMqoB,OAAOiN,OAAOpD,EAAUnzB,KAClC,OACG,GAAIX,EAAI+F,eAAerC,QAAQsU,IAAa,EAC/CoK,EAAOpiB,EAAI89C,cACXJ,EAAY55B,UAAYnjB,KAAKmjB,eAC1B,GAAI,UAAY9L,EAAU,CAK7BoK,EAAOxgB,EAAMknB,UAAUi1B,kBAAkBp9C,KAAKmjB,UAJ9B,SACD,GACF,GACG,EAEpB,MACI1B,EADO,gBAAkBpK,EAClB,SAASpW,EAAOgD,EAAMf,GACzB7D,EAAIqU,yBAAyBzS,EAAOgD,EAAMf,EAAM,cAEhD,IAAIwP,EAAMrT,EAAImT,gBAAgBvR,EAAOgD,GAAM,GAC3ChD,EAAMqoB,OAAOiN,OAAO7jB,EAAK,QAC7B,EAEO,SAAUzR,EAAOgD,GACpB,IAAIo5C,EAASp5C,EAAKoT,GAClBpW,EAAMqoB,OAAOiN,OAAO8mB,EAAQ,QAChC,EAEJN,EAAYr8B,MAAM/b,KAAK8c,GACvBZ,EAAOlc,KAAKo4C,EAChB,CACJ,KAAO,CAGH,IAAI/rC,EAAQ,IAAI3R,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WACtC+J,EAAMc,QAAQoP,eAAiBlhB,KAAK8R,QAAQoP,eAC5ClQ,EAAMiQ,gBAAkBjhB,KAAKihB,gBAC7B5hB,EAAIshB,YAAY3B,KAAK/d,EAAO+P,EAAO6P,EACvC,CAKA,IAAIy8B,EAAU,IAAIj+C,EAAI8hB,MAAM,MAAO9hB,EAAI2H,KAWvCya,EAAO,SAAUxgB,GACb,IAAIs8C,EAAYt8C,EAAMqoB,OAAOgO,OAAOr2B,EAAOA,EAAMqoB,OAAOuL,OACpD5zB,EAAM2S,IAAI4pC,mBACVD,EAAYt8C,EAAM2S,IAAI4pC,iBAAiBD,IAUvC,MARJA,EAAYA,EAAaA,EAAUh8C,MAAM,KAAKI,KAAKV,EAAMC,IAAIwpB,UAAYzpB,EAAMC,IAAIwpB,SAAY,MAS3F6yB,OAAYlnB,GAEZ,iBAAoBknB,IACpBA,OAAYlnB,GAGhBp1B,EAAMA,EAAMA,EAAMhB,IAAIoN,MAAMiV,KAAO,SAAS9X,KAAK7F,KAAK44C,GACtDt8C,EAAMhB,IAAIgR,MAAQ,EACtB,EACAqsC,EAAQ58B,MAAM/b,KAAK8c,GAGfxgB,EAAMsgB,MAAMk7B,WACa,aAArBx7C,EAAMsgB,MAAMlU,MAAiD,UAA1BpM,EAAMsgB,MAAMG,YAE/CzgB,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI8hC,gBAAgBr+B,KAAK,EAAE,EAAE,IACrD8c,EAAO,SAAUxgB,EAAOgD,GAEpB,IAAIsb,EAActe,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,YACvDA,IACDA,EAAc,GAElB,IAAIta,EAAM5F,EAAIgsB,KAAK6xB,QAAQ,GAAK39B,GAChCte,EAAMA,EAAMhB,IAAIoN,MAAM7C,KAAK7F,KAAKM,EACpC,EACAq4C,EAAQ58B,MAAM/b,KAAK8c,IAEvBxgB,EAAMsgB,MAAMk7B,UAAW,GAI3Bh7B,EAAO,SAAUxgB,GAMbA,EAAMhB,IAAI,kBAAeo2B,EACzBp1B,EAAMhB,IAAI,wBAAqBo2B,EAC/Bp1B,EAAMhB,IAAI,uBAAoBo2B,EAC9Bp1B,EAAMhB,IAAIy8C,eAAgB,CAC9B,EACAY,EAAQ58B,MAAM/b,KAAK8c,GACnBZ,EAAOlc,KAAK24C,EAChB,GAKJj+C,EAAIyiB,KAAK4O,MAAQ,CACbnP,MAAO,SAAUtgB,EAAO4f,GAEpB,GAAI7gB,KAAK8R,QAAQ2a,KAAM,CA+BnBzsB,KAAK0gB,MAAM/b,MA7BA,SAAU1D,EAAOgD,EAAMf,GAS9B,IAAIqO,EAAUlS,EAAIo+C,cAAcz9C,KAAMiB,EAAOgD,EAAMf,GAC/CA,GAA8B,YAAtBlD,KAAK8R,QAAQ2a,OAErBvpB,EAAKw6C,sBAAwB19C,KAAK8R,QAAQ4a,MAG1Cnb,IACAtQ,EAAMhB,IAAImR,cAAcC,IAAIsuB,eAAgB,GAEhDtgC,EAAIyR,+BAA+B7P,EAAOsQ,EAAS,KAAMvR,OAC1B,IAA3BuR,EAAQxO,QAAQ,QAEZ/C,KAAK8R,QAAQ6rC,sBACR18C,EAAMhB,IAAIsG,kBAA6C,YAAvBtF,EAAMC,IAAW,OAAsC,aAAnBD,EAAMhB,IAAIoN,OAC/EkE,EAAUlS,EAAI2N,OAAOC,WAAW,oBAAoBhM,EAAOsQ,KAGnEtQ,EAAMqoB,OAAOiN,OAAOhlB,EAASvR,MAErC,GAEJ,KAAO,CACEA,KAAK8R,QAAQ4a,OACd1sB,KAAK8R,QAAQ4a,KAAO,QAMxB,IAFA,IAAIkxB,EAAW38C,EAAMsgB,MAAMugB,gBAAgB7gC,EAAMsgB,MAAMugB,gBAAgBpgC,OAAO,GAC1Em8C,EAAa58C,EAAMsgB,MAAMwgB,WAAW9gC,EAAMsgB,MAAMwgB,WAAWrgC,OAAO,GAC7DF,EAAI,EAAGC,EAAOm8C,EAASl8C,OAAQF,EAAIC,EAAMD,GAAK,EAC9Cq8C,EAAWD,EAASp8C,MACrBq8C,EAAWD,EAASp8C,IAAM,CAAC,GAGnC,GAAKP,EAAMsgB,MAAMu8B,UAKb,IAASt8C,EAAI,EAAGC,EAAOm8C,EAASl8C,OAAQF,EAAIC,EAAMD,GAAK,EACnDq8C,EAAWD,EAASp8C,IAAIu8C,MAAQ/9C,UALpC,IAAK,IAAIwB,EAAI,EAAGC,EAAOm8C,EAASl8C,OAAQF,EAAIC,EAAMD,GAAK,EACnDq8C,EAAWD,EAASp8C,IAAIw8C,OAASh+C,IAO7C,CACA6gB,EAAOlc,KAAK3E,KAChB,GAKJX,EAAIyiB,KAAKm8B,OAAS,CACd18B,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAAMy8B,EAAcC,EAAcC,EAsIlCC,EApIJ,SAASC,IACoB,iBAArBr9C,EAAMsgB,MAAMlU,OACZ8wC,EAAe,IAAI9+C,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WACzCwa,EAAO,SAASxgB,GAEZ,IAAKA,EAAMhB,IAAImxC,sBAAuB,CAClC,IAAI3qC,EAEAA,EADAxF,EAAMhB,IAAI8gC,aAAa9/B,EAAMhB,IAAIoN,MAAMpM,EAAMhB,IAAIouC,kBACxCptC,EAAMhB,IAAI8gC,aAAa9/B,EAAMhB,IAAIoN,MAAMpM,EAAMhB,IAAIouC,kBAAkB5nC,OAEnExF,EAAMioB,aAAahoB,IAAI0hC,cAMpC,IAAI2b,EAAUt9C,EAAMqoB,OAAO4L,QAAQjkB,QAC/BhQ,EAAMC,IAAIs9C,cACVD,EAAQnpB,MAAMmpB,EAAQnpB,MAAM1zB,OAAO,GAAGoQ,QAAQrL,OAASA,EAEvD83C,EAAQzsC,QAAQrL,OAASA,CAEjC,CACIxF,EAAMioB,aAAahoB,IAAI,uBAEvBD,EAAMqoB,OAAO2M,OAAO,YAE5B,EACAkoB,EAAaz9B,MAAM/b,KAAK8c,GACxBZ,EAAOlc,KAAKw5C,GAEpB,CAgHA,GA9GIn+C,KAAK4iB,YAAcvjB,EAAI0H,QAEnB/G,KAAKy+C,WACLx9C,EAAMsgB,MAAMC,uBAAyBxhB,KAAKy+C,WAE1Cx9C,EAAMsgB,MAAMC,uBAAyBvgB,EAAMC,IAAI,kBAGnDugB,EAAO,SAAUxgB,EAAOgD,EAAMf,GAC1B,GAAIjC,EAAMC,IAAIiC,uBAAuBu7B,wBAC9Bz9B,EAAM2S,IAAI84B,oBACTzrC,EAAMhB,IAAIq2B,cACXryB,EAAKgtC,WACc,aAAnBhwC,EAAMhB,IAAIoN,KAAqB,CAElC,IAAIqxC,EAAa,IAAIr/C,EAAI8hB,MAAM,QAAS9hB,EAAI0H,OAC5C23C,EAAW/sC,YAAc,CAAC,CAAC,QAAS,UACpC1Q,EAAMqoB,OAAOyM,SAAS,aAAc2oB,GACpCz9C,EAAMqoB,OAAO4L,QAAQjkB,QAAQo2B,QAAUpjC,EAAKgtC,UACxC/tC,IACAjC,EAAMqoB,OAAO4L,QAAQjkB,QAAQ0tC,YAAcz7C,EAAKy7C,YAChD19C,EAAMqoB,OAAO4L,QAAQjkB,QAAQ2tC,WAAa17C,EAAK07C,WAEvD,CACJ,EACA5+C,KAAK0gB,MAAM/b,KAAK8c,IAIhBzhB,KAAK4iB,YAAcvjB,EAAI0H,OAAU9F,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,QAMpEoU,EAAO,SAAUxgB,EAAOgD,EAAMf,GAgB1B,GAdAjC,EAAMhB,IAAIkgC,UAAY,GAClBj9B,GAAQA,EAAK,gBACbjC,EAAMhB,IAAIkgC,UAAUx7B,KAAK,WAEzB1D,EAAMC,IAAIw8B,wBAAwBz5B,EAAc,UAC7CA,EAAc,UAC+B,IAA7C,CAAC,SAAU,UAAUlB,QAAQkB,EAAKkB,OAErClE,EAAMhB,IAAIkgC,UAAUx7B,KAAK,YAExB1D,EAAMhB,IAAIq2B,cAAgBr1B,EAAMwS,SAASA,SAASxP,EAAKoqB,KAAOptB,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI9Z,UAChGtT,EAAMhB,IAAIkgC,UAAUx7B,KAAK,gCAGxB1D,EAAMhB,IAAIq2B,cAAgBr1B,EAAMhB,IAAIwrC,gBAAkBxnC,EAAK2O,aAC5D,IAAK,IAAI8b,KAASztB,EAAMhB,IAAIwrC,eAAeC,QAAQznC,EAAK2O,cACpD3R,EAAMhB,IAAIkgC,UAAUx7B,KAAK+pB,GAKjCztB,EAAMhB,IAAI4+C,eAAgB,CAC9B,EACA7+C,KAAK0gB,MAAM/b,KAAK8c,GAEhBA,EAAO,SAAUxgB,GAEbA,EAAMhB,IAAIy8C,eAAgB,CAC9B,EACA18C,KAAK0gB,MAAM/b,KAAK8c,GAGhBA,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIy/B,gBAAkB,CAChC,EACA1/B,KAAK0gB,MAAM/b,KAAK8c,GAEhBA,EAAO,SAAUxgB,EAAOgD,GACpB,IAAIm6C,EAAM,IAAI/+C,EAAI8hB,MAClBlgB,EAAMqoB,OAAO0M,UAAUooB,EAC3B,EACAp+C,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,MAEa,aAArBiB,EAAMsgB,MAAMlU,OACZ6wC,EAAe,IAAI7+C,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WACzCwa,EAAO,SAAUxgB,EAAOgD,EAAMf,GAC1B,GAAIA,GAAQA,EAAK8C,OAAQ,CACrB,IAAIA,EAAS3G,EAAI0G,uBAAuB9E,EAAOiC,EAAK8C,QAC/C/E,EAAMhB,IAAIq2B,eACXtwB,EAAS/E,EAAMqoB,OAAOtoB,iBAAiBK,OAAO2E,IAElD,IAAI0wB,EAAoBr3B,EAAIiH,uBAAuBrF,EAAO+E,GAC1D/E,EAAMqoB,OAAOiN,OAAOvwB,EAAQhG,MAAM,EAAO02B,EAC7C,CACJ,EACAwnB,EAAax9B,MAAM/b,KAAK8c,GACxBZ,EAAOlc,KAAKu5C,KAMhBl+C,KAAKy+C,cACLJ,EAAS,IAAIh/C,EAAI8hB,MAAM,QAAS9hB,EAAI0H,QAC7BpE,OAAS3C,KAAKy+C,WACrBJ,EAAOvsC,QAAQ+F,UAAY7X,KAAK8R,QAAQ+F,UACxCwmC,EAAOvsC,QAAQrL,OAASzG,KAAK8R,QAAQrL,OAChCxF,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,QACpCpM,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,MAAQ,CAAC,IAIhDrN,KAAK4iB,YAAcvjB,EAAI0H,QACvB9F,EAAMsgB,MAAMsgB,aAAc,EAGrB7hC,KAAKy+C,aAINx9C,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIwhC,SAAW,CAAC1iC,KAAK2R,aAC3C1Q,EAAOA,EAAMhB,IAAIoN,KAAO,SAAUnM,IAAIwhC,SAAW,CAAC1iC,KAAK2R,aAEvD1Q,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAIyhC,cAAgB3iC,KAAK8R,QAAQ9L,OACzD/E,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI0hC,cAAgB5iC,KAAK8R,QAAQrL,OACzDxF,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBAAmB7iC,KAAK8R,QAAQ+F,UAE5D5W,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAIqxB,mBAAqBvyB,KAAK2R,YAGlD1Q,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,QAGnC+wC,EAAM,IAAI/+C,EAAI8hB,MAAM,OAAQ9hB,EAAI0H,OAChC1H,EAAIyiB,KAAW,KAAEP,MAAMvC,KAAKo/B,EAAKn9C,EAAO4f,KAM5C7gB,KAAKy+C,YAAY,CACjB,GAAKx9C,EAAMsgB,MAAMu9B,mBAYbT,EAAO34C,KAAO,UACdrG,EAAI6jB,WAAW,oBAAoBlE,KAAKq/B,EAAQp9C,EAAOjB,KAAKy+C,YAC5Dp/C,EAAIyiB,KAAK,WAAWP,MAAMvC,KAAKq/B,EAAQp9C,EAAO4f,OAdb,CAIjC,IAAIk+B,EAAa,IAAI1/C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC7C1H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAK+/B,EAAY99C,EAAO4f,GAC9Cw9B,EAAO34C,KAAO,KACdrG,EAAI6jB,WAAW,oBAAoBlE,KAAKq/B,EAAQp9C,EAAOjB,KAAKy+C,YAC5Dp/C,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKq/B,EAAQp9C,EAAO4f,EAC7C,CAQA5f,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,MAAMgxC,EAAO17C,QAAU,CAAC,EAC3D1B,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,MAAMgxC,EAAO17C,QAAQkV,UAAY7X,KAAK8R,QAAQ+F,UACjF5W,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,MAAMgxC,EAAO17C,QAAQ8D,OAASzG,KAAK8R,QAAQrL,MAClF,CAEAzG,KAAK4iB,YAAcvjB,EAAI2H,MACnBhH,KAAKy+C,aACLH,IACKr9C,EAAMsgB,MAAMu9B,oBAWbT,EAAO34C,KAAO,UACd24C,EAAOz7B,UAAYvjB,EAAI2H,IACvB3H,EAAI6jB,WAAW,oBAAoBlE,KAAKq/B,EAAQp9C,EAAOjB,KAAKy+C,YAC5Dp/C,EAAIyiB,KAAK,WAAWP,MAAMvC,KAAKq/B,EAAQp9C,EAAO4f,KAX9Cw9B,EAAO34C,KAAO,KACd24C,EAAOz7B,UAAYvjB,EAAI2H,IACvB3H,EAAI6jB,WAAW,oBAAoBlE,KAAKq/B,EAAQp9C,EAAOjB,KAAKy+C,YAC5Dp/C,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKq/B,EAAQp9C,EAAO4f,GACzC5f,EAAMsgB,MAAMu9B,oBAAqB,IAUpC9+C,KAAKy+C,aACNH,IAEIr9C,EAAMhB,IAAI8gC,aAAa9/B,EAAMsgB,MAAMlU,OAG/BpM,EAAMsgB,MAAMu9B,qBACZV,EAAM,IAAI/+C,EAAI8hB,MAAM,OAAQ9hB,EAAI2H,KAChC3H,EAAIyiB,KAAW,KAAEP,MAAMvC,KAAKo/B,EAAKn9C,EAAO4f,GACxCu9B,EAAM,IAAI/+C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KAClC3H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKo/B,EAAKn9C,EAAO4f,IAG/C5f,EAAM+9C,0BAA2B,EACR,aAArB/9C,EAAMsgB,MAAMlU,OACZ8wC,EAAe,IAAI9+C,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WACzCwa,EAAO,SAAUxgB,EAAOgD,EAAMf,GAE1B,GAAIA,GAAQA,EAAKuD,OAAQ,CACrB,IAAIA,EAASpH,EAAImH,wBAAwBvF,EAAOiC,EAAKuD,QAChDxF,EAAMhB,IAAIq2B,eACX7vB,EAASxF,EAAMqoB,OAAOtoB,iBAAiBK,OAAOoF,IAElDxF,EAAMqoB,OAAOiN,OAAO,EAAUv2B,KAClC,CACJ,EACAm+C,EAAaz9B,MAAM/b,KAAK8c,GACxBZ,EAAOlc,KAAKw5C,IAIhB18B,EAAO,SAAUxgB,GACbA,EAAMqoB,OAAO4M,YACjB,EACAl2B,KAAK0gB,MAAM/b,KAAK8c,GAChBA,EAAO,SAAUxgB,EAAOgD,GAChBhD,EAAMC,IAAIiC,uBAAuBu7B,wBAC9Bz9B,EAAM2S,IAAI84B,oBACTzrC,EAAMhB,IAAIq2B,cACXryB,EAAKgtC,WACc,aAAnBhwC,EAAMhB,IAAIoN,MAEbpM,EAAMqoB,OAAO2M,QAErB,EACAj2B,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,MACZiB,EAAMsgB,MAAMsgB,aAAc,EAC1B5gC,EAAMsgB,MAAMu9B,oBAAqB,GAG7C,GAKJz/C,EAAIyiB,KAAKkgB,MAAQ,CACbzgB,MAAO,WAAa,GAKxBliB,EAAIyiB,KAAKm9B,YAAc,CACnB19B,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI7gB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CAE9B,IAAIg4C,EAAa,IAAI1/C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC7C1H,EAAIyiB,KAAa,OAAEP,MAAMvC,KAAK+/B,EAAY99C,EAAO4f,GAEjD,IAAIq+B,EAAS,IAAI7/C,EAAI8hB,MAAM,KAAM9hB,EAAI0H,OACrC1H,EAAI6jB,WAAW,8BAA8BlE,KAAKkgC,EAAQj+C,GAC1D5B,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKkgC,EAAQj+C,EAAO4f,GAEzC,IAAIY,EAAO,SAASxgB,EAAOgD,GAMvB,GAJAhD,EAAMhB,IAAIk/C,QAAUl7C,EACpBhD,EAAMhB,IAAIm/C,QAAUn+C,EAAMC,IAAIqB,KAC9BtB,EAAMhB,IAAIo/C,mBAAoB,EAE1Bp7C,EAAK,kBAAoBA,EAAK,0BAA2B,CAEzD,IAAIq7C,EAAU3oC,KAAKC,MAAMD,KAAK8X,UAAUxqB,IAExCq7C,EAAQxwB,SAAWwwB,EAAQ,iBAC3B,IAAIl4B,EAAW/nB,EAAImrB,cAAc80B,EAAQxwB,SAAU7tB,EAAMC,IAAI,kBAAkB,IAE/E,GAAID,EAAMC,IAAI6tB,aACV,IAAK,IAAIvtB,KAAKP,EAAMC,IAAI6tB,aAAc,CAClC,IAAIwwB,EAAct+C,EAAMC,IAAI6tB,aAAavtB,GACrCg+C,GAAU,EACd,IAAK,IAAI18C,KAAKy8C,EAAa,CACvB,IAAIE,EAAUF,EAAYz8C,GAC1B,GAAIskB,EAASqD,OAASg1B,EAAQh1B,MAAQrD,EAASmO,OAASkqB,EAAQlqB,MAAQnO,EAAS8sB,OAASuL,EAAQvL,KAAM,CACpGsL,EAAUD,EAAY,GAAG90B,KACzB,KACJ,CACJ,CACK+0B,IACDA,EAAUv+C,EAAMC,IAAI,kBAAkB,IAE1CD,EAAMC,IAAIqB,KAAOi9C,CACrB,CAGJ,IAAK,IAAIv6C,KAAOq6C,EACZ,IAA0D,IAAtD,CAAC,KAAM,OAAQ,WAAY,SAASv8C,QAAQkC,IAAmC,SAApBA,EAAIzB,MAAM,EAAG,GACxE,GAAI87C,EAAQ7zC,OAAS6zC,EAAQ7zC,MAAMC,MAAMzG,GAAM,CAC3C,IAAIy6C,GAAW,EACf,IAAK,IAAIn9C,KAAQ+8C,EAAQ7zC,MAAMC,MAAMzG,GACjC,GAAImiB,EAAS8sB,OAAS3xC,EAAKuB,QAAQ,iBAAkB,MAAO,CACxD47C,GAAW,EACX,KACJ,CAEAA,UACOJ,EAAQr6C,EAEvB,aACWq6C,EAAQr6C,GAI3B,IAAK,IAAIA,KAAOq6C,EACY,SAApBr6C,EAAIzB,MAAM,EAAG,IACb87C,EAAQr6C,EAAIzB,MAAM,IAAM87C,EAAQr6C,GAChChE,EAAMhB,IAAIo/C,mBAAoB,GAE1BC,EAAQ7zC,OAAS6zC,EAAQ7zC,MAAMC,QAC1B4zC,EAAQ,OAASr6C,IAAQq6C,EAAQ7zC,MAAMC,MAAMzG,KAC1Cq6C,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAASqD,OAClC60B,EAAQr6C,GAAOq6C,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAASqD,MACjDxpB,EAAMhB,IAAIo/C,mBAAoB,GACvBC,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAASmO,OACzC+pB,EAAQr6C,GAAOq6C,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAASmO,MACjDt0B,EAAMhB,IAAIo/C,mBAAoB,GACvBC,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAAS8sB,QACzCoL,EAAQr6C,GAAOq6C,EAAQ7zC,MAAMC,MAAMzG,GAAKmiB,EAAS8sB,MACjDjzC,EAAMhB,IAAIo/C,mBAAoB,GAMtD,CAEAp+C,EAAMqoB,OAAO0M,UAAUh2B,MACvBiB,EAAMwS,SAAS8a,QAAQtqB,EAAKoqB,IAAMixB,EAClCr+C,EAAM6xB,WAAa,IAAIzzB,EAAImuC,WAAWvsC,EAAOq+C,EACjD,EACAt/C,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,MAER++C,EAAa,IAAI1/C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC7C1H,EAAIyiB,KAAa,OAAEP,MAAMvC,KAAK+/B,EAAY99C,EAAO4f,GAE7Cq+B,EAAS,IAAI7/C,EAAI8hB,MAAM,KAAM9hB,EAAI0H,OACrC1H,EAAI6jB,WAAW,8BAA8BlE,KAAKkgC,EAAQj+C,GACtDwgB,EAAO,SAASxgB,GAChBA,EAAMhB,IAAIo/C,mBAAoB,CAClC,EACAH,EAAOx+B,MAAM/b,KAAK8c,GAClBpiB,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKkgC,EAAQj+C,EAAO4f,EAE7C,MAAO,GAAI7gB,KAAK4iB,YAAcvjB,EAAI2H,IAAK,CAE/Bk4C,EAAS,IAAI7/C,EAAI8hB,MAAM,KAAM9hB,EAAI2H,KACrC3H,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKkgC,EAAQj+C,EAAO4f,GAErCk+B,EAAa,IAAI1/C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KAC7C3H,EAAIyiB,KAAa,OAAEP,MAAMvC,KAAK+/B,EAAY99C,EAAO4f,GAE7CY,EAAO,SAASxgB,EAAOgD,GACvBhD,EAAMqoB,OAAO4M,aACbj1B,EAAMwS,SAAS8a,QAAQtqB,EAAKoqB,IAAMptB,EAAMhB,IAAIk/C,QAC5Cl+C,EAAMC,IAAIqB,KAAOtB,EAAMhB,IAAIm/C,QAC3Bn+C,EAAM6xB,WAAa,IAAIzzB,EAAImuC,WAAWvsC,EAAOA,EAAMhB,IAAIk/C,SACvDl+C,EAAMhB,IAAIo/C,mBAAoB,CAClC,EACAr/C,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,MAERk/C,EAAS,IAAI7/C,EAAI8hB,MAAM,KAAM9hB,EAAI2H,KACrC3H,EAAIyiB,KAAS,GAAEP,MAAMvC,KAAKkgC,EAAQj+C,EAAO4f,GAErCk+B,EAAa,IAAI1/C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KAC7C3H,EAAIyiB,KAAa,OAAEP,MAAMvC,KAAK+/B,EAAY99C,EAAO4f,EAErD,CACJ,GAGJxhB,EAAIyiB,KAAK,oBAAsB,CAC3BP,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI7gB,KAAK4iB,YAAcvjB,EAAI4H,UAAW,CAMlCjH,KAAK0gB,MAAM/b,MAJA,SAAS1D,EAAOgD,GACnBA,EAAOhD,EAAMitB,YAAYjqB,EAAKoqB,IAClChvB,EAAIirC,QAAQtrB,KAAK/d,EAAOgD,EAC5B,GAEJ,CACA4c,EAAOlc,KAAK3E,KAChB,GAOJX,EAAImuC,WAAa,SAASvsC,EAAOgD,EAAMf,GACnClD,KAAKN,OAAQ,EAETM,KAAKN,OACLigD,MAAM,OAGV3/C,KAAKiB,MAAQA,EACbjB,KAAKiE,KAAOA,EACZjE,KAAKkD,KAAOA,EACZlD,KAAK4/C,aAAe,EACpB5/C,KAAK6/C,UAAY,CAAC,EAClB7/C,KAAK8/C,yBAA0B,EAC/B9/C,KAAK+/C,cAAe,CACxB,EAEA1gD,EAAImuC,WAAWx4B,UAAUyW,KAAO,SAAU1mB,GACtC/E,KAAKggD,aAAej7C,EAAMi7C,aACtBhgD,KAAKiB,MAAMhB,IAAIsG,mBACfvG,KAAKiB,MAAMhB,IAAI8tC,iCAAkC,GAEjD/tC,KAAKigD,iBACLjgD,KAAK4/C,aAAe5/C,KAAK4/C,aAAe5/C,KAAKigD,gBAEjDjgD,KAAKigD,eAAiB,EACtBjgD,KAAK+E,MAAQA,EACb/E,KAAKmjB,UAAYpe,EAAMoe,UAEvBnjB,KAAKiB,MAAMhB,IAAIgR,MAAQ,GACvBjR,KAAKiB,MAAMhB,IAAI4+C,cAAgB,GAC/B7+C,KAAKiB,MAAMhB,IAAIigD,YAAa,EAC5BlgD,KAAKiB,MAAMhB,IAAIk5C,WAAY,EAC3Bn5C,KAAKiB,MAAMhB,IAAIm5C,WAAY,EAC3B,IAAK,IAAI53C,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EACrDxB,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,KAAOxB,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,IAAIE,SAC7D1B,KAAKiB,MAAMhB,IAAIgR,MAAQjR,KAAKiB,MAAMhB,IAAIgR,MAAMnL,OAAO9F,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,MAmBpF,IAhBAxB,KAAK,cAAWq2B,EAEhBr2B,KAAW,UAAIq2B,EAEfr2B,KAAK0F,UAAO2wB,EAEZr2B,KAAK+b,gBAAkB,CAAC,EAMxB/b,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIuuB,kBAAmB,EAEpD5/B,KAAKmgD,cAAgBngD,KAAKmjB,UAAU,GAE/BnjB,KAAKiB,MAAMhB,IAAIgR,MAAMvP,SAMJ1B,KAAKogD,kBAAkBpgD,KAAKggD,cAC7B,CAIjB,IAAK,IAAIx+C,KAHTxB,KAAKiB,MAAMhB,IAAIu/B,eAAex0B,MAC9BhL,KAAKiB,MAAMhB,IAAIu/B,eAAe76B,MAAK,GAErB3E,KAAKmjB,UAAW,CAC1B,IAAI7f,EAAMtD,KAAKiB,MAAMhB,IAAIkgC,UAAUp9B,QAAQ/C,KAAKmjB,UAAU3hB,IACtD8B,GAAO,IACPtD,KAAKiB,MAAMhB,IAAIkgC,UAAYngC,KAAKiB,MAAMhB,IAAIkgC,UAAU38B,MAAM,EAAGF,GAAKwC,OAAO9F,KAAKiB,MAAMhB,IAAIkgC,UAAU38B,MAAMhC,EAAE,IAElH,CACAxB,KAAKiB,MAAMhB,IAAIogD,wBAAyB,EACxCrgD,KAAKmjB,UAAY,EACrB,CACJ,EAGA9jB,EAAImuC,WAAWx4B,UAAUsrC,OAAS,SAAUv7C,EAAOo7C,GAI/C,GAHAngD,KAAKggD,aAAej7C,EAAMi7C,aAC1BhgD,KAAKmgD,cAAgBA,EAEjBngD,KAAKiB,MAAMhB,IAAIu/B,eAAevuB,QAAS,CACvCjR,KAAKigD,eAAiB,EAItBjgD,KAAKmjB,UAAYpe,EAAMoe,UAGvB,IAAIo9B,EAASvgD,KAAKiB,MAAMhB,IAAIgR,MAAMzN,QAClCxD,KAAKiB,MAAMhB,IAAIgR,MAAQ,GAEvB,IAAK,IAAIzP,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EACrDxB,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,KAAOxB,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,IAAIE,SAC7D1B,KAAKiB,MAAMhB,IAAIgR,MAAQjR,KAAKiB,MAAMhB,IAAIgR,MAAMnL,OAAO9F,KAAKiE,KAAKjE,KAAKmjB,UAAU3hB,MAGhFxB,KAAKiB,MAAMhB,IAAIgR,MAAMvP,QACrB1B,KAAKiB,MAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,SAGrDxH,KAAKiB,MAAMhB,IAAIgR,MAAQsvC,CAE3B,CAIA,GADsBvgD,KAAKogD,kBAAkBpgD,KAAKggD,cAC7B,CAGjB,IAAK,IAAIx+C,KAFTxB,KAAKiB,MAAMhB,IAAIu/B,eAAex0B,MAC9BhL,KAAKiB,MAAMhB,IAAIu/B,eAAe76B,MAAK,GACrB3E,KAAKmjB,UAAW,CAC1B,IAAI7f,EAAMtD,KAAKiB,MAAMhB,IAAIkgC,UAAUp9B,QAAQ/C,KAAKmjB,UAAU3hB,IACtD8B,GAAO,IACPtD,KAAKiB,MAAMhB,IAAIkgC,UAAYngC,KAAKiB,MAAMhB,IAAIkgC,UAAU38B,MAAM,EAAGF,GAAKwC,OAAO9F,KAAKiB,MAAMhB,IAAIkgC,UAAU38B,MAAMhC,EAAE,IAElH,CACAxB,KAAKmjB,UAAY,EACrB,CACJ,EAEA9jB,EAAImuC,WAAWx4B,UAAUwrC,YAAc,WACnC,IACIr9B,EAAYnjB,KAAKmjB,UAWrB,GAVInjB,KAAK6U,YAAYiD,MACZ9X,KAAK6U,YAAYiD,IAAIukC,OAAOjnB,OAAUp1B,KAAK6U,YAAYiD,IAAIukC,OAAOjnB,MAAM1zB,SACzE1B,KAAK6U,YAAYiD,IAAIukC,OAAOjnB,MAAQp1B,KAAK0F,KAAKoS,IAAIukC,OAAOjnB,OAExDp1B,KAAK6U,YAAYiD,IAAIwkC,SAASlnB,OAAUp1B,KAAK6U,YAAYiD,IAAIwkC,SAASlnB,MAAM1zB,SAC7E1B,KAAK6U,YAAYiD,IAAIwkC,SAASlnB,MAAQp1B,KAAK0F,KAAKoS,IAAIwkC,SAASlnB,QAIrEp1B,KAAKygD,gBAAkB,CAAC,EACpBzgD,KAAK2F,OAML,IALA3F,KAAK0gD,aAAerhD,EAAIgsB,KAAK4rB,WAAWj3C,KAAK2F,QAC7C3F,KAAK0gD,aAAa5uC,QAAQ9L,OAAS,GACnChG,KAAK0gD,aAAa5uC,QAAQrL,OAAS,GAG9BjF,EAAI,EAAGC,EAAOzB,KAAK2F,OAAO+a,MAAMhf,OAAQF,EAAIC,EAAMD,GAAK,EACxDxB,KAAK2F,OAAO+a,MAAMlf,GAAGwd,KAAKhf,KAAK0gD,aAAc1gD,KAAKiB,MAAOjB,KAAKiE,WAGlEjE,KAAK0gD,cAAe,EAGxB,GAAI1gD,KAAK4F,MAML,IALA5F,KAAK2gD,YAActhD,EAAIgsB,KAAK4rB,WAAWj3C,KAAK4F,OAC5C5F,KAAK2gD,YAAY7uC,QAAQ9L,OAAS,GAClChG,KAAK2gD,YAAY7uC,QAAQrL,OAAS,GAG7BjF,EAAI,EAAGC,EAAOzB,KAAK4F,MAAM8a,MAAMhf,OAAQF,EAAIC,EAAMD,GAAK,EACvDxB,KAAK4F,MAAM8a,MAAMlf,GAAGwd,KAAKhf,KAAK2gD,YAAa3gD,KAAKiB,MAAOjB,KAAKiE,WAGhEjE,KAAK2gD,aAAc,EA+CvB,GA3CI3gD,KAAKN,OACLigD,MAAM,OAIV3/C,KAAK4gD,gBAED5gD,KAAKN,OACLigD,MAAM,OAIV3/C,KAAK6gD,8BAED7gD,KAAKN,OACLigD,MAAM,OAKV3/C,KAAK8gD,4BAED9gD,KAAKN,OACLigD,MAAM,OAKN3/C,KAAKN,OACLigD,MAAM,OAIV3/C,KAAK+gD,gBAGL/gD,KAAKghD,iBAEDhhD,KAAKN,OACLigD,MAAM,OAIqB,UAA3B3/C,KAAK0F,KAAKoM,QAAQ4a,KAAtB,CASI1sB,KAAKN,OACLigD,MAAM,OAGV3/C,KAAKihD,oBAEDjhD,KAAKN,OACLigD,MAAM,OAGV3/C,KAAKkhD,cAAclhD,KAAKggD,cAEpBhgD,KAAKN,OACLigD,MAAM,QAGV3/C,KAAKmhD,iBAEDnhD,KAAKN,OACLigD,MAAM,QAGV,IAAIyB,EAAY,GAChB,IAAK5/C,EAAI,EAAGC,EAAO0hB,EAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACnD,IAAI6/C,EAAIl+B,EAAU3hB,GACd8/C,EAAmB,GACnB1jB,GAAe,EACf2jB,EAAU,KACd,GAAKvhD,KAAKiB,MAAMC,IAAIiC,uBAAuBy7B,iCAEpC,CAEC5+B,KAAKN,OACLigD,MAAM,SAGV,IAAK,IAAI78C,EAAI,EAAG4B,EAAO1E,KAAK49B,aAAayjB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC/Dw+C,EAAiB38C,KAAK3E,KAAKwhD,2BAA2B,CAACxhD,KAAK29B,QAAQ0jB,GAAGv+C,GAAI9C,KAAK49B,aAAayjB,GAAGv+C,MAOpG,GAJI9C,KAAKN,OACLigD,MAAM,SAGN3/C,KAAK49B,aAAayjB,GAAG3/C,OAAQ,CAC7B,IAAIyR,EAAMnT,KAAK4/C,aAAe5/C,KAAKygD,gBAAgBY,GAC/CrhD,KAAKyhD,SAASJ,GAAG3/C,SACjByR,GAAO,GAEXyqB,EAAe59B,KAAK0hD,oBAAoBJ,EAAkBnuC,EAC9D,CAEInT,KAAKN,OACLigD,MAAM,SAGN4B,EAAUvhD,KAAK2hD,+BAA+B,CAAC3hD,KAAKyhD,SAASJ,GAAIzjB,IAEjE59B,KAAKN,OACLigD,MAAM,QAGd,MAjCI4B,EAAUvhD,KAAK4hD,MAAM,CAAC5hD,KAAKyhD,SAASJ,IAAK,IA8C7C,GAZIE,IAEKvhD,KAAKiB,MAAMhB,IAAIyhB,YAChB6/B,EAAUvhD,KAAK6hD,aAAaN,EAASF,IAEzCD,EAAUz8C,KAAK48C,IAGfvhD,KAAKN,OACLigD,MAAM,SAGN3/C,KAAK8hD,YACL,KAER,CAaA,IAXI9hD,KAAKN,OACLigD,MAAM,QAGV3/C,KAAKiB,MAAMqoB,OAAO0M,UAAU,SAC5Bh2B,KAAKiB,MAAMqoB,OAAO4L,QAAQjkB,QAAQa,QAAQ+F,UAAY7X,KAAKiB,MAAMmvB,WAAWpwB,KAAK+E,MAAO,YAAa,mBAEjG/E,KAAKN,OACLigD,MAAM,QAGLn+C,EAAI,EAAGC,EAAO2/C,EAAU1/C,OAAQF,EAAIC,EAAMD,GAAK,EAEhDxB,KAAKiB,MAAMqoB,OAAOiN,OAAO6qB,EAAU5/C,GAAI,WAAW,IAEjDxB,KAAKiB,MAAMhB,IAAIq2B,cAAgB8qB,EAAU1/C,OAAS,IACnD1B,KAAKiB,MAAMhB,IAAIotC,6BAA8B,GAG7CrtC,KAAKN,OACLigD,MAAM,QAGV3/C,KAAKiB,MAAMqoB,OAAO4M,WAAW,SAEzBl2B,KAAKN,OACLigD,MAAM,QAGV,IAAIvtB,EAAOpyB,KAAKiB,MAAMqoB,OAAOte,MAC7BhL,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAMkmB,EAE3BpyB,KAAKN,OACLigD,MAAM,QAOV,IAAIoC,EAAa1iD,EAAIgsB,KAAK4rB,WAAWj3C,KAAK+E,OAoB1C,GAnBI/E,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIC,WACjCjS,EAAIyR,+BAA+B9Q,KAAKiB,MAAOjB,KAAK+E,MAAM+M,QAAQ9L,OAAQ,KAAMhG,KAAK+E,OAEzF/E,KAAKiB,MAAMqoB,OAAOiN,OAAOnE,EAAM2vB,GAC3B/hD,KAAKiB,MAAMhB,IAAI82B,wBACf/2B,KAAKiB,MAAMhB,IAAIsG,kBAAmB,GAGlCvG,KAAKN,OACLigD,MAAM,QAMN3/C,KAAKN,OACLigD,MAAM,QAGW,cAAjBx8B,EAAU,GAAoB,CAE9B,IAAI6+B,EAAmB,GACnBC,EAAWjiD,KAAKiE,KAAKkf,EAAU,IACnC,GAAI8+B,EACA,IAAK,IAAIzgD,EAAI,EAAGC,EAAOwgD,EAASvgD,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACtD,IAAI0gD,EAAY7iD,EAAIgsB,KAAK82B,MAAMC,WAAWH,EAASzgD,IAC/C0gD,GACAF,EAAiBr9C,KAAKu9C,EAE9B,EAEJF,EAAmBA,EAAiBrgD,KAAK,SAErC3B,KAAKiB,MAAMhB,IAAIstC,UAAUjW,OAAS0qB,EAE1C,CAWA,GAHIhiD,KAAKiB,MAAMhB,IAAIstC,UAAUjW,SAAWt3B,KAAKiB,MAAMhB,IAAIquC,oBACnDtuC,KAAKiB,MAAMhB,IAAIquC,kBAAoBtuC,KAAKiB,MAAMhB,IAAIstC,UAAUjW,QAE5D,YAAct3B,KAAKiE,KAAKkB,MACpBnF,KAAKiB,MAAMhB,IAAIquC,kBAAmB,CAClC,IAAI+T,EAAe,GACnBA,EAAa19C,KAAK3E,KAAKiB,MAAMhB,IAAIquC,mBAC7BtuC,KAAKiE,KAAKhC,OACVogD,EAAa19C,KAAK3E,KAAKiE,KAAKhC,QAEhCogD,EAAeA,EAAa1gD,KAAK,QACb3B,KAAKiB,MAAM2S,IAAIsU,kBAC3BloB,KAAKiB,MAAM2S,IAAIic,sBACfwyB,EAAeriD,KAAKiB,MAAM2S,IAAIic,oBAAoB,UAAWwyB,IAEjEriD,KAAKiB,MAAMknB,UAAU2H,iBAAiB,UAAW,UAAWuyB,EAAcriD,KAAKiE,KAAK6qB,UAChF9uB,KAAKiB,MAAMknB,UAAU4H,QAAiB,QAAE3tB,QAAQigD,KAChDriD,KAAKiB,MAAMhB,IAAIkgC,UAAUx7B,KAAK,SAC9B3E,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAKiB,MAAMknB,UAAU4H,QAAiB,QAAE3tB,QAAQigD,GAAe,SAAS,GACjGjwB,EAAOpyB,KAAKiB,MAAMqoB,OAAOte,MACrChL,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAMpqB,MACvBhL,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAMzwB,KAAKytB,IAGpD,CAIJpyB,KAAKsiD,kBAGLtiD,KAAKmjB,UAAY,GAGjBnjB,KAAKiB,MAAMhB,IAAI+gC,oBAAsB,EAGjChhC,KAAKN,OACLigD,MAAM,OA7MV,MALQ3/C,KAAKiB,MAAMhB,IAAIyhB,WAAiC,GAApB1hB,KAAKuiD,eACjCviD,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAKuiD,YAAa,SAC3CviD,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EAmNhE,EAEAxgC,EAAImuC,WAAWx4B,UAAU6sC,aAAe,SAAUzvB,EAAMivB,GACpD,IAAI5zC,EACJ,IAAKzN,KAAK0wB,QAAU1wB,KAAK0wB,MAAM1wB,KAAKmgD,eAChC,OAAO/tB,EAEX,IAAIzF,EAAS,EACTjU,EAAM1Y,KAAKwiD,eAAenB,GAAKrhD,KAAKyiD,mBAAmBpB,GAC3D,GAAI3oC,EAAM,EACNiU,EAAS,MACN,CACH,IAAK,IAAInrB,EAAI,EAAGC,EAAOzB,KAAK29B,QAAQ0jB,GAAG3/C,OAAQF,EAAIC,EAAMD,GAAK,EAC1DkX,GAAO1Y,KAAK0iD,cAAcrB,GAAG7/C,GAE7BkX,EAAM,IACNiU,EAAS,EAEjB,CAyBA,OAvBI3sB,KAAK0wB,MAAM1wB,KAAKmgD,eAAenC,QAC3B,iBAAoBh+C,KAAK0wB,MAAM1wB,KAAKmgD,eAAenC,OAAOlsC,QAAQ6a,SAClEA,EAAS3sB,KAAK0wB,MAAM1wB,KAAKmgD,eAAenC,OAAOlsC,QAAQ6a,QAE3Dlf,EAAMzN,KAAK2iD,YAAYtB,EAAG10B,EAAQ,SAAU3sB,KAAKmgD,eACjDngD,KAAKiB,MAAMqoB,OAAO0M,UAAU,SAC5Bh2B,KAAKiB,MAAMqoB,OAAOiN,OAAO9oB,EAAKzN,KAAK0wB,MAAM1wB,KAAKmgD,eAAenC,QAAQ,GACrEh+C,KAAKiB,MAAMqoB,OAAOiN,OAAOnE,EAAM,WAAW,GAC1CpyB,KAAKiB,MAAMqoB,OAAO4M,WAAW,SAC7B9D,EAAOpyB,KAAKiB,MAAMqoB,OAAOte,OAClBhL,KAAK0wB,MAAM1wB,KAAKmgD,eAAepC,QAClC,iBAAoB/9C,KAAK0wB,MAAM1wB,KAAKmgD,eAAepC,MAAMjsC,QAAQ6a,SACjEA,EAAS3sB,KAAK0wB,MAAM1wB,KAAKmgD,eAAepC,MAAMjsC,QAAQ6a,QAE1Dlf,EAAMzN,KAAK2iD,YAAYtB,EAAG10B,EAAQ,QAAS3sB,KAAKmgD,eAChDngD,KAAKiB,MAAMqoB,OAAO0M,UAAU,SAC5Bh2B,KAAKiB,MAAMqoB,OAAOiN,OAAOnE,EAAM,WAAW,GAC1CpyB,KAAKiB,MAAMqoB,OAAOiN,OAAO9oB,EAAKzN,KAAK0wB,MAAM1wB,KAAKmgD,eAAepC,OAAO,GACpE/9C,KAAKiB,MAAMhB,IAAIigD,WAAalgD,KAAKiB,MAAMqoB,OAAOte,MAC9ChL,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAKiB,MAAMhB,IAAIigD,WAAW,WAAU,GAC7DlgD,KAAKiB,MAAMqoB,OAAO4M,WAAW,SAC7B9D,EAAOpyB,KAAKiB,MAAMqoB,OAAOte,OAEtBonB,CACX,EAEA/yB,EAAImuC,WAAWx4B,UAAU2tC,YAAc,SAAUl2B,EAAME,EAAQob,EAAUsZ,GACjErhD,KAAK8hD,cACLr1B,EAAOzsB,KAAK8hD,aAGhB,IAAIr3C,GAAM,EACNsM,EAAO/W,KAAK0wB,MAAM2wB,GAAGtZ,GAIzB,OAHIhxB,IACAtM,EAAMpL,EAAIujD,UAAU5iD,KAAKiB,MAAO8V,EAAM0V,EAAME,EAAQttB,EAAIiK,WAErDmB,CACX,EAGApL,EAAImuC,WAAWx4B,UAAUstC,gBAAkB,WACvC,IAAIO,EAASC,EAAOC,EAG8B,IAA9C/iD,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAM1zB,SAGb,IAAtB1B,KAAK4/C,cAAsB5/C,KAAKiE,KAAKjE,KAAKmjB,UAAU,MAAQnjB,KAAK8/C,0BACjE9/C,KAAK8/C,wBAA0B9/C,KAAKmjB,UAAU,KAE7CnjB,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,UAC9BziC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,SAAS/gC,QAChD1B,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,sBACjC5qC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,qBAAqBlpC,UAE5D1B,KAAKiB,MAAMhB,IAAIomC,sBAEfyc,EAAQ,GACRD,EAAU7iD,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAM5xB,OAAO,GAAG,GAAG4xB,MAC1D2tB,EAAW/iD,KAAKiB,MAAMhB,IAAI63B,kBACtB+qB,IACAC,EAAQ9iD,KAAKiB,MAAMqoB,OAAOgO,OAAOt3B,KAAKiB,MAAO4hD,GAAS,IAI1D7iD,KAAKiB,MAAMhB,IAAI63B,kBAAoBirB,EACnC/iD,KAAKiB,MAAMwS,SAASgzB,cAAczmC,KAAKiE,KAAKoqB,IAAMy0B,GAC1C9iD,KAAKiB,MAAMhB,IAAIq2B,cACZt2B,KAAKiB,MAAMhB,IAAIm4B,wBAA0Bp4B,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,UAAYziC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,SAAS/gC,QAAW1B,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,sBAAwB5qC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,wBAE5PkY,EAAQ,GACRD,EAAU7iD,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAM5xB,OAAO,GAAG,GAAG4xB,MAC1D2tB,EAAW/iD,KAAKiB,MAAMhB,IAAI63B,kBACtB+qB,IACAC,EAAQ9iD,KAAKiB,MAAMqoB,OAAOgO,OAAOt3B,KAAKiB,MAAO4hD,GAAS,IAEtDC,IAAU9iD,KAAKiB,MAAMhB,IAAIsrC,4BACrBvrC,KAAKkD,KAAK,oBAAuBlD,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,UAAYziC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAIuhC,SAAS/gC,UAE9H1B,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAMpqB,MACnChL,KAAKiB,MAAMhB,IAAIstC,UAAUx4B,SAAW,GAGpC/U,KAAKiB,MAAMhB,IAAI63B,kBAAoBirB,GAGnC/iD,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,sBAAwB5qC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,uBAChG5qC,KAAKiB,MAAMhB,IAAI0qC,0BAA2B,KAI9C3qC,KAAKiB,MAAMhB,IAAIsrC,0BAA4BuX,EAIvC9iD,KAAKmjB,UAAUpgB,QAAQ/C,KAAK8/C,0BAA4B,GAAK9/C,KAAKkD,MAAQlD,KAAKkD,KAAK,oBAAyC,eAAnBlD,KAAKiE,KAAKkB,OACpHnF,KAAKiB,MAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAMpqB,MACnChL,KAAKiB,MAAMhB,IAAIstC,UAAUx4B,SAAW,GAGpC/U,KAAKiB,MAAMhB,IAAI63B,kBAAoBirB,EAGnC/iD,KAAKiB,MAAMhB,IAAIsG,kBAAmB,GAGtCvG,KAAKiB,MAAMhB,IAAIyqC,gBAAiB,EAE5B1qC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,sBAAwB5qC,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMnM,IAAI0pC,uBAChG5qC,KAAKiB,MAAMhB,IAAI0qC,0BAA2B,MAK9D,EAaAtrC,EAAImuC,WAAWx4B,UAAUguC,SAAW,SAAU/xC,GAC1C,QAAIA,EAAMxL,UACDwL,EAAMrL,OAASqL,EAAMtL,QAAUsL,EAAMgyC,cAMlD,EAIA5jD,EAAImuC,WAAWx4B,UAAU8rC,0BAA4B,WACjD,IAAIO,EAAG7/C,EAAGC,EAAeyhD,EAOzB,IAAK7B,KAJLrhD,KAAKwiD,eAAiB,CAAC,EACvBxiD,KAAK0iD,cAAgB,CAAC,EACtB1iD,KAAKyiD,mBAAqB,CAAC,EAEjBziD,KAAKyhD,SACPzhD,KAAKyhD,SAASx+B,eAAeo+B,KAC7BrhD,KAAKwiD,eAAenB,GAAKrhD,KAAKyhD,SAASJ,GAAG3/C,OAC1C1B,KAAKyhD,SAASJ,GAAKrhD,KAAKmjD,kBAAkBnjD,KAAKyhD,SAAUJ,IAIjE,IAAKA,KAAKrhD,KAAK29B,QACX,GAAI39B,KAAK29B,QAAQ1a,eAAeo+B,GAK5B,IAJArhD,KAAKyiD,mBAAmBpB,GAAKrhD,KAAK49B,aAAayjB,GAAG3/C,OAClD1B,KAAKmjD,kBAAkBnjD,KAAK49B,aAAcyjB,GAC1CrhD,KAAK29B,QAAQ0jB,GAAKrhD,KAAK29B,QAAQ0jB,GAAG79C,MAAM,EAAGxD,KAAK49B,aAAayjB,GAAG3/C,QAChE1B,KAAK0iD,cAAcrB,GAAK,GACnBv+C,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EACtD9C,KAAK0iD,cAAcrB,GAAGv+C,GAAK9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,OAC9C1B,KAAK29B,QAAQ0jB,GAAGv+C,GAAK9C,KAAKmjD,kBAAkBnjD,KAAK29B,QAAS0jB,EAAGv+C,GAYzE,IAFIogD,KANAljD,KAAKiB,MAAMC,IAAIiC,uBAAuBg8B,6BACjB,IAAlBn/B,KAAKojD,UAA0C,IAAxBpjD,KAAKqjD,gBAC1BrjD,KAAKiB,MAAMhB,IAAIyhB,WACZ1hB,KAAKiB,MAAMhB,IAAIq2B,eACb+qB,IAICrhD,KAAK+/C,aAChB,IAAKv+C,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACxD6/C,EAAIrhD,KAAKmjB,UAAU3hB,GACfxB,KAAKyhD,SAASJ,GAAG3/C,SACb1B,KAAK+/C,eAAiBsB,GACtBrhD,KAAKyhD,SAASJ,GAAKrhD,KAAKyhD,SAASJ,GAAG79C,MAAM,GAC1CxD,KAAKwiD,eAAenB,KAAO,EAC3BrhD,KAAK+/C,cAAe,GACbmD,IAAYljD,KAAK+/C,eACxB//C,KAAKyhD,SAASJ,GAAKrhD,KAAKyhD,SAASJ,GAAG79C,MAAM,EAAG,GAC7CxD,KAAKwiD,eAAenB,GAAK,EACzBrhD,KAAK49B,aAAayjB,GAAK,GACvBrhD,KAAK29B,QAAQ0jB,GAAK,GAClBrhD,KAAK+/C,aAAemD,IAG5B,IAAK,IAAIpgD,EAAE,EAAE4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAOoB,EAAE4B,EAAK5B,IAC9C,GAAI9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,OAAQ,CAC3B,GAAI1B,KAAK+/C,eAAiBsB,EAAG,CACzBrhD,KAAK29B,QAAQ0jB,GAAGv+C,GAAK9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGU,MAAM,GAC9CxD,KAAK0iD,cAAcrB,GAAGv+C,KAAO,EAC7B9C,KAAK+/C,cAAe,EACpB,KACJ,CAAO,GAAImD,IAAYljD,KAAK+/C,aAAc,CACtC//C,KAAKyhD,SAASJ,GAAKrhD,KAAK29B,QAAQ0jB,GAAGv+C,GAAGU,MAAM,EAAG,GAC/CxD,KAAKwiD,eAAenB,GAAK,EACzBrhD,KAAK49B,aAAayjB,GAAK,GACvBrhD,KAAK29B,QAAQ0jB,GAAK,GACT,GACTrhD,KAAK+/C,aAAemD,EACpB,KACJ,CACJ,CAEAljD,KAAK49B,aAAayjB,GAAG3/C,SACjB1B,KAAK+/C,eAAiBsB,GACtBrhD,KAAK49B,aAAayjB,GAAKrhD,KAAK49B,aAAayjB,GAAG79C,MAAM,GAClDxD,KAAKyiD,mBAAmBpB,KAAO,EAC/BrhD,KAAK+/C,cAAe,GACbmD,IAAYljD,KAAK+/C,eACxB//C,KAAK49B,aAAayjB,GAAKrhD,KAAK49B,aAAayjB,GAAG79C,MAAM,EAAG,GACrDxD,KAAKyiD,mBAAmBpB,GAAK,EACpB,GACTrhD,KAAK+/C,aAAemD,GAGhC,CAgCJ,IAAK1hD,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACpDxB,KAAK49B,aAAayjB,GAAG3/C,SACrB1B,KAAKigD,gBAAkB,GAE3B,IAASn9C,EAAE,EAAE4B,EAAK1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAOoB,EAAE4B,EAAK5B,IACxC9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,SACnB1B,KAAKigD,gBAAkB,EAInC,CACJ,EAEA5gD,EAAImuC,WAAWx4B,UAAUmuC,kBAAoB,SAAUG,EAAWjsC,EAAUqQ,GACxE,IAAIpmB,EAMJ,GAJIA,OADA,IAAuBomB,EACjB47B,EAAUjsC,GAEVisC,EAAUjsC,GAAUqQ,GAE1B1nB,KAAKiB,MAAMjB,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMiV,MAAMphB,IAAI6hC,qBAClDzhC,EAAII,OAAS,IACbJ,EAAII,OAAU1B,KAAKiB,MAAMjB,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMiV,MAAMphB,IAAI6hC,oBAAsB,EAAI,CAGhG,IAAIwgB,EAAQvjD,KAAKiB,MAAMjB,KAAKiB,MAAMjB,KAAKiB,MAAMhB,IAAIoN,MAAMiV,MAAMphB,IAAI6hC,oBACjEzhC,EAAMA,EAAIkC,MAAM,EAAG+/C,EAAM,GAAGz9C,OAAOxE,EAAIkC,OAAO,GAClD,CACA,OAAOlC,CACX,EAKAjC,EAAImuC,WAAWx4B,UAAU6rC,4BAA8B,WACnD,IAAIr/C,EAAGC,EAAMqB,EAAG4B,EACZT,EAAOjE,KAAKiE,KACZkf,EAAYnjB,KAAKmjB,UAKrB,IAJAnjB,KAAKwjD,SAAWrgC,EAAU3f,QAC1BxD,KAAKyhD,SAAW,CAAC,EACjBzhD,KAAK29B,QAAU,CAAC,EAChB39B,KAAK49B,aAAe,CAAC,EAChBp8B,EAAI,EAAGC,EAAO0hB,EAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACnD,IAAI6/C,EAAIl+B,EAAU3hB,GAClBxB,KAAKygD,gBAAgBY,GAAKrhD,KAAKigD,eAC/B,IAAIjvB,EAAShxB,KAAKyjD,wBAAwBx/C,EAAMo9C,GAShD,GARIrhD,KAAK0F,KAAKoM,QAAQ,iBAAmBkf,EAAOtvB,QAAU1B,KAAK0F,KAAKoM,QAAQ,kBACxEkf,EAAS,IAEThxB,KAAK0F,KAAKoM,QAAQ,iBAAmBkf,EAAOtvB,QAAU1B,KAAK0F,KAAKoM,QAAQ,kBACxEkf,EAAS,IAEbhxB,KAAK0jD,aAAarC,EAAGrwB,GACrBhxB,KAAK2jD,2BAA2BtC,EAAGrwB,GAC/BhxB,KAAKiB,MAAMC,IAAIiC,uBAAuBy7B,iCACtC,GAA0C,IAAtC5+B,KAAK0F,KAAKoM,QAAQ,gBAElB,IADA9R,KAAKyhD,SAASJ,GAAK,GACdv+C,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EACtD9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAK,QAEtB,GAAiD,IAA7C9C,KAAK6U,YAAY/C,QAAQ,gBAAuB,CAGvD,IAFA9R,KAAK49B,aAAayjB,GAAK,GACvBrhD,KAAKyhD,SAASJ,GAAKrhD,KAAKyhD,SAASJ,GAAGv7C,OAAO9F,KAAK29B,QAAQ0jB,IACnDv+C,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EACtD,IAAK,IAAIiV,EAAI,EAAGC,EAAOhY,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,OAAQqW,EAAIC,EAAMD,GAAK,EAC7D/X,KAAKyhD,SAASJ,GAAG18C,KAAK3E,KAAK29B,QAAQ0jB,GAAGv+C,GAAGiV,IAGjD/X,KAAK29B,QAAQ0jB,GAAK,EACtB,CAER,CACJ,EAEAhiD,EAAImuC,WAAWx4B,UAAUyuC,wBAA0B,SAAUx/C,EAAMoT,GAC/D,IAAItS,EAaJ,MAZI,iBAAoBd,EAAKoT,IAAa,iBAAoBpT,EAAKoT,IAC/DhY,EAAIK,MAAM,kBAAqB2X,EAAW,wDAC1CtS,EAAQ,CAAC,CAACU,QAASxB,EAAKoT,GAAY,MAC5BpT,EAAKoT,GAEN,iBAAoBpT,EAAKoT,GAAU3V,QAC1CrC,EAAIK,MAAM,kBAAqB2X,EAAW,8CAC1CpT,EAAKoT,GAAY,CAACpT,EAAKoT,IACvBtS,EAAQd,EAAKoT,GAAU7T,SAEvBuB,EAAQd,EAAKoT,GAAU7T,QANvBuB,EAAQ,GAQLA,CACX,EAEA1F,EAAImuC,WAAWx4B,UAAU0uC,aAAe,SAAUrC,EAAGrwB,GAEjD,GADAhxB,KAAKyhD,SAASJ,GAAK,GACfrhD,KAAKiB,MAAMC,IAAIiC,uBAAuBy7B,iCACtC,IAAK,IAAIp9B,EAAEwvB,EAAOtvB,OAAO,EAAEF,GAAG,GACtBxB,KAAKgjD,SAAShyB,EAAOxvB,IADGA,IAAK,EAEzByP,EAAQjR,KAAK4jD,eAAe5yB,EAAOhmB,SAEnChL,KAAKyhD,SAASJ,GAAG18C,KAAKsM,EAKlC,MAEA,IAASzP,EAAEwvB,EAAOtvB,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACjC,IAAIyP,EAAQ+f,EAAOhmB,MACnB,GAAIhL,KAAKgjD,SAAS/xC,GACVA,EAAQjR,KAAK4jD,eAAe3yC,GAEpCjR,KAAKyhD,SAASJ,GAAG18C,KAAKsM,EAC1B,CAEJjR,KAAKyhD,SAASJ,GAAGv2C,UACb9K,KAAKyhD,SAASJ,GAAG3/C,SACjB1B,KAAKigD,gBAAkB,EAE/B,EAEA5gD,EAAImuC,WAAWx4B,UAAU2uC,2BAA6B,SAAUtC,EAAGrwB,GAG/D,GAFAhxB,KAAK29B,QAAQ0jB,GAAK,GAClBrhD,KAAK49B,aAAayjB,GAAK,GAClBrhD,KAAKiB,MAAMC,IAAIiC,uBAAuBy7B,iCAA3C,CAMA,IAHA,IAAIjB,EAAU,GACVkmB,GAAiB,EACjBvoB,GAAQ,EACH95B,EAAIwvB,EAAOtvB,OAAS,EAAGF,GAAK,EAAGA,IAAM,EAC1C,GAAIxB,KAAKgjD,SAAShyB,EAAOxvB,IAAK,CAC1B,IAAIyP,EAAQjR,KAAK4jD,eAAe5yB,EAAOxvB,IACnCyP,GACA0sB,EAAQh5B,KAAKsM,EAErB,MACI4yC,GAAiB,EACjB7jD,KAAK49B,aAAayjB,GAAG18C,KAAKqsB,EAAOxvB,IAC5B85B,IACDqC,EAAQ7yB,UACR9K,KAAK29B,QAAQ0jB,GAAG18C,KAAKg5B,GACrBA,EAAU,IAEdrC,GAAQ,EAGZuoB,IACAlmB,EAAQ7yB,UACR9K,KAAK29B,QAAQ0jB,GAAG18C,KAAKg5B,GACrB39B,KAAK29B,QAAQ0jB,GAAGv2C,UAChB9K,KAAK49B,aAAayjB,GAAGv2C,UAzBzB,CA2BJ,EAEAzL,EAAImuC,WAAWx4B,UAAU8uC,aAAe,SAAU9yB,GAC9C,IAAK,IAAIxvB,EAAIwvB,EAAOtvB,OAAS,EAAGF,GAAK,EAAGA,IAAM,EAC1CwvB,EAAOhmB,KAEf,EAEA3L,EAAImuC,WAAWx4B,UAAU4uC,eAAiB,SAAUl+C,GAChD,GAAI,CAAC,YAAa,0BAA0B3C,QAAQ/C,KAAKiE,KAAKkB,OAAS,EAAG,CACtE,IAAI4+C,EAEJ,IADAA,EAAS1kD,EAAIgsB,KAAK82B,MAAMC,WAAW18C,KACrB1F,KAAKiB,MAAM2S,IAAIsU,mBAAqBloB,KAAKkD,OAAQlD,KAAKkD,KAAK,oBAAqB,CAC1F,IAAIysB,EAAgBo0B,EAChB/jD,KAAKiB,MAAM2S,IAAIic,sBAEfF,EAAgB3vB,KAAKiB,MAAM2S,IAAIic,oBAAoB,SAAUk0B,IAEjE/jD,KAAKiB,MAAMknB,UAAU2H,iBAAiB,UAAW,WAAYH,EAAe3vB,KAAKiE,KAAK6qB,UAEtF,IAAIk1B,EAAchkD,KAAKiB,MAAMknB,UAAU4H,QAAiB,QAAEhuB,SAAS4tB,GAC/Dq0B,IAEIt+C,EADgB,aAAhBs+C,GAGO,CAACr+C,OAAOq+C,EAAYp+C,MAAM,IAG7C,CACJ,CACA,OAAOF,CACX,EAIArG,EAAImuC,WAAWx4B,UAAUivC,iBAAmB,SAAU7uB,GAClD,IAAK,IAAI5zB,EAAI4zB,EAAM1zB,OAAS,EAAGF,GAAK,EAAGA,IAAM,EACpC4zB,EAAM5zB,IAA0B,IAApB4zB,EAAM5zB,GAAGE,QAAiB0zB,EAAM5zB,GAAG4zB,MAAM1zB,SACtD0zB,EAAQA,EAAM5xB,MAAM,EAAGhC,GAAGsE,OAAOsvB,EAAM5xB,MAAMhC,EAAI,KAGzD,OAAO4zB,CACX,EAEA/1B,EAAImuC,WAAWx4B,UAAUkvC,YAAc,SAAU9uB,EAAOjiB,EAAKrQ,EAAGqhD,GA2B5D,OAzBA/uB,EAAQp1B,KAAKikD,iBAAiB7uB,GACzB+uB,IACDA,EAAY,aAEZ,IAAuBrhD,EACc,IAAjC9C,KAAK6/C,UAAU1sC,GAAKsuC,SACfzhD,KAAKokD,UAAUhvB,GACoB,IAAjCp1B,KAAK6/C,UAAU1sC,GAAKsuC,SACrBzhD,KAAKqkD,cAAcjvB,GACjBp1B,KAAKiB,MAAMhB,IAAIy8C,cAGjB18C,KAAK4hD,MAAMxsB,EAAOp1B,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,YAAa,iBAAkB,OAFlF1F,KAAKskD,SAASlvB,GAKe,IAAnCp1B,KAAK6/C,UAAU1sC,GAAKwqB,QAAQ76B,GACtB9C,KAAKokD,UAAUhvB,GACqB,IAAnCp1B,KAAK6/C,UAAU1sC,GAAKwqB,QAAQ76B,GAC7B9C,KAAKqkD,cAAcjvB,GACjBp1B,KAAKiB,MAAMhB,IAAIy8C,cAGjB18C,KAAK4hD,MAAMxsB,EAAOp1B,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,YAAa,iBAAkB,OAFlF1F,KAAKskD,SAASlvB,EAMhC,EAGA/1B,EAAImuC,WAAWx4B,UAAU0sC,oBAAsB,SAAUtsB,EAAOjiB,GAU5D,OARAiiB,EAAQp1B,KAAKikD,iBAAiB7uB,GACW,IAArCp1B,KAAK6/C,UAAU1sC,GAAKyqB,aACd59B,KAAKokD,UAAUhvB,EAAO,eACgB,IAArCp1B,KAAK6/C,UAAU1sC,GAAKyqB,aACrB59B,KAAKqkD,cAAcjvB,EAAO,eAE1Bp1B,KAAKskD,SAASlvB,EAG5B,EAGA/1B,EAAImuC,WAAWx4B,UAAUwsC,2BAA6B,SAAUpsB,GAE5DA,EAAQp1B,KAAKikD,iBAAiB7uB,GAC9B,IAAI3qB,EAAMzK,KAAK4hD,MAAMxsB,EAAOp1B,KAAKiB,MAAMhB,IAAI+7C,gBAE3C,OADAvxC,EAAIw4C,eAAgB,EACbx4C,CACX,EAIApL,EAAImuC,WAAWx4B,UAAU2sC,+BAAiC,SAAUvsB,GAKhE,OAHAA,EAAQp1B,KAAKikD,iBAAiB7uB,GACpBp1B,KAAK4hD,MAAMxsB,EAAO,eAAgBp1B,KAAW,KAAEq8C,OAAQr8C,KAAW,KAAEs8C,SAGlF,EAEAj9C,EAAImuC,WAAWx4B,UAAUuvC,sBAAwB,SAASnvB,EAAOvd,EAAW2sC,GACxE,GAAIA,GAAapvB,EAAM1zB,OAAS,GACwC,wBAAhE1B,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,2BAAsD,CACvF,IAAI++C,EAAWrvB,EAAMA,EAAM1zB,OAAS,GAChC+iD,EAASrvB,MAAM1zB,OAAS,GAAK+iD,EAASrvB,MAAM,GAAGsvB,aAC/CF,EAAU1yC,QAAQ9L,OAAS6R,EAEnC,CAEJ,OAAO2sC,CACX,EAEAnlD,EAAImuC,WAAWx4B,UAAU2vC,YAAc,SAAUvvB,EAAOvd,GACpD,IAAI2sC,GAAY,EAChB,GAAIpvB,EAAM1zB,OAAS,EAAG,CAClB,IAAIkjD,EAAmB,SACnBxvB,EAAM1zB,OAAS,IACfkjD,EAAmB,YAGnBJ,EADApvB,EAAMA,EAAM1zB,OAAS,GAAGuhD,cACZjjD,KAAK6U,YAAYiD,IAAI8sC,GAErB5kD,KAAK0F,KAAKoS,IAAI8sC,GAG9BJ,EAAY7tC,KAAKC,MAAMD,KAAK8X,UAAU+1B,IACtCA,EAAYxkD,KAAKukD,sBAAsBnvB,EAAOvd,EAAW2sC,EAC7D,CACA,OAAOA,CACX,EAEAnlD,EAAImuC,WAAWx4B,UAAUovC,UAAY,SAAUhvB,GAC3C,IAAIvd,EAAY7X,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,YAAa,iBAAkB,MAC5E0sB,EAAOpyB,KAAK4hD,MAAMxsB,EAAOvd,GAc7B,OAXA7X,KAAKiB,MAAMqoB,OAAO0M,UAAUh2B,KAAK6kD,UAAU,SAG3C7kD,KAAKiB,MAAMqoB,OAAO4L,QAAQjkB,QAAQa,QAAQ+F,UAAY,GACtD7X,KAAKiB,MAAMqoB,OAAOiN,OAAOnE,EAAM,WAAW,GACtCgD,EAAM1zB,OAAS,EACf1B,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAK,SAASs8C,SAAU,WAAW,GACpC,IAAjBlnB,EAAM1zB,QACb1B,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAK,SAASq8C,OAAQ,WAAW,GAE9Dr8C,KAAKiB,MAAMqoB,OAAO4M,aACXl2B,KAAKiB,MAAMqoB,OAAOte,KAC7B,EAGA3L,EAAImuC,WAAWx4B,UAAUqvC,cAAgB,SAAUjvB,GAC/C,IAAIvd,EAAY7X,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,YAAa,iBAAkB,MAC5E8+C,GAAY,EAChB,GAAIpvB,EAAM1zB,OAAS,EAAG,CAClB,IAAIkjD,EAAmB,SACnBxvB,EAAM1zB,OAAS,IACfkjD,EAAmB,YAEvBJ,EAAY7tC,KAAKC,MAAMD,KAAK8X,UAAUzuB,KAAK0F,KAAKo/C,SAASF,KACzDJ,EAAYxkD,KAAKukD,sBAAsBnvB,EAAOvd,EAAY2sC,EAE9D,CACA,OAAOxkD,KAAK4hD,MAAMxsB,EAAOvd,EAAW2sC,EACxC,EAEAnlD,EAAImuC,WAAWx4B,UAAUsvC,SAAW,SAAUlvB,GAC1C,IAAIvd,EAAY7X,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,YAAa,iBAAkB,MAC5E8+C,EAAYxkD,KAAK2kD,YAAYvvB,EAAOvd,GACxC,OAAO7X,KAAK4hD,MAAMxsB,EAAOvd,EAAW2sC,EACxC,EAGAnlD,EAAImuC,WAAWx4B,UAAU4sC,MAAQ,SAAUxsB,EAAOvd,EAAW2sC,GAEzD,IAAKpvB,EACD,OAAO,EAGX,KADAA,EAAQp1B,KAAKikD,iBAAiB7uB,IACnB1zB,OACP,OAAO,EAEX,GAAI0zB,EAAM1zB,OAAS,EACf,GAAqB,IAAjB0zB,EAAM1zB,OACD8iD,EAGDpvB,EAAQ,CAACA,EAAM,GAAIovB,EAAWpvB,EAAM,IAFpCA,EAAM,GAAGtjB,QAAQrL,QAAUoR,MAI5B,CACH,IAAI/S,EAEAA,EADA0/C,EACS,EAEA,EAGb,IADA,IAAIpyB,EAAOgD,EAAMpqB,MACRxJ,EAAE,EAAEC,EAAK2zB,EAAM1zB,OAASoD,EAAOtD,EAAEC,EAAKD,IAC3C4zB,EAAM5zB,GAAGsQ,QAAQrL,QAAUoR,EAE/Bud,EAAMzwB,KAAK6/C,GACXpvB,EAAMzwB,KAAKytB,EACf,CASJ,IALApyB,KAAKiB,MAAMqoB,OAAO0M,YAKbx0B,EAAI,EAAGC,EAAO2zB,EAAM1zB,OAAQF,EAAIC,EAAMD,GAAK,EAC5CxB,KAAKiB,MAAMqoB,OAAOiN,OAAOnB,EAAM5zB,IAAI,GAAO,GAG9C,OADAxB,KAAKiB,MAAMqoB,OAAO4M,aACXl2B,KAAKiB,MAAMqoB,OAAOte,KAC7B,EAGA3L,EAAImuC,WAAWx4B,UAAU6vC,UAAY,SAAUV,GAC3C,IAAInzC,EAAQhR,KAAKmkD,GACjB,MAAkB,gBAAdA,EACe,IAAI9kD,EAAI8hB,MAOpBnQ,CACX,EAIA3R,EAAImuC,WAAWx4B,UAAUorC,kBAAoB,SAASJ,GAClD,IAAKA,EACD,OAAO,EAEX,IAAI8B,GAAc,EAClB,GAA8B,IAA1B9hD,KAAKmjB,UAAUzhB,OAAc,CAC7B,IACI8hD,EADYxjD,KAAKmjB,UACI3f,QACzBggD,EAASjwB,OACTuuB,EAAc0B,EAAS7hD,KAAK,GAChC,CACA,IAAKmgD,EACD,OAAO,EAEX,IAAIiD,GAAW,EAIf,GAHI/kD,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMwqB,MAAM+0B,KAC7CiD,GAAW,IAEVA,EAGD,OAFA/kD,KAAKiB,MAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKmjB,UAAU,IAC7CnjB,KAAKiB,MAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKmjB,UAAU,KACtC,EAEX,IAAI6hC,EAAWhlD,KAAKiE,KAAKjE,KAAKmjB,UAAU,IACpC8hC,EAAYjlD,KAAKiE,KAAKjE,KAAKmjB,UAAU,IACrC+hC,EAAellD,KAAKmlD,iBAAiBH,EAAUC,GASnD,OARqB,IAAjBC,IACAllD,KAAKiB,MAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKmjB,UAAU,IAC7CnjB,KAAKiB,MAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKmjB,UAAU,MAMzC+hC,CACZ,EAEA7lD,EAAImuC,WAAWx4B,UAAUksC,cAAgB,WACrC,IACIsC,EADYxjD,KAAKmjB,UACI3f,QAIzB,GAHAggD,EAASjwB,OACTvzB,KAAK8hD,YAAc0B,EAAS7hD,KAAK,IAE5B3B,KAAK8hD,YAAV,CAGA,IAAIiD,GAAW,EAUf,GATI/kD,KAAK0wB,OAAS1wB,KAAK0wB,MAAM1wB,KAAKmjB,UAAU,MACpCnjB,KAAK0wB,MAAM1wB,KAAKmjB,UAAU,IAAI66B,OAC9B+G,EAAW/kD,KAAKiB,MAAM+qB,QAAQhsB,KAAK8hD,YAAa9hD,KAAK0wB,MAAM1wB,KAAKmjB,UAAU,IAAI66B,OAAOlsC,QAAQ4a,KAAM,GAC5F1sB,KAAK0wB,MAAM1wB,KAAKmjB,UAAU,IAAI46B,QACrCgH,EAAW/kD,KAAKiB,MAAM+qB,QAAQhsB,KAAK8hD,YAAa9hD,KAAK0wB,MAAM1wB,KAAKmjB,UAAU,IAAI46B,MAAMjsC,QAAQ4a,KAAM,MAKrG1sB,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMwqB,MAAM/sB,KAAK8hD,eAC/CiD,GACD/kD,KAAKmjB,UAAUzhB,OAAS,EAC3B1B,KAAK8hD,aAAc,OAIvB,IADA,IACStgD,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAS,EAAGF,EAAIC,EAAMD,GAAK,EAAG,CAChE,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,GACnB4jD,EAAKplD,KAAKmjB,UAAU3hB,EAAI,GAC5B,GAAIxB,KAAKyhD,SAASJ,GAAG3/C,QAAU1B,KAAKyhD,SAAS2D,GAAI1jD,OAAQ,CACrD,GAAI1B,KAAK6/C,UAAUwB,GAAGI,WAAazhD,KAAK6/C,UAAUuF,GAAI3D,WAC9CzhD,KAAKmlD,iBAAiBnlD,KAAKyhD,SAASJ,GAAIrhD,KAAKyhD,SAAS2D,IAE1D,YADAplD,KAAK8hD,aAAc,GAGJ,CACvB,CACA,GAAI9hD,KAAK29B,QAAQ0jB,GAAG3/C,SAAW1B,KAAK29B,QAAQynB,GAAI1jD,OAE5C,YADA1B,KAAK8hD,aAAc,GAGvB,IAAK,IAAIh/C,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC1D,GAAI9C,KAAK6/C,UAAUwB,GAAG1jB,QAAQ76B,KAAO9C,KAAK6/C,UAAUuF,GAAIznB,QAAQ76B,KACxD9C,KAAKmlD,iBAAiBnlD,KAAK29B,QAAQ0jB,GAAGv+C,GAAI9C,KAAK29B,QAAQynB,GAAItiD,IAE/D,YADA9C,KAAK8hD,aAAc,EAI/B,CAxCA,CAyCJ,EAEAziD,EAAImuC,WAAWx4B,UAAUmwC,iBAAmB,SAAUE,EAAcC,GAChE,IAAKD,IAAiBC,GAAWD,EAAa3jD,SAAW4jD,EAAQ5jD,OAC7D,OAAO,EAEX,IAAK,IAAIF,EAAI,EAAGC,EAAO6jD,EAAQ5jD,OAAQF,EAAIC,EAAMD,GAAK,EAClD,IAAK,IAAIsB,EAAI,EAAG4B,EAAOrF,EAAI2J,WAAWtH,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CAC5D,IAAIwiB,EAAOjmB,EAAI2J,WAAWlG,GAC1B,IAAKuiD,EAAa7jD,IAAM6jD,EAAa7jD,GAAG8jB,IAASggC,EAAQ9jD,GAAG8jB,GACxD,OAAO,CAEf,CAEJ,OAAO,CACX,EAIAjmB,EAAImuC,WAAWx4B,UAAUgsC,eAAiB,WAKtC,IAAI7tC,EAFJnT,KAAKuiD,YAAc,EAGnB,IAAK,IAAI/gD,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAC5D,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,GACvB2R,EAAMnT,KAAK4/C,aAAep+C,EAEtBxB,KAAKyhD,SAASJ,GAAG3/C,SACjB1B,KAAKiB,MAAMhB,IAAI+f,UAAUrb,KAAK3E,KAAKyhD,SAASJ,GAAG3/C,OAAQ,WACvD1B,KAAKulD,uBAAuBvlD,KAAKyhD,SAAUzhD,KAAKwiD,eAAgBnB,EAAGluC,GACnEnT,KAAKuiD,aAAeviD,KAAKyhD,SAASJ,GAAG3/C,QAIrC1B,KAAK49B,aAAayjB,GAAG3/C,SACrB1B,KAAKiB,MAAMhB,IAAI+f,UAAUrb,KAAK3E,KAAK49B,aAAayjB,GAAG3/C,OAAQ,WAC3D1B,KAAKulD,uBAAuBvlD,KAAK49B,aAAc59B,KAAKyiD,mBAAoBpB,EAAGluC,GAC3EnT,KAAK29B,QAAQ0jB,GAAKrhD,KAAK29B,QAAQ0jB,GAAG79C,MAAM,EAAGxD,KAAK49B,aAAayjB,GAAG3/C,QAChE1B,KAAKuiD,aAAeviD,KAAK49B,aAAayjB,GAAG3/C,QAG7C,IAAK,IAAIoB,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAEtD9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,SACnB1B,KAAKiB,MAAMhB,IAAI+f,UAAUrb,KAAK3E,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,OAAQ,WACzD1B,KAAKulD,uBAAuBvlD,KAAK29B,QAAQ0jB,GAAIrhD,KAAK0iD,cAAcrB,GAAIv+C,EAAGqQ,GACvEnT,KAAKuiD,aAAeviD,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,OAGnD,CACJ,EAEArC,EAAImuC,WAAWx4B,UAAUuwC,uBAAyB,SAAUjkD,EAAKgzB,EAAOrvB,EAAKkO,GAEzE,IAAIqyC,EAAgBlkD,EAAI2D,GACpBwgD,EAA6BzlD,KAAKiB,MAAMhB,IAAI,aAI5CD,KAAKiB,MAAMhB,IAAIm4B,qBACXp4B,KAAKiB,MAAMhB,IAAI4f,kBAAoB7f,KAAKiB,MAAMhB,IAAI4f,iBAAiB9a,MAAMoO,GAIzEsyC,EAA6BzlD,KAAKiB,MAAMhB,IAAI4f,iBAAiB9a,MAAMoO,GAC5DmhB,EAAMrvB,IAAQjF,KAAKojD,WAC1BqC,EAA6BzlD,KAAKqjD,iBAGlCrjD,KAAKiB,MAAMhB,IAAI4f,kBACZ7f,KAAKiB,MAAMhB,IAAI4f,iBAAiB9a,MAAMoO,GAAOnT,KAAKqjD,eAGjDoC,EADAnxB,EAAMrvB,GAAOjF,KAAKojD,SACW9uB,EAAMrvB,GAENjF,KAAKiB,MAAMhB,IAAI4f,iBAAiB9a,MAAMoO,GAEhEmhB,EAAMrvB,IAAQjF,KAAKojD,WAE1BqC,EAA6BzlD,KAAKqjD,gBASlCrjD,KAAK0lD,eAAiBD,EAA8BzlD,KAAKojD,SAAW,IACpEqC,EAA6BzlD,KAAKojD,SAAW,IAGrD,IAAIuC,EAAO3lD,KAAKojD,UAAYpjD,KAAKqjD,eAC7BuC,EAAatxB,EAAMrvB,GAAOwgD,EAI1BA,EAA6BnxB,EAAMrvB,KAGnCwgD,EAA6BD,EAAc9jD,QAI3CikD,GAAQC,IACJ5lD,KAAK0lD,cACLpkD,EAAI2D,GAAOugD,EAAchiD,MAAM,EAAGiiD,GAA4B3/C,OAAO0/C,EAAchiD,OAAO,IAE1FlC,EAAI2D,GAAOugD,EAAchiD,MAAM,EAAGiiD,IAG1CzlD,KAAKiB,MAAMhB,IAAI6f,kBAAkB/a,MAAMoO,GAAO7R,EAAI2D,GAAKvD,OACvD1B,KAAKiB,MAAMqe,aAAaumC,QAAQ7lD,KAAKiB,MAAMhB,IAAI6f,kBAOnD,EAOAzgB,EAAImuC,WAAWx4B,UAAU+rC,cAAgB,WAErC,IADA,IAAI5tC,EACK3R,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAC5D,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,GAMvB,GALA2R,EAAMnT,KAAK4/C,aAAep+C,EACtBxB,KAAKyhD,SAASJ,GAAG3/C,QACjB1B,KAAK8lD,kBAAkB9lD,KAAKyhD,SAASJ,GAAIluC,GAGzCnT,KAAK49B,aAAayjB,GAAG3/C,OAAQ,MACzB,IAAuB1B,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,KAC/DnT,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAO,IAEnD,IAAK,IAAIrQ,EAAE,EAAE4B,EAAK1E,KAAK49B,aAAayjB,GAAG3/C,OAAOoB,EAAE4B,EAAK5B,GAAG,OAChD,IAAuB9C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAKrQ,IACpE9C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAKxO,KAAK,EAG9D,CACA,IAAS7B,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EACtD9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAGpB,QACnB1B,KAAK8lD,kBAAkB9lD,KAAK29B,QAAQ0jB,GAAGv+C,GAAIqQ,EAGvD,CACJ,EAEA9T,EAAImuC,WAAWx4B,UAAU8wC,kBAAoB,SAAUxkD,EAAK6R,GACxD,IAASolC,EAAQwN,EAAYpmC,EAAOne,EAAGC,EAAMukD,EAI7C,IAAKxkD,EAAI,EAAGC,EAAOH,EAAII,OAAQF,EAAIC,EAAMD,GAAK,EAK1C,GAAKF,EAAIE,GAAGoE,OAAUtE,EAAIE,GAAGmE,OAA7B,CAOA,GAHAogD,EAAa/lD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,mBAC9C1F,KAAKiB,MAAMwS,SAASwyC,QAAQC,QAAQ,GAAKlmD,KAAKiE,KAAKoqB,GAAI/sB,EAAIE,GAAIA,QAE3D,IADExB,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAI1C,IAAK,IAAIrQ,EAAI,EAAG4B,EAAOyO,EAAM,EAAGrQ,EAAI4B,EAAM5B,GAAK,EACtC9C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOvc,KACzC9C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOvc,GAAK,IAmBzD,QAVI,IALE9C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAK3R,KAM/C+2C,EAASv4C,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,OAAQ,YAAa,QAC/Dia,EAAQ3f,KAAKiB,MAAMwS,SAASwyC,QAAQE,SAAS,GAAKnmD,KAAKiE,KAAKoqB,GAAI/sB,EAAIE,GAAIA,EAAG,EAAG+2C,EAAQwN,GACtF/lD,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAKxO,KAAKgb,IAItD44B,EAASv4C,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,OAAQ,YAAa,QAC/DsgD,EAAShmD,KAAKiB,MAAMwS,SAASwyC,QAAQE,SAAS,GAAKnmD,KAAKiE,KAAKoqB,GAAI/sB,EAAIE,GAAIA,EAAG,EAAG+2C,EAAQwN,GAEnF/lD,KAAKiB,MAAMhB,IAAI4f,iBAAkB,CAKjC,IAAI3a,EAAMlF,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAK3R,GAG3C,IAAR0D,GAC6D,YAA7DlF,KAAKiB,MAAM+nB,SAAS9nB,IAAI,uCACvB,IAAuBlB,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,yBACrD,IAAuBpE,EAAIE,GAAGoE,QAClCV,EAAM,GAEVya,EAAQza,EAIJlF,KAAKiB,MAAMC,IAAI,+BAAiCI,EAAIE,GAAGoE,QACvD+Z,EAAQ3f,KAAKiB,MAAMwS,SAASwyC,QAAQE,SAAS,GAAKnmD,KAAKiE,KAAKoqB,GAAI/sB,EAAIE,GAAIA,EAAGme,EAAO3f,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,OAAQ,YAAa,QAAS1F,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,oBAE1L,MAMIia,EAAQqmC,GAIPhmD,KAAKiB,MAAMhB,IAAIq2B,cAAgBt2B,KAAKkD,MAAQlD,KAAKkD,KAAK6kC,WAAa1oC,EAAI0I,gBACpEi+C,EAASrmC,IACTA,EAAQqmC,GAGXhmD,KAAKiB,MAAMhB,IAAIy8C,gBAChB18C,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAK3R,GAAKme,EAC9C,iBAAoBomC,QAChB,IAAuB/lD,KAAK0F,KAAKoM,QAAoB,aAClD,IAAS9R,KAAK0F,KAAKoM,QAAoB,aAE9C9R,KAAKiB,MAAMhB,IAAI6f,kBAAkBsmC,cAAe,GAvExD,CA4ER,EAIA/mD,EAAImuC,WAAWx4B,UAAU4rC,cAAgB,WACrC,IAAI19C,EAAOlD,KAAKkD,KAChBlD,KAAK,SAAW,CAAC,EAEjBA,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAKo5C,UAAWp5C,KAAKqmD,YAAY,GAC1DrmD,KAAK,SAASq8C,OAASr8C,KAAKiB,MAAMqoB,OAAOte,MACzChL,KAAK,SAASq8C,OAAOvqC,QAAQrL,OAASzG,KAAKsmD,YAC3CtmD,KAAK,SAASq8C,OAAOvqC,QAAQ9L,OAAShG,KAAKumD,mBAE3CvmD,KAAKiB,MAAMqoB,OAAOiN,OAAOv2B,KAAKo5C,UAAWp5C,KAAKqmD,YAAY,GAC1DrmD,KAAK,SAASs8C,SAAWt8C,KAAKiB,MAAMqoB,OAAOte,MAC3ChL,KAAK,SAASs8C,SAASxqC,QAAQrL,OAASzG,KAAKsmD,YAC7CtmD,KAAK,SAASs8C,SAASxqC,QAAQ9L,OAAShG,KAAKwmD,0BAIzC,IAAuBtjD,IACvBA,EAAO,CAAC,GAIRA,EAAK6kC,UACD/nC,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,wBAEjC1F,KAAKojD,SAAWpjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,wBAGjD1F,KAAKojD,SAAWpjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,aAEjD1F,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,8BAEjC1F,KAAKqjD,eAAiBrjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,8BAGvD1F,KAAKqjD,eAAiBrjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,qBAGvD1F,KAAKiB,MAAMhB,IAAI,aACfD,KAAKojD,SAAWpjD,KAAKiB,MAAMhB,IAAI,aAG/BD,KAAKojD,SAAWpjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,aAEjD1F,KAAKiB,MAAMhB,IAAI,mBACfD,KAAKqjD,eAAiBrjD,KAAKiB,MAAMhB,IAAI,mBAGrCD,KAAKqjD,eAAiBrjD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,mBAEvD,kBAAqB1F,KAAKiB,MAAMhB,IAAI,kBAEpCD,KAAK0lD,cAAgB1lD,KAAKiB,MAAMhB,IAAI,kBAIpCD,KAAK0lD,cAAgB1lD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,mBAKzD1F,KAAKiB,MAAMhB,IAAI,eAChBD,KAAKiB,MAAMhB,IAAI,aAAeD,KAAKojD,SAE3C,EAIA/jD,EAAImuC,WAAWx4B,UAAUisC,kBAAoB,WACzC,IAAIz/C,EAAGC,EAAMqB,EAAG4B,EAChB,IAAKlD,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACxD,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,GAQvB,SAPI,IAAuBxB,KAAK6/C,UAAUwB,KACtCrhD,KAAK6/C,UAAUwB,GAAK,CAACI,SAAS,EAAE7jB,aAAa,EAAED,QAAQ,KAE3D39B,KAAK6/C,UAAU7/C,KAAK4/C,aAAep+C,GAAKxB,KAAK6/C,UAAUwB,GACnDrhD,KAAKyhD,SAASJ,GAAG3/C,QACjB1B,KAAKymD,kBAAkB,WAAYpF,GAElCv+C,EAAI,EAAG4B,EAAO1E,KAAK29B,QAAQ0jB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,OAClD,IAAuB9C,KAAK6/C,UAAUwB,GAAGv+C,KACzC9C,KAAK6/C,UAAUwB,GAAG1jB,QAAQ76B,GAAK,GAEnC9C,KAAKymD,kBAAkB,UAAWpF,EAAGv+C,GAErC9C,KAAK49B,aAAayjB,GAAG3/C,QACrB1B,KAAKymD,kBAAkB,eAAgBpF,EAE/C,CACJ,EAEAhiD,EAAImuC,WAAWx4B,UAAUyxC,kBAAoB,SAAUthD,EAAMk8C,EAAGv+C,GAC5D,IAAIxB,EAAKgzB,EACI,YAATnvB,GACA7D,EAAMtB,KAAK29B,QAAQ0jB,GAAGv+C,GACtBwxB,EAAQt0B,KAAK0iD,cAAcrB,GAAGv+C,KAE9BxB,EAAMtB,KAAKmF,GAAMk8C,GACjB/sB,EAAQt0B,KAAKmF,EAAO,UAAUk8C,IAE9B//C,EAAII,OAAS4yB,IAAUt0B,KAAKiB,MAAMhB,IAAIy8C,cAClC18C,KAAK0lD,cACQ,YAATvgD,EACAnF,KAAK6/C,UAAUwB,GAAG1jB,QAAQ76B,GAAK,EAE/B9C,KAAK6/C,UAAUwB,GAAGl8C,GAAQ,EAGjB,YAATA,EACAnF,KAAK6/C,UAAUwB,GAAG1jB,QAAQ76B,GAAK,EAE/B9C,KAAK6/C,UAAUwB,GAAGl8C,GAAQ,EAIrB,YAATA,EACAnF,KAAK6/C,UAAUwB,GAAG1jB,QAAQ76B,GAAK,EAE/B9C,KAAK6/C,UAAUwB,GAAGl8C,GAAQ,CAGtC,EAIA9F,EAAImuC,WAAWx4B,UAAUmsC,eAAiB,WAItC,IADA,IAAIhuC,EACK3R,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAC5D,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,IAEnBxB,KAAKyhD,SAASJ,GAAG3/C,QAAU1B,KAAK49B,aAAayjB,GAAG3/C,UAC3C1B,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIC,YAClCtR,KAAKiB,MAAMhB,IAAIyR,iBAAkB,IAIzCyB,EAAMnT,KAAK4/C,aAAep+C,EACtBxB,KAAKyhD,SAASJ,GAAG3/C,SACjB1B,KAAKyhD,SAASJ,GAAKrhD,KAAK0mD,aAAarF,EAAGrhD,KAAKyhD,SAASJ,GAAIluC,IAE9D,IAAK,IAAIrQ,EAAI,EAAG4B,EAAO1E,KAAK49B,aAAayjB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC/D9C,KAAK29B,QAAQ0jB,GAAGv+C,GAAK9C,KAAK0mD,aAAarF,EAAGrhD,KAAK29B,QAAQ0jB,GAAGv+C,GAAIqQ,EAAKrQ,EAE3E,CACA9C,KAAK2mD,wBACT,EAEAtnD,EAAImuC,WAAWx4B,UAAU2xC,uBAAyB,WAG9C,IAAK,IAAInlD,EAAI,EAAGC,EAAOzB,KAAKmjB,UAAUzhB,OAAQF,EAAIC,EAAMD,GAAK,EAEzD,IADA,IAAI6/C,EAAIrhD,KAAKmjB,UAAU3hB,GACdsB,EAAI,EAAG4B,EAAO1E,KAAK49B,aAAayjB,GAAG3/C,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CAClE,IAQa8jD,EANTlhD,EAAO1F,KAAK49B,aAAayjB,GAAGv+C,GAiB5B+jD,EAAO,CAACC,QAAQ,cAAcC,WAAU,EAAMC,UAAS,GAC9D,GAVOJ,EADA5mD,KAAKiB,MAAMhB,IAAIyhB,UACF,CAAC,QACPhc,EAAKu9C,eAAiBv9C,EAAKD,QAGrBzF,KAAKiB,MAAMC,IAAI,mBAAmB08B,aAElC59B,KAAKiB,MAAMC,IAAI,mBAAmBy8B,QAMrD,IADA,IAAIspB,EAAY,CAAC,UAAW,YAAa,YAChClvC,EAAI,EAAGC,EAAOivC,EAAUvlD,OAAQqW,EAAIC,KACxC4uC,EAAWllD,OAAS,EAAKqW,GADqBA,GAAK,EAI1C6uC,EAAW7uC,KACpB8uC,EAAKI,EAAUlvC,IAAM,UAAY6uC,EAAW7uC,SAIjD8uC,EAAKC,QAAU,kBAEY,iBAAxB9mD,KAAKiB,MAAMhB,IAAIoN,MACW,aAAxBrN,KAAKiB,MAAMhB,IAAIoN,MACW,SAA1BrN,KAAKiB,MAAMC,IAAIC,QACfnB,KAAKkD,OAASlD,KAAKkD,KAAK6kC,WAE7B8e,EAAKE,WAAY,EACjBF,EAAKG,UAAW,GAIdhnD,KAAKknD,gBAAgBxhD,GAGrB,IAAImP,EAAc7U,KAAKmnD,uBAAuB9F,EAAG37C,EAAMmhD,EAAM/jD,GAG7D9C,KAAK49B,aAAayjB,GAAGv+C,GAAK+R,CAC9B,CAER,EAEAxV,EAAImuC,WAAWx4B,UAAUmyC,uBAAyB,SAAU9F,EAAG37C,EAAMmhD,EAAM/jD,GACvE,IAAekkD,EAAUI,EAAYC,EAAaxyC,EAAayyC,EAC3DrzC,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKC,SAAS,GACvCA,EAAU7yC,EAAIvO,KACd6hD,EAAWtzC,EAAIszC,SAMtB,GALOT,IAEAA,EAAU9mD,KAAKwnD,iBAAiBV,EAASzF,EAAGv+C,IAEnDikD,GAAY,EACRF,EAAKE,UAAW,CAEb,IAAIA,GADJ9yC,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKE,WAAW,EAAOQ,IAC5B7hD,KACpB6hD,EAAWtzC,EAAIszC,SACXR,IACTA,EAAY/mD,KAAKwnD,iBAAiBT,EAAW1F,EAAGv+C,GAElD,CAEAkkD,GAAW,EACPH,EAAKG,WAEFA,GADA/yC,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKG,UAAU,EAAOO,IAChC7hD,QAEpBshD,EAAWhnD,KAAKwnD,iBAAiBR,EAAU3F,EAAGv+C,IAG7C,IAAI2vB,EAAI,CACJkV,EAAG,CACC8f,KAAK,EACLC,KAAK,EACLC,KAAK,GAETC,EAAG,CACCH,KAAK,EACLC,KAAK,EACLC,KAAK,IAeb,OAZIb,IACAr0B,EAAEkV,EAAE8f,IAAMX,EAAc,KACxBr0B,EAAEm1B,EAAEH,IAAMX,EAAe,MAAEplD,OAASolD,EAAe,MAAIA,EAAc,MAErEC,IACAt0B,EAAEkV,EAAE+f,IAAMX,EAAgB,KAC1Bt0B,EAAEm1B,EAAEF,IAAMX,EAAiB,MAAErlD,OAASqlD,EAAiB,MAAIA,EAAgB,MAE3EC,IACAv0B,EAAEkV,EAAEggB,IAAMX,EAAe,KACzBv0B,EAAEm1B,EAAED,IAAMX,EAAgB,MAAEtlD,OAASslD,EAAgB,MAAIA,EAAe,MAEpEhnD,KAAK6U,YAAY/C,QAAQ,sBACjC,IAAK,QAEGg1C,EAAe,MAAEplD,QACjB2lD,EAAcrnD,KAAK6nD,iBACnBhzC,EAAc,CAAC7U,KAAK8nD,2BAA2B,CAACr1B,EAAEm1B,EAAEH,IAAKh1B,EAAEm1B,EAAEF,IAAKj1B,EAAEm1B,EAAED,KAAMd,EAAMQ,EAAahG,MAG/F+F,EAAapnD,KAAK+nD,cAAcjB,EAASzF,EAAGv+C,GAC5C+R,EAAc,CAAC7U,KAAK8nD,2BAA2B,CAACr1B,EAAEkV,EAAE8f,IAAKh1B,EAAEkV,EAAE+f,IAAKj1B,EAAEkV,EAAEggB,KAAMd,EAAMO,EAAY/F,KAElG,MACJ,IAAK,aACD+F,EAAapnD,KAAK+nD,cAAcjB,EAASzF,EAAGv+C,GAC5CukD,EAAcrnD,KAAK6nD,iBAInBhzC,EAAc,CAHdyyC,EAAoBtnD,KAAKgoD,0BAA0BlB,EAAe,MAAGO,GAElDrnD,KAAK8nD,2BAA2B,CAACr1B,EAAEkV,EAAE8f,IAAKh1B,EAAEkV,EAAE+f,IAAKj1B,EAAEkV,EAAEggB,KAAMd,EAAMO,EAAY/F,IAElG,MACJ,IAAK,aACD+F,EAAapnD,KAAK+nD,cAAcjB,EAASzF,EAAGv+C,GAC5CukD,EAAcrnD,KAAK6nD,iBACnBP,EAAoBtnD,KAAKgoD,0BAA0BlB,EAAe,MAAGO,GAGrExyC,EAAc,CADK7U,KAAK8nD,2BAA2B,CAACr1B,EAAEkV,EAAE8f,IAAKh1B,EAAEkV,EAAE+f,IAAKj1B,EAAEkV,EAAEggB,KAAMd,EAAMO,EAAY/F,GACjEiG,GACjC,MACJ,QACIF,EAAapnD,KAAK+nD,cAAcjB,EAASzF,EAAGv+C,GAE5C+R,EAAc,CAAC7U,KAAK8nD,2BAA2B,CAACr1B,EAAEkV,EAAE8f,IAAKh1B,EAAEkV,EAAE+f,IAAKj1B,EAAEkV,EAAEggB,KAAMd,EAAMO,EAAY/F,IAGlG,IAAIjvB,EAAOpyB,KAAK4hD,MAAM/sC,EAAa,KAKnC,OAJIud,IACAA,EAAK6wB,eAAgB,GAEzBjjD,KAAKiB,MAAMhB,IAAIstC,UAAUx4B,SAASpQ,KAAKytB,GAChCA,CACX,EAEA/yB,EAAImuC,WAAWx4B,UAAU8yC,2BAA6B,SAAU/iD,EAAO8hD,EAAM3/B,GACzE,IAA0D+gC,EAAaC,EAAeC,EA0BlFC,EA1BAtB,GAAU,EAAOC,GAAY,EAAOC,GAAW,EACnD,GAAIjiD,EAAM,GAAI,CAEV,GADAkjD,EAAc5oD,EAAIgsB,KAAK4rB,WAAW/vB,GAC9BlnB,KAAKiB,MAAMC,IAAImzB,YAAYwyB,EAAKC,UAC5B,QAAU9mD,KAAKiB,MAAMC,IAAImzB,YAAYuJ,aAAaipB,EAAKC,SAAS9gD,OAAQ,CAExE,IADA,IAAIqiD,GAAY,EACP7mD,EAAI,EAAGC,EAAOwmD,EAAYt2C,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAClC,gBAA5B0lB,EAAMvV,YAAYnQ,GAAG,IACgB,WAAlCymD,EAAYt2C,YAAYnQ,GAAG,KAC9B6mD,GAAY,GAGfA,GACDJ,EAAYt2C,YAAYhN,KAAK,CAAC,cAAe,UAErD,CAEJmiD,EAAU9mD,KAAKgoD,0BAA0BjjD,EAAM,GAAIkjD,EACtD,CASD,GARIljD,EAAM,KACNgiD,EAAY/mD,KAAKgoD,0BAA0BjjD,EAAM,GAAImiB,IAErDniB,EAAM,KACNiiD,EAAWhnD,KAAKgoD,0BAA0BjjD,EAAM,GAAImiB,IAIpD6/B,GAAaC,EAAU,CACvBhnD,KAAKiB,MAAMqoB,OAAO0M,UAAU,SAE5Bh2B,KAAKiB,MAAMqoB,OAAOiN,OAAOuwB,GAEzBoB,EAAgB7oD,EAAIgsB,KAAK4rB,WAAW/vB,GAChC2/B,EAAKE,YACLmB,EAAcp2C,QAAQ9L,OAAShG,KAAKiB,MAAMC,IAAImzB,YAAYuJ,aAAaipB,EAAKE,WAAW/gD,OACvFkiD,EAAcp2C,QAAQrL,OAASzG,KAAKiB,MAAMC,IAAImzB,YAAYuJ,aAAaipB,EAAKE,WAAWtgD,OAElFyhD,EAAcp2C,QAAQ9L,SACvBkiD,EAAcp2C,QAAQ9L,OAAS,MAGvC,IAAIsiD,EAAkB,IAAIjpD,EAAI8hB,MAC9BmnC,EAAgB32C,YAAYhN,KAAK,CAAC,cAAe,WACjD2jD,EAAgB32C,YAAYhN,KAAK,CAAC,eAAgB,WAClD3E,KAAKiB,MAAMqoB,OAAO0M,UAAUsyB,GAC5BtoD,KAAKiB,MAAMqoB,OAAOiN,OAAOwwB,EAAWmB,GACpCloD,KAAKiB,MAAMqoB,OAAO4M,aAElBiyB,EAAe9oD,EAAIgsB,KAAK4rB,WAAW/vB,GAC/B2/B,EAAKG,WACLmB,EAAar2C,QAAQ9L,OAAShG,KAAKiB,MAAMC,IAAImzB,YAAYuJ,aAAaipB,EAAKG,UAAUhhD,OACrFmiD,EAAar2C,QAAQrL,OAASzG,KAAKiB,MAAMC,IAAImzB,YAAYuJ,aAAaipB,EAAKG,UAAUvgD,OAEhF0hD,EAAar2C,QAAQ9L,SACtBmiD,EAAar2C,QAAQ9L,OAAS,MAGtC,IAAIuiD,EAAiB,IAAIlpD,EAAI8hB,MAC7BonC,EAAe52C,YAAYhN,KAAK,CAAC,cAAe,WAChD4jD,EAAe52C,YAAYhN,KAAK,CAAC,eAAgB,WACjD3E,KAAKiB,MAAMqoB,OAAO0M,UAAUuyB,GAC5BvoD,KAAKiB,MAAMqoB,OAAOiN,OAAOywB,EAAUmB,GACnCnoD,KAAKiB,MAAMqoB,OAAO4M,aAElBl2B,KAAKiB,MAAMqoB,OAAO4M,aAElBkyB,EAAkBpoD,KAAKiB,MAAMqoB,OAAOte,KACxC,MACIo9C,EAAkBtB,EAEtB,OAAOsB,CACX,EAEA/oD,EAAImuC,WAAWx4B,UAAUgzC,0BAA4B,SAAU5yB,EAAOlO,GAClE,IAAK,IAAI1lB,EAAI,EAAGC,EAAO2zB,EAAM1zB,OAAQF,EAAIC,EAAMD,GAAK,EAChD,GAAI4zB,EAAM5zB,GAAI,CACV,IAAIhC,EAAM41B,EAAM5zB,GAIhB,GAAIxB,KAAKiB,MAAMhB,IAAIk3B,cACf33B,EAAMA,EAAIsE,QAAQ,MAAO,SAEzB,IAAK,IAAIhB,EAAI,EAAG4B,EAAOwiB,EAAMvV,YAAYjQ,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC5D,GAAI,mBAAqBokB,EAAMvV,YAAY7O,GAAG,IAAM,SAAWokB,EAAMvV,YAAY7O,GAAG,GAAI,CACpFtD,EAAMA,EAAIsE,QAAQ,MAAO,IACzB,KACJ,CAIR9D,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EACpD7/B,KAAKiB,MAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,SACrC,aAARhI,EACA41B,EAAM5zB,IAAK,GAEXxB,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAK0nB,GAAO,GACrCkO,EAAM5zB,GAAKxB,KAAKiB,MAAMqoB,OAAOte,MAErC,CAKJ,YAHI,IAAuBhL,KAAK6U,YAAY/C,QAAQ,oBAChD9R,KAAK6U,YAAY/C,QAAQ,kBAAoB9R,KAAKiB,MAAMhB,IAAI+7C,gBAEzDh8C,KAAK4hD,MAAMxsB,EAAOp1B,KAAK6U,YAAY/C,QAAQ,kBACtD,EAEAzS,EAAImuC,WAAWx4B,UAAU0xC,aAAe,SAAUrF,EAAGrwB,EAAQ7d,EAAKrQ,GAE9D,IAAI2H,GAAM,EACV,GAAIumB,EAAOtvB,OAAQ,CAEf,IADA,IAAIqD,EAAQ,GACHvD,EAAI,EAAGC,EAAOuvB,EAAOtvB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACpD,IAISolD,EAJLlhD,EAAOsrB,EAAOxvB,GAedqlD,EAAO,CAACC,QAAQ,cAAcC,WAAU,EAAMC,UAAS,GAC9D,GATOJ,EADA5mD,KAAKiB,MAAMhB,IAAIyhB,UACF,CAAC,QACPhc,EAAKu9C,eAAiBv9C,EAAKD,QAGrBzF,KAAKiB,MAAMC,IAAI,mBAAmB08B,aAElC59B,KAAKiB,MAAMC,IAAI,mBAAmBy8B,QAKrD,IADA,IAAIspB,EAAY,CAAC,UAAW,YAAa,YAChClvC,EAAI,EAAGC,EAAOivC,EAAUvlD,OAAQqW,EAAIC,KACxC4uC,EAAWllD,OAAS,EAAKqW,GADqBA,GAAK,EAIvD8uC,EAAKI,EAAUlvC,IAAM,UAAY6uC,EAAW7uC,QAG7C8uC,EAAKC,QAAU,kBAeb,IAbC9mD,KAAKiB,MAAMhB,IAAIy8C,eAA0C,iBAAxB18C,KAAKiB,MAAMhB,IAAIoN,OACtB,aAAxBrN,KAAKiB,MAAMhB,IAAIoN,MACW,SAA1BrN,KAAKiB,MAAMC,IAAIC,SACfnB,KAAKkD,MAASlD,KAAKkD,KAAK6kC,aAE7B8e,EAAKE,WAAY,EACjBF,EAAKG,UAAW,GAKdhnD,KAAKknD,gBAAgBxhD,GAEhBA,EAAKD,SAAYC,EAAKu9C,cAMvBl+C,EAAMJ,KAAK3E,KAAKmnD,uBAAuB9F,EAAG37C,EAAMmhD,EAAM/jD,QANhB,CACtC,IAAI0lD,EAAWxoD,KAAKyoD,oBAAoBpH,EAAG37C,EAAMmhD,EAAM1zC,EAAK3R,EAAGsB,GAC3D4lD,EAAYrpD,EAAIgsB,KAAK4rB,WAAWj3C,KAAK0F,MACzC1F,KAAKiB,MAAMqoB,OAAOiN,OAAOiyB,EAAUE,GAAW,GAC9C3jD,EAAMJ,KAAK3E,KAAKiB,MAAMqoB,OAAOte,MACjC,CAGJ,CAEAP,EAAMzK,KAAKkkD,YAAYn/C,EAAOoO,EAAKrQ,EACvC,CACA,OAAO2H,CACX,EAGApL,EAAImuC,WAAWx4B,UAAUyzC,oBAAsB,SAAUpH,EAAG37C,EAAMmhD,EAAM1zC,EAAK3R,EAAGsB,GAG5E,IAAImR,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKC,SAAS,GACvCA,EAAU9mD,KAAK2oD,uBAAuB10C,EAAIvO,KAAMyN,EAAK3R,EAAGsB,GAC3DikD,GAAY,EACZF,EAAKE,YACF9yC,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKE,WAAW,EAAO9yC,EAAIszC,WAC5C7hD,OACbqhD,EAAY/mD,KAAK2oD,uBAAuB10C,EAAIvO,KAAMyN,EAAK3R,EAAGsB,IAG5D,IAQO8lD,EARH5B,GAAW,EASZ,GARCH,EAAKG,WACF/yC,EAAMjU,KAAK+yB,QAAQrtB,EAAMmhD,EAAKG,UAAU,EAAO/yC,EAAIszC,WAC3C7hD,OACbshD,EAAWhnD,KAAK2oD,uBAAuB10C,EAAIvO,KAAMyN,EAAK3R,EAAGsB,IAKpDikD,GAAaC,EAAU,CAEvBhnD,KAAKiB,MAAMqoB,OAAO0M,UAAU,SAE5Bh2B,KAAKiB,MAAMqoB,OAAOiN,OAAOuwB,GAEzB,IAAIoB,EAAgB,IAAI7oD,EAAI8hB,MACxB0lC,EAAKE,YACLmB,EAAcp2C,QAAQ9L,OAAShG,KAAKiB,MAAMC,IAAImzB,YAAYsJ,QAAQkpB,EAAKE,WAAW/gD,OAClFkiD,EAAcp2C,QAAQrL,OAASzG,KAAKiB,MAAMC,IAAImzB,YAAYsJ,QAAQkpB,EAAKE,WAAWtgD,OAE7EyhD,EAAcp2C,QAAQ9L,SACvBkiD,EAAcp2C,QAAQ9L,OAAS,MAGvChG,KAAKiB,MAAMqoB,OAAOiN,OAAOwwB,EAAWmB,GAEpC,IAAIC,EAAe,IAAI9oD,EAAI8hB,MACvB0lC,EAAKG,WACLmB,EAAar2C,QAAQ9L,OAAShG,KAAKiB,MAAMC,IAAImzB,YAAYsJ,QAAQkpB,EAAKG,UAAUhhD,OAChFmiD,EAAar2C,QAAQrL,OAASzG,KAAKiB,MAAMC,IAAImzB,YAAYsJ,QAAQkpB,EAAKG,UAAUvgD,OAE3E0hD,EAAar2C,QAAQ9L,SACtBmiD,EAAar2C,QAAQ9L,OAAS,MAGtChG,KAAKiB,MAAMqoB,OAAOiN,OAAOywB,EAAUmB,GAEnCnoD,KAAKiB,MAAMqoB,OAAO4M,aAElB0yB,EAAa5oD,KAAKiB,MAAMqoB,OAAOte,KACnC,MACI49C,EAAa9B,EAEjB,OAAO8B,CACX,EAEAvpD,EAAImuC,WAAWx4B,UAAU6zC,cAAgB,SAAUnjD,GAI/C,IAOIojD,EAPAr+C,EAAM,EAmBV,OAlBK/E,EAAKC,OAAO7B,QAAQ,MAAO,IAAIJ,MAAMrE,EAAIsK,qBAC1Cc,EAAM,IAELA,GAAO/E,EAAKE,OAASF,EAAKE,MAAMlC,MAAMrE,EAAIqH,gCAC3C+D,EAAM,GAGC,GAAPA,IACI/E,EAAK+F,OAAS/F,EAAK+F,MAAMI,KACzBi9C,EAAapjD,EAAK+F,MAAMI,KAAKrI,MAAM,EAAG,GAC/BxD,KAAKiE,KAAK6qB,WACjBg6B,EAAa9oD,KAAKiE,KAAK6qB,SAAStrB,MAAM,EAAG,IAEzC,CAAC,KAAM,MAAMT,QAAQ+lD,IAAe,IACpCr+C,EAAM,IAIPA,CACX,EAEApL,EAAImuC,WAAWx4B,UAAU2zC,uBAAyB,SAAU13C,EAAOkC,EAAK3R,EAAGsB,GACvE,IAAI4C,EAAOuL,EACP83C,EAAoB/oD,KAAKgpD,kBAAkBtjD,EAAMyN,EAAKrQ,GACtD6C,EAAS3F,KAAKipD,YAAYvjD,GAC1BwjD,EAAwBlpD,KAAKmpD,qBAAqBzjD,GAClD0jD,EAAYppD,KAAKqpD,WAAW3jD,EAAMyN,EAAK3R,GACvCoE,EAAQwjD,EAAUh3B,KAClB3rB,EAASzG,KAAKspD,YAAY5jD,IAChB,IAAVE,IACAmjD,GAAoB,EACpBtiD,GAAS,GAEb,IAII8iD,EAJA7+B,EAAW1qB,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,kBAC3CglB,IACDA,EAAW,IAIX6+B,EADA7jD,EAAK,gBACQ,KAEA,IAEjB,IAAI8jD,EAAaxpD,KAAK6oD,cAAcnjD,GAepC,IAEI+jD,EAOAr3B,EAAMs3B,EAAQpuB,EAAOE,EATrBmuB,EAdJ,SAASC,EAAsBx3B,GAC3B,QAAKA,IAEM,iBAAoBA,EAAKgD,MAC5B,CAAC,IAAU,IAAM,IAAK,KAAKryB,QAAQqvB,EAAKgD,MAAM5xB,OAAO,KAAO,EAMzDomD,EAAsBx3B,EAAKgD,MAAMhD,EAAKgD,MAAM1zB,OAAO,IAElE,CAE2CkoD,CAAsBV,GAUjE,GANIO,EADA,CAAC,KAAM,KAAM,MAAM1mD,QAAQ/C,KAAKiB,MAAMC,IAAI,kBAAkB,GAAGsC,MAAM,EAAG,KAAO,EACrE,IAEA,IAIK,IAAfgmD,EAEAp3B,EAAOpyB,KAAK4hD,MAAM,CAACsH,EAAuBvjD,EAAQC,GAAQ,SACvD,GAAmB,IAAf4jD,GAAoB9jD,EAAK,mBAChCgkD,EAAS1pD,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS8jD,GACrDr3B,EAAOpyB,KAAK4hD,MAAM,CAAC8H,EAAQ9jD,GAAQ,UAChC,GAAIF,EAAK,oBACZgkD,EAAS1pD,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS8jD,GACrDr3B,EAAOpyB,KAAK4hD,MAAM,CAACh8C,EAAO8jD,GAAS,UAChC,GAAI1pD,KAAKiB,MAAMhB,IAAIy8C,cAEiC,UAAnD18C,KAAKiB,MAAMC,IAAI,iCACfwoD,EAAS1pD,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS8jD,GACrDC,EAAS1pD,KAAK4hD,MAAM,CAAC8H,EAAQX,GAAoB,KACjDW,EAAS1pD,KAAK4hD,MAAM,CAAC8H,EAAQ9jD,GAAQ5F,KAAKiB,MAAMC,IAAIwpB,UACpD0H,EAAOpyB,KAAK4hD,MAAM,CAAC8H,EAAQjjD,GAAS,OAEpC+0B,EAASx7B,KAAK4hD,MAAM,CAACh8C,EAAOmjD,EAAmBG,GAAwB,KACvEQ,EAAS1pD,KAAK4hD,MAAM,CAACj8C,EAAQ61B,GAASx7B,KAAKiB,MAAMC,IAAIwpB,UACrD0H,EAAOpyB,KAAK4hD,MAAM,CAAC8H,EAAQjjD,GAAS,WAErC,GAA+D,QAA3DzG,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,uBAA+F,UAA3D1F,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,uBAA2C,IAANlE,IAAkB,IAANsB,QAAW,IAAuBA,GAI5L,CAAC,OAAQ,QAAQC,QAAQ2C,EAAKE,QAAU,IACxC8kB,EAAW,MAOX,CAAC,SAAU,oBAAoB3nB,QAAQ/C,KAAKiB,MAAMC,IAAI,kCAAoC,GAG1Fs6B,EAASx7B,KAAK4hD,MAAM,CAACh8C,EAAOmjD,GAAqBrjD,EAAK,2BAA6B,MAGnF81B,EAASx7B,KAAK4hD,MAAM,CAACpmB,EAAQ0tB,GAAwB,OACvClpD,KAAK4F,QACf41B,EAAO1pB,QAAQ9L,OAAShG,KAAK4F,MAAMkM,QAAQ9L,OAC3Cw1B,EAAO1pB,QAAQrL,OAASzG,KAAK4F,MAAMkM,QAAQrL,QAE3Cd,GAAU3F,KAAK2F,SACfA,EAAOmM,QAAQ9L,OAAShG,KAAK2F,OAAOmM,QAAQ9L,OAC5CL,EAAOmM,QAAQrL,OAASzG,KAAK2F,OAAOmM,QAAQrL,QAEhDijD,EAAS1pD,KAAK4hD,MAAM,CAACj8C,EAAQ61B,GAAS9Q,GACtC0H,EAAOpyB,KAAK4hD,MAAM,CAAC8H,EAAQjjD,GAASikB,MAUhC4Q,EADAquB,EACQ3pD,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS,IAE5C3F,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS8jD,KAE3CzpD,KAAK2F,SACd21B,EAAMxpB,QAAQ9L,OAAShG,KAAK2F,OAAOmM,QAAQ9L,OAC3Cs1B,EAAMxpB,QAAQrL,OAASzG,KAAK2F,OAAOmM,QAAQrL,SAG/C+0B,EAASx7B,KAAK4hD,MAAM,CAACh8C,EAAOmjD,GAAqBrjD,EAAK,2BAA6B,OAErE1F,KAAK4F,QACf41B,EAAO1pB,QAAQ9L,OAAShG,KAAK4F,MAAMkM,QAAQ9L,OAC3Cw1B,EAAO1pB,QAAQrL,OAASzG,KAAK4F,MAAMkM,QAAQrL,QAG/CijD,EAAS1pD,KAAK4hD,MAAM,CAACtmB,EAAOE,GAAS9Q,GACrC0H,EAAOpyB,KAAK4hD,MAAM,CAAC8H,EAAQjjD,GAASikB,IAExC0H,EAAKsyB,YAAa,MACf,CACH,GAAIh/C,EAAK,sBAAwBA,EAAKC,SAAWD,EAAK,yBAA0B,CAC5E,IAAI4xC,EAAK5xC,EAAK,qBACI,CAAC,IAAI,IAAS,IAAS,KACzB3C,QAAQu0C,EAAG9zC,OAAO,KAAO,GAAyB,OAApB8zC,EAAG9zC,MAAM,GAAI,KACvDmC,EAAS3F,KAAK4hD,MAAM,CAACmH,EAAmBpjD,GAAS,IACjDojD,GAAoB,EAE5B,CAqBA,IAAIl4B,EAnBA84B,GACAnuB,EAASx7B,KAAK4hD,MAAM,CAACsH,EAAuBvjD,GAAS,IACrD61B,EAASx7B,KAAK4hD,MAAM,CAACmH,EAAmBvtB,GAASiuB,IAEjDjuB,EAASx7B,KAAK4hD,MAAM,CAACmH,EAAmBG,EAAuBvjD,GAAS8jD,IAE5EjuB,EAASx7B,KAAK4hD,MAAM,CAACpmB,EAAQ/0B,GAAS8iD,KACxBvpD,KAAK2F,SACf61B,EAAO1pB,QAAQ9L,OAAShG,KAAK2F,OAAOmM,QAAQ9L,OAC5Cw1B,EAAO1pB,QAAQrL,OAASzG,KAAK2F,OAAOmM,QAAQrL,QAE5Cb,GAAS5F,KAAK4F,QACdA,EAAMkM,QAAQ9L,OAAShG,KAAK4F,MAAMkM,QAAQ9L,OAC1CJ,EAAMkM,QAAQrL,OAASzG,KAAK4F,MAAMkM,QAAQrL,QAE1C+0B,EAAO1pB,QAAQ9L,SACfN,EAAK,2BAA6B,IAQlCmrB,EAJA7wB,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,oBAC9B1F,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,mBAAmBhC,MAAM,mBACxB,IAAlC0lD,EAAUS,oBAELJ,EAEA,IAEZr3B,EAAOpyB,KAAK4hD,MAAM,CAACh8C,EAAO41B,GAAU91B,EAAK,2BAA6BmrB,EAC1E,CASA,OAPA7wB,KAAKiB,MAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EACpD7/B,KAAKiB,MAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,SACjDxH,KAAKiB,MAAMhB,IAAIsG,kBAAmB,EAIlCvG,KAAKiB,MAAMhB,IAAIstC,UAAUx4B,SAASpQ,KAAKytB,GAChCA,CACX,EAUA/yB,EAAImuC,WAAWx4B,UAAU80C,oBAAsB,SAAU74C,GACrD,IAAIvL,EAAO,CACPD,QAAQwL,EAAMxL,QACdE,OAAOsL,EAAMtL,OACbs9C,cAAchyC,EAAMgyC,cACpBr9C,MAAMqL,EAAMrL,MACZa,OAAOwK,EAAMxK,OACb,eAAewK,EAAM,gBACrB,wBAAwBA,EAAM,yBAC9B,oBAAoBA,EAAM,qBAC1B,kBAAkBA,EAAM,mBACxB,mBAAmBA,EAAM,oBACzB,mBAAmBA,EAAM,oBACzB,mBAAoBA,EAAM,oBAC1B,cAAcA,EAAM,eACpB,0BAA2B,GAC3B84C,iBAAiB94C,EAAM84C,iBACvBt+C,MAAMwF,EAAMxF,OAGhB,OADAzL,KAAKgqD,WAAWtkD,GACTA,CACX,EAIArG,EAAImuC,WAAWx4B,UAAUi1C,cAAgB,SAAUzzB,EAASh3B,GACxD,IAAI0qD,EAAYlqD,KAAKw2B,EAAU,UAC/B,GAAIh3B,EACA,GAAIQ,KAAKiB,MAAMhB,IAAIk3B,cACf33B,EAAMA,EAAIsE,QAAQ,MAAO,SACrB,GAAIomD,EACR,IAAK,IAAI1oD,EAAI,EAAGC,EAAOyoD,EAAUv4C,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAChE,GAAI,mBAAqB0oD,EAAUv4C,YAAYnQ,GAAG,IAAM,SAAW0oD,EAAUv4C,YAAYnQ,GAAG,GAAI,CAC5FhC,EAAMA,EAAIsE,QAAQ,MAAO,IACzB,KACJ,CAIZ,OAAOtE,CACX,EAEAH,EAAImuC,WAAWx4B,UAAUm0C,qBAAuB,SAAUzjD,GACtD,IAAIykD,EAAMzkD,EAAK,yBACXykD,GAAOnqD,KAAKiB,MAAMhB,IAAIy8C,gBACtByN,EAAMA,EAAIrmD,QAAQ,aAAc,KAEpC,IAAItE,EAAMQ,KAAKiqD,cAAc,SAAUE,GACvC,QAAInqD,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAKQ,KAAK0gD,cAAc,IAC1C1gD,KAAKiB,MAAMqoB,OAAOte,KAGjC,EAEA3L,EAAImuC,WAAWx4B,UAAUg0C,kBAAoB,SAAUtjD,EAAMyN,EAAKrQ,GAC9D,IAAIw0C,EAAK5xC,EAAK,qBACV4xC,GAAMt3C,KAAKiB,MAAMhB,IAAIy8C,gBACrBpF,EAAKA,EAAGxzC,QAAQ,aAAc,KAElC,IAAItE,EAAMQ,KAAKiqD,cAAc,QAAS3S,GACtC,GAAI5xC,EAAK,sBAAwBA,EAAK,qBAAqBhC,MAAM,kBACzD1D,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,uBAC7B,IAAuB5C,EACvB9C,KAAK6/C,UAAU1sC,GAAKsuC,SAAW,EAE/BzhD,KAAK6/C,UAAU1sC,GAAKwqB,QAAU,OAG9B,IAAuB76B,EACvB9C,KAAK6/C,UAAU1sC,GAAKsuC,SAAW,EAE/BzhD,KAAK6/C,UAAU1sC,GAAKwqB,QAAU,EAGtCj4B,EAAK,2BAA6B,QAC/B,GAAI1F,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAKQ,KAAK2gD,aAAa,GACvD,OAAO3gD,KAAKiB,MAAMqoB,OAAOte,MAE7B,OAAO,CACX,EAEA3L,EAAImuC,WAAWx4B,UAAUi0C,YAAc,SAAUvjD,GAC7C,IAAIlG,EAAMQ,KAAKiqD,cAAc,SAAUvkD,EAAKC,QAC5C,QAAI3F,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAKQ,KAAK0gD,cAAc,IAC1C1gD,KAAKiB,MAAMqoB,OAAOte,KAGjC,EAEA3L,EAAImuC,WAAWx4B,UAAUq0C,WAAa,SAAU3jD,EAAMyN,EAAK3R,GACvD,IAYI4oD,EACAC,EAJAC,EAAgF,SAAlEtqD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,OAAQ,YAAa,QACpE6kD,GAA0E,IAAnDvqD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,cACxD8kD,EAAoB,iBAAoBxqD,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,qBAAuBA,EAAKqkD,iBAGzG,GAAIrkD,EAAK,oBACL2kD,EAAW,MACR,CAECD,EADAE,EACe,EACRE,EACQ,EAEA,EAEnB,IAAIC,EAAiBzqD,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAOlM,GAAK3R,GAE9D6oD,EADAI,EAAiBL,EACNK,EAEAL,CAEnB,CACA,IAAIM,EAAS1qD,KAAKiB,MAAM+nB,SAAS9nB,IAAI,iCAIrC,GAHGwpD,GAAgC,mBAAtBA,EAAOlnD,OAAO,MACvBgnD,GAAoB,GAEpB9kD,EAAKC,QAAuB,IAAb0kD,EACf,GAAIG,EAAmB,CACnB,IAAI7pB,EAAkB3gC,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,mBAAmB,EAAO,IACjFA,EAAKE,MAAQvG,EAAIgsB,KAAK82B,MAAMwI,eAAe3qD,KAAKiB,MAAOyE,EAAKE,MAAO+6B,GAAkB4pB,EACzF,MACI7kD,EAAKE,MAAQvG,EAAIgsB,KAAK82B,MAAMyI,aAAa5qD,KAAKiB,MAAOyE,EAAKE,WAE3D,IAAiB,IAAbykD,EACP,MAAO,CACHj4B,MAAM,GAEU,IAAbi4B,IACP3kD,EAAKE,MAAQvG,EAAIgsB,KAAK82B,MAAMyI,aAAa5qD,KAAKiB,MAAOyE,EAAKE,OAC9D,CAEA,IAAIpG,EAAMQ,KAAKiqD,cAAc,QAASvkD,EAAKE,OAE3C,OADe5F,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAKQ,KAAK2gD,aAAa,GAGvD,CACAvuB,KAFEpyB,KAAKiB,MAAMqoB,OAAOte,MAGpB6+C,oBAAqBQ,GAGtB,CACHj4B,MAAM,EAEd,EAEA/yB,EAAImuC,WAAWx4B,UAAUs0C,YAAc,SAAU5jD,GAE7C,IAAuB+E,EAAnBjL,EAAMkG,EAAKe,OAEXjH,GAAO,iBAAoBQ,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,qBAC5DlG,EAAMH,EAAIgsB,KAAK82B,MAAMwI,eAAe3qD,KAAKiB,MAAOzB,EAAKQ,KAAKiB,MAAMmvB,WAAWpwB,KAAK0F,KAAM,oBAAoB,IAI9G,IAAImlD,EAAW,GAMf,OAPArrD,EAAMQ,KAAKiqD,cAAc,SAAUzqD,KAEN,MAAlBA,EAAIgE,OAAO,KACzBhE,EAAMA,EAAIgE,MAAM,GAAI,GACpBqnD,EAAW,OAEO7qD,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAK,SAAS,MAElDiL,EAAMzK,KAAKiB,MAAMqoB,OAAOte,OAC3B8G,QAAQrL,OAASokD,EAAWpgD,EAAIqH,QAAQrL,OACrCgE,EAGR,EAEApL,EAAImuC,WAAWx4B,UAAU+yC,cAAgB,SAAUriD,GAC/C,IAAI0hD,EAaJ,OAVQA,EAFJ1hD,EAAY,MAAEhE,QACV1B,KAAK+b,gBAAgB,mBACR/b,KAAK+b,gBAAgB,mBAKzB/b,KAAK+b,gBAAsB,QAGxCqrC,EAAa,IAAI/nD,EAAI8hB,OAElBimC,CACX,EAEA/nD,EAAImuC,WAAWx4B,UAAU6yC,eAAiB,WAOtC,OALI7nD,KAAK+b,gBAAuB,MACd/b,KAAK+b,gBAAuB,MAE5B,IAAI1c,EAAI8hB,KAG9B,EAEA9hB,EAAImuC,WAAWx4B,UAAUg1C,WAAa,SAAUtkD,GAC5C,IAAKA,EAAK,qBAAkB,IAAuBA,EAAK,eACpD,OAAOA,EAOX,IAAIolD,EALAplD,EAAKC,SAAWD,EAAKE,OAASF,EAAKu9C,gBACnCv9C,EAAKD,QAAUC,EAAKC,OACpBD,EAAKC,YAAS0wB,EACd3wB,EAAKu9C,mBAAgB5sB,GAGrB3wB,EAAKC,QAC2B,MAA5BD,EAAKC,OAAOnC,MAAM,EAAG,IAAwC,MAA1BkC,EAAKC,OAAOnC,OAAO,KACrDkC,EAAK,qBAAkB,IAAuBA,EAAK,gBAExDA,EAAKC,OAASD,EAAKC,OAAOnC,MAAM,GAAI,GACpCsnD,GAAU,EACVplD,EAAK,eAAiB,GAEtBolD,GAAU,EAEV9qD,KAAKiB,MAAMC,IAAIiC,uBAAuB07B,cACjCn5B,EAAK,0BAA4BA,EAAKC,SAAWmlD,GAAWplD,EAAKE,QAC7DF,EAAK,qBACNrG,EAAIwG,eAAeH,GAAM,GAIzC,EAQArG,EAAImuC,WAAWx4B,UAAU+d,QAAU,SAAUrtB,EAAMqlD,EAAe52C,EAAU62C,GAIxE,GAAIA,GAA8B,gBAAlBD,EACZ,MAAO,CAACrlD,MAAK,EAAM6hD,SAASyD,GAI3BtlD,EAAKC,SACND,EAAKC,OAAS,IAEbD,EAAKE,QACNF,EAAKE,MAAQ,IAUjB,IAAIqlD,EAAc,CAAC,EAInBA,EAAY,mBAAqBjrD,KAAKkrD,eAAexlD,GAErD,IACIylD,EADAC,GAAW,EAEf,GAAsB,gBAAlBL,IACAK,GAAW,EACP1lD,EAAK+F,OAEL,IADA,IAAI4/C,EAAWrrD,KAAKiB,MAAMC,IAAI6pD,GACrBvpD,EAAI,EAAGC,EAAO4pD,EAAS3pD,OAAQF,EAAIC,EAAMD,GAAK,EAEnD,GADA2pD,EAAUE,EAAS7pD,GACfkE,EAAK+F,MAAMojB,KAAKs8B,GAAU,CAC1BC,GAAW,EACX,IAAInI,EAAgBv9C,EAAKu9C,eACzBv9C,EAAOA,EAAK+F,MAAMojB,KAAKs8B,IAClBlI,cAAgBA,GAErBgI,EAAcjrD,KAAKsrD,cAAcH,IACrBI,gBAAiB,EAC7B,KACJ,CAiBZ,OAZKH,IACDD,GAAU,EACNzlD,EAAK+F,OAAS/F,EAAK+F,MAAMI,KACzBs/C,EAAUzlD,EAAK+F,MAAMI,KACd7L,KAAKiE,KAAK6qB,WACjBq8B,EAAUnrD,KAAKiE,KAAK6qB,UAEpBq8B,IACAF,EAAcjrD,KAAKsrD,cAAcH,KAIpCh3C,GAAai3C,GAKb1lD,EAAKC,SACND,EAAKC,OAAS,IAEbD,EAAKE,QACNF,EAAKE,MAAQ,IAEbF,EAAKD,iBACEC,EAAKC,cACLD,EAAKE,SAGhBF,EAAO,CACHC,OAAOD,EAAKC,OACZC,MAAMF,EAAKE,MACX,wBAAwBF,EAAK,yBAC7B,oBAAoBA,EAAK,qBACzBe,OAAOf,EAAKe,OACZ,kBAAkBwkD,EAAY,mBAC9B,mBAAmBvlD,EAAK,oBACxB,mBAAmBulD,EAAY,oBAC/B,mBAAoBA,EAAY,oBAChC,cAAcvlD,EAAK,eACnB,eAAeA,EAAK,gBACpB,0BAA0BA,EAAK,2BAC/B6lD,eAAgBN,EAAYM,eAC5BxB,iBAAkBkB,EAAY,oBAC9BxlD,QAAQC,EAAKD,QACbw9C,cAAcv9C,EAAKu9C,cACnBx3C,MAAM/F,EAAK+F,QAGLhG,UAAaC,EAAKE,OAASF,EAAKC,QAAUD,EAAKu9C,gBACrDv9C,EAAKD,QAAUC,EAAKC,QAEpBD,EAAKD,iBACEC,EAAKC,cACLD,EAAKE,OAST,CAACF,KAPRA,EAAO1F,KAAK8pD,oBAAoBpkD,GAOd6hD,SALdyD,IAGYI,IA/CL,CAAC1lD,MAAK,EAAM6hD,SAASyD,EAkDpC,EAEA3rD,EAAImuC,WAAWx4B,UAAUs2C,cAAgB,SAAUH,GAC/C,IAAI1gD,EAAM,CAAC,EACP2c,EAAW/nB,EAAImrB,cAAcxqB,KAAKiE,KAAK6qB,SAAU9uB,KAAKiB,MAAMC,IAAI,kBAAkB,IAClFsqD,EAAaxrD,KAAKiB,MAAM0B,OAAOykB,EAASqD,MAAQrD,EAASqD,KAAOzqB,KAAKiB,MAAMC,IAAI,kBAAkB,GACjGuqD,EAAqBzrD,KAAKiB,MAAM0B,OAAO6oD,GAAY5oD,KAAK,sBACxD8oD,EAAwB1rD,KAAKiB,MAAM0B,OAAO6oD,GAAY5oD,KAAK,yBAC3D+oD,EAAmB3rD,KAAKiB,MAAM0B,OAAO6oD,GAAY5oD,KAAK,oBACtDgpD,EAAkBT,EAAQ5pD,MAAM,KAAK,GAgBzC,OAfIkqD,GAAsBA,EAAmBG,KACzCnhD,EAAI,oBAAqB,EACzBA,EAAI,qBAAsB,GAE1BihD,GAAyBA,EAAsBE,KAC/CnhD,EAAI,qBAAsB,EAC1BA,EAAI,oBAAqB,GAEzBkhD,GAAoBA,EAAiBC,KACrCnhD,EAAI,qBAAsB,GAG1BA,EAAI,qBACJA,EAAI,qBAAsB,GAEvBA,CACX,EAEApL,EAAImuC,WAAWx4B,UAAUkyC,gBAAkB,SAAUxhD,GACjD,GAA4B,iBAAxB1F,KAAKiB,MAAMhB,IAAIoN,KAAyB,CAExC,IADA,IAAIw+C,EAAU,GACL/oD,EAAE,EAAE4B,EAAKrF,EAAI2J,WAAWtH,OAAOoB,EAAE4B,EAAK5B,GAAG,EAC1C4C,EAAKrG,EAAI2J,WAAWlG,MACpB+oD,GAAWnmD,EAAKrG,EAAI2J,WAAWlG,KAGvC9C,KAAKiB,MAAMhB,IAAI4+C,cAAcl6C,KAAKknD,EACtC,CACJ,EAEAxsD,EAAImuC,WAAWx4B,UAAUwyC,iBAAmB,SAAU9hD,EAAM2nB,EAASy+B,IAC5DpmD,EAAKD,SAAWC,EAAKC,SACtBD,EAAKD,QAAUC,EAAKC,cACbD,EAAKC,QAEhB,IAAIomD,EAAcrmD,EAAKD,QACnBumD,EAAeD,EACfthD,EAAM,CACN,KAAQshD,EAAYxqD,MAAM,YAC1B,MAASyqD,EAAazqD,MAAM,aAEhC,GAAIvB,KAAKiB,MAAM2S,IAAIsU,gBAAiB,CAEhC,GAAsC,UAAlCloB,KAAK6U,YAAY/C,QAAQ4a,KAAkB,CAC3C,IAAI9Z,EAAe5S,KAAKiE,KAAK2O,aAC7BA,EAAe5S,KAAKiB,MAAMknB,UAAU2H,iBAAiBld,EAAc,qBAAsBm5C,EAAa/rD,KAAKiE,KAAK6qB,UAC5G9uB,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,sBAAsBm5C,GACjEA,EAAc/rD,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,sBAAsBm5C,IAE/En5C,EAAe5S,KAAKiE,KAAK2O,aACzBA,EAAe5S,KAAKiB,MAAMknB,UAAU2H,iBAAiBld,EAAc,mBAAoBm5C,EAAa/rD,KAAKiE,KAAK6qB,UAC1G9uB,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBm5C,KAC/DA,EAAc/rD,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBm5C,KAGrFA,EAAc/rD,KAAKisD,aAAar5C,EAAcm5C,EAClD,CACA,GAAI,CAAC,QAAS,aAAc,cAAchpD,QAAQ/C,KAAK6U,YAAY/C,QAAQ,uBAAyB,EAAG,CACnG,IAAIc,EAAe5S,KAAKiE,KAAK2O,aAC7BA,EAAe5S,KAAKiB,MAAMknB,UAAU2H,iBAAiBld,EAAc,mBAAoBo5C,EAAchsD,KAAKiE,KAAK6qB,UAC3G9uB,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBo5C,KAC/DA,EAAehsD,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBo5C,IAElFA,EAAehsD,KAAKisD,aAAar5C,EAAco5C,GAC3C,CAAC,aAAc,cAAcjpD,QAAQ/C,KAAK6U,YAAY/C,QAAQ,uBAAyB,GACnFk6C,IAAiBD,IACjBC,EAAe,GAG3B,CAMA,GAHAvhD,EAAU,KAAIshD,EAAYxqD,MAAM,YAEhCkJ,EAAW,MAAIuhD,EAAazqD,MAAM,YAC9B,CAAC,QAAS,aAAc,cAAcwB,QAAQ/C,KAAK6U,YAAY/C,QAAQ,uBAAyB,EAChG,IAAK,IAAIhP,EAAE2H,EAAW,MAAE/I,OAAO,EAAGoB,GAAG,EAAGA,IAAK,CACzC,IAAI8P,EAAe5S,KAAKiE,KAAK2O,aAC7B,IAAIs5C,EAAYzhD,EAAW,MAAE3H,GAK7B,GAJA8P,EAAe5S,KAAKiB,MAAMknB,UAAU2H,iBAAiBld,EAAc,mBAAoBs5C,EAAWlsD,KAAKiE,KAAK6qB,UACxG9uB,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBs5C,KAC/DzhD,EAAW,MAAE3H,GAAK9C,KAAKiB,MAAMknB,UAAU4H,QAAQnd,GAAc,oBAAoBs5C,IAEjFzhD,EAAW,MAAE3H,GAAGC,QAAQ,MAAQ,EAAG,CACnC,IAAIopD,EAAW1hD,EAAW,MACtB2hD,EAAaD,EAASrpD,GAAGvB,MAAM,YACnCkJ,EAAW,MAAI0hD,EAAS3oD,MAAM,EAAGV,GAAGgD,OAAOsmD,GAAYtmD,OAAOqmD,EAAS3oD,MAAMV,EAAE,GACnF,CACJ,CAUJ,GARI9C,KAAKiB,MAAMC,IAAIiC,uBAAuB+7B,kCACtCz0B,EAAW,MAAEK,UAEjBL,EAAW,MAAIzK,KAAKqsD,iBAAiB5hD,EAAW,OAC5CzK,KAAK6U,YAAY/C,QAAQ,kBACzBrH,EAAW,MAAEK,WAGZ9K,KAAKiB,MAAMhB,IAAIq2B,cACZt2B,KAAKiE,KAAK2O,aAAc,CACxB,IAAIA,EAAe5S,KAAKiE,KAAK2O,aAC7B,IAAI05C,EAAUtsD,KAAKiB,MAAMhB,IAAIwrC,eAC7B,GAAI6gB,GAAWA,EAAQ15C,IAAiB05C,EAAQ15C,GAAcya,GAC1D,IAAK,IAAI7rB,EAAE,EAAEC,EAAKgJ,EAAW,MAAE/I,OAAOF,EAAEC,EAAKD,IAAK,CAC9C,IAAI+qD,EAAO9hD,EAAW,MAAEjJ,GACxBiJ,EAAW,MAAEjJ,GAAK+qD,EAAKzoD,QAAQwoD,EAAQ15C,GAAcya,GAAU,IAAIzoB,MACvE,CAER,CAER,CASA,OARI5E,KAAKiB,MAAMC,IAAIiC,uBAAuB+7B,kCACtCz0B,EAAU,KAAEK,UAEhBL,EAAU,KAAIzK,KAAKqsD,iBAAiB5hD,EAAU,MAC1CzK,KAAK6U,YAAY/C,QAAQ,kBACzBrH,EAAU,KAAEK,UAGTL,CACX,EAGApL,EAAImuC,WAAWx4B,UAAUk2C,eAAiB,SAAUxlD,EAAM8mD,GACtD,IAAIC,GAAsB,EAiB1B,QAhBKD,GAAW9mD,EAAK,oBAEmB,IAA7B1F,KAAK6oD,cAAcnjD,MAEjBA,EAAK+F,QAAU/F,EAAK+F,MAAMI,OAAS7L,KAAKiE,KAAK6qB,UAAY,CAAC,KAAM,MAAM/rB,QAAQ/C,KAAKiE,KAAK6qB,WAAa,GAEvGppB,EAAK+F,OAAS/F,EAAK+F,MAAMI,MAAQ,CAAC,KAAM,MAAM9I,QAAQ2C,EAAK+F,MAAMI,KAAKrI,MAAM,EAAE,KAAO,GAGxFxD,KAAKiB,MAAMC,IAAI,0BACX7B,EAAI0K,iBAAiBsC,KAAK3G,EAAKC,OAAS,IAAMD,EAAKE,QAChDvG,EAAIyK,oBAAoBuC,KAAK3G,EAAKC,OAASD,EAAKE,UAV3D6mD,GAAsB,GAenBA,CACX,EAEAptD,EAAImuC,WAAWx4B,UAAUi3C,aAAe,SAAUr5C,EAAcpT,GAC5D,IAGI8B,GAHA9B,EAAMQ,KAAKiB,MAAMknB,UAAUukC,WAAW95C,EAAcpT,IAG1C+B,MAAM,gBAChBkC,EAAIjE,EAAIkE,MAAM,kBAClBlE,EAAM8B,EAAI0J,MACV,IAAI0b,EAAO1mB,KAAKiE,KAAK,iBAAmBjE,KAAKiE,KAAK,iBAAmBjE,KAAKiE,KAAa,OAKvF,GAJIyiB,IACAA,EAAO/N,SAAS+N,EAAKI,KAAM,IAC3BJ,GAAOimC,MAAMjmC,IAAgBA,GAE7BA,EAAM,CACN,GAAIplB,EAAII,OAAS,EACb,IAAK,IAAIqW,EAAEtU,EAAE/B,OAAO,EAAGqW,EAAE,KACjB2O,GAAQ/N,SAASlV,EAAEsU,GAAI,KADHA,IAIxBvY,EAAM8B,EAAI0J,MAGlBxL,EAAMA,EAAIsE,QAAQ,YAAa,IACnC,CACA,OAAOtE,CACX,EAEAH,EAAImuC,WAAWx4B,UAAUq3C,iBAAmB,SAAUO,GAIlD,IAAIC,GAAY,EACZC,GAAY,EACZC,GAAW,EACXC,GAAa,EACbpF,EAAIgF,EAASppD,QACjB,GAAIxD,KAAK6U,YAAa,CA0BlB,QAvBI,IAAuB7U,KAAK6U,YAAY/C,QAAQ,eAEhD+6C,EAAY7sD,KAAK6U,YAAY/C,QAAQ,mBAErC,IAAuB9R,KAAK6U,YAAY/C,QAAQ,cAEhDi7C,EAAW/sD,KAAK6U,YAAY/C,QAAQ,kBAEpC,IAAuB9R,KAAK6U,YAAY/C,QAAQ,gBAEhDk7C,EAAahtD,KAAK6U,YAAY/C,QAAQ,oBAEtC,IAAuB9R,KAAK6U,YAAY/C,QAAQ,eAChDg7C,EAAY9sD,KAAK6U,YAAY/C,QAAQ,cAGrC+6C,IACIC,IACAlF,EAAIA,EAAEpkD,MAAM,GAAgB,EAAbspD,IAEnBlF,EAAIA,EAAEpkD,MAAM,EAAGqpD,IAGfE,EAAU,CACV,IAAIE,EAAKL,EAASppD,QACdqpD,EACAG,EAAaH,EAEbjF,EAAI,GAEJoF,IACAC,EAAKA,EAAGzpD,MAAMwpD,IAElBC,EAAKA,EAAGzpD,OAAkB,EAAZupD,GACdnF,EAAIA,EAAE9hD,OAAOmnD,EACjB,CACAL,EAAWhF,CACf,CACA,OAAOgF,CACX,EAIAvtD,EAAIk7C,gBAAkB,SAAUt5C,EAAOisD,GACnCltD,KAAKiB,MAAQA,EACbjB,KAAKktD,UAAYA,EACjBltD,KAAKmtD,QAAU,EACnB,EAEA9tD,EAAIk7C,gBAAgBvlC,UAAU8lC,OAAS,WACnC96C,KAAKotD,YACLptD,KAAKqtD,iBACLrtD,KAAKstD,kBACLttD,KAAKutD,oBACLvtD,KAAKwtD,gBACT,EAUAnuD,EAAIk7C,gBAAgBvlC,UAAUq4C,eAAiB,WAC3CrtD,KAAKytD,SAAW,CAAC,EACjB,IAAIxR,GAAW,EACoB,SAA/Bj8C,KAAKktD,UAAUp7C,QAAQgG,IACvBmkC,EAAWj8C,KAAKiB,MAAM+qB,QAAQ,OACQ,WAA/BhsB,KAAKktD,UAAUp7C,QAAQgG,MAC9BmkC,EAAW,KAEf,IAAImC,EAAM,IAAI/+C,EAAI8hB,MAClBi9B,EAAItsC,QAAQrL,OAAS,IACrB23C,EAAItsC,QAAQ9L,OAAS,IACrBhG,KAAKiB,MAAMqoB,OAAOiN,OAAO0lB,EAAUmC,GAAK,GACxC,IAAIsP,EAAW1tD,KAAKiB,MAAMqoB,OAAOte,MAEjCozC,EAAItsC,QAAQ9L,OAAShG,KAAKktD,UAAUp7C,QAAQ,sBAC5C9R,KAAKiB,MAAMqoB,OAAOiN,OAAO0lB,EAAUmC,GAAK,GACxC,IAAIuP,EAAa3tD,KAAKiB,MAAMqoB,OAAOte,MAEnChL,KAAKytD,SAASpR,QAAS,EACvBr8C,KAAKytD,SAASnR,UAAW,EACrBL,IACmE,WAA/Dj8C,KAAKktD,UAAUp7C,QAAQ,oCACvB9R,KAAKytD,SAASpR,OAASsR,EAC+C,UAA/D3tD,KAAKktD,UAAUp7C,QAAQ,qCAC9B9R,KAAKytD,SAASpR,OAASqR,EACvB1tD,KAAKytD,SAASnR,SAAWoR,IAEzB1tD,KAAKytD,SAASpR,OAASqR,EACvB1tD,KAAKytD,SAASnR,SAAWqR,GAGrC,EAGAtuD,EAAIk7C,gBAAgBvlC,UAAUs4C,gBAAkB,WAC5C,IAAK,IAAI9rD,EAAI,EAAaA,EAAH,EAAaA,GAAK,EAErC,IADA,IAAI6rB,EAAU,CAAC,YAAa,mBAAmB7rB,GACtCsB,EAAI,EAAG4B,EAAO1E,KAAK,kBAAkB0B,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CACpE,IAAItD,EAAMQ,KAAKqtB,EAAU,SAASvqB,GAC9Bs7C,EAAMp+C,KAAKqtB,EAAU,UAEzBrtB,KAAKiB,MAAMqoB,OAAOiN,OAAO/2B,EAAK4+C,GAAK,GACnCp+C,KAAKqtB,EAAU,SAASvqB,GAAK9C,KAAKiB,MAAMqoB,OAAOte,KACnD,CAER,EAGA3L,EAAIk7C,gBAAgBvlC,UAAUu4C,kBAAoB,WAE9C,IADA,IAAIn4B,EACK5zB,EAAI,EAAGC,EAAOzB,KAAK,kBAAkB0B,OAAQF,EAAIC,EAAMD,GAAK,EACjE4zB,EAAQ,CAACp1B,KAAKA,KAAKmtD,QAAQ,GAAK,SAAS3rD,GAAIxB,KAAKA,KAAKmtD,QAAQ,GAAK,SAAS3rD,IAC7ExB,KAAK,kBAAkBwB,GAAKxB,KAAK4hD,MAAMxsB,EAAOp1B,KAAKktD,UAAUp7C,QAAQ+F,UAE7E,EAGAxY,EAAIk7C,gBAAgBvlC,UAAUw4C,eAAiB,WAC3C,IAAIp4B,EAAQp1B,KAAK,kBACb+9B,EAAa/9B,KAAK4hD,MAAMxsB,EAAOp1B,KAAKktD,UAAUp7C,QAAQ,sBAAuB9R,KAAKytD,SAASpR,OAAQr8C,KAAKytD,SAASnR,SAAUt8C,KAAKktD,WACpIltD,KAAKiB,MAAMqoB,OAAOiN,OAAOwH,EAAY,UACzC,EAKA1+B,EAAIk7C,gBAAgBvlC,UAAU4sC,MAAQviD,EAAImuC,WAAWx4B,UAAU4sC,MAC/DviD,EAAIk7C,gBAAgBvlC,UAAU6vC,UAAYxlD,EAAImuC,WAAWx4B,UAAU6vC,UAGnExlD,EAAIk7C,gBAAgBvlC,UAAUo4C,UAAY,WACtCptD,KAAKiB,MAAMhB,IAAI,mBAAoB,EACnCD,KAAKiB,MAAMhB,IAAI,yBAA0B,EACzCD,KAAKiB,MAAMhB,IAAI,0BAA2B,EAC1CD,KAAKiB,MAAMhB,IAAI,oBAAqB,EACpCD,KAAKiB,MAAMhB,IAAI,0BAA2B,CAC9C,EAIAZ,EAAIo+C,cAAgB,SAAU1mC,EAAM9V,EAAOgD,EAAMf,GAC7C,IAAI0qD,EACA,YAAc72C,EAAKjF,QAAQ2a,MACvBvpB,GAAQA,EAAKwtB,QAETk9B,EADe,cAAf1qD,EAAKwtB,MACI,YAEAxtB,EAAKwtB,OAGjBk9B,IACDA,EAAS,SAGbA,EAAS72C,EAAKjF,QAAQ2a,KAI1B,IAAIE,EAAS5V,EAAKjF,QAAQ6a,OAC1B,GAAI,iBAAoBA,EAAQ,CAE5B,IAAIkhC,EAAW3qD,GAA8B,YAAtB6T,EAAKjF,QAAQ2a,KAAsBvpB,EAAOe,EAC7D4pD,EAAQ92C,EAAKjF,QAAQ2a,QACrBxrB,EAAM6sD,eAAc,EAAOD,EAAS92C,EAAKjF,QAAQ2a,KAAMxoB,EAAKkB,MAC5DwnB,EAAS1rB,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAME,OAChD1rB,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMshC,WACzC9sD,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMuhC,mBAC5Cj3C,EAAKjF,QAAQ4a,KACbzrB,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMshC,UAAYh3C,EAAKjF,QAAQ4a,KAC9DzrB,EAAMhB,IAAImR,cAAcC,IAAI0uB,aACnC9+B,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMshC,UAAY9sD,EAAMhB,IAAImR,cAAcC,IAAI0uB,YAExF9+B,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMwhC,uBAAyBl3C,EAAKjF,QAAQ6rC,oBAClF18C,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMuhC,iBAAmBj3C,EAAKpF,YAAYnO,SAGhF,CAAC,UAAW,SAAU,QAAQT,QAAQgU,EAAKjF,QAAQ2a,OAAS,GAAKxrB,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMiE,QAC7Gk9B,EAAS3sD,EAAMhB,IAAI8wB,eAAeha,EAAKjF,QAAQ2a,MAAMiE,OAErD3Z,EAAKpF,aAAe1Q,EAAMC,IAAIiC,uBAAuBwmB,6BACrD5S,EAAKpF,YAAY7G,UACjBiM,EAAKpF,YAAYhN,KAAK,CAAC,UAAU,OAAQoS,EAAK6K,QAC9C7K,EAAKpF,YAAY7G,WAG7B,CACA,OAAOzL,EAAIujD,UAAU3hD,EAAO8V,EAAM62C,EAAQjhC,EAAQttB,EAAIiK,SAC1D,EAEAjK,EAAIujD,UAAY,SAAU3hD,EAAO8V,EAAM0V,EAAME,EAAQnf,GACjD,IAAIuyB,EAAahpB,EAAKjF,QAAQ4a,KAC1B8sB,EAA4BziC,EAAKjF,QAAQ6rC,oBACzC18C,EAAMhB,IAAImR,cAAcC,IAAI0uB,aACT,WAAfA,EACA9+B,EAAMhB,IAAImR,cAAcC,IAAIyoC,cAAe,EAE3C/Z,EAAa9+B,EAAMhB,IAAImR,cAAcC,IAAI0uB,YAI7C9+B,EAAMhB,IAAImR,cAAcC,IAAImoC,4BAC5BA,EAA4Bv4C,EAAMhB,IAAImR,cAAcC,IAAImoC,2BAE5D,IAAI/uC,EAAMxJ,EAAM+qB,QAAQS,EAAMsT,EAAYpT,GAAQ,EAAOnf,EAAMuJ,EAAKqH,gBAOpE,GANIo7B,IACA/uC,EAAMpL,EAAI2N,OAAOC,WAAW,oBAAoBhM,EAAOwJ,IAKvDxJ,EAAMhB,IAAIk3B,cACV1sB,EAAMA,EAAI3G,QAAQ,MAAO,SAEzB,IAAK,IAAItC,EAAI,EAAGC,EAAOsV,EAAKpF,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3D,GAAI,mBAAqBuV,EAAKpF,YAAYnQ,GAAG,IAAM,SAAWuV,EAAKpF,YAAYnQ,GAAG,GAAI,CAClFiJ,EAAMA,EAAI3G,QAAQ,MAAO,IACzB,KACJ,CAGR,OAAO2G,CACX,EAIApL,EAAIyiB,KAAKpc,KAAO,CACZ6b,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAEIysC,EADJ,CAAC7uD,EAAI4H,UAAW5H,EAAI0H,OAAOhE,QAAQ/C,KAAK4iB,YAAc,SAElD,IAAuB3hB,EAAMhB,IAAIqiB,MACjC4rC,OAAa73B,EACbp1B,EAAMhB,IAAIqiB,KAAO,YAEjB4rC,EAAajtD,EAAMhB,IAAIqiB,KASvBrhB,EAAMmvB,WAAWpwB,KAAM,yBACnBiB,EAAMmvB,WAAWpwB,KAAM,0BAA4BiB,EAAMmvB,WAAWpwB,KAAM,eAE9EiB,EAAMC,IAAI2gB,YAAcxiB,EAAIsJ,UAE5B1H,EAAMmvB,WAAWpwB,KAAM,+BACnBiB,EAAMmvB,WAAWpwB,KAAM,gCAAkCiB,EAAMmvB,WAAWpwB,KAAM,qBAEpFiB,EAAMC,IAAI2gB,YAAcxiB,EAAIsJ,UAGhC1H,EAAMhB,IAAIqiB,KAAO4rC,EAEjBzsC,EAAO,SAAUxgB,GAGbA,EAAMhB,IAAIm5C,UAAY,QAItBn4C,EAAMhB,IAAI+7C,eAAiB/6C,EAAMmvB,WAAWpwB,KAAM,YAAa,iBAAkB,MACjFiB,EAAMhB,IAAI,4BAA8BgB,EAAMmvB,WAAWpwB,KAAM,4BAG3D,SAAWiB,EAAMmvB,WAAWpwB,KAAM,OAClCA,KAAKi8C,SAAWh7C,EAAM+qB,QAAQ,MAAO,OAAQ,GACtC,WAAa/qB,EAAMmvB,WAAWpwB,KAAM,SACvCiB,EAAMC,IAAIiC,uBAAuBinB,uBACjCpqB,KAAKi8C,SAAWh7C,EAAM+qB,QAAQ,MAAO,SAAU,GAE/ChsB,KAAKi8C,SAAW,KAGxBh7C,EAAMhB,IAAIg8C,SAAWj8C,KAAKi8C,SACtB58C,EAAIqH,6BAA6B+K,KAAKzR,KAAKi8C,WAC3Cj8C,KAAKk8C,kBAAoB,IACzBl8C,KAAKm8C,oBAAsB,KAGvB,iBAAoBl7C,EAAMhB,IAAI+7C,iBAC9Bh8C,KAAKm8C,oBAAsBl7C,EAAMhB,IAAI+7C,gBAEzCh8C,KAAKo8C,WAAa,MAMlBp8C,KAAKk8C,kBAAoB,GACzBl8C,KAAKm8C,oBAAsB,GAC3Bn8C,KAAKo8C,WAAa,IAEoC,WAAtDn7C,EAAMmvB,WAAWpwB,KAAM,2BACvBA,KAAKk8C,kBAAoBj7C,EAAMhB,IAAI+7C,eAC0B,UAAtD/6C,EAAMmvB,WAAWpwB,KAAM,2BAG1BA,KAAKm8C,sBACLn8C,KAAKm8C,oBAAsB,KAE8B,wBAAtDl7C,EAAMmvB,WAAWpwB,KAAM,6BAC1BA,KAAKk8C,oBACLl8C,KAAKk8C,kBAAoBj7C,EAAMhB,IAAI+7C,gBAEnCh8C,KAAKm8C,sBACLn8C,KAAKm8C,oBAAsB,MAInCn8C,KAAK8X,IAAM,CAAC,EACR7W,EAAMmvB,WAAWpwB,KAAM,QACvBiB,EAAMqoB,OAAOiN,OAAOv2B,KAAKi8C,SAAU,SAAS,GAC5Cj8C,KAAK8X,IAAIukC,OAASp7C,EAAMqoB,OAAOte,MAC/BhL,KAAK8X,IAAIukC,OAAOvqC,QAAQ9L,OAAShG,KAAKk8C,kBACtCl8C,KAAK8X,IAAIukC,OAAOvqC,QAAQrL,OAASzG,KAAKo8C,WACtCn7C,EAAMqoB,OAAOiN,OAAOv2B,KAAKi8C,SAAU,SAAS,GAC5Cj8C,KAAK8X,IAAIwkC,SAAWr7C,EAAMqoB,OAAOte,MACjChL,KAAK8X,IAAIwkC,SAASxqC,QAAQ9L,OAAShG,KAAKm8C,oBACxCn8C,KAAK8X,IAAIwkC,SAASxqC,QAAQrL,OAASzG,KAAKo8C,YACjCn7C,EAAMhB,IAAI+7C,iBAEjBh8C,KAAK8X,IAAIukC,OAAS,IAAIh9C,EAAI+2B,KAAKn1B,EAAMhB,IAAI+7C,gBACzCh8C,KAAK8X,IAAIukC,OAAOvqC,QAAQ9L,OAAS,GACjChG,KAAK8X,IAAIukC,OAAOvqC,QAAQrL,OAAS,GACjCzG,KAAK8X,IAAIwkC,SAAW,IAAIj9C,EAAI+2B,KAAKn1B,EAAMhB,IAAI+7C,gBAC3Ch8C,KAAK8X,IAAIwkC,SAASxqC,QAAQ9L,OAAS,GACnChG,KAAK8X,IAAIwkC,SAASxqC,QAAQrL,OAAS,IAGvCzG,KAAK8kD,SAAW,CAAC,EACb7jD,EAAMmvB,WAAWpwB,KAAM,oBAUvBA,KAAKmuD,cAAgB,IAGrBnuD,KAAKouD,uBAAyB,IAC9BpuD,KAAKquD,yBAA4BptD,EAAMmvB,WAAWpwB,KAAM,YAAa,iBAAkB,MACvFA,KAAKsuD,gBAAkB,IACvBtuD,KAAK8kD,SAASzI,OAAS,IAAIh9C,EAAI+2B,KAAKp2B,KAAKmuD,eACzCnuD,KAAK8kD,SAASzI,OAAOvqC,QAAQ9L,OAAShG,KAAKouD,uBAC3CpuD,KAAK8kD,SAASzI,OAAOvqC,QAAQrL,OAASzG,KAAKsuD,gBAC3CtuD,KAAK8kD,SAASxI,SAAW,IAAIj9C,EAAI+2B,KAAKp2B,KAAKmuD,eAC3CnuD,KAAK8kD,SAASxI,SAASxqC,QAAQ9L,OAAShG,KAAKquD,yBAC7CruD,KAAK8kD,SAASxI,SAASxqC,QAAQrL,OAASzG,KAAKsuD,sBAkB7C,IAAuBrtD,EAAMhB,IAAI,eACjCgB,EAAMhB,IAAI,aAAegB,EAAMmvB,WAAWpwB,KAAM,mBAEhD,IAAuBiB,EAAMhB,IAAI,qBACjCgB,EAAMhB,IAAI,mBAAqBgB,EAAMmvB,WAAWpwB,KAAM,yBAEtD,IAAuBiB,EAAMhB,IAAI,oBAEjCgB,EAAMhB,IAAI,kBAAoBgB,EAAMmvB,WAAWpwB,KAAM,mBAGzDiB,EAAM6xB,WAAWptB,KAAO1F,IAC5B,EAEAiB,EAAMsgB,MAAMu8B,WAAY,EAExB99C,KAAK0gB,MAAM/b,KAAK8c,IAEpBZ,EAAOlc,KAAK3E,KAChB,GAOJX,EAAIyiB,KAAK,aAAe,CACpBP,MAAO,SAAUtgB,GACbA,EAAMsgB,MAAMvhB,KAAK8R,QAAQpM,MAAQ1F,IACrC,GAKJX,EAAIyiB,KAAK/c,MAAQ,CACbwc,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAQJ,GALIzhB,KAAK4iB,YAAcvjB,EAAI0H,OAAS/G,KAAK4iB,YAAcvjB,EAAI4H,YACvD5H,EAAIgsB,KAAK+rB,gBAAgBp4B,KAAKhf,KAAMiB,EAAO4f,GAC3C5f,EAAMsgB,MAAM0gB,iBAAiBt9B,KAAK,IAGlC3E,KAAK4iB,YAAcvjB,EAAI4H,UAAW,CAElC,IAAK,IAAIzF,KADTP,EAAMsgB,MAAMugB,gBAAgB7gC,EAAMsgB,MAAMugB,gBAAgBpgC,OAAO,GAAGoE,OAAO9F,KAAKmjB,WAChEnjB,KAAKmjB,UAAW,CAC1B,IAAI9L,EAAWrX,KAAKmjB,UAAU3hB,GAC1B+sD,EAActtD,EAAMsgB,MAAMwgB,WAAW9gC,EAAMsgB,MAAMwgB,WAAWrgC,OAAO,GACnE2S,OAAO7J,KAAK+jD,GAAa7sD,SACzB6sD,EAAYl3C,GAAYk3C,EAAYl6C,OAAO7J,KAAK+jD,GAAa,IAErE,CACA9sC,EAAO,SAAUxgB,GACbA,EAAM6xB,WAAWwtB,OAAOtgD,KAAMA,KAAKwuD,eAAe,GACtD,EACAxuD,KAAK0gB,MAAM/b,KAAK8c,EACpB,CAqBA,GAnBIzhB,KAAK4iB,YAAcvjB,EAAI0H,QAEvB9F,EAAMsgB,MAAMktC,YAAa,EACzBxtD,EAAMsgB,MAAMu8B,WAAY,EACxB78C,EAAMsgB,MAAM2gB,aAAe,EAC3BjhC,EAAMsgB,MAAMugB,gBAAgBn9B,KAAK3E,KAAKmjB,WACtCliB,EAAMsgB,MAAMwgB,WAAWp9B,KAAK,CAAC,GAG7B8c,EAAO,SAAUxgB,GACbA,EAAMhB,IAAIu/B,eAAe76B,MAAK,GAC9B1D,EAAMhB,IAAIstC,UAAY,CAAC,EACvBtsC,EAAMhB,IAAIstC,UAAUx4B,SAAW,GAC/B9T,EAAM6xB,WAAWrH,KAAKzrB,KAC1B,EACAA,KAAK0gB,MAAM/b,KAAK8c,IAIhBzhB,KAAK4iB,YAAcvjB,EAAI2H,IAAK,CAI5B,IAASxF,EAAI,EAAaA,EAAH,EAAaA,GAAK,EAAG,CACxC,IAAIyD,EAAM,CAAC,SAAU,QAAS,SAASzD,GACvCxB,KAAKiF,GAAOhE,EAAMsgB,MAAMtc,GACQ,IAA5BhE,EAAMsgB,MAAM2gB,cACZjhC,EAAMsgB,MAAMtc,QAAOoxB,EAE3B,CAEAr2B,KAAK0wB,MAAQzvB,EAAMsgB,MAAMwgB,WAAW9gC,EAAMsgB,MAAMwgB,WAAWrgC,OAAO,GAClET,EAAMsgB,MAAM2gB,cAAgB,EAC5BjhC,EAAMsgB,MAAMugB,gBAAgB92B,MAC5B/J,EAAMsgB,MAAMwgB,WAAW/2B,MAOvByW,EAAO,SAAUxgB,GAKTA,EAAMhB,IAAIk5C,UACVn5C,KAAKqmD,WAAaplD,EAAMhB,IAAIk5C,UAE5Bn5C,KAAKqmD,WAAa,QAGtBrmD,KAAKo5C,UAAYn4C,EAAM+qB,QAAQ/qB,EAAMhB,IAAIm5C,UAAW,OAAQ,GAC5Dp5C,KAAKumD,mBAAqB,IAE1BvmD,KAAKwmD,qBAAuBvlD,EAAMhB,IAAI+7C,eACQ,WAA1C/6C,EAAMhB,IAAI,4BACVD,KAAKumD,mBAAqBtlD,EAAMhB,IAAI+7C,eACa,UAA1C/6C,EAAMhB,IAAI,4BACjBD,KAAKwmD,qBAAuB,IACqB,wBAA1CvlD,EAAMhB,IAAI,8BACjBD,KAAKumD,mBAAqBtlD,EAAMhB,IAAI+7C,eACpCh8C,KAAKwmD,qBAAuB,KAEhCxmD,KAAKsmD,YAAc,GACdjnD,EAAIqH,6BAA6B+K,KAAKzR,KAAKo5C,aAIZ,MAA5Bp5C,KAAKumD,qBACLvmD,KAAKumD,mBAAqB,IAEI,MAA9BvmD,KAAKwmD,uBACLxmD,KAAKwmD,qBAAuB,IAEP,MAArBxmD,KAAKsmD,cACLtmD,KAAKsmD,YAAc,KAO3B,IAAK,IAAI9kD,EAAI,EAAaA,EAAH,EAAaA,GAAK,EAAG,CACxC,IAAIyD,EAAM,CAAC,SAAU,SAASzD,GAC9BP,EAAM6xB,WAAW7tB,GAAOjF,KAAKiF,EACjC,CACAhE,EAAM6xB,WAAiB,KAAI9yB,KAAW,KAGtC,IAAI0uD,EAAS,OACTC,EAAsB,GACtBC,EAAc,GACdvvD,EAAIqH,6BAA6B+K,KAAKi9C,KACtCC,EAAsB,IACtBC,EAAc,KAElB,IAAIC,EAAU,CAAC,EACfA,EAAQxS,OAAS,IAAIh9C,EAAI+2B,KAAKs4B,GAC9BG,EAAQxS,OAAOvqC,QAAQrL,OAASmoD,EAChCC,EAAQvS,SAAW,IAAIj9C,EAAI+2B,KAAKs4B,GAChCG,EAAQvS,SAASxqC,QAAQrL,OAASmoD,EACyC,WAAvE3tD,EAAMmvB,WAAWnvB,EAAM6xB,WAAWptB,KAAM,4BACxCmpD,EAAQxS,OAAOvqC,QAAQ9L,OAAS/E,EAAMmvB,WAAWpwB,KAAM,YAAa,mBACpE6uD,EAAQvS,SAASxqC,QAAQ9L,OAAS/E,EAAMmvB,WAAWpwB,KAAM,YAAa,oBACQ,eAAvEiB,EAAMmvB,WAAWnvB,EAAM6xB,WAAWptB,KAAM,4BAC/CmpD,EAAQxS,OAAOvqC,QAAQ9L,OAAS2oD,EAChCE,EAAQvS,SAASxqC,QAAQ9L,OAAS/E,EAAMmvB,WAAWpwB,KAAM,YAAa,oBACQ,wBAAvEiB,EAAMmvB,WAAWnvB,EAAM6xB,WAAWptB,KAAM,4BAC/CmpD,EAAQxS,OAAOvqC,QAAQ9L,OAAS/E,EAAMmvB,WAAWpwB,KAAM,YAAa,mBACpE6uD,EAAQvS,SAASxqC,QAAQ9L,OAAS2oD,IAElCE,EAAQxS,OAAOvqC,QAAQ9L,OAAS2oD,EAChCE,EAAQvS,SAASxqC,QAAQ9L,OAAS2oD,GAEtC1tD,EAAM6xB,WAAiB,KAAI+7B,EAK3B5tD,EAAM6xB,WAAWpC,MAAQ1wB,KAAK0wB,MAE9BzvB,EAAM6xB,WAAWuzB,WAAarmD,KAAKqmD,WACnCplD,EAAM6xB,WAAWsmB,UAAYp5C,KAAKo5C,UAClCn4C,EAAM6xB,WAAWyzB,mBAAqBvmD,KAAKumD,mBAC3CtlD,EAAM6xB,WAAW0zB,qBAAuBxmD,KAAKwmD,qBAC7CvlD,EAAM6xB,WAAWwzB,YAActmD,KAAKsmD,YACpCrlD,EAAM6xB,WAAW0tB,cACjBv/C,EAAMhB,IAAI,wBAAqBo2B,EAC/Bp1B,EAAMhB,IAAI,kBAAeo2B,EACzBp1B,EAAMhB,IAAI,uBAAoBo2B,CAClC,EACAr2B,KAAK0gB,MAAM/b,KAAK8c,GAGhBA,EAAO,SAAUxgB,GACRA,EAAMhB,IAAIu/B,eAAex0B,OAC1B/J,EAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,SAeA,IAA5CvG,EAAMhB,IAAIu/B,eAAevf,QAAQve,SACjCT,EAAMhB,IAAI6uD,sBAAuB,EAEzC,EACA9uD,KAAK0gB,MAAM/b,KAAK8c,GAEhBxgB,EAAMsgB,MAAMu8B,WAAY,CAC5B,CACAj9B,EAAOlc,KAAK3E,MAERA,KAAK4iB,YAAcvjB,EAAI2H,KAAOhH,KAAK4iB,YAAcvjB,EAAI4H,YACrDhG,EAAMsgB,MAAM0gB,iBAAiBj3B,MAC7B3L,EAAIgsB,KAAKssB,cAAc34B,KAAKhf,KAAMiB,EAAO4f,GAEjD,GAKJxhB,EAAIyiB,KAAK9f,OAAS,CACduf,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EACJpiB,EAAIgsB,KAAK+rB,gBAAgBp4B,KAAKhf,KAAMiB,EAAO4f,GAIjB,UAAtB7gB,KAAK8R,QAAQ4a,KACb1sB,KAAKs5B,UAAYr4B,EAAM0C,IAAI49B,UACE,YAAtBvhC,KAAK8R,QAAQ4a,KACpB1sB,KAAKs5B,UAAYr4B,EAAM0C,IAAI6nB,YACE,iBAAtBxrB,KAAK8R,QAAQ4a,OACpB1sB,KAAKs5B,UAAYr4B,EAAM0C,IAAI+nB,uBAE3B,IAAuB1rB,KAAKw4B,mBAC5Bx4B,KAAKw4B,iBAAmBv3B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,uBAEpD,IAAuB7iC,KAAKi5B,gBAC5Bj5B,KAAKi5B,cAAgBh4B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,kBAYrDphB,EAAO,SAAUxgB,EAAOgD,EAAMf,GAI1B,GAA8B,IAA1BlD,KAAKmjB,UAAUzhB,OAAnB,CAGA,IAAI2rB,EAEJ,GADAA,EAAUrtB,KAAKmjB,UAAU,QACrB,IAAuBjgB,EACnBA,EAAO,CAAC,EAEhB,GAAI,CAAC,UAAW,iBAAiBH,QAAQsqB,IAAY,EAAG,CACpD,GAAIpsB,EAAMhB,IAAIq2B,aACV,OAEJ,IAAKpzB,EAAKmqB,GACN,MAER,MACI,IAAKppB,EAAKopB,GACN,OAIQ,sBAAZA,GAAiD,eAAdppB,EAAKkB,OACxClE,EAAMhB,IAAIwuC,2BAA4B,GA2B1C,IAAI13B,EAAO/W,KAEX,GAAIiB,EAAMhB,IAAImR,cAAcC,IAAIgB,eAC5B,OAAO,EAcX,GAXI,CAAC,UAAW,iBAAiBtP,QAAQsqB,IAAY,EAEjDpsB,EAAM6sD,cAAc9uC,KAAK/d,EAAO8V,EAAM7T,EAAMmqB,EAASppB,EAAKkB,QAErDlE,EAAMhB,IAAImR,cAAcC,IAAIC,WAAarN,EAAKopB,KAC/CpsB,EAAMhB,IAAIyR,iBAAmB,GAAKzN,EAAKopB,IAAU3pB,MAAM,WAG3DzC,EAAM6sD,cAAc9uC,KAAK/d,EAAO8V,EAAM9S,EAAMopB,EAASppB,EAAKkB,OAG1DnF,KAAKkiD,UAAW,CAChB,IAAIh9C,EAAMjB,EAAKopB,GAAS7pB,MAAMxD,KAAKkiD,WACnCjhD,EAAMqoB,OAAOiN,OAAOrxB,EAAK6R,EAC7B,MACI1X,EAAIgsB,KAAK0jC,mBAAmB9tD,EAAOosB,EAASppB,EAAKoqB,IAGjD,CAAC,UAAW,iBAAiBtrB,QAAQ/C,KAAKwuD,eAAe,KAAO,IAC7DvtD,EAAMhB,IAAIq2B,eACbr1B,EAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKwuD,eAAe,IAC7CvtD,EAAMhB,IAAImR,cAAcC,IAAI8uB,UAAUx7B,KAAK3E,KAAKwuD,eAAe,IA1EnE,CA4EJ,EACAxuD,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,MAEZX,EAAIgsB,KAAKssB,cAAc34B,KAAKhf,KAAMiB,EAAO4f,EAC7C,GAYJxhB,EAAIyiB,KAAKyR,KAAO,CACZhS,MAAO,SAAUtgB,EAAO4f,GAEpB,GADAA,EAAS5f,EAAMA,EAAMsgB,MAAMe,KAAO,SAASC,OACvCviB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CACL,aAArB9F,EAAMsgB,MAAMlU,OACZpM,EAAMC,IAAIg9B,gBAAiB,GAE/Bj9B,EAAMsgB,MAAMlU,KAAOpM,EAAMsgB,MAAMe,KAAO,QACtCrhB,EAAMsgB,MAAMG,UAAY,QAExB,IAAID,EAAO,SAAUxgB,EAAOgD,GAGxB,GAAIhD,EAAMC,IAAIk9B,kBAAmB,CAI7B,IAHA,IAEI4wB,EAFA5nC,EAAW/nB,EAAImrB,cAAcvmB,EAAK6qB,SAAU7tB,EAAMC,IAAI,kBAAkB,IACxE4hC,EAAe7hC,EAAMA,EAAMhB,IAAIoN,KAAK7J,MAAM,GAAG,IAAItC,IAAI4hC,aAEhDthC,EAAE,EAAEC,EAAKqhC,EAAaphC,OAAOF,EAAEC,KACpCutD,EAAclsB,EAAathC,GAAG4lB,EAAS8sB,SAEnC8a,EAAclsB,EAAathC,GAAG4lB,EAASqD,QAEvCukC,GALqCxtD,GAAG,GAS3CwtD,IACDA,EAAc/tD,EAAMC,IAAI,kBAAkB,IAE9CD,EAAMhB,IAAIgvD,eAAiBhuD,EAAMC,IAAIqB,KACrCtB,EAAMC,IAAIqB,KAAOysD,CACrB,CACJ,EACAhvD,KAAK0gB,MAAM/b,KAAK8c,EAEpB,CACA,GAAIzhB,KAAK4iB,YAAcvjB,EAAI2H,IAAK,CAC5B/F,EAAMsgB,MAAMlU,KAAOpM,EAAMsgB,MAAMe,KAC/BrhB,EAAMsgB,MAAMG,UAAY,GACpBD,EAAO,SAAUxgB,GACbA,EAAMC,IAAIk9B,oBACVn9B,EAAMC,IAAIqB,KAAOtB,EAAMhB,IAAIgvD,sBACpBhuD,EAAMhB,IAAIgvD,eAIzB,EACAjvD,KAAK0gB,MAAM/b,KAAK8c,EAQpB,CACAZ,EAAOlc,KAAK3E,KAChB,GAOJX,EAAIyiB,KAAKotC,WAAa,CAClB3tC,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EACJ,GAAIzhB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CAG9B,IAAIyzC,EAAe,IAAIn7C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC/C1H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKw7B,EAAcv5C,EAAO4f,GAChD,IAAIsuC,EAAe,IAAI9vD,EAAI8hB,MAAM,KAAM9hB,EAAI4H,WAC3Cwa,EAAO,WACH,SAAIxgB,EAAMhB,IAAIgR,MAAMvP,QAAWT,EAAMhB,IAAIogD,uBAI7C,EACA8O,EAAa7sB,MAAQ,CAAC7gB,GACtB0tC,EAAa19C,KAAOxQ,EAAM0C,IAAID,MAAMg3C,IAAIyU,EAAcluD,EAAOkuD,EAAa7sB,OAC1EzhB,EAAOlc,KAAKwqD,GAEZ1tC,EAAO,SAAUxgB,GACbA,EAAMhB,IAAI6uD,sBAAuB,EAC7B7tD,EAAMhB,IAAIgR,MAAMvP,SAAWT,EAAMhB,IAAIogD,wBACrCp/C,EAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,SAEhDvG,EAAMhB,IAAIogD,wBAAyB,CACvC,EACArgD,KAAK0gB,MAAM/b,KAAK8c,GAChBZ,EAAOlc,KAAK3E,KAEhB,CACA,GAAIA,KAAK4iB,YAAcvjB,EAAI2H,IAAK,CAI5B6Z,EAAOlc,KAAK3E,MACZ,IAAIy7C,EAAa,IAAIp8C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KAC7C3H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKy8B,EAAYx6C,EAAO4f,EAElD,CACJ,GAOJxhB,EAAIyiB,KAAK7F,KAAO,CACZsF,MAAO,SAAUtgB,EAAO4f,GACpB,IAAIY,EAAMiL,EAAMC,EAAQ0B,EAAI3V,EAAK1W,EAAQs3B,EAAW81B,EAAaC,EAAkB3+B,EAAOjqB,EAC1F,GAAIzG,KAAKihB,gBAAiB,CACtB,IAAIquC,EAAcjwD,EAAIgsB,KAAK4rB,WAAWj3C,MACtCsvD,EAAY5pD,KAAO,QACnB4pD,EAAY1sC,UAAYvjB,EAAI0H,MAC5B1H,EAAIyiB,KAAKhF,MAAMyE,MAAMvC,KAAKswC,EAAaruD,EAAO4f,GAE9CxhB,EAAIshB,YAAY3B,KAAK/d,EAAOjB,KAAM6gB,GAElC,IAAI0uC,EAAYlwD,EAAIgsB,KAAK4rB,WAAWj3C,MACpCuvD,EAAU7pD,KAAO,QACjB6pD,EAAU3sC,UAAYvjB,EAAI2H,IACG,wBAAzBhH,KAAKihB,kBACLsuC,EAAUvU,qBAAsB,GAEpC37C,EAAIyiB,KAAKhF,MAAMyE,MAAMvC,KAAKuwC,EAAWtuD,EAAO4f,EAEhD,KAAO,CAyBH,GAxBAxhB,EAAIgsB,KAAK+rB,gBAAgBp4B,KAAKhf,KAAMiB,EAAO4f,GAStC7gB,KAAKwuD,iBACNxuD,KAAKwuD,eAAiB,IAErBxuD,KAAKmjB,YACNnjB,KAAKmjB,UAAY,IAGrBuJ,EAAO,OACPC,EAAS,EACL3sB,KAAK8R,QAAQ4a,OACbA,EAAO1sB,KAAK8R,QAAQ4a,MAEpB1sB,KAAK8R,QAAQ6a,SACbA,EAAS3sB,KAAK8R,QAAQ6a,QAEtB,oBAAsB3sB,KAAKwuD,eAAe,IAAM,gBAAkBxuD,KAAKwuD,eAAe,IAAM,mBAAqBxuD,KAAKwuD,eAAe,GAMtG,oBAA3BxuD,KAAKwuD,eAAe,IAEK,aAArBvtD,EAAMsgB,MAAMe,OACZrhB,EAAMC,IAAI2gB,YAAcxiB,EAAIqJ,SAEP,iBAArBzH,EAAMsgB,MAAMe,OACZrhB,EAAMC,IAAI+8B,SAAW5+B,EAAIqJ,SAGzB,oBAAsBzH,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIuhC,WAChDziC,KAAK05B,aAAez4B,EAAM+qB,QAAQ,6BAEtChsB,KAAKw4B,iBAAmBv3B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBACpD7iC,KAAKi5B,cAAgBh4B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBACjDphB,EAAO,SAAUxgB,EAAOgD,EAAMf,GAG1B,GADAmrB,EAAK,GAAKpqB,EAAKoqB,IACVptB,EAAMhB,IAAIq2B,aAAc,CACzB,GAAiC,UAA7Br1B,EAAMhB,IAAIoN,KAAK7J,OAAO,IAAwC,oBAAtBxD,KAAKmjB,UAAU,GAA0B,CAIjF,GAHuB,sBAAnBliB,EAAMhB,IAAIoN,MACVpM,EAAMhB,IAAImR,cAAcC,IAAI8uB,UAAUx7B,KAAK,mBAExB,kBAAnB1D,EAAMhB,IAAIoN,MAA4BpM,EAAM6nB,kBAAkB7oB,IAAI+8C,oBAClE,IAAItkC,EAAMzX,EAAM6nB,kBAAkB7oB,IAAI+8C,oBAAoB/7C,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI4uB,UAEvFvkC,EAAMzX,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI4uB,IAO/C,OALIvkC,IAEAA,EAAMrZ,EAAIgsB,KAAK6xB,QAAQ,GAAKxkC,SAEhCzX,EAAMqoB,OAAOiN,OAAO7d,EAAK1Y,KAE7B,CACIkD,GAAQA,EAAK,gBACbjC,EAAMhB,IAAI42B,cAAc/yB,QAAQ,eAGhC4U,EADmB,sBAAnBzX,EAAMhB,IAAIoN,MAAgCpM,EAAM6nB,kBAAkB7oB,IAAI+8C,qBAAuB/7C,EAAM6nB,kBAAkB5nB,IAAI+hC,iCAAmC5jC,EAAIsI,WAC1J1G,EAAM6nB,kBAAkB7oB,IAAI+8C,oBAAoB/7C,EAAMwS,SAASA,SAAS4a,GAAI4uB,KAE5Eh8C,EAAMwS,SAASA,SAAS4a,GAAI4uB,IAElCh8C,EAAMC,IAAIi9B,qBACVl9B,EAAMqoB,OAAOiN,OAAOt1B,EAAMC,IAAIi9B,qBAAsBn+B,OAEpDgC,EAAS,IAAI3C,EAAI05C,YAAY93C,GAAO,EAAOyX,EAAK1Y,KAAMiE,EAAKoqB,IACvDptB,EAAMhB,IAAI+2B,sBACVh1B,EAAO23B,wBAAyB,GAEpC14B,EAAMqoB,OAAOiN,OAAOv0B,EAAQ,WAEpC,CACJ,EACAhC,KAAK0gB,MAAM/b,KAAK8c,IACkB,gBAA3BzhB,KAAKwuD,eAAe,IAE3BvtD,EAAMC,IAAI43C,iBAAkB,EAEe,uBAAvC73C,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIuhC,WAE1BziC,KAAK05B,aAAez4B,EAAM+qB,QAAQ,6BAEtChsB,KAAKw4B,iBAAmBv3B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI2hC,iBAChD5hC,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,2BAC1BlB,KAAKw4B,iBAAmBv3B,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI,0BAExDugB,EAAO,SAAUxgB,EAAOgD,GACpB,GAAIhD,EAAMwS,SAASA,SAASxP,EAAKoqB,MAAiE,IAA1DptB,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,cAA0Bte,EAAMhB,IAAIq2B,aAAc,CAEhI5d,EAAMC,SAAS1X,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,YAAa,IAOlEte,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI0pC,uBAC1B5qC,KAAKw4B,iBAAmBv3B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI0pC,sBAEtD5oC,EAAS,IAAI3C,EAAI05C,YAAY93C,GAAO,EAAOyX,EAAK1Y,KAAMiE,EAAKoqB,IAC3DiL,EAAY,IAAIj6B,EAAIgsB,KAAKiW,WAAWjiC,EAAIyO,cACxC9L,EAAOg3C,aAAa1f,GACpBr4B,EAAMqoB,OAAOiN,OAAOv0B,EAAQ,WAC5BotD,GAAc,EAEd,IAAK,IAAI5tD,EAAE,EAAEC,EAAKR,EAAMhB,IAAImR,cAAc6O,QAAQve,OAAQF,EAAEC,EAAMD,IAAK,CACnE,IAAI2P,EAAQlQ,EAAMhB,IAAImR,cAAc6O,QAAQze,GAC5C,IAAK2P,EAAM0uB,mBAAqB1uB,EAAMyuB,mBAAsBzuB,EAAMyuB,mBAAqBzuB,EAAMwuB,eAAiB,CAC1GyvB,GAAc,EACd,KACJ,CACJ,CACAC,EAAmBpuD,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,yBACzCkuD,GAAeC,IAAqBpuD,EAAMhB,IAAIy8C,gBAC9Cz7C,EAAMhB,IAAIkrB,iBAAmBlqB,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,yBAE/D,CACJ,EACAlB,KAAK0gB,MAAM/b,KAAK8c,IACkB,mBAA3BzhB,KAAKwuD,eAAe,KACF,iBAArBvtD,EAAMsgB,MAAMe,OACZrhB,EAAMC,IAAI+8B,SAAW5+B,EAAIuJ,UAE7B3H,EAAMC,IAAI43C,iBAAkB,EAC5Br3B,EAAO,SAAUxgB,EAAOgD,IACpBysB,EAAQzsB,EAAK,qBAETysB,EAAQzvB,EAAMyxB,iBAAiBzuB,IAE9BhD,EAAMhB,IAAIq2B,eACX7vB,EAAS,GACLxF,EAAMwS,SAASA,SAASxP,EAAKoqB,MAAiE,IAA1DptB,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,cAC9E7G,EAAMC,SAAS1X,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAS/lB,YAAa,IACtE9Y,EAASxF,EAAM0C,IAAI09B,WAAW9H,OAAO7gB,IAEzCgY,GAASjqB,GAEbxF,EAAMqoB,OAAOiN,OAAO7F,EAAO1wB,KAC/B,EACAA,KAAK0gB,MAAM/b,KAAK8c,SAGpB,GAAIzhB,KAAK8R,QAAQ2a,KAGbhL,EAAO,SAAUxgB,EAAOgD,GACpB,IAGI2pD,EAHAhhC,EAAS3rB,EAAMC,IAAI0rB,OAAO3oB,EAAKkB,MAC/BsnB,EAAOzsB,KAAK8R,QAAQ2a,KAwBxB,GAnBa,MAJbA,EAAOxrB,EAAM+qB,QAAQS,EAAMC,EAAMC,EAAQC,EAAQvtB,EAAIiK,SAAUtJ,KAAKoe,mBAKhEnd,EAAMhB,IAAImR,cAAcC,IAAIsuB,eAAgB,GAEhDtgC,EAAIyR,+BAA+B7P,EAAOwrB,EAAM,KAAMzsB,MAUlD4tD,EAJC3sD,EAAMhB,IAAIsG,kBAA6C,YAAvBtF,EAAMC,IAAW,OAAsC,aAAnBD,EAAMhB,IAAIoN,KAItEof,EAHAptB,EAAI2N,OAAOC,WAAW,oBAAoBhM,EAAOwrB,GAS1DxrB,EAAMhB,IAAIk3B,cACVy2B,EAASA,EAAO9pD,QAAQ,MAAO,SAE/B,IAAK,IAAItC,EAAI,EAAGC,EAAOzB,KAAK2R,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3D,GAAI,mBAAqBxB,KAAK2R,YAAYnQ,GAAG,IAAM,SAAWxB,KAAK2R,YAAYnQ,GAAG,GAAI,CAClFosD,EAASA,EAAO9pD,QAAQ,MAAO,IAC/B,KACJ,CAGR7C,EAAMqoB,OAAOiN,OAAOq3B,EAAQ5tD,MACxBiB,EAAMhB,IAAI6uD,sBAGV7tD,EAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,QAEpD,EACAxH,KAAK0gB,MAAM/b,KAAK8c,GAChBxgB,EAAMsgB,MAAMkL,MAAO,EACnBxrB,EAAMsgB,MAAMmL,MAAO,EACnBzrB,EAAMsgB,MAAMoL,QAAS,OAClB,GAAI3sB,KAAKwuD,eAAe9sD,OAAQ,CAyBnC,GAxBA+f,EAAO,SAAUxgB,EAAOgD,GAGW,YAA3BjE,KAAKwuD,eAAe,KACpBvtD,EAAMhB,IAAIyqC,gBAAiB,IAG1BzpC,EAAMhB,IAAImR,cAAcC,IAAIC,WAAarN,EAAKjE,KAAKmjB,UAAU,MAC9DliB,EAAMhB,IAAIyR,iBAAkB,GAEhC,IAAIxM,EAAMjB,EAAKjE,KAAKmjB,UAAU,IAC1Bje,IAAQjE,EAAMhB,IAAImR,cAAcC,IAAIC,aAC/B,GAAKpM,GAAK1B,OAAO,GAAGE,MAAM,SAC3BzC,EAAMhB,IAAIyR,iBAAkB,EAE5BzQ,EAAMhB,IAAIyR,iBAAkB,EAGxC,EACA1R,KAAK0gB,MAAM/b,KAAK8c,GAKZpiB,EAAIuC,aAAamB,QAAQ/C,KAAKwuD,eAAe,KAAO,GACjDxuD,KAAKwuD,eAAe,GAAGzrD,QAAQ,UAAY,GAC3C/C,KAAKwuD,eAAe,GAAGzrD,QAAQ,SAAW,GAC1C,CAAC,gBAAiB,0BAA0BA,QAAQ/C,KAAKwuD,eAAe,KAAO,EACjF,CAKD,IAAIgB,EAAYxvD,KAAKmjB,UAAU,GAC3BssC,GAAW,EACXC,GAAS,EACTC,GAAY,EACH,UAATjjC,EACyC,WAArC1sB,KAAKwuD,eAAe,GAAGhrD,OAAO,KAC9BksD,EAAS1vD,KAAKwuD,eAAe,GAAK,UAGtCgB,GAAY,EAEZvuD,EAAMsgB,MAAMG,UAGZiuC,GAAY,GAEZA,GAAY,EACZF,GAAW,GAGfhuC,EAAOxgB,EAAMknB,UAAUi1B,kBAAkBp9C,KAAKmjB,UAAWqsC,EAAWC,EAAUC,EAAQC,EAC1F,MAIQluC,EAFApiB,EAAIkJ,YAAYxF,QAAQ/C,KAAKwuD,eAAe,KAAO,EAE5C,SAAUvtD,EAAOgD,EAAMf,GACtBA,GAAQA,EAAKlD,KAAKmjB,UAAU,MAU5BliB,EAAM6sD,cAAc9tD,KAAMkD,EAAMlD,KAAKmjB,UAAU,GAAIlf,EAAKkB,MACxD9F,EAAIgsB,KAAK0jC,mBAAmB9tD,EAAOjB,KAAKmjB,UAAU,GAAIlf,EAAKoqB,IAGvD,CAAC,UAAW,iBAAiBtrB,QAAQ/C,KAAKwuD,eAAe,KAAO,IAC7DvtD,EAAMhB,IAAIq2B,cACbr1B,EAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKwuD,eAAe,IAGzD,EACQ,CAAC,OAAQ,aAAc,iBAAkB,oBAAqB,UAAW,QAAS,SAAU,kBAAmB,oBAAqB,UAAUzrD,QAAQ/C,KAAKwuD,eAAe,KAAO,EAGlL,SAASvtD,EAAOgD,GACnBhD,EAAM6sD,cAAc9tD,KAAMiE,EAAMjE,KAAKmjB,UAAU,GAAIlf,EAAKkB,MACxD9F,EAAIgsB,KAAK0jC,mBAAmB9tD,EAAOjB,KAAKmjB,UAAU,GAAIlf,EAAKoqB,GAC/D,EACO,CAAC,MAAO,OAAOtrB,QAAQ/C,KAAKwuD,eAAe,KAAO,EAClD,SAAUvtD,EAAOgD,GACpB,IAAIgN,EACJ,GAAIjR,KAAKmjB,UAAU,KACflS,EAAQhQ,EAAMmsB,YAAYnpB,EAAMjE,KAAKmjB,UAAU,GAAIuJ,IAS/C,GAP0B,QAAtB1sB,KAAKmjB,UAAU,IAAyB,UAATuJ,IAC/Bzb,EAAQA,EAAMnN,QAAQ,mBAAoB,OAChCJ,MAAM,eACZuN,EAAQA,EAAMnN,QAAQ,cAAe,KAIzC7C,EAAMC,IAAIiC,uBAAuBs7B,iBACjC,GAAKz+B,KAAK2R,YAAYjQ,QAAU1B,KAAK2R,YAAY,GAAG,KAAO,IAAM3R,KAAKmjB,UAAU,GA2C5EliB,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAAM,GAAO,GAAO,OA3CiC,CAGhF,IAAI4vD,EAAavwD,EAAIgsB,KAAK4rB,WAAWj3C,MAEjC6vD,EAAY,IAAIxwD,EAAI+2B,KAAK,KAAM,KAAM,eAGzC,GADAy5B,EAAUl+C,YAAYhN,KAAK,CAAC,OAAQ,SACL,QAA3B3E,KAAKwuD,eAAe,GAAc,CAElC,IAAIxoD,EACAhG,KAAK8R,QAAQ9L,QAAUhG,KAAK8R,QAAQ9L,OAAOtC,MAAM,8BAI7CsC,GAHJiL,EAAQA,EAAMnN,QAAQ,yBAA0B,KACtCJ,MAAM,gBAEH,GAGA,mBAGbksD,EAAW99C,QAAQ9L,OAAShG,KAAK8R,QAAQ9L,OAAOxC,MAAM,EAAGosD,EAAW99C,QAAQ9L,OAAOtE,OAAO,KAI9F,IAAIouD,EAAa,IAAIzwD,EAAI+2B,KAAKpwB,GAG1B+pD,EAAY,IAAI1wD,EAAI+2B,KAAKnlB,GAE7B4+C,EAAUlrD,KAAKmrD,GACfD,EAAUlrD,KAAKorD,GAEf9uD,EAAMqoB,OAAOiN,OAAOs5B,EAAWD,GAAY,GAAO,GAAO,EAC7D,KAAO,CACCG,EAAY,IAAI1wD,EAAI+2B,KAAKnlB,GAE7B4+C,EAAUlrD,KAAKorD,GAGf9uD,EAAMqoB,OAAOiN,OAAOs5B,EAAWD,GAAY,GAAO,GAAO,EAC7D,CACJ,KAGG,CAEH,GAAI5vD,KAAK2R,YAAYjQ,OACjB,IAAK,IAAIF,EAAExB,KAAK2R,YAAYjQ,OAAO,EAAGF,GAAG,EAAGA,IACpCxB,KAAK2R,YAAYnQ,GAAG,KAAO,IAAMxB,KAAKmjB,UAAU,KAChDnjB,KAAK2R,YAAc3R,KAAK2R,YAAYnO,MAAM,EAAGhC,GAAGsE,OAAO9F,KAAK2R,YAAYnO,MAAMhC,EAAE,KAI5FP,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAAM,GAAO,GAAO,EACnD,CAGZ,EACkC,YAA3BA,KAAKwuD,eAAe,GAIpB,SAAUvtD,EAAOgD,GACpB,IAAIgN,GACJA,EAAQhQ,EAAMmsB,YAAYnpB,EAAMjE,KAAKmjB,UAAU,GAAIuJ,KAE/CzrB,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,KAEnC,EACkC,gBAA3BA,KAAKwuD,eAAe,GACpB,SAAUvtD,EAAOgD,GACpB,IAAIgN,EAAQhQ,EAAMknB,UAAU4H,QAAiB,QAAe,YAAE9rB,EAAKoqB,IAC/Dpd,IACAhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAC3BiB,EAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EAEvD,EAGO,SAAU5+B,EAAOgD,GACpB,IAAIgN,EACAjR,KAAKmjB,UAAU,KACflS,EAAQhQ,EAAMmsB,YAAYnpB,EAAMjE,KAAKmjB,UAAU,GAAIuJ,MAG/Czb,GADAA,EAAQ,GAAKA,GACC1P,MAAM,MAAMI,KAAK,IAC/BV,EAAMqoB,OAAOiN,OAAOtlB,EAAOjR,MAGvC,EAGRA,KAAK0gB,MAAM/b,KAAK8c,EACpB,MAAWzhB,KAAK8R,QAAQb,QAEpBwQ,EAAO,SAAUxgB,GACbA,EAAMhB,IAAImR,cAAcC,IAAIsuB,eAAgB,EAE5CtgC,EAAIyR,+BAA+B7P,EAAOjB,KAAK8R,QAAQb,OAAO,EAAMjR,MACpEiB,EAAMqoB,OAAOiN,OAAOv2B,KAAK8R,QAAQb,MAAOjR,MACpCiB,EAAMhB,IAAI6uD,sBAGV7tD,EAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAOzE,EAAImI,QAEpD,EACAxH,KAAK0gB,MAAM/b,KAAK8c,IAIxBZ,EAAOlc,KAAK3E,MACZX,EAAIgsB,KAAKssB,cAAc34B,KAAKhf,KAAMiB,EAAO4f,EAC7C,CACJ,GAOJxhB,EAAIyiB,KAAKsH,OAAS,CACd7H,MAAO,SAAUtgB,EAAO4f,GACpB,GAAI7gB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CAE9B9F,EAAMsgB,MAAMlU,KAAO,SACnBpM,EAAMsgB,MAAMe,KAAO,SACnBrhB,EAAMsgB,MAAMG,UAAY,GAOxB1hB,KAAK0gB,MAAM/b,MALA,SAAS1D,EAAOgD,GACvBhD,EAAMhB,IAAIoN,KAAO,SACjBpM,EAAMhB,IAAIqiB,KAAO,SACjBrhB,EAAMhB,IAAIyhB,UAAY,EAC1B,GAEJ,CACI1hB,KAAK4iB,YAAcvjB,EAAI2H,MAGvB/F,EAAM+uD,YAAc,CAChB9uD,IAAK,CACD8hC,gBAAiB/hC,EAAM2nB,cAAc1nB,IAAI8hC,kBAGjD/hC,EAAMmoB,OAAOmZ,IAAMthC,EAAM+nB,SAASuZ,KAEtC1hB,EAAOlc,KAAK3E,KAChB,GAMJX,EAAI6jB,WAAa,CAAC,EAElB7jB,EAAI6jB,WAAW,iBAAmB,SAAUjiB,EAAOksB,GAE/C,GADKntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IACnB,SAARnV,EAAgB,CAChBlsB,EAAMC,IAAIu8B,kBAAmB,EAC7B,IAAIhc,EAAO,SAAUxd,GACjB,GAAuB,iBAAnBhD,EAAMhB,IAAIoN,MACV,GAAIpM,EAAMhB,IAAI2tC,mBAAqB3sC,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAShmB,aAEzE,OADAre,EAAMhB,IAAI2tC,oBAAsB,GACzB,OAIX,GADA3sC,EAAMhB,IAAI4tC,qBAAuB,EAC7B5sC,EAAMhB,IAAI6f,kBAAkBR,cACzBre,EAAMhB,IAAI2tC,mBAAqB3sC,EAAMhB,IAAI6f,kBAAkBR,aAE9D,OADAre,EAAMhB,IAAI2tC,oBAAsB,GACzB,EAGf,OAAO,CACX,EACA5tC,KAAKsiC,MAAM39B,KAAK8c,EACpB,MAAO,GAAY,sCAAR0L,EAA6C,CAChD1L,EAAO,SAAUxd,GACjB,SAAIhD,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAAShmB,cAAgBre,EAAMwS,SAASA,SAASxP,EAAKoqB,IAAI,kBAAoB,EAIvH,EACAruB,KAAKsiC,MAAM39B,KAAK8c,EACpB,CACJ,EAEApiB,EAAI6jB,WAAW,eAAiB,SAAUjiB,EAAOksB,GACxCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IA0B/B,IAzBA,IAAInf,EAAYgK,EAAI5rB,MAAM,OACtB0uD,EAAW,SAAS54C,GACpB,OAAO,SAAUpT,EAAMf,GACnB,IAAIgtD,EAASjsD,EAIb,GAHIf,GAAQ,CAAC,UAAU,iBAAiBH,QAAQsU,IAAa,IACzD64C,EAAShtD,IAERgtD,EAAO74C,GACR,OAAO,EAEX,GAAIhY,EAAI+K,kBAAkBrH,QAAQsU,IAAa,GAI3C,GAHKpW,EAAMhB,IAAI8wB,eAAe1Z,IAC1BpW,EAAM6sD,eAAc,EAAOoC,EAAQ74C,EAAUpT,EAAKkB,MAElDlE,EAAMhB,IAAI8wB,eAAe1Z,GAAUsH,QACnC,OAAO,OAER,GAAI,CAAC,QAAQ,WAAW5b,QAAQsU,IAAa,GAC5C64C,EAAO74C,GAAU7T,OAAO,KAAO,GAAKmV,SAASu3C,EAAO74C,GAAU7T,OAAO,GAAI,IACzE,OAAO,EAGf,OAAO,CACX,CACJ,EACShC,EAAE,EAAGA,EAAE2hB,EAAUzhB,OAAQF,GAAG,EACjCxB,KAAKsiC,MAAM39B,KAAKsrD,EAAS9sC,EAAU3hB,IAE3C,EAGAnC,EAAI6jB,WAAW,sBAAwB,SAAUjiB,EAAOksB,GAC/CntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/B,IAXA,IAAInf,EAAYgK,EAAI5rB,MAAM,OAEtB0uD,EAAW,SAAUE,GACrB,OAAO,SAASlsD,GACZ,SAAIA,EAAKksD,KAAelsD,EAAKksD,GAAYtpC,MAK7C,CACJ,EACSrlB,EAAE,EAAEC,EAAK0hB,EAAUzhB,OAAOF,EAAEC,EAAKD,GAAG,EACzCxB,KAAKsiC,MAAM39B,KAAKsrD,EAAS9sC,EAAU3hB,IAE3C,EAGAnC,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GACrCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAgB/B,IAfA,IAAI8tB,EAAYjjC,EAAIrpB,QAAQ,YAAa,aAGrCmsD,EAAW,SAAUI,GACrB,OAAO,SAASpsD,EAAMf,GAClB,IAAIwtB,EAGJ,OAFAzvB,EAAM6sD,eAAc,EAAO5qD,EAAM,eACjCwtB,EAAQzvB,EAAMhB,IAAI8wB,eAAe1tB,QAAQqtB,QAC5B2/B,IAAa3/B,EAK9B,CACJ,EACSlvB,EAAE,EAAEC,GAdb2uD,EAAYA,EAAU7uD,MAAM,QAcAG,OAAOF,EAAEC,EAAKD,GAAG,EACzCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASG,EAAU5uD,IAE3C,EAGAnC,EAAI6jB,WAAW,aAAe,SAAUjiB,EAAOksB,GACtCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAE/BrhC,EAAMC,IAAI2gB,YAAcxiB,EAAIsJ,SAkC5B,IAjCA,IAAI2nD,EAAenjC,EAAI5rB,MAAM,OACzBgvD,EAAqB,SAAUtsD,EAAMf,GACrC,SAAIA,GAAQ7D,EAAI+I,aAAalF,EAAK6kC,WAAa1oC,EAAI+I,aAAa/I,EAAI2I,sBAAwB9E,EAAK,aAIrG,EACIstD,EAAwB,SAAUvsD,EAAMf,GACxC,SAAIA,GAAQ7D,EAAI+I,aAAalF,EAAK6kC,WAAa1oC,EAAI+I,aAAa/I,EAAI2I,sBAAyB9E,EAAK,aAItG,EACI+sD,EAAW,SAASQ,GACpB,OAAO,SAAUxsD,EAAMf,GACnB,GAAuB,iBAAnBjC,EAAMhB,IAAIoN,KACV,OAAO,EAKX,GAHInK,QAAQ,IAAuBA,EAAK6kC,WACpC7kC,EAAK6kC,SAAW,GAEhB7kC,GAAiC,iBAAlBA,EAAK6kC,SAAuB,CAC3C,GAAsB,IAAlB7kC,EAAK6kC,UAAkC,IAAhB0oB,EACvB,OAAO,EACJ,GAAIA,EAAc,GAAKpxD,EAAI+I,aAAalF,EAAK6kC,WAAa1oC,EAAI+I,aAAaqoD,GAC9E,OAAO,CAEf,MAAO,GAAoB,IAAhBA,EACP,OAAO,EAEX,OAAO,CACX,CACJ,EACSjvD,EAAE,EAAEC,EAAK6uD,EAAa5uD,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAC/C,IAAIivD,EACgB,WADhBA,EAAcH,EAAa9uD,IAE3BivD,EAAcpxD,EAAI0I,eACK,yBAAhB0oD,EACPA,EAAcpxD,EAAI8I,8BACK,eAAhBsoD,EACPA,EAAcpxD,EAAI2I,oBACK,SAAhByoD,EACPA,EAAcpxD,EAAI4I,cACK,sBAAhBwoD,IACPA,EAAcpxD,EAAI6I,4BAElB,cAAgBuoD,EAChBzwD,KAAKsiC,MAAM39B,KAAK4rD,GACT,aAAeE,EACtBzwD,KAAKsiC,MAAM39B,KAAK6rD,GAEhBxwD,KAAKsiC,MAAM39B,KAAKsrD,EAASQ,GAEjC,CACJ,EAEApxD,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GAClCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAe/B,IAbA,IAAI3tB,EAAQwY,EAAI5rB,MAAM,OAElB0uD,EAAW,SAAUS,GACrB,OAAO,SAASzsD,GAEZ,SADWA,EAAKkB,OAASurD,EAM7B,CACJ,EACIpuB,EAAQ,GACH9gC,EAAE,EAAEC,EAAKkT,EAAMjT,OAAOF,EAAEC,EAAKD,GAAG,EACrC8gC,EAAM39B,KAAKsrD,EAASt7C,EAAMnT,KAE9BxB,KAAKsiC,MAAM39B,KAAK1D,EAAM0C,IAAID,MAAMg3C,IAAI16C,KAAMiB,EAAOqhC,GACrD,EAEAjjC,EAAI6jB,WAAW,aAAe,SAAUjiB,EAAOksB,GAE3C,IAAI1L,EAKJ,GANKzhB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAE/BtiC,KAAKmjB,UAAYgK,EAAI5rB,MAAM,OAC3BvB,KAAKwuD,eAAiBxuD,KAAKmjB,UAAU3f,QAGjC,UAAYxD,KAAK0F,MAAQ1F,KAAKmjB,UAAU,GACxCnjB,KAAK8R,QAAQ2a,KAAOzsB,KAAKmjB,UAAU,QAChC,GAAI,CAAC,QAAS,OAAQ,OAAQ,UAAUpgB,QAAQ/C,KAAK0F,OAAS,EASjE+b,EAAO,SAAUxgB,EAAOgD,EAAMf,GAE1B,IAAK,IAAI1B,EAAIxB,KAAKmjB,UAAUzhB,OAAS,EAAGF,GAAK,EAAGA,IAAM,EAClDxB,KAAKmjB,UAAUnY,MAEVxJ,EAAE,EAAX,IAAK,IAAQC,EAAKzB,KAAKwuD,eAAe9sD,OAAOF,EAAEC,EAAKD,KAEa,IAAzDP,EAAMhB,IAAIkgC,UAAUp9B,QAAQ/C,KAAKwuD,eAAehtD,KAIhDxB,KAAKmjB,UAAUxe,KAAK3E,KAAKwuD,eAAehtD,IAExCP,EAAMhB,IAAI6uD,sBACV7tD,EAAMhB,IAAIkgC,UAAUx7B,KAAK3E,KAAKwuD,eAAehtD,GAGzD,EACAxB,KAAK0gB,MAAM/b,KAAK8c,GAGhBA,EAAO,SAAUxgB,EAAOgD,EAAMf,GAE1B,IADA,IAAIomB,GAAS,EACJ9nB,EAAE,EAAEC,EAAKzB,KAAKmjB,UAAUzhB,OAAOF,EAAEC,EAAKD,IAAK,CAChD,IAAI6V,EAAWrX,KAAKmjB,UAAU3hB,GAC9B,GAAI,CAAC,YAAa,aAAauB,QAAQsU,IAAa,GAC7C,iBAAoBpT,EAAKoT,IACzB,UAAYrX,KAAK0F,KAAM,CAO1B,IAAIirD,GAAU,EACVC,EAAW3sD,EAAKoT,GAAU9V,MAAM,WAChCsvD,EAAgB,CAAC,EACrB,GAAI5sD,EAAKwH,OAASxH,EAAKwH,MAAMC,MAAM2L,GAC/B,IAAK,IAAI8zC,KAAWlnD,EAAKwH,MAAMC,MAAM2L,GAEjC,GADAw5C,EAAc1F,GAAWlnD,EAAKwH,MAAMC,MAAM2L,GAAU8zC,GAAS5pD,MAAM,WAC/DsvD,EAAc1F,GAASzpD,SAAWkvD,EAASlvD,OAAQ,CACnDivD,GAAU,EACV,KACJ,CAGHA,IACDC,EAAW,CAAC3sD,EAAKoT,IACjBw5C,EAAgB5sD,EAAKwH,MAAMC,MAAM2L,IAErC,IAAK,IAAIvU,EAAI,EAAG4B,EAAOksD,EAASlvD,OAAQoB,EAAI4B,EAAM5B,IAAK,CACnD,IAAIguD,EAAgB,CAChBrrD,QAAQmrD,EAAS9tD,GACjB2I,MAAM,CACFojB,KAAK,CAAC,IAGd,IAAK,IAAIs8B,KAAW0F,EAAe,CAC/B,IAAIE,EAAe,CACftrD,QAAQorD,EAAc1F,GAASroD,IAEnCguD,EAAcrlD,MAAMojB,KAAKs8B,GAAW4F,CACxC,CACAH,EAAS9tD,GAAKguD,CAClB,CACA7sD,EAAKoT,GAAYu5C,CACrB,CAQA,GAP0B,UAAtB5wD,KAAK8R,QAAQ4a,MAAqBzoB,EAAKoT,KACtB,UAAbA,EACAA,EAAW,cACS,oBAAbA,IACPA,EAAW,0BAGF,gBAAbA,EAA4B,CAK5BiS,GAAS,EACT,KACJ,CAAO,GAAIjqB,EAAI+F,eAAerC,QAAQsU,IAAa,EAAG,CAClD,GAAIpW,EAAMC,IAAIiC,uBAAuBC,2BAA6B,iBAAmBiU,EAAU,CAE3FiS,GAAS,EACT,KACJ,CACA,GAAIrlB,EAAKoT,GAAW,CAChB,IAAK,IAAIpS,KAAOhB,EAAKoT,GACjB,KAAqC,IAAjCrX,KAAK6tB,UAAU9qB,QAAQkC,IAAe,YAAcA,IAGpDhB,EAAKoT,GAAUpS,GAAM,CACrBqkB,GAAS,EACT,KACJ,CAEJ,GAAIA,EACA,KAER,CACJ,KAAO,IAAI,YAAcjS,EAAU,CAC3BnU,GAAQA,EAAKG,UACbimB,GAAS,GAEb,KACJ,CAAO,GAAI,kBAAoBjS,EAAU,CACjCnU,GAAQA,EAAK,mBACbomB,GAAS,GAEb,KACJ,CAAO,GAAI,CAAC,kBAAkB,kBAAkBvmB,QAAQsU,IAAa,EAAG,CACpEiS,GAAS,EACT,KACJ,CAAO,GAAI,gCAAkCjS,EAAU,CAC/CnU,GAAQA,EAAK,iCACbomB,GAAS,GAEb,KACJ,CAAO,GAAI,0CAA4CjS,EAAU,CACzDnU,GAAQA,EAAK,2CACbomB,GAAS,GAEb,KACJ,CAAO,GAAI,gBAAkBjS,EAAU,CAC/BpW,EAAMknB,UAAU4H,QAAiB,QAAE5tB,YAAY8B,EAAKoqB,KACjDptB,EAAM2S,IAAIsU,iBACVjkB,EAAKoqB,KAER/E,GAAS,GAEb,KACJ,CAAO,GAAI,iBAAoBrlB,EAAKoT,GAChC,MACG,GAAI,iBAAoBpT,EAAKoT,IAAapT,EAAKoT,GAAW,CAC7DiS,GAAS,EACT,KACJ,CAAO,GAAI,iBAAoBrlB,EAAKoT,GAAW,CAC3CiS,GAAS,EACT,KACJ,EACA,GAAIA,EACA,KAER,CAGA,GAAIA,EAAQ,CACR,IAAS9nB,EAAE,EAAEC,EAAKzB,KAAKwuD,eAAe9sD,OAAOF,EAAEC,EAAKD,IAAK,CAEpC,qBADb6V,EAAWrX,KAAKwuD,eAAehtD,KACsB,iBAAnBP,EAAMhB,IAAIoN,OAC5CpM,EAAMhB,IAAI+sB,sBAAuB,GAGrC/rB,EAAMhB,IAAImR,cAAcC,IAAIwuB,kBAAmB,EAE3C5+B,EAAMhB,IAAIu/B,eAAevuB,SACH,iBAAnBhQ,EAAMhB,IAAIoN,MACV,iBAAoBpJ,EAAKoT,KAE5BpW,EAAMhB,IAAIstC,UAAUrhC,IAAMjL,EAAMqoB,OAAO4L,QAAQjkB,QAC/ChQ,EAAMhB,IAAI4+C,cAAcl6C,KAAKV,EAAKoT,IAE1C,CACApW,EAAMhB,IAAIu/B,eAAe17B,SAAQ,EAAQzE,EAAImI,QACjD,MAEIvG,EAAMhB,IAAImR,cAAcC,IAAIuuB,kBAAmB,CAGvD,EACA5/B,KAAK0gB,MAAM/b,KAAK8c,QACb,GAAI,CAAC,KAAO,UAAW,aAAa1e,QAAQ/C,KAAK0F,OAAS,EAmC7D,IAhCA,IAAIuqD,EAAW,SAAU54C,GACrB,OAAO,SAASpT,EAAKf,GACjB,IAAIgtD,EAASjsD,EAOb,GANIf,GAAQ,CAAC,UAAW,gBAAiB,8BAA+B,wCAAyC,gBAAgBH,QAAQsU,IAAa,IAClJ64C,EAAShtD,GAKI,gBAAbmU,GAA8BpW,EAAM2S,IAAIsU,iBAAmBgoC,EAAO7hC,IAClE,GAAIptB,EAAMknB,UAAU4H,QAAiB,QAAE5tB,YAAY+tD,EAAO7hC,IACtD,OAAO,OAER,GAAI6hC,EAAO74C,GAAW,CACzB,GAAI,iBAAoB64C,EAAO74C,IAAa,iBAAoB64C,EAAO74C,GACnE,OAAO,EACJ,GAAI,iBAAoB64C,EAAO74C,GAMlC,IAAK,IAAIpS,KAAOirD,EAAO74C,GACnB,GAAI64C,EAAO74C,GAAUpS,GACjB,OAAO,CAIvB,CACA,OAAO,CACX,CACJ,EACSzD,EAAE,EAAEC,EAAKzB,KAAKmjB,UAAUzhB,OAAOF,EAAEC,EAAKD,GAAG,EAC9CxB,KAAKsiC,MAAM39B,KAAKsrD,EAASjwD,KAAKmjB,UAAU3hB,IAGpD,EAGAnC,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GAClCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IA2B/B,IA1BA,IAAI8tB,EAAYjjC,EAAIrpB,QAAQ,YAAa,aAGrCmsD,EAAW,SAAUI,GACrB,OAAO,SAASpsD,GACZ,IAAIysB,EAcJ,OAbAzvB,EAAM6sD,eAAc,EAAO7pD,EAAM,OAAQA,EAAKkB,MAI1CurB,EAHCzvB,EAAMhB,IAAI8wB,eAAe/B,KAAK0B,MAEgB,cAAxCzvB,EAAMhB,IAAI8wB,eAAe/B,KAAK0B,MAC7B,YAEAzvB,EAAMhB,IAAI8wB,eAAe/B,KAAK0B,MAJ9B,OAMRzvB,EAAMhB,IAAI8wB,eAAe/B,KAAKgC,OAAOtvB,OAAS,GAC1CT,EAAMhB,IAAI8wB,eAAe/B,KAAKgC,OAAO,GAAGggC,mBACxC/vD,EAAMhB,IAAI8wB,eAAe/B,KAAKgC,OAAO,GAAGigC,iBAAkB,GAG9DZ,IAAa3/B,CAKrB,CACJ,EACSlvB,EAAE,EAAEC,GAzBb2uD,EAAYA,EAAU7uD,MAAM,QAyBAG,OAAOF,EAAEC,EAAKD,GAAG,EACzCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASG,EAAU5uD,IAE3C,EAIAnC,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GACpCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAkB/B,IAjBA,IAAI8tB,EAAYjjC,EAAI5rB,MAAM,OACtB0uD,EAAW,SAASI,GACpB,OAAO,SAAUpsD,GACb,IAAIysB,EAOJ,OANAzvB,EAAM6sD,eAAc,EAAO7pD,EAAM,SAAUA,EAAKkB,MAI5CurB,EAHCzvB,EAAMhB,IAAI8wB,eAAe/uB,OAAO0uB,MAGzBzvB,EAAMhB,IAAI8wB,eAAe/uB,OAAO0uB,MAFhC,SAIR2/B,IAAa3/B,CAKrB,CACJ,EACSlvB,EAAE,EAAEC,EAAK2uD,EAAU1uD,OAAOF,EAAEC,EAAKD,GAAG,EACzCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASG,EAAU5uD,IAE3C,EAEAnC,EAAI6jB,WAAW,iBAAmB,SAAUjiB,EAAOksB,GAC1CntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAC/B,IAAI4uB,EAAmB/jC,EAAI5rB,MAAM,OAiBjCvB,KAAKsiC,MAAM39B,KAdK,SAAUusD,GACtB,OAAO,SAASjtD,GACZ,IAAKA,EAAK2O,aACN,OAAO,EAGX,IADA,IAAIA,EAAe3O,EAAK2O,aACfpR,EAAE,EAAEC,EAAKyvD,EAAiBxvD,OAAOF,EAAEC,EAAKD,IAC7C,GAAIoR,IAAiBs+C,EAAiB1vD,GAClC,OAAO,EAGf,OAAO,CACX,CACJ,CACgB2vD,CAAUD,GAC9B,EAEA7xD,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GACrCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAC/B,IAAI8uB,EAAejkC,EAAI5rB,MAAM,OAiB7BvB,KAAKsiC,MAAM39B,KAdK,SAAUysD,GACtB,OAAO,SAASntD,GACZ,IAAKA,EAAK3B,QACN,OAAO,EAGX,IADA,IAAIA,EAAU2B,EAAK3B,QACVd,EAAE,EAAEC,EAAK2vD,EAAa1vD,OAAOF,EAAEC,EAAKD,IACzC,GAAIc,IAAY8uD,EAAa5vD,GACzB,OAAO,EAGf,OAAO,CACX,CACJ,CACgB2vD,CAAUC,GAC9B,EAEA/xD,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GACrCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/BtiC,KAAKsiC,MAAM39B,MAXA,WACP,MAAI,CAAC,eAAgB,YAAY5B,QAAQoqB,IAAQ,EACxClsB,EAAMhB,IAAIoN,KAAK7J,MAAM,EAAG2pB,EAAIzrB,UAC1ByrB,EAIA,gBAAkBA,IAChBlsB,EAAMhB,IAAIo/C,uBADhB,CAGX,GAEJ,EAEAhgD,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAC3CntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/B,IAXA,IAAI+uB,EAAWlkC,EAAI5rB,MAAM,OACrB0uD,EAAW,SAAUqB,GACrB,OAAO,SAASrtD,GACZ,IAAIyiB,EAAOziB,EAAKqtD,GAChB,SAAK5qC,GAAQA,EAAKd,OAASc,EAAKkyB,OAKpC,CACJ,EACSp3C,EAAE,EAAEC,EAAK4vD,EAAS3vD,OAAOF,EAAEC,EAAKD,GAAG,EACxCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASoB,EAAS7vD,IAE1C,EAEAnC,EAAI6jB,WAAW,2BAA6B,SAAUjiB,EAAOksB,GACpDntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/B,IAXA,IAAI+uB,EAAWlkC,EAAI5rB,MAAM,OACrB0uD,EAAW,SAAUqB,GACrB,OAAO,SAASrtD,GACZ,IAAIyiB,EAAOziB,EAAKqtD,GAChB,SAAK5qC,IAAUA,EAAKd,QAAUc,EAAKkyB,QAAWlyB,EAAKb,IAKvD,CACJ,EACSrkB,EAAE,EAAEC,EAAK4vD,EAAS3vD,OAAOF,EAAEC,EAAKD,GAAG,EACxCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASoB,EAAS7vD,IAE1C,EAEAnC,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GACrCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/B,IAXA,IAAI+uB,EAAWlkC,EAAI5rB,MAAM,OACrB0uD,EAAW,SAAUqB,GACrB,OAAO,SAASrtD,GACZ,IAAIyiB,EAAOziB,EAAKqtD,GAChB,SAAK5qC,IAASA,EAAKb,IAKvB,CACJ,EACSrkB,EAAE,EAAEC,EAAK4vD,EAAS3vD,OAAOF,EAAEC,EAAKD,GAAG,EACxCxB,KAAKsiC,MAAM39B,KAAKsrD,EAASoB,EAAS7vD,IAE1C,EAEAnC,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GACvCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IA2B/BtiC,KAAKsiC,MAAM39B,MA1BA,SAAUV,GACjB,IAAIstD,EAAWttD,EAAKkpB,GACpB,GAAIokC,GAAYA,EAAS7vD,OAAQ,CAI7B,IAHA,IAAIi8B,EAAU,EACVC,EAAe,EACf4zB,GAAiB,EACZhwD,EAAI,EAAGC,EAAO8vD,EAAS7vD,OAAQF,EAAIC,EAAMD,GAAK,EAC/CP,EAAMC,IAAIiC,uBAAuBy7B,mCAC7B2yB,EAAS/vD,GAAGiE,SAAY8rD,EAAS/vD,GAAGyhD,eAAiBsO,EAAS/vD,GAAGmE,SAAW4rD,EAAS/vD,GAAGoE,QAC5Fg4B,GAAgB,EAChB4zB,GAAiB,IAEjB7zB,GAAW,EACX6zB,GAAiB,GAGzB,GAAI7zB,EAAU,EACV,OAAO,EACJ,GAAIC,EAAe,EACtB,OAAO,EACJ,GAAIA,GAAgB4zB,EACvB,OAAO,CAEf,CACA,OAAO,CACX,GAEJ,EAEAnyD,EAAI6jB,WAAW,gBAAkB,SAAUjiB,EAAOksB,GACzCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAS/BtiC,KAAKsiC,MAAM39B,MARA,SAAUV,GAGjB,OAFW,GAAKA,EAAKkpB,IACP5rB,MAAM,gIACZG,OAAS,CAIrB,GAEJ,EAKArC,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GAEzC,IAAS/F,EAAU7kB,EAAMjB,EADpBtB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAG/B,IAAIwZ,EAAiB76C,EAAMC,IAAI,kBAAkB,GAEjD,GAAkB,WAAdlB,KAAK0F,KAAmB,CAGxB,GADA1F,KAAKy+C,WAAatxB,EACdntB,KAAK4iB,YAAcvjB,EAAI0H,MAAO,CACzB9F,EAAMC,IAAI6tB,eACX9tB,EAAMC,IAAI6tB,aAAe,IAE7B,IAAI0iC,EAAc,GAIdC,EAAUvkC,EAAI5rB,MAAM,OACpBowD,EAAc,CAAC,EACfC,EAAevyD,EAAImrB,cAAcknC,EAAQ,GAAI5V,GACjD2V,EAAY9sD,KAAKitD,GACbA,EAAazd,QACbwd,EAAYC,EAAazd,SAAWyd,EAAannC,KAEjDknC,EAAYC,EAAannC,MAAQmnC,EAAannC,KAElD,IAAK,IAAIjpB,EAAE,EAAEC,EAAKiwD,EAAQhwD,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAC1C,IAAIqwD,EAAgBxyD,EAAImrB,cAAcknC,EAAQlwD,GAAIs6C,GAClD2V,EAAY9sD,KAAKktD,GACbA,EAAc1d,QACdwd,EAAYE,EAAc1d,SAAWyd,EAAannC,KAElDknC,EAAYE,EAAcpnC,MAAQmnC,EAAannC,IAGvD,CACAxpB,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI4hC,aAAan+B,KAAKgtD,GAC9C1wD,EAAMC,IAAI6tB,aAAapqB,KAAK8sD,EAChC,CACAxwD,EAAMC,IAAIk9B,mBAAoB,CAClC,KAAO,CAIH98B,EAAM6rB,EAAI5rB,MAAM,OAGhB,IAAIuwD,EAAe,GACnB,IAAKtwD,EAAI,EAAGC,EAAOH,EAAII,OAAQF,EAAIC,EAAMD,GAAK,EAE1Ce,EAAOjB,EAAIE,GAGX4lB,EAAW/nB,EAAImrB,cAAcjoB,EAAMu5C,GACb,IAAlBx6C,EAAIE,GAAGE,QAEPowD,EAAantD,KAAKyiB,EAAS8sB,MAI/BjzC,EAAM0pB,gBAAgBvD,GAAU,GAGhC9lB,EAAIE,GAAK4lB,EAGb,IAAIm4B,EAAcj+C,EAAIkC,QAoCtBxD,KAAKsiC,MAAM39B,KAhCI,SAAU46C,EAAazD,EAAegW,GACjD,OAAO,SAAU7tD,GACb,IAAIgQ,EACE,GACNA,GAAM,EACN,IAAImT,EAEA7kB,EAOJ,IAHIA,EAHC0B,EAAK6qB,SAGC7qB,EAAK6qB,SAFLgtB,EAIX10B,EAAW/nB,EAAImrB,cAAcjoB,EAAMu5C,GAC9Bt6C,EAAI,EAAGC,EAAO89C,EAAY79C,OAAQF,EAAIC,EAAMD,GAAK,EAClD,GAAI4lB,EAASqD,OAAS80B,EAAY/9C,GAAGipB,KAAM,CACvCxpB,EAAMhB,IAAIkhC,2BAA2Bx8B,KAAK1D,EAAMhB,IAAIghC,mBACpDhgC,EAAMhB,IAAIihC,uBAAuBv8B,KAAK1D,EAAMC,IAAIqB,MAChDtB,EAAMC,IAAIqB,KAAOg9C,EAAY,GAAG90B,KAChCxW,GAAM,EACN,KACJ,CAQJ,OANKA,GAAO69C,EAAa/uD,QAAQqkB,EAAS8sB,OAAS,IAC/CjzC,EAAMhB,IAAIkhC,2BAA2Bx8B,KAAK1D,EAAMhB,IAAIghC,mBACpDhgC,EAAMhB,IAAIihC,uBAAuBv8B,KAAK1D,EAAMC,IAAIqB,MAChDtB,EAAMC,IAAIqB,KAAOg9C,EAAY,GAAG90B,KAChCxW,GAAM,GAEHA,CACX,CACJ,CACgBg8C,CAAS1Q,EAAYzD,EAAegW,GACxD,CACJ,EAEAzyD,EAAI6jB,WAAW,8BAAgC,SAAUjiB,GAChDjB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAO/BtiC,KAAKsiC,MAAM39B,MALA,WACH,OAAQ1D,EAAMhB,IAAIo/C,iBACtB,GAIR,EAEAhgD,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAElD,IAAI/F,EAAU7kB,EAAMjB,EAAKE,EAAGC,EAQxB,IATCzB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAK3BhhC,EAAM6rB,EAAI5rB,MAAM,OAGhBvB,KAAK8xD,aAAe,GACftwD,EAAI,EAAGC,EAAOH,EAAII,OAAQF,EAAIC,EAAMD,GAAK,EAE1Ce,EAAOjB,EAAIE,GAGX4lB,EAAW/nB,EAAImrB,cAAcjoB,EAAMtB,EAAMC,IAAI,kBAAkB,IACzC,IAAlBI,EAAIE,GAAGE,QAEP1B,KAAK8xD,aAAantD,KAAKyiB,EAAS8sB,MAGpCjzC,EAAM0pB,gBAAgBvD,GAGtB9lB,EAAIE,GAAK4lB,EAGbpnB,KAAK87C,eAAiB76C,EAAMC,IAAI,kBAAkB,GAElDlB,KAAK2C,OAASrB,EAAI,GAAGmpB,KAErBzqB,KAAKu/C,YAAcj+C,EAAIkC,QAgDvBxD,KAAKsiC,MAAM39B,KA5CI,SAAU4Z,GACrB,OAAO,SAAUta,GACb,IAASgQ,EAETA,GAAM,EACN,IAAImT,GAAW,EAQf,GAPInjB,EAAK6qB,WACLvsB,EAAO0B,EAAK6qB,UACZ1H,EAAW/nB,EAAImrB,cAAcjoB,EAAMtB,EAAMC,IAAI,kBAAkB,KAClDupB,OAASxpB,EAAMC,IAAI,kBAAkB,KAC9CkmB,GAAW,IAGfA,EAAU,CAOV,IAAK5lB,EAAI,EAAGC,EAAO8c,EAAGghC,YAAY79C,OAAQF,EAAIC,EAAMD,GAAK,EACrD,GAAI4lB,EAASqD,OAASlM,EAAGghC,YAAY/9C,GAAGipB,KAAM,CAC1CxpB,EAAMC,IAAIqB,KAAOgc,EAAG5b,OACpB1B,EAAMhB,IAAIouC,iBAAmB9vB,EAAG5b,OAEhC1B,EAAMqoB,OAAO0M,UAAU,SACvB/0B,EAAMqoB,OAAO4L,QAAQjkB,QAAQ8mB,WAAaxZ,EAAG5b,OAC7CsR,GAAM,EACN,KACJ,EAECA,GAAOsK,EAAGuzC,aAAa/uD,QAAQqkB,EAAS8sB,OAAS,IAClDjzC,EAAMC,IAAIqB,KAAOgc,EAAG5b,OACpB1B,EAAMhB,IAAIouC,iBAAmB9vB,EAAG5b,OAEhC1B,EAAMqoB,OAAO0M,UAAU,SACvB/0B,EAAMqoB,OAAO4L,QAAQjkB,QAAQ8mB,WAAaxZ,EAAG5b,OAC7CsR,GAAM,EAEd,CACA,OAAOA,CACX,CACJ,CAEgBg8C,CADPjwD,MAEjB,EAGAX,EAAI6jB,WAAW,gBAAkB,SAAUjiB,EAAOksB,GACzCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAY/B,IAXH,IAAIyvB,EAAa5kC,EAAI5rB,MAAM,OACpB0uD,EAAW,SAAU+B,GACrB,OAAO,SAAS/tD,GAEZ,OADU5E,EAAImT,gBAAgBvR,EAAOgD,KACzB+tD,CAKhB,CACJ,EACSxwD,EAAE,EAAEC,EAAKswD,EAAWrwD,OAAQF,EAAEC,EAAMD,IACzCxB,KAAKsiC,MAAM39B,KAAKsrD,EAAS8B,EAAWvwD,IAE5C,EAEAnC,EAAI6jB,WAAW,uBAAyB,SAAUjiB,EAAOksB,GAChDntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAClC,IAAI2vB,EAAS,SAAW9kC,EAWrBntB,KAAKsiC,MAAM39B,KAVI,SAAUstD,GACrB,OAAO,SAAShuD,GACZ,OAAKhD,EAAMhB,IAAI2wC,qBAAqB3sC,EAAKyrB,eAE9BzuB,EAAMhB,IAAI2wC,qBAAqB3sC,EAAKyrB,cAAgB,EACpDuiC,GAFCA,CAKhB,CACJ,CACgBhC,CAASgC,GAC7B,EAEA5yD,EAAI6jB,WAAW,yBAA2B,SAAUjiB,EAAOksB,GAClDntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAClC,IAAI2vB,EAAS,SAAW9kC,EASrBntB,KAAKsiC,MAAM39B,KARI,SAAUstD,GACrB,OAAO,SAAShuD,GACZ,OAAIhD,EAAMhB,IAAI6wC,mBAAmB7sC,EAAKyrB,cAAgB,EAC3CuiC,GAEHA,CACZ,CACJ,CACgBhC,CAASgC,GAC7B,EAEA5yD,EAAI6jB,WAAW,gBAAkB,SAAUjiB,EAAOksB,GACzCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAC/B,IAAwB4vB,EAgBxBlyD,KAAKsiC,MAAM39B,MAhBautD,EAgBC/kC,EAfd,SAAUlpB,GACb,IAAIkuD,EAAgB,EACpB,IAAK,IAAI3wD,KAAKyC,EAAKiuD,GAAU,CACzB,IAAIxsD,EAAOzB,EAAKiuD,GAAS1wD,GACzB,IAAKkE,EAAKE,MAAO,CACb,IACIlE,GADcgE,EAAKD,QAAUC,EAAKD,QAAUC,EAAKC,QAC5BpE,MAAM,KAAKG,QACd,IAAlBywD,GAAuBzwD,EAASywD,KAChCA,EAAgBzwD,EAExB,CACJ,CACA,OAAQywD,EAAgB,CAC5B,GAGR,EAEA9yD,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GACvCntB,KAAKsiC,QAAQtiC,KAAKsiC,MAAQ,IAC/B,IAAwB8vB,EAQxBpyD,KAAKsiC,MAAM39B,MARaytD,EAQCjlC,EAPd,SAAUlpB,GACb,OAAIA,EAAK,eAAiBmuD,CAI9B,GAGR,EAEA/yD,EAAI6jB,WAAW,uCAAyC,SAAUjiB,EAAOksB,GACxElsB,EAAMC,IAAIm9B,mCAAqClR,EAAI5rB,MAAM,MAC1D,EAEAlC,EAAI6jB,WAAW,2BAA6B,SAAUjiB,EAAOksB,GACzD9tB,EAAI6jB,WAAW,qBAAqBjiB,EAAOksB,GAC3C,IAAIuE,EAAOvE,EAAI5rB,MAAM,OACrBN,EAAMioB,aAAahoB,IAAI2vC,uBAAyBnf,CACpD,EAEAryB,EAAI6jB,WAAW,qBAAuB,SAAUjiB,EAAOksB,GACnD,IAAIuE,EAAOvE,EAAI5rB,MAAM,OAChBN,EAAMioB,aAAahoB,IAAIuuB,wBACxBxuB,EAAMioB,aAAahoB,IAAIuuB,sBAAwB,IAE9CxuB,EAAMioB,aAAahoB,IAAI2vC,yBACxB5vC,EAAMioB,aAAahoB,IAAI2vC,uBAAyB,IAEpD5vC,EAAMioB,aAAahoB,IAAIuuB,sBAAwBxuB,EAAMioB,aAAahoB,IAAIuuB,sBAAsB3pB,OAAO4rB,EACvG,EAIAryB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACjDlsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5B,IAAI69C,EAAOllC,EAAI5rB,MAAM,OAKrB,IAAK,IAAIC,KAJJP,EAAMC,IAAIoxD,eACXrxD,EAAMC,IAAIoxD,aAAe,CAAC,GAE9BtyD,KAAKggC,eAAiB,CAAC,EACTqyB,EAAM,CAChB,IAAIhR,EAAIgR,EAAK7wD,GACbxB,KAAKggC,eAAeqhB,IAAK,EACzBpgD,EAAMC,IAAIoxD,aAAajR,IAAK,CAChC,CACJ,EACAhiD,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAChDlsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5B,IAAI69C,EAAOllC,EAAI5rB,MAAM,OAKrB,IAAK,IAAIC,KAJJP,EAAMC,IAAIoxD,eACXrxD,EAAMC,IAAIoxD,aAAe,CAAC,GAE9BtyD,KAAKigC,cAAgB,CAAC,EACRoyB,EAAM,CAChB,IAAIhR,EAAIgR,EAAK7wD,GACbxB,KAAKigC,cAAcohB,IAAK,EACxBpgD,EAAMC,IAAIoxD,aAAajR,IAAK,CAChC,CACJ,EACAhiD,EAAI6jB,WAAW,2BAA6B,SAAUjiB,EAAOksB,GACzDlsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5B,IAAI69C,EAAOllC,EAAI5rB,MAAM,OACrBvB,KAAKk6C,uBAAyB,CAAC,EAC/B,IAAK,IAAI14C,EAAE,EAAEC,EAAK4wD,EAAK3wD,OAAOF,EAAEC,EAAKD,IACjCxB,KAAKk6C,uBAAuBmY,EAAK7wD,KAAM,CAE/C,EACAnC,EAAI6jB,WAAW,gCAAkC,SAAUjiB,EAAOksB,GAC9DlsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5BxU,KAAK8R,QAAQioC,gCAAkC5sB,CACnD,EACA9tB,EAAI6jB,WAAW,4CAA8C,SAAUjiB,EAAOksB,GAC1ElsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5BxU,KAAK8R,QAAQkoC,4CAA8C7sB,CAC/D,EACA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5ClsB,EAAMC,IAAIqT,SAASC,QAAS,EAC5B,IAAI69C,EAAOllC,EAAI5rB,MAAM,OAKrB,IAAK,IAAIC,KAJJP,EAAMC,IAAIoxD,eACXrxD,EAAMC,IAAIoxD,aAAe,CAAC,GAE9BtyD,KAAKiqC,aAAe,CAAC,EACPooB,EAAM,CAChB,IAAIhR,EAAIgR,EAAK7wD,GACbxB,KAAKiqC,aAAaoX,IAAK,EACvBpgD,EAAMC,IAAIoxD,aAAajR,IAAK,CAChC,CACJ,EAEAhiD,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GAC1ClsB,EAAMC,IAAIgQ,uBAAwB,EAClClR,KAAK8R,QAAQ4nC,QAAUvsB,CAU3B,EAEA9tB,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GACzClsB,EAAMC,IAAIgQ,uBAAwB,EAClClR,KAAK8R,QAAQ2nC,OAAStsB,CAU1B,EAEA9tB,EAAI6jB,WAAW,4BAA8B,SAAUjiB,EAAOksB,GAC1DlsB,EAAMC,IAAIkR,wBAA0B+a,CACxC,EAEA9tB,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GACzCntB,KAAK4sB,OAASO,CAClB,EAEA9tB,EAAI6jB,WAAW,UAAY,SAAUjiB,EAAOksB,GAWxCntB,KAAK4hB,MAAQjJ,SAASwU,EAAK,GAC/B,EAEA9tB,EAAI6jB,WAAW,wBAA0B,SAAUjiB,EAAOksB,GACtDntB,KAAK8R,QAAQygD,6BAA+BplC,CAChD,EAEA9tB,EAAI6jB,WAAW,8BAAgC,SAAUjiB,EAAOksB,GAC5DntB,KAAK8R,QAAQynC,mCAAqCpsB,CACtD,EAEA9tB,EAAI6jB,WAAW,eAAiB,SAAUjiB,EAAOksB,GAC7CntB,KAAK8R,QAAQwnC,oBAAsBnsB,CACvC,EAEA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACjDntB,KAAK8R,QAAQ,kBAAoBqb,CACrC,EAEA9tB,EAAI6jB,WAAW,wBAA0B,SAAUjiB,EAAOksB,GACtDntB,KAAK,uBAAyBmtB,CAClC,EAEA9tB,EAAI6jB,WAAW,qBAAuB,SAAUjiB,EAAOksB,GACnDntB,KAAK,oBAAsBmtB,CAC/B,EAEA9tB,EAAI6jB,WAAW,UAAY,SAAUjiB,EAAOksB,GACxClsB,EAAMC,IAAW,MAAIisB,CACzB,EAEA9tB,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GAC1ClsB,EAAMC,IAAI+oB,QAAUkD,CACxB,EAOA9tB,EAAI6jB,WAAW,UAAY,SAAUjiB,EAAOksB,GACxCntB,KAAK8R,QAAQb,MAAQkc,CACzB,EAWA9tB,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GACvCntB,KAAK8R,QAAQpM,KAAOynB,CACxB,EASA9tB,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GACvCntB,KAAK8R,QAAQ4a,KAAOS,CACxB,EAEA9tB,EAAI6jB,WAAW,eAAiB,SAAUjiB,EAAOksB,GAC7CntB,KAAK8R,QAAQ,cAAgBqb,CACjC,EAEA9tB,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAClDntB,KAAK8R,QAAQ,mBAAqBqb,CACtC,EASA9tB,EAAI6jB,WAAW,UAAY,SAAUjiB,EAAOksB,GACxCntB,KAAKihB,gBAAkBkM,CAC3B,EAQA9tB,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GAEnCntB,KAAK8R,QAAQ2a,KADL,cAARU,EACoB,YAEAA,CAE5B,EAWA9tB,EAAI6jB,WAAW,UAAY,WAAa,EAUxC7jB,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GACnCA,IACAlsB,EAAMsgB,MAAMhf,KAAO4qB,EAE3B,EAIA9tB,EAAI6jB,WAAW,UAAY,WAAa,EAGxC7jB,EAAI6jB,WAAW,mBAAqB,WAChCljB,KAAK,mBAAoB,CAC7B,EAOAX,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GACzCntB,KAAK8R,QAAQrL,OAAS0mB,CAC1B,EAQA9tB,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GACzCntB,KAAK8R,QAAQ9L,OAASmnB,CAC1B,EAQA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5CntB,KAAK8R,QAAQ+F,UAAYsV,CAC7B,EAMA9tB,EAAI6jB,WAAW,UAAY,SAAUjiB,EAAOksB,GACxCntB,KAAK0D,MAAQypB,CACjB,EAGA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5C,IAAIjoB,EAAMyT,SAASwU,EAAK,IACpBlsB,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,IAClDjE,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,GAEtDlF,KAAK8R,QAAQ,aAAe5M,CAChC,EAEA7F,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAClDntB,KAAK8R,QAAQ,mBAAqB6G,SAASwU,EAAK,GACpD,EAEA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GAE7CntB,KAAK8R,QAAQ,kBADL,SAARqb,CAKR,EAEA9tB,EAAI6jB,WAAW,SAAW,SAAUjiB,EAAOksB,GAC3B,eAARA,IACAntB,KAAK8R,QAAQoP,eAAiB7hB,EAAIsI,WAE1C,EAEAtI,EAAI6jB,WAAW,WAAa,SAAUjiB,EAAOksB,GAGrC,WAAaA,GAAO,SAAWA,EAC/BntB,KAAK8R,QAAQ6a,OAAS,EACf,UAAYQ,GAAO,UAAYA,EACtCntB,KAAK8R,QAAQ6a,OAAS,EACf,eAAiBQ,IACxBntB,KAAK8R,QAAQ6a,QAAS,EAE9B,EAEAttB,EAAI6jB,WAAW,sCAAwC,WACnDljB,KAAK8R,QAAQ,sCAAuC,CACxD,EAEAzS,EAAI6jB,WAAW,sCAAwC,SAAUjiB,EAAOksB,GACpEntB,KAAK8R,QAAQ,qCAAuCqb,CACxD,EAEA9tB,EAAI6jB,WAAW,wBAA0B,SAAUjiB,EAAOksB,GACtDntB,KAAK8R,QAAQ,uBAAyBqb,CAC1C,EAEA9tB,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAChDntB,KAAK8R,QAAQ,iBAAmBqb,CACpC,EAEA9tB,EAAI6jB,WAAW,kCAAoC,SAAUjiB,EAAOksB,GAC5D9tB,EAAI6J,+BAA+BnG,QAAQoqB,IAAQ,IACnDlsB,EAAM+nB,SAAS9nB,IAAI,iCAAmCisB,EAE9D,EAEA9tB,EAAI6jB,WAAW,aAAe,SAAUjiB,EAAOksB,GAEvCA,IACAlsB,EAAMjB,KAAK0F,MAAMxE,IAAIuhC,SAAWtV,EAExC,EAEA9tB,EAAI6jB,WAAW,yBAA2B,SAAUjiB,EAAOksB,GACnDA,IACAlsB,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI0pC,qBAAuBzd,EAEzD,EAIA9tB,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAClDlsB,EAAMivB,OAAOlwB,KAAM,kBAAmBmtB,EAC1C,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5ClsB,EAAMivB,OAAOlwB,KAAM,YAAamtB,EACpC,EAEA9tB,EAAI6jB,WAAW,uBAAyB,SAAUjiB,EAAOksB,GACrDntB,KAAK8R,QAAQ,sBAAwBqb,CACzC,EAEA9tB,EAAI6jB,WAAW,qCAAuC,SAAUjiB,EAAOksB,GACnEntB,KAAK8R,QAAQ,oCAAsCqb,CACvD,EAGA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACjDlsB,EAAMivB,OAAOlwB,KAAM,iBAAkBmtB,EACzC,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5C,IAAIjoB,EAAMyT,SAASwU,EAAK,IACpBlsB,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,IAClDjE,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,GAEtDjE,EAAMivB,OAAOlwB,KAAM,YAAakF,EACpC,EAEA7F,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAClDlsB,EAAMivB,OAAOlwB,KAAM,kBAAmB2Y,SAASwU,EAAK,IACxD,EAEA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACrC,SAARA,EACAlsB,EAAMivB,OAAOlwB,KAAM,kBAAkB,GAErCiB,EAAMivB,OAAOlwB,KAAM,kBAAkB,EAE7C,EAEAX,EAAI6jB,WAAW,yBAA2B,SAAUjiB,EAAOksB,GACvD,IAAIjoB,EAAMyT,SAASwU,EAAK,IACpBlsB,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,IAClDjE,EAAMA,EAAMsgB,MAAMlU,MAAMnM,IAAI6hC,oBAAsB79B,GAEtDjE,EAAMivB,OAAOlwB,KAAM,uBAAwBkF,EAC/C,EAEA7F,EAAI6jB,WAAW,+BAAiC,SAAUjiB,EAAOksB,GAC7DlsB,EAAMivB,OAAOlwB,KAAM,6BAA8B2Y,SAASwU,EAAK,IACnE,EAEA9tB,EAAI6jB,WAAW,iBAAmB,SAAUjiB,EAAOksB,GAC/CntB,KAAK8R,QAAQ,gBAAkB6G,SAASwU,EAAK,GACjD,EAEA9tB,EAAI6jB,WAAW,iBAAmB,SAAUjiB,EAAOksB,GAC/CntB,KAAK8R,QAAQ,gBAAkB6G,SAASwU,EAAK,GACjD,EAGA9tB,EAAI6jB,WAAW,QAAU,SAAUjiB,EAAOksB,GACtClsB,EAAMivB,OAAOlwB,KAAM,MAAOmtB,EAC9B,EAEA9tB,EAAI6jB,WAAW,4BAA8B,SAAUjiB,EAAOksB,GAC1DlsB,EAAMivB,OAAOlwB,KAAM,0BAA2BmtB,EAClD,EAEA9tB,EAAI6jB,WAAW,6BAA+B,SAAUjiB,EAAOksB,GAC3DlsB,EAAMivB,OAAOlwB,KAAM,2BAA4BmtB,EACnD,EAEA9tB,EAAI6jB,WAAW,oBAAsB,SAAUjiB,EAAOksB,GAClDlsB,EAAMivB,OAAOlwB,KAAM,kBAAmBmtB,EAC1C,EAEA9tB,EAAI6jB,WAAW,eAAiB,SAAUjiB,EAAOksB,GACjC,UAARA,GACAlsB,EAAMivB,OAAOlwB,KAAM,cAAc,EAEzC,EAEAX,EAAI6jB,WAAW,0BAA4B,SAAUjiB,EAAOksB,GACxDntB,KAAK,yBAA2BmtB,CACpC,EAEA9tB,EAAI6jB,WAAW,uBAAyB,SAAUjiB,EAAOksB,GACnC,kBAAdntB,KAAK0F,KACL1F,KAAK,sBAAwBmtB,EAE7BlsB,EAAMivB,OAAOlwB,KAAM,qBAAsBmtB,EAEjD,EAEA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACjDlsB,EAAMivB,OAAOlwB,KAAM,iBAAkBmtB,EACzC,EAEA9tB,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GACpC,SAARA,IACAntB,KAAKggD,cAAe,EAE5B,EAEA3gD,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAChDlsB,EAAMioB,aAAahoB,IAAI4tC,cAAgB3hB,EAAI5rB,MAAM,MACrD,EAEAlC,EAAI6jB,WAAW,wBAA0B,SAAUjiB,EAAOksB,GACtDlsB,EAAMioB,aAAahoB,IAAI6tC,oBAAsB5hB,EAAI5rB,MAAM,MAC3D,EAGAlC,EAAI6jB,WAAW,0BAA4B,SAAUjiB,EAAOksB,GACxDlsB,EAAMjB,KAAK0F,MAAMxE,IAAI,yBAA2BisB,CACpD,EAEA9tB,EAAI6jB,WAAW,6BAA+B,SAAUjiB,EAAOksB,GAC3DlsB,EAAMjB,KAAK0F,MAAMxE,IAAI,4BAA8BisB,CACvD,EAEA9tB,EAAI6jB,WAAW,iCAAmC,SAAUjiB,EAAOksB,GAC/DlsB,EAAMjB,KAAK0F,MAAMxE,IAAI,gCAAkCisB,CAC3D,EAEA9tB,EAAI6jB,WAAW,sCAAwC,SAAUjiB,EAAOksB,GACpElsB,EAAMjB,KAAK0F,MAAMxE,IAAI,qCAAuCisB,CAChE,EAEA9tB,EAAI6jB,WAAW,2BAA6B,SAAUjiB,EAAOksB,GAC7C,SAARA,IACAlsB,EAAMC,IAAI,2BAA4B,EAE9C,EAEA7B,EAAI6jB,WAAW,+BAAiC,SAAUjiB,EAAOksB,GACjD,SAARA,IACAlsB,EAAMC,IAAI,+BAAgC,EAElD,EAEA7B,EAAI6jB,WAAW,iCAAmC,SAAUjiB,EAAOksB,GACnD,SAARA,GAAuC,YAArBlsB,EAAMC,IAAIC,SAC5BF,EAAMC,IAAI,iCAAkC,EAEpD,EAGA7B,EAAI6jB,WAAW,uBAAyB,SAAUjiB,EAAOksB,GACzC,UAARA,GAA2B,WAARA,IACnBlsB,EAAMjB,KAAK0F,MAAMxE,IAAI,sBAAwBisB,EAErD,EAGA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACrC,SAARA,IACIlsB,EAAMC,IAAIiC,uBAAuB27B,6BACjC79B,EAAMjB,KAAK0F,MAAMxE,IAAIkuC,cAAgB,EAErCnuC,EAAMjB,KAAK0F,MAAMxE,IAAIkuC,eAAgB,EAGjD,EAGA/vC,EAAI6jB,WAAW,iBAAmB,SAAUjiB,EAAOksB,GAC3CA,GAAOA,EAAIzpB,MAAM,eACjBzC,EAAMjB,KAAK0F,MAAMxE,IAAI,gBAAkBsxD,WAAWrlC,EAAK,IAE/D,EAGA9tB,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAC5CA,GAAOA,EAAIzpB,MAAM,eACjBzC,EAAMjB,KAAK0F,MAAMxE,IAAI,iBAAmBsxD,WAAWrlC,EAAK,IAEhE,EAGA9tB,EAAI6jB,WAAW,uBAAyB,SAAUjiB,EAAOksB,GACrDlsB,EAAMjB,KAAK0F,MAAMxE,IAAI,sBAAwByX,SAASwU,EAAK,GAC/D,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5CntB,KAAKkiD,UAAYvpC,SAASwU,EAAK,GACnC,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAa5CntB,KAAK0gB,MAAM/b,MAZA,SAAU1D,EAAOgD,GACZ,WAARkpB,EACAntB,KAAKyyD,kBAAmB,GAExBzyD,KAAK8R,QAAQ,aAAeqb,EAChB,UAARA,GACIlpB,EAAK2O,eACL5S,KAAK8R,QAAQ,aAAe,eAI5C,GAEJ,EAGAzS,EAAI6jB,WAAW,sBAAwB,SAAUjiB,EAAOksB,GACpDlsB,EAAMC,IAAI,qBAAuBisB,CACrC,EAGA9tB,EAAI6jB,WAAW,sBAAwB,SAAUjiB,EAAOksB,GACpDlsB,EAAMC,IAAI,qBAAuBisB,CACrC,EAGA9tB,EAAI6jB,WAAW,mBAAqB,SAAUjiB,EAAOksB,GACjD,GAAkB,UAAdntB,KAAK0F,KAAkB,CACvB,IAAIpE,EAAK8R,EAAKD,EAAQ1I,EAKlBhH,EACJ,GADIA,EAAI0pB,EAAIzpB,MAAM,iCAEd,IAAKyP,EAAM,EAAGC,EAAM3P,EAAE/B,OAAQyR,EAAMC,EAAKD,GAAO,EAC5C1P,EAAE0P,GAAO1P,EAAE0P,GAAKrP,QAAQ,OAAQ,IAAIA,QAAQ,KAAM,IAK1D,IADA2G,EAAM,EADNnJ,EAAM6rB,EAAI5rB,MAAM,mCACL,IACN4R,EAAM,EAAGC,EAAM9R,EAAII,OAAQyR,EAAMC,EAAKD,GAAO,EAC9C1I,EAAI9F,KAAKlB,EAAE0P,EAAM,IACjB1I,EAAI9F,KAAKrD,EAAI6R,IAIjB,IADAC,GADA9R,EAAMmJ,EAAIjH,SACA9B,OACLyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BlS,EAAMC,IAAK,UAAYI,EAAI6R,IAAOxO,KAAKrD,EAAK6R,EAAM,GAAIrP,QAAQ,QAAS,IAAIA,QAAQ,QAAS,KAE5FxC,EAAII,OACJT,EAAMC,IAAI,kBAAoBI,EAAIkC,MAAM,EAAG,GAE3CvC,EAAMC,IAAI,kBAAoB,CAAC,KAEvC,KAAmB,SAARisB,IACPntB,KAAKoe,gBAAiB,EAE9B,EAEA/e,EAAI6jB,WAAW,wBAA0B,SAAUjiB,EAAOksB,GACtDlsB,EAAMC,IAAI,uBAAyBisB,CACvC,EAEA9tB,EAAI6jB,WAAW,iCAAmC,SAAUjiB,EAAOksB,GAC/DlsB,EAAMC,IAAI,gCAAkCisB,CAChD,EAEA9tB,EAAI6jB,WAAW,2BAA6B,SAAUjiB,EAAOksB,GAC7C,UAARA,IACAlsB,EAAMC,IAAI,2BAA4B,EAE9C,EAEA7B,EAAI6jB,WAAW,sBAAwB,SAAUjiB,EAAOksB,GACpDntB,KAAK8R,QAAQ,qBAAuBqb,CACxC,EAEA9tB,EAAI6jB,WAAW,aAAe,SAAUjiB,EAAOksB,GAC/B,SAARA,IACAntB,KAAK8R,QAAQ,aAAc,EAEnC,EAEAzS,EAAI6jB,WAAW,yBAA2B,SAAUjiB,EAAOksB,GACvDntB,KAAK8R,QAAQ,wBAA0B6G,SAASwU,EAAK,GACzD,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5CntB,KAAK8R,QAAQ,aAAe6G,SAASwU,EAAK,GAC9C,EAEA9tB,EAAI6jB,WAAW,aAAe,SAAUjiB,EAAOksB,GAC3CntB,KAAK8R,QAAQ,YAAc6G,SAASwU,EAAK,GAC7C,EAEA9tB,EAAI6jB,WAAW,eAAiB,SAAUjiB,EAAOksB,GAC7CntB,KAAK8R,QAAQ,cAAgB6G,SAASwU,EAAK,GAC/C,EAEA9tB,EAAI6jB,WAAW,cAAgB,SAAUjiB,EAAOksB,GAC5CntB,KAAK8R,QAAQ,cAAoC,EAArB6G,SAASwU,EAAK,GAC9C,EAGA9tB,EAAI6jB,WAAW,kBAAoB,SAAUjiB,EAAOksB,GAC5C,SAAWA,IACXntB,KAAK8R,QAAQ,kBAAmB,EAExC,EAEAzS,EAAI6jB,WAAW,YAAc,SAAUjiB,EAAOksB,GACD,IAArClsB,EAAMioB,aAAa3G,OAAO7gB,SAC1BT,EAAMC,IAAIs9C,eAAgB,GAE9Bx+C,KAAK8R,QAAQY,IAAMya,CACvB,EAcA9tB,EAAI41B,MAAQ,SAAU/vB,EAAKO,GACvBzF,KAAKigB,QAAU,IACXxa,GAAWP,IACXlF,KAAKigB,QAAQtb,KAAKO,GAEtBlF,KAAKqR,IAAMrR,KAAKigB,QAAQ,EAC5B,EAMA5gB,EAAI41B,MAAMjgB,UAAUrQ,KAAO,SAAUO,EAAKO,GAClCA,GAAWP,EACXlF,KAAKigB,QAAQtb,KAAKO,GAElBlF,KAAKigB,QAAQtb,KAAK,IAEtB3E,KAAKqR,IAAMrR,KAAKigB,QAAQjgB,KAAKigB,QAAQve,OAAS,EAClD,EAKArC,EAAI41B,MAAMjgB,UAAUm5B,MAAQ,WACxBnuC,KAAKigB,QAAU,GACfjgB,KAAKqR,IAAM,CAAC,CAChB,EAOAhS,EAAI41B,MAAMjgB,UAAUlR,QAAU,SAAUoB,EAAKO,GAIb,IAAxBzF,KAAKigB,QAAQve,QACbrC,EAAIE,MAAM,gFAAkF2F,GAG5FlF,KAAKigB,QAASjgB,KAAKigB,QAAQve,OAAS,GADpC+D,GAAWP,EAC+BA,EAEA,GAE9ClF,KAAKqR,IAAMrR,KAAKigB,QAAQjgB,KAAKigB,QAAQve,OAAS,EAClD,EAOArC,EAAI41B,MAAMjgB,UAAUhK,IAAM,WACtB,IAAIP,EAAMzK,KAAKigB,QAAQjV,MAMvB,OALIhL,KAAKigB,QAAQve,OACb1B,KAAKqR,IAAMrR,KAAKigB,QAAQjgB,KAAKigB,QAAQve,OAAS,GAE9C1B,KAAKqR,IAAM,CAAC,EAET5G,CACX,EAQApL,EAAI41B,MAAMjgB,UAAU/D,MAAQ,WACxB,OAAOjR,KAAKigB,QAAQzc,OAAO,GAAG,EAClC,EAQAnE,EAAI41B,MAAMjgB,UAAUtT,OAAS,WACzB,OAAO1B,KAAKigB,QAAQve,MACxB,EAOArC,EAAIoV,SAAW,SAAUxT,GACrBjB,KAAKiB,MAAQA,CACjB,EAEA5B,EAAIoV,SAASO,UAAU8xB,cAAgB,SAAUvB,EAAamtB,GAG1D,GADA1yD,KAAKiB,MAAMhB,IAAIm7C,iBAAmB,KAC9B7V,EAAY7jC,OAAS,GAAzB,CAKA,IAJA,IAAIixD,EAAS,EACTC,GAAoB,EACpBC,EAAgB,GAEXrxD,EAAE,EAAEC,EAAK8jC,EAAY7jC,OAAO,EAAEF,EAAEC,EAAKD,IAAK,CAC/C,IAAIsxD,EAAWvtB,EAAY/jC,GAAG,GAC1BuxD,EAAWxtB,EAAY/jC,EAAE,GAAG,GAC5BwxD,GAAiB,EACjB7X,EAAO,CAAC,EACZ,GAAI5V,EAAY/jC,GAAG,GAAGyxD,SAAW1tB,EAAY/jC,GAAG,GAAGyxD,QAAQvxD,OAAS,IAAMkxD,EAAmB,CACzFI,GAAiB,EAEjB,IAAIE,GADJN,EAAoB,CAACrtB,EAAY/jC,GAAG,GAAG6sB,IAAIvoB,OAAOy/B,EAAY/jC,GAAG,GAAGyxD,UAC9BzvD,QAClC2vD,EAAY5tB,EAAY/hC,MAAMhC,GAClC2xD,EAAU,GAAG,GAAG5+C,SAAW,QAC3B,IAAK,IAAIzR,EAAE,EAAE4B,EAAKyuD,EAAUzxD,OAAOoB,EAAE4B,EAAK5B,IAAK,CAC3C,IAAIopC,EAASinB,EAAUrwD,GAAG,GAAGurB,GACzB+kC,EAAQF,EAAcnwD,QAAQmpC,GAOlC,GANAymB,GAAS,GACM,IAAXS,EACAT,EAAUnxD,EAAEsB,EAAE,EACNtB,EAAEsB,IAAQyiC,EAAY7jC,OAAO,IACrCixD,EAAUnxD,EAAEsB,GAEZ6vD,EAAQ,CACRE,EAAcluD,KAAK,CAACnD,EAAGmxD,IACvB,KACJ,CACIO,EAAgBA,EAAc1vD,MAAM,EAAG4vD,GAAOttD,OAAOotD,EAAc1vD,MAAM4vD,EAAM,GAEvF,CACJ,CAOA,IAAK,IAAI/lC,KAJL7rB,EAAI,GAAKwxD,IACThzD,KAAKiB,MAAMhB,IAAIm7C,iBAAiB55C,EAAE,GAAGuF,OAAQ,EAC7CisD,GAAiB,GAEDhzD,KAAKiB,MAAMC,IAAIoxD,aAC/B,GAAKQ,EAASzlC,IAAa0lC,EAAS1lC,GAG7B,GAAI,iBAAoB0lC,EAAS1lC,IAAY,iBAAoB0lC,EAAS1lC,GAAU,CAEvF,GAAgB,UAAZA,GAAuBylC,EAAS,gBAAkBC,EAAS,eAC3D,IAAIM,EAAUP,EAAS,eACnBQ,EAAUP,EAAS,oBAEnBM,EAAUP,EAASzlC,GACnBimC,EAAUP,EAAS1lC,GAGvB8tB,EAAK9tB,GADLgmC,GAAWC,CAKnB,MAAO,QAAI,IAAuBR,EAASzlC,GAAS3rB,OAAQ,CAExDy5C,EAAK9tB,IAAW,EAChB,IAAIkmC,EAAWT,EAASzlC,GAASvG,KAC7B0sC,EAAWT,EAAS1lC,GAASvG,KAC7BysC,GAAYC,GACRD,GAAYC,IACZrY,EAAK9tB,IAAW,EAG5B,KAAO,CAECgmC,EAAU18C,KAAK8X,UAAUqkC,EAASzlC,IAClCimC,EAAU38C,KAAK8X,UAAUskC,EAAS1lC,IAElC8tB,EAAK9tB,GADLgmC,IAAYC,CAKpB,MAlCInY,EAAK9tB,IAAW,EAoCnBulC,IACDzX,EAAKG,QAAS,GAEdqX,IAAWnxD,IACX25C,EAAKn0C,KAAM,EACX4rD,GAAoB,GAExB5yD,KAAKiB,MAAMhB,IAAIm7C,iBAAiBz2C,KAAKw2C,EACzC,CAOA,IAASr4C,EAAE,EAAE4B,EAAKmuD,EAAcnxD,OAAOoB,EAAE4B,EAAK5B,IAAK,CAC/C,IAAI2wD,EAAWluB,EAAYstB,EAAc/vD,GAAG,IAAI,GAAGurB,GACnDruB,KAAKiB,MAAMwS,SAASA,SAASggD,GAAUtiB,QAAS,EAChDnxC,KAAKiB,MAAMwS,SAASA,SAASggD,GAAU1jB,SAAW,GAGlD,IAFA,IAAI9kC,EAAQ4nD,EAAc/vD,GAAG,GACzBoI,EAAM2nD,EAAc/vD,GAAG,GAClBiV,EAAE9M,EAAO8M,EAAE7M,EAAK6M,IAAK,CAC1B/X,KAAKiB,MAAMhB,IAAIm7C,iBAAiBrjC,GAAGsjC,SAAU,EAC7C,IAAIqY,EAAYnuB,EAAYxtB,EAAE,GAAG,GAAGsW,GACpCkX,EAAYxtB,EAAE,GAAG,GAAGxD,SAAW,QAC/BvU,KAAKiB,MAAMwS,SAASA,SAASggD,GAAU1jB,SAASprC,KAAK+uD,EACzD,CACJ,CAzGkC,CA2GtC,EAEAr0D,EAAIoV,SAASO,UAAUkmC,aAAe,SAASzpB,GAC3C,IAAInuB,EAAMtD,KAAKiB,MAAMhB,IAAI+rC,WACzB,GAAIhsC,KAAKiB,MAAMhB,IAAIm7C,iBAAkB,CACjC,GAAI3pB,EAAOuO,gBAAkB3rB,OAAO7J,KAAKinB,EAAOuO,gBAAgBt+B,OAAS,EAAG,CACxE,IAAI3B,EAAM,CAAC,CAAC,GAAG+F,OAAO9F,KAAKiB,MAAMhB,IAAIm7C,kBACjC3wC,GAAM,EACV,IAAK,IAAI4iB,KAAWoE,EAAOuO,eAClBjgC,EAAIuD,GAAK+pB,KAAYttB,EAAIuD,GAAKyD,QAG/B0D,GAAM,GAGd,OAAOA,CACX,CACA,GAAIgnB,EAAOwO,eAAiB5rB,OAAO7J,KAAKinB,EAAOwO,eAAev+B,OAAS,EAAG,CAClE3B,EAAMC,KAAKiB,MAAMhB,IAAIm7C,iBAAiBt1C,OAAO,CAAC,CAAC,IAC/C2E,EAAM4J,OAAO7J,KAAKinB,EAAOwO,eAAev+B,OAAS,EACrD,IAAK,IAAI2rB,KAAWoE,EAAOwO,cAClBlgC,EAAIuD,GAAK+pB,KAAYttB,EAAIuD,GAAK0D,MAE/ByD,GAAM,GAGd,OAAOA,CACX,CACA,GAAIgnB,EAAOwY,cAAgB51B,OAAO7J,KAAKinB,EAAOwY,cAAcvoC,OAAS,EAAG,CAChE3B,EAAM,CAAC,CAAC,GAAG+F,OAAO9F,KAAKiB,MAAMhB,IAAIm7C,kBACjC3wC,GAAM,EACV,IAAK,IAAI4iB,KAAWoE,EAAOwY,aAClBlqC,EAAIuD,GAAK+pB,KACV5iB,GAAM,GAGd,OAAOA,CACX,CACJ,CACA,OAAO,CACX,EAKApL,EAAIgsB,KAAO,CAAC,EAEZhsB,EAAIgsB,KAAK+V,MAAQ,WAEbphC,KAAK06C,IAAM,SAAU1pC,EAAO/P,EAAOqhC,GAC/B,OAAO,SAAUr+B,EAAMf,GACnB,IAAK,IAAI1B,EAAE,EAAGC,EAAK6gC,EAAM5gC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAE/C,GADa8gC,EAAM9gC,GAAGyC,EAAMf,GAExB,OAAO,CAEf,CACA,OAAO,CACX,CACJ,EAEAlD,KAAK2zD,KAAO,SAAU3iD,EAAO/P,EAAOqhC,GAChC,OAAO,SAAUr+B,EAAMf,GACnB,IAAK,IAAI1B,EAAE,EAAEC,EAAK6gC,EAAM5gC,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAExC,GADa8gC,EAAM9gC,GAAGyC,EAAKf,GAEvB,OAAO,CAEf,CACA,OAAO,CACX,CACJ,EAEAlD,KAAK4zD,IAAM,SAAU5iD,EAAO/P,EAAOqhC,GAC/B,OAAO,SAAUr+B,EAAMf,GACnB,IAAK,IAAI1B,EAAE,EAAEC,EAAK6gC,EAAM5gC,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAExC,IADa8gC,EAAM9gC,GAAGyC,EAAKf,GAEvB,OAAO,CAEf,CACA,OAAO,CACX,CACJ,EAEAlD,UAAKq2B,GAAar2B,KAAK4zD,IAEvB5zD,KAAK6zD,KAAO,SAAU7iD,EAAO/P,EAAOqhC,GAChC,OAAO,SAAUr+B,EAAMf,GACnB,IAAK,IAAI1B,EAAE,EAAEC,EAAK6gC,EAAM5gC,OAAOF,EAAEC,EAAKD,GAAG,EAAG,CAExC,IADa8gC,EAAM9gC,GAAGyC,EAAKf,GAEvB,OAAO,CAEf,CACA,OAAO,CACX,CACJ,CAEJ,EAuDA7D,EAAI+oB,UAAY,SAAUnnB,GAKtB,SAAS6yD,EAAyBz8C,EAAUsY,EAAeokC,GACvD,IAAI9iD,EAAQ,GAef,OAdOhQ,EAAM2S,IAAIogD,eACO,YAAb38C,EAEApG,GADAA,EAAQhQ,EAAM2S,IAAIogD,aAAarkC,EAAcrvB,eAAe,GAAO,IACrDiB,MAAM,KAAK,GACL,iBAAb8V,IACPpG,EAAQhQ,EAAM2S,IAAIogD,aAAarkC,EAAcrvB,eAAe,GAAO,GAK/D2Q,EAJC8iD,EAIO,GAHA9iD,EAAM1P,MAAM,KAAKiC,MAAM,GAAG7B,KAAK,QAO/CsP,CACR,CAGA,SAASgjD,EAAWhzD,EAAOm9C,EAAKn6C,EAAMyrD,EAAQwE,EAAWC,EAAYC,GAEjE,IAEIC,EAFApjD,EAAQ,GACRqjD,EAAkBj1D,EAAI2D,qBAAqBmxD,GAE/C,IAAKG,EACD,OAAOJ,EAGX,IAAI78C,EAAW88C,EACXxkC,EAAgBukC,EAEhBjzD,EAAM2S,IAAIic,sBACVF,EAAgB1uB,EAAM2S,IAAIic,oBAAoBskC,EAAYD,IAE9D,IAAIH,GAAe,EAWnB,GAViB,iBAAb18C,GAA+BsY,IAC/BokC,GAA+C,IAAhCpkC,EAAc5sB,QAAQ,MAGrC,CAAC,eAAgB,WAAWA,QAAQoxD,IAAe,GAAKD,IAAcA,EAAU5zD,gBAChFqvB,EAAgBukC,EAAU9zD,eAK1Ba,EAAM2S,IAAIsU,gBAAiB,CAGvBmsC,EADA,CAAC,eAAgB,UAAW,gBAAiB,0BAA0BtxD,QAAQsU,IAAa,EACpE,UACjBpT,EAAK2O,aACY3O,EAAK2O,aAEL,UAE5B,IAAIA,EAAe3R,EAAMknB,UAAU2H,iBAAiBukC,EAAuBC,EAAiB3kC,EAAe1rB,EAAK6qB,UAsBhH,GAAI7tB,EAAMknB,UAAU4H,QAAQnd,GAAc0hD,IAAoB3kC,EAAe,CAEzE,IAAI4kC,EAAStzD,EAAMknB,UAAU4H,QAAQnd,GAAc0hD,GAAiB3kC,GAG5D1e,EAFiB,UAArBmtC,EAAItsC,QAAQ4a,MAAoB6nC,EAC5BR,EACQ,GAEAQ,EAGPT,EAAyBz8C,EAAUsY,EAAeokC,EAE/D,CACJ,CAmBA,OAhBK9iD,GACIhQ,EAAMC,IAAIiC,uBAAuBknB,yCAAyD,eAAdpmB,EAAKkB,OACnFuqD,IAAUzrD,EAAKyrD,KAAW0E,IAC7BnjD,EAAQhN,EAAKyrD,IAEZz+C,GAAUhQ,EAAM2S,IAAIsU,kBAAmBjnB,EAAM2S,IAAIogD,eACrD/iD,EAAQ6iD,EAAyBz8C,EAAUsY,EAAeokC,IAEtD9iD,GAAU8iD,GAAkB9yD,EAAM2S,IAAIogD,cAA6B,iBAAb38C,IACvDpG,EAAQijD,GAERjzD,EAAMC,IAAIiC,uBAAuBonB,6BAChB,UAAblT,GAAwBpG,IAAUijD,GAAajwD,EAAK,iBACpDgN,EAAQhN,EAAK,gBAGdgN,CACX,CAEA,SAASujD,EAAevwD,EAAKyqB,GACzB,IACI+lC,EADAhqD,EAAMxJ,EAAMC,IAAI,kBAAkB,GAAGsC,MAAM,EAAG,GAOlD,GAJIixD,EADAxzD,EAAMC,IAAIiC,uBAAuBw7B,yBACrB,IAAIn+B,OAAO,+BAEX,IAAIA,OAAO,8BAEvByD,EAAK6qB,SAAU,CACf,IAAIrrB,GAAK,GAAKQ,EAAK6qB,UAAUprB,MAAM+wD,GAE/BhqD,EADAhH,EACMA,EAAE,GAGF,KAEd,CASA,OARIQ,EAAKwH,OAASxH,EAAKwH,OAASxH,EAAKwH,MAAMI,MAAQ5H,EAAKwH,MAAMI,KAAK6iB,KAC/DjkB,EAAMxG,EAAKwH,MAAMI,KAAK6iB,IAErBztB,EAAMC,IAAIiC,uBAAuBw7B,2BAC/B19B,EAAMC,IAAIiC,uBAAuBqrB,mCAEpC/jB,EAAMA,EAAInK,eAEPmK,CACX,CAGA,SAASiqD,EAAiBzwD,EAAMyqB,EAAOimC,EAAaC,EAAa5J,EAAUmJ,GACvE,IAAIjzD,EAAK2Q,EAAGpH,EAAK7H,EACb2kD,EAAWyD,EACX6J,GAAY,EAEhB,IAAK5wD,EAAKyqB,GACN,MAAO,CACHhpB,KAAK,GACL6hD,SAASyD,EACTh6C,MAAO3R,EAAIgsB,KAAK4rB,WAAWj3C,OAOnC,IAAI80D,GAAiB,EACjBz1D,EAAIgL,0BAA0BtH,QAAQ2rB,IAAU,GAC7CylC,IAEHzlC,GAAgB,SAChBomC,GAAiB,GAErB,IAAIC,GAAU,EACVC,EAAa,KACbC,EAAc,GACM,WAApBvmC,EAAMlrB,OAAO,IACbyxD,EAAYtwD,KAAK+pB,GACjBumC,EAAYtwD,KAAK+pB,EAAMlrB,MAAM,GAAI,KAEjCyxD,EAAYtwD,KAAK+pB,GAGrB,IAAK,IAAIwmC,EAAE,EAAEC,EAAKF,EAAYvzD,OAAQwzD,EAAEC,EAAMD,IAAK,CAC/C,IAAIE,GAAe,EAGnB3qD,EAAM,CAAC/E,KAAK,GAAI6hD,SAASyD,EAASroD,OAAO6xD,EAAevwD,EAFpDyqB,EAAQumC,EAAYC,KAIxBtyD,EAAO3B,EAAMC,IAAIyzD,GAAe1zD,EAAMC,IAAIyzD,GAAanxD,QAAU,GACjE,IAAI6xD,GAAS,EAkBb,GAhBoB,gBAAhBV,GACK3J,IACDvgD,EAAI/E,KAAOzB,EAAKyqB,GAChBjkB,EAAI88C,UAAW,GAEnB8N,GAAS,EACTR,GAAY,IACLD,QAAgB,IAAuBhyD,GAAwB,IAAhBA,EAAKlB,SAG3D+I,EAAI/E,KAAOzB,EAAKyqB,GAChBjkB,EAAI88C,UAAW,EACf8N,GAAS,EACTR,GAAY,IAGXQ,EAAQ,CACT,IAAK,IAAI7zD,EAAI,EAAGC,EAAOmB,EAAKlB,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAGlD,GADAqQ,GADA3Q,EAAM0B,EAAKpB,IACHD,MAAM,SAAS,GACnBL,GAAO+C,EAAKwH,OAASxH,EAAKwH,MAAMC,MAAMgjB,IAAUzqB,EAAKwH,MAAMC,MAAMgjB,GAAOxtB,GAAM,CAC9EuJ,EAAI/E,KAAOzB,EAAKwH,MAAMC,MAAMgjB,GAAOxtB,GACnCuJ,EAAI9H,OAASzB,EACbm0D,GAAS,EACTD,GAAe,EACfP,GAAY,EACZ,KACJ,CAAO,GAAIhjD,GAAK5N,EAAKwH,OAASxH,EAAKwH,MAAMC,MAAMgjB,IAAUzqB,EAAKwH,MAAMC,MAAMgjB,GAAO7c,GAAI,CACjFpH,EAAI/E,KAAOzB,EAAKwH,MAAMC,MAAMgjB,GAAO7c,GACnCpH,EAAI9H,OAASkP,EACbwjD,GAAS,EACTD,GAAe,EACfP,GAAY,EACZ,KACJ,CACJ,EACKpqD,EAAI/E,MAAQkvD,IACbnqD,EAAM,CAAC/E,KAAKzB,EAAKyqB,GAAQ64B,UAAS,EAAM5kD,OAAO6xD,EAAevwD,EAAKyqB,IACnEmmC,GAAY,EAEpB,CAqBA,GApBApqD,EAAIuG,MAAQ3R,EAAIgsB,KAAK4rB,WAAWj3C,MACtB,IAANk1D,GACIE,IACA3qD,EAAI6qD,kBAAmB,GAE3BN,EAAavqD,EACRqqD,QAAmB,IAAuBlyD,GAAwB,IAAhBA,EAAKlB,SACxDqzD,GAAU,GAEVK,IACAL,GAAU,IAGTD,GAAmBM,IAAgBJ,EAG7BI,IACP3qD,EAAI6qD,kBAAmB,IAHvB7qD,EAAMuqD,EACNtmC,EAAQumC,EAAY,IAKxB,CAAC,QAAS,mBAAmBlyD,QAAQ2rB,IAAU,KAC1C64B,GACI98C,EAAIuG,MAAMc,QAAQ,cACmB,aAAnCrH,EAAIuG,MAAMc,QAAQ,cACiB,WAAnCrH,EAAIuG,MAAMc,QAAQ,cAA4B,CACrD,IACIvP,EADStB,EAAMC,IAAIqB,KAGnBA,GADAsyD,GAGOpqD,EAAI9H,OAEf,IAAI4H,EAAMmkB,EAAMlrB,MAAM,GAAG,GACrBoJ,EAAkD,aAAnCnC,EAAIuG,MAAMc,QAAQ,aACrCrH,EAAI/E,KAAOrG,EAAIsN,0BAA0B1L,EAAOgD,EAAMsG,EAAKhI,EAAMqK,UAC1DnC,EAAIuG,MAAMc,QAAQ,YAC7B,CAEJ,GAAIijD,EACA,KAER,CACA,OAAOtqD,CACX,CA4CA,SAAS8qD,EAAgBnX,EAAKn6C,EAAM6iD,EAASqN,GACzC,IAAI9mC,EAAU+wB,EAAIj7B,UAAU,GAC5B,GAAIliB,EAAMq5C,iBAAmBwM,EAAS,CAClC,IAA0D,IAAtD,CAAC,YAAY,mBAAmB/jD,QAAQsqB,GACxC,OAAO,EAIPpsB,EAAMq5C,gBAAgBjtB,EAAU,UAAY+wB,EAC5Cn9C,EAAMq5C,gBAAgB6S,QAAQxoD,KAAK0oB,GACnC,IAAI/rB,EAAMwlD,EAAQvlD,MAAM,QACpBD,EAAII,SAAWT,EAAMq5C,gBAAgBjtB,EAAU,SAAS3rB,SACxDT,EAAMq5C,gBAAgBjtB,EAAU,SAAW/rB,GAG/C,IAAK,IAAIE,EAAI,EAAGC,EAAOH,EAAII,OAAQF,EAAIC,EAAMD,GAAK,EAC9CF,EAAIE,GAAKyyD,EAAWhzD,EAAOm9C,EAAKn6C,GAAM,EAAO3C,EAAIE,GAAI2yD,GAAY,GAGrE,OADAlzD,EAAMhB,IAAIotB,EAAU,UAAY+wB,GACzB,CAEf,CACA,OAAO,CACX,CAYA,SAASsO,EAAW95C,EAAc3B,GAC9B,IAAIxN,EAAIwN,EAAMvN,MAAM,8EACpB,GAAID,IACAwN,EAAQA,EAAMzN,MAAMC,EAAE,GAAG/B,QACrB+B,EAAE,IAEF,IADA,IAAI+xD,EAAS/xD,EAAE,GAAGlC,MAAM,KACfC,EAAI,EAAGC,EAAO+zD,EAAO9zD,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACpD,IACIwD,EADWwwD,EAAOh0D,GACJkC,MAAM,2BACpBgrB,EAAQ1pB,EAAG,GAEXsnD,EAAUrrD,EAAMhB,IAAIwrC,eACpBzmC,EAAG,GACCsnD,GAAW15C,IACN05C,EAAQ15C,KACT05C,EAAQ15C,GAAgB,CAAC,GAE7B05C,EAAQ15C,GAAc8b,GAAS1pB,EAAG,KAES,IAAxC/D,EAAMhB,IAAIkgC,UAAUp9B,QAAQ2rB,KAC/B49B,GAAW15C,IACN05C,EAAQ5gB,QAAQ94B,KACjB05C,EAAQ5gB,QAAQ94B,GAAgB,CAAC,GAErC05C,EAAQ5gB,QAAQ94B,GAAc8b,IAAS,GAE3CztB,EAAMhB,IAAIkgC,UAAUx7B,KAAK+pB,GAEjC,CAGR,OAAOzd,CACX,CA7XAjR,KAAK+vB,QAAU,CAAC,EAChB/vB,KAAK+vB,QAAiB,QAAI,IAAI9uB,EAAM2S,IAAI9R,qBA8QxC9B,KAAK00D,gBAAkBA,EAyCvB10D,KAAK8vB,iBApCL,SAA0Bld,EAAc6iD,EAAU3vC,EAAMvjB,GAC/CqQ,IACDA,EAAe,WAEnB,IAAItQ,EAAUsQ,EAAarR,MAAM,KAAK,GAClCiB,EAASnD,EAAIgD,iBAAiBpB,EAAOqB,EAASC,GAIlD,OAHIC,IACAoQ,GAAiB,IAAMpQ,GAEtBsjB,GAgBD7kB,EAAM2S,IAAIsU,mBACVtV,EAAe3R,EAAM2S,IAAIsU,gBAAgBjnB,EAAMC,IAAI8oB,QAAS/oB,EAAMknB,UAAU4H,QAASnd,EAAc6iD,EAAU3vC,MAEzGlT,EAAe,UACXpQ,IACAoQ,GAAiB,IAAMpQ,KAI5BoQ,IAxBE3R,EAAMknB,UAAU4H,QAAQnd,KACzB3R,EAAMknB,UAAU4H,QAAQnd,GAAgB,IAAI3R,EAAM2S,IAAI9R,sBAErDb,EAAMknB,UAAU4H,QAAQnd,GAAc6iD,KACvCx0D,EAAMknB,UAAU4H,QAAQnd,GAAc6iD,GAAY,CAAC,GAEhD7iD,EAmBf,EAuEA5S,KAAK0sD,WAAaA,EAiRlB1sD,KAAKo9C,kBA9QL,SAA2Bj6B,EAAWgxC,EAAYuB,EAAuBC,GAOrE,IAAI/O,EACAgP,EAAYv2D,EAAIwC,aAAashB,EAAU,IAO3C,OAHIyjC,IAHCgP,GAGY30D,EAAMC,IAAI,mBAAmB00D,GAGvC,SAAU30D,EAAOgD,EAAMf,GAC1B,IAAI4jD,EAAS+O,EAAgB9O,EAAW+O,EAAkB9O,EAAU+O,EACpE,IAAK5yC,EAAU,KAAQlf,EAAKkf,EAAU,MAAQlf,EAAK0xD,GAC/C,OAAO,KAMX,IAAK10D,EAAMhB,IAAIq2B,cAAgBpzB,GAAQA,EAAK,qBACnCjC,EAAMhB,IAAIotC,6BAA+BpsC,EAAMhB,IAAIu/B,eAAe99B,SAAW,EAC9E,OAAO,KAGf,IAAImlD,EAAO,CAACC,SAAQ,EAAOC,WAAU,EAAOC,UAAS,GACrD,GAAiC,UAA7B/lD,EAAMhB,IAAIoN,KAAK7J,OAAO,GACtBqjD,EAAKC,QAAU,mBAEf,GAAIF,GAAoC,IAAtBA,EAAWllD,QAAkC,gBAAlBklD,EAAW,GACpDC,EAAKC,QAAU,cACfF,GAAa,OACV,GAAIA,IAAe3lD,EAAMhB,IAAI8uB,aAEhC,IADA,IAAIk4B,EAAY,CAAC,UAAW,YAAa,YAChCzlD,EAAI,EAAGC,EAAOwlD,EAAUvlD,OAAQF,EAAIC,KACrCmlD,EAAWllD,OAAS,EAAKF,GADkBA,GAAK,EAIhDolD,EAAWplD,KACXqlD,EAAKI,EAAUzlD,IAAM,UAAYolD,EAAWplD,SAIpDqlD,EAAKC,QAAU,cAsBvB,GAlBqB,gBAAjB3jC,EAAU,KACa,iBAAnBliB,EAAMhB,IAAIoN,MACc,aAAnBpM,EAAMhB,IAAIoN,MACc,SAArBpM,EAAMC,IAAIC,QACV+B,IAASA,EAAK6kC,YAE1B8e,EAAKE,WAAY,EACjBF,EAAKG,UAAW,GAGhB/lD,EAAMhB,IAAI8uB,eACV83B,EAAKE,WAAY,EACjBF,EAAKG,UAAW,GAMhB/lD,EAAMhB,IAAI,kBAMV,MALqB,cAAjBkjB,EAAU,GACVliB,EAAMhB,IAAI,mBAAqBD,KACP,oBAAjBmjB,EAAU,KACjBliB,EAAMhB,IAAI,yBAA2BD,MAElC,KAMX,IAAIg2D,EAAe/0D,EAAMhB,IAAIC,WAAWsD,QAGpCyQ,EAAMygD,EAAgB11C,KAAKhf,KAAMiE,EAAMkf,EAAU,GAAI0jC,EAAKC,SAAS,EAAM,KAAMqN,GACnFrN,EAAU7yC,EAAIvO,KACdmwD,EAAiB5hD,EAAItR,OACrB,IAsBIulD,EACAC,EA6BA8N,EApDAhO,EAAch0C,EAAIjD,MAClBklD,EAAkBjiD,EAAIszC,SAa1B,GAZI4M,IAAelgD,EAAIqhD,mBACnBxO,EAAUmN,EAAWhzD,EAAOgnD,EAAahkD,EAAM0xD,EAAqB7O,EAASqN,GAAY,OAxIrG,SAAuBlwD,EAAMgN,GACzB,IAAIxN,EAAIwN,EAAMvN,MAAM,mBAChBD,GAAKA,EAAE,KACPQ,EAAK,aAAeR,EAAE,GAE9B,CAwIgB0yD,CAAclyD,EAAM6iD,GACf7lD,EAAMhB,IAAIq2B,eACXwwB,EAAU4F,EAAWzoD,EAAK2O,aAAck0C,KAIhDyO,EAAev1D,KAAMiE,EAAM6iD,EAASqN,GAEpC,OADAlzD,EAAMhB,IAAIC,WAAa81D,EAChB,KA2CX,GAvCAjP,GAAY,EACZC,GAAW,EAGPH,EAAKE,YAELA,GADA9yC,EAAMygD,EAAgB11C,KAAKhf,KAAMiE,EAAMkf,EAAU,GAAI0jC,EAAKE,WAAW,EAAO9yC,EAAIszC,SAAU,KAAM4M,IAChFzuD,KAChBowD,EAAmB7hD,EAAItR,OACvBulD,EAAgBj0C,EAAIjD,MAChBmjD,IAAelgD,EAAIqhD,kBACfvO,IAEAA,EAAYkN,EAAWhzD,EAAOinD,EAAejkD,GAAM,EAAO8iD,EAAWoN,GAAY,KAKzFtN,EAAKG,WAELA,GADA/yC,EAAMygD,EAAgB11C,KAAKhf,KAAMiE,EAAMkf,EAAU,GAAI0jC,EAAKG,UAAU,EAAO/yC,EAAIszC,SAAU,KAAM4M,IAChFzuD,KACfqwD,EAAkB9hD,EAAItR,OACtBwlD,EAAel0C,EAAIjD,MACfmjD,IAAelgD,EAAIqhD,kBACftO,IAEAA,EAAWiN,EAAWhzD,EAAOknD,EAAclkD,GAAM,EAAO+iD,EAAUmN,GAAY,KAQrE,oBAAjBtN,EAAKC,UACLmP,EAAgBh1D,EAAMC,IAAImzB,YAAYuhC,GAAW/O,EAAKC,SAAS9gD,QAK7C,QAAlBiwD,GAA4C,UAAjB9yC,EAAU,KAAmB+yC,EAAiB,CACzE,IAAI7N,GAAY,EAChB,IAAS7mD,EAAI,EAAGC,EAAOwmD,EAAYt2C,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC5B,gBAAlCymD,EAAYt2C,YAAYnQ,GAAG,IACU,WAAlCymD,EAAYt2C,YAAYnQ,GAAG,KAE9B6mD,GAAY,GAGfA,GACDJ,EAAYt2C,YAAYhN,KAAK,CAAC,cAAe,UAErD,CAUA,GAPuB,OAAnBkxD,GAAgE,UAArC5N,EAAYn2C,QAAQ,eAC/Cm2C,EAAYn2C,QAAQ,aAAe,eAGnC,UAAYqR,EAAU,KACtB2jC,EAAUznD,EAAIqL,iBAAiBzJ,EAAO6lD,EAAS9mD,KAAK,yBAEpD+mD,GAAaC,EAAU,CAgBvB,GAdA/lD,EAAMqoB,OAAO0M,UAAU,SAGvBiyB,EAAYn2C,QAAQrL,OAASwhD,EAAYn2C,QAAQrL,OAAO3C,QAAQ,UAAU,IACtE+xD,IACA50D,EAAMhB,IAAIC,WAAa,CAAC21D,GAAgB/vD,OAAOkwD,IAEnD32D,EAAIyR,+BAA+B7P,EAAO,KAAM,KAAMgnD,EAAaA,EAAYn2C,QAAQ9L,OAAS8gD,GAChG7lD,EAAMqoB,OAAOiN,OAAOuwB,EAASmB,GAC7BhnD,EAAMhB,IAAIotC,6BAA8B,EAEpCyZ,IAAYC,IACZA,GAAY,GAEZA,EAAW,CACXmB,EAAcp2C,QAAQ9L,OAAS/E,EAAMC,IAAImzB,YAAYuhC,GAAW/O,EAAKE,WAAW/gD,OAChFkiD,EAAcp2C,QAAQrL,OAASxF,EAAMC,IAAImzB,YAAYuhC,GAAW/O,EAAKE,WAAWtgD,OAE3EyhD,EAAcp2C,QAAQ9L,SACvBkiD,EAAcp2C,QAAQ9L,OAAS,KAGnC,IAASxE,EAAI0mD,EAAcv2C,YAAYjQ,OAAS,EAAGF,GAAK,EAAGA,IAAM,EACzD,CAAC,eAAgB,qBAAsB,sBAAuB,qBAAqBuB,QAAQmlD,EAAcv2C,YAAYnQ,GAAGG,KAAK,OAAS,IACtIumD,EAAcv2C,YAAcu2C,EAAcv2C,YAAYnO,MAAM,EAAGhC,GAAGsE,OAAOoiD,EAAcv2C,YAAYnO,MAAMhC,EAAI,KAG5F,OAArBs0D,GAAoE,UAAvC5N,EAAcp2C,QAAQ,eACnDo2C,EAAcp2C,QAAQ,aAAe,eAErCgkD,IACA70D,EAAMhB,IAAIC,WAAa,CAAC41D,GAAkBhwD,OAAOkwD,IAErD,IAAI1N,EAAkB,IAAIjpD,EAAI8hB,MAC9BmnC,EAAgB32C,YAAYhN,KAAK,CAAC,cAAe,WACjD2jD,EAAgB32C,YAAYhN,KAAK,CAAC,eAAgB,WAClD1D,EAAMqoB,OAAO0M,UAAUsyB,GACvBrnD,EAAMqoB,OAAOiN,OAAOwwB,EAAWmB,GAC/BjnD,EAAMqoB,OAAO4M,aAEEj1B,EAAMqoB,OAAO4L,QAAQjkB,QACpBhQ,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,MAAM1zB,MAGvD,CAKA,GAJIolD,IAAYE,IACZA,GAAW,GAGXA,EAAU,CACVmB,EAAar2C,QAAQ9L,OAAS/E,EAAMC,IAAImzB,YAAYuhC,GAAW/O,EAAKG,UAAUhhD,OAC9EmiD,EAAar2C,QAAQrL,OAASxF,EAAMC,IAAImzB,YAAYuhC,GAAW/O,EAAKG,UAAUvgD,OAEzE0hD,EAAar2C,QAAQ9L,SACtBmiD,EAAar2C,QAAQ9L,OAAS,KAGlC,IAASxE,EAAI2mD,EAAax2C,YAAYjQ,OAAS,EAAGF,GAAK,EAAGA,IAAM,EACxD,CAAC,eAAgB,qBAAsB,sBAAuB,qBAAqBuB,QAAQolD,EAAax2C,YAAYnQ,GAAGG,KAAK,OAAS,IACrIwmD,EAAax2C,YAAcw2C,EAAax2C,YAAYnO,MAAM,EAAGhC,GAAGsE,OAAOqiD,EAAax2C,YAAYnO,MAAMhC,EAAI,KAG1F,OAApBu0D,GAAkE,UAAtC5N,EAAar2C,QAAQ,eACjDq2C,EAAar2C,QAAQ,aAAe,eAEpCikD,IACA90D,EAAMhB,IAAIC,WAAa,CAAC61D,GAAiBjwD,OAAOkwD,IAEpD,IAAIzN,EAAiB,IAAIlpD,EAAI8hB,MAC7BonC,EAAe52C,YAAYhN,KAAK,CAAC,cAAe,WAChD4jD,EAAe52C,YAAYhN,KAAK,CAAC,eAAgB,WACjD1D,EAAMqoB,OAAO0M,UAAUuyB,GACvBtnD,EAAMqoB,OAAOiN,OAAOywB,EAAUmB,GAC9BlnD,EAAMqoB,OAAO4M,aAEEj1B,EAAMqoB,OAAO4L,QAAQjkB,QACpBhQ,EAAMqoB,OAAO4L,QAAQjkB,QAAQmkB,MAAM1zB,MAIvD,CAEAT,EAAMqoB,OAAO4M,YACjB,MACQ2/B,IACA50D,EAAMhB,IAAIC,WAAa,CAAC21D,GAAgB/vD,OAAOkwD,IAEnD32D,EAAIyR,+BAA+B7P,EAAO,KAAM,KAAMgnD,EAAaA,EAAYn2C,QAAQ9L,OAAS8gD,GAChG7lD,EAAMqoB,OAAOiN,OAAOuwB,EAASmB,GAC7BhnD,EAAMhB,IAAIotC,6BAA8B,EAQ5C,OALApsC,EAAMhB,IAAIC,WAAa81D,EAEnB/0D,EAAMhB,IAAI6uD,sBACV7tD,EAAMhB,IAAIstC,UAAUx4B,SAASpQ,KAAK1D,EAAMqoB,OAAO4L,QAAQjkB,SAEpD,IACX,CACJ,CAEJ,EAiBA5R,EAAI8hB,MAAQ,SAAUzb,EAAMkd,EAAWwzC,GAMnCp2D,KAAK0F,KAAOA,EAIZ1F,KAAK8R,QAAU,CAAC,EAChB9R,KAAK8R,QAAQ+F,eAAYwe,EACzBr2B,KAAK8R,QAAQ9L,OAAS,GACtBhG,KAAK8R,QAAQrL,OAAS,GAatBzG,KAAK2R,YAAc,GACnB3R,KAAKmjB,UAAY,GAMjBnjB,KAAK0gB,MAAQ,GAMb1gB,KAAK4iB,UAAYA,CAmDrB,EAGAvjB,EAAIgsB,KAAK4rB,WAAa,SAAUjmC,GAC5B,IAAI4kB,EAAaziB,EAAKC,EACtB,GAAI,iBAAoBpC,EACpB,OAAOA,EAGX,IAAK,IAAI/L,KADT2wB,EAAS,IAAIv2B,EAAI8hB,MAAMnQ,EAAMtL,KAAMsL,EAAM4R,WACzB5R,EAAMc,QACdd,EAAMc,QAAQmR,eAAehe,KAC7B2wB,EAAO9jB,QAAQ7M,GAAO+L,EAAMc,QAAQ7M,IAG5C,GAAI+L,EAAMW,YAEN,IADAikB,EAAOjkB,YAAc,GAChBwB,EAAM,EAAGC,EAAMpC,EAAMW,YAAYjQ,OAAQyR,EAAMC,EAAKD,GAAO,EAC5DyiB,EAAOjkB,YAAYhN,KAAKqM,EAAMW,YAAYwB,GAAK3P,SAcvD,OAXIwN,EAAMmS,YACNyS,EAAOzS,UAAYnS,EAAMmS,UAAU3f,SAInCwN,EAAM0P,QACNkV,EAAOlV,MAAQ1P,EAAM0P,MAAMld,QACvBwN,EAAMsxB,QACN1M,EAAO0M,MAAQtxB,EAAMsxB,MAAM9+B,UAG5BoyB,CACX,EAQAv2B,EAAIuhC,YAAc,WACd5gC,KAAKq2D,QAAU,GACfr2D,KAAKs2D,OAAS,EACdt2D,KAAK+E,MAAQ,GACb/E,KAAKqf,OAAS,GACdrf,KAAKuf,aAAc,EACnBvf,KAAKsf,aAAe,CACxB,EAIAjgB,EAAI+2B,KAAO,SAAU52B,EAAKwR,EAAO4jB,GAC7B,IAAIxhB,EAAKD,EAGT,GAFAnT,KAAK40B,UAAYA,EAEb5jB,EAAO,CAEP,IAAK,IAAI/L,KADTjF,KAAK8R,QAAU,CAAC,OAAS,GAAG,OAAS,IACrBd,EAAMc,QACdd,EAAMc,QAAQmR,eAAehe,KAC7BjF,KAAK8R,QAAQ7M,GAAO+L,EAAMc,QAAQ7M,IAS1C,IANAjF,KAAK2R,YAAc,GAEfyB,OADsBijB,IAAtBrlB,EAAMW,YACA,EAEAX,EAAMW,YAAYjQ,OAEvByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BnT,KAAK2R,YAAYhN,KAAKqM,EAAMW,YAAYwB,GAAK3P,QAErD,MACIxD,KAAK8R,QAAU,CAAC,EAChB9R,KAAK8R,QAAQ9L,OAAS,GACtBhG,KAAK8R,QAAQrL,OAAS,GACtBzG,KAAK8R,QAAQ+F,UAAY,GACzB7X,KAAK2R,YAAc,GAGnB3R,KAAKo1B,MADL,iBAAoB51B,EACPA,EACNA,EACM,CAACA,GAED,GAEjBQ,KAAKwyB,SAAW,CAACxyB,KAAK2R,YAC1B,EAGAtS,EAAI+2B,KAAKphB,UAAUrQ,KAAO,SAAUytB,GAC5B,iBAAoBpyB,KAAKo1B,MACzB/1B,EAAIE,MAAM,4CACH,IAAU6yB,IACjBA,EAAKI,SAAWJ,EAAKI,SAAS1sB,OAAO9F,KAAKwyB,UAC1CxyB,KAAKo1B,MAAMzwB,KAAKytB,GAExB,EAgBA/yB,EAAI05C,YAAc,SAAU93C,EAAOi3B,EAAUxf,EAAK69C,EAAcloC,GAU5D,GAPAruB,KAAKquB,GAAKA,EACVruB,KAAKwyB,SAAW,GAChBxyB,KAAK0Y,IAAMA,EACX1Y,KAAKk4B,SAAWA,EAChBl4B,KAAKo1B,MAAQ1c,EAAIm5B,WACjB7xC,KAAKo5B,OAAS/5B,EAAI0H,MAClB/G,KAAK8R,QAAU,CAAC,EACZykD,EAAc,CACd,GAAIA,EAAazkD,QAAQ,aAAc,CACnC,IAAI0kD,EAAWD,EAAazkD,QAAQ,aACpC9R,KAAKk4B,SAAW74B,EAAI2N,OAAOC,WAAWupD,GAAUv1D,EAAOjB,KAAKk4B,UAC5Dl4B,KAAKo1B,MAAQ/1B,EAAI2N,OAAOC,WAAWupD,GAAUv1D,EAAOjB,KAAKo1B,MAC7D,CACAp1B,KAAK4sB,OAAS2pC,EAAa3pC,OAC3B5sB,KAAK2R,YAAc4kD,EAAa5kD,YAChC3R,KAAK8R,QAAQ9L,OAASuwD,EAAazkD,QAAQ9L,OAC3ChG,KAAK8R,QAAQrL,OAAS8vD,EAAazkD,QAAQrL,OAC3CzG,KAAK8R,QAAQ,aAAeykD,EAAazkD,QAAQ,aACjD9R,KAAKw4B,iBAAmB+9B,EAAa/9B,iBACrCx4B,KAAK05B,aAAe68B,EAAa78B,aACjC15B,KAAKi5B,cAAgBs9B,EAAat9B,cAClCj5B,KAAKs5B,UAAYi9B,EAAaj9B,UACzBt5B,KAAKs5B,YACNt5B,KAAKs5B,UAAa,IAAIj6B,EAAI2N,OAAOypD,kBAEjCz2D,KAAKs5B,YACLt5B,KAAKmF,KAAOnF,KAAKs5B,UAAUC,OAAO,GAE1C,MACIv5B,KAAK2R,YAAc,GACnB3R,KAAK8R,QAAQ9L,OAAS,GACtBhG,KAAK8R,QAAQrL,OAAS,GACtBzG,KAAKw4B,iBAAmB,GACxBx4B,KAAK05B,aAAe,GACpB15B,KAAKi5B,cAAgB,GACrBj5B,KAAKs5B,UAAY,IAAIj6B,EAAI2N,OAAOypD,gBAExC,EAGAp3D,EAAI05C,YAAY/jC,UAAUgkC,aAAe,SAAU1f,GAC/Ct5B,KAAKs5B,UAAYA,EACjBt5B,KAAKmF,KAAOnF,KAAKs5B,UAAUC,OAAO,EACtC,EAGAl6B,EAAI2N,OAAOypD,iBAAmB,WAAa,EAE3Cp3D,EAAI2N,OAAOypD,iBAAiBzhD,UAAUukB,OAAS,SAAU7gB,GACrD,OAAOA,EAAIm5B,UACf,EAEAxyC,EAAI05C,YAAY/jC,UAAUgkB,UAAY,SAAU5Y,EAAKnV,GAC7CA,GACAjL,KAAKo5B,OAAS/5B,EAAI0H,MACd,iBAAoBqZ,IAChBA,EAAK1H,MAAS1Y,KAAK0Y,IAAM,EACzB0H,EAAKgZ,OAAS/5B,EAAI8H,UAElBiZ,EAAKgZ,OAAS/5B,EAAI6H,OAGjBkZ,GAASA,EAAK1H,KAAO1Y,KAAKmF,OAASib,EAAKjb,MAAQib,EAAK1H,MAAS1Y,KAAK0Y,IAAM,EAQ9E1Y,KAAKo5B,SAAW/5B,EAAI0H,OAAS/G,KAAKo5B,SAAW/5B,EAAI6H,KACjDkZ,EAAKgZ,OAAS/5B,EAAI8H,UACXnH,KAAKo5B,SAAW/5B,EAAI8H,WAAanH,KAAKo5B,SAAW/5B,EAAI+H,yBACxDpH,KAAK05B,cACLtZ,EAAKgZ,OAAS/5B,EAAI+H,uBAClBpH,KAAKo5B,OAAS/5B,EAAIgI,UAElB+Y,EAAKgZ,OAAS/5B,EAAI8H,YAdtBnH,KAAKo5B,SAAW/5B,EAAI+H,yBACpBpH,KAAKo5B,OAAS/5B,EAAI2H,KAElB,iBAAoBoZ,IACrBA,EAAKgZ,OAAS/5B,EAAI6H,MAkB7B,EAGA7H,EAAI05C,YAAY/jC,UAAUmkB,UAAY,SAAUu9B,GAE5C,OAAI12D,KAAKo5B,SAAW/5B,EAAI6H,MACpBwvD,EAAKh+C,MAAS1Y,KAAK0Y,IAAM,GAAM1Y,KAAKo5B,SAAW/5B,EAAI8H,aACnDnH,KAAKo5B,OAAS/5B,EAAI8H,WACX,EAGf,EAIA9H,EAAIgsB,KAAKkB,YAAc,SAAUzV,EAAQ3D,EAAK4D,GAC1C,IAAI2V,EAAMrV,EAAUuF,EAAS+5C,EAAS5gD,EAAUI,EAAMjR,EAAKc,EAAQS,EAAQsO,EAAU6hD,EAAaC,EAASj1C,EAEvGk1C,EAAQ92D,KAAKshB,OAAO1L,kBAAkBmB,EAAM,SAE5CqH,EAAiBpe,KAAKshB,OAAO1L,kBAAkBmB,EAAM,kBAczD,GAVA/W,KAAKuhB,MAAMk7B,UAAW,EAEtB/vB,EAAO1sB,KAAKshB,OAAO1L,kBAAkBmB,EAAM,QAGvC+/C,EADA14C,EACQpe,KAAKkB,IAAI,kBAAkB,GAE3BlB,KAAKshB,OAAO1L,kBAAkBmB,EAAM,UAG3C/W,KAAKitB,QAAQP,EAAMtO,GACpB,OAAOtH,EAGX,IAAI+W,EAAY7tB,KAAKshB,OAAO1L,kBAAkBmB,EAAM,cAmDpD,IAAK,IAAI9R,KAjDToS,EAAWrX,KAAKshB,OAAO1L,kBAAkBmB,EAAM,YAC/C/Q,EAAShG,KAAKshB,OAAO1L,kBAAkBmB,EAAM,UAC7CtQ,EAASzG,KAAKshB,OAAO1L,kBAAkBmB,EAAM,UAC7C8/C,EAAU72D,KAAKshB,OAAO1L,kBAAkBmB,EAAM,WAC9C6K,EAAQ5hB,KAAKshB,OAAO1L,kBAAkBmB,EAAM,SAK5C6F,EAAU5c,KAAKshB,OAAOlL,SAASpW,KAAKitB,QAAQP,EAAMtO,IAClDpe,KAAKshB,OAAOpL,aAAa0G,EAAS,QAAS5c,KAAKkB,IAAIqB,MACpDvC,KAAKshB,OAAOpL,aAAa0G,EAAS,OAAQ8P,GAC1C1sB,KAAKshB,OAAOpL,aAAa0G,EAAS,aAAciR,GAChD7tB,KAAKshB,OAAOpL,aAAa0G,EAAS,QAASgF,GAI3C5hB,KAAKshB,OAAOpL,aAAa0G,EAAS,WAAYvF,GAC9CrX,KAAKshB,OAAOpL,aAAa0G,EAAS,iBAAkBwB,GAIhDpY,GAIAhG,KAAKshB,OAAOpL,aAAa0G,EAAS,SAAU5W,GAE5CS,GAIAzG,KAAKshB,OAAOpL,aAAa0G,EAAS,SAAUnW,GAE5CowD,GAIA72D,KAAKshB,OAAOpL,aAAa0G,EAAS,UAAWi6C,GAUjD9hD,EAAW/U,KAAKshB,OAAOvM,SAAS6H,GAE5B+5C,EAAU5hD,EAAS9P,GACf,cAAgBjF,KAAKshB,OAAO9L,SAASmhD,KACrC5gD,EAAW/V,KAAKshB,OAAO1L,kBAAkB+gD,EAAS,QAC9Cv4C,GACApe,KAAKshB,OAAOxL,4CAA4C8G,EAAS,YAAa7G,EAAU,kBAAmB,SAMvH,IAAK,IAAI9Q,KADT8P,EAAW/U,KAAKshB,OAAOvM,SAASgC,GAG5B,GADA4/C,EAAU5hD,EAAS9P,GACf,cAAgBjF,KAAKshB,OAAO9L,SAASmhD,GAGrC,IAAKxgD,KAFLJ,EAAW/V,KAAKshB,OAAO1L,kBAAkB+gD,EAAS,QAClDC,EAAc52D,KAAKshB,OAAO/N,WAAWojD,GAE7B,UAAYxgD,IAGZ2gD,GAASA,IAAU92D,KAAKkB,IAAIqB,MACxB,CAAC,UAAW,UAAW,SAASQ,QAAQoT,IAAS,IAIzDjR,EAAM0xD,EAAYzgD,GAClBnW,KAAKshB,OAAOxL,4CAA4C8G,EAAS,YAAa7G,EAAUI,EAAMjR,KAK1G,GAAI,SAAWlF,KAAKshB,OAAO1L,kBAAkBmB,EAAM,cAK/C/W,KAAKshB,OAAOtL,0BAA0B4G,EAAS,SAI/C5c,KAAKshB,OAAOtL,0BAA0B4G,EAAS,YAE5C,GAAI,eAAiB5c,KAAKshB,OAAO1L,kBAAkBmB,EAAM,cAI5D/W,KAAKshB,OAAOtL,0BAA0B4G,EAAS,YAC5C,GAAI,cAAgB5c,KAAKshB,OAAO1L,kBAAkBmB,EAAM,cAAe,CAK1E,IADA,IAAIyE,EAAaxb,KAAKshB,OAAOvM,SAAS6H,GAC7Bpb,EAAE,EAAEC,EAAKzB,KAAKshB,OAAOjO,cAAcmI,GAAYha,EAAEC,EAAKD,IAI3D,GAA6D,SAAzDxB,KAAKshB,OAAO1L,kBAAkB4F,EAAWha,GAAI,QAAoB,CAIjExB,KAAKshB,OAAOpL,aAAasF,EAAWha,EAAE,GAAI,SAAU,IACpD,KACJ,CAKJxB,KAAKshB,OAAOtL,0BAA0B4G,EAAS,OACnD,CACA,OAAO5c,KAAKshB,OAAOzK,qBAAqBC,EAAQC,EAAM5D,EAAKyJ,EAC/D,EAIAvd,EAAIg4C,mBAAqB,SAAUp2C,EAAOgD,GACtC5E,EAAI89C,cAAcn+B,KAAKhf,KAAMiB,EAAOgD,GAAM,EAC9C,EAGA5E,EAAI89C,cAAgB,SAAUl8C,EAAOgD,EAAM8yD,GACvC,IAAIzf,EAAIv+B,EAAM9H,EAAO9Q,EAAG62D,EAAYx1D,EAAGC,EACnC4V,EAAWrX,KAAKmjB,UAAU,GAC1B8zC,EAAY,QAmBhB,GAlBIF,GAAW91D,EAAMhB,IAAIyhB,YACrBu1C,EAAY,wBAGZ,KADJ3f,EAAKrzC,EAAKoT,MAENigC,EAAK,CAAC,aAAc,CAAC,CAAC,WAEtB,IAAuBt3C,KAAK6tB,YAC5B7tB,KAAK6tB,UAAY,CAAC,OAAQ,QAAS,QAEnCypB,EAAGjoB,IACHioB,EAAKr2C,EAAM0C,IAAIC,WAAW0B,iBAAiBgyC,EAAGjoB,KACvCioB,EAAG,gBACVA,EAAKr2C,EAAMquB,eAAegoB,SAE1B,IAAuBA,IACvBA,EAAK,CAAC,GAENA,EAAGxwB,KACH,IAAKtlB,EAAI,EAAGC,EAAOpC,EAAI0J,oBAAoBrH,OAAQF,EAAIC,EAAMD,GAAK,EAU9D,GARAyP,EAAQ,EAEY,UADpB9Q,EAFA4Y,EAAO1Z,EAAI0J,oBAAoBvH,IAGzBgC,OAAO,KACTrD,EAAIA,EAAEqD,MAAM,GAAI,IAEhB8zC,EAAGv+B,IAAS/Y,KAAK6tB,UAAU9qB,QAAQ5C,IAAM,IACzC8Q,EAAQqmC,EAAGv+B,IAEU,SAArBA,EAAKvV,MAAM,EAAG,GAAe,CAE7B,IAAIwC,EAAS,IACC,OAFdgxD,EAAK33D,EAAIgsB,KAAKmtB,MAAMr4C,GAAGwe,QAAQ1d,EAAOgQ,IAE/B,KACHjL,EAAS,IACTgxD,EAAKA,EAAGxzD,MAAM,GACdwzD,EAAK,KAAOr+C,SAASq+C,EAAI,KAE7B/1D,EAAMqoB,OAAOiN,OAAOl3B,EAAIgsB,KAAKmtB,MAAMz/B,EAAKvV,MAAM,EAAG,IAAImb,QAAQ1d,EAAQ+E,EAASgxD,GAAMC,EACxF,MACIhmD,EAAQ5R,EAAIgsB,KAAKmtB,MAAMr4C,GAAG,yBAAyBc,EAAOgQ,MAGtDA,EAAQ,MAEZhQ,EAAMqoB,OAAOiN,OAAOtlB,EAAOgmD,EAI3C,EAEA53D,EAAI4nB,OAAOjS,UAAUsa,eAAiB,SAAUunB,GAC5C,IAAIpsC,EAAKikB,EAAO4oB,EAAI4f,EAEpB,IAAKxoC,KADLjkB,EAAM,CAAC,EACOosC,EACV,GAAc,eAAVnoB,EAAwB,EACxB4oB,EAAKT,EAAS,eACPn1C,OAAS,GACR41C,EAAG,GAAG51C,SAAW41C,EAAG,GAAG51C,QACvBrC,EAAIE,MAAM,yDAGlB23D,EAAO,CAAC,GAAI,QACZ,IAAK,IAAI11D,EAAI,EAAGC,EAAO61C,EAAG51C,OAAQF,EAAIC,EAAMD,GAAK,EAC7C,IAAK,IAAIsB,EAAI,EAAG4B,EAAOrF,EAAIwJ,WAAWnH,OAAQoB,EAAI4B,EAAM5B,GAAK,EACrD6pD,MAAMh0C,SAAS2+B,EAAG91C,GAAGsB,GAAI,KACzB2H,EAAKpL,EAAIwJ,WAAW/F,GAAKo0D,EAAK11D,SAAO60B,EAErC5rB,EAAKpL,EAAIwJ,WAAW/F,GAAKo0D,EAAK11D,IAAOmX,SAAS2+B,EAAG91C,GAAGsB,GAAI,GAIxE,MAAW+zC,EAAS5zB,eAAeyL,KAIjB,YAAVA,GAAuB,iBAAoBmoB,EAASpxC,SAAW,iBAAoBoxC,EAASpxC,QAAQ6f,MACpGjmB,EAAIK,MAAM,+CACV+K,EAAIhF,QAAUoxC,EAASpxC,QAAQ6f,MAE/B7a,EAAIikB,GAASmoB,EAASnoB,IAIlC,OAAOjkB,CACX,EAIApL,EAAIgsB,KAAK82B,MAAQ,CAAC,EAElB9iD,EAAIgsB,KAAK82B,MAAMgV,gBAAkB93D,EAAImuC,WAAWx4B,UAAUmwC,iBAK1D9lD,EAAIgsB,KAAK82B,MAAMyI,aAAe,SAAU3pD,EAAOyE,GAC3C,IAAIlE,EAAGC,EAAM4b,EAAU+5C,EAAW3sD,EAClC,IAAK/E,EACD,MAAO,GAKX,IAHA2X,EAAW3X,EAAKnE,MAAM,cACtB61D,EAAY1xD,EAAKhC,MAAM,aACvB+G,EAAM,GACDjJ,EAAI,EAAGC,EAAO4b,EAAS3b,OAAQF,EAAIC,EAAMD,GAAK,EAa/CiJ,GAAO4S,EAAS7b,GACZA,EAAIC,EAAO,IACXgJ,GAAO2sD,EAAU51D,IAGzB,OAAOiJ,CACX,EAKApL,EAAIgsB,KAAK82B,MAAMwI,eAAiB,SAAU1pD,EAAOyE,EAAM2xD,EAAYC,GAC/D,IAAO71D,EACP,IAAKiE,EACD,MAAO,GAKX,GAHK2xD,IACDA,EAAa,IAEb,CAAC,OAAQ,QAAQt0D,QAAQ2C,IAAS,IAC7BA,EAAK5B,QAAQ,gBAAiB,IAAIJ,MAAMrE,EAAIqH,gCACzC2wD,EAAW3zD,MAAM,MACzB,OAAOgC,GAGiC,IAAxCzE,EAAMC,IAAI,4BACVwE,EAAOA,EAAK5B,QAAQ,MAAO,MAe/B,IAAK,IAAItC,GAFTkE,GADAA,EAAOA,EAAK5B,QAAQ,YAAa,KAAKA,QAAQ,OAAQ,MAC1CA,QAAQ,YAAa,QAEjBpC,OAAO,EAAGF,GAAG,EAAGA,IAAM,EACP,MAAvBkE,EAAKlC,MAAMhC,EAAGA,EAAE,IAAuC,MAAzBkE,EAAKlC,MAAMhC,EAAE,EAAGA,EAAE,KAChDkE,EAAOA,EAAKlC,MAAM,EAAGhC,GAAK,KAAOkE,EAAKlC,MAAMhC,EAAE,IAKtD,IAAI+1D,EAAal4D,EAAI2N,OAAOC,WAAWuqD,WAAWj2D,MAAMmE,GACpD2X,EAAW,GAGf,GAFAA,EAAW,CAACk6C,EAAWzlD,QAAQ,IAEA,IAA3BylD,EAAWtlC,KAAKvwB,OAAc,CAC9B,IAAI+1D,EAAMp6C,EAAS,GAAG3Z,MAAM,WACxB+zD,GAAyB,IAAlBA,EAAI,GAAG/1D,QAAgB+1D,EAAI,KAAOA,EAAI,GAAGn3D,gBAChD+c,EAAS,IAAM,IAEvB,CAEA,IAAK7b,EAAI,EAAGC,EAAO81D,EAAWzlD,QAAQpQ,OAAQF,EAAIC,EAAMD,GAAK,EACzD6b,EAAS1Y,KAAK4yD,EAAWtlC,KAAKzwB,EAAI,IAClC6b,EAAS1Y,KAAK4yD,EAAWzlD,QAAQtQ,IAUrC,OANI81D,EACMt3D,KAAK03D,YAAYz2D,EAAOoc,EAAUg6C,GAElCr3D,KAAK23D,aAAa12D,EAAOoc,EAAUg6C,IAEnCvzD,QAAQ,iBAAkB,MAExC,EAEAzE,EAAIgsB,KAAK82B,MAAMyV,MAAQ,SAASp4D,GAC5B,OAAOA,EAAIsE,QAAQ,gBAAiB,GACxC,EAEAzE,EAAIgsB,KAAK82B,MAAM0V,SAAW,SAAS52D,EAAO62D,EAAQC,GAC9C,IAAIt0D,EAAIq0D,EAAOp0D,MAAM,oBACrB,OAAKD,GAGDq0D,EAASr0D,EAAE9B,KAAK,KAEpB8B,EAAIs0D,EAAOr0D,MAAM,uBAEbD,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAAK,GACrBs0D,EAASt0D,EAAE,GAAKq0D,EAASr0D,EAAE,IAE3Bs0D,GAAkBD,EAEfC,GAXIA,CAYf,EAEA14D,EAAIgsB,KAAK82B,MAAM6V,QAAU,SAAS/2D,EAAOzB,GACrC,IAAIiE,EAAIjE,EAAIkE,MAAM,gBAClB,OAAKD,EAGMA,EAAE9B,KAAK,IAFPnC,CAIf,EAEAH,EAAIgsB,KAAK82B,MAAMuV,YAAc,SAAUz2D,EAAOoc,EAAUg6C,GACpD,IAAI71D,EAAGC,EAEP41D,EAAaA,GAA0B,GAEvC,IAAIY,EAAW,GACf,IAAKz2D,EAAI,EAAGC,EAAO4b,EAAS3b,OAAQF,EAAIC,EAAMD,GAAK,EAC3CxB,KAAK43D,MAAMv6C,EAAS7b,IAAIE,OAAS,GAA2C,MAAtC1B,KAAK43D,MAAMv6C,EAAS7b,IAAIgC,OAAO,IAErE6Z,EAAS7b,GAAK6b,EAAS7b,GAAGsC,QAAQ,eAAgB,QAClDm0D,EAAStzD,MAAK,IACgB,IAAvB0Y,EAAS7b,GAAGE,QAAgB2b,EAAS7b,GAAGpB,gBAAkBid,EAAS7b,GAC1Ey2D,EAAStzD,MAAK,GAEdszD,EAAStzD,MAAK,GAItB,IAAKnD,EAAI,EAAGC,EAAO4b,EAAS3b,OAAQF,EAAIC,EAAMD,GAAK,EAE3Cy2D,EAASz2D,KAELA,EAAI6b,EAAS3b,OAAS,IAEtB2b,EAAS7b,EAAI,GAAKxB,KAAKg4D,QAAQ/2D,EAAOoc,EAAS7b,EAAE,IAC5Cy2D,EAASz2D,EAAE,KACZ6b,EAAS7b,EAAI,GAAKxB,KAAKg4D,QAAQ/2D,EAAOoc,EAAS7b,EAAE,IAAM,KAMvD6b,EAAS7b,EAAI,GAAGE,OAAS,EACzB2b,EAAS7b,EAAE,GAAK61D,EAAWvzD,QAAQ,UAAW,IAAMuZ,EAAS7b,EAAE,GAE/D6b,EAAS7b,EAAE,GAAKxB,KAAK63D,SAAS52D,EAAOoc,EAAS7b,EAAE,GAAI61D,IAIxD71D,IAAM6b,EAAS3b,OAAS,IACxB2b,EAAS7b,GAAK6b,EAAS7b,GAAK61D,IAKxC,OAAOh6C,EAAS1b,KAAK,IAAImC,QAAQ,uDAAuD,IAAIA,QAAQ,YAAa,KAAKA,QAAQ,2CAA4C,IAC9K,EAEAzE,EAAIgsB,KAAK82B,MAAMwV,aAAe,SAAU12D,EAAOoc,EAAUg6C,GACrD,IAAI71D,EAAGC,EAAMgC,EAAGX,EAAG4B,EAAMpD,EAAKmxB,EAC9B,IAAKjxB,EAAI,EAAGC,EAAO4b,EAAS3b,OAAQF,EAAIC,EAAMD,GAAK,EAE/C,GADAixB,EAAIpV,EAAS7b,GAYb,KARAiC,EAAIgvB,EAAE/uB,MAAMrE,EAAIqK,wBACJ+oB,EAAE/uB,MAAMrE,EAAIqH,+BAAiC+rB,EAAE/wB,OAAS,GAAK21D,EAAW3zD,MAAM,QACtFD,EAAIgvB,EAAE/uB,MAAM,YAEZD,GAAKA,EAAE,IAAMA,EAAE,KACfA,EAAE,GAAKA,EAAE,GAAKA,EAAE,GAChBA,EAAE,GAAK,IAEPA,GAAKA,EAAE,GAAGD,MAAM,EAAG,KAAOC,EAAE,GAAGD,MAAM,EAAG,GAAGpD,cAAe,CAC1D,IAAI83D,EAAQ,GACZ,GAAIz0D,EAAE,GAAI,CACN,IAAImkD,EAAI,GAER,IAAK9kD,EAAI,EAAG4B,GADZpD,EAAMmC,EAAE,GAAGlC,MAAM,KACMG,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CAC7C,IAAI+gC,EAAIviC,EAAIwB,GACZ,GAAI+gC,IAAMA,EAAEzjC,cAGR,MAFAwnD,GAAK/jB,CAIb,CACI+jB,EAAElmD,OAAS+B,EAAE,GAAG/B,SAChBw2D,EAAQ74D,EAAIgB,kBAAkB2e,KAAK/d,EAAO2mD,GAElD,CACAvqC,EAAS7b,GAAKiC,EAAE,GAAKy0D,EACjB12D,EAAKC,EAAO,EACR41D,EAAW3zD,MAAM,MACjB2Z,EAAS7b,GAAK61D,EAAWvzD,QAAQ,KAAMuZ,EAAS7b,IAE5C6b,EAAS7b,EAAI,GAAGuB,QAAQ,MAAQ,EAChCsa,EAAS7b,EAAI,GAAKxB,KAAK63D,SAAS52D,EAAOoc,EAAS7b,EAAE,GAAGsC,QAAQ,IAAK,IAAKuzD,GAAc,IAErFh6C,EAAS7b,EAAI,GAAKxB,KAAK63D,SAAS52D,EAAOoc,EAAS7b,EAAE,GAAI61D,GAI1DA,EAAW3zD,MAAM,MACjB2Z,EAAS7b,GAAK61D,EAAWvzD,QAAQ,KAAMuZ,EAAS7b,IAEhD6b,EAAS1Y,KAAK0yD,EAG1B,MAAW5kC,EAAE/uB,MAAMrE,EAAIsK,oBAAwBlG,GAAMA,EAAE,KACnD4Z,EAAS7b,GAAK,IAAMixB,GAG5B,IAAIhoB,EAAM4S,EAAS1b,KAAK,IAExB,OADA8I,EAAMA,EAAI3G,QAAQ,uDAAuD,IAAIA,QAAQ,YAAa,KAAKA,QAAQ,2CAA4C,IAE/J,EAEAzE,EAAIgsB,KAAK82B,MAAMC,WAAa,SAAU18C,GAClC,IAAI+E,EAAM,GAWV,OAVI/E,EAAKD,QACLgF,EAAI9F,KAAKe,EAAKD,UAEVC,EAAKE,OACL6E,EAAI9F,KAAKe,EAAKE,OAEdF,EAAKC,QACL8E,EAAI9F,KAAKe,EAAKC,SAGf8E,EAAI9I,KAAK,IACpB,EAQAtC,EAAIgsB,KAAKmtB,MAAQ,CAAC,EAMlBn5C,EAAIgsB,KAAKmtB,MAAM1xB,KAAO,CAAC,EAMvBznB,EAAIgsB,KAAKmtB,MAAM1xB,KAAW,KAAI,SAAU7lB,EAAOyX,GAQ3C,OAPKA,IAEGA,EADA,kBAAqBA,EACf,GAEA,GAGPA,EAAIm5B,UACf,EAMAxyC,EAAIgsB,KAAKmtB,MAAM1xB,KAAKqxC,SAAW,SAAUl3D,EAAOyX,EAAKxN,GACjD,IAAI4b,EAAO,GACNpO,IAEGA,EADA,kBAAqBA,EACf,GAEA,GAGdxN,EAAMA,EAAM,OAAS,GACrB,IAAI0a,EAAQ3kB,EAAMhB,IAAIu3C,YAAY,QAAUtsC,GAE5C,IADA0a,EAAQA,EAAQ,GAAGA,EAAQ,IACpBA,EAAMlkB,OAAS,GAClBkkB,EAAQ,IAAMA,EAElB,IAAIC,EAAM5kB,EAAMhB,IAAIu3C,YAAY,MAAQtsC,GAExC,IADA2a,EAAMA,EAAM,GAAGA,EAAM,IACdA,EAAInkB,OAAS,GAChBmkB,EAAM,IAAMA,EAEhB,IACI6K,EACA5rB,EAFA4hB,EAAO/N,SAASD,EAAMkN,EAAQC,EAAK,IAkBvC,GAfIa,GAAQ,UAAYA,EAAO,UAC3BgK,EAAQ,KACR5rB,EAAS,MACF4hB,GAAQ,UAAYA,EAAO,UAClCgK,EAAQ,KACR5rB,EAAS,MACF4hB,GAAQ,UAAYA,EAAO,UAClCgK,EAAQ,KACR5rB,EAAS,MACF4hB,GAAQ,WACfgK,EAAQ,KACR5rB,EAAS,MAIT4rB,GAAS5rB,EAAQ,CACjB,IAAI6qB,EAAgBe,EAChBzvB,EAAM2S,IAAIic,sBAGVF,EAAgB1uB,EAAM2S,IAAIic,oBAAoB,SAAUa,IAEvDzvB,EAAMknB,UAAU4H,QAAiB,QAAU,OAAEJ,IAG9C1uB,EAAMknB,UAAU2H,iBAAiB,UAAW,SAAUH,EAAe,MAErE1uB,EAAMknB,UAAU4H,QAAiB,QAAU,OAAEJ,KAC7Ce,EAAQzvB,EAAMknB,UAAU4H,QAAiB,QAAU,OAAEJ,IAEzD7I,EAAO4J,GAAShY,EAAM5T,EAC1B,CACA,OAAOgiB,CACX,EAMAznB,EAAIgsB,KAAKmtB,MAAM1xB,KAAY,MAAI,SAAU7lB,EAAOyX,GAE5C,IADAA,EAAMA,EAAIm5B,aACgB,IAAfn5B,EAAIhX,OACX,OAAOgX,EAAI0/C,OAAO,EAE1B,EAOA/4D,EAAIgsB,KAAKmtB,MAAM1xB,KAAKnI,QAAU,SAAU1d,EAAOyX,GAC3C,IAAOw5B,EAEHzuC,EAQJ,KARIA,GADJiV,EAAM,GAAKA,GACChV,MAAM,eAEdwuC,EAAMx5B,EAAIlV,MAAM,GAAkB,EAAfC,EAAE,GAAG/B,QACxBgX,EAAMjV,EAAE,KAERyuC,EAAMx5B,EACNA,EAAM,IAEHA,EAAIhX,OAAS,GAChBgX,EAAM,IAAMA,EAEhB,OAAQw5B,EAAMx5B,CAClB,EAQArZ,EAAIgsB,KAAKmtB,MAAM6f,eAAiB,SAAU3/C,EAAK4/C,GAC3C,IAAI7tD,EASJ,GARKiO,IACDA,EAAM,IAEVA,EAAM,GAAKA,GACFhV,MAAM,cACXgV,EAAM,GAEVA,EAAMC,SAASD,EAAK,IAChB4/C,EAAW,CACX,IAAIrkD,EAAM,CAACyF,KAAM,SAAUhB,IAAKA,GAChC,GAAIzE,EAAIyE,IAAM,GAAKzE,EAAIyE,IAAM,GACzBzE,EAAIyE,IAAM,MACP,CACH,KAAOzE,EAAIyE,IAAM,IACbzE,EAAIyE,IAAMzE,EAAIyE,IAAM,EAEpBzE,EAAIyE,IAAM,KACVzE,EAAIyF,KAAO,UACXzF,EAAIyE,IAAMzE,EAAIyE,IAAM,GAE5B,CACAjO,EAAMwJ,CACV,MACQyE,EAAM,GAAKA,EAAM,MACjBA,EAAM,GAEVjO,EAAMiO,EAEV,OAAOjO,CACX,EAEApL,EAAIgsB,KAAKmtB,MAAM5yB,MAAQ,CAAC,EAMxBvmB,EAAIgsB,KAAKmtB,MAAM5yB,MAAMjH,QAAU,SAAU1d,EAAOyX,GAK5C,OAJIA,EAAMrZ,EAAIgsB,KAAKmtB,MAAM6f,eAAe3/C,MAEpCA,EAAM,IAEHA,CACX,EAMArZ,EAAIgsB,KAAKmtB,MAAM5yB,MAAM,yBAA2B,SAAU3kB,EAAOyX,GAE7D,GADIA,EAAMrZ,EAAIgsB,KAAKmtB,MAAM6f,eAAe3/C,GAKpC,IADAA,EAAM,GAAKA,EACJA,EAAIhX,OAAS,GAChBgX,EAAM,IAAMA,OAJhBA,EAAM,GAOV,OAAOA,CACX,EASArZ,EAAIgsB,KAAKmtB,MAAM5yB,MAAY,KAAI,SAAU3kB,EAAOyX,EAAKkU,EAAQC,GACzD,IAAI5Y,EAAM5U,EAAIgsB,KAAKmtB,MAAM6f,eAAe3/C,GAAK,GAE7C,GADIA,EAAMzE,EAAIyE,IAGP,CAEH,IADAA,EAAM,GAAKA,EACJA,EAAIhX,OAAS,GAChBgX,EAAM,IAAMA,EAEhBA,EAAMzX,EAAM+qB,QAAQ/X,EAAIyF,KAAOhB,EAAK,OAAQ,EAAG,GAAG,EAAOmU,EAC7D,MAPInU,EAAM,GAQV,OAAOA,CACX,EASArZ,EAAIgsB,KAAKmtB,MAAM5yB,MAAa,MAAI,SAAU3kB,EAAOyX,EAAKkU,EAAQC,GAC1D,IAAI5Y,EAAM5U,EAAIgsB,KAAKmtB,MAAM6f,eAAe3/C,GAAK,GAE7C,GADIA,EAAMzE,EAAIyE,IAGP,CAEH,IADAA,EAAM,GAAKA,EACJA,EAAIhX,OAAS,GAChBgX,EAAM,IAAMA,EAEhBA,EAAMzX,EAAM+qB,QAAQ/X,EAAIyF,KAAOhB,EAAK,QAAS,EAAG,GAAG,EAAOmU,EAC9D,MAPInU,EAAM,GAQV,OAAOA,CACX,EAMArZ,EAAIgsB,KAAKmtB,MAAM3yB,IAAM,CAAC,EAMtBxmB,EAAIgsB,KAAKmtB,MAAM3yB,IAAIlH,QAAU,SAAU1d,EAAOyX,GAC1C,OAAOA,EAAIm5B,UACf,EAEAxyC,EAAIgsB,KAAKmtB,MAAM3yB,IAAU,KAAIxmB,EAAIgsB,KAAKmtB,MAAM3yB,IAAIlH,QAMhDtf,EAAIgsB,KAAKmtB,MAAM3yB,IAAI,yBAA2B,SAAU5kB,EAAOyX,GAK3D,IAJKA,IACDA,EAAM,GAEVA,EAAMA,EAAIm5B,WACHn5B,EAAIhX,OAAS,GAChBgX,EAAM,IAAMA,EAEhB,OAAOA,EAAIm5B,UACf,EAQAxyC,EAAIgsB,KAAKmtB,MAAM3yB,IAAI0yC,QAAU,SAAUt3D,EAAOyX,EAAKkU,GAC/C,OAAO3rB,EAAM0C,IAAI6nB,YAAY+N,OAAO7gB,EAAKkU,EAC7C,EAQAvtB,EAAIgsB,KAAKmtC,KAAO,CAAC,EAMjBn5D,EAAIgsB,KAAKmtC,KAAKC,mBAAqB,SAAUj5D,GACzC,IAAIiE,EAOJ,MANI,iBAAoBjE,IACpBiE,EAAIjE,EAAIkE,MAAM,uCAEdD,IACAjE,EAAMA,EAAI44D,OAAO30D,EAAE,GAAG/B,SAEnBlC,CACX,EAIAH,EAAIgsB,KAAK+rB,gBAAkB,SAAUn2C,EAAO4f,GACxC,IAAIgW,EAAeggC,EAAS6B,EAAWj3C,EAAM+4B,EAAcC,EAAUke,EACrEl3C,EAAO,SAAUxgB,EAAOgD,EAAMf,GAC1B,IAAK,IAAI1B,EAAI,EAAGC,EAAOzB,KAAK2R,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3D,GAAI,mBAAqBxB,KAAK2R,YAAYnQ,GAAG,IAAM,SAAWxB,KAAK2R,YAAYnQ,GAAG,GAAI,CAClFP,EAAMhB,IAAIk3B,eAAiB,EAC3B,KACJ,CAER,EACAn3B,KAAK0gB,MAAM/b,KAAK8c,GACZzhB,KAAK2R,aAAe1Q,EAAMC,IAAIiC,uBAAuBwmB,6BACrD3pB,KAAK2R,YAAY7G,UACjB9K,KAAK2R,YAAYhN,KAAK,CAAC,UAAU,OAAQ3E,KAAK4hB,QAC9C5hB,KAAK2R,YAAY7G,WAOrB6tD,EAAY,CAAC,SAAU,OAAQ,UAC1B,SAAW34D,KAAK0F,OAAS1F,KAAKihB,iBAAoB03C,EAAU51D,QAAQ/C,KAAK0F,OAAS,KACnFmxB,EAAgB,SAAU51B,EAAOgD,EAAMf,GACK,WAApCjC,EAAMhB,IAAI42B,cAAc5lB,SAAwB,UAAYjR,KAAK0F,OAC5DzE,EAAMhB,IAAIq2B,cAAgBpzB,GAAQA,EAAK,gBAAqC,WAAnBjC,EAAMhB,IAAIoN,MAC/DpM,EAAMhB,IAAIotC,6BAEXpsC,EAAMhB,IAAI42B,cAAclyB,KAAK,gBAGhC1D,EAAMhB,IAAIq2B,cAAgBpzB,GAAQA,EAAK,qBACnCjC,EAAMhB,IAAIotC,6BACXpsC,EAAMhB,IAAI42B,cAAclyB,KAAK,iBAIhC,SAAW3E,KAAK0F,MAChBzE,EAAMhB,IAAIq2B,cAAgBpzB,GAAQA,EAAK,gBAAqC,WAAnBjC,EAAMhB,IAAIoN,MAChEpM,EAAMhB,IAAIotC,6BACVpsC,EAAMhB,IAAI42B,cAAclyB,KAAK,gBAWhC1D,EAAMhB,IAAIq2B,cAAgBpzB,GAAQA,EAAK,gBAAqC,WAAnBjC,EAAMhB,IAAIoN,MAE/DpM,EAAMhB,IAAIotC,6BAA+BpsC,EAAMhB,IAAI6uD,sBAEpD7tD,EAAMhB,IAAI42B,cAAclyB,KAAK,eAE1BzB,GAAQA,EAAK,oBACpBjC,EAAMhB,IAAI42B,cAAclyB,KAAK,qBAGzC,EACA3E,KAAK0gB,MAAM/b,KAAKkyB,IAEpBggC,EAAU72D,KAAK8R,QAAQY,IACvB1S,KAAK8R,QAAQY,KAAM,EACsB,IAArCzR,EAAMsgB,MAAM4gB,uBAQa,iBAArBlhC,EAAMsgB,MAAMlU,MAA2BpM,EAAMioB,aAAahoB,IAAI,wBAC9Dw3D,EAAY,IAAIr5D,EAAI8hB,MAAM,QAAS9hB,EAAI0H,QAC7B4K,YAAc,CAAC,CAAC,WAAY,gBACtC8P,EAAO,SAAUxgB,EAAOgD,GACfhD,EAAMhB,IAAImiC,cACXs2B,EAAU5mD,QAAQmmB,WAAah0B,EAAKoqB,GACpCptB,EAAMqoB,OAAOyM,SAAS,YAAa2iC,GAE3C,EACAA,EAAUh4C,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAK+zD,IACLr5D,EAAI6K,gBAAgBnH,QAAQ8zD,IAAY,KAC/C6B,EAAY,IAAIr5D,EAAI8hB,MAAM,QAAS9hB,EAAI0H,QAC7B4K,YAAc,CAAC,CAAC,WAAYklD,IACtCp1C,EAAO,SAAUxgB,EAAOgD,GACpBy0D,EAAU5mD,QAAQmmB,WAAah0B,EAAKoqB,GACpCptB,EAAMqoB,OAAOyM,SAAS,YAAa2iC,EACvC,EACAA,EAAUh4C,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAK+zD,IAEhBz3D,EAAMsgB,MAAM7O,IAAMmkD,GAEtB51D,EAAMsgB,MAAM4gB,sBAAwB,EAGS,IAAzClhC,EAAMsgB,MAAM0gB,iBAAiBhxB,UAU7BupC,EAAe,IAAIn7C,EAAI8hB,MAAM,SAAU9hB,EAAI0H,OAC3C1H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKw7B,EAAcv5C,EAAO4f,GAOhDY,EAAO,WACH,QAAIxgB,EAAMhB,IAAIu/B,eAAevuB,OAIjC,GAXAwpC,EAAW,IAAIp7C,EAAI8hB,MAAM,KAAM9hB,EAAI0H,QAY1Bu7B,QAAamY,EAASnY,MAAQ,IACvCmY,EAASnY,MAAM39B,KAAK8c,GACpBg5B,EAAShpC,KAAOxQ,EAAM0C,IAAID,MAAMg3C,IAAI16C,KAAMiB,EAAOw5C,EAASnY,OAC1DzhB,EAAOlc,KAAK81C,IAGZx5C,EAAM2S,IAAIoU,iBACPhoB,KAAKwuD,gBACLxuD,KAAKwuD,eAAe9sD,SAEvB+f,EAAO,SAAUxgB,EAAOgD,EAAMf,GAC1B,IAAKjC,EAAMhB,IAAIq2B,eAAiBr1B,EAAMhB,IAAIm4B,qBAAsB,CAG5D,IAAIwgC,EAAiB,IAAIv5D,EAAI8hB,MAAM,OAAQ9hB,EAAI0H,OAC/C6xD,EAAejnD,YAAc,CAAC,CAAC,UAAW,SAC1C1Q,EAAMqoB,OAAOyM,SAAS,iBAAkB6iC,GACxC,IAAI7wB,EAAW,KACX7kC,IACA6kC,EAAW7kC,EAAK6kC,UAEfA,IACDA,EAAW,GAEf,IAOI8wB,EAAa,EACb31D,GAAQA,EAAK6gC,YACb80B,EAAa31D,EAAK6gC,WAEtB,IAAI+0B,EAA2B,EAC3B51D,GAAQA,EAAK,iCACb41D,EAA2B51D,EAAK,gCAEpC,IAAI61D,EAAoC,EACpC71D,GAAQA,EAAK,2CACb61D,EAAoC71D,EAAK,0CAE7C,IAAI81D,EAAiB,EAEjB91D,GAAQA,EAAK,qBACb81D,EAAiB91D,EAAK,oBAE1B,IAAIwkB,EAAQ,EACRxkB,GAAQA,EAAKwkB,QACbA,EAAQxkB,EAAKwkB,OAEjB,IAAI+J,EAAS,CACTwnC,SAAUh1D,EACVi1D,cAAel5D,KAAKmjB,UACpBw2B,QAAS14C,EAAMhB,IAAIoN,KACnBlM,OAAQF,EAAMC,IAAIC,OAClB4mC,SAjCc,CACd,QACA,uBACA,aACA,OACA,qBA4BsBA,GACtB,cAAe8wB,EACf,8BAA+BC,EAC/B,wCAAyCC,EACzC,kBAAmBC,EACnB,MAAStxC,EACT,KAAQzmB,EAAMC,IAAIsM,MAEtBvM,EAAMqoB,OAAO4L,QAAQjkB,QAAQwgB,OAASA,CAC1C,CACJ,EACAzxB,KAAK0gB,MAAM/b,KAAK8c,GAExB,EAGApiB,EAAIgsB,KAAKssB,cAAgB,SAAU12C,EAAO4f,GACtC,IAAIY,EAAM03C,EAAeC,EAAWxe,EAAQa,EAA+Bj8C,EA4D3E,GA1DIyB,EAAM2S,IAAIoU,kBACNhoB,KAAKojB,aAAgBpjB,KAAKwuD,gBAAkBxuD,KAAKwuD,eAAe9sD,UAEpE+f,EAAO,SAAUxgB,GACRA,EAAMhB,IAAIq2B,cAAiBr1B,EAAMhB,IAAIm4B,sBACtCn3B,EAAMqoB,OAAO2M,OAAO,iBAE5B,EACAj2B,KAAK0gB,MAAM/b,KAAK8c,IAGpBA,EAAO,SAAUxgB,GACb,IAAK,IAAIO,EAAI,EAAGC,EAAOzB,KAAK2R,YAAYjQ,OAAQF,EAAIC,EAAMD,GAAK,EAC3D,GAAI,mBAAqBxB,KAAK2R,YAAYnQ,GAAG,IAAM,SAAWxB,KAAK2R,YAAYnQ,GAAG,GAAI,CAClFP,EAAMhB,IAAIk3B,gBAAkB,EAC5B,KACJ,CAER,EACAn3B,KAAK0gB,MAAM/b,KAAK8c,GAEhBxgB,EAAMsgB,MAAM4gB,uBAAyB,EACI,IAArClhC,EAAMsgB,MAAM4gB,uBACRlhC,EAAMsgB,MAAM7O,KACZ+O,EAAO,SAAUxgB,GACbA,EAAMqoB,OAAO2M,OAAO,YACxB,EACAj2B,KAAK0gB,MAAM/b,KAAK8c,GAChBxgB,EAAMsgB,MAAM7O,KAAM,GACU,iBAArBzR,EAAMsgB,MAAMlU,MAA2BpM,EAAMioB,aAAahoB,IAAI,wBAGrEugB,EAAO,SAAUxgB,GACRA,EAAMhB,IAAImiC,aACXnhC,EAAMqoB,OAAO2M,OAAO,YAE5B,GANAkjC,EAAgB,IAAI95D,EAAI8hB,MAAM,QAAS9hB,EAAI2H,MAO7B0Z,MAAM/b,KAAK8c,GACzBZ,EAAOlc,KAAKw0D,IACZC,EAAY,IAAI/5D,EAAI8hB,MAAM,QAAS9hB,EAAI0H,QAC7B4K,YAAc,CAAC,CAAC,WAAY,iBACtC8P,EAAO,SAAUxgB,GACRA,EAAMhB,IAAImiC,cACXnhC,EAAMhB,IAAImiC,aAAc,EACxBnhC,EAAMqoB,OAAOyM,SAAS,YAAaqjC,GAE3C,EACAA,EAAU14C,MAAM/b,KAAK8c,GACrBZ,EAAOlc,KAAKy0D,KAGyB,IAAzCn4D,EAAMsgB,MAAM0gB,iBAAiBhxB,UAC7B2pC,EAAS,IAAIv7C,EAAI8hB,MAAM,KAAM9hB,EAAI2H,KACjC6Z,EAAOlc,KAAKi2C,GACZa,EAAa,IAAIp8C,EAAI8hB,MAAM,SAAU9hB,EAAI2H,KACzC3H,EAAIyiB,KAAK60B,OAAOp1B,MAAMvC,KAAKy8B,EAAYx6C,EAAO4f,IAG9C,UAAY7gB,KAAK0F,MAAS,SAAW1F,KAAK0F,MAAgC,UAAxB1F,KAAKwuD,eAA6B,CAChE,IAAInvD,EAAI8hB,MAAM,OAAQ9hB,EAAI4H,WAC9C,IAAIoyD,EAAoBr5D,KAAK0F,KAC7B+b,EAAO,SAAUxgB,EAAOgD,GACpB,GAAuB,iBAAnBhD,EAAMhB,IAAIoN,MAGV,iBAAoBpM,EAAMioB,aAAahoB,IAAI,mCAG3ClB,KAAKwuD,gBAAmBvqD,EAAKjE,KAAKwuD,oBAMlCxuD,KAAKwuD,gBAAwC,UAAtB6K,GAA3B,CAIA,IACI73D,EAAGC,EADH63D,EAAUr4D,EAAMioB,aAAahoB,IAAI,qCAIrC,IADgBD,EAAMhB,IAAIm4B,sBACVn3B,EAAMhB,IAAI8tC,iCAClB9sC,EAAMhB,IAAI4+C,cAAe,CACzB,GAAI,iBAAmBya,GAAW,kBAAoBA,EAAS,CAC3D,IAAIC,GAAQ,EACR1a,EAAgB,GAIpB,IAAKr9C,EAAI,EAAGC,EAAOR,EAAMhB,IAAIstC,UAAUx4B,SAASrT,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACtE,IAAIkE,EAAOzE,EAAMhB,IAAI4+C,cAAcr9C,GAC/B+3D,GACGt4D,EAAMhB,IAAIqwC,oBAAsBrvC,EAAMhB,IAAIqwC,mBAAmB5uC,OAAUF,EAAI,GAC3EkE,IAASA,EAAKuZ,cAAche,EAAMhB,IAAIqwC,mBAAmB9uC,KAC5DhC,EAAM,IAAIH,EAAI+2B,KAAKn1B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,iCAC7CD,EAAMhB,IAAIstC,UAAUx4B,SAASvT,GAAG4zB,MAAQ,CAAC51B,GACrC,kBAAoB85D,IACpBC,GAAQ,IAGZA,GAAQ,EAEZ1a,EAAcl6C,KAAKe,EACvB,CAEAzE,EAAMhB,IAAIqwC,mBAAqBuO,CACnC,MAAO,GAAI,kBAAoBya,EAAS,CAEpC,GADIza,EAAgB59C,EAAMhB,IAAI4+C,cAAcl9C,KAAK,KAC9B,CACf,GAAIV,EAAMhB,IAAIqwC,qBAAuBuO,EAAc5/B,cAAche,EAAMhB,IAAIqwC,oBACvE,IAAK9uC,EAAI,EAAGC,EAAOR,EAAMhB,IAAIstC,UAAUx4B,SAASrT,OAAQF,EAAIC,EAAMD,GAAK,EACnEhC,EAAM,IAAIH,EAAI+2B,KAAKn1B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,iCAC7CD,EAAMhB,IAAIstC,UAAUx4B,SAASvT,GAAG4zB,MAAQ,CAAC51B,GAGjDyB,EAAMhB,IAAIqwC,mBAAqBuO,CACnC,CACJ,KAAO,EACCA,EAAgB59C,EAAMhB,IAAI4+C,cAAcl9C,KAAK,QAEzCV,EAAMhB,IAAIqwC,qBAAuBuO,EAAc5/B,cAAche,EAAMhB,IAAIqwC,sBACvE9wC,EAAM,IAAIH,EAAI+2B,KAAKn1B,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAI,iCACzCD,EAAMhB,IAAIigD,WACVj/C,EAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAQ,CAAC51B,EAAIyB,EAAMhB,IAAIigD,YACxCj/C,EAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAM1zB,OACrCT,EAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAM,GAAGA,MAAQ,CAAC51B,GAE1CyB,EAAMhB,IAAIstC,UAAUrhC,IAAIkpB,MAAQ,CAAC51B,GAErCyB,EAAMhB,IAAIu5D,qBAAuBH,GAErCp4D,EAAMhB,IAAIqwC,mBAAqBuO,EAEvC,CACA59C,EAAMhB,IAAI8tC,iCAAkC,CAChD,CA5DJ,CA8DJ,EACA/tC,KAAK0gB,MAAM/b,KAAK8c,EACpB,EAEK,SAAWzhB,KAAK0F,OAAS1F,KAAKihB,iBAAoB,CAAC,SAAU,OAAQ,SAASle,QAAQ/C,KAAK0F,OAAS,KAErG+b,EAAO,SAAUxgB,EAAOgD,GAQhBhD,EAAMhB,IAAI42B,cAAc5W,QAAQve,OAAO,GACvCT,EAAMhB,IAAI42B,cAAc7rB,KAEhC,EACAhL,KAAK0gB,MAAM/b,KAAK8c,GAExB,EAIApiB,EAAIgsB,KAAK6xB,QAAU,SAAUxkC,GACzB,IAAIjV,EAAIiV,EAAIhV,MAAM,qBAClB,GAAID,EAMA,KALAiV,EAAMC,SAASlV,EAAE,GAAI,KACX,IACNiV,EAAM,KAAuBA,GAEjCA,EAAM,GAAKA,EACJA,EAAIhX,OAAS,IAChBgX,EAAM,IAAMA,EAGpB,OAAOA,CACX,EAEArZ,EAAIgsB,KAAKqW,gBAAkB,WAAa,EAExCriC,EAAIgsB,KAAKqW,gBAAgB1sB,UAAUyW,KAAO,SAAUxqB,GAChDjB,KAAKiB,MAAQA,CACjB,EAEA5B,EAAIgsB,KAAKqW,gBAAgB1sB,UAAUukB,OAAS,SAAU7gB,EAAKkU,GACnDlU,EAAM,KACNA,EAAM,IAAMA,GAGhB,IAAIjO,EAAMpL,EAAI4nB,OAAO6F,SACjBztB,EAAI+J,MACJpJ,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMwqB,MACvC,gBAAkBrU,EAClB,OACA,EACAkU,GAOJ,OALKniB,IACDA,EAAMzK,KAAKiB,MAAM0C,IAAI6nB,YAAY+N,OAAO7gB,EAAKkU,IAGjD5sB,KAAKiB,MAAMhB,IAAI+sB,sBAAuB,EAC/BviB,CACX,EAGApL,EAAIgsB,KAAKoW,YAAc,SAAUxgC,GAC7BjB,KAAKiB,MAAQA,EACbjB,KAAKy5D,SAAW,CAAC,CACrB,EAEAp6D,EAAIgsB,KAAKoW,YAAYzsB,UAAUyW,KAAO,WAClC,IAAKzrB,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAO,CACrCvC,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAQ,CAAC,EACtC,IAAK,IAAIf,EAAI,EAAaA,EAAH,EAAaA,GAAK,EAAG,CACxC,IAAIorB,EAAS,MAACyJ,EAAW,YAAa,YAAY70B,GAClDxB,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAU,GAC7C,IAAK,IAAI9pB,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,CAC3B,IAAIy1D,EAAUv4D,KAAKiB,MAAM+qB,QAAQ,YAAclpB,EAAG,QAAQ,EAAO8pB,GACjE,QAAI,IAAuB2rC,EAAS,QACzBv4D,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAC1C,KACJ,CACA5sB,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQjoB,KAAK4zD,EACpD,CACJ,CACJ,CACJ,EAEAl5D,EAAIgsB,KAAKoW,YAAYzsB,UAAUukB,OAAS,SAAU7gB,EAAKkU,GACnD,IAAIptB,EAEJA,EAAM,IADNkZ,EAAMC,SAASD,EAAK,KAEpB,IAAIjS,EAAS,GACTizD,EAAa,GAKjB,GAJI9sC,GACA8sC,EAAW/0D,KAAKioB,GAEpB8sC,EAAW/0D,KAAK,UACZ3E,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMsyC,IAAI,SAAU,CAErD,IAAI8kB,EADJlzD,EAASzG,KAAKiB,MAAM+qB,QAAQ,WAAU,EAAM,EAAEY,GAE9C,IAAK,IAAIprB,EAAI,EAAGC,EAAOi4D,EAAWh4D,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACxDm4D,EAAYD,EAAWl4D,GACvB,IAAIo4D,EAAU55D,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMsyC,IAAI,SAQzD,GAPI+kB,EAAQ,gBAAgBp6D,IAAQo6D,EAAQ,gBAAgBp6D,GAAKm6D,GAC7DlzD,EAASzG,KAAKiB,MAAM+qB,QAAQhsB,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMsyC,IAAI,SAAS,gBAAgBr1C,GAAKm6D,IAAW,EAAM,EAAE/sC,GACjHgtC,EAAQ,mBAAmBp6D,EAAIgE,MAAMhE,EAAIkC,OAAS,KAAOk4D,EAAQ,mBAAmBp6D,EAAIgE,MAAMhE,EAAIkC,OAAS,IAAIi4D,GACtHlzD,EAASzG,KAAKiB,MAAM+qB,QAAQhsB,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMsyC,IAAI,SAAS,mBAAmBr1C,EAAIgE,MAAMhE,EAAIkC,OAAS,IAAIi4D,IAAW,EAAM,EAAE/sC,GAC1IgtC,EAAQ,cAAcp6D,EAAIgE,MAAMhE,EAAIkC,OAAS,KAAOk4D,EAAQ,cAAcp6D,EAAIgE,MAAMhE,EAAIkC,OAAS,IAAIi4D,KAC5GlzD,EAASzG,KAAKiB,MAAM+qB,QAAQhsB,KAAKiB,MAAM0B,OAAO3C,KAAKiB,MAAMC,IAAIqB,MAAMsyC,IAAI,SAAS,cAAcr1C,EAAIgE,MAAMhE,EAAIkC,OAAS,IAAIi4D,IAAW,EAAM,EAAE/sC,IAE5InmB,EACA,KAER,CACJ,MACSmmB,IAGDA,OAASyJ,GAEbr2B,KAAKiB,MAAM0C,IAAI6nB,YAAYC,OAEvBhlB,EADCiS,EAAM,GAAM,IAAO,GAAMA,EAAM,IAAMA,EAAM,GACnC1Y,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQ,GAC7ClU,EAAM,IAAO,GAAKA,EAAM,KAAQ,GAC9B1Y,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQ,GAC7ClU,EAAM,IAAO,GAAKA,EAAM,KAAQ,GAC9B1Y,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQ,GAC7ClU,EAAM,IAAO,GAAKA,EAAM,KAAQ,GAC9B1Y,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQ,GAE3C5sB,KAAKy5D,SAASz5D,KAAKiB,MAAMC,IAAIqB,MAAMqqB,GAAQ,GAI5D,OADAptB,EAAMA,GAAOiH,CAEjB,EAEApH,EAAIgsB,KAAKmW,UAAY,WAAa,EAElCniC,EAAIgsB,KAAKmW,UAAUxsB,UAAUukB,OAAS,SAAU7gB,GAC5C,IAAIjO,EAAK0I,EAAKsf,EAAGonC,EAAQzmD,EAEzB,GADA3I,EAAM,GACFiO,EAAM,IAMN,KALAmhD,EAASnhD,EAAIm5B,WAAWtwC,MAAM,KACvBuJ,UACPqI,EAAM,EACNsf,EAAI,EACJrf,EAAMymD,EAAOn4D,OACRyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5Bsf,EAAI9Z,SAASkhD,EAAO1mD,GAAM,IAC1B1I,EAAMpL,EAAI0O,eAAeoF,GAAKsf,GAAKhoB,EAG3C,OAAOA,CACX,EAOApL,EAAIgsB,KAAKiW,WAAa,SAAUw4B,GACvBA,IACDA,EAAQz6D,EAAIyO,cAEhB9N,KAAK85D,MAAQA,EAAMv4D,MAAM,IAC7B,EASAlC,EAAIgsB,KAAKiW,WAAWtsB,UAAUukB,OAAS,SAAUwgC,GAG7C,IAAIC,EACJD,GAAK,EACL,IAAI90D,EAAM,GACV,EAAG,CACC+0D,EAAMD,EAAI,IAAQ,EAAK,GAAMA,EAAI,GAC7B90D,EAAMjF,KAAK85D,MAAME,EAAE,GAAK/0D,EAC5B80D,GAAKA,EAAIC,GAAK,EAClB,OAAgB,IAAND,GACV,OAAO90D,CACX,EAGA5F,EAAI4nB,OAAOjS,UAAU84C,cAAgB,SAAU/2C,EAAMkjD,EAAY5iD,GAE7D,IAAInS,EAEAqZ,EAAKve,KAELk6D,EAAe7iD,EACnBA,EAAyB,eAAbA,EAA6B,OAASA,EAElD,IAAI8iD,EAAc,2BACgB,OAA9Bn6D,KAAKkB,IAAIqB,KAAKiB,MAAM,EAAG,KACvB22D,GAAe,SAAWn6D,KAAKgsB,QAAQ,OAAS,YAAchsB,KAAKgsB,QAAQ,OAAS,QAExF,IAAIouC,EAAY,YACZC,EAAS,IAAI75D,OAAO,IAAM45D,EAAW,KACrCE,EAAiB,IAAI95D,OAAO,IAAM45D,EAAY,IAAMD,EAAc,2CAA4C,KAC9GI,EAAiB,IAAI/5D,OAAO,MAAQ45D,EAAY,IAAMD,EAAc,4CAKpEK,EAAYx6D,KAAKgsB,QAAQ,OACzByuC,EAAkBz6D,KAAKgsB,QAAQ,MAAO,UAwD1C,SAAS0uC,EAAkBC,EAAWjqC,EAAOxrB,EAAK01D,EAAeC,GAC7DD,EAAgBA,GAAgC,GAChD,IAAIzf,EAAO,CAAC,EAMZ,GAJKzqB,GAAUrxB,EAAIuB,+BAA+ByW,KAC9CqZ,EAAQ,OAAQrZ,GAGhBqZ,EAAO,CACP,IAAIjtB,EAAIitB,EAAMhtB,MAAM,sBACC,SAAjBw2D,GAA6C,IAAlBW,IAAwD,IAAjC,CAAC,KAAM,OAAO93D,QAAQU,EAAE,KAC1E03C,EAAK6V,kBAAmB,EACxB7V,EAAK8V,iBAAkB,GAEvB9V,EAAK8V,iBAAkB,EAE3B9V,EAAKzqB,MAAQjtB,EAAE,GACf03C,EAAKwf,UAAYA,EACjBxf,EAAK2f,YAAcr3D,EAAE,GAAKA,EAAE,GAAK,GACjC03C,EAAKxuB,OAAS,CAClB,CAYA,OAVIlpB,EAAIyB,EAAIxB,MAAM,6DAGdy3C,EAAKjjB,SAAWz0B,EAAE,GAAKA,EAAE,GAAK,GAC9B03C,EAAKlqC,MAAQxN,EAAE,KAEf03C,EAAKjjB,SAAW,GAChBijB,EAAKlqC,MAAQ/L,GAEjBi2C,EAAKyf,cAAgBA,EAAc92D,QAAQ,UAAW,KAC/Cq3C,CACX,CA8JA,SAAS4f,EAAmB/pC,EAAQxvB,EAAGw5D,GACnC,IAAI7pB,EAASngB,EAAOgqC,EAAiB7nD,KACjCjO,EAAM8rB,EAAOxvB,GAAGyP,MAChBgqD,EAA2C,QAAzB9pB,EAAOypB,cACzB11D,EAAIgzB,UAAYhzB,EAAIgzB,WAAaiZ,EAAOjZ,WACxC8iC,EAAiBE,aAAc,GAEnC,IAAIC,EAAOj2D,EAAIxB,MAAM,0BACjB03D,EAAgBjqB,EAAOlgC,MAAMvN,MAAM,gDAavC,GAZKwB,GAAQi2D,GAASC,IAAiBH,IACnCD,EAAiBE,aAAc,EAC1Bh2D,GAAQk2D,IACTJ,EAAiBr8C,SAAU,GAE3Bs8C,GACAD,EAAiB1mC,UAGpB6mC,GAAQA,EAAK,IAAQC,GAAiBA,EAAc,MACrDJ,EAAiBE,aAAc,QAE/B7kC,IAAcrF,EAAOxvB,GAAG05D,YAAa,CACrC,IAAK,IAAIp4D,EAAEtB,EAAEkD,EAAKlD,EAAEw5D,EAAiB1mC,MAAMxxB,EAAE4B,EAAK5B,IAC1C6pD,MAAMh0C,SAASqY,EAAOluB,GAAGmO,UAAY+f,EAAOluB,GAAGmO,MAAMvN,MAAM,qBAC3DstB,EAAOluB,GAAGo4D,aAAc,EAExBlqC,EAAOluB,GAAGo4D,aAAc,EAGhCF,EAAiBE,YAAclqC,EAAOxvB,GAAG05D,WAC7C,CACA,IAAIG,EAAgBL,EAAiBE,YACrC,IAASp4D,EAAEk4D,EAAiB7nD,IAAIzO,EAAMs2D,EAAiB7nD,IAAM6nD,EAAiB1mC,MAAQxxB,EAAE4B,EAAM5B,IACtFk4D,EAAiB1mC,MAAQ,GAAK+mC,IAC9BrqC,EAAOluB,GAAG6pB,OAAS,GAEvBqE,EAAOluB,GAAG6b,QAAUq8C,EAAiBr8C,QACrCqS,EAAOluB,GAAGo4D,YAAcF,EAAiBE,WAEjD,CAEA,SAASI,EAAmBtqC,EAAQuqC,EAAeP,GACJ,SAAvCA,EAAiBtqC,MAAMltB,MAAM,EAAG,KACH,IAAzBw3D,EAAiB7nD,KACb,CAAC,UAAW,SAAU,gBAAiB,QAAQpQ,QAAQsU,IAAa,QAEhE,IAAuBkH,EAAGyN,QAAQ3sB,EAAIsB,uBAAuBq6D,EAAiBtqC,UAC9EM,EAAOgqC,EAAiB7nD,KAAK89C,iBAAkB,IAOmB,IAAtE,CAAC,UAAW,SAAU,gBAAiB,QAAQluD,QAAQsU,IACnDhY,EAAIsB,uBAAuBq6D,EAAiBtqC,SAAWrZ,IACvD2Z,EAAO,GAAGigC,iBAAkB,IAOpCjgC,EAAOgqC,EAAiB7nD,KAAK89C,iBAAkB,EAI3D,CAyCA,SAASuK,EAAqBZ,GAC1B,OAAOA,EAAc92D,QAAQ,MAAO,IACxC,CAEA,SAAS23D,EAAWzqC,GAChB,IAAI0qC,EAAar8D,EAAIgsB,KAAK4rB,WAAWlgC,GACjC4kD,EAAgB,IAAIt8D,EAAI8hB,MACvB5C,EAAGte,IAAIq2B,eAERqlC,EAAchqD,YAAc+pD,EAAW/pD,YACvC+pD,EAAW/pD,YAAc,GASzBgqD,EAAc7pD,QAAQ9L,OAAS01D,EAAW5pD,QAAQ9L,OAClD01D,EAAW5pD,QAAQ9L,OAAS,GAC5B21D,EAAc7pD,QAAQrL,OAASi1D,EAAW5pD,QAAQrL,OAClDi1D,EAAW5pD,QAAQrL,OAAS,IAEhC,IAAIm1D,EAAc5qC,EAAOtvB,OAASsvB,EAAO,GAAGN,MAAQ,KACpD,GAAIM,EAAOtvB,OAAQ,CACf,IAAK,IAAIF,EAAE,EAAEC,EAAKuvB,EAAOtvB,OAAQF,EAAEC,EAAMD,IAAK,CAC1C,IAAI0D,EAAM8rB,EAAOxvB,GAEbq6D,EAAUx8D,EAAIgsB,KAAK4rB,WAAWykB,GAClCG,EAAQjvC,OAAS7V,EAAK6V,OAClBgvC,IAAgB12D,EAAIwrB,QACpBmrC,EAAQviC,UAAYviB,EAAKuiB,WAEzBp0B,EAAIyZ,UACJk9C,EAAQrjC,iBAAmBtzB,EAAIszB,kBAEnCqjC,EAAQ/pD,QAAQrL,OAASo1D,EAAQ/pD,QAAQrL,OAAS+0D,EAAqBt2D,EAAI01D,eAC3E11D,EAAI42D,QAAUD,CAClB,CACKt9C,EAAGte,IAAIq2B,cAC2B,MAA/BtF,EAAO,GAAG/f,MAAMzN,MAAM,EAAE,IAA2D,MAA5CwtB,EAAOA,EAAOtvB,OAAO,GAAGuP,MAAMzN,OAAO,KAC5EwtB,EAAO,GAAG/f,MAAQ+f,EAAO,GAAG/f,MAAMzN,MAAM,GACxCwtB,EAAOA,EAAOtvB,OAAO,GAAGuP,MAAQ+f,EAAOA,EAAOtvB,OAAO,GAAGuP,MAAMzN,MAAM,GAAG,GACvEm4D,EAAchqD,YAAYhN,KAAK,CAAC,WAAW,IAGvD,CACA,OAAOg3D,CACX,CAgBA,SAASI,EAAU1kD,EAAUnS,GACzB,MAAO,SAAWmS,GACV,CAAC,UAAW,iBAAiBtU,QAAQsU,IAAa,IAAM,CAAC,MAAMtU,QAAQmC,EAAIwrB,QAAU,GAAK,CAAC,MAAM3tB,QAAQmC,EAAIy1D,YAAc,EACvI,CAEA,SAASqB,EAAoB3kD,EAAUnS,EAAK+2D,EAAgBC,GACxD,IAAIC,EAASJ,EAAU1kD,EAAUnS,GAC7Bk3D,EArBR,SAAmB/kD,EAAUnS,GACzB,IAEQwrB,EAFJjmB,GAAM,EAUV,MATI,CAAC,UAAW,gBAAiB,QAAQ1H,QAAQsU,IAAa,IAGtDqZ,EADAxrB,EAAIy1D,UACIz1D,EAAIy1D,UAEJz1D,EAAIwrB,MAEhBjmB,IAAQ8T,EAAGyN,QAAQ3sB,EAAIsB,uBAAuB+vB,KAE3CjmB,CACX,CASkB4xD,CAAUhlD,EAAUnS,GAoBlC,OAnBIk3D,GAA8B,MAAnBH,GACPC,KACIC,GAAU,CAAC,UAAW,gBAAiB,QAAS,SAAU,UAAW,UAAUp5D,QAAQsU,IAAa,MACpG4kD,EAAiB19C,EAAGyN,QAAQ,2BAExBiwC,EAAiB,MAGR,sBAAb5kD,KACA4kD,EAAiB19C,EAAGyN,QAAQ,2BAExBiwC,EAAiB,OAQ1BA,CACX,CAEA,SAASK,EAAkBtrC,EAAQxvB,EAAG+6D,GAClC,KAAI/6D,EAAE,IAGoB,IAAtB+6D,EAAYjoC,OAGZtD,EAAOxvB,EAAE,GAAG02B,WAAalH,EAAOxvB,GAAG02B,SAGvC,GAAkC,MAA9BlH,EAAOxvB,EAAE,GAAGo5D,cAIhB,IAAKr8C,EAAGrd,IAAI,sBAAyByX,SAASqY,EAAOxvB,EAAE,GAAGyP,MAAO,IAAM0H,SAASqY,EAAOxvB,GAAGyP,MAAO,IAC7F+f,EAAOxvB,EAAE,GAAGo5D,cAAgBoB,EAAoB3kD,EAAU2Z,EAAOxvB,GAAIwvB,EAAOxvB,EAAE,GAAGo5D,eAAe,OADpG,CAIA,IAGIp7D,EAHA0F,EAAM8rB,EAAOxvB,IAEJu6D,EAAU1kD,EAAUnS,IAElBynD,MAAMh0C,SAASqY,EAAOxvB,EAAE,GAAGyP,SAAY07C,MAAMh0C,SAASqY,EAAOxvB,GAAGyP,UAKtE,GAAK+f,EAAOxvB,EAAE,GAAGyP,OAAOvN,MAAM,gCAAkC,GAAKstB,EAAOxvB,GAAGyP,OAAOvN,MAAM,gCAC7FstB,EAAOxvB,EAAE,GAAGo5D,cAAgBr8C,EAAGyN,QAAQ,yBAE3CxsB,EAAMwxB,EAAOxvB,EAAE,GAAGyP,MAAQuqD,EAAqBxqC,EAAOxvB,EAAE,GAAGo5D,eAAiB5pC,EAAOxvB,GAAGyP,QAPtFzR,EAAMwxB,EAAOxvB,EAAE,GAAG02B,SAAWlH,EAAOxvB,EAAE,GAAGyP,MAAQ,MAAQ+f,EAAOxvB,GAAG02B,SAAWlH,EAAOxvB,GAAGyP,MACxFzR,EAAM+e,EAAG5a,IAAIgoB,aAAansB,IAQ9B,IAAIiE,EAAIjE,EAAIkE,MAAM,wFAElB,GAAID,EAAG,CACH,IAAIw4D,EAAiBx4D,EAAE,GACvBw4D,EAAiBD,EAAoB3kD,EAAUnS,EAAK+2D,EAAgBjrC,EAAOxvB,GAAGmd,SAC9EqS,EAAOxvB,EAAE,GAAG02B,SAAWz0B,EAAE,GACzButB,EAAOxvB,EAAE,GAAGyP,MAAQxN,EAAE,GACtButB,EAAOxvB,EAAE,GAAGo5D,cAAgBqB,EAC5BjrC,EAAOxvB,GAAG02B,SAAWz0B,EAAE,GACvButB,EAAOxvB,GAAGyP,MAAQxN,EAAE,EACxB,CACA84D,EAAYjoC,MAAQ,CA1BpB,MANIioC,EAAYjoC,MAAQ,CAiC5B,CAEA,SAASkoC,EAAUxrC,GAEf,GAAKja,IAGkL,IAAnL,CAAC,OAAQ,iBAAkB,oBAAqB,UAAW,QAAS,SAAU,kBAAmB,oBAAqB,SAAU,UAAW,iBAAiBhU,QAAQsU,GAAxK,CAUA,IANA,IAAIklD,EAAc,CACdjoC,MAAO,EACP5D,MAAO,KACP+rC,uBAAuB,GAGlBj7D,EAAE,EAAEC,EAAKuvB,EAAOtvB,OAAQF,EAAEC,EAAMD,IAAK,CAC1C,IAAI0D,EAAM8rB,EAAOxvB,GACjB,GAAK0D,EAAIg2D,YAKEqB,EAAY7rC,QAAUxrB,EAAIwrB,OAA+B,MAAtBxrB,EAAI01D,cAE9C2B,EAAYjoC,MAAQ,EACbioC,EAAY7rC,QAAUxrB,EAAIwrB,OAA+B,MAAtBxrB,EAAI01D,eAE9C2B,EAAYjoC,QACc,IAAtBioC,EAAYjoC,OACZgoC,EAAkBtrC,EAAQxvB,EAAG+6D,IAE1BA,EAAY7rC,QAAUxrB,EAAIwrB,OAEjC6rC,EAAY7rC,MAAQxrB,EAAIwrB,MACxB6rC,EAAYjoC,MAAQ,IAIpBioC,EAAYjoC,MAAQ,EACpBioC,EAAY7rC,MAAQxrB,EAAIwrB,WAtBN,CAClB6rC,EAAYjoC,MAAQ,EACpBioC,EAAY7rC,MAAQ,KACpB,IAAIwrC,EAAYh3D,EAAIyZ,QACpBzZ,EAAI01D,cAAgBoB,EAAoB3kD,EAAUnS,EAAKA,EAAI01D,cAAesB,EAC9E,CAmBJ,CAE0B,IAAtBK,EAAYjoC,OACZgoC,EAAkBtrC,EAAQA,EAAOtvB,OAAO,EAAG66D,EArC/C,CAuCJ,CAkBA,GA/iBI/B,IAAcC,IACdA,EAAkB,KA8iBlB1jD,GAAQ/W,KAAKC,IAAI8wB,eAAempC,IAAiBl6D,KAAKC,IAAI8wB,eAAempC,GAAclpC,OAAOtvB,OAM9F,OAJA86D,EADIxrC,EAAShxB,KAAKC,IAAI8wB,eAAempC,GAAclpC,aAG/ChxB,KAAKC,IAAI8wB,eAAempC,GAAcyB,cAAgBF,EAAWzqC,IAoBzE,GAVKhxB,KAAKC,IAAI8wB,eAAempC,KACzBl6D,KAAKC,IAAI8wB,eAAempC,GAAgB,CACpClpC,OAAO,KAQVipC,EAAL,CAKA,IAAIyC,EAAer9D,EAAIwC,aAAawV,GACpC,GAAIqlD,EAAc,CACd,IAAIC,EAAa38D,KAAKkB,IAAI,mBAAmBw7D,GAAc,GAE3Dx3D,GADAA,EAAMlF,KAAKmoB,UAAUusC,gBAAgBuF,EAAYC,EAAc,UAAUyC,GAAY,IAC3Ej3D,IACd,MACIR,EAAM+0D,EAAWC,GASrB,GANIh1D,GAAwB,WAAjBg1D,GAAiD,eAApBD,EAAW90D,OAC/CD,EAAMA,EAAIpB,QAAQ,UAAW,QAK7BoB,GAAOlF,KAAK4T,IAAIsU,gBAAiB,CAMjC,GAAIloB,KAAK4T,IAAIic,oBACT,IAAI+sC,EAAU58D,KAAK4T,IAAIic,oBAAoBqqC,EAAch1D,QAErD03D,EAAU13D,EAElB,IAAI0N,EAAe5S,KAAKmoB,UAAU2H,iBAAiBmqC,EAAWrnD,aAAc,SAAUgqD,EAAS3C,EAAWnrC,UACtG9uB,KAAKmoB,UAAU4H,QAAQnd,GAAc5Q,SACjChC,KAAKmoB,UAAU4H,QAAQnd,GAAc5Q,OAAO46D,GAC5C13D,EAAMlF,KAAKmoB,UAAU4H,QAAQnd,GAAc5Q,OAAO46D,QAO9C,IAAuB58D,KAAKmoB,UAAU4H,QAAQnd,GAAc5Q,OAAO46D,WAC5D58D,KAAKmoB,UAAU4H,QAAQnd,GAAc5Q,OAAO46D,GAInE,CAaA,QAAI,IAAuB13D,IAAQ,iBAAoBA,GAAO,iBAAoBA,GAAM,CAChF,iBAAoBA,IACpBA,EAAM,GAAKA,GAEf,IAAI23D,EAAex9D,EAAIuB,+BAA+ByW,GAEtD,GAA4D,IAAxDrX,KAAKC,IAAI8wB,eAAempC,GAAclpC,OAAOtvB,OAAc,CAE3D,IAAIsvB,EAliBZ,SAAqBxxB,EAAKq9D,GAKtB,IAAIC,EAAOC,EAAOja,EAMlB,GAVA+Z,EAAeA,GAA8B,GAE7Cr9D,EA1EJ,SAA6BA,GAEzB,IAAIiE,GADJjE,EAAMA,EAAIoF,QACElB,MAAM,YAClB,GAAID,IAAMpE,EAAIsB,uBAAuB8C,EAAE,IAAK,CACxC,IAAIu5D,EAAgB,MAGZA,EAFJ,CAAC,UAAW,gBAAiB,QAAQj6D,QAAQsU,IAAa,EACtD4iD,EAAWvpC,MACKrxB,EAAIuB,+BAA+Bq5D,EAAWvpC,OAE9C,KAGJrxB,EAAIuB,+BAA+ByW,MAGnD7X,EAAMw9D,EAAgB,IAAMx9D,EAEpC,CACA,OAAOA,CACX,CAuDUy9D,CAAoBz9D,GAGtB,SAAW6X,GACP7X,EAAIuD,QAAQ,MAAa,IACzBvD,EAAMA,EAAIsE,QAAQ,UAAW,MAGjCtE,EAAIuD,QAAQ,QAAU,EAAG,CACzB+5D,EAAQ,IAAIt8D,OAAO85D,EAAe4C,OAAOp5D,QAAQ,MAAO,KACxDi5D,EAAQ,IAAIv8D,OAAO+5D,EAAe2C,OAAOp5D,QAAQ,MAAO,KAExD,IADA,IACStC,EAAE,EAAEC,GADTH,EAAM9B,EAAI+B,MAAM,QACEG,OAAOF,EAAEC,EAAKD,IAChCF,EAAIE,GAAKF,EAAIE,GAAGsC,QAAQ,MAAO,KAGnCg/C,GADAA,EAAQxhD,EAAIK,KAAK,QACHmC,QAAQ,MAAO,GACjC,MACIg5D,EAAQxC,EACRyC,EAAQxC,EACRzX,EAAQtjD,EAMZ,IAAI6E,EAAQ,GAEZ,GADIZ,EAAIq/C,EAAMp/C,MAAMo5D,GACb,CACH,IAAIx7D,EAAMwhD,EAAMvhD,MAAMw7D,GACtB,IAASv7D,EAAE,EAAGC,EAAKgC,EAAE/B,OAAQF,EAAEC,EAAMD,IAC7BiC,EAAEjC,GAAGkC,MAAM22D,KACP/4D,EAAIE,GAAGkC,MAAM,cAAgBpC,EAAIE,GAAGkC,MAAM,aAC1CD,EAAEjC,GAAKi5D,EAEPh3D,EAAEjC,GAAK,IAAMi5D,EAAkB,KAK3C,IAAK,IAAIj5D,KAAKF,EACV,IAAK,GAAKA,EAAIE,IAAIsC,QAAQ,cAAe,IAAIJ,MAAM,wBAE/C,MAMJ,IAASlC,EAAE,EAAEC,EAAKH,EAAII,OAAO,EAAGF,EAAEC,EAAMD,IACpC6C,EAAMM,KAAKrD,EAAIE,IACf6C,EAAMM,KAAKlB,EAAEjC,IAEjB6C,EAAMM,KAAKrD,EAAIA,EAAII,OAAO,IAE1B2C,EAxEZ,SAA0BA,GAGtB,IAAK,IAAI7C,EAAE6C,EAAM3C,OAAO,EAAEF,GAAG,EAAEA,GAAG,EACb,MAAb6C,EAAM7C,IACJ6C,EAAM7C,EAAE,GAAGkC,MAAM,0FACjBW,EAAM7C,EAAE,GAAGkC,MAAM,kBACnBW,EAAM7C,EAAE,GAAK6C,EAAMb,MAAMhC,EAAE,EAAEA,EAAE,GAAGG,KAAK,IACvC0C,EAAQA,EAAMb,MAAM,EAAEhC,GAAGsE,OAAOzB,EAAMb,MAAMhC,EAAE,KAGtD,OAAO6C,CACX,CA4DoB84D,CAAiB94D,EAGjC,MACQA,EAAQ,CAACy+C,GAGjB,IAAI9xB,EAAS,GACTN,EAAQmsC,EACRlC,EAAY,GAChB,IAASn5D,EAAE,EAAEC,EAAK4C,EAAM3C,OAAOF,EAAEC,EAAKD,GAAK,EAAG,CAM1C,IAAIiC,EACJ,GADIA,EAAIY,EAAM7C,GAAGkC,MAAM,yJAChB,CAGH,IAFA,IAESZ,GAFLxB,EAAM+C,EAAM7C,GAAGD,MAAM,2JAEVG,OAAO,EAAEoB,EAAE,EAAEA,KACpBxB,EAAIwB,EAAE,IAAQxB,EAAIwB,GAAGY,MAAM,4BAA+BpC,EAAIwB,EAAE,GAAGY,MAAM,6BACzEpC,EAAIwB,EAAE,GAAKxB,EAAIwB,EAAE,GAAKW,EAAEX,EAAE,GAAKxB,EAAIwB,GACnCxB,EAAMA,EAAIkC,MAAM,EAAEV,GAAGgD,OAAOxE,EAAIkC,MAAMV,EAAE,IACxCW,EAAIA,EAAED,MAAM,EAAEV,EAAE,GAAGgD,OAAOrC,EAAED,MAAMV,KAI1C,GAAIW,EAAE/B,OAAS,EAAG,CACd,IAAI07D,EAAO35D,EAAE,GAAGmB,QACCvF,EAAIsB,uBAAuBy8D,SACrC,IAAuB7+C,EAAGyN,QAAQ3sB,EAAIsB,uBAAuBy8D,MACU,IAAtE,CAAC,UAAW,SAAU,gBAAiB,QAAQr6D,QAAQsU,IAAoBhY,EAAIsB,uBAAuBy8D,KAAU/lD,EAE1G,IAAN7V,IACAiC,EAAIA,EAAED,MAAM,GACZlC,EAAI,GAAKA,EAAI,GAAK,IAAM87D,EAAO,IAAM97D,EAAI,GACzCA,EAAMA,EAAIkC,MAAM,EAAE,GAAGsC,OAAOxE,EAAIkC,MAAM,KAG1Cm3D,EAAYyC,CAEpB,CAESt6D,EAAE,EAAX,IAAK,IAAQ4B,EAAKpD,EAAII,OAAQoB,EAAE4B,EAAM5B,KAC9BxB,EAAIwB,IAAMA,IAAOxB,EAAII,OAAO,KAIxB27D,EADA1C,KADJjqC,EAAQjtB,EAAEX,EAAE,GAAKW,EAAEX,EAAE,GAAK4tB,GACF9rB,OACA,GAEA+1D,EAGxB7X,EAAQxhD,EAAIwB,GAAKxB,EAAIwB,GAAG8B,OAAS,GAC7B9B,IAAOxB,EAAII,OAAO,EAClBsvB,EAAOrsB,KAAK+1D,EAAkB2C,EAAmB3sC,EAAOoyB,EAAOz+C,EAAM7C,EAAE,GAAIA,IAE3EwvB,EAAOrsB,KAAK+1D,EAAkB2C,EAAmB3sC,EAAOoyB,EAAO,KAAMthD,IAIrF,KAAO,CACH,IAAI67D,EAEAA,EADA1C,IAAcjqC,EAAM9rB,OACA,GAEA+1D,EAExB3pC,EAAOrsB,KAAK+1D,EAAkB2C,EAAmB3sC,EAAOrsB,EAAM7C,GAAI6C,EAAM7C,EAAE,IAC9E,CACJ,CACA,OAAOwvB,CACX,CA+ZqBssC,CAAYp4D,EAAK23D,GAQ9B,IAAK,IAAI1jD,KArajB,SAAmB6X,GAEf,IAAK,IAAIxvB,EAAE,EAAEC,EAAKuvB,EAAOtvB,OAAO,EAAEF,EAAEC,EAAKD,KAChCwvB,EAAOxvB,GAAGo5D,eAAiB5pC,EAAOxvB,EAAE,GAAGkvB,QACxCM,EAAOxvB,GAAGo5D,cAAgB,IAGtC,CAwZQ2C,CAAUvsC,GAjVlB,SAA+BA,GAC3B,GAAsB,IAAlBA,EAAOtvB,OAAX,CAMA,IAHA,IAAI65D,EAAgB,EAChBiC,EAAa,EAERh8D,EAAE,EAAEC,EAAKuvB,EAAOtvB,OAAOF,EAAEC,EAAKD,IAAK,CACxC,IAAIi8D,EAAUzsC,EAAOxvB,EAAE,GACnBk8D,EAAU1sC,EAAOxvB,GACjBi8D,EAAQ/sC,QAAUgtC,EAAQhtC,OAAS+sC,EAAQvlC,UAAaulC,EAAQvlC,SAChEslC,MAEIxC,EAAmBrkD,KAAKC,MAAMD,KAAK8X,UAAUuC,EAAOuqC,MACvCpoD,IAAMooD,EACvBP,EAAiB1mC,MAAQkpC,EACzBxC,EAAiBr8C,SAAU,EAC3Bo8C,EAAmB/pC,EAAQuqC,EAAeP,GACtCyC,EAAQ/sC,QAAUgtC,EAAQhtC,OAC1B4qC,EAAmBtqC,EAAQuqC,EAAeP,GAE9CO,EAAgB/5D,EAChBg8D,EAAa,EAErB,CAEA,IAAIxC,KAAmBrkD,KAAKC,MAAMD,KAAK8X,UAAUuC,EAAOuqC,MACvCpoD,IAAMooD,EACvBP,EAAiB1mC,MAAQkpC,EACzBxC,EAAiBr8C,SAAU,EAC3Bo8C,EAAmB/pC,EAAQuqC,EAAeP,GAC1CM,EAAmBtqC,EAAQuqC,EAAeP,GACtChqC,EAAOtvB,QAAUsvB,EAAO,GAAGrS,SAAqC,eAA1BtH,EAAS7T,MAAM,EAAG,KACpDmV,SAASshD,EAAWC,GAAe,IAAM,IACzClpC,EAAO,GAAGrE,OAAS,EA/B3B,CAkCJ,CA+SQgxC,CAAsB3sC,GAGNA,GACP7X,EAAIwF,UAASxF,EAAIwT,OAAS,GAEnC3sB,KAAKC,IAAI8wB,eAAempC,GAAclpC,OAASA,EAG3Cja,IACAylD,EAAUxrC,GAEVhxB,KAAKC,IAAI8wB,eAAempC,GAAcyB,cAAgBF,EAAWzqC,IA5H7E,SAA2BD,EAAgBmpC,EAAclpC,GACrD,IAAI7X,EAAM4X,EAAempC,GACrBlpC,EAAOtvB,SACPyX,EAAIwF,QAAUqS,EAAO,GAAGrS,QACxBxF,EAAI+hD,YAAclqC,EAAO,GAAGkqC,YAC5B/hD,EAAIwT,OAASqE,EAAO,GAAGrE,OACvBxT,EAAIuX,MAAQrxB,EAAIsB,uBAAuBqwB,EAAO,GAAGN,OAChC,WAAbrZ,GAAuC,UAAd8B,EAAIuX,OAAqBnS,EAAGyN,QAAQ,YAC7D7S,EAAIuX,MAAQ,UAGxB,CAoHQktC,CAAkB59D,KAAKC,IAAI8wB,eAAgBmpC,EAAclpC,EAC7D,CAGA,IAAImqB,EAAOn7C,KAAKC,IAAI8wB,eAAempC,GAClB,WAAb7iD,GAC2B,IAAvB8jC,EAAKnqB,OAAOtvB,QAAgBy5C,EAAKnqB,OAAO,GAAG/f,MAAMlO,QAAQ,MAAQ,IACjEo4C,EAAKnqB,OAAO,GAAG/f,MAAQkqC,EAAKnqB,OAAO,GAAG/f,MAAMnN,QAAQ,MAAO,MAC3Dq3C,EAAKnqB,OAAO,GAAGrS,SAAU,EACzBw8B,EAAKnqB,OAAO,GAAGrE,OAAS,EACxBwuB,EAAKnqB,OAAO,GAAGkqC,aAAc,EAC7B/f,EAAKx8B,SAAU,EACfw8B,EAAKxuB,OAAS,EACdwuB,EAAK+f,aAAc,GAGA,IAAvB/f,EAAKnqB,OAAOtvB,QACRy5C,EAAKnqB,OAAO,GAAG/f,MAAMvN,MAAM,2BAC3By3C,EAAKnqB,OAAO,GAAGrS,SAAU,EACzBw8B,EAAKnqB,OAAO,GAAGrE,OAAS,EACxBwuB,EAAKnqB,OAAO,GAAGkqC,aAAc,EAC7B/f,EAAKx8B,SAAU,EACfw8B,EAAKxuB,OAAS,EACdwuB,EAAK+f,aAAc,GAGV,SAAb7jD,GACI8jC,EAAKnqB,OAAOtvB,OAAS,GACjBy5C,EAAKnqB,OAAO,GAAGggC,mBACf7V,EAAK4S,UAAY,QAKjC,CAvHA,CAwHJ,EAEA1uD,EAAIgsB,KAAK0jC,mBAAqB,SAAS9tD,EAAOosB,EAAS6e,GAEnDjrC,EAAMqoB,OAAO0M,UAAU/0B,EAAMhB,IAAI8wB,eAAe1D,GAASsuC,eACzD,IAKIkC,EALAlC,EAAgB16D,EAAMhB,IAAI8wB,eAAe1D,GAASsuC,cAClDmC,EAAO78D,EAAMhB,IAAI8wB,eAAe1D,GAAS2D,OACzC4qC,EAAckC,EAAKp8D,OAASo8D,EAAK,GAAGptC,MAAQ,KAC5Cq9B,EAAY9sD,EAAMhB,IAAI8wB,eAAe1D,GAAS0gC,UAC9CgQ,EAAY98D,EAAMhB,IAAImR,cAAcC,IAAIyoC,aAGxC+jB,EADA9P,GAGoB,QAOxB,IAJA,IAAIE,EAAyBhtD,EAAMhB,IAAI8wB,eAAe1D,GAAS4gC,uBAC3DD,EAAmB/sD,EAAMhB,IAAI8wB,eAAe1D,GAAS2gC,iBACrDgQ,EAAgB,KAEXx8D,EAAE,EAAEC,EAAKq8D,EAAKp8D,OAAOF,EAAEC,EAAKD,IAAK,CACtC,IAEIy8D,EAFAvlD,EAAMolD,EAAKt8D,GACXkvB,EAAQ,GAERhY,EAAIgY,QAEAutC,EADA,SAAWvlD,EAAIgY,MAAMltB,MAAM,EAAE,GACjBkV,EAAIgY,MAAMltB,MAAM,GAEhBnE,EAAIsB,uBAAuB+X,EAAIgY,UAIvChY,EAAIgY,QAAUkrC,GACVmC,IAE6B,KAD7BrtC,EAAQzvB,EAAM+qB,QAAQiyC,EAAW,SAAUvlD,EAAIiU,SACrC5pB,QAAQ,QACd2tB,EAAQ,IAGXA,IACDA,EAAQzvB,EAAM+qB,QAAQiyC,EAAWlQ,EAAWr1C,EAAIiU,WAGhDoxC,IAE6B,KAD7BrtC,EAAQzvB,EAAM+qB,QAAQiyC,EAAW,SAAUvlD,EAAIiU,SACrC5pB,QAAQ,QACd2tB,EAAQ,IAGXA,IACDA,EAAQzvB,EAAM+qB,QAAQiyC,EAAWJ,EAAmBnlD,EAAIiU,UAG5DshC,IACAv9B,EAAQrxB,EAAI2N,OAAOC,WAAW,oBAAoBhM,EAAOyvB,KAIrE,IAAIwtC,GAAuB,EACvBxtC,IACAwtC,EAAsBxtC,EAAM3tB,QAAQ,OAExC,IAyBQqvB,EAzBJ+rC,EAAa9+D,EAAIgsB,KAAK4rB,WAAWv+B,EAAIojD,SAMzC,GALAqC,EAAW7kC,UAAY5gB,EAAIojD,QAAQxiC,UACnC6kC,EAAWh5D,KAAOuT,EAAIojD,QAAQ32D,KAC9Bg5D,EAAWzlD,IAAMA,EAAIojD,QAAQpjD,IAC7BylD,EAAWvxC,OAASlU,EAAIojD,QAAQlvC,OAE5BsxC,EAAsB,GAAKA,EAAuBxtC,EAAMhvB,OAAO,EAC/Dy8D,EAAWrsD,QAAQ9L,QAAU0qB,EAAMltB,MAAM,EAAE06D,GAC3CC,EAAWrsD,QAAQrL,OAASiqB,EAAMltB,MAAM06D,EAAoB,GAAKC,EAAWrsD,QAAQrL,YACjF,GAAIiS,EAAIu4C,gBAKX,GAJKvgC,IACDA,EAAQhY,EAAIgY,MACZutC,EAAYvlD,EAAIgY,OAEhBwtC,EAAsB,EAAG,CACzB,IAAIE,EAAqB,IAAI/+D,EAAI8hB,MACjCi9C,EAAmBzsD,YAAcq8C,EACjC/sD,EAAMqoB,OAAOiN,OAAO7F,EAAMltB,MAAM,EAAE06D,GAAsBE,EAC5D,MAAWF,IAAyBxtC,EAAMhvB,OAAO,IAA+B,IAAzBw8D,GAEnDj9D,EAAMqoB,OAAOiN,OAAO7F,EAAMhY,EAAIoiD,YAAa,SAInD,GADAz7D,EAAIyR,+BAA+B7P,EAAO06D,EAAc7pD,QAAQ9L,OAAQ,KAAM21D,EAAe,GAAGjjD,EAAIwf,WAAWxf,EAAIzH,SAC/GyH,EAAIwiD,iBAOA,KAJA9oC,EADA1Z,EAAIzH,MAAMvN,MAAM,iBACT,IAAIrE,EAAI05C,YAAY93C,EAAOyX,EAAIwf,SAAUvf,SAASD,EAAIzH,MAAO,IAAKktD,EAAYjyB,GAE9E,IAAI7sC,EAAI05C,YAAY93C,EAAOyX,EAAIwf,SAAUxf,EAAIzH,MAAOktD,EAAYjyB,IAE3Ctf,SAC5BwF,EAAKxF,OAAS3rB,EAAM0B,OAAO1B,EAAMC,IAAIqB,MAAM,gBAAgB8qB,IAE/DpsB,EAAMqoB,OAAOiN,OAAOnE,EAAM,gBAE1BnxB,EAAMqoB,OAAOiN,OAAO7d,EAAIwf,SAAWxf,EAAIzH,MAAOktD,GAElD,GAA4B,IAAxBD,GAA6BA,EAAuBxtC,EAAMhvB,OAAO,IAE3C,OAAlBs8D,IACAA,EAAgBC,GAEhBA,IAAcD,GAAiBx8D,IAAOs8D,EAAKp8D,OAAO,GAAI,CACtD,IAAI28D,EAAqB,IAAIh/D,EAAI8hB,MACjCk9C,EAAmB1sD,YAAcq8C,EACjC/sD,EAAMqoB,OAAOiN,OAAO7F,EAAMltB,MAAM06D,EAAoB,GAAIG,EAC5D,CAEJL,EAAgBC,EAChBh9D,EAAMhB,IAAIsG,kBAAmB,CACjC,CACAtF,EAAMqoB,OAAO4M,YACjB,EAIA72B,EAAIgsB,KAAKO,iBAAmB,CAAC,EAE7BvsB,EAAIgsB,KAAKO,iBAAiBC,YAAc,SAAU5qB,EAAOq9D,GACrD,IAAIC,EAAUprD,EAAKC,EAAKqb,EAAW+vC,EAASC,EAAQC,EAAUC,EAAmBC,EAASt9D,EAAKmC,EAAGsb,EAAG5e,EAAGsK,EAAKo0D,EAAO3zD,EAAK4zD,EAErHjmB,EAAkB53C,EAAM+qB,QAAQsyC,EAAY,oBAEhDC,EAAW,yFAEX9vC,EAAY,SAAUntB,GAElB,IADA8R,EAAM9R,EAAII,OACLyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EACxB,iBAAoB7R,EAAI6R,KACxB7R,EAAI6R,GAAO7R,EAAI6R,GAAKxR,KAAK,KAGjC,IAAI8I,EAAMnJ,EAAIK,KAAK,IAEnB,OADA8I,EAAMA,EAAI3G,QAAQ,aAAc,KAAK7C,EAAM+qB,QAAQsyC,EAAY,oBAEnE,EAEAE,EAAU,SAAUh/D,GAChB,IAAIiE,EAAGnC,EAAKmJ,EAERs0D,EAAU,cAGVC,EAAW,IAAIx+D,OAAO,eADqB,MAApBq4C,EAA0B,GAAKA,GACO,WAAY,KAC7Er5C,EAAMA,EAAIsE,QAAQk7D,EAAU,SAASl7D,QAAQ,WAAY,OAIzD,IAAIm7D,EAAO,IAAIz+D,OAAO,sCAAwCu+D,EAAU,sCAAuC,KAC3GG,EAAS,IAAI1+D,OAAO,qCAAuCu+D,EAAU,sCAGzE,GAFAt7D,EAAIjE,EAAIkE,MAAMu7D,GAEK,KADnB39D,EAAM9B,EAAI+B,MAAM29D,IACRx9D,OACJ+I,EAAMhH,OAGN,IADAgH,EAAM,CAACnJ,EAAI,IACN6R,EAAM,EAAGC,EAAM9R,EAAII,OAAQyR,EAAMC,EAAKD,GAAO,EAC9C1I,EAAI9F,KAAKlB,EAAE0P,EAAM,GAAGrP,QAAQ,YAAa,MACzC2G,EAAI9F,KAAKrD,EAAI6R,IAGrB,OAAO1I,CACX,EAEAg0D,EAAS,SAAUj/D,GAIf,IAFA8B,EAAMk9D,EADNh/D,EAAM,GAAKA,GAEX4T,EAAM9R,EAAII,OACLyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,GAC5B1P,EAAInC,EAAI6R,GAAKzP,MAAM66D,MAEV96D,EAAE,IAAMA,EAAE,KAAOA,EAAE,KAChBA,EAAE,GAAG/B,OAAS+B,EAAE,GAAG/B,SACnB+B,EAAE,GAAKA,EAAE,GAAGD,MAAM,EAAIC,EAAE,GAAG/B,OAAS+B,EAAE,GAAG/B,QAAW+B,EAAE,IAEtDkV,SAASlV,EAAE,GAAI,IAAMkV,SAASlV,EAAE,GAAI,MACpCA,EAAE,GAAKo1C,GAAmBp1C,EAAE,GAAKA,EAAE,GAAK,IACxCnC,EAAI6R,GAAO1P,EAAED,MAAM,MAI3B,iBAAoBlC,EAAI6R,KACxB7R,EAAI6R,GAAO7R,EAAI6R,GAAKrP,QAAQ,MAAO+0C,IAG3C,OAAOv3C,CACX,EAEAo9D,EAAW,SAAUp9D,EAAK69D,EAAUC,GAChChsD,EAAM9R,EAAII,OACV,IAAK,IAAIF,EAAI,EAAGC,EAAOH,EAAII,OAAQF,EAAIC,EAAMD,GAAK,EAC1C,iBAAoBF,EAAIE,KACxBF,EAAIE,GAAG,GAAKm9D,EAAkBr9D,EAAIE,GAAG,GAAIF,EAAIE,GAAG,GAAI29D,EAAUC,GAC1D99D,EAAIE,GAAG,GAAGgC,MAAM,KAAOlC,EAAIE,GAAG,KAC9BF,EAAIE,GAAG,GAAKq3C,IAIxB,OAAOpqB,EAAUntB,EACrB,EAEAq9D,EAAoB,SAAUE,EAAO3zD,EAAKi0D,EAAUC,GAQhD,GAPKD,IACDA,EAAW,GAEfpgD,GAAK,GAAK8/C,GAAOt9D,MAAM,IACvBpB,GAAK,GAAK+K,GAAK3J,MAAM,KACrBkJ,EAAMtK,EAAEqD,SACJsH,UACAiU,EAAErd,SAAWvB,EAAEuB,OACf,IAAK,IAAIF,EAAI,EAAGC,EAAOsd,EAAErd,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAC/C,KAAIud,EAAEvd,KAAOrB,EAAEqB,IAAMiJ,EAAI/I,OAASy9D,GAE3B,CACH,GAAIA,GAAYC,GAAyB,IAAf30D,EAAI/I,OAAc,CACxC,IAAI29D,EAAQtgD,EAAEvb,MAAM,EAAGhC,GACvB69D,EAAMv0D,UACNL,EAAMA,EAAI3E,OAAOu5D,EACrB,CACA,KACJ,CARI50D,EAAIO,KASZ,CAGJ,OADAP,EAAIK,UACGL,EAAI9I,KAAK,GACpB,EAEAi9D,EAAU,SAAUt9D,GAEhB,IADA8R,EAAM9R,EAAII,OACLyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EACxB,iBAAoB7R,EAAI6R,KACxB1P,EAAInC,EAAI6R,GACR0rD,EAAQlmD,SAASlV,EAAE,GAAI,IACvByH,EAAMyN,SAASlV,EAAE,GAAI,IACjBo7D,EAAQ,KAAOA,EAAQ,KAAOlmD,SAAUkmD,EAAQ,IAAM,MAAQlmD,SAAUzN,EAAM,IAAM,IACpFzH,EAAE,GAAK,GAAMyH,EAAM,IACZ2zD,GAAS,MAChBp7D,EAAE,GAAK,GAAMyH,EAAM,MAGvBzH,EAAE,GAAGD,MAAM,KAAOC,EAAE,KACpBA,EAAE,GAAKo1C,GAGf,OAAOpqB,EAAUntB,EACrB,EAKA,IAAIg+D,EAAQ,SAAU9/D,EAAKiiB,EAAM09C,EAAUC,GAKvC,OADU39C,EADNg9C,EADVj/D,EAAM,GAAKA,GAEe2/D,EAAUC,EAElC,EAwBA,OAvBKn+D,EAAMC,IAAIo9D,EAAY,iBAK2B,aAA3Cr9D,EAAMC,IAAIo9D,EAAY,iBAC7BQ,EAAW,SAAUt/D,GACjB,OAAO8/D,EAAM9/D,EAAKivB,EACtB,EACkD,YAA3CxtB,EAAMC,IAAIo9D,EAAY,iBAC7BQ,EAAW,SAAUt/D,GACjB,OAAO8/D,EAAM9/D,EAAKk/D,EACtB,EACkD,gBAA3Cz9D,EAAMC,IAAIo9D,EAAY,iBAC7BQ,EAAW,SAAUt/D,EAAK4/D,GACtB,OAAOE,EAAM9/D,EAAKk/D,EAAU,EAAGU,EACnC,EACkD,YAA3Cn+D,EAAMC,IAAIo9D,EAAY,mBAC7BQ,EAAW,SAAUt/D,GACjB,OAAO8/D,EAAM9/D,EAAKo/D,EACtB,GAnBAE,EAAW,SAAUt/D,GAEjB,OAAO8/D,EAAM9/D,EAAKivB,EACtB,EAmBGqwC,CACX,EAaAz/D,EAAIgsB,KAAKC,YAAc,SAASrqB,GAM5B,IAAIs+D,EAAgB,GAEhBC,EAAe,CACf,wBAA2B,CACvBr6D,KAAM,SACNs6D,OAAQ,wBACRC,OAAQ,UACRvpD,KAAM,KACNwQ,MAAO,KACPg5C,SAAU,MAEd,yBAA4B,CACxBx6D,KAAM,UACNs6D,OAAQ,yBACRC,OAAQ,UACRvpD,KAAM,SACNwQ,MAAO,UACPg5C,SAAU,CACN,QAAW,YAGnB,0CAA6C,CACzCx6D,KAAM,MACNs6D,OAAQ,0CACRC,OAAQ,UACRvpD,KAAM,gBACNwQ,MAAO,aACPg5C,SAAU,CACN,aAAc,SACd,OAAU,eAGlB,OAAQ,CACJx6D,KAAM,MACNs6D,OAAQ,OACRC,OAAQ,QACRvpD,KAAM,gBACNwQ,MAAO,aACPg5C,SAAU,CACN,aAAc,SACd,OAAU,eAGlB,MAAO,CACHx6D,KAAM,MACNs6D,OAAQ,MACRC,OAAQ,OACRvpD,KAAM,cACNwQ,MAAO,SACPg5C,SAAU,CACN,OAAU,SACV,OAAU,WAGlB,MAAO,CACHx6D,KAAM,MACNs6D,OAAQ,MACRC,OAAQ,OACRvpD,KAAM,eACNwQ,MAAO,OACPg5C,SAAU,CACN,KAAQ,SACR,OAAU,SAGlB,QAAS,CACLx6D,KAAM,MACNs6D,OAAQ,QACRC,OAAQ,SACRvpD,KAAM,kBACNwQ,MAAO,MACPg5C,SAAU,CACN,IAAO,MACP,IAAO,QAGf,QAAS,CACLx6D,KAAM,MACNs6D,OAAQ,QACRC,OAAQ,SACRvpD,KAAM,kBACNwQ,MAAO,MACPg5C,SAAU,CACN,IAAO,MACP,IAAO,QAGf,KAAO,CACHx6D,KAAM,QACNs6D,OAAQ,KACRC,OAAQ,IACRvpD,KAAM,UACNwQ,MAAO,OACPg5C,SAAU,CACN,KAAQ,QACR,MAAS,OACT,MAAS,SAGjB,KAAO,CACHx6D,KAAM,QACNs6D,OAAQ,KACRC,OAAQ,IACRvpD,KAAM,UACNwQ,MAAO,QACPg5C,SAAU,CACN,KAAQ,QACR,MAAS,OACT,MAAS,UAKrBH,EAAa,MAASA,EAAa,MACnCA,EAAa,MAASA,EAAa,MAEnC,IAAII,EAAkB3+D,EAAM+qB,QAAQ,cAChC6zC,EAAmB5+D,EAAM+qB,QAAQ,eACjC8zC,EAAuB7+D,EAAM+qB,QAAQ,oBACrC+zC,EAAwB9+D,EAAM+qB,QAAQ,qBA2B1C,SAASg0C,EAAwBP,GAG7B,IAFA,IAAIQ,EAAU,GACVz1D,EAAO6J,OAAO7J,KAAKg1D,GACdh+D,EAAI,EAAGmmC,EAAIn9B,EAAK9I,OAAQF,EAAImmC,EAAGnmC,IAAK,CACzC,IAAIyD,EAAMuF,EAAKhJ,GACmB,UAA9Bg+D,EAAaC,GAAQt6D,MAAqBq6D,EAAaC,IACvDQ,EAAQt7D,KAAKM,EAErB,CACA,IAAIwF,EAAM+0D,EAAaC,GAIvB,OAHAh1D,EAAIg1D,OAAS,IAAIj/D,OAAO,OAASy/D,EAAQC,KAAI,SAAS1gE,GAClD,OAAOA,EAAIsE,QAAQ,IAAK,MAC5B,IAAGnC,KAAK,KAAO,KACR8I,CACX,CArCIm1D,GAAmBC,IAA0E,IAAtD,CAAC,KAAM,KAAM,IAAK,KAAM98D,QAAQ68D,KACvEJ,EAAaI,GAAmBjpD,KAAKC,MAAMD,KAAK8X,UAAU+wC,EAAa,QACvEA,EAAaI,GAAiBH,OAASG,EACvCJ,EAAaI,GAAiBF,OAASG,GAGvCC,GAAwBC,IAAoF,IAA3D,CAAC,KAAM,KAAM,IAAK,KAAMh9D,QAAQ+8D,KACjFN,EAAaM,GAAwBnpD,KAAKC,MAAMD,KAAK8X,UAAU+wC,EAAa,QAC5EA,EAAaM,GAAsBL,OAASK,EAC5CN,EAAaM,GAAsBJ,OAASK,GA8BhD,IAAII,EAAkB,WAGlB,IAFA,IAAI11D,EAAM,CAAC,EACPD,EAAO6J,OAAO7J,KAAKg1D,GACdh+D,EAAI,EAAGmmC,EAAIn9B,EAAK9I,OAAQF,EAAImmC,EAAGnmC,IAAK,CACzC,IAAIyD,EAAMuF,EAAKhJ,GACfiJ,EAAIxF,GAAO+6D,EAAwB/6D,EACvC,CACA,OAAOwF,CACX,CARqB,GAUjB21D,EAAW,WACX,IAAIH,EAAU,GACVI,EAAU,GACVz0D,EAAO,CAAC,EACZ,IAAK,IAAI6zD,KAAUU,EACfF,EAAQt7D,KAAK86D,GACb7zD,EAAKu0D,EAAeV,GAAQC,SAAU,EAG1C,IADA,IAAIl1D,EAAO6J,OAAO7J,KAAKoB,GACdpK,EAAI,EAAGmmC,EAAIn9B,EAAK9I,OAAQF,EAAImmC,EAAGnmC,IAAK,CACzC,IAAIk+D,EAASl1D,EAAKhJ,GAClB6+D,EAAQ17D,KAAK+6D,EACjB,CAEA,IAAI9L,EAAMqM,EAAQn6D,OAAOu6D,GAASH,KAAI,SAAS1gE,GAC3C,OAAOA,EAAIsE,QAAQ,IAAK,MAC5B,IAAGnC,KAAK,KAER,MAAO,CACH2+D,SAAU,IAAI9/D,OAAO,OAASozD,EAAM,KAAM,KAC1C2M,SAAU,IAAI//D,OAAO,MAAQozD,EAAM,IAAK,KACxCv5C,KAAM,IAAI7Z,OAAO,QAAUy/D,EAAQC,KAAI,SAAS1gE,GAC5C,OAAOA,EAAIsE,QAAQ,IAAK,MAC5B,IAAGnC,KAAK,KAAO,OACf6+D,MAAO,IAAIhgE,OAAO,QAAU6/D,EAAQ1+D,KAAK,KAAO,OAExD,CA1Bc,GA+Ed,SAAS8+D,EAAkBC,EAAKvtD,GAC5B,OAAIutD,EAAIh9D,MAAM08D,EAAQ/lD,MApD1B,SAAkBqmD,EAAKvtD,GACnB,IAAIse,EAAS8tC,EAAcA,EAAc79D,OAAS,GAClD,OAAK+vB,GAAUivC,EAAIh9D,MAAM+tB,EAAOguC,SAC5BF,EAAc56D,KAAK,CACfQ,KAAMg7D,EAAeO,GAAKv7D,KAC1Bs6D,OAAQU,EAAeO,GAAKjB,OAC5BC,OAAQS,EAAeO,GAAKhB,OAC5BvsD,IAAKA,KAEF,IAEPosD,EAAcv0D,MACdu0D,EAAc56D,KAAK,CACfQ,KAAMg7D,EAAeO,GAAKv7D,KAC1Bs6D,OAAQU,EAAeO,GAAKjB,OAC5BC,OAAQS,EAAeO,GAAKhB,OAC5BvsD,IAAKA,IAEF,CACHwtD,OAAQlvC,EAAOte,KAG3B,CA+BeytD,CAASF,EAAKvtD,GA7B7B,SAAmButD,EAAKvtD,GACpB,IAAIse,EAAS8tC,EAAcA,EAAc79D,OAAS,GAClD,OAAI+vB,GAAUivC,IAAQjvC,EAAOiuC,QACzBH,EAAcv0D,MACM,WAAhBymB,EAAOtsB,MACA,CACH07D,OAAQ,CACJxmD,KAAMoX,EAAOte,IACbqtD,MAAOrtD,KAOfse,EACO,CACHkvC,OAAQlvC,EAAOte,KAGZ,CACHwtD,OAAQxtD,EAIxB,CAMe2tD,CAAUJ,EAAKvtD,EAE9B,CAmCA,IAAI4tD,EAAS,SAAS3uC,GAClB,IAAI7Z,EAAS,GACbvY,KAAKghE,IAAM,SAAUN,GAGjB,IAFA,IAAIvqD,EAAOqpD,EAAakB,GAAKvqD,KACzB8qD,EAAQ,KACHz/D,EAAE+W,EAAO7W,OAAO,EAAEF,GAAG,EAAEA,IAAK,CAEjC,IADI0/D,EAAS3oD,EAAO/W,IACT,KAAO2U,EAAM,CACpB8qD,EAAQC,EACR,KACJ,CACJ,CACA,IAAKD,EAAO,CACR,IAAIE,EAAc,CAAClgE,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIqxB,oBAAoBzsB,OAAOssB,EAAKI,UAC7E7L,EACA,IAASnlB,EAAE2/D,EAAYz/D,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACtC,IAAI4/D,EAAWD,EAAY3/D,GAC3B,GAAK4/D,EAGL,IAAK,IAAIt+D,EAAEs+D,EAAS1/D,OAAO,EAAEoB,GAAG,EAAEA,IAAK,CACnC,IAAIo+D,EACJ,IADIA,EAASE,EAASt+D,IACX,KAAOqT,EAAM,CACpB8qD,EAAQC,EACR,MAAMv6C,CACV,CACJ,CACJ,CACJ,CAIIs6C,EAHCA,EAGO,CAAC9qD,EAAMqpD,EAAakB,GAAKf,SAASsB,EAAM,KAFxC,CAAC9qD,EAAMqpD,EAAakB,GAAK/5C,OAIrCpO,EAAO5T,KAAKs8D,EAChB,EACAjhE,KAAKyjB,KAAO,WACR,OAAOlL,EAAOA,EAAO7W,OAAO,EAChC,EACA1B,KAAKgL,IAAM,WACPuN,EAAOvN,KACX,CACJ,EAEA,SAASq2D,EAAiBX,EAAKlhE,GAC3B,GAAY,MAARkhE,GACA,GAAIlhE,GAAOA,EAAIkE,MAAM,oBACjB,MAAO,SAER,GAAY,OAARg9D,GAAiBlhE,GAAOA,EAAIkE,MAAM,SACzC,MAAO,KAEX,OAAO,CACX,CAgHA1D,KAAKq3B,YAAc,SAAUjF,GACzB,IACIkvC,GAAe,EACK,OAFpB9hE,EAAM4yB,EAAKgD,OAEP5xB,MAAM,EAAG,IAAehE,EAAIkE,MAAM,gBACtC49D,GAAe,GAEnB,IAAItoD,EAAM,IAAIxY,OAAO,IAAMnB,EAAIsK,kBAAkBuzD,OAAS,MAAa79D,EAAIsK,kBAAkBuzD,OAAS,IAAK,KAEvGqE,EA9MR,SAAuB/hE,GACnB,IAAIgiE,EAAe,GAKf99D,GAFJlE,GADAA,EAAMA,EAAIsE,QAAQ,gEAAiE,gBACzEA,QAAQ,kDAAmD,YAErDJ,MAAM08D,EAAQE,UAC9B,IAAK58D,EACD,MAAO,CACHuuB,KAAM,GACNngB,QAAS,CAACtS,GACVgiE,aAAc,IAKtB,IAFA,IAAIjgE,EAAQ/B,EAAI+B,MAAM6+D,EAAQG,UAErB/+D,EAAE,EAAEC,EAAKiC,EAAMhC,OAAO,EAAEF,EAAEC,EAAKD,IAChCg+D,EAAa97D,EAAMlC,MACA,KAAfD,EAAMC,EAAE,IAAa,CAAC,IAAM,KAAKuB,QAAQW,EAAMlC,EAAE,KAAO,GACxDkC,EAAMlC,EAAE,GAAK,IAAMkC,EAAMlC,EAAE,GAC3BggE,EAAa78D,MAAK,IAElB68D,EAAa78D,MAAK,IAI9B,MAAO,CACHstB,KAAMvuB,EACNoO,QAASvQ,EACTigE,aAAcA,EAEtB,CA+KiBC,CADTjiE,EAAM,IAAMA,EAAIsE,QAAQkV,EAAK,UAEjC,GAA2B,IAAvBuoD,EAAOtvC,KAAKvwB,OAAhB,CAKH,IAFG,IA9UwBggE,EA8UpBC,GAAgB,EAEdngE,EAAE,EAAEC,EAAK8/D,EAAOtvC,KAAKvwB,OAAOF,EAAEC,EAAKD,IAAK,CAC1C,IACIhC,EACAoiE,EAAaP,EAFbX,EAAMa,EAAOtvC,KAAKzwB,GAClBhC,EAAM+hE,EAAOzvD,QAAQtQ,EAAE,IAE3B,GAAIogE,EACAL,EAAOzvD,QAAQtQ,EAAE,GAAKogE,EAAaL,EAAOzvD,QAAQtQ,EAAE,GACpD+/D,EAAOtvC,KAAKzwB,GAAK,OACd,CAEH,IADA,IAAIqgE,EAEAA,EAAUpB,EAAkBC,EAAKl/D,IADxB,CAGL,KAAI6S,OAAO7J,KAAKq3D,GAAS9+D,QAAQ,WAAa,GAuBvC,IAAI8+D,EAAQhB,OAAQ,CACvBU,EAAOtvC,KAAK4vC,EAAQhB,OAAOxmD,MAAQ,GACnCknD,EAAOtvC,KAAK4vC,EAAQhB,OAAOL,OAAS,GACpC,KACJ,CACI,KACJ,CA5BI,GAAIE,EAAIh9D,MAAM08D,EAAQI,QACP,MAARE,EAEHa,EAAOzvD,QAAQtQ,EAAE,GAAK,IAAW+/D,EAAOzvD,QAAQtQ,EAAE,GAClD+/D,EAAOtvC,KAAKzwB,GAAK,OACd,CACH,IAAIsgE,EAAYP,EAAOtvC,KAAK4vC,EAAQlB,QAChCY,EAAOC,aAAaK,EAAQlB,OAAO,KACnCmB,EAAYA,EAAUt+D,MAAM,IAEhC+9D,EAAOzvD,QAAQ+vD,EAAQlB,OAAO,GAAKmB,EAAYP,EAAOzvD,QAAQ+vD,EAAQlB,OAAO,GAC7EY,EAAOtvC,KAAK4vC,EAAQlB,QAAU,EAClC,CACA,KAAIpB,EAAc79D,OAAS,GAOvB,MANA,GAAY,MAARg/D,EAGA,MAFAnB,EAAcv0D,KAiBlC,CACI62D,IAAYA,EAAQlB,QAA4B,IAAnBkB,EAAQlB,UACrCY,EAAOzvD,QAAQtQ,EAAE,GAAK+/D,EAAOtvC,KAAKzwB,GAAK+/D,EAAOzvD,QAAQtQ,EAAE,GACxD+/D,EAAOtvC,KAAKzwB,GAAK,GAEzB,CACJ,CAEA,IAASA,EAAE+9D,EAAc79D,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACxC,IAAIugE,EAASxC,EAAc/9D,GAAG2R,IAC1ButD,EAAMa,EAAOtvC,KAAK8vC,GAGlBR,EAAOzvD,QAAQiwD,EAAO,GAFd,OAARrB,GAAyB,MAARA,EAEU,KAAYa,EAAOzvD,QAAQiwD,EAAO,GAElCR,EAAOtvC,KAAK8vC,GAAUR,EAAOzvD,QAAQiwD,EAAO,GAE3ER,EAAOtvC,KAAK8vC,GAAU,GACtBxC,EAAcv0D,KAClB,CACA,IAASxJ,EAAE+/D,EAAOtvC,KAAKvwB,OAAO,EAAEF,GAAG,EAAEA,IAC5B+/D,EAAOtvC,KAAKzwB,KACb+/D,EAAOtvC,KAAOsvC,EAAOtvC,KAAKzuB,MAAM,EAAEhC,GAAGsE,OAAOy7D,EAAOtvC,KAAKzuB,MAAMhC,EAAE,IAChE+/D,EAAOzvD,QAAQtQ,GAAK+/D,EAAOzvD,QAAQtQ,GAAK+/D,EAAOzvD,QAAQtQ,EAAE,GACzD+/D,EAAOzvD,QAAUyvD,EAAOzvD,QAAQtO,MAAM,EAAEhC,EAAE,GAAGsE,OAAOy7D,EAAOzvD,QAAQtO,MAAMhC,EAAE,KAKnF,IAASA,EAAE,EAAEC,EAAK8/D,EAAOtvC,KAAKvwB,OAAOF,EAAEC,EAAKD,IAAK,CACzCk/D,EAAMa,EAAOtvC,KAAKzwB,GAAtB,IACIwgE,EAAcT,EAAOC,aAAahgE,EAAE,GACpC,CAAC,KAAO,KAAO,KAAO,MAAOuB,QAAQ29D,IAAQ,IACxCiB,IAvZbnC,EAPwBkC,EA+ZOhB,GAxZZ/5C,MAAQ,OAC3B64C,EAPW,CACP,KAAO,KACP,KAAO,KACP,KAAO,KACP,KAAO,MAGOkC,IAAO/6C,MAAQ,QAwZrBg7C,GAAgB,GAEfK,IACDT,EAAOzvD,QAAQtQ,IAAMk/D,EAAIl9D,MAAM,EAAG,IAG9C,EAlNJ,SAA0B4uB,EAAMmvC,EAAQD,GACpC,IAAIW,GAAc,EACdC,EAAS,IAAInB,EAAO3uC,GACxBA,EAAKgD,MAAQ,GAiFb,IAAI+sC,EAAQ,IAhFZ,SAAgB/vC,GACZpyB,KAAKmiE,MAAQ,CAAC/vC,GACdpyB,KAAKoiE,OAAShwC,EACdpyB,KAAKqiE,WAAa,SAAS7iE,EAAKyhE,GAW5B,GAVIgB,IACwB,MAApBziE,EAAIgE,MAAM,EAAG,KACbhE,EAAMA,EAAIgE,MAAM,IAEI,MAApBhE,EAAIgE,MAAM,EAAG,KACbhE,EAAMA,EAAIgE,MAAM,IAEpBy+D,GAAc,GAElBjiE,KAAKoiE,OAASpiE,KAAKmiE,MAAMniE,KAAKmiE,MAAMzgE,OAAO,GACvCu/D,EAAO,CACH,iBAAoBjhE,KAAKoiE,OAAOhtC,SAC5BnY,EAAQ,IAAI5d,EAAI+2B,MACdhB,MAAQp1B,KAAKoiE,OAAOhtC,MAC1BnY,EAAMuV,SAAWxyB,KAAKoiE,OAAO5vC,SAAShvB,QACtCxD,KAAKoiE,OAAOhtC,MAAQ,CAACnY,IAEzB,IAyCQqlD,EAzCJlkB,EAAM,IAAI/+C,EAAI8hB,MAQlB,IAPImhD,EAAU,IAAIjjE,EAAI+2B,KAAK,KAAMgoB,IACzB5rB,SAAWxyB,KAAKoiE,OAAO5vC,SAAShvB,QAMvB,WAAby9D,EAAM,IAAgC,YAAbA,EAAM,GAAkB,CAIjD,IAHA,IAAIsB,EAAc,GACdC,EAAO,CAAC,EACRrB,EAAc,CAAClgE,EAAMA,EAAMhB,IAAIoN,MAAMnM,IAAIqxB,oBAAoBzsB,OAAOw8D,EAAQ9vC,UACvEhxB,EAAE2/D,EAAYz/D,OAAO,EAAEF,GAAG,EAAEA,IAAK,CACtC,IAAIihE,EAAYtB,EAAY3/D,GAC5B,GAAKihE,EAGL,IAAK,IAAI3/D,EAAE2/D,EAAU/gE,OAAO,EAAEoB,GAAG,EAAEA,IAAK,CACpC,IAAI4/D,EAAYD,EAAU3/D,GACtB,CAAC,eAAgB,cAAe,iBAAiBC,QAAQ2/D,EAAU,KAAO,IACtEF,EAAKE,EAAU,MAEF,WAAbzB,EAAM,KACNqB,EAAQ3wD,YAAYhN,KAAK,CAAC+9D,EAAU,GAAI,WACxCH,EAAY59D,KAAK,CAAC+9D,EAAU,GAAI,YAEpCF,EAAKE,EAAU,KAAM,EAE7B,CACJ,CACAJ,EAAQ9vC,SAAS7tB,KAAK49D,EAE1B,MACID,EAAQ3wD,YAAYhN,KAAKs8D,GACzBqB,EAAQ9vC,SAAS7tB,KAAK,CAACs8D,IAK3B,GAHAjhE,KAAKoiE,OAAOhtC,MAAMzwB,KAAK29D,GACvBtiE,KAAKmiE,MAAMx9D,KAAK29D,GAChBtiE,KAAKoiE,OAASE,EACV9iE,EACI4+C,EAAM,IAAI/+C,EAAI8hB,OACdmhD,EAAU,IAAIjjE,EAAI+2B,KAAK,KAAMgoB,IACzBhpB,MAAQ51B,EAChB8iE,EAAQ9vC,SAAWxyB,KAAKoiE,OAAO5vC,SAAShvB,QACxCxD,KAAKoiE,OAAOhtC,MAAMzwB,KAAK29D,EAE/B,KAAO,CAEC,IAAIrlD,EADJzd,KACIyd,EAAQ,IAAI5d,EAAI+2B,MACdhB,MAAQ51B,EACdyd,EAAMuV,SAAWxyB,KAAKoiE,OAAO5vC,SAAShvB,QACtCxD,KAAKoiE,OAAOhtC,MAAMzwB,KAAKsY,GAE/B,CACJ,EACAjd,KAAK2iE,WAAa,WACd3iE,KAAKmiE,MAAMn3D,KACf,CACJ,CACY,CAAUonB,GACtB,GAAImvC,EAAOzvD,QAAQpQ,OAAQ,CACvB,IAAIlC,EAAM+hE,EAAOzvD,QAAQ,GACrBwvD,IACA9hE,EAAM,IAAMA,GAEhB2iE,EAAME,WAAW7iE,EACrB,CACA,IAAK,IAAIgC,EAAE,EAAEC,EAAK8/D,EAAOtvC,KAAKvwB,OAAOF,EAAEC,EAAKD,IAAK,CAC7C,IAAIk/D,EAAMa,EAAOtvC,KAAKzwB,GAClBhC,EAAM+hE,EAAOzvD,QAAQtQ,EAAE,GACvBk/D,EAAIh9D,MAAM08D,EAAQ/lD,OAClB6nD,EAAOlB,IAAIN,GACXyB,EAAME,WAAW7iE,EAAK0iE,EAAOz+C,UAE7By+C,EAAOl3D,MACPm3D,EAAMQ,aACNR,EAAME,WAAW7iE,GAEzB,CACJ,CA6GIojE,CAAiBxwC,EAAMmvC,EAAQD,EA5F/B,CA6FJ,CACJ,EAIAjiE,EAAI2N,OAAOC,WAAc,WACrB,IACI41D,EAAY,IAAIxjE,EAAIuyB,SADX,gKAC4B,SAASpyB,GAC9C,OAAOA,EAAIsE,QAAQ,kDAAmD,WAAWA,QAAQ,kEAAmE,gBAChK,IAEI0zD,EAAa,IAAIn4D,EAAIuyB,SADR,qFAGbkxC,EAAa,IAAIzjE,EAAIuyB,SAAS,mBAM9BmxC,EAAa,CACb,2CAA8C,UAC9C,wBAA2B,UAC3B,yBAA4B,UAC5B,OAAQ,QACR,QAAS,SACT,QAAS,UAGb,SAASC,EAAaC,GAGlB,IAAIx/D,EAAIw/D,EAAKv/D,MAAM,8KAGnB,OAAID,GAAOA,EAAE,GAAGC,MAAM,uBAAyBD,EAAE,GAG1Cw/D,EAFIx/D,EAAE,GAAKpE,EAAIS,kBAAkBkf,KAAKhf,KAAMyD,EAAE,IAAMA,EAAE,EAGjE,CAEA,SAASy/D,EAAgBzjD,EAAQ6X,GAC7B,IAAKA,EACD,MAAO,GAEX7X,EAAO8hD,OAASsB,EAAUthE,MAAM+1B,GAChC,IAAI6rC,EAAc,CACd,KAAO,CACH1D,OAAQ,KACRC,OAAQ,KAEZ,KAAO,CACHD,OAAQ,KACRC,OAAQ,KAEZ,IAAU,CACND,OAAQ,IACRC,OAAQ,KAEZ,IAAU,CACND,OAAQ,IACRC,OAAQ,MA6BhB,SAAS0D,EAAe1C,EAAKvtD,GAEzB,MADe,CAAC,IAAU,IAAU,KAAO,MAAOpQ,QAAQ29D,IAAQ,EA3BtE,SAAiBA,EAAKvtD,GAClB,GAAiC,IAA7BsM,EAAO4jD,WAAW3hE,QAAgBg/D,IAAQjhD,EAAO4jD,WAAW5jD,EAAO4jD,WAAW3hE,OAAS,GAAG+9D,OAM1F,OALAhgD,EAAO4jD,WAAW1+D,KAAK,CACnB86D,OAAQ0D,EAAYzC,GAAKjB,OACzBC,OAAQyD,EAAYzC,GAAKhB,OACzBvsD,IAAKA,KAEF,EAEP,IAAImwD,EAAU7jD,EAAO4jD,WAAW5jD,EAAO4jD,WAAW3hE,OAAO,GAAGyR,IAO5D,OANAsM,EAAO4jD,WAAWr4D,MAClByU,EAAO4jD,WAAW1+D,KAAK,CACnB86D,OAAQ0D,EAAYzC,GAAKjB,OACzBC,OAAQyD,EAAYzC,GAAKhB,OACzB6D,UAAWpwD,IAERmwD,CAEf,CAWeE,CAAQ9C,EAAKvtD,GAV5B,SAAkButD,EAAKvtD,GACnB,KAAIsM,EAAO4jD,WAAW3hE,OAAS,GAAKg/D,IAAQjhD,EAAO4jD,WAAW5jD,EAAO4jD,WAAW3hE,OAAS,GAAGg+D,QAGxF,OAAOvsD,EAFPsM,EAAO4jD,WAAWr4D,KAI1B,CAMey4D,CAAS/C,EAAKvtD,EAE7B,CACA,SAASuwD,EAAUhD,EAAK6C,GACpB,IAAI9/D,EAAIi9D,EAAIh9D,MAAM,yDAClB,GAAID,EACA,OAAO2/D,EAAe3/D,EAAE,GAAI8/D,EAEpC,CAEI9jD,EAAO8hD,OAAOzvD,QAAQpQ,QAAU+d,EAAO8hD,OAAOzvD,QAAQ,GAAGlN,SACzD6a,EAAO8hD,OAAOzvD,QAAQ,GAAK2N,EAAOkkD,gBAAgBlkD,EAAO8hD,OAAOzvD,QAAQ,GAAI,EAAG2N,EAAO8hD,OAAOtvC,KAAK,KAGzG,IAAK,IAAIzwB,EAAE,EAAEC,EAAKge,EAAO8hD,OAAOtvC,KAAKvwB,OAAOF,EAAEC,EAAKD,IAAK,CACjD,IAAIk/D,EAAMjhD,EAAO8hD,OAAOtvC,KAAKzwB,GACzBhC,EAAMigB,EAAO8hD,OAAOzvD,QAAQtQ,EAAE,GA0BlC,GAxBwB,OAApBie,EAAOmkD,WAEHb,EAAWrC,GACXjhD,EAAOmkD,SAASj/D,KAAKo+D,EAAWrC,IACzBjhD,EAAOmkD,SAASliE,QAAUg/D,IAAQjhD,EAAOmkD,SAASnkD,EAAOmkD,SAASliE,OAAS,IAClF+d,EAAOmkD,SAAS54D,OAIE,OAAtByU,EAAOokD,YAEHnD,EAAIh9D,MAAM,eACV+b,EAAOokD,YAAa,GAKG,IAA3BpkD,EAAOmkD,SAASliE,OAChB+d,EAAO8hD,OAAOzvD,QAAQtQ,EAAE,GAAKie,EAAOkkD,gBAAgBnkE,EAAKgC,EAAE,EAAGie,EAAO8hD,OAAO9hD,EAAO8hD,OAAOtvC,KAAKzwB,EAAE,IAE1Fie,EAAO8hD,OAAOzvD,QAAQtQ,EAAE,GAAGoD,SAClC6a,EAAOqkD,YAAc,MAGC,OAAtBrkD,EAAO4jD,WAGP,IADIU,EAAWL,EAAShD,EAAKl/D,KACA,IAAbuiE,EAAgB,CAC5B,IAAIC,EAAWvkD,EAAO8hD,OAAOrvC,YAAY6xC,EAAS,GAAGvgE,MAAM,EAAG,GAC9Dic,EAAO8hD,OAAOzvD,QAAQiyD,EAAS,GAAKC,EAAWvkD,EAAO8hD,OAAOzvD,QAAQiyD,EAAS,GAAGvgE,MAAM,GACvFic,EAAOqkD,YAAc,IACzB,CAIArkD,EAAOwkD,SACHzkE,EAAIoF,SACJ6a,EAAOwkD,SAAU,GAGrBxkD,EAAOokD,YACHrkE,EAAIoF,SACJ6a,EAAOokD,YAAa,EAGhC,CACA,GAAIpkD,EAAO4jD,WACP,IAAS7hE,EAAE,EAAEC,EAAKge,EAAO4jD,WAAW3hE,OAAOF,EAAEC,EAAKD,IAAK,CACnD,IAAIuiE,EAGJ,QAAwB,KAHpBA,EAAWtkD,EAAO4jD,WAAW7hE,GAAG2R,KAGC,CAC7B6wD,EAAWvkD,EAAO8hD,OAAOrvC,YAAY6xC,EAAS,GAAGvgE,MAAM,EAAG,GAC9Dic,EAAO8hD,OAAOzvD,QAAQiyD,EAAS,GAAKC,EAAWvkD,EAAO8hD,OAAOzvD,QAAQiyD,EAAS,GAAGvgE,MAAM,EAC3F,CACJ,CAGJ,GAAIic,EAAOqkD,YAAa,CACpB,IAAII,EAAYpB,EAAWvhE,MAAMke,EAAO8hD,OAAOzvD,QAAQ2N,EAAOqkD,YAAYhyD,UACtEqyD,EAAWD,EAAUpyD,QAAQ2N,EAAOqkD,YAAYM,OAChDD,EAASziE,OAAS,GAAKrC,EAAIgB,kBAAkB2e,KAAKhf,KAAMmkE,GAAUzgE,MAAM+b,EAAO4kD,gBAC/EF,EAAWnB,EAAYhkD,KAAKhf,KAAMmkE,GAClCD,EAAUpyD,QAAQ2N,EAAOqkD,YAAYM,OAASD,GAElD1kD,EAAO8hD,OAAOzvD,QAAQ2N,EAAOqkD,YAAYhyD,SAAWgxD,EAAWnhE,KAAKuiE,EACxE,CAGA,OAAOrB,EAAUlhE,KAAK8d,EAAO8hD,OACjC,CAoNA,MAAO,CACH/J,WAAYA,EACZ7lC,YA7MJ,SAAsB1wB,EAAOzB,GACzB,OAAOA,CACX,EA4MI8kE,UAvMJ,SAAmBrjE,EAAOq2B,GACtB,IAAI7X,EAAS,CACT4jD,WAAY,KACZM,gBAAiB,SAASnkE,GAEtB,IADA,IAAI4kE,EAAQ5kE,EAAI+B,MAAM,KACbC,EAAE,EAAEC,EAAK2iE,EAAM1iE,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIyhE,EAAOmB,EAAM5iE,GACbyhE,IACAmB,EAAM5iE,GAAKnC,EAAIgB,kBAAkB2e,KAAK/d,EAAOgiE,GAErD,CACA,OAAOmB,EAAMziE,KAAK,IACtB,EACA0iE,aAAc,KACdT,SAAU,GACVC,WAAY,KACZI,QAAS,MAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAqLIitC,UAhLJ,SAAmBtjE,EAAOq2B,GACtB,IAAI7X,EAAS,CACT4jD,WAAY,KACZM,gBAAiB,SAASnkE,GAEtB,IADA,IAAI4kE,EAAQ5kE,EAAI+B,MAAM,KACbC,EAAE,EAAEC,EAAK2iE,EAAM1iE,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIyhE,EAAOmB,EAAM5iE,GACbyhE,IASAmB,EAAM5iE,GAAKnC,EAAIS,kBAAkBkf,KAAK/d,EAAOgiE,GAErD,CACA,OAAOmB,EAAMziE,KAAK,IACtB,EACA0iE,aAAc,KACdT,SAAU,GACVC,WAAY,KACZI,QAAS,MAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAsJIpqB,SAhJJ,SAAkBjM,EAAOq2B,GACrB,IAAI7X,EAAS,CACT4jD,WAAY,GACZM,gBAAiB,SAASnkE,GAEtB,IADA,IAAI4kE,EAAQ5kE,EAAI+B,MAAM,KACbC,EAAE,EAAEC,EAAK2iE,EAAM1iE,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIyhE,EAAOmB,EAAM5iE,GACbyhE,IACIxjD,EAAOwkD,SACPG,EAAM5iE,GAAKwhE,EAAYhkD,KAAK/d,EAAOgiE,GACnCxjD,EAAOwkD,SAAU,GAEjBG,EAAM5iE,GAAKnC,EAAIgB,kBAAkB2e,KAAK/d,EAAOgiE,GAGzD,CACA,OAAOmB,EAAMziE,KAAK,IACtB,EACA0iE,aAAc,KACdT,SAAU,GACVC,WAAY,KACZI,SAAS,GAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAyHIr1B,MAvHJ,SAAehB,EAAOq2B,GAClB,IAAI7X,EAAS,CACT4jD,WAAY,GACZM,gBAAiB,SAASnkE,EAAKgC,EAAGgjE,GAC9B,GAAIhlE,EAAIoF,OAAQ,CAGZ,IAFA,IAAI6/D,EAAS3B,EAAWvhE,MAAM/B,GAC1B4kE,EAAQK,EAAO3yD,QACVhP,EAAE,EAAE4B,EAAK0/D,EAAM1iE,OAAOoB,EAAE4B,EAAK5B,IAAK,CACvC,IAAImgE,EAAOmB,EAAMthE,GACjB,IAAKmgE,EACD,SAEJ,IAAIyB,EAAQrlE,EAAIgB,kBAAkB2e,KAAK/d,EAAOgiE,GAC1C0B,GAAa,GACb1B,EAAKvhE,OAAS,IAAMgjE,EAAMhhE,MAAM+b,EAAO4kD,eAGhCvhE,IAAOshE,EAAM1iE,OAAS,GAAuB,MAAjB8iE,GAE5B/kD,EAAOwkD,SAGPxkD,EAAOokD,cANdc,GAAa,GAWbA,GAAc1B,IAASyB,IACvBN,EAAMthE,GAAKkgE,EAAYhkD,KAAK/d,EAAOgiE,IAEvCxjD,EAAOokD,YAAa,EACpBpkD,EAAOwkD,SAAU,EACjBxkD,EAAOqkD,YAAc,CACjBhyD,QAAStQ,EACT4iE,MAAOthE,EAEf,CACAtD,EAAMsjE,EAAWnhE,KAAK8iE,EAC1B,CACA,OAAOjlE,CACX,EACA6kE,aAAcpjE,EAAM0B,OAAO1B,EAAMC,IAAIqB,MAAMK,KAAK,qBAChDghE,SAAU,GACVC,YAAY,EACZI,SAAS,GAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAyEI,mBAlEJ,SAAyBr2B,EAAOq2B,GAC5B,IAAI7X,EAAS,CACT4jD,WAAY,GACZM,gBAAiB,SAASnkE,GAGtB,IAFA,IAAIilE,EAAS3B,EAAWvhE,MAAM/B,GAC1B4kE,EAAQK,EAAO3yD,QACVtQ,EAAE,EAAEC,EAAK2iE,EAAM1iE,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIyhE,EAAOmB,EAAM5iE,GACjB,GAAIyhE,GACIxjD,EAAOwkD,QAAS,CAEZhB,IAAS5jE,EAAIgB,kBAAkB2e,KAAK/d,EAAOgiE,KAC3CmB,EAAM5iE,GAAKwhE,EAAYhkD,KAAK/d,EAAOgiE,IAEvCxjD,EAAOwkD,SAAU,EACjB,KACJ,CAER,CACA,OAAOnB,EAAWnhE,KAAK8iE,EAC3B,EACAJ,aAAc,KACdT,SAAU,GACVC,WAAY,KACZI,SAAS,GAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAwCI,iBAhCJ,SAAwBr2B,EAAOq2B,GAC3B,IAAI7X,EAAS,CACT4jD,WAAY,GACZM,gBAAiB,SAASnkE,GAGtB,IAFA,IAAIilE,EAAS3B,EAAWvhE,MAAM/B,GAC1B4kE,EAAQK,EAAO3yD,QACVtQ,EAAE,EAAEC,EAAK2iE,EAAM1iE,OAAOF,EAAEC,EAAKD,IAAK,CACvC,IAAIyhE,EAAOmB,EAAM5iE,GACbyhE,GAEIA,IAAS5jE,EAAIgB,kBAAkB2e,KAAK/d,EAAOgiE,KAC3CmB,EAAM5iE,GAAKwhE,EAAYhkD,KAAK/d,EAAOgiE,GAG/C,CACA,OAAOH,EAAWnhE,KAAK8iE,EAC3B,EACAJ,aAAc,KACdT,SAAU,GACVC,WAAY,KACZI,QAAS,MAEb,OAAOf,EAAgBlkD,KAAK/d,EAAOwe,EAAQ6X,EAC/C,EAWJ,CA/YwB,GAwZxBj4B,EAAI2N,OAAOU,QAAU,WAAa,EAQlCrO,EAAI2N,OAAOU,QAAQsH,UAAU4vD,KAAO,CAOhC,YAAe,SAAU3oD,GAOrB,OAHKA,IACDA,EAAO,IAEJA,EAAKnY,QAAQ,KAAM,SACrBA,QAAQ,KAAM,SACdA,QAAQ,KAAM,SACdA,QAAQ,QAAS,MACjBA,QAAQzE,EAAIwR,qBACJ,SAASg0D,GAEL,MAAO,QAAUxlE,EAAIuR,aAAai0D,GAAS,QAC/C,GACjB,EACA,SAAY,+BACZ,OAAU,SACV,qBAAsB,oBACtB,sBAAuB,sBACvB,qBAAsB,qDACtB,2BAA4B,2DAC5B,oBAAqBxlE,EAAI2N,OAAOC,WAAW0kB,YAC3C,uBAAwB,uDACxB,oBAAqB,oBACrB,sBAAuB,sDACvB,sBAAsB,EACtB,wBAAyB,wDACzB,6BAA8B,6DAC9B,sBAAuB,wBACvB,sBAAuB,wBACvB,2BAA4B,2CAC5B,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChByB,EAAM+qB,QAAQ,cAElB/qB,EAAM+qB,QAAQ,cAAgBxsB,EAAMyB,EAAM+qB,QAAQ,cAC7D,EACA,gBAAiB,SAAU/qB,EAAOzB,GAC9B,YAAI,IAAuBA,EAIhB,IAEJyB,EAAM+qB,QAAQ,oBAAsBxsB,EAAMyB,EAAM+qB,QAAQ,oBACnE,EACA,iBAAiB,EAIjB,cAAe,SAAU/qB,EAAOzB,GAC5B,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WACpF,EACG,sBAAuB,SAAU39C,EAAOzB,GAcpC,IAAIulB,EAAS,GAIb,OAHI9jB,EAAM2S,IAAIs9B,yBACVnsB,EAAS9jB,EAAM2S,IAAIs9B,uBAAuBlxC,KAAKqnC,SAAW,MAEvD,4BAAgC7nC,EAAM,WAAaulB,CAC9D,EACA,iBAAkB,SAAU9jB,EAAOzB,GAC/B,MAAO,kCAAsCA,EAAM,UACvD,EACA,uBAAwB,SAAUyB,EAAOzB,GACrC,MAAO,sCAA0CA,EAAM,QAC3D,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,MAAO,iCAAqCA,EAAM,YACtD,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,2BAA+BA,EAAM,YAChD,EACA,eAAgB,SAAUyB,EAAOzB,EAAKoiB,GAClC,GAAK3gB,EAAMhB,IAAIq2B,cAAkBr1B,EAAMhB,IAAIm4B,qBAoBvC,OAAO54B,EAnBP,GAAIoiB,EACA,MAAO,gBAAmB3gB,EAAMC,IAAI4oB,UAAUlI,GAAS,YAAgBA,EAAQ,KAAQpiB,EAAM,UAC1F,GAAIQ,KAAKyxB,QAAU,iBAAoBjyB,EAAK,CAC/C,IAAIslE,EAAW,GACf,GAAItlE,EAAK,CACL,IAAIiE,EAAIjE,EAAIkE,MAAMrE,EAAI4oB,+BACtB68C,EAAWrhE,EAAE,GACbjE,EAAMiE,EAAE,EACZ,CACA,IAAIshE,EAAY,GAKhB,OAJIvlE,GAAOH,EAAImJ,qBAAqBzF,QAAQvD,EAAIgE,OAAO,KAAO,IAC1DuhE,EAAYvlE,EAAIgE,OAAO,GACvBhE,EAAMA,EAAIgE,MAAM,GAAG,IAEhBvC,EAAM2S,IAAIoU,gBAAgBhoB,KAAKyxB,OAAQqzC,EAAUtlE,EAAKulE,EACjE,CACI,OAAOvlE,CAKnB,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,MAAO,YAAeA,EAAM,KAAQA,EAAM,MAC9C,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,IAAIwlE,EAASxlE,EAIb,OAHKA,EAAIkE,MAAM,kBACXshE,EAAS,mBAAqBxlE,GAE3B,YAAewlE,EAAS,KAAQxlE,EAAM,MACjD,GASJH,EAAI2N,OAAOU,QAAQsH,UAAUiH,KAAO,CAOhC,YAAe,SAAUA,GAIrB,OAHKA,IACDA,EAAO,IAEJA,CACX,EACA,SAAY,GACZ,OAAU,GACV,sBAAsB,EACtB,uBAAuB,EACvB,sBAAsB,EACtB,4BAA4B,EAC5B,oBAAqB5c,EAAI2N,OAAOC,WAAW0kB,YAC3C,wBAAwB,EACxB,qBAAqB,EACrB,uBAAuB,EACvB,sBAAsB,EACtB,yBAAyB,EACzB,8BAA8B,EAC9B,4BAA4B,EAC5B,uBAAuB,EACvB,uBAAuB,EACvB,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChByB,EAAM+qB,QAAQ,cAElB/qB,EAAM+qB,QAAQ,cAAgBxsB,EAAMyB,EAAM+qB,QAAQ,cAC7D,EACA,gBAAiB,SAAU/qB,EAAOzB,GAC9B,YAAI,IAAuBA,EAIhB,IAEJyB,EAAM+qB,QAAQ,oBAAsBxsB,EAAMyB,EAAM+qB,QAAQ,oBACnE,EACA,iBAAiB,EAIjB,cAAe,SAAU/qB,EAAOzB,GAClC,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WAC9E,EACG,sBAAuB,SAAU39C,EAAOzB,GACpC,OAAOA,EAAI,IACf,EACA,iBAAkB,SAAUyB,EAAOzB,GAC/B,MAAO,KAAKA,CAChB,EACA,uBAAwB,SAAUyB,EAAOzB,GACrC,OAAOA,CACX,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,OAAOA,CACX,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,SAASA,CACpB,EACA,eAAgB,SAAUyB,EAAOzB,GAC7B,OAAOA,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,OAAOA,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,OAAOA,CACX,GASJH,EAAI2N,OAAOU,QAAQsH,UAAUiwD,IAAM,CAO/B,YAAe,SAAUhpD,GAIrB,OAHKA,IACDA,EAAO,IAEJA,EACNnY,QAAQ,YAAa,QACrBA,QAAQzE,EAAIwR,qBACJ,SAASg0D,GACL,MAAO,WAAaxlE,EAAIuR,aAAai0D,GAAS,gBAClD,IACR/gE,QAAQ,oBACA,SAAS+gE,GAAS,MAAO,WAAWA,EAAMK,WAAW,GAAGrzB,WAAW,IAAM,IACjFtwC,MAAM,MAAMI,KAAK,UACtB,EACA,oBAAqBtC,EAAI2N,OAAOC,WAAW0kB,YAC3C,qBAAqB,oBACrB,qBAAqB,qBACrB,sBAAsB,oBACtB,2BAA2B,uBAC3B,uBAAuB,yBACvB,oBAAoB,oBACpB,sBAAsB,qBACtB,sBAAqB,EACrB,yBAAwB,EACxB,6BAA6B,qBAC7B,4BAA2B,EAC3B,sBAAsB,mCACtB,sBAAsB,iCACtB,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChBH,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY1M,EAAM+qB,QAAQ,eAErD3sB,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY1M,EAAM+qB,QAAQ,eAAiBxsB,EAAMH,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY1M,EAAM+qB,QAAQ,eACpI,EACA,gBAAiB,SAAU/qB,EAAOzB,GAC9B,YAAI,IAAuBA,EAChBH,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY,KAEvCtO,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY1M,EAAM+qB,QAAQ,qBAAuBxsB,EAAMH,EAAI2N,OAAOU,QAAQu3D,IAAIt3D,YAAY1M,EAAM+qB,QAAQ,qBAC1I,EACA,iBAAiB,EACjB,SAAW,UACX,OAAS,IACT,iBAAkB,+BAClB,cAAe,SAAU/qB,EAAOzB,GAGlC,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WAC9E,EACG,sBAAuB,SAAS39C,EAAMzB,GAClC,OAAOA,CACX,EACA,uBAAwB,SAASyB,EAAMzB,GACnC,OAAOA,EAAI,QACf,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,OAAOA,EAAI,MACf,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,WAAWA,EAAI,YAC1B,EACA,eAAgB,SAAUyB,EAAOzB,GAC7B,GAAKyB,EAAMhB,IAAIq2B,cAAkBr1B,EAAMhB,IAAIm4B,qBAcvC,OAAO54B,EAbP,IAAIslE,EAAW,GACf,GAAItlE,EAAK,CACL,IAAIiE,EAAIjE,EAAIkE,MAAMrE,EAAI4oB,+BACtB68C,EAAWrhE,EAAE,GACbjE,EAAMiE,EAAE,EACZ,CACA,IAAIshE,EAAY,GAKhB,OAJIvlE,GAAOH,EAAImJ,qBAAqBzF,QAAQvD,EAAIgE,OAAO,KAAO,IAC1DuhE,EAAYvlE,EAAIgE,OAAO,GACvBhE,EAAMA,EAAIgE,MAAM,GAAG,IAEhBvC,EAAM2S,IAAIoU,gBAAgBhoB,KAAKyxB,OAAQqzC,EAAUtlE,EAAKulE,EAIrE,EACA,YAAa,SAAU9jE,EAAOzB,GAC1B,OAAOA,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,OAAOA,CACX,GAsBJH,EAAI2N,OAAOU,QAAQsH,UAAUmwD,SAAW,CACpC,YAAe,SAAUlpD,GAIrB,OAHKA,IACDA,EAAO,IAEJA,EAAKnY,QAAQ,IAAK,WAAY,KAChCA,QAAQ,IAAK,WAAY,KACzBA,QAAQ,IAAK,WAAY,KACzBA,QAAQ,IAAK,WAAY,KACzBA,QAAQ,IAAK,WAAY,KACzBA,QAAQ,KAAM,YAAa,KAC3BA,QAAQ,KAAM,UAAW,KACzBA,QAAQzE,EAAIwR,qBAAqB,SAASg0D,GACvC,MAAO,IAAMxlE,EAAIuR,aAAai0D,GAAS,GAC3C,GACR,EACA,SAAY,GACZ,OAAU,GACV,oBAAqBxlE,EAAI2N,OAAOC,WAAW0kB,YAC3C,qBAAsB,iBACtB,sBAAuB,iBACvB,sBAAsB,EACtB,2BAA4B,2BAC5B,wBAAwB,EACxB,oBAAqB,iBACrB,uBAAuB,EACvB,sBAAsB,EACtB,yBAAyB,EACzB,6BAA8B,4BAC9B,sBAAuB,iBACvB,sBAAuB,iBACvB,4BAA4B,EAC5B,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChB,KAEJ,KAAOA,EAAM,IACxB,EACA,gBAAiB,SAAUyB,EAAOzB,GAC9B,YAAI,IAAuBA,EAChB,IAEJ,IAAMA,EAAM,GACvB,EACA,iBAAiB,EACjB,cAAe,SAAUyB,EAAOzB,GAE5B,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WACjF,EACA,sBAAuB,SAAU39C,EAAOzB,GACpC,OAAOA,EAAM,IACjB,EACA,iBAAkB,SAAUyB,EAAOzB,GAC/B,OAAOA,CACX,EACA,uBAAwB,SAAUyB,EAAOzB,GACrC,OAAOA,CACX,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,MAAO,IAAMA,CACjB,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,IAAMA,CACjB,EACA,eAAgB,SAAUyB,EAAOzB,GAC7B,GAAKyB,EAAMhB,IAAIq2B,cAAiBr1B,EAAMhB,IAAIm4B,uBAAwBp4B,KAAKyxB,QAAU,iBAAoBjyB,EAcjG,OAAOA,EAbP,IAAIslE,EAAW,GACf,GAAItlE,EAAK,CACL,IAAIiE,EAAIjE,EAAIkE,MAAMrE,EAAI4oB,+BACtB68C,EAAWrhE,EAAE,GACbjE,EAAMiE,EAAE,EACZ,CACA,IAAIshE,EAAY,GAKhB,OAJIvlE,GAAOH,EAAImJ,qBAAqBzF,QAAQvD,EAAIgE,OAAO,KAAO,IAC1DuhE,EAAYvlE,EAAIgE,OAAO,GACvBhE,EAAMA,EAAIgE,MAAM,GAAG,IAEhBvC,EAAM2S,IAAIoU,gBAAgBhoB,KAAKyxB,OAAQqzC,EAAUtlE,EAAKulE,EAIrE,EACA,YAAa,SAAU9jE,EAAOzB,GAE1B,OAAOA,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,IAAIwlE,EAASxlE,EAIb,OAHKA,EAAIkE,MAAM,kBACXshE,EAAS,mBAAqBxlE,GAE3BwlE,EAAS,IAAMxlE,EAAM,GAChC,GASJH,EAAI2N,OAAOU,QAAQsH,UAAUowD,GAAK,CAC9B,YAAe,SAAUnpD,GAIrB,OAHKA,IACDA,EAAO,IAEJA,EAAKnY,QAAQ,KAAM,SACrBA,QAAQ,KAAM,SACdA,QAAQ,KAAM,SACdA,QAAQ,KAAM,UAAW,KACzBA,QAAQzE,EAAIwR,qBAAqB,SAASg0D,GACvC,MAAO,qCAAyCxlE,EAAIuR,aAAai0D,GAAS,cAC9E,GACR,EACA,SAAY,GACZ,OAAU,GACV,oBAAqBxlE,EAAI2N,OAAOC,WAAW0kB,YAC3C,qBAAsB,wDACtB,sBAAuB,yDACvB,qBAAsB,wDACtB,2BAA4B,8DAC5B,uBAAwB,0DACxB,oBAAqB,uDACrB,sBAAuB,yDACvB,qBAAsB,0DACtB,wBAAyB,2DACzB,6BAA8B,gEAC9B,sBAAuB,2DACvB,sBAAuB,yDACvB,2BAA4B,8DAC5B,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChByB,EAAM+qB,QAAQ,cAElB/qB,EAAM+qB,QAAQ,cAAgBxsB,EAAMyB,EAAM+qB,QAAQ,cAC7D,EACA,gBAAiB,SAAU/qB,EAAOzB,GAC9B,YAAI,IAAuBA,EAChB,IAEJyB,EAAM+qB,QAAQ,oBAAsBxsB,EAAMyB,EAAM+qB,QAAQ,oBACnE,EACA,iBAAiB,EACjB,cAAe,SAAU/qB,EAAOzB,GAC5B,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WACjF,EACA,sBAAuB,SAAU39C,EAAOzB,GACpC,IAAI6lE,EAAS,GACb,GAAIpkE,EAAMioB,cAAgBjoB,EAAMioB,aAAahoB,KAAOD,EAAMioB,aAAahoB,IAAIkuC,cAAe,CACtF,IAAIk2B,EAAKrkE,EAAMioB,aAAahoB,IAAIkuC,cAChCi2B,EAAS,kBAAqBC,EAAI,qBAAyBA,EAAK,KACpE,CACA,IAAIvgD,EAAS,GAIb,OAHI9jB,EAAM2S,IAAIs9B,yBACVnsB,EAAS9jB,EAAM2S,IAAIs9B,uBAAuBlxC,KAAKqnC,SAAW,MAEvD,iBAAoBrnC,KAAKixC,UAAY,IAAOo0B,EAAS,IAAM7lE,EAAM,gBAAkBulB,CAC9F,EACA,iBAAkB,SAAU9jB,EAAOzB,GAC/B,MAAO,iBAAmBA,EAAM,eACpC,EACA,uBAAwB,SAAUyB,EAAOzB,GACrC,MAAO,qTAM4BA,EAN5B,iDAQX,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,MAAO,wCACgBA,EADhB,qGAMX,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,+BAAmCA,EAAM,eACpD,EACA,eAAgB,SAAUyB,EAAOzB,GAC7B,GAAKyB,EAAMhB,IAAIq2B,cAAiBr1B,EAAMhB,IAAIm4B,uBAAwBp4B,KAAKyxB,QAAU,iBAAoBjyB,EAcjG,OAAOA,EAbP,IAAIslE,EAAW,GACf,GAAItlE,EAAK,CACL,IAAIiE,EAAIjE,EAAIkE,MAAMrE,EAAI4oB,+BACtB68C,EAAWrhE,EAAE,GACbjE,EAAMiE,EAAE,EACZ,CACA,IAAIshE,EAAY,GAKhB,OAJIvlE,GAAOH,EAAImJ,qBAAqBzF,QAAQvD,EAAIgE,OAAO,KAAO,IAC1DuhE,EAAYvlE,EAAIgE,OAAO,GACvBhE,EAAMA,EAAIgE,MAAM,GAAG,IAEhBvC,EAAM2S,IAAIoU,gBAAgBhoB,KAAKyxB,OAAQqzC,EAAUtlE,EAAKulE,EAIrE,EACA,YAAa,SAAU9jE,EAAOzB,GAC1B,MAAO,8CAAgDA,EAAM,QAAUA,EAAM,kBACjF,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,IAAIwlE,EAASxlE,EAIb,OAHKA,EAAIkE,MAAM,kBACXshE,EAAS,mBAAqBxlE,GAE3B,8CAAgDwlE,EAAS,QAAUxlE,EAAM,kBACpF,GAQJH,EAAI2N,OAAOU,QAAQsH,UAAUuwD,MAAQ,CACjC,YAAe,SAAUtpD,GAIrB,OAHKA,IACDA,EAAO,IAEJA,CACX,EACA,SAAY,8BACZ,OAAU,uBACV,qBAAsB,oBACtB,uBAAuB,EACvB,sBAAsB,EACtB,4BAA4B,EAC5B,oBAAqB5c,EAAI2N,OAAOC,WAAW0kB,YAC3C,wBAAwB,EACxB,oBAAqB,oBACrB,uBAAuB,EACvB,sBAAsB,EACtB,yBAAyB,EACzB,8BAA8B,EAC9B,4BAA4B,EAC5B,uBAAuB,EACvB,uBAAuB,EACvB,sBAAuBtyB,EAAI2N,OAAOC,WAAW0kB,YAC7C,uBAAwBtyB,EAAI2N,OAAOC,WAAW0kB,YAC9C,eAAgB,SAAU1wB,EAAOzB,GAC7B,YAAI,IAAuBA,EAChByB,EAAM+qB,QAAQ,cAElB/qB,EAAM+qB,QAAQ,cAAgBxsB,EAAMyB,EAAM+qB,QAAQ,cAC7D,EACA,gBAAiB,SAAU/qB,EAAOzB,GAC9B,YAAI,IAAuBA,EAIhB,IAEJyB,EAAM+qB,QAAQ,oBAAsBxsB,EAAMyB,EAAM+qB,QAAQ,oBACnE,EACA,iBAAiB,EAIjB,cAAe,SAAU/qB,EAAOzB,GAClC,OAAOyB,EAAM2S,IAAI84B,kBAAkBltC,EAAKQ,KAAKqnC,QAASrnC,KAAK2+C,YAAa3+C,KAAK4+C,WAC9E,EACG,sBAAuB,SAAU39C,EAAOzB,GACpC,MAAO,aAAeyB,EAAM2S,IAAIs9B,uBAAuBlxC,KAAKqnC,SAAW,KAC3E,EACA,iBAAkB,SAAUpmC,EAAOzB,GAC/B,MAAO,KAAKA,CAChB,EACA,uBAAwB,SAAUyB,EAAOzB,GACrC,OAAOA,CACX,EACA,wBAAyB,SAAUyB,EAAOzB,GACtC,OAAOA,CACX,EACA,kBAAmB,SAAUyB,EAAOzB,GAChC,MAAO,SAASA,CACpB,EACA,eAAgB,SAAUyB,EAAOzB,EAAKoiB,GAClC,OAAOpiB,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,OAAOA,CACX,EACA,YAAa,SAAUyB,EAAOzB,GAC1B,OAAOA,CACX,GAGJH,EAAI2N,OAAOU,QAAU,IAAIrO,EAAI2N,OAAOU,QA4DpCrO,EAAIyrB,SAAW,SAAU7pB,GACrBjB,KAAKN,OAAQ,EACbM,KAAKiB,MAAQA,EACbjB,KAAKyT,SAAW,CAAC,EACjBzT,KAAK6kC,QAAU,GACf7kC,KAAKuuB,QAAU,CAAC,EAChBvuB,KAAKimD,QAAU,IAAI5mD,EAAIyrB,SAAS06C,QAAQvkE,GACxCjB,KAAK2jC,YAAc,IAAItkC,EAAIyrB,SAAS26C,YAAYxkE,GAGhDjB,KAAKymC,cAAgB,CAAC,EAGtBzmC,KAAK0lE,UAAY,CAAC,EAIlB1lE,KAAKszC,OAAS,GACdtzC,KAAKozC,OAAS,CAAC,EACfpzC,KAAK2lE,QAAU,GACf3lE,KAAK4lE,QAAU,GACf5lE,KAAK6lE,QAAU,CAAC,EAChB7lE,KAAK8lE,UAAY,CAAC,EAClB9lE,KAAK+lE,MAAQ,CAAC,EACd/lE,KAAKgmE,OAAS,CAAC,EACfhmE,KAAK2kC,YAAc,CAAC,EAIpB3kC,KAAKqlC,WAAa,CAAC,EACnBrlC,KAAKimE,YAAc,CAAC,EACpBjmE,KAAKkmE,OAAS,IAAI7mE,EAAIyrB,SAAS0X,YAAYvhC,EAAO,qBAIlDjB,KAAKywC,aAAe,WAEhB,IADA,IAAIhmC,EAAM,GACDjJ,EAAI,EAAGC,EAAOzB,KAAK6kC,QAAQnjC,OAAQF,EAAIC,EAAMD,GAAK,EACvDiJ,EAAI9F,KAAK,GAAK3E,KAAK6kC,QAAQrjC,GAAG6sB,IAElC,OAAO5jB,CACX,EAEAzK,KAAKmmE,uBAAyB,WAE1B,IADA,IAAI17D,EAAM,GACDjJ,EAAI,EAAGC,EAAOzB,KAAK6kC,QAAQnjC,OAAQF,EAAIC,EAAMD,GAAK,EACvDiJ,EAAI9F,KAAK3E,KAAK6kC,QAAQrjC,IAE1B,OAAOiJ,CACX,CACJ,EA2DApL,EAAIyrB,SAAS9V,UAAUyW,KAAO,SAAUwmB,EAASm0B,GAY7C,GAVApmE,KAAKgmE,OAAS,CAAC,EAUXI,EAAc,CAGdpmE,KAAK6lE,QAAU,CAAC,EAChB,IAAK,IAAIrkE,EAAE,EAAEC,EAAKwwC,EAAQvwC,OAAOF,EAAEC,EAAMD,GAAK,EACrCxB,KAAKozC,OAAOnB,EAAQzwC,KACrBxB,KAAKszC,OAAO3uC,KAAK,GAAKstC,EAAQzwC,IAElCxB,KAAK6lE,QAAQ5zB,EAAQzwC,KAAM,EAC3BxB,KAAKozC,OAAOnB,EAAQzwC,KAAM,CAElC,KAAO,CAIH,IAAK,IAAIyD,KAAOjF,KAAK6lE,QACjB5zB,EAAQttC,KAAKM,GAEjB,IAAImuC,EAAS,CAAC,EACd,IAAK5xC,EAAEywC,EAAQvwC,OAAO,EAAEF,GAAG,EAAGA,IAAM,EAC5B4xC,EAAOnB,EAAQzwC,IACfywC,EAAUA,EAAQzuC,MAAM,EAAGhC,GAAGsE,OAAOmsC,EAAQzuC,MAAMhC,EAAI,IAEvD4xC,EAAOnB,EAAQzwC,KAAM,EAG7BxB,KAAKszC,OAASrB,EACdjyC,KAAKozC,OAASA,CAClB,CAIApzC,KAAK8lE,UAAY,CAAC,EAClB9lE,KAAKqmE,QAAU,CAAC,EAChBrmE,KAAKkzC,cAAgB,CAAC,EACtBlzC,KAAKimE,YAAc,CAAC,CACxB,EAEA5mE,EAAIyrB,SAAS9V,UAAU8+B,QAAU,SAAUV,GAEvC,IAAK,IAAI5xC,EAAExB,KAAKszC,OAAO5xC,OAAO,EAAEF,GAAG,EAAEA,IAAI,EAEjCxB,KAAK2jC,YAAYiC,oBACX5lC,KAAK2jC,YAAYiC,mBAAsB5lC,KAAK2jC,YAAYiC,kBAAkB5lC,KAAKszC,OAAO9xC,KAAS4xC,EAAOpzC,KAAKszC,OAAO9xC,aAC7GxB,KAAKozC,OAAOpzC,KAAKszC,OAAO9xC,WACxBxB,KAAK6lE,QAAQ7lE,KAAKszC,OAAO9xC,IAChCxB,KAAKszC,OAAStzC,KAAKszC,OAAO9vC,MAAM,EAAEhC,GAAGsE,OAAO9F,KAAKszC,OAAO9vC,MAAMhC,EAAE,MAI5ExB,KAAKmzC,UAAUnzC,KAAKozC,OACxB,EAEA/zC,EAAIyrB,SAAS9V,UAAUm+B,UAAY,SAAUC,GACzC,IAAqBhO,EAAOjyB,EAAKC,EAAKkzD,EAAOC,EAAMxvB,EAAO1oB,EAC1D,GAAI,iBAAoB+kB,EAAQ,CAC5B,IAAInuC,EAAMmuC,GACVA,EAAS,CAAC,GACHnuC,IAAO,CAClB,CAIA,IAAK,IAAIA,KAAOjF,KAAKyT,SACjB,IAAK2/B,EAAOnuC,GAAM,CAEd,GAAIjF,KAAK6lE,QAAQ5gE,GACb,SAYJ,IAAKshE,KAPQvmE,KAAKimD,QAAQugB,SAASvhE,GAQ/BjF,KAAK8lE,UAAUS,IAAQ,EAmB3B,IAdAnhC,EAAQplC,KAAKyT,SAASxO,GAAKmgC,OAC3B2R,EAAQ/2C,KAAKqlC,WAAWD,GAAOriC,QAAQkC,KAC1B,IACTqhE,EAAQtmE,KAAKqlC,WAAWD,GAAO5hC,QAC/BxD,KAAKqlC,WAAWD,GAASkhC,EAAM9iE,MAAM,EAAGuzC,GAAOjxC,OAAOwgE,EAAM9iE,MAAMuzC,EAAM,EAAGuvB,EAAM5kE,SACjF1B,KAAKimE,YAAY7gC,GAASplC,KAAKqlC,WAAWD,GAAO1jC,QAQrD0R,EAAMpT,KAAKqlC,WAAWD,GAAO1jC,OACxByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5Bkb,EAAK,GAAKruB,KAAKqlC,WAAWD,GAAOjyB,GACjCnT,KAAK8lE,UAAUz3C,IAAM,EAMzB,GAAIruB,KAAKyT,SAASxO,GAAK8qC,SACnB,GAA0C,GAAtC/vC,KAAKyT,SAASxO,GAAK8qC,SAASruC,OAAa,CACzC,IAAI+kE,EAAgBzmE,KAAKyT,SAASxO,GAAK8qC,SAAS,GAC5C/vC,KAAKyT,SAASgzD,GAAe12B,WAC7B/vC,KAAKyT,SAASgzD,GAAe12B,SAAS/kC,MACtChL,KAAKyT,SAASgzD,GAAet1B,QAAS,EAG9C,MAAO,GAAInxC,KAAKyT,SAASxO,GAAK8qC,SAASruC,OAAS,EAAG,CAC/C,IAAIglE,EAAY,CAACzhE,GACjB,GAAIjF,KAAKyT,SAASxO,GAAKksC,OAAQ,CAC3B,IAAIw1B,EAAc3mE,KAAKyT,SAASxO,GAAK8qC,SAAS,GAC9B/vC,KAAKyT,SAASkzD,GACpBx1B,QAAS,EAGnBu1B,EAAU/hE,KAAKgiE,EAInB,CAEA,IADA,IAAI/5B,EAAS,GACJ70B,EAAI/X,KAAKyT,SAASxO,GAAK8qC,SAASruC,OAAS,EAAGqW,GAAK,EAAGA,IAAM,EAAG,CAClE,IAAI27C,EAAY1zD,KAAKyT,SAASxO,GAAK8qC,SAAS/kC,OACN,IAAlC07D,EAAU3jE,QAAQ2wD,IAClB9mB,EAAOjoC,KAAK+uD,EAEpB,CACA,IAAS37C,EAAI60B,EAAOlrC,OAAS,EAAGqW,GAAK,EAAGA,IAAM,EAC1C/X,KAAKyT,SAASxO,GAAK8qC,SAASprC,KAAKioC,EAAO70B,GAEhD,CAIJ,IAAK,IAAIvW,EAAExB,KAAK6kC,QAAQnjC,OAAO,EAAEF,GAAG,EAAEA,IAC9BxB,KAAK6kC,QAAQrjC,GAAG6sB,KAAOppB,IACvBjF,KAAK6kC,QAAU7kC,KAAK6kC,QAAQrhC,MAAM,EAAGhC,GAAGsE,OAAO9F,KAAK6kC,QAAQrhC,MAAMhC,EAAE,YAMrExB,KAAKyT,SAASxO,UACdjF,KAAKuuB,QAAQtpB,GAGpBjF,KAAK2kC,YAAYiiC,WAAY,CACjC,CAIR,EAEAvnE,EAAIyrB,SAAS9V,UAAUq+B,UAAY,SAAUC,GACzC,IAAIpwC,EAAMe,EAAM4iE,EAAMnhC,EAASohC,EAC3B,iBAAoBxzB,IACpBA,EAAS,CAACA,IAKd,IAAK,IAAI9xC,EAAI,EAAGC,EAAO6xC,EAAO5xC,OAAQF,EAAIC,EAAMD,GAAK,EACjD0B,EAAOowC,EAAO9xC,GACTxB,KAAKyT,SAASvQ,KAIfe,EAAOjE,KAAKiB,MAAMmtB,aAAalrB,GAU/B2jE,EAAOxnE,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAOgD,GAC7CjE,KAAKkzC,cAAc2zB,IAAQ,EAKtB5iE,EAAKsrB,iBACNvvB,KAAK+lE,MAAMc,IAAQ,GAKvBnhC,EAAU,CACN,GAAM,GAAKxiC,EACX,IAAO,EACP,OAAU,EACV,UAAY,EACZ,OAAS,EACT,UAAY,EACZ,UAAY,EACZ,IAAOe,EACP,SAAW,GAMfjE,KAAKyT,SAASvQ,GAAQwiC,EAIlB1lC,KAAK2jC,YAAYiC,mBAAqB5lC,KAAK2jC,YAAYiC,kBAAkB1iC,KACzElD,KAAKyT,SAASvQ,GAAM,+BAAiClD,KAAK2jC,YAAYiC,kBAAkB1iC,GAAM,GAAG4gC,WAAWC,WAOhH+iC,EAAQznE,EAAIugB,eAAeZ,KAAKhf,KAAKiB,OACrCjB,KAAK+mE,mBAAmBF,EAAM3jE,EAAM4jE,GAapC9mE,KAAKqmE,QAAQnjE,IAAQ,EAErBlD,KAAK2kC,YAAYiiC,WAAY,EAKzC,EAgBAvnE,EAAIyrB,SAAS9V,UAAUw+B,YAAc,SAAUZ,GAC3C,IAAIx/B,EAAKD,EAAKjQ,EAAMe,EAQpB,GAAK2uC,EAqBD,IAFA5yC,KAAK6kC,QAAU,GACfzxB,EAAMpT,KAAKszC,OAAO5xC,OACbyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BjQ,EAAOlD,KAAKszC,OAAOngC,GACnBlP,EAAOjE,KAAKyT,SAASvQ,GACrBlD,KAAK6kC,QAAQlgC,KAAKV,GAClBjE,KAAKgmE,OAAO9iE,GAAQlD,KAAKyT,SAASvQ,GAAM+5C,IACxCj9C,KAAKyT,SAASvQ,GAAM+5C,IAAO9pC,EAAM,OAjBrC,IARAnT,KAAKgnE,gBAAkB,GAOvB5zD,EAAMpT,KAAKszC,OAAO5xC,OACbyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BjQ,EAAOlD,KAAKszC,OAAOngC,IACnBlP,EAAOjE,KAAKyT,SAASvQ,IACZo8C,SACLt/C,KAAKgnE,gBAAgBriE,KAAKV,GAE9BjE,KAAKgmE,OAAO9iE,GAAQlD,KAAKyT,SAASvQ,GAAM+5C,IACxCj9C,KAAKyT,SAASvQ,GAAM+5C,IAAO9pC,EAAM,CAa7C,EASA9T,EAAIyrB,SAAS9V,UAAUu+B,YAAc,WACjC,IAAS0zB,EAUT,IAAK,IAAIhiE,KAAOjF,KAAK8lE,UAEjB,GADAmB,EAAWjnE,KAAKyT,SAASxO,GACzB,CAGAgiE,EAAShhC,cAAW5P,EACpBpyB,EAAOjE,KAAKiB,MAAMitB,YAAYjpB,GAC9B,IAAI4hE,EAAOI,EAAS7hC,MAQpB,IAAK,IAAI8hC,UANL,IAAuBL,IACvB7mE,KAAKiB,MAAMhB,IAAI6f,mBAAoB,EACnC+mD,EAAOxnE,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAOgD,GAC7C6iE,EAAQznE,EAAIugB,eAAeZ,KAAKhf,KAAKiB,OACrCjB,KAAK+mE,mBAAmBF,EAAM5hE,EAAK6hE,IAErB9mE,KAAKimE,YACnB,GAAgC,IAA5BjmE,KAAKimE,YAAYiB,GAAc,CAC/B,IAAIC,EAAUnnE,KAAKqlC,WAAWwhC,GAAM,GAChC5iE,EAAOjE,KAAKiB,MAAMitB,YAAYi5C,GAClCnnE,KAAKyT,SAAS0zD,GAAS7hC,SAAW,IAAIjmC,EAAIuhC,YAC1C5gC,KAAKiB,MAAMhB,IAAI6f,mBAAoB,EAC/B+mD,EAAOxnE,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAOgD,GAAjD,IACI6iE,EAAQznE,EAAIugB,eAAeZ,KAAKhf,KAAKiB,OACzCjB,KAAK+mE,mBAAmBF,EAAMM,EAASL,EAC3C,CAEJ9mE,KAAKiB,MAAMhB,IAAIgwB,eAAehrB,IAAO,EACrCjF,KAAKkzC,cAAc2zB,IAAQ,EACtB5iE,EAAKsrB,iBACNvvB,KAAK+lE,MAAMc,IAAQ,GAEvB7mE,KAAKqmE,QAAQphE,IAAO,CA3BpB,CA6BR,EAMA5F,EAAIyrB,SAAS9V,UAAU0+B,aAAe,WAYlC,IAAK,IAAImzB,KAAQ7mE,KAAKkzC,cAMlBlzC,KAAKiB,MAAMqe,aAAa6pB,IAAI09B,GAEhC7mE,KAAKkzC,cAAgB,CAAC,EACtBlzC,KAAK+lE,MAAQ,CAAC,CAClB,EAIA1mE,EAAIyrB,SAAS9V,UAAU4+B,SAAW,WAC9B,IAAIxgC,EAAKD,EAAKjQ,EAQd,IAJIlD,KAAKiB,MAAM6nB,kBAAkB5nB,IAAI+hC,iCAAmC5jC,EAAIsI,aACxE3H,KAAKiB,MAAM6nB,kBAAkB7oB,IAAI+8C,oBAAsB,CAAC,GAE5D5pC,EAAMpT,KAAK6kC,QAAQnjC,OACdyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,GAC5BjQ,EAAOlD,KAAK6kC,QAAQ1xB,IAGf8pC,IAAO9pC,EAAM,EACdnT,KAAKiB,MAAM6nB,kBAAkB5nB,IAAI+hC,iCAAmC5jC,EAAIsI,aACxE3H,KAAKiB,MAAM6nB,kBAAkB7oB,IAAI+8C,oBAAoB95C,EAAK+5C,KAAQj9C,KAAK6kC,QAAQnjC,OAASwB,EAAK+5C,IAAM,GAInGj9C,KAAKiB,MAAMC,IAAI2gB,cAAgBxiB,EAAIqJ,SAAWxF,EAAK+5C,KAAOj9C,KAAKgmE,OAAO9iE,EAAKmrB,MAC3EruB,KAAKiB,MAAMhB,IAAIgwB,eAAe/sB,EAAKmrB,KAAM,GAEzCnrB,EAAK+5C,KAAOj9C,KAAKgmE,OAAO9iE,EAAKmrB,MAC7BruB,KAAK2kC,YAAYiiC,WAAY,EAGzC,EAEAvnE,EAAIyrB,SAAS9V,UAAUy+B,YAAc,WAKjC,IAJA,IAISjyC,EAAI,EAAGC,EAAOzB,KAAKszC,OAAO5xC,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACzD,IAAIyD,EAAMjF,KAAKszC,OAAO9xC,IAElBxB,KAAKqmE,QAAQphE,IAAQjF,KAAKiB,MAAMhB,IAAIgwB,eAAehrB,KAASjF,KAAKyT,SAASxO,GAAKghC,YAC/EjmC,KAAKyT,SAASxO,GAAKghC,SAAW5mC,EAAI6mC,YAAYlnB,KAAKhf,KAAKiB,MAAOjB,KAAKiB,MAAMmtB,aAAanpB,GAAM,qBAErG,CACJ,EAEA5F,EAAIyrB,SAAS9V,UAAUoyD,YAAc,SAASxgD,EAASygD,GAEnD,OADAA,EAAMC,OAAOtnE,KAAKunE,YAAY3gD,EAASygD,GAAS,EAAG,EAAGzgD,GAC/CygD,CACX,EAEAhoE,EAAIyrB,SAAS9V,UAAUuyD,YAAc,SAAS3gD,EAASygD,EAAOp8D,EAAOC,GACjE,GAAqB,IAAjBm8D,EAAM3lE,OACN,OAAQ,EAIZ,IAAI8lE,GAFJv8D,EAAQA,GAAS,IACjBC,EAAMA,GAAOm8D,EAAM3lE,SACU,EAEzBmiC,EAAI7jC,KAAKkmE,OAAOuB,YAAY7gD,EAASygD,EAAMG,IAC/C,GAAIt8D,EAAMD,GAAS,EACf,OAAa,GAAN44B,EAAU2jC,EAAQ,EAAIA,EAEjC,OAAQ3jC,GACJ,KAAM,EAAG,OAAO7jC,KAAKunE,YAAY3gD,EAASygD,EAAOp8D,EAAOu8D,GACxD,KAAK,EAAG,OAAOA,EACf,KAAK,EAAG,OAAOxnE,KAAKunE,YAAY3gD,EAASygD,EAAOG,EAAOt8D,GAE/D,EAEA7L,EAAIyrB,SAAS9V,UAAU2+B,WAAa,SAAUf,GAC1C,IAAIx/B,EAAKlQ,EAAYiQ,EAIrB,IAAKy/B,EAAQ,CAGT,IAFA5yC,KAAKgnE,gBAAkB,GACvB5zD,EAAMpT,KAAKszC,OAAO5xC,OACbyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BjQ,EAAOlD,KAAKszC,OAAOngC,IACnBlP,EAAOjE,KAAKyT,SAASvQ,IACZo8C,SACLt/C,KAAKgnE,gBAAgBriE,KAAKV,GAKlC,IAAK,IAAIgB,KAAOjF,KAAKiB,MAAMhB,IAAIgwB,eAC3B,GAAIjwB,KAAKyT,SAASxO,KAASjF,KAAKyT,SAASxO,GAAKq6C,QAE1C,IAAK,IAAI99C,EAAExB,KAAK6kC,QAAQnjC,OAAO,EAAEF,GAAG,EAAEA,IAC9BxB,KAAK6kC,QAAQrjC,GAAG6sB,KAAOppB,IACvBjF,KAAKgnE,gBAAgBriE,KAAK3E,KAAK6kC,QAAQrjC,IACvCxB,KAAK6kC,QAAU7kC,KAAK6kC,QAAQrhC,MAAM,EAAGhC,GAAGsE,OAAO9F,KAAK6kC,QAAQrhC,MAAMhC,EAAE,KAK3EA,EAAE,EAAX,IAAK,IAAQC,EAAKzB,KAAKgnE,gBAAgBtlE,OAAOF,EAAEC,EAAKD,IAAK,CACtD,IAAIyC,WAAOjE,KAAKgnE,gBAAgBxlE,IACpB89C,QACZt/C,KAAK6kC,QAAU7kC,KAAKonE,YAAYnjE,EAAMjE,KAAK6kC,QAC/C,CACA,IAAK1xB,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BjQ,EAAOlD,KAAKszC,OAAOngC,GACnBlP,EAAOjE,KAAKyT,SAASvQ,GACrBlD,KAAKyT,SAASvQ,GAAM+5C,IAAO9pC,EAAM,CAEzC,CACJ,EAMA9T,EAAIyrB,SAAS0X,YAAc,SAAUvhC,EAAOymE,GACxC,IAAI1kC,EAAiB5vB,EAAKD,EAAKs0D,EAC3BE,EAActoE,EAAI8e,eAAea,KAAK/d,EAAOA,EAAMC,IAAI,wBAC3D8hC,EAAkB/hC,EAAMymE,GAAQxmE,IAAI8hC,gBACpChjC,KAAKynE,YAAc,SAAU3oD,EAAGC,GAE5B,IADA3L,EAAM0L,EAAEmnB,SAAWnnB,EAAEmnB,SAASvkC,OAAS,EAClCyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAAG,CAU/B,IAAIy0D,EAAM,EAWV,GAAI,GATAA,EADA9oD,EAAEmnB,SAAS9yB,KAAS4L,EAAEknB,SAAS9yB,GACzB,OACC,IAAuB2L,EAAEmnB,SAAS9yB,GACnC6vB,EAAgB7vB,GAAK,QACpB,IAAuB4L,EAAEknB,SAAS9yB,GACnC6vB,EAAgB7vB,GAAK,GAGrBw0D,EAAY7oD,EAAEmnB,SAAS9yB,GAAM4L,EAAEknB,SAAS9yB,KAG9C,OAAO6vB,EAAgB7vB,GAAK,GACzB,GAAI,EAAIy0D,EACX,OAAO5kC,EAAgB7vB,GAAK,EAEpC,CACA,OAAI2L,EAAEm+B,IAAMl+B,EAAEk+B,IACH,EACAn+B,EAAEm+B,IAAMl+B,EAAEk+B,KACT,EAEL,CACX,EACAwqB,EAAcznE,KAAKynE,YACnBznE,KAAK0mC,qBAAuB,SAAU5nB,EAAGC,GACrC,OAAO0oD,EAAY3oD,EAAE,GAAIC,EAAE,GAC/B,CACJ,EAQA1f,EAAIyrB,SAAS9V,UAAU6yD,sBAAwB,SAAU/oD,EAAGC,GACxD,OAAID,EAAEm+B,IAAMl+B,EAAEk+B,IACH,EACAn+B,EAAEm+B,IAAMl+B,EAAEk+B,KACT,EAEL,CACX,EAEA59C,EAAIyrB,SAAS9V,UAAU+xD,mBAAqB,SAAUF,EAAMx4C,EAAIy5C,GAO5D,GALK9nE,KAAKyT,SAAS4a,IACfhvB,EAAIK,MAAM,uCAAuC2uB,EAAG,YAAYw4C,EAAK,KAIrE7mE,KAAKyT,SAAS4a,IAAOruB,KAAKyT,SAAS4a,GAAIiX,UAAYtlC,KAAKyT,SAAS4a,GAAIiX,SAASvgC,MAC9E,IAAK,IAAIvD,EAAI,EAAGC,EAAOqmE,EAAa/iE,MAAMrD,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CAGhE,GAFuBsmE,EAAa/iE,MAAMvD,KACnBxB,KAAKyT,SAAS4a,GAAIiX,SAASvgC,MAAMvD,GAEpDxB,KAAKiB,MAAMhB,IAAIgwB,eAAe5B,IAAM,OACjC,GAAIy5C,EAAazoD,OAAO7d,GAE3B,IAAK,IAAIsB,EAAE,EAAE4B,EAAKojE,EAAazoD,OAAO7d,GAAGE,OAAOoB,EAAE4B,EAAK5B,GAAG,EAAG,CACjCglE,EAAazoD,OAAO7d,GAAGsB,KACvB9C,KAAKyT,SAAS4a,GAAIiX,SAASjmB,OAAO7d,GAAGsB,KAEzD9C,KAAKiB,MAAMhB,IAAIgwB,eAAe5B,IAAM,EAE5C,CAER,CAGCruB,KAAKqlC,WAAWwhC,KACjB7mE,KAAKqlC,WAAWwhC,GAAQ,KAEoB,IAA5C7mE,KAAKqlC,WAAWwhC,GAAM9jE,QAAQ,GAAKsrB,IACnCruB,KAAKqlC,WAAWwhC,GAAMliE,KAAK,GAAK0pB,GAEpCruB,KAAKyT,SAAS4a,GAAI+W,MAAQyhC,EAC1B7mE,KAAKyT,SAAS4a,GAAIiX,SAAWjmC,EAAImgB,iBAAiBsoD,EACtD,EAOAzoE,EAAI6mC,YAAc,SAAUjiC,EAAM8jE,GAC9B,IAAI16D,EAAMiV,EAAMZ,EAAW+2C,EAAoBrlD,EAAKD,EAqBpD,IAfA9F,EAAOrN,KAAKC,IAAIoN,KAChBiV,EAAOtiB,KAAKC,IAAIqiB,KAChBZ,EAAY1hB,KAAKC,IAAIyhB,UACrB+2C,EAAqBp5D,EAAIgsB,KAAKmtC,KAAKC,mBACnCz4D,KAAKC,IAAIoN,KAAO06D,EAEhB/nE,KAAKC,IAAIqiB,KAAOylD,EAAShlE,QAAQ,MAAQ,EAAIglE,EAASvkE,MAAM,GAAG,GAAKukE,EACpE/nE,KAAKC,IAAIyhB,UAAY,QACrB1hB,KAAKC,IAAIguC,mBAAoB,EAC7BjuC,KAAKC,IAAI4f,kBAAmB,EAC5B7f,KAAKC,IAAIm4B,sBAAuB,EAChC/4B,EAAIirC,QAAQtrB,KAAKhf,KAAMiE,GACvBjE,KAAKC,IAAIm4B,sBAAuB,EAChCp4B,KAAKC,IAAIguC,mBAAoB,EAC7B76B,EAAMpT,KAAK+nE,GAAUv9D,KAAK9I,OACrByR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAC5BnT,KAAK+nE,GAAUv9D,KAAK2I,GAAOslD,EAAmBz4D,KAAK+nE,GAAUv9D,KAAK2I,IAWtE,OAHAnT,KAAKC,IAAIoN,KAAOA,EAChBrN,KAAKC,IAAIqiB,KAAOA,EAChBtiB,KAAKC,IAAIyhB,UAAYA,EACd1hB,KAAK+nE,GAAUv9D,IAC1B,EAKAnL,EAAIyrB,SAAS06C,QAAU,SAAUvkE,GAC7B,IAAI+mE,EAAMxyB,EAAMyyB,EAAMC,EAAQxd,EAAQ4b,EAAOnvC,EAAegxC,EAAUhiB,EAAUqgB,EAAUtgB,EAASkiB,EACnGpoE,KAAKiB,MAAQA,EACbjB,KAAKimD,QAAU,CAAC,EAChBjmD,KAAKqoE,QAAU,CAAC,EAEhBroE,KAAKsoE,aAAe,CAAC,EAKrBtoE,KAAKuoE,WAAa,CAAC,EAEnBpxC,EAAgB,SAAU33B,GAItB,OAHKA,IACDA,EAAM,IAEHA,EAAIsE,QAAQ,MAAO,KAAKA,QAAQ,OAAQ,KAAKA,QAAQ,OAAO,GACvE,EAEAqkE,EAAW,SAAUlnE,EAAOunE,EAAQC,GAChCT,EAAO7wC,EAAcsxC,EAAQ9iE,QAI7B,IAAIlC,GAHJwkE,EAAO9wC,EAAcsxC,EAAQ7iE,QAGhBlC,MAAM,mBACfD,GAAKA,EAAE,KAAOA,EAAE,GAAGnD,gBACnB2nE,EAAOA,EAAKnkE,QAAQ,gBAAiB,KAIzC0xC,EAAOn2C,EAAIgsB,KAAK82B,MAAMwI,eAAe1pD,EAAOgnE,EAAM,MACU,YAAxDhnE,EAAM+nB,SAAS9nB,IAAI,mCACnB8mE,EAAO,GAAKQ,EAASR,EAE7B,EAEA7hB,EAAW,SAAU9e,EAASohC,EAASC,EAASC,EAAcj8C,EAAMk8C,GAChE,IAAIjpD,EAEJ,GAAoC,iBAAhC1e,EAAMhB,IAAIoN,KAAK7J,MAAM,EAAG,MAA2BkpB,EACnD,MAAI,iBAAoBk8C,EACb,EAEA,EAIfH,EADUxnE,EAAM6xB,WAAWC,QAAQ01C,EAAS,mBAAmB,GACjD/iE,KACdyiE,EAASnoE,KAAKiB,MAAO,GAAKomC,EAASohC,GAWnC9oD,EAAQ,EACRuoD,EAASjnE,EAAMC,IAAI,8BAEnB,IAAI2nE,EADJne,EAASzpD,EAAM+nB,SAAS9nB,IAAI,iCAe5B,MAbe,YAAXwpD,IACAA,EAAS,aAKT,UAAYh+B,EACZ/M,EAAQ,EACD,iBAAoBipD,IAC3BjpD,EAAQ,QAIR,IAAuB3f,KAAKimD,QAAQ+hB,SAAS,IAAuBhoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GACrF71B,EAMS,YAAhBkpD,GAA6BlpD,GAASgpD,EAE/BA,EAENT,EAGD,iBAAoBxd,GAAkC,iBAAxBA,EAAOlnD,MAAM,EAAG,KAA0BklE,EAAU,EAC3E/oD,GAKN+qC,GAAqB,cAAXA,GAAqC,iBAAXA,EAWnB,4BAAXA,GAAmD,+BAAXA,IAE3C/qC,EADA3f,KAAKimD,QAAQ+hB,GAAM1zC,MAAQ,EACnB,EAEA,IAdRt0B,KAAKimD,QAAQ+hB,GAAM1zC,MAAQ,IAC3B3U,EAAQ,IAEP3f,KAAKimD,QAAQ+hB,GAAMxyB,MAChBx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,MAAQ,GACtCt0B,KAAKimD,QAAQ+hB,GAAM1zC,MAAQ,GACxB,iBAAoBs0C,KAE3BjpD,EAAQ,IASX1e,EAAMwS,SAASA,SAAS4zB,GAOlB1nB,EANK,SAAR+M,EACO,EACA,iBAAmBk8C,EACnB,OADJ,GA7BAjpD,CAmCf,EAOA6mD,EAAW,SAAUv4C,GACjB,IAAI9a,EAAKC,EAAK01D,EAAMz6C,EAAI06C,EACpB,iBAAoB96C,GAAO,iBAAoBA,IAC/CA,EAAM,CAAC,GAAKA,IAKhB,IADA7a,EAAM6a,EAAIvsB,OACLyR,EAAM,EAAGA,EAAMC,EAAKD,GAAO,EAE5B,GADAkb,EAAK,GAAKJ,EAAI9a,GACTnT,KAAKqoE,QAAQh6C,GAAlB,CAGA,IAAK06C,KAAW/oE,KAAKqoE,QAAQh6C,GACzB,GAAIruB,KAAKqoE,QAAQh6C,GAAIpL,eAAe8lD,GAAU,CAC1C,IAAI9jE,EAAM8jE,EAAQxnE,MAAM,MAOxB,GANAymE,EAAO/iE,EAAI,GACXuwC,EAAOvwC,EAAI,GACXgjE,EAAOhjE,EAAI,QAIP,IAAuBjF,KAAKimD,QAAQ+hB,GACpC,SAUJ,GAJA1B,EAAQtmE,KAAKimD,QAAQ+hB,GAAM1B,MAIvB2B,GAAQjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,IAASx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,MAE5Ea,GADAV,EAAUpoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,OACpCvjE,QAAQ,GAAKsrB,KAChB,IACRruB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,MAAQ8B,EAAQ5kE,MAAM,EAAGslE,GAAMhjE,OAAOsiE,EAAQ5kE,MAAM,CAAEslE,EAAO,MAE5C,IAA1D9oE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,MAAM5kE,gBACxC1B,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAC1CjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,QAAU,EACpCt0B,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,MAAQ,IACtC,IAAK,IAAI9yB,EAAI,EAAGC,EAAOzB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM5kE,OAAQF,EAAIC,EAAMD,GAAK,EAC9EP,EAAMhB,IAAIgwB,eAAejwB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM9kE,KAAM,EAKnF,GAAIg0C,GAAQx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,MAChCszB,EAAO9oE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAMvjE,QAAQ,GAAKsrB,KAC5C,IACRi4C,EAAQtmE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM9iE,QAC5CxD,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAQA,EAAM9iE,MAAM,EAAGslE,GAAMhjE,OAAOwgE,EAAM9iE,MAAM,CAACslE,EAAO,MAEvC,IAA/C9oE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM5kE,gBAC7B1B,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAC/Bx1C,KAAKimD,QAAQ+hB,GAAM1zC,QAAU,EACzBt0B,KAAKimD,QAAQ+hB,GAAM1zC,MAAQ,IAC3B,IAAS9yB,EAAI,EAAGC,EAAOzB,KAAKimD,QAAQ+hB,GAAM1B,MAAM5kE,OAAQF,EAAIC,EAAMD,GAAK,EACnEP,EAAMhB,IAAIgwB,eAAejwB,KAAKimD,QAAQ+hB,GAAM1B,MAAM9kE,KAAM,EAKpEwmE,KACAc,EAAO9oE,KAAKimD,QAAQ+hB,GAAM1B,MAAMvjE,QAAQ,GAAKsrB,KACjC,IACRi4C,EAAQtmE,KAAKimD,QAAQ+hB,GAAM1B,MAAM9iE,QACjCxD,KAAKimD,QAAQ+hB,GAAM1B,MAAQA,EAAM9iE,MAAM,EAAGslE,GAAMhjE,OAAOwgE,EAAM9iE,MAAM,CAACslE,EAAO,GAAIxC,EAAM5kE,UAErF1B,KAAKimD,QAAQ+hB,GAAM1B,MAAM5kE,OAAS,UAC3B1B,KAAKimD,QAAQ+hB,WAGrBhoE,KAAKqoE,QAAQh6C,GAAI06C,EAC5B,QAEG/oE,KAAKqoE,QAAQh6C,UACbruB,KAAKsoE,aAAaj6C,EAnEzB,CAqEJ,MA3EU,CAAC,CA4Ef,EAUA63B,EAAU,SAAU7e,EAASohC,EAASt1D,GAKlC,GAFAs1D,EADUxnE,EAAM6xB,WAAWC,QAAQ01C,EAAS,mBAAmB,GACjD/iE,MAEVzE,EAAM+nB,SAAS9nB,IAAI,kCACoD,aAApED,EAAM+nB,SAAS9nB,IAAI,iCAAiCsC,MAAM,EAAG,IACrD,IAAR2P,EAFP,CAmCA,GA5BkD,UAA9ClS,EAAMC,IAAI,iCAA+CunE,EAAQ,0BAA4BA,EAAgB,SAC7GA,EAAgB,OAAIA,EAAQ,yBAA2B,IAAMA,EAAgB,QAIjFN,EAASnoE,KAAKiB,MAAO,GAAKomC,EAASohC,GAU/BT,SACI,IAAuBhoE,KAAKimD,QAAQ+hB,IACpChoE,KAAKimD,QAAQ+hB,GAAQ,CAAC,EACtBhoE,KAAKimD,QAAQ+hB,GAAM1zC,MAAQ,EAC3Bt0B,KAAKimD,QAAQ+hB,GAAMxyB,KAAO,CAAC,EAC3Bx1C,KAAKimD,QAAQ+hB,GAAM1B,MAAQ,CAACj/B,KAC0B,IAA/CrnC,KAAKimD,QAAQ+hB,GAAM1B,MAAMvjE,QAAQskC,IACxCrnC,KAAKimD,QAAQ+hB,GAAM1B,MAAM3hE,KAAK0iC,IAMlC2gC,GAAQxyB,EACR,QAAI,IAAuBx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,IAM/C,GALAx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAQ,CAAC,EACjCx1C,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,MAAQ,EACtCt0B,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAO,CAAC,EACtCjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAQ,CAACj/B,GACvCrnC,KAAKimD,QAAQ+hB,GAAM1zC,OAAS,EACK,IAA7Bt0B,KAAKimD,QAAQ+hB,GAAM1zC,MACnB,IAAK,IAAI9yB,EAAI,EAAGC,EAAOzB,KAAKimD,QAAQ+hB,GAAM1B,MAAM5kE,OAAQF,EAAIC,EAAMD,GAAK,EACnEP,EAAMhB,IAAIgwB,eAAejwB,KAAKimD,QAAQ+hB,GAAM1B,MAAM9kE,KAAM,OAGC,IAA1DxB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAMvjE,QAAQskC,IACnDrnC,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM3hE,KAAK0iC,GAMjD,GAAI2gC,GAAQxyB,GAAQyyB,EAChB,QAAI,IAAuBjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,IAI1D,GAHAjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAQ,CAAC,EAC5CjoE,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,MAAQ,CAACj/B,GAClDrnC,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,OAAS,EACK,IAAxCt0B,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMlhB,MAC9B,IAAS9yB,EAAI,EAAGC,EAAOzB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM5kE,OAAQF,EAAIC,EAAMD,GAAK,EAC9EP,EAAMhB,IAAIgwB,eAAejwB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAM8wB,MAAM9kE,KAAM,OAGC,IAArExB,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,MAAMvjE,QAAQskC,IAC9DrnC,KAAKimD,QAAQ+hB,GAAMxyB,KAAKA,GAAMyyB,KAAKA,GAAM3B,MAAM3hE,KAAK0iC,QAMxD,IAAuBrnC,KAAKqoE,QAAQhhC,KACpCrnC,KAAKqoE,QAAQhhC,GAAW,CAAC,EACzBrnC,KAAKsoE,aAAajhC,GAAW,CAAC,GAG9B2gC,IACAhoE,KAAKqoE,QAAQhhC,GAAS2gC,EAAO,KAAOxyB,EAAO,KAAOyyB,IAAQ,EAC1DjoE,KAAKsoE,aAAajhC,GAAS2gC,GAAQhoE,KAAKimD,QAAQ+hB,GA1EpD,CA6EJ,EACAhoE,KAAKkmD,QAAUA,EACflmD,KAAKwmE,SAAWA,EAChBxmE,KAAKmmD,SAAWA,CACpB,EAIA9mD,EAAIyrB,SAAS26C,YAAc,WACvBzlE,KAAKilC,aAAe,CAAC,EACrBjlC,KAAK4jC,gBAAkB,EAC3B,EAIAvkC,EAAI6rB,eAAiB,SAAUjqB,GAC3BjB,KAAKiB,MAAQA,EACbjB,KAAK4T,IAAM5T,KAAKiB,MAAM2S,IACtB5T,KAAKyT,SAAWxS,EAAMwS,SAASA,SAC/BzT,KAAKqlC,WAAapkC,EAAMwS,SAAS4xB,WACjCrlC,KAAKgpE,cACLhpE,KAAKN,OAAQ,CACjB,EAEAL,EAAI6rB,eAAelW,UAAUm0B,IAAM,SAAS09B,GACnC7mE,KAAKipE,MAAMvnE,SAIZ1B,KAAKN,OACLigD,MAAM,mBAGV3/C,KAAK6mE,KAAOA,EACR7mE,KAAKkpE,SAASrC,IACd7mE,KAAKmpE,cAGb,EAEA9pE,EAAI6rB,eAAelW,UAAUm0D,YAAc,WACvC,IAAIC,EASJ,IAPIppE,KAAKN,OACLigD,MAAM,6BAGV3/C,KAAKqpE,YAAa,EAGXrpE,KAAKspE,MAAM5nE,QAAQ,CAMtB,IALA1B,KAAKupE,SAAW,EAChBvpE,KAAKwpE,MAAQ,EACbxpE,KAAKypE,QAAU,CAAC,EAAG,GAGbzpE,KAAKspE,MAAM,GAAG,GAAG5nE,QACnB1B,KAAK8rD,QAAU,EACV9rD,KAAKu1B,OACNv1B,KAAKu1B,KAAOv1B,KAAKspE,MAAM,GAAG,IAE9BF,EAAQppE,KAAK0pE,oBACb1pE,KAAK2pE,UAAU3pE,KAAKspE,MAAM,IAC1BtpE,KAAK4pE,SAASR,GAElBppE,KAAKspE,MAAQtpE,KAAKspE,MAAM9lE,MAAM,EAClC,CACJ,EAEAnE,EAAI6rB,eAAelW,UAAU20D,UAAY,SAAUt4C,GAC/C,IAAcw4C,EAEV7pE,KAAKN,OACLigD,MAAM,2BAIV3/C,KAAKiE,KAAOotB,EAAK,GAAG,GACpBrxB,KAAK8pE,SAAWzqE,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAOjB,KAAKiE,KAAMjE,KAAKu1B,MAAM,GAE5Ev1B,KAAK+pE,SAAW14C,EAAK,GACrBrxB,KAAKgqE,SAAW,GAChBhqE,KAAKgqE,SAASrlE,KAAK3E,KAAKiE,MACxBjE,KAAKiqE,YAAc,GAGnB,IAFA,IAAIR,EAAU,EAELt2D,EAAM,EAAGC,EAAMie,EAAK,GAAG3vB,OAAQyR,EAAMC,EAAKD,GAAO,EAAG,CACzD02D,EAAYx4C,EAAK,GAAGle,GACpB,IAAI+2D,EAAgB7qE,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAO4oE,EAAW7pE,KAAKu1B,MAAM,GAE5Ev1B,KAAKN,OACDyT,EAAM,GACNwsC,MAAM,iBAIV3/C,KAAK8pE,WAAaI,GAEdlqE,KAAKN,QACLigD,MAAM,mBAAgB3/C,KAAKiE,KAAKoqB,GAAG,KAAKruB,KAAK8pE,UAC7CnqB,MAAM,gBAAgBkqB,EAAUx7C,GAAG,KAAK67C,IAG5CT,GAAW,EACXzpE,KAAKgqE,SAASrlE,KAAKklE,KAGf7pE,KAAKN,QACLigD,MAAM,mBAAgB3/C,KAAKiE,KAAKoqB,GAAG,KAAKruB,KAAK8pE,UAC7CnqB,MAAM,gBAAgBkqB,EAAUx7C,GAAG,KAAK67C,IAG5ClqE,KAAKiqE,YAAYtlE,KAAKklE,GAE9B,CACA7pE,KAAKypE,QAAQ,GAAKzpE,KAAKypE,QAAQ,GAC/BzpE,KAAKypE,QAAQ,GAAKA,CACtB,EAEApqE,EAAI6rB,eAAelW,UAAU40D,SAAW,SAAUO,GAC9CnqE,KAAKA,KAAKipE,MAAMjpE,KAAKoqE,YAAYD,GAC7BA,IACInqE,KAAKoqE,UAAYpqE,KAAKipE,MAAMvnE,OAAS,EACrC1B,KAAKoqE,WAAa,EAElBpqE,KAAKspE,MAAMtpE,KAAK8rD,QAAU,GAAK,CAAC9rD,KAAKu1B,KAAM,IAGvD,EAEAl2B,EAAI6rB,eAAelW,UAAUq1D,SAAW,SAAUjB,GA+B9C,GA3BIppE,KAAKN,OACLigD,MAAM,wBA0Bc,IAApB3/C,KAAKypE,QAAQ,IAAwC,IAA5BzpE,KAAKiqE,YAAYvoE,OAC1C1B,KAAKsqE,oBAEDtqE,KAAKN,QACLigD,MAAM,qDACNA,MAAM,iBAAiB3/C,KAAKgqE,SAAS,GAAG37C,GAAG,QAAQruB,KAAKiqE,YAAY,GAAG57C,KAG3EruB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKiqE,YAAY,GAAG57C,GAAIruB,KAAKuqE,YACpFvqE,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKgqE,SAAS,GAAG37C,GAAIruB,KAAKuqE,YACjFvqE,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAY,SAC1C,GAAwB,IAApBvqE,KAAKypE,QAAQ,GACpBzpE,KAAKsqE,oBAEDtqE,KAAKN,QACLigD,MAAM,8EACNA,MAAM,iBAAiB3/C,KAAKgqE,SAAS,GAAG37C,KAG5CruB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKgqE,SAAS,GAAG37C,GAAIruB,KAAKuqE,YACjFvqE,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAYvqE,KAAKiqE,aAC9CjqE,KAAKiqE,YAAYvoE,SACjB1B,KAAKqpE,YAAa,QAEnB,GAAgC,IAA5BrpE,KAAKiqE,YAAYvoE,OACxB1B,KAAKsqE,oBAEDtqE,KAAKN,QACLigD,MAAM,8EACNA,MAAM,iBAAiB3/C,KAAKiqE,YAAY,GAAG57C,KAG/CruB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKiqE,YAAY,GAAG57C,GAAIruB,KAAKuqE,YAEpFvqE,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAYvqE,KAAKgqE,eAC/C,GAAIhqE,KAAKypE,QAAQ,GAAKzpE,KAAKypE,QAAQ,GACtCzpE,KAAKsqE,oBAEDtqE,KAAKN,OACLigD,MAAM,uEAGV3/C,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAYvqE,KAAKgqE,UAClDhqE,KAAKspE,MAAM3kE,KAAK,CAAC3E,KAAKuqE,WAAYvqE,KAAKiqE,mBAOvC,GAJIjqE,KAAKN,OACLigD,MAAM,2DAGNypB,IACAppE,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAYvqE,KAAKiqE,aAClDjqE,KAAKspE,MAAM3kE,KAAK,CAAC3E,KAAKuqE,WAAYvqE,KAAKgqE,WACnChqE,KAAKoqE,YAAcpqE,KAAKipE,MAAMvnE,OAAS,GAAG,CAEtC1B,KAAKN,OACLigD,MAAM,wEAGV,IAAK,IAAIn+C,EAAI,EAAGC,EAAOzB,KAAKgqE,SAAStoE,OAAQF,EAAIC,EAAMD,GAAK,EACxDxB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKgqE,SAASxoE,GAAG6sB,GAAIruB,KAAKuqE,YAErFvqE,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAY,GACjD,CAGZ,EAEAlrE,EAAI6rB,eAAelW,UAAUw1D,aAAe,WAEpCxqE,KAAKN,OACLigD,MAAM,2BAIV,IAAIzQ,GAAO,EAQX,GANwB,IAApBlvC,KAAKypE,QAAQ,IAAYzpE,KAAKiqE,YAAYvoE,OAAS,IACnDwtC,GAAO,GAKNA,GAAUlvC,KAAKu1B,KAAKjW,cAAgBtf,KAAKiB,MAAMhB,IAAI2tC,qBAAuB5tC,KAAKiB,MAAMhB,IAAI4tC,qBAkBvF,GAAIqB,GAAQlvC,KAAKiB,MAAMhB,IAAI2tC,qBAAuB5tC,KAAKiB,MAAMhB,IAAI4tC,oBACpE,GAAIqB,GAAQlvC,KAAKoqE,YAAcpqE,KAAKipE,MAAMvnE,OAAS,EAAG,CAGlD,IAAI6zB,EAAOv1B,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GACpC,IAAStqD,EAAI,EAAGC,EAAOzB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGpqD,OAAQF,EAAIC,EAAMD,GAAK,EACtExB,KAAKiB,MAAMhB,IAAIgwB,eAAejwB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGtqD,GAAG6sB,KAAM,EACnEruB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGtqD,GAAG6sB,GAAIkH,GAE9Fv1B,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAY,GACjD,KAAO,CAMHvqE,KAAKoqE,UAAYpqE,KAAKipE,MAAMvnE,OAAS,GACjC6zB,EAAOv1B,KAAKspE,MAAMtpE,KAAK8rD,SAAS,IAC/BxsC,cAAe,EACpB,IAAS9d,EAAI,EAAGC,EAAOzB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGpqD,OAAQF,EAAIC,EAAMD,GAAK,EAEtExB,KAAKiB,MAAMhB,IAAIgwB,eAAejwB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGtqD,GAAG6sB,KAAM,EACnEruB,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAK7mE,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGtqD,GAAG6sB,GAAIkH,EAElG,OApCA,GAHAv1B,KAAKoqE,UAAY,EACjBpqE,KAAKu1B,KAAKjW,aAAetf,KAAKiB,MAAMhB,IAAI2tC,mBACxC5tC,KAAKuqE,WAAWjrD,aAAetf,KAAKiB,MAAMhB,IAAI2tC,mBACzC5tC,KAAKu1B,KAAKjW,aAUXtf,KAAKqqE,eAVoB,CAEzBrqE,KAAKqpE,YAAa,EAElBrpE,KAAKu1B,KAAKjW,aAAe,EAEzB,IAAK,IAAI9d,EAAI,EAAGC,EAAOzB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGpqD,OAAQF,EAAIC,EAAMD,GAAK,EACtExB,KAAKiB,MAAMhB,IAAIgwB,eAAejwB,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGtqD,GAAG6sB,KAAM,CAE3E,CA6BR,EAEAhvB,EAAI6rB,eAAelW,UAAUy1D,SAAW,WACpC,IAAcloD,EAEVviB,KAAKN,OACLigD,MAAM,uBAGVp9B,EAAS,GACT,IAAIgT,EAAOv1B,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GACpC,GAAI9rD,KAAKypE,QAAQ,GAInB,IAAK,IAAIjoE,EAAI,EAAGC,EAAOzB,KAAKiB,MAAMwS,SAAS6/B,OAAO5xC,OAAQF,EAAIC,EAAMD,GAAK,EAExE,IADA,IAAIkpE,EAAS1qE,KAAKiB,MAAMwS,SAAS6/B,OAAO9xC,GAC/BsB,EAAI,EAAG4B,EAAO1E,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGpqD,OAAQoB,EAAI4B,EAAM5B,GAAK,EAAG,CAC5E,IAAIkO,EAEJ,IAFIA,EAAQhR,KAAKspE,MAAMtpE,KAAK8rD,SAAS,GAAGhpD,IAE9BurB,IAAMq8C,EAAQ,CACvBnoD,EAAO5d,KAAK3E,KAAKyT,SAASzC,EAAMqd,KAChC,KACD,CACD,CAGC9L,EAAOgR,KAAKvzB,KAAKiB,MAAMwS,SAASyyD,OAAOuB,aACvC,IAAK,IAAIt0D,EAAM,EAAGC,EAAMmP,EAAO7gB,OAAQyR,EAAMC,EAAKD,GAAO,EAAG,CACxDoiB,EAAKhW,YAAc,GAAGpM,EACtB,IAAIw3D,EAAU3qE,KAAKiB,MAAMwS,SAASA,SAAS8O,EAAOpP,GAAKkb,IAAIiX,SAC3DtlC,KAAKiB,MAAMwS,SAASszD,mBAAmB/mE,KAAK6mE,KAAM,GAAKtkD,EAAOpP,GAAKkb,GAAIkH,GACnEl2B,EAAI6f,gBAAgByrD,EAAQp1C,KAC5Bv1B,KAAKiB,MAAMhB,IAAIgwB,eAAe1N,EAAOpP,GAAKkb,KAAM,EAExD,CACAruB,KAAKspE,MAAMtpE,KAAK8rD,SAAW,CAAC9rD,KAAKuqE,WAAY,GACjD,EAEAlrE,EAAI6rB,eAAelW,UAAU00D,kBAAoB,WAM7C,GAJI1pE,KAAKN,OACLigD,MAAM,qCAGN3/C,KAAKqpE,WAEL,OADArpE,KAAKqpE,YAAa,GACX,EAEX,IAAIc,GAAQ,EACRS,GAAkB,EACtB,GAAI,aAAe5qE,KAAKipE,MAAMjpE,KAAKoqE,WAAY,CAiB3CQ,GAAkB,EACd,iBAAoB5qE,KAAK6qE,YACzBD,GAAkB,GAEtB,IAAIE,GAAqB,EACrB,iBAAoB9qE,KAAK+qE,WACzBD,GAAqB,GAErB,iBAAoB9qE,KAAK6qE,YACrB7qE,KAAKu1B,KAAKlW,OAAO3d,QAAU1B,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,OAASxpE,KAAK6qE,UAC9E7qE,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,QAAU,EAE/CoB,GAAkB,GAGtB,iBAAoB5qE,KAAK+qE,UACtBH,IACC5qE,KAAKiB,MAAMC,IAAI,2BACf4pE,GAAqB,EACjB9qE,KAAKwpE,MAAQxpE,KAAK+qE,UAClB/qE,KAAKu1B,KAAKxwB,MAAM/E,KAAKupE,WAAa,EAClCvpE,KAAKwpE,OAAS,GAEdsB,GAAqB,GAGzBA,GAAqB,GAGzB,iBAAoB9qE,KAAKgrE,aAAeF,GACpC9qE,KAAKupE,SAAWvpE,KAAKgrE,cACrBhrE,KAAKupE,UAAY,EACjBvpE,KAAKu1B,KAAKxwB,MAAM/E,KAAKupE,UAAY,EACjCvpE,KAAKwpE,MAAQ,GAIjBxpE,KAAKN,QACLigD,MAAM,0BACNA,MAAM,0BACNA,MAAM,0BACNA,MAAM,mBAAmB3/C,KAAKupE,UAC9B5pB,MAAM,gBAAgB3/C,KAAKwpE,OAC3B7pB,MAAM,sBAAsB3/C,KAAKu1B,KAAKxwB,MAAM/E,KAAKupE,WAC7CvpE,KAAKu1B,KAAKlW,OAAO3d,OACjBi+C,MAAM,uBAAuB3/C,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,QAElE7pB,MAAM,2BAEVA,MAAM,sBAAsB3/C,KAAKgrE,aACjCrrB,MAAM,mBAAmB3/C,KAAK+qE,UAC9BprB,MAAM,oBAAoB3/C,KAAK6qE,YAG9B,iBAAoB7qE,KAAKgrE,cAAqC,IAAtBhrE,KAAKgrE,aAAsBhrE,KAAKupE,WAAavpE,KAAKgrE,aACtFhrE,KAAKiB,MAAMC,IAAI,2BAA6B,iBAAoBlB,KAAK+qE,UAAY/qE,KAAKwpE,QAAUxpE,KAAK+qE,UACtG,iBAAmB/qE,KAAK6qE,gBAAa,IAAuB7qE,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,gBAAa,IAAuBvpE,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,QAAUxpE,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,SAAWxpE,KAAK6qE,YAG9NV,GAAQ,EAEJnqE,KAAKN,OACLigD,MAAM,aAIlB,KAAW,iBAAmB3/C,KAAKipE,MAAMjpE,KAAKoqE,aAC1CpqE,KAAKu1B,KAAKjW,cAAgB,EAC1Btf,KAAKuqE,WAAWjrD,cAAgB,GAEpC,OAAO6qD,CACX,EAEA9qE,EAAI6rB,eAAelW,UAAUk0D,SAAW,SAAUrC,GAC9C,IAAaoE,EAAOC,EAAeC,EAgBnC,GAdInrE,KAAKN,OACLigD,MAAM,0BAGV3/C,KAAKspE,MAAQ,GACbtpE,KAAKu1B,MAAO,EACZv1B,KAAKuqE,YAAa,EAClBvqE,KAAK6mE,KAAOA,EAEZ7mE,KAAKorE,iBAAmB,CAAC,EAGzBF,EAAgB,KAChBD,EAAQjrE,KAAKqlC,WAAWwhC,MACToE,EAAMvpE,OACjB,OAAO,EAEX,IAAI2pE,EAASrrE,KAAKiB,MAAMitB,YAAY,GAAK+8C,EAAM,IAG/C,GAFAjrE,KAAKsrE,YAAYD,GACjBrrE,KAAKu1B,KAAOl2B,EAAIugB,eAAeZ,KAAKhf,KAAKiB,OACrCgqE,GAASA,EAAMvpE,OAAS,EAAG,CAC3BwpE,EAAcvmE,KAAK,CAAC3E,KAAKorE,iBAAiBC,EAAOh9C,IAAKg9C,IAMtD,IAAK,IAAI7pE,EAAI,EAAGC,EAAOwpE,EAAMvpE,OAAQF,EAAIC,EAAMD,GAAK,EAChD6pE,EAASrrE,KAAKiB,MAAMitB,YAAY,GAAK+8C,EAAMzpE,IAC3CxB,KAAKsrE,YAAYD,EAAQrrE,KAAKu1B,MAC9B21C,EAAcvmE,KAAK,CAAC3E,KAAKorE,iBAAiBC,EAAOh9C,IAAKg9C,IAE1DH,EAAc33C,MACV,SAAUzU,EAAGC,GACT,OAAID,EAAE,GAAKC,EAAE,GACF,EACAD,EAAE,GAAKC,EAAE,IACR,EAEJD,EAAE,GAAGuP,GAAKtP,EAAE,GAAGsP,GACR,EACAvP,EAAE,GAAGuP,GAAKtP,EAAE,GAAGsP,IACd,EAED,CAGnB,IAEJ88C,EAAU,GACV,IAAK,IAAI3pE,EAAI,EAAGC,EAAOypE,EAAcxpE,OAAQF,EAAIC,EAAMD,GAAK,EACxD2pE,EAAQxmE,KAAKumE,EAAc1pE,GAAG,IAElCxB,KAAKspE,MAAM3kE,KAAK,CAAC3E,KAAKu1B,KAAM41C,IAC5BnrE,KAAKiE,KAAOjE,KAAKspE,MAAM,GAAG,GAAG,EACjC,MACItpE,KAAKiE,KAAOjE,KAAKiB,MAAMitB,YAAY,GAAK+8C,EAAM,IAwBlD,OArBAjrE,KAAKoqE,UAAY,EACbpqE,KAAKiB,MAAM+nB,SAAS9nB,IAAI,0BACxBlB,KAAK+qE,SAAW/qE,KAAKorE,iBAAiBprE,KAAKiE,KAAKoqB,IAAI,GASxDruB,KAAK6lD,QAAQ7lD,KAAKu1B,MAClBv1B,KAAK6lD,QAAQ7lD,KAAKuqE,YAClBvqE,KAAKu1B,KAAKhW,aAAc,EACxBvf,KAAKu1B,KAAKjW,cAAe,EACzBtf,KAAKuqE,WAAWhrD,aAAc,EAC9Bvf,KAAKuqE,WAAWjrD,cAAe,EACkC,YAA7Dtf,KAAKiB,MAAM+nB,SAAS9nB,IAAI,kCACtBlB,KAAKiB,MAAMC,IAAI,gCACjBlB,KAAK6qE,UAAY,IAEd,CACX,EAGAxrE,EAAI6rB,eAAelW,UAAU6wC,QAAU,SAAUtwB,GAC7C,IAAK,IAAI/zB,EAAI,EAAGC,EAAO8zB,EAAKxwB,MAAMrD,OAAQF,EAAIC,EAAMD,GAAK,EAAG,CACnD+zB,EAAKlW,OAAO7d,KACb+zB,EAAKlW,OAAO7d,GAAK,IAErB,IAAK,IAAIsB,EAAE,EAAE4B,EAAK6wB,EAAKxwB,MAAMvD,GAAGsB,EAAE4B,EAAK5B,GAAG,EACjCyyB,EAAKlW,OAAO7d,GAAGsB,KAChByyB,EAAKlW,OAAO7d,GAAGsB,GAAK,EAGhC,CACJ,EAKAzD,EAAI6rB,eAAelW,UAAUg0D,YAAc,WACvC,IAAId,EAAQxd,EAEZ1qD,KAAKipE,MAAQ,GACbf,EAASloE,KAAKiB,MAAMC,IAAI,8BACxBwpD,EAAS1qD,KAAKiB,MAAM+nB,SAAS9nB,IAAI,kCAC7BlB,KAAKiB,MAAMC,IAAI,2BAA8BgnE,GAAqB,YAAXxd,IACvD1qD,KAAKipE,MAAMtkE,KAAK,YAGhB3E,KAAKiB,MAAMC,IAAIiC,uBAAuB87B,mCAClCj/B,KAAKiB,MAAMC,IAAIu8B,kBACfz9B,KAAKipE,MAAMtkE,KAAK,gBAEhB3E,KAAKiB,MAAMC,IAAI,iCACflB,KAAKipE,MAAMtkE,KAAK,cAGhB3E,KAAKiB,MAAMC,IAAI,iCACflB,KAAKipE,MAAMtkE,KAAK,YAEhB3E,KAAKiB,MAAMC,IAAIu8B,kBACfz9B,KAAKipE,MAAMtkE,KAAK,gBAG5B,EAEAtF,EAAI6rB,eAAelW,UAAUs2D,YAAc,SAASrnE,EAAMsxB,GAEtD,IAAKv1B,KAAKorE,iBAAiBnnE,EAAKoqB,IAAK,CACjChvB,EAAIknC,iBAAiBvnB,KAAKhf,KAAKiB,MAAOgD,EAAMsxB,GAC5CA,EAAOl2B,EAAIugB,eAAeZ,KAAKhf,KAAKiB,OACpCjB,KAAKorE,iBAAiBnnE,EAAKoqB,IAAMhvB,EAAI0gB,WAAWf,KAAKhf,KAAKiB,OAC1DjB,KAAKiB,MAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAASrf,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAO7b,QAEhG,IAAK,IAAIhC,EAAE,EAAEC,EAAKzB,KAAKiB,MAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO3d,OAAOF,EAAEC,EAAKD,GAAG,EACrFxB,KAAKiB,MAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASjmB,OAAO7d,GAAKxB,KAAKiB,MAAMhB,IAAI6f,kBAAkBT,OAAO7d,GAAGgC,QAE1GxD,KAAKgrE,YAAchrE,KAAKiB,MAAMwS,SAASA,SAASxP,EAAKoqB,IAAIiX,SAASvgC,MAAMrD,OAAS,EAC5E1B,KAAKu1B,OACNv1B,KAAKu1B,KAAOA,EACZv1B,KAAKuqE,WAAalrE,EAAImgB,iBAAiB+V,IAEvCA,EAAKxwB,MAAMrD,OAAS1B,KAAKu1B,KAAKxwB,MAAMrD,SAIpC1B,KAAKu1B,KAAOA,GAGhB,IAAS/zB,EAAI,EAAGC,EAAO8zB,EAAKxwB,MAAMrD,OAAQF,EAAIC,EAAMD,GAAK,EACjD+zB,EAAKxwB,MAAMvD,GAAKxB,KAAKu1B,KAAKxwB,MAAMvD,KAGhCxB,KAAKu1B,KAAKlW,OAAO7d,GAAK+zB,EAAKlW,OAAO7d,GAAGgC,QACrCxD,KAAKu1B,KAAKxwB,MAAMvD,GAAK+zB,EAAKxwB,MAAMvD,GAChCxB,KAAKuqE,WAAWxlE,MAAQ/E,KAAKu1B,KAAKxwB,MAAMvB,QACxCxD,KAAKuqE,WAAWlrD,OAASrf,KAAKu1B,KAAKlW,OAAO7b,QAC1CxD,KAAK6lD,QAAQ7lD,KAAKu1B,MAClBv1B,KAAK6lD,QAAQ7lD,KAAKuqE,aAS1BvqE,KAAKuqE,WAAWlrD,OAASrf,KAAKu1B,KAAKlW,OAAO7b,QAC1C,IAAK,IAAIV,EAAI,EAAG4B,EAAO1E,KAAKu1B,KAAKlW,OAAO3d,OAAQoB,EAAI4B,EAAM5B,GAAK,EAC3D9C,KAAKuqE,WAAWlrD,OAAOvc,GAAK9C,KAAKu1B,KAAKlW,OAAOvc,GAAGU,OAExD,CACJ,EAEAnE,EAAI6rB,eAAelW,UAAUs1D,kBAAoB,WAEoB,YAA7DtqE,KAAKiB,MAAM+nB,SAAS9nB,IAAI,kCACrBlB,KAAKu1B,KAAKlW,QAAUrf,KAAKu1B,KAAKlW,OAAO3d,aACpC,IAAuB1B,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,SACxDxpE,KAAKuqE,WAAWlrD,OAAO3d,OAAS1B,KAAKu1B,KAAKlW,OAAO3d,SACjD1B,KAAKuqE,WAAWlrD,OAAS1I,KAAKC,MAAMD,KAAK8X,UAAUzuB,KAAKu1B,KAAKlW,UAEjErf,KAAKuqE,WAAWlrD,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,OAASxpE,KAAKu1B,KAAKlW,OAAOrf,KAAKupE,UAAUvpE,KAAKwpE,QAGjGxpE,KAAKuqE,WAAWxlE,MAAM/E,KAAKupE,UAAYvpE,KAAKu1B,KAAKxwB,MAAM/E,KAAKupE,SAChE,EAEAlqE,EAAI4nB,OAAOjS,UAAUjB,oBAAsB,SAAUnB,GAGjD,IAFA,IAAIkB,EAAmB,GACnBy3D,EAAoB34D,EAAarR,MAAM,KAClCuB,EAAEyoE,EAAkB7pE,OAAOoB,EAAE,EAAEA,IAAK,CACzC,IAAI0oE,EAAaD,EAAkB/nE,MAAM,EAAEV,GAAGnB,KAAK,KAEnD,GADAmS,EAAiBnP,KAAK6mE,GAClBxrE,KAAKkB,IAAIo9B,uBAAuBktC,GAAa,CAC7C,IAAIr3D,EAAWnU,KAAKkB,IAAIo9B,uBAAuBktC,GAC/C13D,EAAiBnP,KAAKwP,EAC1B,CACJ,CAIA,OAHwC,IAApCL,EAAiB/Q,QAAQ,OACzB+Q,EAAiBnP,KAAK,MAEnBmP,CACX,EAEAzU,EAAI4nB,OAAOjS,UAAUZ,gBAAkB,SAAUxB,EAAc64D,EAAWC,GACtE,IAAIC,EAAa,KAEjB3rE,KAAK0U,MAAM9B,GAAgB,CAAC,EAC5B,IAAIg5D,EAAQvsE,EAAI0e,SAAS0tD,GACzBG,EAAMn0D,oBAAoBm0D,EAAM54D,SAChC44D,EAAMj0D,oBAAoBi0D,EAAM54D,SAChC44D,EAAM30D,wBAAwB20D,EAAM54D,SACpC44D,EAAM3zD,eAAe2zD,EAAM54D,SAE3B,IADA,IACSxR,EAAE,EAAEC,GADToqE,EAAUD,EAAM14D,eAAe04D,EAAM54D,QAAS,eACxBtR,OAAOF,EAAEC,EAAKD,IAAK,CACzC,IAAIsqE,EAAUF,EAAMh2D,kBAAkBi2D,EAAQrqE,GAAG,SACjD,GAAIsqE,EAAS,CACT9rE,KAAK0U,MAAM9B,GAAc+B,MAAQ,CAAC,EAElC,IAAK,IAAI7R,EAAE,EAAE4B,GADbonE,EAAWA,EAAQvqE,MAAM,QACCG,OAAOoB,EAAE4B,EAAK5B,IACpC9C,KAAK0U,MAAM9B,GAAc+B,MAAMm3D,EAAQhpE,KAAM,CAErD,CACK4oE,IACDC,EAAaC,EAAMh2D,kBAAkBi2D,EAAQrqE,GAAG,cAEvB,OAAjBoR,IACA5S,KAAKkB,IAAIo9B,uBAAuB1rB,GAAgB+4D,EAIhE,CACA,IAAIppE,EAAOvC,KAAKkB,IAAIqB,KAAOvC,KAAKkB,IAAIqB,KAAOvC,KAAKkB,IAAI,kBAAkB,GACtE7B,EAAIyT,kBAAkB9S,KAAMuC,EAAMqpE,EAAOA,EAAM54D,SAE1ChT,KAAK0U,MAAM9B,GAAc+B,QAC1B3U,KAAK0U,MAAM9B,GAAc+B,MAAQtV,EAAI0B,cAEzC,IAAI8qE,EACJ,IAASrqE,EAAE,EAAEC,GADToqE,EAAUD,EAAM14D,eAAe04D,EAAM54D,QAAS,UACxBtR,OAAOF,EAAEC,EAAKD,IAAK,CACzC,IAAIuqE,EAASH,EAAMh2D,kBAAkBi2D,EAAQrqE,GAAI,QAC5CnC,EAAIyB,cAAcirE,IAKvB/rE,KAAK0U,MAAM9B,GAAcm5D,GAAU,GAEnC/rE,KAAKgrB,gBAAgB6gD,EAAQrqE,GAAIxB,KAAK0U,MAAM9B,GAAcm5D,IAC1D/rE,KAAK0iB,mBAAmB1iB,KAAK0U,MAAM9B,GAAcm5D,KAP7C1sE,EAAIK,MAAM,yCAA4CqsE,EAAS,sBAQvE,CAKA,OAAOJ,CACX,EAEAtsE,EAAI4nB,OAAOjS,UAAUd,wBAA0B,SAAUJ,GAKrD,IAJA,IAAIrJ,EAAM,CAAC,EACPuhE,EAAchsE,KAAK2C,OAAO3C,KAAKkB,IAAIqB,MAAMK,KAAK,2BAGzCpB,GADTwqE,EAAc,CAAC,IAAIlmE,OADnBkmE,EAAcA,GAA4B,KAEnBtqE,OAAO,EAAEF,GAAG,EAAEA,IAEjC,IADA,IAAIyqE,EAAaD,EAAYxqE,GACpBsB,EAAE,EAAE4B,EAAKoP,EAAiBpS,OAAOoB,EAAE4B,EAAK5B,IAAK,CAClD,IAAI8P,EAAekB,EAAiBhR,GAEpC,IAAI9C,KAAKkB,IAAI8S,mBAAmBpB,GAAhC,CAIA,IAAIqB,EAAMjU,KAAK4T,IAAIC,oBAAoBjB,EAAcq5D,KAG/Ch4D,IAAQg4D,GAAeh4D,KACzBjU,KAAKkB,IAAI8S,mBAAmBpB,IAAgB,GAG3CqB,IAGLxJ,EAAImI,GAAgBqB,EAZpB,CAaJ,CAGJ,OAAOxJ,CACX,EAEApL,EAAI6sE,aAYa,CACf,CAAC,KAVErtE,EAAwB,CAAC,CAAC,KAAM,CAAC,EAAE,MAWtC,CAAC,MAAOA,GACR,CAAC,KAAMA,GACP,CAAC,IAAMA,GACP,CAAC,SAbEC,EAAwB,CAAC,CAAC,KAAM,CAAC,EAAE,MActC,CAAC,SAAUA,GACX,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,QAASA,GACV,CAAC,MAAOD,GACR,CAAC,MAlBEG,EAAW,CAAC,CAAC,KAAM,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,QAmBpC,CAAC,OAAQA,GACT,CAAC,KAAMA,GACP,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,QAASF,GACV,CAAC,KAAMD,GACP,CAAC,MAAOG,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,UA5BEG,EAAyB,CAAC,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,KAAM,CAAC,EAAE,MA6BpD,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWL,GACZ,CAAC,MAjCEI,EAAyB,CAAC,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,KAAM,CAAC,EAAE,MAkCpD,CAAC,SAAUC,GACX,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,QAASA,GACV,CAAC,MAAOD,GACR,CAAC,QAASC,GACV,CAAC,MAAOH,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOH,GACR,CAAC,SAAUC,GACX,CAAC,SAAUA,GACX,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,QAASA,GACV,CAAC,MAAOD,GACR,CAAC,MAAOA,GACR,CAAC,UAAWC,GACZ,CAAC,WAAYA,GACb,CAAC,IAAKD,GACN,CAAC,KAAMG,GACP,CAAC,KAAMA,GACP,CAAC,MAAOH,GACR,CAAC,OAAQA,GACT,CAAC,QAASA,GACV,CAAC,QAASA,GACV,CAAC,MAAOG,GACR,CAAC,YAtEED,EAAwB,CAAC,CAAC,KAAM,CAAC,EAAE,MAuEtC,CAAC,SAAUD,GACX,CAAC,OAAQA,GACT,CAAC,QAASA,GACV,CAAC,QApEEM,EAA+C,CAAC,CAAC,KAAM,CAAC,EAAE,IAAK,CAAC,CAAC,EAAE,GAAI,CAAC,EAAE,MAqE7E,CAAC,SAAUA,GACX,CAAC,QAASN,GACV,CAAC,QA3EEG,EAAW,CAAC,CAAC,KAAM,CAAC,EAAE,IAAI,CAAC,CAAC,EAAE,GAAG,QA4EpC,CAAC,aAAcF,GACf,CAAC,KAAMC,GACP,CAAC,MAAOA,GACR,CAAC,OAAQH,GACT,CAAC,QAASG,GACV,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,OAzFEJ,EAAoB,CAAC,CAAC,CAAC,EAAE,GAAI,QA0FhC,CAAC,QAASI,GACV,CAAC,QAASA,GACV,CAAC,QAASA,GACV,CAAC,QAASA,GACV,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,KAAMA,GACP,CAAC,SAAUF,GACX,CAAC,KAAMD,GACP,CAAC,MAAOA,GACR,CAAC,MAAOG,GACR,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOH,GACR,CAAC,IAAKA,GACN,CAAC,KAAMD,GACP,CAAC,KAAMC,GACP,CAAC,QAASC,GACV,CAAC,QAASA,GACV,CAAC,SAAUA,GACX,CAAC,SAAUG,GACX,CAAC,SAAUH,GACX,CAAC,OAAQA,GACT,CAAC,KAAMD,GACP,CAAC,IAAKA,GACN,CAAC,KAAMA,GACP,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,KAAMA,GACP,CAAC,MAAOG,GACR,CAAC,KAAMA,GACP,CAAC,MAAOH,GACR,CAAC,MAAOA,GACR,CAAC,KAAMA,GACP,CAAC,WAAYC,GACb,CAAC,WAAYA,GACb,CAAC,YAAaA,GACd,CAAC,YAAaA,GACd,CAAC,UAAWA,GACZ,CAAC,QAASD,GACV,CAAC,QAASC,GACV,CAAC,QAASG,GACV,CAAC,SAAUH,GACX,CAAC,SAAUA,GACX,CAAC,SAAUA,GACX,CAAC,SAAUA,GACX,CAAC,OAAQA,GACT,CAAC,SAAUA,GACX,CAAC,KAAMD,GACP,CAAC,UAAWC,GACZ,CAAC,UAAWA,GACZ,CAAC,WAAYA,GACb,CAAC,WAAYA,GACb,CAAC,SAAUA,GACX,CAAC,OAAQD,GACT,CAAC,IAAKA,GACN,CAAC,KAAMA,GACP,CAAC,MAAOD,GACR,CAAC,IAAKC,GACN,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,OAAQA,GACT,CAAC,OAAQA,GACT,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,MAAOA,GACR,CAAC,UAAWC,GACZ,CAAC,UAAWA,GACZ,CAAC,WAAYA,GACb,CAAC,aAAcC,GACf,CAAC,WAAYD,GACb,CAAC,OAAQD,GACT,CAAC,SAAUC,GACX,CAAC,SAAUA,GACX,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,QAASA,GACV,CAAC,YAAaC,GACd,CAAC,UAAWD,GACZ,CAAC,MAAOD,GACR,CAAC,QAASA,GACV,CAAC,IAAKA,GACN,CAAC,KAAMA,GACP,CAAC,OAAQA,GACT,CAAC,SAAUC,GACX,CAAC,WAAYC,GACb,CAAC,YAAaA,GACd,CAAC,SAAUD,GACX,CAAC,SAAUA,GACX,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,SAAUA,GACX,CAAC,QAASA,GACV,CAAC,UAAWA,GACZ,CAAC,aAAcC,GACf,CAAC,MAAOC,GACR,CAAC,SAAUH,GACX,CAAC,KAAMA,GACP,CAAC,MAAOA,GACR,CAAC,cAlNsB,CAAC,CAAC,CAAC,EAAE,GAAI,QAmNhC,CAAC,MAAOG,GACR,CAAC,SAAUF,GACX,CAAC,UAAWK,GACZ,CAAC,UAAWA,GACZ,CAAC,UAAWA,GACZ,CAAC,QAASL,GACV,CAAC,aAjN2B,CAAC,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,KAAM,CAAC,EAAE,MAkNpD,CAAC,SAAUK,GACX,CAAC,MAAOD,GACR,CAAC,UAAWJ,GACZ,CAAC,UAAWA,GACZ,CAAC,WAAYA,GACb,CAAC,aAAcC,GACf,CAAC,YAAaA,GACd,CAAC,OAAQF,GACT,CAAC,UAAWM,GACZ,CAAC,MAAOD,GACR,CAAC,IAAKN,GACN,CAAC,KAAMA,GACP,CAAC,KAAMM,GACP,CAAC,MAAOF,GACR,CAAC,MAAOA,IAKVK,EAAIwG,eAAkB,WAClB,SAASsmE,EAAeC,EAAWC,EAAeC,GAYpD,IAAIC,EAAgBH,EACpBA,EAAYE,EAAeF,EAAU9rE,cAAgB8rE,EACrD,IACIpzD,EACMwzD,EAFNC,EAAe,GAGfJ,GACHD,EAAYA,EAAU7qE,MAAM,IAAIuJ,UAAUnJ,KAAK,IAC/CqX,EAAM3Z,EAAI2K,uBAEVgP,EAAM3Z,EAAI4K,uBAGX,IADA,IAAIxG,EAAI2oE,EAAU1oE,MAAMsV,GACjBvV,GAAG,CACT,IAEIm4B,EAFA8wC,EAAKL,EAAgB5oE,EAAE,GAAGlC,MAAM,IAAIuJ,UAAUnJ,KAAK,IAAM8B,EAAE,GAI/D,KADA+oE,KADI5wC,KADAA,IAAYn4B,GAAIipE,IACQA,EAAG5oE,QAAQ,8BAA+B,QAC5C83B,EAAUx7B,gBAAkBw7B,GAEzC,MAETywC,GACHI,EAAa9nE,KAAK4nE,EAAc/oE,OAAmB,EAAbkpE,EAAGhrE,SACzC6qE,EAAgBA,EAAc/oE,MAAM,GAAe,EAAbkpE,EAAGhrE,UAEzC+qE,EAAa9nE,KAAK4nE,EAAc/oE,MAAM,EAAEkpE,EAAGhrE,SAC3C6qE,EAAgBA,EAAc/oE,MAAMkpE,EAAGhrE,SAIxC+B,GADA2oE,EAAY3oE,EAAE,IACAC,MAAMsV,EACrB,CACA,GAAIqzD,EAAe,CAClBD,EAAYA,EAAU7qE,MAAM,IAAIuJ,UAAUnJ,KAAK,IAC/C8qE,EAAa3hE,UACb,IAAK,IAAItJ,EAAE,EAAEC,EAAKgrE,EAAa/qE,OAAOF,EAAEC,EAAKD,IACT,KAA/BirE,EAAajrE,GAAGgC,MAAM,EAAG,KAC5BipE,EAAajrE,EAAE,IAAM,KAGvB,IAASA,EAAE,EAAEC,EAAKgrE,EAAa/qE,OAAOF,EAAEC,EAAKD,IACT,KAA/BirE,EAAajrE,GAAGgC,MAAM,EAAG,KAC5BipE,EAAajrE,GAAKirE,EAAajrE,GAAGgC,MAAM,IAG1C4oE,EAAYG,EAAc/oE,MAAM,EAAG4oE,EAAU1qE,OAC9C,MACC0qE,EAAYG,EAAc/oE,OAA0B,EAApB4oE,EAAU1qE,QAE3C,MAAO,CAAC8qE,EAAaJ,EAAWK,EACjC,CA+BG,OAAO,SAASE,GAEZ,IACIC,GADA34D,EAAMk4D,EAAeQ,EAAQhnE,SACT,GACpBknE,EAAmB54D,EAAI,GAC3B04D,EAAQhnE,OAASinE,EACjB,IApCcptE,EACV89B,EAmCAwvC,GApCUttE,EAoCqBqtE,EAAiBlrE,KAAK,IAnCrD27B,EAAW99B,EAAIgE,OAAO,GAC1BhE,EAAMA,EAAIoF,OACO,MAAb04B,GAAoB,CAAC,IAAM,KAAUv6B,QAAQvD,EAAIgE,OAAO,KAAO,IAC/DhE,GAAO,KAEJA,GA+BHstE,IACAH,EAAQ,yBAA2BG,GA9B3C,SAAqBH,GACjB,IAAKA,EAAQlmE,QAAUkmE,EAAQ/mE,MAAO,CAClC,IAAInC,EAAIkpE,EAAQ/mE,MAAMlC,MAAM,eAC5B,GAAID,EAAG,CACH,IAAIH,EAAMqpE,EAAQ/mE,MAAM7C,QAAQU,EAAE,IAC9BspE,EAAkBJ,EAAQ/mE,MAAMpC,MAAMF,EAAMG,EAAE,GAAG/B,QACjDsrE,EAAiBL,EAAQ/mE,MAAMpC,MAAMF,EAAKA,EAAMG,EAAE,GAAG/B,QAAQoC,QAAQ,OAAQ,IACtC,UAAvCipE,EAAgBjpE,QAAQ,MAAO,KAAoB6oE,EAAQ,sBAM7B,IAA1BK,EAAetrE,SACfirE,EAAQ,iBAAkB,GAE9BA,EAAQlmE,OAASsmE,IANjBJ,EAAQ,qBAAuBI,EAC/BJ,EAAQ,2BAA6B,KAOzCA,EAAQ/mE,MAAQ+mE,EAAQ/mE,MAAMpC,MAAM,EAAGF,EAC3C,CACJ,CACJ,CAYI2pE,CAAYN,GAEZ,IAAI14D,EACAi5D,GADAj5D,EAAMk4D,EAAeQ,EAAQ/mE,OAAO,IACf,GACrBunE,EAAoBl5D,EAAI,GAC5B04D,EAAQ/mE,MAAQsnE,EAChB,IAAIE,EAAmBD,EAAkBxrE,KAAK,IAAIiD,OAC9CwoE,IACAT,EAAQ,qBAAuBS,EAEvC,CACJ,CAnHqB,GAsHrBC,EAAOC,QAAUjuE,C","sources":["webpack://graphical-models/./node_modules/citeproc/citeproc_commonjs.js"],"sourcesContent":["/*\nCopyright (c) 2009-2019 Frank Bennett\n\n\tThis program is free software: you can redistribute it and/or\n\tmodify it under EITHER\n\n      * the terms of the Common Public Attribution License (CPAL) as\n\t    published by the Open Source Initiative, either version 1 of\n\t    the CPAL, or (at your option) any later version; OR\n\n      * the terms of the GNU Affero General Public License (AGPL)\n        as published by the Free Software Foundation, either version\n        3 of the AGPL, or (at your option) any later version.\n\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n\tAffero General Public License for more details.\n\n\tYou should have received copies of the Common Public Attribution\n    License and of the GNU Affero General Public License along with\n    this program.  If not, see <https://opensource.org/licenses/> or\n    <http://www.gnu.org/licenses/> respectively.\n*/\n/*global CSL: true */\n\n/**\n * A Javascript implementation of the CSL citation formatting language.\n *\n * <p>A configured instance of the process is built in two stages,\n * using {@link CSL.Core.Build} and {@link CSL.Core.Configure}.\n * The former sets up hash-accessible locale data and imports the CSL format file\n * to be applied to the citations,\n * transforming it into a one-dimensional token list, and\n * registering functions and parameters on each token as appropriate.\n * The latter sets jump-point information\n * on tokens that constitute potential branch\n * points, in a single back-to-front scan of the token list.\n * This\n * yields a token list that can be executed front-to-back by\n * body methods available on the\n * {@link CSL.Engine} class.</p>\n *\n * <p>This top-level {@link CSL} object itself carries\n * constants that are needed during processing.</p>\n * @namespace A CSL citation formatter.\n */\n\n// IE6 does not implement Array.indexOf().\n// IE7 neither, according to rumour.\n\n\n// Potential skip words:\n// under; along; out; between; among; outside; inside; amid; amidst; against; toward; towards.\n// See https://forums.zotero.org/discussion/30484/?Focus=159613#Comment_159613\n\n'use strict';\n\n\nvar CSL = {\n\n    PROCESSOR_VERSION: \"1.4.61\",\n\n    error: function(str) { // default error function\n        if (\"undefined\" === typeof Error) {\n            throw new Error(\"citeproc-js error: \" + str);\n        } else {\n            throw \"citeproc-js error: \" + str;\n        }\n    },\n    debug: function(str) { // default debug function\n        if (\"undefined\" === typeof console) {\n            dump(\"CSL: \" + str + \"\\n\");\n        } else {\n            console.log(\"citeproc-js warning: \" + str);\n        }\n    },\n\n    toLocaleUpperCase(str) {\n        var arr = this.tmp.lang_array;\n        try {\n            str = str.toLocaleUpperCase(arr);\n        } catch (e) {\n            str = str.toUpperCase();\n        }\n        return str;\n    },\n\n    toLocaleLowerCase(str) {\n        var arr = this.tmp.lang_array;\n        try {\n            str = str.toLocaleLowerCase(arr);\n        } catch (e) {\n            str = str.toLowerCase();\n        }\n        return str;\n    },\n\n    LOCATOR_LABELS_REGEXP: new RegExp(\"^((vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\\\.)\\\\s+(.*)\"),\n\n    STATUTE_SUBDIV_PLAIN_REGEX: /(?:(?:^| )(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\. *)/,\n    STATUTE_SUBDIV_PLAIN_REGEX_FRONT: /(?:^\\s*[.,;]*\\s*(?:vrs|sv|subpara|op|subch|add|amend|annot|app|art|bibliog|bk|ch|cl|col|cmt|dec|dept|div|ex|fig|fld|fol|n|hypo|illus|intro|l|no|p|pp|para|pt|pmbl|princ|pub|r|rn|sched|sec|ser|subdiv|subsec|supp|tbl|tit|vol)\\. *)/,\n \n    STATUTE_SUBDIV_STRINGS: {\n        \"vrs.\": \"verse\",\n\t\t\"sv.\": \"sub-verbo\",\n        \"subpara.\": \"subparagraph\",\n        \"op.\": \"opus\",\n        \"subch.\": \"subchapter\",\n        \"add.\": \"addendum\",\n        \"amend.\": \"amendment\",\n        \"annot.\": \"annotation\",\n        \"app.\": \"appendix\",\n        \"art.\": \"article\",\n        \"bibliog.\": \"bibliography\",\n        \"bk.\": \"book\",\n        \"ch.\": \"chapter\",\n        \"cl.\": \"clause\",\n        \"col.\": \"column\",\n        \"cmt.\": \"comment\",\n        \"dec.\": \"decision\",\n        \"dept.\": \"department\",\n        \"ex.\": \"example\",\n        \"fig.\": \"figure\",\n        \"fld.\": \"field\",\n        \"fol.\": \"folio\",\n        \"n.\": \"note\",\n        \"hypo.\": \"hypothetical\",\n        \"illus.\": \"illustration\",\n        \"intro.\": \"introduction\",\n        \"l.\": \"line\",\n        \"no.\": \"issue\",\n        \"p.\": \"page\",\n        \"pp.\": \"page\",\n        \"para.\": \"paragraph\",\n        \"pt.\": \"part\",\n        \"pmbl.\": \"preamble\",\n        \"princ.\": \"principle\",\n        \"pub.\": \"publication\",\n        \"r.\": \"rule\",\n        \"rn.\": \"randnummer\",\n        \"sched.\": \"schedule\",\n        \"sec.\": \"section\",\n        \"ser.\": \"series,\",\n        \"subdiv.\": \"subdivision\",\n        \"subsec.\": \"subsection\",\n        \"supp.\": \"supplement\",\n        \"tbl.\": \"table\",\n        \"tit.\": \"title\",\n        \"vol.\": \"volume\"\n    },\n    STATUTE_SUBDIV_STRINGS_REVERSE: {\n        \"verse\": \"vrs.\",\n\t\t\"sub-verbo\": \"sv.\",\n        \"sub verbo\": \"sv.\",\n        \"subparagraph\": \"subpara.\",\n        \"opus\": \"op.\",\n        \"subchapter\": \"subch.\",\n        \"addendum\": \"add.\",\n        \"amendment\": \"amend.\",\n        \"annotation\": \"annot.\",\n        \"appendix\": \"app.\",\n        \"article\": \"art.\",\n        \"bibliography\": \"bibliog.\",\n        \"book\": \"bk.\",\n        \"chapter\": \"ch.\",\n        \"clause\": \"cl.\",\n        \"column\": \"col.\",\n        \"comment\": \"cmt.\",\n        \"decision\": \"dec.\",\n        \"department\": \"dept.\",\n        \"example\": \"ex.\",\n        \"figure\": \"fig.\",\n        \"field\": \"fld.\",\n        \"folio\": \"fol.\",\n        \"note\": \"n.\",\n        \"hypothetical\": \"hypo.\",\n        \"illustration\": \"illus.\",\n        \"introduction\": \"intro.\",\n        \"line\": \"l.\",\n        \"issue\": \"no.\",\n        \"page\": \"p.\",\n        \"paragraph\": \"para.\",\n        \"part\": \"pt.\",\n        \"preamble\": \"pmbl.\",\n        \"principle\": \"princ.\",\n        \"publication\": \"pub.\",\n        \"rule\": \"r.\",\n        \"randnummer\": \"rn.\",\n        \"schedule\": \"sched.\",\n        \"section\": \"sec.\",\n        \"series,\": \"ser.\",\n        \"subdivision\": \"subdiv.\",\n        \"subsection\": \"subsec.\",\n        \"supplement\": \"supp.\",\n        \"table\": \"tbl.\",\n        \"title\": \"tit.\",\n        \"volume\": \"vol.\"\n    },\n\n    LOCATOR_LABELS_MAP: {\n        \"vrs\": \"verse\",\n\t\t\"sv\": \"sub-verbo\",\n        \"subpara\": \"subparagraph\",\n        \"op\": \"opus\",\n        \"subch\": \"subchapter\",\n        \"add\": \"addendum\",\n        \"amend\": \"amendment\",\n        \"annot\": \"annotation\",\n        \"app\": \"appendix\",\n        \"art\": \"article\",\n        \"bibliog\": \"bibliography\",\n        \"bk\": \"book\",\n        \"ch\": \"chapter\",\n        \"cl\": \"clause\",\n        \"col\": \"column\",\n        \"cmt\": \"comment\",\n        \"dec\": \"decision\",\n        \"dept\": \"department\",\n        \"ex\": \"example\",\n        \"fig\": \"figure\",\n        \"fld\": \"field\",\n        \"fol\": \"folio\",\n        \"n\": \"note\",\n        \"hypo\": \"hypothetical\",\n        \"illus\": \"illustration\",\n        \"intro\": \"introduction\",\n        \"l\": \"line\",\n        \"no\": \"issue\",\n        \"p\": \"page\",\n        \"pp\": \"page\",\n        \"para\": \"paragraph\",\n        \"pt\": \"part\",\n        \"pmbl\": \"preamble\",\n        \"princ\": \"principle\",\n        \"pub\": \"publication\",\n        \"r\": \"rule\",\n        \"rn\": \"randnummer\",\n        \"sched\": \"schedule\",\n        \"sec\": \"section\",\n        \"ser\": \"series,\",\n        \"subdiv\": \"subdivision\",\n        \"subsec\": \"subsection\",\n        \"supp\": \"supplement\",\n        \"tbl\": \"table\",\n        \"tit\": \"title\",\n        \"vol\": \"volume\"\n    },\n    MODULE_MACROS: {\n        \"juris-pretitle\": true,\n        \"juris-title\": true,\n        \"juris-pretitle-short\": true,\n        \"juris-title-short\": true,\n        \"juris-main\": true,\n        \"juris-main-short\": true,\n        \"juris-tail\": true,\n        \"juris-tail-short\": true,\n        \"juris-locator\": true\n    },\n    MODULE_TYPES: {\n        \"legal_case\": true,\n        \"legislation\": true,\n        \"bill\": true,\n        \"hearing\": true,\n        \"gazette\": true,\n        \"report\": true,\n        \"regulation\": true,\n        \"standard\": true,\n        \"patent\": true,\n        \"locator\": true\n    },\n    checkNestedBrace: function(state) {\n        if (state.opt.xclass === \"note\") {\n            this.depth = 0;\n            this.update = function(str) {\n                \n                // Receives affix string, returns with flipped parens.\n                \n                var str = str ? str : \"\";\n                var lst = str.split(/([\\(\\)])/);\n                for (var i=1,ilen=lst.length;i<ilen;i += 2) {\n                    if (lst[i] === \"(\") {\n                        if (1 === (this.depth % 2)) {\n                            lst[i] = \"[\";\n                        }\n                        this.depth += 1;\n                    } else if (lst[i] === \")\") {\n                        if (0 === (this.depth % 2)) {\n                            lst[i] = \"]\";\n                        }\n                        this.depth -= 1;\n                    }\n                }\n                var ret = lst.join(\"\");\n                return ret;\n            };\n        } else {\n            this.update = function(str) {\n                return str;\n            };\n        }\n    },\n\n    MULTI_FIELDS: [\"event\", \"publisher\", \"publisher-place\", \"event-place\", \"title\", \"container-title\", \"collection-title\", \"authority\",\"genre\",\"title-short\",\"medium\",\"country\",\"jurisdiction\",\"archive\",\"archive-place\"],\n\n    LangPrefsMap: {\n        \"title\":\"titles\",\n        \"title-short\":\"titles\",\n        \"event\":\"titles\",\n        \"genre\":\"titles\",\n        \"medium\":\"titles\",\n        \"container-title\":\"journals\",\n        \"collection-title\":\"titles\",\n        \"archive\":\"journals\",\n        \"publisher\":\"publishers\",\n        \"authority\":\"publishers\",\n        \"publisher-place\": \"places\",\n        \"event-place\": \"places\",\n        \"archive-place\": \"places\",\n        \"jurisdiction\": \"places\",\n        \"number\": \"places\",\n        \"edition\":\"places\",\n        \"issue\":\"places\",\n        \"volume\":\"places\"\n    },\n\n    AbbreviationSegments: function () {\n        this[\"container-title\"] = {};\n        this[\"collection-title\"] = {};\n        this[\"institution-entire\"] = {};\n        this[\"institution-part\"] = {};\n        this.nickname = {};\n        this.number = {};\n        this.title = {};\n        this.place = {};\n        this.hereinafter = {};\n        this.classic = {};\n        this[\"container-phrase\"] = {};\n        this[\"title-phrase\"] = {};\n    },\n\n    getAbbrevsDomain: function (state, country, lang) {\n\t\tvar domain = null;\n        if (state.opt.availableAbbrevDomains && country && country !== \"default\") {\n\t        var globalDomainPreference = state.locale[state.opt.lang].opts[\"jurisdiction-preference\"];\n\t\t    var itemDomainPreference = null;\n\t\t    if (state.locale[lang]) {\n\t\t\t    itemDomainPreference = state.locale[lang].opts[\"jurisdiction-preference\"];\n\t\t    }\n\t\t    if (itemDomainPreference) {\n\t\t\t    for (var j=itemDomainPreference.length-1; j > -1; j--) {\n\t\t\t\t    if (state.opt.availableAbbrevDomains[country].indexOf(itemDomainPreference[j]) > -1) {\n\t\t\t\t\t    domain = itemDomainPreference[j];\n\t\t\t\t\t    break;\n\t\t\t\t    }\n\t\t\t    }\n\t\t    }\n\t\t    if (!domain && globalDomainPreference) {\n\t\t\t    for (var j=globalDomainPreference.length-1; j > -1; j--) {\n\t\t\t\t    if (state.opt.availableAbbrevDomains[country].indexOf(globalDomainPreference[j]) > -1) {\n\t\t\t\t\t    domain = globalDomainPreference[j];\n\t\t\t\t\t    break;\n\t\t\t\t    }\n\t\t\t    }\n\t\t    }\n        }\n        return domain;\n    },\n    \n    FIELD_CATEGORY_REMAP: {\n        \"title\": \"title\",\n        \"container-title\": \"container-title\",\n        \"collection-title\": \"collection-title\",\n        \"country\": \"place\",\n        \"number\": \"number\",\n        \"place\": \"place\",\n        \"archive\": \"container-title\",\n        \"title-short\": \"title\",\n        \"genre\": \"title\",\n        \"event\": \"title\",\n        \"medium\": \"title\",\n\t\t\"archive-place\": \"place\",\n\t\t\"publisher-place\": \"place\",\n\t\t\"event-place\": \"place\",\n\t\t\"jurisdiction\": \"place\",\n\t\t\"language-name\": \"place\",\n\t\t\"language-name-original\": \"place\",\n        \"call-number\": \"number\",\n        \"chapter-number\": \"number\",\n        \"collection-number\": \"number\",\n        \"edition\": \"number\",\n        \"page\": \"number\",\n        \"issue\": \"number\",\n        \"locator\": \"number\",\n        \"locator-extra\": \"number\",\n        \"number-of-pages\": \"number\",\n        \"number-of-volumes\": \"number\",\n        \"volume\": \"number\",\n        \"citation-number\": \"number\",\n        \"publisher\": \"institution-part\"\n    },\n    \n    parseLocator: function(item) {\n        if (this.opt.development_extensions.locator_date_and_revision) {\n            // Break out locator elements if necessary\n            if (item.locator) {\n                item.locator = \"\" + item.locator;\n                var idx = item.locator.indexOf(\"|\");\n                if (idx > -1) {\n                    var raw_locator = item.locator;\n                    item.locator = raw_locator.slice(0, idx);\n                    raw_locator = raw_locator.slice(idx + 1);\n                    var m = raw_locator.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/);\n                    if (m) {\n                        item[\"locator-date\"] = this.fun.dateparser.parseDateToObject(m[1]);\n                        raw_locator = raw_locator.slice(m[1].length);\n                    }\n                    item[\"locator-extra\"] = raw_locator.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n                }\n            }\n        }\n        if (item.locator) {\n            item.locator = (\"\" + item.locator).replace(/\\s+$/, '');\n        }\n        return item;\n    },\n\n    normalizeLocaleStr: function(str) {\n        if (!str) {\n            return;\n        }\n        var lst = str.split('-');\n        lst[0] = lst[0].toLowerCase();\n        if (lst[1]) {\n            lst[1] = lst[1].toUpperCase();\n        }\n        return lst.join(\"-\");\n    },\n\n    parseNoteFieldHacks: function(Item, validFieldsForType, allowDateOverride) {\n        if (\"string\" !== typeof Item.note) {\n            return;\n        }\n        var elems = [];\n        var lines = Item.note.split('\\n');\n        // Normalize entries\n        for (var i=0, ilen=lines.length; i<ilen; i++) {\n            var line = lines[i];\n            var elems = [];\n            var m = line.match(CSL.NOTE_FIELDS_REGEXP);\n            if (m) {\n                var splt = line.split(CSL.NOTE_FIELDS_REGEXP);\n                for (var j=0,jlen=(splt.length-1);j<jlen;j++) {\n                    elems.push(splt[j]);\n                    elems.push(m[j]);\n                }\n                elems.push(splt[splt.length-1]);\n                for (var j=1,jlen=elems.length;j<jlen;j += 2) {\n                    // Abort conversions if preceded by unparseable text\n                    if (elems[j-1].trim() && (i>0 || j>1) && !elems[j-1].match(CSL.NOTE_FIELD_REGEXP)) {\n                        break;\n                    } else {\n                        elems[j] = '\\n' + elems[j].slice(2,-1).trim() + '\\n';\n                    }\n                }\n                lines[i] = elems.join('');\n            }\n        }\n        // Resplit\n        lines = lines.join('\\n').split('\\n');\n        var offset = 0;\n        var names = {};\n        for (var i=0,ilen=lines.length;i<ilen;i++) {\n            var line = lines[i];\n            var mm = line.match(CSL.NOTE_FIELD_REGEXP);\n            if (!line.trim()) {\n                continue;\n            } else if (!mm) {\n                if (i === 0) {\n                    continue;\n                } else {\n                    offset = i;\n                    break;\n                }\n            }\n            var key = mm[1];\n            var val = mm[2].replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\n            if (key === \"type\") {\n                Item.type = val;\n                lines[i] = \"\";\n            } else if (CSL.DATE_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n                if (!Item[key] || allowDateOverride) {\n                    Item[key] = CSL.DateParser.parseDateToArray(val);\n                    if (!validFieldsForType || (validFieldsForType[key] && this.isDateString(val))) {\n                        lines[i] = \"\";\n                    }\n                }\n            } else if (!Item[key]) {\n                if (CSL.NAME_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n                    if (!names[key]) {\n                        names[key] = [];\n                    }\n                    var lst = val.split(/\\s*\\|\\|\\s*/);\n                    if (lst.length === 1) {\n                        names[key].push({literal:lst[0]});\n                    } else if (lst.length === 2) {\n                        var name = {family:lst[0],given:lst[1]};\n                        CSL.parseParticles(name);\n                        names[key].push(name);\n                    }\n                } else {\n                    Item[key] = val;\n                }\n                if (!validFieldsForType || validFieldsForType[key]) {\n                    lines[i] = \"\";\n                }\n            }\n        }\n        for (var key in names) {\n            Item[key] = names[key];\n        }\n        // Final cleanup for validCslFields only: eliminate blank lines, add blank line to text\n        if (validFieldsForType) {\n            if (lines[offset].trim()) {\n                lines[offset] = '\\n' + lines[offset];\n            }\n            for (var i=offset-1;i>-1;i--) {\n                if (!lines[i].trim()) {\n                    lines = lines.slice(0, i).concat(lines.slice(i + 1));\n                }\n            }\n        }\n        Item.note = lines.join(\"\\n\").trim();\n    },\n\n    checkPrefixSpaceAppend: function (state, prefix) {\n        if (!prefix) {\n            prefix = \"\";\n        }\n        var sp = \"\";\n        // We need the raw string, without decorations\n        // of any kind. Markup scheme is known, though, so\n        // markup can be safely stripped at string level.\n        //\n        // U+201d = right double quotation mark\n        // U+2019 = right single quotation mark\n        // U+00bb = right double angle bracket (guillemet)\n        // U+202f = non-breaking thin space\n        // U+00a0 = non-breaking space\n        var test_prefix = prefix.replace(/<[^>]+>/g, \"\").replace(/[\"'\\u201d\\u2019\\u00bb\\u202f\\u00a0 ]+$/g,\"\");\n        var test_char = test_prefix.slice(-1);\n        if (test_prefix.match(CSL.ENDSWITH_ROMANESQUE_REGEXP)) {\n            sp = \" \";\n        } else if (CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(test_char) > -1) {\n            sp = \" \";\n        } else if (test_char.match(/[\\)\\],0-9]/)) {\n            sp = \" \";\n        }\n        // Protect against double spaces, which would trigger an extra,\n        // explicit, non-breaking space.\n        var prefix = (prefix + sp).replace(/\\s+/g, \" \");\n        return prefix;\n    },\n\n    checkIgnorePredecessor: function(state, prefix) {\n        var ignorePredecessor = false;\n        var test_prefix = prefix.replace(/<[^>]+>/g, \"\").replace(/[\"'\\u201d\\u2019\\u00bb\\u202f\\u00a0 ]+$/g,\"\");\n        var test_char = test_prefix.slice(-1);\n        if (CSL.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(test_char) > -1 && prefix.trim().indexOf(\" \") > -1) {\n            state.tmp.term_predecessor = false;\n            return true;\n        }\n        return false;\n    },\n\n    checkSuffixSpacePrepend: function(state, suffix) {\n        if (!suffix) {\n            return \"\";\n        }\n        if (suffix.match(CSL.STARTSWITH_ROMANESQUE_REGEXP) || ['[','('].indexOf(suffix.slice(0,1)) > -1) {\n            suffix = \" \" + suffix;\n        }\n        return suffix;\n    },\n    \n    GENDERS: [\"masculine\", \"feminine\"],\n    \n    ERROR_NO_RENDERED_FORM: 1,\n\n    PREVIEW: \"Just for laughs.\",\n    ASSUME_ALL_ITEMS_REGISTERED: 2,\n\n    START: 0,\n    END: 1,\n    SINGLETON: 2,\n\n    SEEN: 6,\n    SUCCESSOR: 3,\n    SUCCESSOR_OF_SUCCESSOR: 4,\n    SUPPRESS: 5,\n\n    SINGULAR: 0,\n    PLURAL: 1,\n\n    LITERAL: true,\n\n    BEFORE: 1,\n    AFTER: 2,\n\n    DESCENDING: 1,\n    ASCENDING: 2,\n\n    PRIMARY: 1,\n    SECONDARY: 2,\n    \n    POSITION_FIRST: 0,\n    POSITION_SUBSEQUENT: 1,\n    POSITION_IBID: 2,\n    POSITION_IBID_WITH_LOCATOR: 3,\n    POSITION_CONTAINER_SUBSEQUENT: 4,\n\n    POSITION_MAP: {\n        \"0\": 0,\n        \"4\": 1,\n        \"1\": 2,\n        \"2\": 3,\n        \"3\": 4\n    },\n    \n    POSITION_TEST_VARS: [\"position\", \"first-reference-note-number\", \"near-note\"],\n\n    AREAS: [\"citation\", \"citation_sort\", \"bibliography\", \"bibliography_sort\", \"intext\"],\n\n    CITE_FIELDS: [\"first-reference-note-number\", \"first-container-reference-note-number\", \"locator\", \"locator-extra\"],\n\n    SWAPPING_PUNCTUATION: [\".\", \"!\", \"?\", \":\", \",\"],\n    TERMINAL_PUNCTUATION: [\":\", \".\", \";\", \"!\", \"?\", \" \"],\n\n    // update modes\n    NONE: 0,\n    NUMERIC: 1,\n    POSITION: 2,\n    TRIGRAPH: 3,\n\n    DATE_PARTS: [\"year\", \"month\", \"day\"],\n    DATE_PARTS_ALL: [\"year\", \"month\", \"day\", \"season\"],\n    DATE_PARTS_INTERNAL: [\"year\", \"month\", \"day\", \"year_end\", \"month_end\", \"day_end\"],\n\n    NAME_PARTS: [\"non-dropping-particle\", \"family\", \"given\", \"dropping-particle\", \"suffix\", \"literal\"],\n\n    DISAMBIGUATE_OPTIONS: [\n        \"disambiguate-add-names\",\n        \"disambiguate-add-givenname\",\n        \"disambiguate-add-year-suffix\"\n    ],\n\n    GIVENNAME_DISAMBIGUATION_RULES: [\n        \"all-names\",\n        \"all-names-with-initials\",\n        \"primary-name\",\n        \"primary-name-with-initials\",\n        \"by-cite\"\n    ],\n\n    NAME_ATTRIBUTES: [\n        \"and\",\n        \"delimiter-precedes-last\",\n        \"delimiter-precedes-et-al\",\n        \"initialize-with\",\n        \"initialize\",\n        \"name-as-sort-order\",\n        \"sort-separator\",\n        \"et-al-min\",\n        \"et-al-use-first\",\n        \"et-al-subsequent-min\",\n        \"et-al-subsequent-use-first\",\n        \"form\",\n        \"prefix\",\n        \"suffix\",\n        \"delimiter\"\n    ],\n\n    LOOSE: 0,\n    STRICT: 1,\n    TOLERANT: 2,\n\n    PREFIX_PUNCTUATION: /[.;:]\\s*$/,\n    SUFFIX_PUNCTUATION: /^\\s*[.;:,\\(\\)]/,\n\n    NUMBER_REGEXP: /(?:^\\d+|\\d+$)/,\n    //\n    // \\u0400-\\u042f are cyrillic and extended cyrillic capitals\n    // this is not fully smart yet.  can't do what this was trying to do\n    // with regexps, actually; we want to identify strings with a leading\n    // capital letter, and any subsequent capital letters.  Have to compare\n    // locale caps version with existing version, character by character.\n    // hard stuff, but if it breaks, that's what to do.\n    // \\u0600-\\u06ff is Arabic/Persian\n    // \\u200c-\\u200e and \\u202a-\\u202e are special spaces and left-right \n    // control characters\n\n\n\n    NAME_INITIAL_REGEXP: /^([A-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0400-\\u042f\\u0590-\\u05d4\\u05d6-\\u05ff\\u0600-\\u06ff\\u0370\\u0372\\u0376\\u0386\\u0388-\\u03ab\\u03e2\\u03e4\\u03e6\\u03e8\\u03ea\\u03ec\\u03ee\\u03f4\\u03f7\\u03fd-\\u03ff])([a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0400-\\u052f\\u0600-\\u06ff\\u0370-\\u03ff\\u1f00-\\u1fff]*|)(\\.)*/,\n    ROMANESQUE_REGEXP: /[-0-9a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/,\n    ROMANESQUE_NOT_REGEXP: /[^a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/g,\n    STARTSWITH_ROMANESQUE_REGEXP: /^[&a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]/,\n    ENDSWITH_ROMANESQUE_REGEXP: /[.;:&a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]$/,\n    ALL_ROMANESQUE_REGEXP: /^[a-zA-Z\\u0e01-\\u0e5b\\u00c0-\\u017f\\u0370-\\u03ff\\u0400-\\u052f\\u0590-\\u05d4\\u05d6-\\u05ff\\u1f00-\\u1fff\\u0600-\\u06ff\\u200c\\u200d\\u200e\\u0218\\u0219\\u021a\\u021b\\u202a-\\u202e]+$/,\n\n    VIETNAMESE_SPECIALS: /[\\u00c0-\\u00c3\\u00c8-\\u00ca\\u00cc\\u00cd\\u00d2-\\u00d5\\u00d9\\u00da\\u00dd\\u00e0-\\u00e3\\u00e8-\\u00ea\\u00ec\\u00ed\\u00f2-\\u00f5\\u00f9\\u00fa\\u00fd\\u0101\\u0103\\u0110\\u0111\\u0128\\u0129\\u0168\\u0169\\u01a0\\u01a1\\u01af\\u01b0\\u1ea0-\\u1ef9]/,\n\n    VIETNAMESE_NAMES: /^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \\u00c0-\\u00c3\\u00c8-\\u00ca\\u00cc\\u00cd\\u00d2-\\u00d5\\u00d9\\u00da\\u00dd\\u00e0-\\u00e3\\u00e8-\\u00ea\\u00ec\\u00ed\\u00f2-\\u00f5\\u00f9\\u00fa\\u00fd\\u0101\\u0103\\u0110\\u0111\\u0128\\u0129\\u0168\\u0169\\u01a0\\u01a1\\u01af\\u01b0\\u1ea0-\\u1ef9]{2,6})(\\s+|$))+$/,\n\n    NOTE_FIELDS_REGEXP: /\\{:(?:[\\-_a-z]+|[A-Z]+):[^\\}]+\\}/g,\n    NOTE_FIELD_REGEXP: /^([\\-_a-z]+|[A-Z]+):\\s*([^\\}]+)$/,\n\n\tPARTICLE_GIVEN_REGEXP: /^([^ ]+(?:\\u02bb |\\u2019 | |\\' ) *)(.+)$/,\n\tPARTICLE_FAMILY_REGEXP: /^([^ ]+(?:\\-|\\u02bb|\\u2019| |\\') *)(.+)$/,\n\n    DISPLAY_CLASSES: [\"block\", \"left-margin\", \"right-inline\", \"indent\"],\n\n    NAME_VARIABLES: [\n        \"author\",\n        \"chair\",\n        \"collection-editor\",\n        \"compiler\",\n        \"composer\",\n        \"container-author\",\n        \"contributor\",\n        \"curator\",\n        \"director\",\n        \"editor\",\n        \"editor-translator\", \n        \"editorial-director\",\n        \"executive-producer\",\n        \"guest\",\n        \"host\",\n        \"illustrator\",\n        \"interviewer\",\n        \"narrator\", \n        \"organizer\",\n        \"original-author\",\n        \"performer\",\n        \"producer\",\n        \"recipient\",\n        \"reviewed-author\",\n        \"script-writer\",\n        \"series-creator\",\n        \"translator\",\n        \"commenter\"\n    ],\n    CREATORS: [\n        \"author\",\n        \"chair\",\n        \"collection-editor\",\n        \"compiler\",\n        \"composer\",\n        \"container-author\",\n        \"contributor\",\n        \"curator\",\n        \"director\",\n        \"editor\",\n        \"editor-translator\", \n        \"editorial-director\",\n        \"executive-producer\",\n        \"guest\",\n        \"host\",\n        \"illustrator\",\n        \"interviewer\",\n        \"narrator\", \n        \"organizer\",\n        \"original-author\",\n        \"performer\",\n        \"producer\",\n        \"recipient\",\n        \"reviewed-author\",\n        \"script-writer\",\n        \"series-creator\",\n        \"translator\",\n        \"commenter\"\n    ],\n    NUMERIC_VARIABLES: [\n        \"call-number\",\n        \"chapter-number\",\n        \"collection-number\",\n        \"division\",\n        \"edition\",\n        \"page\",\n        \"issue\",\n        \"locator\",\n        \"locator-extra\",\n        \"number\",\n        \"number-of-pages\",\n        \"number-of-volumes\",\n        \"part-number\",\n        \"printing-number\",\n        \"section\",\n        \"supplement-number\",\n        \"version\",\n        \"volume\",\n        \"supplement\", // maybe deprecated this? supplement-number should serve this purpose in standard CSL.\n        \"citation-number\"\n    ],\n    //var x = new Array();\n    //x = x.concat([\"title\",\"container-title\",\"issued\",\"page\"]);\n    //x = x.concat([\"locator\",\"collection-number\",\"original-date\"]);\n    //x = x.concat([\"reporting-date\",\"decision-date\",\"filing-date\"]);\n    //x = x.concat([\"revision-date\"]);\n    //NUMERIC_VARIABLES = x.slice();\n    DATE_VARIABLES: [\n        \"locator-date\", \n        \"issued\", \n        \"event-date\", \n        \"accessed\", \n        \"original-date\",\n        \"publication-date\",\n        \"available-date\",\n        \"submitted\",\n        \"alt-issued\",\n        \"alt-event\"\n    ],\n    VARIABLES_WITH_SHORT_FORM: [\n        \"title\",\n        \"container-title\"\n    ],\n    TITLE_FIELD_SPLITS: function(seg) {\n        var keys = [\"title\", \"short\", \"main\", \"sub\", \"subjoin\"];\n        var ret = {};\n        for (var i=0,ilen=keys.length;i<ilen;i++) {\n            ret[keys[i]] = seg + \"title\" + (keys[i] === \"title\" ? \"\" : \"-\" + keys[i]);\n        }\n        return ret;\n    },\n    \n    demoteNoiseWords: function (state, fld, drop_or_demote) {\n        var SKIP_WORDS = state.locale[state.opt.lang].opts[\"leading-noise-words\"];\n        if (fld && drop_or_demote) {\n            fld = fld.split(/\\s+/);\n            fld.reverse();\n            var toEnd = [];\n            for (var j  = fld.length - 1; j > -1; j += -1) {\n                if (SKIP_WORDS.indexOf(fld[j].toLowerCase()) > -1) {\n                    toEnd.push(fld.pop());\n                } else {\n                    break;\n                }\n            }\n            fld.reverse();\n            var start = fld.join(\" \");\n            var end = toEnd.join(\" \");\n            if (\"drop\" === drop_or_demote || !end) {\n                fld = start;\n            } else if (\"demote\" === drop_or_demote) {\n                fld = [start, end].join(\", \");\n            }\n        }\n        return fld;\n    },\n\n    extractTitleAndSubtitle: function (Item, narrowSpaceLocale) {\n        var narrowSpace = narrowSpaceLocale ? \"\\u202f\" : \"\";\n        // XXX In this function, split on split-char, but prefer exact match\n        // XXX of subtitle to a split-char in title if found.\n        var segments = [\"\"];\n        if (this.opt.development_extensions.split_container_title) {\n            segments.push(\"container-\");\n        }\n        for (var i=0,ilen=segments.length;i<ilen;i++) {\n            var seg = segments[i];\n            var title = CSL.TITLE_FIELD_SPLITS(seg);\n            var langs = [false];\n            if (Item.multi) {\n                for (var lang in Item.multi._keys[title.short]) {\n                    langs.push(lang);\n                }\n            }\n            for (var j=0,jlen=langs.length;j<jlen;j++) {\n                var lang = langs[j];\n                var vals = {};\n                if (lang) {\n                    if (Item.multi._keys[title.title]) {\n                        vals[title.title] = Item.multi._keys[title.title][lang];\n                    }\n                    if (Item.multi._keys[title[\"short\"]]) {\n                        vals[title[\"short\"]] = Item.multi._keys[title[\"short\"]][lang];\n                    }\n                } else {\n                    vals[title.title] = Item[title.title];\n                    vals[title[\"short\"]] = Item[title[\"short\"]];\n                }\n                vals[title.main] = vals[title.title];\n                vals[title.sub] = false;\n                var shortTitle = vals[title[\"short\"]];\n                if (vals[title.title]) {\n                    // Rules\n                    // TITLE_SPLIT eliminates split-points of period-space preceded by a capital letter.\n                    // If short title exists and matches exactly to a split-point, use that split-point only.\n                    // Otherwise if there is just one split-point, use that as main/sub split.\n                    // Otherwise use all split-points ... which is handled in titleCaseSentenceOrNormal, not here.\n                    if (shortTitle && shortTitle.toLowerCase() === vals[title.title].toLowerCase()) {\n                        vals[title.main] = vals[title.title];\n                        vals[title.subjoin] = \"\";\n                        vals[title.sub] = \"\";\n                    } else if (shortTitle) {\n                        // check for valid match to shortTitle\n                        var tail = vals[title.title].slice(shortTitle.replace(/[\\?\\!]+$/, \"\").length);\n                        var top = vals[title.title].replace(tail.replace(/^[\\?\\!]+/, \"\"), \"\").trim();\n                        var m = CSL.TITLE_SPLIT_REGEXP.matchfirst.exec(tail);\n                        if (m && top.toLowerCase() === shortTitle.toLowerCase()) {\n                            vals[title.main] = top;\n                            vals[title.subjoin] = m[1].replace(/[\\?\\!]+(\\s*)$/, \"$1\");\n                            vals[title.sub] = tail.replace(CSL.TITLE_SPLIT_REGEXP.matchfirst, \"\");\n                            if (this.opt.development_extensions.force_short_title_casing_alignment) {\n                                vals[title[\"short\"]] = vals[title.main];\n                            }\n                        } else {\n                            var splitTitle = CSL.TITLE_SPLIT(vals[title.title]);\n                            if (splitTitle.length == 3) {\n                                vals[title.main] = splitTitle[0];\n                                vals[title.subjoin] = splitTitle[1];\n                                vals[title.sub] = splitTitle[2];\n                            } else {\n                                vals[title.main] = vals[title.title];\n                                vals[title.subjoin] = \"\";\n                                vals[title.sub] = \"\";\n                            }\n                        }\n                    } else {\n                        var splitTitle = CSL.TITLE_SPLIT(vals[title.title]);\n                        if (splitTitle.length == 3) {\n                            vals[title.main] = splitTitle[0];\n                            vals[title.subjoin] = splitTitle[1];\n                            vals[title.sub] = splitTitle[2];\n                            if (this.opt.development_extensions.implicit_short_title && Item.type !== \"legal_case\") {\n                                if (!Item[title.short] && !vals[title.main].match(/^[\\-\\.[0-9]+$/)) {\n                                    var punct = vals[title.subjoin].trim();\n                                    if ([\"?\", \"!\"].indexOf(punct) === -1) {\n                                        punct = \"\";\n                                    }\n                                    vals[title.short] = vals[title.main] + punct;\n                                }\n                            }\n                        } else {\n                            vals[title.main] = vals[title.title];\n                            vals[title.subjoin] = \"\";\n                            vals[title.sub] = \"\";\n                        }\n                    }\n                    if (vals[title.subjoin]) {\n                        if (vals[title.subjoin].match(/([\\?\\!])/)) {\n                            var m = vals[title.subjoin].match(/(\\s*)$/)\n                            vals[title.main] = vals[title.main] + narrowSpace +vals[title.subjoin].trim();\n                            vals[title.subjoin] = m[1];\n                        }\n                    }\n                }\n                if (vals[title.subjoin]) {\n                    if (vals[title.subjoin].indexOf(\":\") > -1) {\n                        vals[title.subjoin] = narrowSpace + \": \";\n                    }\n                    if (vals[title.subjoin].indexOf(\"-\") > -1 || vals[title.subjoin].indexOf(\"\") > -1) {\n                        vals[title.subjoin] = \"\";\n                    }\n                }\n                if (lang) {\n                    for (var key in vals) {\n                        if (!Item.multi._keys[key]) {\n                            Item.multi._keys[key] = {};\n                        }\n                        Item.multi._keys[key][lang] = vals[key];\n                    }\n                } else {\n                    for (var key in vals) {\n                        Item[key] = vals[key];\n                    }\n                }\n            }\n        }\n    },\n\n    titlecaseSentenceOrNormal: function(state, Item, seg, lang, sentenceCase) {\n        // Hold on here.\n        // What is seg here?\n        // It's ... either \"\" or \"container-\". Which is ugly, but works.\n        // But this ALWAYS returns the full title, never short.\n        // So sentence-casing cannot be applied to short.\n        // Goes unnoticed because forced sentence-casing almost never appears in styles.\n        var title = CSL.TITLE_FIELD_SPLITS(seg);\n        var vals = {};\n        if (lang && Item.multi) {\n            if (Item.multi._keys[title.title]) {\n                vals[title.title] = Item.multi._keys[title.title][lang];\n            }\n            if (Item.multi._keys[title.main]) {\n                vals[title.main] = Item.multi._keys[title.main][lang];\n            }\n            if (Item.multi._keys[title.sub]) {\n                vals[title.sub] = Item.multi._keys[title.sub][lang];\n            }\n            if (Item.multi._keys[title.subjoin]) {\n                vals[title.subjoin] = Item.multi._keys[title.subjoin][lang];\n            }\n        } else {\n            vals[title.title] = Item[title.title];\n            vals[title.main] = Item[title.main];\n            vals[title.sub] = Item[title.sub];\n            vals[title.subjoin] = Item[title.subjoin];\n        }\n        if (vals[title.main] && vals[title.sub]) {\n            var mainTitle = vals[title.main];\n            var subJoin = vals[title.subjoin];\n            var subTitle = vals[title.sub];\n            if (sentenceCase) {\n                mainTitle = CSL.Output.Formatters.sentence(state, mainTitle);\n                subTitle = CSL.Output.Formatters.sentence(state, subTitle);\n            } else if (state.opt.development_extensions.uppercase_subtitles) {\n                subTitle = CSL.Output.Formatters[\"capitalize-first\"](state, subTitle);\n            }\n            return [mainTitle, subJoin, subTitle].join(\"\");\n        } else if (vals[title.title]) {\n            if (sentenceCase) {\n                return CSL.Output.Formatters.sentence(state, vals[title.title]);\n            } else if (state.opt.development_extensions.uppercase_subtitles) {\n                // Split and apply everywhere.\n                var splits = CSL.TITLE_SPLIT(vals[title.title]);\n                for (var i=0,ilen=splits.length; i<ilen; i += 2) {\n                    splits[i] = CSL.Output.Formatters[\"capitalize-first\"](state, splits[i]);\n                }\n                for (var i=1, ilen=splits.length-1; i < ilen; i += 2) {\n                    var m = splits[i].match(/([:\\?\\!] )/);\n                    if (m) {\n                        var narrowSpace = state.opt[\"default-locale\"][0].slice(0, 2).toLowerCase() === \"fr\" ? \"\\u202f\" : \"\";\n                        splits[i] = narrowSpace + m[1];\n                    }\n                    if (splits[i].indexOf(\"-\") > -1 || splits[i].indexOf(\"\") > -1) {\n                        splits[i] = \"\";\n                    }\n                }\n                vals[title.title] = splits.join(\"\");\n                return vals[title.title];\n            } else {\n                return vals[title.title];\n            }\n        } else {\n            return \"\";\n        }\n    },\n\n    getSafeEscape: function(state) {\n        if ([\"bibliography\", \"citation\"].indexOf(state.tmp.area) > -1) {\n            // Callback to apply thin space hack\n            // Callback to force LTR/RTL on parens and braces\n            // XXX Is this really necessary?\n            var callbacks = [];\n            if (state.opt.development_extensions.thin_non_breaking_space_html_hack && state.opt.mode === \"html\") {\n                callbacks.push(function (txt) {\n                    return txt.replace(/\\u202f/g, '<span style=\"white-space:nowrap\">&thinsp;</span>');\n                });\n            }\n            if (callbacks.length) {\n                return function (txt) {\n                    for (var i = 0, ilen = callbacks.length; i < ilen; i += 1) {\n                        txt = callbacks[i](txt);\n                    }\n                    return CSL.Output.Formats[state.opt.mode].text_escape(txt);\n                };\n            } else {\n                return CSL.Output.Formats[state.opt.mode].text_escape;\n            }\n        } else {\n            return function (txt) { return txt; };\n        }\n    },\n\n    SKIP_WORDS: [\"about\",\"above\",\"across\",\"afore\",\"after\",\"against\",\"al\", \"along\",\"alongside\",\"amid\",\"amidst\",\"among\",\"amongst\",\"anenst\",\"apropos\",\"apud\",\"around\",\"as\",\"aside\",\"astride\",\"at\",\"athwart\",\"atop\",\"barring\",\"before\",\"behind\",\"below\",\"beneath\",\"beside\",\"besides\",\"between\",\"beyond\",\"but\",\"by\",\"circa\",\"despite\",\"down\",\"during\",\"et\", \"except\",\"for\",\"forenenst\",\"from\",\"given\",\"in\",\"inside\",\"into\",\"lest\",\"like\",\"modulo\",\"near\",\"next\",\"notwithstanding\",\"of\",\"off\",\"on\",\"onto\",\"out\",\"over\",\"per\",\"plus\",\"pro\",\"qua\",\"sans\",\"since\",\"than\",\"through\",\" thru\",\"throughout\",\"thruout\",\"till\",\"to\",\"toward\",\"towards\",\"under\",\"underneath\",\"until\",\"unto\",\"up\",\"upon\",\"versus\",\"vs.\",\"v.\",\"vs\",\"v\",\"via\",\"vis--vis\",\"with\",\"within\",\"without\",\"according to\",\"ahead of\",\"apart from\",\"as for\",\"as of\",\"as per\",\"as regards\",\"aside from\",\"back to\",\"because of\",\"close to\",\"due to\",\"except for\",\"far from\",\"inside of\",\"instead of\",\"near to\",\"next to\",\"on to\",\"out from\",\"out of\",\"outside of\",\"prior to\",\"pursuant to\",\"rather than\",\"regardless of\",\"such as\",\"that of\",\"up to\",\"where as\",\"or\", \"yet\", \"so\", \"for\", \"and\", \"nor\", \"a\", \"an\", \"the\", \"de\", \"d'\", \"von\", \"van\", \"c\", \"ca\"],\n\n    FORMAT_KEY_SEQUENCE: [\n        \"@strip-periods\",\n        \"@font-style\",\n        \"@font-variant\",\n        \"@font-weight\",\n        \"@text-decoration\",\n        \"@vertical-align\",\n        \"@quotes\"\n    ],\n\n    INSTITUTION_KEYS: [\n        \"font-style\",\n        \"font-variant\",\n        \"font-weight\",\n        \"text-decoration\",\n        \"text-case\"\n    ],\n\n    SUFFIX_CHARS: \"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z\",\n    ROMAN_NUMERALS: [\n        [ \"\", \"i\", \"ii\", \"iii\", \"iv\", \"v\", \"vi\", \"vii\", \"viii\", \"ix\" ],\n        [ \"\", \"x\", \"xx\", \"xxx\", \"xl\", \"l\", \"lx\", \"lxx\", \"lxxx\", \"xc\" ],\n        [ \"\", \"c\", \"cc\", \"ccc\", \"cd\", \"d\", \"dc\", \"dcc\", \"dccc\", \"cm\" ],\n        [ \"\", \"m\", \"mm\", \"mmm\", \"mmmm\", \"mmmmm\"]\n    ],\n\n    LANGS: {\n        \"af-ZA\":\"Afrikaans\",\n        \"ar\":\"Arabic\",\n        \"bg-BG\":\"Bulgarian\",\n        \"ca-AD\":\"Catalan\",\n        \"cs-CZ\":\"Czech\",\n        \"da-DK\":\"Danish\",\n        \"de-AT\":\"Austrian\",\n        \"de-CH\":\"German (CH)\",\n        \"de-DE\":\"German (DE)\",\n        \"el-GR\":\"Greek\",\n        \"en-GB\":\"English (GB)\",\n        \"en-US\":\"English (US)\",\n        \"es-ES\":\"Spanish\",\n        \"et-EE\":\"Estonian\",\n        \"eu\":\"European\",\n        \"fa-IR\":\"Persian\",\n        \"fi-FI\":\"Finnish\",\n        \"fr-CA\":\"French (CA)\",\n        \"fr-FR\":\"French (FR)\",\n        \"he-IL\":\"Hebrew\",\n        \"hr-HR\":\"Croatian\",\n        \"hu-HU\":\"Hungarian\",\n        \"is-IS\":\"Icelandic\",\n        \"it-IT\":\"Italian\",\n        \"ja-JP\":\"Japanese\",\n        \"km-KH\":\"Khmer\",\n        \"ko-KR\":\"Korean\",\n        \"lt-LT\":\"Lithuanian\",\n        \"lv-LV\":\"Latvian\",\n        \"mn-MN\":\"Mongolian\",\n        \"nb-NO\":\"Norwegian (Bokml)\",\n        \"nl-NL\":\"Dutch\",\n        \"nn-NO\":\"Norwegian (Nynorsk)\",\n        \"pl-PL\":\"Polish\",\n        \"pt-BR\":\"Portuguese (BR)\",\n        \"pt-PT\":\"Portuguese (PT)\",\n        \"ro-RO\":\"Romanian\",\n        \"ru-RU\":\"Russian\",\n        \"sk-SK\":\"Slovak\",\n        \"sl-SI\":\"Slovenian\",\n        \"sr-RS\":\"Serbian\",\n        \"sv-SE\":\"Swedish\",\n        \"th-TH\":\"Thai\",\n        \"tr-TR\":\"Turkish\",\n        \"uk-UA\":\"Ukrainian\",\n        \"vi-VN\":\"Vietnamese\",\n        \"zh-CN\":\"Chinese (CN)\",\n        \"zh-TW\":\"Chinese (TW)\"\n    },\n\n    LANG_BASES: {\n        af: \"af_ZA\",\n        ar: \"ar\",\n        bg: \"bg_BG\",\n        ca: \"ca_AD\",\n        cs: \"cs_CZ\",\n        da: \"da_DK\",\n        de: \"de_DE\",\n        el: \"el_GR\",\n        en: \"en_US\",\n        es: \"es_ES\",\n        et: \"et_EE\",\n        eu: \"eu\",\n        fa: \"fa_IR\",\n        fi: \"fi_FI\",\n        fr: \"fr_FR\",\n        he: \"he_IL\",\n        hr: \"hr-HR\",\n        hu: \"hu_HU\",\n        is: \"is_IS\",\n        it: \"it_IT\",\n        ja: \"ja_JP\",\n        km: \"km_KH\",\n        ko: \"ko_KR\",\n        lt: \"lt_LT\",\n        lv: \"lv-LV\",\n        mn: \"mn_MN\",\n        nb: \"nb_NO\",\n        nl: \"nl_NL\",\n        nn: \"nn-NO\",\n        pl: \"pl_PL\",\n        pt: \"pt_PT\",\n        ro: \"ro_RO\",\n        ru: \"ru_RU\",\n        sk: \"sk_SK\",\n        sl: \"sl_SI\",\n        sr: \"sr_RS\",\n        sv: \"sv_SE\",\n        th: \"th_TH\",\n        tr: \"tr_TR\",\n        uk: \"uk_UA\",\n        vi: \"vi_VN\",\n        zh: \"zh_CN\"\n    },\n\n    SUPERSCRIPTS: {\n        \"\\u00AA\": \"\\u0061\",\n        \"\\u00B2\": \"\\u0032\",\n        \"\\u00B3\": \"\\u0033\",\n        \"\\u00B9\": \"\\u0031\",\n        \"\\u00BA\": \"\\u006F\",\n        \"\\u02B0\": \"\\u0068\",\n        \"\\u02B1\": \"\\u0266\",\n        \"\\u02B2\": \"\\u006A\",\n        \"\\u02B3\": \"\\u0072\",\n        \"\\u02B4\": \"\\u0279\",\n        \"\\u02B5\": \"\\u027B\",\n        \"\\u02B6\": \"\\u0281\",\n        \"\\u02B7\": \"\\u0077\",\n        \"\\u02B8\": \"\\u0079\",\n        \"\\u02E0\": \"\\u0263\",\n        \"\\u02E1\": \"\\u006C\",\n        \"\\u02E2\": \"\\u0073\",\n        \"\\u02E3\": \"\\u0078\",\n        \"\\u02E4\": \"\\u0295\",\n        \"\\u1D2C\": \"\\u0041\",\n        \"\\u1D2D\": \"\\u00C6\",\n        \"\\u1D2E\": \"\\u0042\",\n        \"\\u1D30\": \"\\u0044\",\n        \"\\u1D31\": \"\\u0045\",\n        \"\\u1D32\": \"\\u018E\",\n        \"\\u1D33\": \"\\u0047\",\n        \"\\u1D34\": \"\\u0048\",\n        \"\\u1D35\": \"\\u0049\",\n        \"\\u1D36\": \"\\u004A\",\n        \"\\u1D37\": \"\\u004B\",\n        \"\\u1D38\": \"\\u004C\",\n        \"\\u1D39\": \"\\u004D\",\n        \"\\u1D3A\": \"\\u004E\",\n        \"\\u1D3C\": \"\\u004F\",\n        \"\\u1D3D\": \"\\u0222\",\n        \"\\u1D3E\": \"\\u0050\",\n        \"\\u1D3F\": \"\\u0052\",\n        \"\\u1D40\": \"\\u0054\",\n        \"\\u1D41\": \"\\u0055\",\n        \"\\u1D42\": \"\\u0057\",\n        \"\\u1D43\": \"\\u0061\",\n        \"\\u1D44\": \"\\u0250\",\n        \"\\u1D45\": \"\\u0251\",\n        \"\\u1D46\": \"\\u1D02\",\n        \"\\u1D47\": \"\\u0062\",\n        \"\\u1D48\": \"\\u0064\",\n        \"\\u1D49\": \"\\u0065\",\n        \"\\u1D4A\": \"\\u0259\",\n        \"\\u1D4B\": \"\\u025B\",\n        \"\\u1D4C\": \"\\u025C\",\n        \"\\u1D4D\": \"\\u0067\",\n        \"\\u1D4F\": \"\\u006B\",\n        \"\\u1D50\": \"\\u006D\",\n        \"\\u1D51\": \"\\u014B\",\n        \"\\u1D52\": \"\\u006F\",\n        \"\\u1D53\": \"\\u0254\",\n        \"\\u1D54\": \"\\u1D16\",\n        \"\\u1D55\": \"\\u1D17\",\n        \"\\u1D56\": \"\\u0070\",\n        \"\\u1D57\": \"\\u0074\",\n        \"\\u1D58\": \"\\u0075\",\n        \"\\u1D59\": \"\\u1D1D\",\n        \"\\u1D5A\": \"\\u026F\",\n        \"\\u1D5B\": \"\\u0076\",\n        \"\\u1D5C\": \"\\u1D25\",\n        \"\\u1D5D\": \"\\u03B2\",\n        \"\\u1D5E\": \"\\u03B3\",\n        \"\\u1D5F\": \"\\u03B4\",\n        \"\\u1D60\": \"\\u03C6\",\n        \"\\u1D61\": \"\\u03C7\",\n        \"\\u2070\": \"\\u0030\",\n        \"\\u2071\": \"\\u0069\",\n        \"\\u2074\": \"\\u0034\",\n        \"\\u2075\": \"\\u0035\",\n        \"\\u2076\": \"\\u0036\",\n        \"\\u2077\": \"\\u0037\",\n        \"\\u2078\": \"\\u0038\",\n        \"\\u2079\": \"\\u0039\",\n        \"\\u207A\": \"\\u002B\",\n        \"\\u207B\": \"\\u2212\",\n        \"\\u207C\": \"\\u003D\",\n        \"\\u207D\": \"\\u0028\",\n        \"\\u207E\": \"\\u0029\",\n        \"\\u207F\": \"\\u006E\",\n        \"\\u2120\": \"\\u0053\\u004D\",\n        \"\\u2122\": \"\\u0054\\u004D\",\n        \"\\u3192\": \"\\u4E00\",\n        \"\\u3193\": \"\\u4E8C\",\n        \"\\u3194\": \"\\u4E09\",\n        \"\\u3195\": \"\\u56DB\",\n        \"\\u3196\": \"\\u4E0A\",\n        \"\\u3197\": \"\\u4E2D\",\n        \"\\u3198\": \"\\u4E0B\",\n        \"\\u3199\": \"\\u7532\",\n        \"\\u319A\": \"\\u4E59\",\n        \"\\u319B\": \"\\u4E19\",\n        \"\\u319C\": \"\\u4E01\",\n        \"\\u319D\": \"\\u5929\",\n        \"\\u319E\": \"\\u5730\",\n        \"\\u319F\": \"\\u4EBA\",\n        \"\\u02C0\": \"\\u0294\",\n        \"\\u02C1\": \"\\u0295\",\n        \"\\u06E5\": \"\\u0648\",\n        \"\\u06E6\": \"\\u064A\"\n    },\n    SUPERSCRIPTS_REGEXP: new RegExp(\"[\\u00AA\\u00B2\\u00B3\\u00B9\\u00BA\\u02B0\\u02B1\\u02B2\\u02B3\\u02B4\\u02B5\\u02B6\\u02B7\\u02B8\\u02E0\\u02E1\\u02E2\\u02E3\\u02E4\\u1D2C\\u1D2D\\u1D2E\\u1D30\\u1D31\\u1D32\\u1D33\\u1D34\\u1D35\\u1D36\\u1D37\\u1D38\\u1D39\\u1D3A\\u1D3C\\u1D3D\\u1D3E\\u1D3F\\u1D40\\u1D41\\u1D42\\u1D43\\u1D44\\u1D45\\u1D46\\u1D47\\u1D48\\u1D49\\u1D4A\\u1D4B\\u1D4C\\u1D4D\\u1D4F\\u1D50\\u1D51\\u1D52\\u1D53\\u1D54\\u1D55\\u1D56\\u1D57\\u1D58\\u1D59\\u1D5A\\u1D5B\\u1D5C\\u1D5D\\u1D5E\\u1D5F\\u1D60\\u1D61\\u2070\\u2071\\u2074\\u2075\\u2076\\u2077\\u2078\\u2079\\u207A\\u207B\\u207C\\u207D\\u207E\\u207F\\u2120\\u2122\\u3192\\u3193\\u3194\\u3195\\u3196\\u3197\\u3198\\u3199\\u319A\\u319B\\u319C\\u319D\\u319E\\u319F\\u02C0\\u02C1\\u06E5\\u06E6]\", \"g\"),\n\n    // I think we need to have separate args for prefix and term,\n    // since they have different effects between comma-safe and comma-safe-numbers-only.\n    // Either that, or -- oh, we could just bang the two together for the test where\n    // necessary.\n    \n    UPDATE_GROUP_CONTEXT_CONDITION: function (state, str, valueTerm, token, value) {\n        if (!state.opt.use_context_condition) return;\n        var flags = state.tmp.group_context.tip;\n        if (flags.condition) {\n            if (!flags.condition.termtxt) {\n                flags.condition.termtxt = str;\n                flags.condition.valueTerm = valueTerm;\n            }\n            if (!flags.value_seen && flags.condition.test === \"comma-safe-numbers-only\") {\n                if (value) {\n                    flags.value_seen = true;\n                    if (!value.match(/^[0-9]/)) {\n                        state.tmp.just_did_number = false;\n                    }\n                }\n            }\n        } else {\n            // If not inside a conditional group, raise numeric flag\n            // if and only if the current term string ends in a number.\n            if (token && token.decorations.filter(o => o[0] === \"@vertical-align\").length > 0) {\n                state.tmp.just_did_number = false;\n            } else if (token && token.strings.suffix) {\n                state.tmp.just_did_number = false;\n            } else if (str) {\n                if (str.match(/[0-9]$/)) {\n                    state.tmp.just_did_number = true;\n                } else {\n                    state.tmp.just_did_number = false;\n                }\n            }\n        }\n    },\n\n    EVALUATE_GROUP_CONDITION: function(state, flags) {\n        if (!state.opt.use_context_condition) return;\n        var testres;\n        var numbersOnly = flags.condition.test === \"comma-safe-numbers-only\";\n        if (flags.condition.test === \"empty-label\") {\n            testres = !flags.condition.termtxt;\n        } else if (flags.condition.test === \"empty-label-no-decor\") {\n            testres = !flags.condition.termtxt || flags.condition.termtxt.indexOf(\"%s\") > -1;\n        } else if ([\"comma-safe\", \"comma-safe-numbers-only\"].indexOf(flags.condition.test) > -1) {\n            var locale_term = flags.condition.termtxt;\n            var termStartAlpha = false;\n            if (flags.condition.termtxt) {\n                termStartAlpha = flags.condition.termtxt.slice(0,1).match(CSL.ALL_ROMANESQUE_REGEXP);\n            }\n            var num = state.tmp.just_did_number;\n            if (num) {\n                if (flags.condition.valueTerm) {\n                    testres = numbersOnly ? false : true;\n                } else if (!locale_term) {\n                    testres = true;\n                } else if (termStartAlpha) {\n                    testres = numbersOnly ? false : true;\n                } else if ([\"always\", \"after-number\"].indexOf(state.opt.require_comma_on_symbol) > -1) {\n                    testres = true;\n                } else {\n                    testres = false;\n                }\n            } else {\n                if (flags.condition.valueTerm) {\n                    testres = false;\n                } else if (!locale_term) {\n                    testres = false;\n                } else if (termStartAlpha) {\n                    testres = numbersOnly ? false : true;\n                } else if (state.opt.require_comma_on_symbol === \"always\") {\n                    testres = true;\n                } else {\n                    testres = false;\n                }\n            }\n        }\n        if (testres) {\n            var force_suppress = false;\n        } else {\n            var force_suppress = true;\n        }\n        if (flags.condition.not) {\n            force_suppress = !force_suppress;\n        }\n        return force_suppress;\n    },\n    \n    SYS_OPTIONS: [\n        \"prioritize_disambiguate_condition\",\n        \"csl_reverse_lookup_support\",\n        \"main_title_from_short_title\",\n        \"uppercase_subtitles\",\n        \"force_short_title_casing_alignment\",\n        \"implicit_short_title\",\n        \"split_container_title\"\n    ],\n\n    TITLE_SPLIT_REGEXP: (function() {\n        var splits = [\n            \"\\\\.\\\\s+\",\n            \"\\\\!\\\\s+\",\n            \"\\\\?\\\\s+\",\n            \"\\\\s*::*\\\\s+\",\n            \"\\\\s*\\\\s*\",\n            \"\\\\s+\\\\-\\\\s+\",\n            \"\\\\s*\\\\-\\\\-\\\\-*\\\\s*\"\n        ]\n        return {\n            match: new RegExp(\"(\" + splits.join(\"|\") + \")\", \"g\"),\n            matchfirst: new RegExp(\"^(\" + splits.join(\"|\") + \")\"),\n            split: new RegExp(\"(?:\" + splits.join(\"|\") + \")\")\n        }\n    })(),\n\n    TITLE_SPLIT: function(str) {\n        if (!str) {\n            return str;\n        }\n        var m = str.match(CSL.TITLE_SPLIT_REGEXP.match);\n        var lst = str.split(CSL.TITLE_SPLIT_REGEXP.split);\n        for (var i=lst.length-2; i>-1; i--) {\n            lst[i] = lst[i].trim();\n            if (lst[i] && lst[i].slice(-1).toLowerCase() !== lst[i].slice(-1)) {\n                // recombine\n                lst[i] = lst[i] + m[i] + lst[i+1];\n                lst = lst.slice(0, i+1).concat(lst.slice(i+2))\n            } else {\n                // merge\n                lst = lst.slice(0, i+1).concat([m[i]]).concat(lst.slice(i+1))\n            }\n        }\n        return lst;\n    },\n    \n    GET_COURT_CLASS: function(state, Item, sortKey){\n        // Get authority as a string\n        var cls = \"\";\n        var authority = null;\n        var country = Item.jurisdiction ? Item.jurisdiction.split(\":\")[0] : null;\n        // inStyle versus in module\n        var classType = \"court_condition_classes\";\n        if (sortKey) {\n            classType = \"court_key_classes\";\n        }\n        if (country && Item.authority) {\n            if (\"string\" === typeof Item.authority) {\n                authority = Item.authority;\n            } else {\n                if (Item.authority[0] && Item.authority[0].literal) {\n                    authority = Item.authority[0].literal;\n                }\n            }\n        }\n        if (authority) {\n            if (this.lang && state.locale[this.lang].opts[classType] && state.locale[this.lang].opts[classType][country] && state.locale[this.lang].opts[classType][country][authority]) {\n                cls = state.locale[this.lang].opts[classType][country][authority];\n            } else if (state.locale[state.opt[\"default-locale\"][0]].opts[classType] && state.locale[state.opt[\"default-locale\"][0]].opts[classType][country] && state.locale[state.opt[\"default-locale\"][0]].opts[classType][country][authority]) {\n                cls = state.locale[state.opt[\"default-locale\"][0]].opts[classType][country][authority]\n            }\n        }\n        return cls;\n    },\n\n    SET_COURT_CLASSES: function(state, lang, myxml, dataObj) {\n        var nodes = myxml.getNodesByName(dataObj, 'court-class');\n        for (var pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n            var courtclass = nodes[pos];\n            var attributes = myxml.attributes(courtclass);\n            var cls = attributes[\"@name\"];\n            var country = attributes[\"@country\"];\n            var courts = attributes[\"@courts\"];\n            \n            // Okay, this is a hack.\n            // If state.registry IS NOT yet defined, this is an in-style declaration.\n            // If state.registry IS defined, this is an in-module declaration.\n            var classType = \"court_key_classes\";\n            if (state.registry) {\n                classType = \"court_condition_classes\";\n            }\n            \n            if (cls && country && courts) {\n                courts = courts.trim().split(/\\s+/);\n                if (!state.locale[lang].opts[classType]) {\n                    state.locale[lang].opts[classType] = {};\n                }\n                if (!state.locale[lang].opts[classType][country]) {\n                    state.locale[lang].opts[classType][country] = {};\n                }\n                for (var i=0,ilen=courts.length;i<ilen;i++) {\n                    state.locale[lang].opts[classType][country][courts[i]] = cls;\n                }\n            }\n        }\n    },\n\n    INIT_JURISDICTION_MACROS: function (state, Item, item, macroName) {\n        if (Item[\"best-jurisdiction\"]) {\n            return true;\n        }\n        if (!state.sys.retrieveStyleModule || !CSL.MODULE_MACROS[macroName] || !Item.jurisdiction) {\n            return false;\n        }\n        var jurisdictionList = state.getJurisdictionList(Item.jurisdiction);\n        // Set up a list of jurisdictions here, we will reuse it\n        if (!state.opt.jurisdictions_seen[jurisdictionList[0]]) {\n            var res = state.retrieveAllStyleModules(jurisdictionList);\n            // Okay. We have code for each of the novel modules in the\n            // hierarchy. Load them all into the processor.\n            for (var jurisdiction in res) {\n                var fallback = state.loadStyleModule(jurisdiction, res[jurisdiction]);\n                if (fallback) {\n                    if (!res[fallback]) {\n                        Object.assign(res, state.retrieveAllStyleModules([fallback]));\n                        state.loadStyleModule(fallback, res[fallback], true);\n                    }\n                }\n            }\n        }\n        if (state.opt.parallel.enable) {\n            if (!state.parallel) {\n                state.parallel = new CSL.Parallel(state);\n            }\n        }\n        // Identify the best jurisdiction for the item and return true, otherwise return false\n        for (var i=0,ilen=jurisdictionList.length;i<ilen;i++) {\n            var jurisdiction = jurisdictionList[i];\n            if (item) {\n                if (state.juris[jurisdiction] && !item[\"best-jurisdiction\"] && state.juris[jurisdiction].types.locator) {\n                    Item[\"best-jurisdiction\"] = jurisdiction;\n                }\n            }\n            if(state.juris[jurisdiction] && state.juris[jurisdiction].types[Item.type]) {\n                Item[\"best-jurisdiction\"] = jurisdiction;\n                return true;\n            }\n        }\n        return false;\n    }\n};\n\n/**\n * Functions for parsing an XML object converted to JSON.\n */\n\n/*\n  Style and locale JSON should be formatted as follows. Note that\n  an empty literal should be set as an explicit empty strings within\n  children:[]\n  \n  {\n    name:\"term\",\n    children:[\n      \"\"\n    ],\n    attrs:{\n      name:\"author\"\n    }\n  }\n\n  The following script will generate correctly formatted JSON\n  from a CSL style or locale file:\n*/\n\nCSL.XmlJSON = function (dataObj) {\n    this.dataObj = dataObj;\n    this.institution = {\n        name:\"institution\",\n        attrs:{\n            \"institution-parts\":\"long\",\n            \"delimiter\":\", \"\n        },\n        children:[\n            {\n                name:\"institution-part\",\n                attrs:{\n                    name:\"long\"\n                },\n                children:[]\n            }\n        ]\n    };\n};\n\n/**\n * No need for cleaning with native JSON.\n */\nCSL.XmlJSON.prototype.clean = function (json) {\n    return json;\n};\n\n\n/**\n * Methods to call on a node.\n */\nCSL.XmlJSON.prototype.getStyleId = function (myjson, styleName) {\n    var tagName = 'id';\n    if (styleName) {\n        tagName = 'title';\n    }\n    var ret = \"\";\n    var children = myjson.children;\n    for (var i=0,ilen=children.length;i<ilen;i++) {\n        if (children[i].name === 'info') {\n            var grandkids = children[i].children;\n            for (var j=0,jlen=grandkids.length;j<jlen;j++) {\n                if (grandkids[j].name === tagName) {\n                    ret = grandkids[j].children[0];\n                }\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.XmlJSON.prototype.children = function (myjson) {\n    //print(\"children()\");\n    if (myjson && myjson.children.length) {\n        return myjson.children.slice();\n    } else {\n        return false;\n    }\n};\n\nCSL.XmlJSON.prototype.nodename = function (myjson) {\n    //print(\"nodename()\");\n    return myjson ? myjson.name : null;\n};\n\nCSL.XmlJSON.prototype.attributes = function (myjson) {\n    //print(\"attributes()\");\n    var ret = {};\n    for (var attrname in myjson.attrs) {\n        ret[\"@\"+attrname] = myjson.attrs[attrname];\n    }\n    return ret;\n};\n\n\nCSL.XmlJSON.prototype.content = function (myjson) {\n    //print(\"content()\");\n    // xmldom.js and xmle4x.js have \"undefined\" as default\n    var ret = \"\";\n    // This only catches content at first level, but that is good enough\n    // for us.\n    if (!myjson || !myjson.children) {\n        return ret;\n    }\n    for (var i=0, ilen=myjson.children.length; i < ilen; i += 1) {\n        if (\"string\" === typeof myjson.children[i]) {\n            ret += myjson.children[i];\n        }\n    }\n    return ret;\n};\n\n\nCSL.XmlJSON.prototype.namespace = {}\n\nCSL.XmlJSON.prototype.numberofnodes = function (myjson) {\n    //print(\"numberofnodes()\");\n    if (myjson && \"number\" == typeof myjson.length) {\n        return myjson.length;\n    } else {\n        return 0;\n    }\n};\n\n// getAttributeName() removed. Looks like it was not being used.\n\nCSL.XmlJSON.prototype.getAttributeValue = function (myjson,name,namespace) {\n    //print(\"getAttributeValue()\");\n    var ret = \"\";\n    if (namespace) {\n        name = namespace+\":\"+name;\n    }\n    if (myjson) {\n        if (myjson.attrs) {\n            if (myjson.attrs[name]) {\n                ret = myjson.attrs[name];\n            } else {\n                ret = \"\";\n            }\n        }\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.getNodeValue = function (myjson,name) {\n    //print(\"getNodeValue()\");\n    var ret = \"\";\n    if (name){\n        for (var i=0, ilen=myjson.children.length; i < ilen; i += 1) {\n            if (myjson.children[i].name === name) {\n                // This will always be Object() unless empty\n                if (myjson.children[i].children.length) {\n                    ret = myjson.children[i];\n                } else {\n                    ret = \"\";\n                }\n            }\n        }\n    } else if (myjson) {\n        ret = myjson;\n    }\n    // Just being careful here, following the former DOM code. The JSON object we receive \n    // for this should be fully normalized.\n    if (ret && ret.children && ret.children.length == 1 && \"string\" === typeof ret.children[0]) {\n        ret = ret.children[0];\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.setAttributeOnNodeIdentifiedByNameAttribute = function (myjson,nodename,partname,attrname,val) {\n    //print(\"setAttributeOnNodeIdentifiedByNameAttribute()\");\n    var pos, len, xml, nodes, node;\n    if (attrname.slice(0,1) === '@'){\n        attrname = attrname.slice(1);\n    }\n    // In the one place this is used in citeproc-js code, it doesn't need to recurse.\n    for (var i=0,ilen=myjson.children.length; i<ilen; i += 1) {\n        if (myjson.children[i].name === nodename && myjson.children[i].attrs.name === partname) {\n            myjson.children[i].attrs[attrname] = val;\n        }\n    }\n}\n\nCSL.XmlJSON.prototype.deleteNodeByNameAttribute = function (myjson,val) {\n    //print(\"deleteNodeByNameAttribute()\");\n    var i, ilen;\n    for (i = 0, ilen = myjson.children.length; i < ilen; i += 1) {\n        if (!myjson.children[i] || \"string\" === typeof myjson.children[i]) {\n            continue;\n        }\n        if (myjson.children[i].attrs.name == val) {\n            myjson.children = myjson.children.slice(0,i).concat(myjson.children.slice(i+1));\n        }\n    }\n}\n\nCSL.XmlJSON.prototype.deleteAttribute = function (myjson,attrname) {\n    //print(\"deleteAttribute()\");\n    var i, ilen;\n    if (\"undefined\" !== typeof myjson.attrs[attrname]) {\n        myjson.attrs.pop(attrname);\n    }\n}\n\nCSL.XmlJSON.prototype.setAttribute = function (myjson,attr,val) {\n    //print(\"setAttribute()\");\n    myjson.attrs[attr] = val;\n    return false;\n}\n\nCSL.XmlJSON.prototype.nodeCopy = function (myjson,clone) {\n    //print(\"nodeCopy()\");\n    if (!clone) {\n        var clone = {};\n    }\n    if (\"object\" === typeof clone && \"undefined\" === typeof clone.length) {\n        // myjson is an object\n        for (var key in myjson) {\n            if (\"string\" === typeof myjson[key]) {\n                clone[key] = myjson[key];\n            } else if (\"object\" === typeof myjson[key]) {\n                if (\"undefined\" === typeof myjson[key].length) {\n                    clone[key] = this.nodeCopy(myjson[key],{});\n                } else {\n                    clone[key] = this.nodeCopy(myjson[key],[]);\n                }\n            }\n        }\n    } else {\n        // myjson is an array\n        for (var i=0,ilen=myjson.length;i<ilen; i += 1) {\n            if (\"string\" === typeof myjson[i]) {\n                clone[i] = myjson[i];\n            } else {\n                // If it's at the first level of an array, it's an object.\n                clone[i] = this.nodeCopy(myjson[i],{});\n            }\n        }\n    }\n    return clone;\n}\n\nCSL.XmlJSON.prototype.getNodesByName = function (myjson,name,nameattrval,ret) {\n    //print(\"getNodesByName()\");\n    var nodes, node, pos, len;\n    if (!ret) {\n        var ret = [];\n    }\n    if (!myjson || !myjson.children) {\n        return ret;\n    }\n    if (name === myjson.name) {\n        if (nameattrval) {\n            if (nameattrval === myjson.attrs.name) {\n                ret.push(myjson);\n            }\n        } else {\n            ret.push(myjson);\n        }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1){\n        if (\"object\" !== typeof myjson.children[i]) {\n            continue;\n        }\n        this.getNodesByName(myjson.children[i],name,nameattrval,ret);\n    }\n    return ret;\n}\n\nCSL.XmlJSON.prototype.nodeNameIs = function (myjson,name) {\n    //print(\"nodeNameIs()\");\n    if (typeof myjson === \"undefined\") {\n        return false;\n    }\n    if (name == myjson.name) {\n        return true;\n    }\n    return false;\n}\n\nCSL.XmlJSON.prototype.makeXml = function (myjson) {\n    //print(\"makeXml()\");\n    if (\"string\" === typeof myjson) {\n        if (myjson.slice(0, 1) === \"<\") {\n            myjson = this.jsonStringWalker.walkToObject(myjson);\n        } else {\n            myjson = JSON.parse(myjson);\n        }\n    }\n    return myjson;\n};\n\nCSL.XmlJSON.prototype.insertChildNodeAfter = function (parent,node,pos,datejson) {\n    //print(\"insertChildNodeAfter()\");\n    // Function is misnamed: this replaces the node\n    for (var i=0,ilen=parent.children.length;i<ilen;i+=1) {\n        if (node === parent.children[i]) {\n            parent.children = parent.children.slice(0,i).concat([datejson]).concat(parent.children.slice(i+1));\n            break;\n        }\n    }\n    return parent;\n};\n\n\nCSL.XmlJSON.prototype.insertPublisherAndPlace = function(myjson) {\n    if (myjson.name === \"group\") {\n        var useme = true;\n        var mustHaves = [\"publisher\",\"publisher-place\"];\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            var haveVarname = mustHaves.indexOf(myjson.children[i].attrs.variable);\n            var isText = myjson.children[i].name === \"text\";\n            if (isText && haveVarname > -1 && !myjson.children[i].attrs.prefix && !myjson.children[i].attrs.suffix) {\n                mustHaves = mustHaves.slice(0,haveVarname).concat(mustHaves.slice(haveVarname+1));\n            } else {\n                useme = false;\n                break;\n            }\n        }\n        if (useme && !mustHaves.length) {\n            myjson.attrs[\"has-publisher-and-publisher-place\"] = true;\n       }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"object\" === typeof myjson.children[i]) {\n            this.insertPublisherAndPlace(myjson.children[i]);\n        }\n    }    \n}\n/*\nCSL.XmlJSON.prototype.insertPublisherAndPlace = function(myxml) {\n    var group = myxml.getElementsByTagName(\"group\");\n    for (var i = 0, ilen = group.length; i < ilen; i += 1) {\n        var node = group.item(i);\n        var skippers = [];\n        for (var j = 0, jlen = node.childNodes.length; j < jlen; j += 1) {\n            if (node.childNodes.item(j).nodeType !== 1) {\n                skippers.push(j);\n            }\n        }\n        if (node.childNodes.length - skippers.length === 2) {\n            var twovars = [];\n            for (var j = 0, jlen = 2; j < jlen; j += 1) {\n                if (skippers.indexOf(j) > -1) {\n                    continue;\n                }\n                var child = node.childNodes.item(j);                    \n                var subskippers = [];\n                for (var k = 0, klen = child.childNodes.length; k < klen; k += 1) {\n                    if (child.childNodes.item(k).nodeType !== 1) {\n                        subskippers.push(k);\n                    }\n                }\n                if (child.childNodes.length - subskippers.length === 0) {\n                    twovars.push(child.getAttribute('variable'));\n                    if (child.getAttribute('suffix')\n                        || child.getAttribute('prefix')) {\n                        twovars = [];\n                        break;\n                    }\n                }\n            }\n            if (twovars.indexOf(\"publisher\") > -1 && twovars.indexOf(\"publisher-place\") > -1) {\n                node.setAttribute('has-publisher-and-publisher-place', true);\n            }\n        }\n    }\n};\n*/\n\nCSL.XmlJSON.prototype.isChildOfSubstitute = function(parents) {\n    if (parents.length > 0) {\n        var myparents = parents.slice();\n        var parent = myparents.pop();\n        if (parent === \"substitute\") {\n            return true;\n        } else {\n            return this.isChildOfSubstitute(myparents);\n        }\n    }\n    return false;\n};\n\nCSL.XmlJSON.prototype.addMissingNameNodes = function(myjson,parents) {\n    if (!parents) {\n        parents = [];\n    }\n    if (myjson.name === \"names\") {\n        // Trawl through children to decide whether a name node is needed here\n        if (!this.isChildOfSubstitute(parents)) {\n            var addName = true;\n            for (var i=0,ilen=myjson.children.length;i<ilen;i++) {\n                if (myjson.children[i].name === \"name\") {\n                    addName = false;\n                    break;\n                }\n            }\n            if (addName) {\n                myjson.children = [{name:\"name\",attrs:{},children:[]}].concat(myjson.children);\n            }\n        }\n    }\n    parents.push(myjson.name);\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"object\" === typeof myjson.children[i]) {\n            this.addMissingNameNodes(myjson.children[i],parents);\n        }\n    }\n    parents.pop();\n}\n\n\nCSL.XmlJSON.prototype.addInstitutionNodes = function(myjson) {\n    //print(\"addInstitutionNodes()\");\n    var names, thenames, institution, theinstitution, name, thename, xml, pos, len;\n    // The idea here is to map relevant attributes from name and nampart=family\n    // to the \"long\" institution-part node, when and only when forcing insert\n    // of the default node.\n    if (myjson.name === \"names\") {\n        // do stuff\n        var attributes = {};\n        var insertPos = -1;\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            if (myjson.children[i].name == \"name\") {\n                for (var key in myjson.children[i].attrs) {\n                    attributes[key] = myjson.children[i].attrs[key];\n                }\n                attributes.delimiter = myjson.children[i].attrs.delimiter;\n                attributes.and = myjson.children[i].attrs.and;\n                insertPos = i;\n                for (var k=0,klen=myjson.children[i].children.length;k<klen;k+=1) {\n                    if (myjson.children[i].children[k].attrs.name !== 'family') {\n                        continue;\n                    }\n                    for (var key in myjson.children[i].children[k].attrs) {\n                        attributes[key] = myjson.children[i].children[k].attrs[key];\n                    }\n                }\n            }\n            if (myjson.children[i].name == \"institution\") {\n                insertPos = -1;\n                break;\n            }\n        }\n        if (insertPos > -1) {\n            var institution = this.nodeCopy(this.institution);\n            for (var i=0,ilen = CSL.INSTITUTION_KEYS.length;i<ilen;i+=1) {\n                var attrname = CSL.INSTITUTION_KEYS[i];\n                if (\"undefined\" !== typeof attributes[attrname]) {\n                    institution.children[0].attrs[attrname] = attributes[attrname];\n                }\n                if (attributes.delimiter) {\n                    institution.attrs.delimiter = attributes.delimiter;\n                }\n                if (attributes.and) {\n                    institution.attrs.and = attributes.and;\n                }\n            }\n            myjson.children = myjson.children.slice(0,insertPos+1).concat([institution]).concat(myjson.children.slice(insertPos+1));\n        }\n    }\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (\"string\" === typeof myjson.children[i]) {\n            continue;\n        }\n        // Recurse\n        this.addInstitutionNodes(myjson.children[i]);\n    }\n}\nCSL.XmlJSON.prototype.flagDateMacros = function(myjson) {\n    // print(\"flagDateMacros()\");\n    for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n        if (myjson.children[i].name === \"macro\") {\n            if (this.inspectDateMacros(myjson.children[i])) {\n                myjson.children[i].attrs[\"macro-has-date\"] = \"true\";\n            }\n        }\n    }\n}\nCSL.XmlJSON.prototype.inspectDateMacros = function(myjson) {\n    //print(\"inspectDateMacros()\");\n    if (!myjson || !myjson.children) {\n        return false;\n    }\n    if (myjson.name === \"date\") {\n        return true;\n    } else {\n        for (var i=0,ilen=myjson.children.length;i<ilen;i+=1) {\n            if (this.inspectDateMacros(myjson.children[i])) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n\n/*\n * Clean serialized XML\n */\nCSL.stripXmlProcessingInstruction = function (xml) {\n    if (!xml) {\n        return xml;\n    }\n    xml = xml.replace(/^<\\?[^?]+\\?>/, \"\");\n    xml = xml.replace(/<!--[^>]+-->/g, \"\");\n    xml = xml.replace(/^\\s+/g, \"\");\n    xml = xml.replace(/\\s+$/g, \"\");\n    return xml;\n};\n\n\n/*\n * String parser for XML inputs\n */\nCSL.parseXml = function(str) {\n\n    var _pos = 0;\n    var _obj = {children:[]};\n    var _stack = [_obj.children];\n\n    function _listifyString(str) {\n        str = str.split(/(?:\\r\\n|\\n|\\r)/).join(\" \").replace(/>[\t ]+</g, \"><\").replace(/<\\!--.*?-->/g, \"\");\n        var lst = str.split(\"><\");\n        var stylePos = null;\n        for (var i=0,ilen=lst.length;i<ilen;i++) {\n            if (i > 0) {\n                lst[i] = \"<\" + lst[i];\n            }\n            if (i < (lst.length-1)) {\n                lst[i] = lst[i] + \">\";\n            }\n            if (\"number\" != typeof stylePos) {\n                if (lst[i].slice(0, 7) === \"<style \" || lst[i].slice(0, 8) == \"<locale \") {\n                    stylePos = i;\n                }\n            }\n        }\n        lst = lst.slice(stylePos);\n        // Combine open/close elements for empty terms,\n        // so that they will be passed through correctly\n        // as empty strings.\n        for (var i=lst.length-2;i>-1;i--) {\n            if (lst[i].slice(1).indexOf(\"<\") === -1) {\n                var stub = lst[i].slice(0, 5);\n                if (lst[i].slice(-2) !== \"/>\") {\n                    if (stub === \"<term\") {\n                        if (lst[i+1].slice(0, 6) === \"</term\") {\n                            lst[i] = lst[i] + lst[i+1];\n                            lst = lst.slice(0, i+1).concat(lst.slice(i+2));\n                        }\n                    } else if ([\"<sing\", \"<mult\"].indexOf(stub) > -1) {\n                        if (lst[i].slice(-2) !== \"/>\" && lst[i+1].slice(0, 1) === \"<\") {\n                            lst[i] = lst[i] + lst[i+1];\n                            lst = lst.slice(0, i+1).concat(lst.slice(i+2));\n                        }\n                    }\n                }\n            }\n        }\n        return lst;\n    }\n\n    function _decodeHtmlEntities(str) {\n        return str\n            .split(\"&amp;\").join(\"&\")\n            .split(\"&quot;\").join(\"\\\"\")\n            .split(\"&gt;\").join(\">\").split(\"&lt;\").join(\"<\")\n            .replace(/&#([0-9]{1,6});/gi, function(match, numStr) {\n                var num = parseInt(numStr, 10); // read num as normal number\n                return String.fromCharCode(num);\n            })\n            .replace(/&#x([a-f0-9]{1,6});/gi, function(match, numStr){\n                var num = parseInt(numStr, 16); // read num as hex\n                return String.fromCharCode(num);\n            });\n    }\n\n    function _getAttributes(elem) {\n        var m = elem.match(/([^\\'\\\"=\t ]+)=(?:\\\"[^\\\"]*\\\"|\\'[^\\']*\\')/g);\n        if (m) {\n            for (var i=0,ilen=m.length;i<ilen;i++) {\n                m[i] = m[i].replace(/=.*/, \"\");\n            }\n        }\n        return m;\n    }\n\n    function _getAttribute(elem, attr) {\n        var rex = RegExp('^.*[\t ]+' + attr + '=(\\\"(?:[^\\\"]*)\\\"|\\'(?:[^\\']*)\\').*$');\n        var m = elem.match(rex);\n        return m ? m[1].slice(1, -1) : null;\n    }\n\n    function _getTagName(elem) {\n        var rex = RegExp(\"^<([^\t />]+)\");\n        var m = elem.match(rex);\n        return m ? m[1] : null;\n    }\n    \n\n    function _castObjectFromOpeningTag(elem) {\n        var obj = {};\n        obj.name = _getTagName(elem);\n        obj.attrs = {};\n        var attributes = _getAttributes(elem);\n        if (attributes) {\n            for (var i=0,ilen=attributes.length;i<ilen;i++) {\n                var attr = {\n                    name: attributes[i],\n                    value: _getAttribute(elem, attributes[i])\n                }\n                obj.attrs[attr.name] = _decodeHtmlEntities(attr.value);\n            }\n        }\n        obj.children = [];\n        return obj;\n    }\n\n    function _extractTextFromCompositeElement(elem) {\n        var m = elem.match(/^.*>([^<]*)<.*$/);\n        return _decodeHtmlEntities(m[1]);\n    }\n\n    function _appendToChildren(obj) {\n        _stack.slice(-1)[0].push(obj);\n    }\n\n    function _extendStackWithNewChildren(obj) {\n        _stack.push(obj.children);\n    }\n\n    function processElement(elem) {\n        var obj;\n        if (elem.slice(1).indexOf('<') > -1) {\n            // withtext\n            var tag = elem.slice(0, elem.indexOf('>')+1);\n            obj = _castObjectFromOpeningTag(tag);\n            obj.children = [_extractTextFromCompositeElement(elem)];\n            _appendToChildren(obj);\n        } else if (elem.slice(-2) === '/>') {\n            // singleton\n            obj = _castObjectFromOpeningTag(elem);\n            // Empty term as singleton\n            if (_getTagName(elem) === 'term') {\n                obj.children.push('');\n            }\n            _appendToChildren(obj);\n        } else if (elem.slice(0, 2) === '</') {\n            // close\n            _stack.pop();\n        } else {\n            // open\n            obj = _castObjectFromOpeningTag(elem);\n            _appendToChildren(obj)\n            _extendStackWithNewChildren(obj);\n        }\n    }\n\n    var lst = _listifyString(str);\n\n    for (var i=0,ilen=lst.length;i<ilen;i++) {\n        var elem = lst[i];\n        processElement(elem);\n    }\n    return _obj.children[0];\n}\n\n/**\n * Functions for parsing an XML object using E4X.\n */\n\nCSL.XmlDOM = function (dataObj) {\n    this.dataObj = dataObj;\n    if (\"undefined\" == typeof DOMParser) {\n        DOMParser = function() {};\n        DOMParser.prototype.parseFromString = function(str, contentType) {\n            if (\"undefined\" != typeof ActiveXObject) {\n                var xmldata = new ActiveXObject('MSXML.DomDocument');\n                xmldata.async = false;\n                xmldata.loadXML(str);\n                return xmldata;\n            } else if (\"undefined\" != typeof XMLHttpRequest) {\n                var xmldata = new XMLHttpRequest;\n                if (!contentType) {\n                    contentType = 'text/xml';\n                }\n                xmldata.open('GET', 'data:' + contentType + ';charset=utf-8,' + encodeURIComponent(str), false);\n                if(xmldata.overrideMimeType) {\n                    xmldata.overrideMimeType(contentType);\n                }\n                xmldata.send(null);\n                return xmldata.responseXML;\n            } else if (\"undefined\" != typeof marknote) {\n                var parser = new marknote.Parser();\n                return parser.parse(str);\n            }\n        };\n        this.hasAttributes = function (node) {\n            var ret;\n            if (node.attributes && node.attributes.length) {\n                ret = true;\n            } else {\n                ret = false;\n            }\n            return ret;\n        };\n    } else {\n        /*\n        this.hasAttributes = function (node) {\n            return node[\"hasAttributes\"]();\n        };\n        */\n        this.hasAttributes = function (node) {\n            var ret;\n            if (node.attributes && node.attributes.length) {\n                ret = true;\n            } else {\n                ret = false;\n            }\n            return ret;\n        };\n    }\n    this.importNode = function (doc, srcElement) {\n        var ret;\n        if (\"undefined\" == typeof doc.importNode) {\n            ret = this._importNode(doc, srcElement, true);\n        } else {\n            ret = doc.importNode(srcElement, true);\n        }\n        return ret;\n    };\n    // In case importNode is not available.\n    // Thx + hat tip to Anthony T. Holdener III\n    // http://www.alistapart.com/articles/crossbrowserscripting\n    // cases 3, 4, 8 = text, cdata, comment\n    this._importNode = function(doc, node, allChildren) {\n        switch (node.nodeType) {\n            // element node\n            case 1:\n                var newNode = doc.createElement(node.nodeName);\n                if (node.attributes && node.attributes.length > 0)\n                    for (var i = 0, il = node.attributes.length; i < il;)\n                        newNode.setAttribute(node.attributes[i].nodeName, node.getAttribute(node.attributes[i++].nodeName));\n                    if (allChildren && node.childNodes && node.childNodes.length > 0)\n                        for (var i = 0, il = node.childNodes.length; i < il;)\n                            newNode.appendChild(this._importNode(doc, node.childNodes[i++], allChildren));\n                return newNode;\n                break;\n            case 3:\n            case 4:\n            case 8:\n                // Drop comments on the floor as well.\n                //return doc.createTextNode(node.nodeValue);\n                //break;\n        }\n    };\n    this.parser = new DOMParser();\n\n    // This seems horribly tormented, but there might be a reason for it.\n    // Perhaps this was the only way I found to get namespacing to work ... ?\n    var str = \"<docco><institution institution-parts=\\\"long\\\" delimiter=\\\", \\\" substitute-use-first=\\\"1\\\" use-last=\\\"1\\\"><institution-part name=\\\"long\\\"/></institution></docco>\";\n    var inst_doc = this.parser.parseFromString(str, \"text/xml\");\n    var inst_node = inst_doc.getElementsByTagName(\"institution\");\n    this.institution = inst_node.item(0);\n    var inst_part_node = inst_doc.getElementsByTagName(\"institution-part\");\n    this.institutionpart = inst_part_node.item(0);\n    this.ns = \"http://purl.org/net/xbiblio/csl\";\n};\n\n/**\n * No need for cleaning with the DOM, I think.  This will probably just be a noop.\n * But first, let's get XML mode switching up and running.\n */\nCSL.XmlDOM.prototype.clean = function (xml) {\n    xml = xml.replace(/<\\?[^?]+\\?>/g, \"\");\n    xml = xml.replace(/<![^>]+>/g, \"\");\n    xml = xml.replace(/^\\s+/, \"\");\n    xml = xml.replace(/\\s+$/, \"\");\n    xml = xml.replace(/^\\n*/, \"\");\n    return xml;\n};\n\n\n/**\n * Methods to call on a node.\n */\nCSL.XmlDOM.prototype.getStyleId = function (myxml, styleName) {\n    var text = \"\";\n    var tagName = \"id\";\n    if (styleName) {\n        tagName = \"title\";\n    }\n    var node = myxml.getElementsByTagName(tagName);\n    if (node && node.length) {\n        node = node.item(0);\n    }\n    if (node) {\n        // W3C conformant browsers\n        text = node.textContent;\n    }\n    if (!text) {\n        // Opera, IE 6 & 7\n        text = node.innerText;\n    }\n    if (!text) {\n        // Safari\n        text = node.innerHTML;\n    }\n    return text;\n};\n\nCSL.XmlDOM.prototype.children = function (myxml) {\n    var children, pos, len, ret;\n    if (myxml) {\n        ret = [];\n        children = myxml.childNodes;\n        for (pos = 0, len = children.length; pos < len; pos += 1) {\n            if (children[pos].nodeName != \"#text\") {\n                ret.push(children[pos]);\n            }\n        }\n        return ret;\n    } else {\n        return [];\n    }\n};\n\nCSL.XmlDOM.prototype.nodename = function (myxml) {\n    var ret = myxml.nodeName;\n    return ret;\n};\n\nCSL.XmlDOM.prototype.attributes = function (myxml) {\n    var ret, attrs, attr, key, xml, pos, len;\n    ret = new Object();\n    if (myxml && this.hasAttributes(myxml)) {\n        attrs = myxml.attributes;\n        for (pos = 0, len=attrs.length; pos < len; pos += 1) {\n            attr = attrs[pos];\n            ret[\"@\" + attr.name] = attr.value;\n        }\n    }\n    return ret;\n};\n\n\nCSL.XmlDOM.prototype.content = function (myxml) {\n    var ret;\n    if (\"undefined\" != typeof myxml.textContent) {\n        ret = myxml.textContent;\n    } else if (\"undefined\" != typeof myxml.innerText) {\n        ret = myxml.innerText;\n    } else {\n        ret = myxml.txt;\n    }\n    return ret;\n};\n\n\nCSL.XmlDOM.prototype.namespace = {\n    \"xml\":\"http://www.w3.org/XML/1998/namespace\"\n}\n\nCSL.XmlDOM.prototype.numberofnodes = function (myxml) {\n    if (myxml) {\n        return myxml.length;\n    } else {\n        return 0;\n    }\n};\n\nCSL.XmlDOM.prototype.getAttributeName = function (attr) {\n    var ret = attr.name;\n    return ret;\n}\n\nCSL.XmlDOM.prototype.getAttributeValue = function (myxml,name,namespace) {\n    var ret = \"\";\n    if (namespace) {\n        name = namespace+\":\"+name;\n    }\n    if (myxml && this.hasAttributes(myxml) && myxml.getAttribute(name)) {\n        ret = myxml.getAttribute(name);\n    }\n    return ret;\n}\n\n//\n// Can't this be, you know ... simplified?\n//\nCSL.XmlDOM.prototype.getNodeValue = function (myxml,name) {\n    var ret = null;\n    if (name){\n        var vals = myxml.getElementsByTagName(name);\n        if (vals.length > 0) {\n            if (\"undefined\" != typeof vals[0].textContent) {\n                ret = vals[0].textContent;\n            } else if (\"undefined\" != typeof vals[0].innerText) {\n                ret = vals[0].innerText;\n            } else {\n                ret = vals[0].text;\n            }\n        }\n    }\n    if (ret === null && myxml && myxml.childNodes && (myxml.childNodes.length == 0 || (myxml.childNodes.length == 1 && myxml.firstChild.nodeName == \"#text\"))) {\n        if (\"undefined\" != typeof myxml.textContent) {\n            ret = myxml.textContent;\n        } else if (\"undefined\" != typeof myxml.innerText) {\n            ret = myxml.innerText;\n        } else {\n            ret = myxml.text;\n        }\n    }\n    if (ret === null) {\n        ret = myxml;\n    }\n    return ret;\n}\n\nCSL.XmlDOM.prototype.setAttributeOnNodeIdentifiedByNameAttribute = function (myxml,nodename,partname,attrname,val) {\n    var pos, len, xml, nodes, node;\n    if (attrname.slice(0,1) === '@'){\n        attrname = attrname.slice(1);\n    }\n    nodes = myxml.getElementsByTagName(nodename);\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes[pos];\n        if (node.getAttribute(\"name\") != partname) {\n            continue;\n        }\n        node.setAttribute(attrname, val);\n    }\n}\n\nCSL.XmlDOM.prototype.deleteNodeByNameAttribute = function (myxml,val) {\n    var pos, len, node, nodes;\n    nodes = myxml.childNodes;\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes[pos];\n        if (!node || node.nodeType == node.TEXT_NODE) {\n            continue;\n        }\n        if (this.hasAttributes(node) && node.getAttribute(\"name\") == val) {\n            myxml.removeChild(nodes[pos]);\n        }\n    }\n}\n\nCSL.XmlDOM.prototype.deleteAttribute = function (myxml,attr) {\n    myxml.removeAttribute(attr);\n}\n\nCSL.XmlDOM.prototype.setAttribute = function (myxml,attr,val) {\n    if (!myxml.ownerDocument) {\n        myxml = myxml.firstChild;\n    }\n    // \"unknown\" to satisfy IE8, which crashes when setAttribute\n    // is checked directly as a property, and report its type as\n    // \"unknown\".\n    // Many thanks to Phil Lord for tracing the cause of the fault.\n    if ([\"function\", \"unknown\"].indexOf(typeof myxml.setAttribute) > -1) {\n        myxml.setAttribute(attr, val);\n    }\n    return false;\n}\n\nCSL.XmlDOM.prototype.nodeCopy = function (myxml) {\n    var cloned_node = myxml.cloneNode(true);\n    return cloned_node;\n}\n\nCSL.XmlDOM.prototype.getNodesByName = function (myxml,name,nameattrval) {\n    var ret, nodes, node, pos, len;\n    ret = [];\n    nodes = myxml.getElementsByTagName(name);\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        node = nodes.item(pos);\n        if (nameattrval && !(this.hasAttributes(node) && node.getAttribute(\"name\") == nameattrval)) {\n//        if (nameattrval && !(this.attributes && node.attributes.name && node.attributes.name.value == nameattrval)) {\n            continue;\n        }\n        ret.push(node);\n    }\n    return ret;\n}\n\nCSL.XmlDOM.prototype.nodeNameIs = function (myxml,name) {\n    if (name == myxml.nodeName) {\n        return true;\n    }\n    return false;\n}\n\nCSL.XmlDOM.prototype.makeXml = function (myxml) {\n    var ret, topnode;\n    if (!myxml) {\n        myxml = \"<docco><bogus/></docco>\";\n    }\n    myxml = myxml.replace(/\\s*<\\?[^>]*\\?>\\s*\\n*/g, \"\");\n    var nodetree = this.parser.parseFromString(myxml, \"application/xml\");\n    return nodetree.firstChild;\n};\n\nCSL.XmlDOM.prototype.insertChildNodeAfter = function (parent,node,pos,datexml) {\n    var myxml, xml;\n    myxml = this.importNode(node.ownerDocument, datexml);\n    parent.replaceChild(myxml, node);\n     return parent;\n};\n\nCSL.XmlDOM.prototype.insertPublisherAndPlace = function(myxml) {\n    var group = myxml.getElementsByTagName(\"group\");\n    for (var i = 0, ilen = group.length; i < ilen; i += 1) {\n        var node = group.item(i);\n        var skippers = [];\n        for (var j = 0, jlen = node.childNodes.length; j < jlen; j += 1) {\n            if (node.childNodes.item(j).nodeType !== 1) {\n                skippers.push(j);\n            }\n        }\n        if (node.childNodes.length - skippers.length === 2) {\n            var twovars = [];\n            for (var j = 0, jlen = 2; j < jlen; j += 1) {\n                if (skippers.indexOf(j) > -1) {\n                    continue;\n                }\n                var child = node.childNodes.item(j);                    \n                var subskippers = [];\n                for (var k = 0, klen = child.childNodes.length; k < klen; k += 1) {\n                    if (child.childNodes.item(k).nodeType !== 1) {\n                        subskippers.push(k);\n                    }\n                }\n                if (child.childNodes.length - subskippers.length === 0) {\n                    twovars.push(child.getAttribute('variable'));\n                    if (child.getAttribute('suffix')\n                        || child.getAttribute('prefix')) {\n                        twovars = [];\n                        break;\n                    }\n                }\n            }\n            if (twovars.indexOf(\"publisher\") > -1 && twovars.indexOf(\"publisher-place\") > -1) {\n                node.setAttribute('has-publisher-and-publisher-place', true);\n            }\n        }\n    }\n};\n\nCSL.XmlDOM.prototype.isChildOfSubstitute = function(node) {\n    if (node.parentNode) {\n        if (node.parentNode.tagName.toLowerCase() === \"substitute\") {\n            return true;\n        } else {\n            return this.isChildOfSubstitute(node.parentNode);\n        }\n    }\n    return false;\n};\n\nCSL.XmlDOM.prototype.addMissingNameNodes = function(myxml) {\n    var nameslist = myxml.getElementsByTagName(\"names\");\n    for (var i = 0, ilen = nameslist.length; i < ilen; i += 1) {\n        var names = nameslist.item(i);\n        var namelist = names.getElementsByTagName(\"name\");\n        if ((!namelist || namelist.length === 0)\n            && !this.isChildOfSubstitute(names)) {\n            \n            var doc = names.ownerDocument;\n            var name = doc.createElement(\"name\");\n            names.appendChild(name);\n        }\n    }\n};\n\n\nCSL.XmlDOM.prototype.addInstitutionNodes = function(myxml) {\n    var names, thenames, institution, theinstitution, theinstitutionpart, name, thename, xml, pos, len;\n    names = myxml.getElementsByTagName(\"names\");\n    for (pos = 0, len = names.length; pos < len; pos += 1) {\n        thenames = names.item(pos);\n        name = thenames.getElementsByTagName(\"name\");\n        if (name.length == 0) {\n            continue;\n        }\n        institution = thenames.getElementsByTagName(\"institution\");\n        if (institution.length == 0) {\n            theinstitution = this.importNode(myxml.ownerDocument, this.institution);\n            theinstitutionpart = theinstitution.getElementsByTagName(\"institution-part\").item(0);\n            thename = name.item(0);\n            thenames.insertBefore(theinstitution, thename.nextSibling);\n            for (var j = 0, jlen = CSL.INSTITUTION_KEYS.length; j < jlen; j += 1) {\n                var attrname = CSL.INSTITUTION_KEYS[j];\n                var attrval = thename.getAttribute(attrname);\n                if (attrval) {\n                    theinstitutionpart.setAttribute(attrname, attrval);\n                }\n            }\n            var nameparts = thename.getElementsByTagName(\"name-part\");\n            for (var j = 0, jlen = nameparts.length; j < jlen; j += 1) {\n                if ('family' === nameparts[j].getAttribute('name')) {\n                    for (var k = 0, klen = CSL.INSTITUTION_KEYS.length; k < klen; k += 1) {\n                        var attrname = CSL.INSTITUTION_KEYS[k];\n                        var attrval = nameparts[j].getAttribute(attrname);\n                        if (attrval) {\n                            theinstitutionpart.setAttribute(attrname, attrval);\n                        }\n                    }\n                }\n            }\n        }\n    }\n};\n\n\nCSL.XmlDOM.prototype.flagDateMacros = function(myxml) {\n    var pos, len, thenode, thedate;\n    var nodes = myxml.getElementsByTagName(\"macro\");\n    for (pos = 0, len = nodes.length; pos < len; pos += 1) {\n        thenode = nodes.item(pos);\n        thedate = thenode.getElementsByTagName(\"date\");\n        if (thedate.length) {\n            thenode.setAttribute('macro-has-date', 'true');\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.setupXml = function(xmlObject) {\n    var dataObj = {};\n    var parser = null;\n    if (\"undefined\" !== typeof xmlObject) {\n        if (\"string\" === typeof xmlObject) {\n            xmlObject = xmlObject.replace(\"^\\uFEFF\", \"\")\n                .replace(/^\\s+/, \"\");\n            if (xmlObject.slice(0, 1) === \"<\") {\n                // Assume serialized XML\n                dataObj = CSL.parseXml(xmlObject);\n            } else {\n                // Assume serialized JSON\n                dataObj = JSON.parse(xmlObject);\n            }\n            parser = new CSL.XmlJSON(dataObj);\n        } else if (\"undefined\" !== typeof xmlObject.getAttribute) {\n            // Assume DOM instance\n            parser = new CSL.XmlDOM(xmlObject);\n        } else if (\"undefined\" !== typeof xmlObject.toXMLString) {\n            // Assume E4X object\n            parser = new CSL.XmlE4X(xmlObject);\n        } else {\n            // Assume JS object\n            parser = new CSL.XmlJSON(xmlObject);\n        }\n    } else {\n        CSL.error(\"unable to parse XML input\");\n    }\n    if (!parser) {\n        CSL.error(\"citeproc-js error: unable to parse CSL style or locale object\");\n    }\n    return parser;\n};\n\n/*global CSL: true */\n\nCSL.getSortCompare = function (default_locale) {\n    if (CSL.stringCompare) {\n        return CSL.stringCompare;\n    }\n    var me = this;\n    var strcmp;\n    var strcmp_opts = {\n        sensitivity:\"base\",\n        ignorePunctuation:true,\n        numeric:true\n    };\n    // In order, attempt the following:\n    //   (1) Set locale collation from processor language\n    //   (2) Use localeCompare()\n    if (!default_locale) {\n        default_locale = \"en-US\";\n    }\n    strcmp = function (a, b) {\n        return CSL.toLocaleLowerCase.call(me, a).localeCompare(CSL.toLocaleLowerCase.call(me, b),default_locale,strcmp_opts);\n    };\n    var stripPunct = function (str) {\n        return str.replace(/^[\\[\\]\\'\\\"]*/g, \"\");\n    };\n    var getBracketPreSort = function () {\n        if (!strcmp(\"[x\",\"x\")) {\n            return false;\n        } else {\n            return function (a, b) {\n                return strcmp(stripPunct(a), stripPunct(b));\n            };\n        }\n    };\n    var bracketPreSort = getBracketPreSort();\n    var sortCompare = function (a, b) {\n        if (bracketPreSort) {\n            return bracketPreSort(a, b);\n        } else {\n            return strcmp(a, b);\n        }\n    };\n    return sortCompare;\n};\n\n/*global CSL: true */\n\nCSL.ambigConfigDiff = function(a, b) {\n    var pos, len, ppos, llen;\n    // return of true means the ambig configs differ\n    if (a.names.length !== b.names.length) {\n        //print(\"   (1)\");\n        return 1;\n    } else {\n        for (pos = 0, len = a.names.length; pos < len; pos += 1) {\n            if (a.names[pos] !== b.names[pos]) {\n        //print(\"   (2) \"+a.names[pos]+\" \"+b.names[pos]);\n                return 1;\n            } else {\n                for (ppos = 0, llen = a.givens[pos]; ppos < llen; ppos += 1) {\n                    if (a.givens[pos][ppos] !== b.givens[pos][ppos]) {\n        //print(\"   (3): \"+a.givens[pos][ppos]+\" \"+b.givens[pos][ppos]+\" \"+pos+\"/\"+ppos+\" \"+b.givens[pos]);\n                        return 1;\n                    }\n                }\n            }\n        }\n    }\n    if (a.disambiguate != b.disambiguate) {\n        //print(\"   (4) \"+a.disambiguate+\" \"+b.disambiguate);\n        return 1;\n    }\n    if (a.year_suffix !== b.year_suffix) {\n        //print(\"   (5) \"+a.year_suffix+\" \"+b.year_suffix);\n        return 1;\n    }\n    return 0;\n};\n\nCSL.cloneAmbigConfig = function (config, oldconfig) {\n    var i, ilen, j, jlen, param;\n    var ret = {};\n    ret.names = [];\n    ret.givens = [];\n    ret.year_suffix = false;\n    ret.disambiguate = false;\n    for (i = 0, ilen = config.names.length; i < ilen; i += 1) {\n        param = config.names[i];\n        // Fixes update bug affecting plugins, without impacting\n        // efficiency with update of large numbers of year-suffixed\n        // items.\n        ret.names[i] = param;\n    }\n    for (i  = 0, ilen = config.givens.length; i < ilen; i += 1) {\n        param = [];\n        for (j = 0, jlen = config.givens[i].length; j < jlen; j += 1) {\n            // condition at line 312 of disambiguate.js protects against negative\n            // values of j\n            param.push(config.givens[i][j]);\n        }\n        ret.givens.push(param);\n    }\n    // XXXX Is this necessary at all?\n    if (oldconfig) {\n        ret.year_suffix = oldconfig.year_suffix;\n        ret.disambiguate = oldconfig.disambiguate;\n    } else {\n        ret.year_suffix = config.year_suffix;\n        ret.disambiguate = config.disambiguate;\n    }\n    return ret;\n};\n\n/**\n * Return current base configuration for disambiguation\n */\nCSL.getAmbigConfig = function () {\n    var config, ret;\n    config = this.tmp.disambig_request;\n    if (!config) {\n        config = this.tmp.disambig_settings;\n    }\n    var ret = CSL.cloneAmbigConfig(config);\n    return ret;\n};\n\n/**\n * Return max values for disambiguation\n */\nCSL.getMaxVals = function () {\n    return this.tmp.names_max.mystack.slice();\n};\n\n/**\n * Return min value for disambiguation\n */\nCSL.getMinVal = function () {\n    return this.tmp[\"et-al-min\"];\n};\n\n/*global CSL: true */\n\n/* For node execution pretty-printing (see below) */\n\n/*\nvar INDENT = \"\";\n*/\n\nCSL.tokenExec = function (token, Item, item) {\n    // Called on state object\n    var next, maybenext, exec, debug;\n    debug = false;\n    next = token.next;\n    maybenext = false;\n\n    /* Pretty-print node executions */\n\n    /*\n    if ([\"if\", \"else-if\", \"else\"].indexOf(token.name) === -1) {\n        if (token.tokentype == 1) {\n            INDENT = INDENT.slice(0, -2);\n        }\n    }\n    this.sys.print(INDENT + \"---> Token: \" + token.name + \" (\" + token.tokentype + \") in \" + this.tmp.area + \", \" + this.output.current.mystack.length);\n    if ([\"if\", \"else-if\", \"else\"].indexOf(token.name) === -1) {\n        if (token.tokentype == 0) {\n            INDENT += \"  \";\n        }\n    }\n    */\n\n    var record = function (result) {\n        if (result) {\n            this.tmp.jump.replace(\"succeed\");\n            return token.succeed;\n        } else {\n            this.tmp.jump.replace(\"fail\");\n            return token.fail;\n        }\n    };\n    if (token.test) {\n        next = record.call(this,token.test(Item, item));\n    }\n    for (var i=0,ilen=token.execs.length;i<ilen;i++) {\n        exec = token.execs[i];\n        maybenext = exec.call(token, this, Item, item);\n        if (maybenext) {\n            next = maybenext;\n        }\n    }\n    //SNIP-START\n    if (debug) {\n        CSL.debug(token.name + \" (\" + token.tokentype + \") ---> done\");\n    }\n    //SNIP-END\n    return next;\n};\n\n/**\n * Macro expander.\n * <p>Called on the state object.</p>\n */\nCSL.expandMacro = function (macro_key_token, target) {\n    var mkey, macro_nodes, end_of_macro, func;\n\n    mkey = macro_key_token.postponed_macro;\n\n    var sort_direction = macro_key_token.strings.sort_direction;\n    \n    // Decorations and affixes are in wrapper applied in cs:text\n    macro_key_token = new CSL.Token(\"group\", CSL.START);\n    \n    var hasDate = false;\n    var macroid = false;\n    macro_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, 'macro', mkey);\n    if (macro_nodes.length) {\n        macroid = this.cslXml.getAttributeValue(macro_nodes[0],'cslid');\n        hasDate = this.cslXml.getAttributeValue(macro_nodes[0], \"macro-has-date\");\n    }\n    if (hasDate) {\n        mkey = mkey + \"@\" + this.build.current_default_locale;\n        func = function (state) {\n            if (state.tmp.extension) {\n                state.tmp[\"doing-macro-with-date\"] = true;\n            }\n        };\n        macro_key_token.execs.push(func);\n    }\n\n    if (this.build.macro_stack.indexOf(mkey) > -1) {\n        CSL.error(\"CSL processor error: call to macro \\\"\" + mkey + \"\\\" would cause an infinite loop\");\n    } else {\n        this.build.macro_stack.push(mkey);\n    }\n\n    macro_key_token.cslid = macroid;\n\n    if (CSL.MODULE_MACROS[mkey]) {\n        macro_key_token.juris = mkey;\n        this.opt.update_mode = CSL.POSITION;\n    }\n    // Macro group is treated as a real node in the style\n    CSL.Node.group.build.call(macro_key_token, this, target, true);\n\n    // Node does not exist in the CSL\n    if (!this.cslXml.getNodeValue(macro_nodes)) {\n        CSL.error(\"CSL style error: undefined macro \\\"\" + mkey + \"\\\"\");\n    }\n\n    // Let's macro\n    var mytarget = CSL.getMacroTarget.call(this, mkey);\n    if (mytarget) {\n        CSL.buildMacro.call(this, mytarget, macro_nodes);\n        CSL.configureMacro.call(this, mytarget);\n    }\n    if (!this.build.extension) {\n        var func = (function(macro_name) {\n            return function (state, Item, item) {\n                var next = 0;\n                while (next < state.macros[macro_name].length) {\n                    next = CSL.tokenExec.call(state, state.macros[macro_name][next], Item, item);\n                }\n            };\n        }(mkey));\n        var text_node = new CSL.Token(\"text\", CSL.SINGLETON);\n        text_node.execs.push(func);\n        target.push(text_node);\n    }\n\n    // Decorations and affixes are in wrapper applied in cs:text\n    end_of_macro = new CSL.Token(\"group\", CSL.END);\n    end_of_macro.strings.sort_direction = sort_direction;\n    \n    if (hasDate) {\n        func = function (state) {\n            if (state.tmp.extension) {\n                state.tmp[\"doing-macro-with-date\"] = false;\n            }\n        };\n        end_of_macro.execs.push(func);\n    }\n    if (macro_key_token.juris) {\n        end_of_macro.juris = mkey;\n     }\n    // Macro group is treated as a real node in the style\n    CSL.Node.group.build.call(end_of_macro, this, target, true);\n\n    this.build.macro_stack.pop();\n};\n\nCSL.getMacroTarget = function (mkey) {\n    var mytarget = false;\n    if (this.build.extension) {\n        mytarget = this[this.build.root + this.build.extension].tokens;\n    } else if (!this.macros[mkey]) {\n        mytarget = [];\n        this.macros[mkey] = mytarget;\n    }\n    return mytarget;\n};\n\nCSL.buildMacro = function (mytarget, macro_nodes) {\n    var builder = CSL.makeBuilder(this, mytarget);\n    var mynode;\n    if (\"undefined\" === typeof macro_nodes.length) {\n        mynode = macro_nodes;\n    } else {\n        mynode = macro_nodes[0];\n    }\n    builder(mynode);\n};\n\nCSL.configureMacro = function (mytarget) {\n    if (!this.build.extension) {\n        this.configureTokenList(mytarget);\n    }\n};\n\n\n/**\n * Convert XML node to token.\n * <p>This is called on an XML node.  After extracting the name and attribute\n * information from the node, it performs three operations.  Attribute information\n * relating to output formatting is stored on the node as an array of tuples,\n * which fixes the sequence of execution of output functions to be invoked\n * in the next phase of processing.  Other attribute information is reduced\n * to functions, and is pushed into an array on the token in no particular\n * order, for later execution.  The element name is used as a key to\n * invoke the relevant <code>build</code> method of the target element.\n * Element methods are defined in {@link CSL.Node}.</p>\n * @param {Object} state  The state object returned by {@link CSL.Engine}.\n * @param {Int} tokentype  A CSL namespace constant (<code>CSL.START</code>,\n * <code>CSL.END</code> or <code>CSL.SINGLETON</code>.\n */\nCSL.XmlToToken = function (state, tokentype, explicitTarget, var_stack) {\n    var name, txt, attrfuncs, attributes, decorations, token, key, target;\n    name = state.cslXml.nodename(this);\n    //CSL.debug(tokentype + \" : \" + name);\n    if (state.build.skip && state.build.skip !== name) {\n        return;\n    }\n    if (!name) {\n        txt = state.cslXml.content(this);\n        if (txt) {\n            state.build.text = txt;\n        }\n        return;\n    }\n    if (!CSL.Node[state.cslXml.nodename(this)]) {\n        CSL.error(\"Undefined node name \\\"\" + name + \"\\\".\");\n    }\n    attrfuncs = [];\n    attributes = state.cslXml.attributes(this);\n    decorations = CSL.setDecorations.call(this, state, attributes);\n    token = new CSL.Token(name, tokentype);\n    if (tokentype !== CSL.END || name === \"if\" || name === \"else-if\" || name === \"layout\") {\n        //\n        // xml: more xml stuff\n        //\n        for (var key in attributes) {\n            if (attributes.hasOwnProperty(key)) {\n                if (tokentype === CSL.END && key !== \"@language\" && key !== \"@locale\") {\n                    continue;\n                }\n                if (attributes.hasOwnProperty(key)) {\n                    if (CSL.Attributes[key]) {\n                        try {\n                            CSL.Attributes[key].call(token, state, \"\" + attributes[key]);\n                        } catch (e) {\n                            CSL.error(key + \" attribute: \" + e);\n                        }\n                    } else {\n                        CSL.debug(\"warning: undefined attribute \\\"\"+key+\"\\\" in style\");\n                    }\n                }\n            }\n        }\n        token.decorations = decorations;\n        if (CSL.DATE_VARIABLES.indexOf(attributes['@variable']) > -1) {\n            var_stack.push(token.variables);\n        }\n    } else if (tokentype === CSL.END && attributes['@variable']) {\n        token.hasVariable = true;\n        if (CSL.DATE_VARIABLES.indexOf(attributes['@variable']) > -1) {\n            token.variables = var_stack.pop();\n        }\n    }\n    //\n    // !!!!!: eliminate diversion of tokens to separate\n    // token list (formerly used for reading in macros\n    // and terms).\n    //\n    if (explicitTarget) {\n        target = explicitTarget;\n    } else {\n        target = state[state.build.area].tokens;\n    }\n    // True flags real nodes in the style\n    CSL.Node[name].build.call(token, state, target, true);\n};\n\n\n\n/*global CSL: true */\n\n\nCSL.DateParser = function () {\n\n    /*\n     * Fixed values\n     */\n\n    // jse imperial years\n    var epochPairs = [\n        [\"\\u660E\\u6CBB\", 1867],\n        [\"\\u5927\\u6B63\", 1911],\n        [\"\\u662D\\u548C\", 1925],\n        [\"\\u5E73\\u6210\", 1988]\n    ];\n\n    // years by jse imperial epoch\n    var epochYearByName = {};\n    for (var i=0,ilen=epochPairs.length; i<ilen; i++) {\n        var key = epochPairs[i][0];\n        var val = epochPairs[i][1];\n        epochYearByName[key] = val;\n    }\n    \n    var epochMatchStrings = [];\n    var epochMap = {};\n    for (var i=0,ilen=epochPairs.length; i<ilen; i++) {\n        var pair = epochPairs[i];\n        var val = pair[0];\n        epochMatchStrings.push(val);\n        epochMap[pair[0]] = pair[1];\n    }\n    var epochMatchString = epochMatchStrings.join(\"|\");\n\n    // regular expression to trap year name and year\n    // (splitter and matcher, to cope with ancient JS implementations)\n    var epochSplitter = new RegExp(\"(?:\" + epochMatchString + \")(?:[0-9]+)\");\n    var epochMatcher = new RegExp(\"(?:\" + epochMatchString + \")(?:[0-9]+)\", \"g\");\n\n    // regular expression for month or day kanji label\n    var kanjiMonthDay = /(\\u6708|\\u5E74)/g;\n\n    // regular expression for year kanji label\n    var kanjiYear = /\\u65E5/g;\n\n    // regular expression for double-width Japanese range marker\n    var kanjiRange = /\\u301c/g;\n\n    // parsing regexps for normalized strings\n    //   raw materials\n    var yearLast = \"(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])\";\n    var yearFirst = \"[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])\";\n    var numberVal = \"[?0-9]{1,3}\";\n    var rangeSeparator = \"[%%DATED%%]\";\n    var fuzzyChar = \"[?~]\";\n    var chars = \"[^\\-\\/\\~\\?0-9]+\";\n    var rexString = \"(\" + yearFirst + \"|\" + yearLast + \"|\" + numberVal + \"|\" + rangeSeparator + \"|\" + fuzzyChar + \"|\" + chars + \")\";\n    //   composed regexps\n    var rexDash = new RegExp(rexString.replace(/%%NUMD%%/g, \"-\").replace(/%%DATED%%/g, \"-\"));\n    var rexDashSlash = new RegExp(rexString.replace(/%%NUMD%%/g, \"-\").replace(/%%DATED%%/g, \"\\/\"));\n    var rexSlashDash = new RegExp(rexString.replace(/%%NUMD%%/g, \"\\/\").replace(/%%DATED%%/g, \"-\"));\n\n    /*\n     * Mutable values\n     */\n\n    // months\n    var monthString = \"january february march april may june july august september october november december spring summer fall winter spring summer\";\n    this.monthStrings = monthString.split(\" \");\n\n    /*\n     * Configuration functions\n     */\n\n    this.setOrderDayMonth = function() {\n        // preferred ordering for numeric dates\n        this.monthGuess = 1;\n        this.dayGuess = 0;\n    };\n\n    this.setOrderMonthDay = function() {\n        // preferred ordering for numeric dates\n        this.monthGuess = 0;\n        this.dayGuess = 1;\n    };\n\n    this.resetDateParserMonths = function() {\n        // Function to reset months to default.\n        this.monthSets = [];\n        for (var i=0,ilen=this.monthStrings.length; i<ilen; i++) {\n            this.monthSets.push([this.monthStrings[i]]);\n        }\n        this.monthAbbrevs = [];\n        for (var i=0,ilen=this.monthSets.length; i<ilen; i++) {\n            this.monthAbbrevs.push([]);\n            for (var j=0,jlen=this.monthSets[i].length; j<jlen; j++) {\n                this.monthAbbrevs[i].push(this.monthSets[i][0].slice(0, 3));\n            }\n        }\n        this.monthRexes = [];\n        for (var i=0,ilen=this.monthAbbrevs.length; i<ilen; i++) {\n            this.monthRexes.push(new RegExp(\"(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\"));\n        }\n    };\n\n    this.addDateParserMonths = function(lst) {\n        // Extend list of months with an additional set of month abbreviations,\n        // extending strings as required to resolve ambiguities.\n\n        // Normalize string to list\n        if (\"string\" === typeof lst) {\n            lst = lst.split(/\\s+/);\n        }\n\n        // Check that there are twelve (or sixteen) to add\n        if (lst.length !== 12 && lst.length !== 16) {\n            CSL.debug(\"month [+season] list of \"+lst.length+\", expected 12 or 16. Ignoring.\");\n            return;\n        }\n\n        // Extend as necessary to resolve ambiguities\n        // For each new month string ...\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            var abbrevLength = null;\n            var skip = false;\n            var insert = 3;\n            var extendedSets = {};\n            for (var j=0,jlen=this.monthAbbrevs.length; j<jlen; j++) {\n                extendedSets[j] = {};\n                if (j === i) {\n                    // Mark for skipping if same as an existing abbreviation of same month\n                    for (var k=0,klen=this.monthAbbrevs[i].length; k<klen; k++) {\n                        if (this.monthAbbrevs[i][k] === lst[i].slice(0, this.monthAbbrevs[i][k].length)) {\n                            skip = true;\n                            break;\n                        }\n                    }\n                } else {\n                    // Mark for extending if same as existing abbreviation of any expression of another month\n                    for (var k=0,klen=this.monthAbbrevs[j].length; k<klen; k++) {\n                        abbrevLength = this.monthAbbrevs[j][k].length;\n                        if (this.monthAbbrevs[j][k] === lst[i].slice(0, abbrevLength)) {\n                            while (this.monthSets[j][k].slice(0, abbrevLength) === lst[i].slice(0, abbrevLength)) {\n                                // Abort when full length is hit, otherwise extend\n                                if (abbrevLength > lst[i].length || abbrevLength > this.monthSets[j][k].length) {\n                                    CSL.debug(\"unable to disambiguate month string in date parser: \"+lst[i]);\n                                    break;\n                                } else {\n                                    // Mark both new entry and existing abbrev for extension\n                                    abbrevLength += 1;\n                                }\n                            }\n                            insert = abbrevLength;\n                            extendedSets[j][k] = abbrevLength;\n                        }\n                    }\n                }\n                for (var jKey in extendedSets) {\n                    for (var kKey in extendedSets[jKey]) {\n                        abbrevLength = extendedSets[jKey][kKey];\n                        jKey = parseInt(jKey, 10);\n                        kKey = parseInt(kKey, 10);\n                        this.monthAbbrevs[jKey][kKey] = this.monthSets[jKey][kKey].slice(0, abbrevLength);\n                    }\n                }\n            }\n            // Insert here\n            if (!skip) {\n                this.monthSets[i].push(lst[i]);\n                this.monthAbbrevs[i].push(lst[i].slice(0, insert));\n            }\n        }\n\n        // Compose\n        this.monthRexes = [];\n        this.monthRexStrs = [];\n        for (var i=0,ilen=this.monthAbbrevs.length; i<ilen; i++) {\n            this.monthRexes.push(new RegExp(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\"));\n            this.monthRexStrs.push(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\");\n        }\n        if (this.monthAbbrevs.length === 18) {\n            for (var i=12,ilen=14; i<ilen; i++) {\n                this.monthRexes[i+4] = new RegExp(\"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\");\n                this.monthRexStrs[i+4] = \"^(?:\" + this.monthAbbrevs[i].join(\"|\") + \")\";\n            }\n        }\n    };\n\n    /*\n     * Conversion functions\n     */\n\n    this.convertDateObjectToArray = function (thedate) {\n        // Converts object in place and returns object\n        thedate[\"date-parts\"] = [];\n        thedate[\"date-parts\"].push([]);\n        var slicelen = 0;\n        var part;\n        for (var i=0,ilen=3; i<ilen; i++) {\n            part = [\"year\", \"month\", \"day\"][i];\n            if (!thedate[part]) {\n                break;\n            }\n            slicelen += 1;\n            thedate[\"date-parts\"][0].push(thedate[part]);\n            delete thedate[part];\n        }\n        thedate[\"date-parts\"].push([]);\n        for (var i=0, ilen=slicelen; i<ilen; i++) {\n            part = [\"year_end\", \"month_end\", \"day_end\"][i];\n            if (!thedate[part]) {\n                break;\n            }\n            thedate[\"date-parts\"][1].push(thedate[part]);\n            delete thedate[part];\n        }\n        if (thedate[\"date-parts\"][0].length !== thedate[\"date-parts\"][1].length) {\n            thedate[\"date-parts\"].pop();\n        }\n        return thedate;\n    };\n\n    // XXXX String output is currently unable to represent ranges\n    this.convertDateObjectToString = function(thedate) {\n        // Returns string\n        var ret = [];\n        for (var i = 0, ilen = 3; i < ilen; i += 1) {\n            if (thedate[CSL.DATE_PARTS_ALL[i]]) {\n                ret.push(thedate[CSL.DATE_PARTS_ALL[i]]);\n            } else {\n                break;\n            }\n        }\n        return ret.join(\"-\");\n    };\n\n    /*\n     * Utility function\n     */\n\n    this._parseNumericDate = function (ret, delim, suff, txt) {\n        if (!suff) {\n            suff = \"\";\n        }\n        var lst = txt.split(delim);\n        \n        for (var i=0, ilen=lst.length; i<ilen; i++) {\n            if (lst[i].length === 4) {\n                ret[(\"year\" + suff)] = lst[i].replace(/^0*/, \"\");\n                if (!i) {\n                    lst = lst.slice(1);\n                } else {\n                    lst = lst.slice(0, i);\n                }\n                break;\n            }\n        }\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            lst[i] = parseInt(lst[i], 10);\n        }\n        if (lst.length === 1 || (lst.length === 2 && !lst[1])) {\n            var month = lst[0];\n            if (month) {\n                ret[(\"month\" + suff)] = \"\" + lst[0];\n            }\n        } else if (lst.length === 2) {\n            if (lst[this.monthGuess] > 12) {\n                var month = lst[this.dayGuess];\n                var day = lst[this.monthGuess];\n                if (month) {\n                    ret[(\"month\" + suff)] = \"\" + month;\n                    if (day) {\n                        ret[(\"day\" + suff)] = \"\" + day;\n                    }\n                }\n            } else {\n                var month = lst[this.monthGuess];\n                var day = lst[this.dayGuess];\n                if (month) {\n                    ret[(\"month\" + suff)] = \"\" + month;\n                    if (day) {\n                        ret[(\"day\" + suff)] = \"\" + day;\n                    }\n                }\n            }\n        }\n    };\n\n    /*\n     * Parsing functions\n     */\n\n    this.parseDateToObject = function (txt) {\n        //\n        // Normalize the format and the year if it's a Japanese date\n        //\n        var orig = txt;\n        var slashPos = -1;\n        var dashPos = -1;\n        var yearIsNegative = false;\n        var lst;\n        if (txt) {\n            txt = txt.replace(/^(.*[0-9])T[0-9].*/, \"$1\");\n            // If string leads with a minus sign, strip and memo it.\n            if (txt.slice(0, 1) === \"-\") {\n                yearIsNegative = true;\n                txt = txt.slice(1);\n            }\n            \n            // If string is a number of 1 to 3 characters only, treat as year.\n            if (txt.match(/^[0-9]{1,3}$/)) {\n                while (txt.length < 4) {\n                    txt = \"0\" + txt;\n                }\n            }\n            \n            // Normalize to string\n            txt = \"\" + txt;\n            // Remove things that look like times\n            txt = txt.replace(/\\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,\"\");\n            var m = txt.match(kanjiMonthDay);\n            if (m) {\n                txt = txt.replace(/\\s+/g, \"\");\n                txt = txt.replace(kanjiYear, \"\");\n                txt = txt.replace(kanjiMonthDay, \"-\");\n                txt = txt.replace(kanjiRange, \"/\");\n                txt = txt.replace(/\\-\\//g, \"/\");\n                txt = txt.replace(/-$/g,\"\");\n\n                // Tortuous workaround for IE6\n                var slst = txt.split(epochSplitter);\n                lst = [];\n                var mm = txt.match(epochMatcher);\n                if (mm) {\n                    var mmx = [];\n                    for (var i=0,ilen=mm.length; i<ilen; i++) {\n                        mmx = mmx.concat(mm[i].match(/([^0-9]+)([0-9]+)/).slice(1));\n                    }\n                    for (var i=0,ilen=slst.length; i<ilen; i++) {\n                        lst.push(slst[i]);\n                        if (i !== (ilen - 1)) {\n                            // pos is undeclared, and multiplying by 2 here is insane.\n                            var mmpos = (i * 2);\n                            lst.push(mmx[mmpos]);\n                            lst.push(mmx[mmpos + 1]);\n                        }\n                    }\n                } else {\n                    lst = slst;\n                }\n                // workaround duly applied, this now works\n                for (var i=1,ilen=lst.length; i<ilen; i+=3) {\n                    lst[i + 1] = epochMap[lst[i]] + parseInt(lst[i + 1], 10);\n                    lst[i] = \"\";\n                }\n                txt = lst.join(\"\");\n                txt = txt.replace(/\\s*-\\s*$/, \"\").replace(/\\s*-\\s*\\//, \"/\");\n                //\n                // normalize date and identify delimiters\n                //\n                txt = txt.replace(/\\.\\s*$/, \"\");\n\n                // not sure what this is meant to do\n                txt = txt.replace(/\\.(?! )/, \"\");\n\n                slashPos = txt.indexOf(\"/\");\n                dashPos = txt.indexOf(\"-\");\n            }\n        }\n        // drop punctuation from a.d., b.c.\n        txt = txt.replace(/([A-Za-z])\\./g, \"$1\");\n\n        var number = \"\";\n        var note = \"\";\n        var thedate = {};\n        var rangeDelim;\n        var dateDelim;\n        if (txt.slice(0, 1) === \"\\\"\" && txt.slice(-1) === \"\\\"\") {\n            thedate.literal = txt.slice(1, -1);\n            return thedate;\n        }\n        if (slashPos > -1 && dashPos > -1) {\n            var slashCount = txt.split(\"/\");\n            if (slashCount.length > 3) {\n                rangeDelim = \"-\";\n                txt = txt.replace(/\\_/g, \"-\");\n                dateDelim = \"/\";\n                lst = txt.split(rexSlashDash);\n            } else {\n                rangeDelim = \"/\";\n                txt = txt.replace(/\\_/g, \"/\");\n                dateDelim = \"-\";\n                lst = txt.split(rexDashSlash);\n            }\n        } else {\n            txt = txt.replace(/\\//g, \"-\");\n            txt = txt.replace(/\\_/g, \"-\");\n            rangeDelim = \"-\";\n            dateDelim = \"-\";\n            lst = txt.split(rexDash);\n        }\n        var ret = [];\n        for (var i=0,ilen=lst.length; i<ilen; i++) {\n            var m = lst[i].match(/^\\s*([\\-\\/]|[^\\-\\/\\~\\?0-9]+|[\\-~?0-9]+)\\s*$/);\n            if (m) {\n                ret.push(m[1]);\n            }\n        }\n        //\n        // Phase 2\n        //\n        var delimPos = ret.indexOf(rangeDelim);\n        var delims = [];\n        var isRange = false;\n        if (delimPos > -1) {\n            delims.push([0, delimPos]);\n            delims.push([(delimPos + 1), ret.length]);\n            isRange = true;\n        } else {\n            delims.push([0, ret.length]);\n        }\n        //\n        // For each side of a range divide ...\n        //\n        var suff = \"\";\n        \n        for (var i=0,ilen=delims.length; i<ilen; i++) {\n            var delim = delims[i];\n            //\n            // Process each element ...\n            //\n            var date = ret.slice(delim[0], delim[1]);\n            outer: \n            for (var j=0,jlen=date.length; j<jlen; j++) {\n                var element = date[j];\n                //\n                // If it's a numeric date, process it.\n                //\n                if (element.indexOf(dateDelim) > -1) {\n                    this._parseNumericDate(thedate, dateDelim, suff, element);\n                    continue;\n                }\n                //\n                // If it's an obvious year, record it.\n                //\n                if (element.match(/[0-9]{4}/)) {\n                    thedate[(\"year\" + suff)] = element.replace(/^0*/, \"\");\n                    continue;\n                }\n                //\n                // If it's a fuzzy marker, record it.\n                //\n                if (element === \"~\" || element === \"?\" || element === \"c\" || element.match(/^cir/)) {\n                    thedate.circa = true;\n                }\n                //\n                // If it's a month, record it.\n                //\n                for (var k=0,klen=this.monthRexes.length; k<klen; k++) {\n                    if (element.toLocaleLowerCase().match(this.monthRexes[k])) {\n                        thedate[(\"month\" + suff)] = \"\" + (parseInt(k, 10) + 1);\n                        continue outer;\n                    }\n                }\n                //\n                // If it's a number, make a note of it\n                //\n                if (element.match(/^[0-9]+$/)) {\n                    number = element;\n                }\n                //\n                // If it's a BC or AD marker, make a year of\n                // any note.  Separate, reverse the sign of the year\n                // if it's BC.\n                //\n                if (element.toLocaleLowerCase().match(/^bc/) && number) {\n                    thedate[(\"year\" + suff)] = \"\" + (number * -1);\n                    number = \"\";\n                    continue;\n                }\n                if (element.toLocaleLowerCase().match(/^ad/) && number) {\n                    thedate[(\"year\" + suff)] = \"\" + number;\n                    number = \"\";\n                    continue;\n                }\n                //\n                // If it's cruft, make a note of it\n                //\n                if (element.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/) && !thedate[(\"season\" + suff)]) {\n                    note = element;\n                    continue;\n                }\n            }\n            //\n            // If at the end of the string there's still a note\n            // hanging around, make a day of it.\n            //\n            if (number) {\n                thedate[(\"day\" + suff)] = number;\n                number = \"\";\n            }\n            //\n            // If at the end of the string there's cruft lying\n            // around, and the season field is empty, put the\n            // cruft there.\n            //\n            if (note && !thedate[(\"season\" + suff)]) {\n                thedate[(\"season\" + suff)] = note.trim();\n                note = \"\";\n            }\n            suff = \"_end\";\n        }\n        //\n        // update any missing elements on each side of the divide\n        // from the other\n        //\n        if (isRange) {\n            for (var j=0,jlen=CSL.DATE_PARTS_ALL.length; j<jlen; j++) {\n                var item = CSL.DATE_PARTS_ALL[j];\n                if (thedate[item] && !thedate[(item + \"_end\")]) {\n                    thedate[(item + \"_end\")] = thedate[item];\n                } else if (!thedate[item] && thedate[(item + \"_end\")]) {\n                    thedate[item] = thedate[(item + \"_end\")];\n                }\n            }\n        }\n        //\n        // If there's no year, or if there only a year and a day, it's a failure; pass through the literal\n        //\n        if (!thedate.year || (thedate.year && thedate.day && !thedate.month)) {\n            thedate = { \"literal\": orig };\n        }\n        var parts = [\"year\", \"month\", \"day\", \"year_end\", \"month_end\", \"day_end\"];\n        for (var i=0,ilen=parts.length; i<ilen; i++) {\n            var part = parts[i];\n            if (\"string\" === typeof thedate[part] && thedate[part].match(/^[0-9]+$/)) {\n                thedate[part] = parseInt(thedate[part], 10);\n            }\n            \n        }\n        if (yearIsNegative && Object.keys(thedate).indexOf(\"year\") > -1) {\n            thedate.year = (thedate.year * -1);\n        }\n        return thedate;\n    };\n\n    this.parseDateToArray = function(txt) {\n        return this.convertDateObjectToArray(this.parseDateToObject(txt));            \n    };\n\n    this.parseDateToString = function(txt) {\n        return this.convertDateObjectToString(this.parseDateToObject(txt));\n    };\n    \n    this.parse = function(txt) {\n        return this.parseDateToObject(txt);\n    };\n    \n    /*\n\n     * Setup\n     */\n\n    this.setOrderMonthDay();\n    this.resetDateParserMonths();\n};\nCSL.DateParser = new CSL.DateParser();\n\n/*global CSL: true */\n\nCSL.Engine = function (sys, style, lang, forceLang) {\n    var attrs, langspec;\n    this.processor_version = CSL.PROCESSOR_VERSION;\n    this.csl_version = \"1.0\";\n    this.sys = sys;\n    \n    if (typeof Object.assign != 'function') {\n        // Must be writable: true, enumerable: false, configurable: true\n        Object.defineProperty(Object, \"assign\", {\n            value: function assign(target) { // .length of function is 2\n                'use strict';\n                if (target == null) { // TypeError if undefined or null\n                    throw new TypeError('Cannot convert undefined or null to object');\n                }\n\n                var to = Object(target);\n\n                for (var index = 1; index < arguments.length; index++) {\n                    var nextSource = arguments[index];\n\n                    if (nextSource != null) { // Skip over if undefined or null\n                        for (var nextKey in nextSource) {\n                            // Avoid bugs when hasOwnProperty is shadowed\n                            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                                to[nextKey] = nextSource[nextKey];\n                            }\n                        }\n                    }\n                }\n                return to;\n            },\n            writable: true,\n            configurable: true\n        });\n    }\n\n    // XXX This may be excess code. Given the normalization performed on\n    // XXX the output queue before variableWrapper() is run, a single\n    // XXX space should be the most cruft that we ever see before a variable.\n    if (sys.variableWrapper) {\n        CSL.VARIABLE_WRAPPER_PREPUNCT_REX = new RegExp('^([' + [\" \"].concat(CSL.SWAPPING_PUNCTUATION).join(\"\") + ']*)(.*)');\n    }\n    // XXXX This should be restored -- temporarily suspended for testing of JSON style support.\n    if (CSL.retrieveStyleModule) {\n        this.sys.retrieveStyleModule = CSL.retrieveStyleModule;\n    }\n    if (CSL.getAbbreviation) {\n        this.sys.getAbbreviation = CSL.getAbbreviation;\n    }\n    if (this.sys.stringCompare) {\n        CSL.stringCompare = this.sys.stringCompare;\n    }\n    this.sys.AbbreviationSegments = CSL.AbbreviationSegments;\n\n    this.transform = new CSL.Transform(this);\n    // true or false\n    this.setParseNames = function (val) {\n        this.opt['parse-names'] = val;\n    };\n    \n    this.opt = new CSL.Engine.Opt();\n    this.tmp = new CSL.Engine.Tmp();\n    this.build = new CSL.Engine.Build();\n    this.fun = new CSL.Engine.Fun(this);\n\n    this.configure = new CSL.Engine.Configure();\n    // Build citation before citation_sort in order to pick up\n    // state.opt.update_mode, needed it determine whether\n    // a grouped sort should be performed.\n    this.citation_sort = new CSL.Engine.CitationSort();\n    this.bibliography_sort = new CSL.Engine.BibliographySort();\n    this.citation = new CSL.Engine.Citation(this);\n    this.bibliography = new CSL.Engine.Bibliography();\n    this.intext = new CSL.Engine.InText();\n\n    this.output = new CSL.Output.Queue(this);\n\n    //this.render = new CSL.Render(this);\n    //\n    // This latter queue is used for formatting date chunks\n    // before they are folded back into the main queue.\n    //\n    this.dateput = new CSL.Output.Queue(this);\n\n    this.cslXml = CSL.setupXml(style);\n\n    for (var i in CSL.SYS_OPTIONS) {\n        var option = CSL.SYS_OPTIONS[i];\n        if (\"boolean\" === typeof this.sys[option]) {\n            this.opt.development_extensions[option] = this.sys[option];\n        }\n        \n    }\n    if (this.opt.development_extensions.uppercase_subtitles || this.opt.development_extensions.implicit_short_title) {\n        this.opt.development_extensions.main_title_from_short_title = true;\n    }\n    if (this.opt.development_extensions.csl_reverse_lookup_support) {\n        this.build.cslNodeId = 0;\n        this.setCslNodeIds = function(myxml, nodename) {\n            var children = this.cslXml.children(myxml);\n            this.cslXml.setAttribute(myxml, 'cslid', this.build.cslNodeId);\n            this.opt.nodenames.push(nodename);\n            this.build.cslNodeId += 1;\n            for (var i = 0, ilen = this.cslXml.numberofnodes(children); i < ilen; i += 1) {\n                nodename = this.cslXml.nodename(children[i]);\n                if (nodename) {\n                    this.setCslNodeIds(children[i], nodename);\n                }\n            }\n        };\n        this.setCslNodeIds(this.cslXml.dataObj, \"style\");\n    }\n    // Preprocessing ops for the XML input\n    this.cslXml.addMissingNameNodes(this.cslXml.dataObj);\n    this.cslXml.addInstitutionNodes(this.cslXml.dataObj);\n    this.cslXml.insertPublisherAndPlace(this.cslXml.dataObj);\n    this.cslXml.flagDateMacros(this.cslXml.dataObj);\n    attrs = this.cslXml.attributes(this.cslXml.dataObj);\n    if (\"undefined\" === typeof attrs[\"@sort-separator\"]) {\n        this.cslXml.setAttribute(this.cslXml.dataObj, \"sort-separator\", \", \");\n    }\n    // This setting does the right thing and seems not to be side-effects\n    this.opt[\"initialize-with-hyphen\"] = true;\n\n    // Locale resolution\n    //\n    // (1) Get three locale strings \n    //     -- default-locale (stripped)\n    //     -- processor-locale\n    //     -- en_US\n    \n    this.setStyleAttributes();\n\n    this.opt.xclass = this.cslXml.getAttributeValue(this.cslXml.dataObj, \"class\");\n    this.opt[\"class\"] = this.opt.xclass;\n    this.opt.styleID = this.cslXml.getStyleId(this.cslXml.dataObj);\n    this.opt.styleName = this.cslXml.getStyleId(this.cslXml.dataObj, true);\n\n    if (this.opt.version.slice(0,4) === \"1.1m\") {\n        this.opt.development_extensions.consolidate_legal_items = true;\n        this.opt.development_extensions.consolidate_container_items = true;\n        this.opt.development_extensions.main_title_from_short_title = true;\n        this.opt.development_extensions.expect_and_symbol_form = true;\n        this.opt.development_extensions.require_explicit_legal_case_title_short = true;\n        this.opt.development_extensions.force_jurisdiction = true;\n        this.opt.development_extensions.force_title_abbrev_fallback = true;\n    }\n    // We seem to have two language specs flying around:\n    //   this.opt[\"default-locale\"], and this.opt.lang\n    // Keeping them aligned for safety's sake, pending\n    // eventual cleanup.\n    if (lang) {\n        lang = lang.replace(\"_\", \"-\");\n        lang = CSL.normalizeLocaleStr(lang);\n    }\n    if (this.opt[\"default-locale\"][0]) {\n        this.opt[\"default-locale\"][0] = this.opt[\"default-locale\"][0].replace(\"_\", \"-\");\n        this.opt[\"default-locale\"][0] = CSL.normalizeLocaleStr(this.opt[\"default-locale\"][0]);\n    }\n    if (lang && forceLang) {\n        this.opt[\"default-locale\"] = [lang];\n    }\n    if (lang && !forceLang && this.opt[\"default-locale\"][0]) {\n        lang = this.opt[\"default-locale\"][0];\n    }\n    if (this.opt[\"default-locale\"].length === 0) {\n        if (!lang) {\n            lang = \"en-US\";\n        }\n        this.opt[\"default-locale\"].push(\"en-US\");\n    }\n    if (!lang) {\n        lang = this.opt[\"default-locale\"][0];\n    }\n    langspec = CSL.localeResolve(lang);\n    this.opt.lang = langspec.best;\n    this.opt[\"default-locale\"][0] = langspec.best;\n    this.locale = {};\n    if (!this.opt[\"default-locale-sort\"]) {\n        this.opt[\"default-locale-sort\"] = this.opt[\"default-locale\"][0];\n    }\n    // Test processor against JS engine locale mess to find a field separator that works\n    if ('dale|'.localeCompare('daleb', this.opt[\"default-locale-sort\"]) > -1) {\n        this.opt.sort_sep = \"@\";\n    } else {\n        this.opt.sort_sep = \"|\";\n    }\n    this.localeConfigure(langspec);\n\n    // Build skip-word regexp\n    function makeRegExp(lst) {\n        var lst = lst.slice();\n        var ret = new RegExp( \"(?:(?:[?!:]*\\\\s+|-|^)(?:\" + lst.join(\"|\") + \")(?=[!?:]*\\\\s+|-|$))\", \"g\");\n        return ret;\n    }\n    this.locale[this.opt.lang].opts[\"skip-words-regexp\"] = makeRegExp(this.locale[this.opt.lang].opts[\"skip-words\"]);\n\n    this.output.adjust = new CSL.Output.Queue.adjust(this.getOpt('punctuation-in-quote'));\n\n    this.registry = new CSL.Registry(this);\n\n    // XXX For modular jurisdiction support, parameterize buildTokenLists().\n    // XXX Feed as arguments:\n    // XXX * actual node to be walked (cslXml)\n    // XXX * actual target array\n\n    this.macros = {};\n\n    this.build.area = \"citation\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    this.build.area = \"bibliography\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    this.build.area = \"intext\";\n    var area_nodes = this.cslXml.getNodesByName(this.cslXml.dataObj, this.build.area);\n    this.buildTokenLists(area_nodes, this[this.build.area].tokens);\n\n    if (this.opt.parallel.enable) {\n        this.parallel = new CSL.Parallel(this);\n    }\n\n    this.juris = {};\n\n    this.configureTokenLists();\n\n    this.disambiguate = new CSL.Disambiguation(this);\n\n    this.splice_delimiter = false;\n\n    //\n    // date parser\n    //\n    this.fun.dateparser = CSL.DateParser;\n    //\n    // flip-flopper for inline markup\n    //\n    this.fun.flipflopper = new CSL.Util.FlipFlopper(this);\n    //\n    // utility functions for quotes\n    //\n    this.setCloseQuotesArray();\n    //\n    // configure ordinal numbers generator\n    //\n    this.fun.ordinalizer.init(this);\n    //\n    // configure long ordinal numbers generator\n    //\n    this.fun.long_ordinalizer.init(this);\n    //\n    // set up page mangler\n    //\n    this.fun.page_mangler = CSL.Util.PageRangeMangler.getFunction(this, \"page\");\n    this.fun.year_mangler = CSL.Util.PageRangeMangler.getFunction(this, \"year\");\n\n    this.setOutputFormat(\"html\");\n};\n\nCSL.Engine.prototype.setCloseQuotesArray = function () {\n    var ret;\n    ret = [];\n    ret.push(this.getTerm(\"close-quote\"));\n    ret.push(this.getTerm(\"close-inner-quote\"));\n    ret.push('\"');\n    ret.push(\"'\");\n    this.opt.close_quotes_array = ret;\n};\n\n// Walker for preparsed XML input\nCSL.makeBuilder = function (me, target) {\n    var var_stack = [];\n    var node_stack = [];\n    function runStart (node) {\n        node_stack.push(node);\n        CSL.XmlToToken.call(node, me, CSL.START, target, var_stack);\n    }\n    function runEnd () {\n        var node = node_stack.pop();\n        CSL.XmlToToken.call(node, me, CSL.END, target, var_stack);\n    }\n    function runSingle (node) {\n        CSL.XmlToToken.call(node, me, CSL.SINGLETON, target, var_stack);\n    }\n    function buildStyle (nodes, parent, node_stack) {\n        if (!node_stack) {\n            node_stack = [];\n        }\n        if (!nodes) {\n            nodes = [];\n        }\n        if (\"undefined\" === typeof nodes.length) {\n            nodes = [nodes];\n        }\n        for (var i=0; i<nodes.length; i++) {\n            var node = nodes[i];\n            if (me.cslXml.nodename(node) === null) {\n                continue;\n            }\n            if (parent && me.cslXml.nodename(node) === \"date\") {\n                CSL.Util.fixDateNode.call(me, parent, i, node);\n                node = me.cslXml.children(parent)[i];\n            }\n            if (me.cslXml.numberofnodes(me.cslXml.children(node))) {\n                runStart(node);\n                buildStyle(me.cslXml.children(node), node, node_stack);\n                runEnd();\n            } else {\n                runSingle(node);\n            }\n        }\n    }\n    return buildStyle;\n};\n\n\nCSL.Engine.prototype.buildTokenLists = function (area_nodes, target) {\n    if (!this.cslXml.getNodeValue(area_nodes)) {\n        return;\n    }\n    var builder = CSL.makeBuilder(this, target);\n    var mynode;\n    if (\"undefined\" === typeof area_nodes.length) {\n        mynode = area_nodes;\n    } else {\n        mynode = area_nodes[0];\n    }\n    builder(mynode);\n};\n\n\nCSL.Engine.prototype.setStyleAttributes = function () {\n    var dummy, attributes, attrname;\n    // Protect against DOM engines that deliver a top-level document\n    // (needed for createElement) that does not contain our top-level node.\n    // \n    // The string coercion on this.cslXml.tagName addresses a bizarre\n    // condition on the top-level node in jsdom running under node.js, in which:\n    //   (1) typeof this.cslXml.tagName === \"undefined\"; and\n    //   (2) !this.cslXml.tagName === false\n    // Coerced, it becomes an empty string.\n    var dummy = {};\n    dummy.name = this.cslXml.nodename(this.cslXml.dataObj);\n    attributes = this.cslXml.attributes(this.cslXml.dataObj);\n    for (attrname in attributes) {\n        if (attributes.hasOwnProperty(attrname)) {\n            // attr = attributes[key];\n            CSL.Attributes[attrname].call(dummy, this, attributes[attrname]);\n        }\n    }\n};\n\nCSL.Engine.prototype.getTerm = function (term, form, plural, gender, mode, forceDefaultLocale) {\n    if (term && term.match(/[A-Z]/) && term === term.toUpperCase()) {\n        CSL.debug(\"Warning: term key is in uppercase form: \"+term);\n        term = term.toLowerCase();\n    }\n    var lang;\n    if (forceDefaultLocale) {\n        lang = this.opt[\"default-locale\"][0];\n    } else {\n        lang = this.opt.lang;\n    }\n    var ret = CSL.Engine.getField(CSL.LOOSE, this.locale[lang].terms, term, form, plural, gender);\n    // XXXXX Temporary, until locale term is deployed in CSL.\n    if (!ret && term === \"range-delimiter\") {\n        ret = \"\\u2013\";\n    }\n    // XXXXX Not so good if mode is neither strict nor tolerant ...\n    if (typeof ret === \"undefined\") {\n        if (mode === CSL.STRICT) {\n            CSL.error(\"Error in getTerm: term \\\"\" + term + \"\\\" does not exist.\");\n        } else if (mode === CSL.TOLERANT) {\n            ret = \"\";\n        }\n    }\n    if (ret) {\n        this.tmp.cite_renders_content = true;\n    }\n    return ret;\n};\n\nCSL.Engine.prototype.getDate = function (form, forceDefaultLocale) {\n    var lang;\n    if (forceDefaultLocale) {\n        lang = this.opt[\"default-locale\"];\n    } else {\n        lang = this.opt.lang;\n    }\n    if (this.locale[lang].dates[form]) {\n        return this.locale[lang].dates[form];\n    } else {\n        return false;\n    }\n};\n\nCSL.Engine.prototype.getOpt = function (arg) {\n    if (\"undefined\" !== typeof this.locale[this.opt.lang].opts[arg]) {\n        return this.locale[this.opt.lang].opts[arg];\n    } else {\n        return false;\n    }\n};\n\n\n\nCSL.Engine.prototype.getVariable = function (Item, varname, form, plural) {\n    return CSL.Engine.getField(CSL.LOOSE, Item, varname, form, plural);\n};\n\nCSL.Engine.prototype.getDateNum = function (ItemField, partname) {\n    if (\"undefined\" === typeof ItemField) {\n        return 0;\n    } else {\n        return ItemField[partname];\n    }\n};\n\nCSL.Engine.getField = function (mode, hash, term, form, plural, gender) {\n    var ret, forms, f, pos, len, hashterm;\n    ret = \"\";\n    if (\"undefined\" === typeof hash[term]) {\n        if (mode === CSL.STRICT) {\n            CSL.error(\"Error in getField: term \\\"\" + term + \"\\\" does not exist.\");\n        } else {\n            return undefined;\n        }\n    }\n    if (gender && hash[term][gender]) {\n        hashterm = hash[term][gender];\n    } else {\n        hashterm = hash[term];\n    }\n    forms = [];\n    if (form === \"symbol\") {\n        forms = [\"symbol\", \"short\"];\n    } else if (form === \"verb-short\") {\n        forms = [\"verb-short\", \"verb\"];\n    } else if (form !== \"long\") {\n        forms = [form];\n    }\n    forms = forms.concat([\"long\"]);\n    len = forms.length;\n    for (pos = 0; pos < len; pos += 1) {\n        f = forms[pos];\n        if (\"string\" === typeof hashterm || \"number\" === typeof hashterm) {\n            ret = hashterm;\n        } else if (\"undefined\" !== typeof hashterm[f]) {\n            if (\"string\" === typeof hashterm[f] || \"number\" === typeof hashterm[f]) {\n                ret = hashterm[f];\n            } else {\n                if (\"number\" === typeof plural) {\n                    ret = hashterm[f][plural];\n                } else {\n                    ret = hashterm[f][0];\n                }\n            }\n            break;\n        }\n    }\n    return ret;\n};\n\nCSL.Engine.prototype.configureTokenLists = function () {\n    var area, pos, len;\n    //for each (var area in [\"citation\", \"citation_sort\", \"bibliography\",\"bibliography_sort\"]) {\n    len = CSL.AREAS.length;\n    for (pos = 0; pos < len; pos += 1) {\n        //var ret = [];\n        area = CSL.AREAS[pos];\n        var tokens = this[area].tokens;\n        this.configureTokenList(tokens);\n    }\n    this.version = CSL.version;\n    return this.state;\n};\n\nCSL.Engine.prototype.configureTokenList = function (tokens) {\n    var dateparts_master, token, dateparts, part, ppos, pppos, llen, lllen;\n    dateparts_master = [\"year\", \"month\", \"day\"];\n    llen = tokens.length - 1;\n    for (ppos = llen; ppos > -1; ppos += -1) {\n        token = tokens[ppos];\n        //token.pos = ppos;\n        //ret.push(token);\n        if (\"date\" === token.name && CSL.END === token.tokentype) {\n            dateparts = [];\n        }\n        if (\"date-part\" === token.name && token.strings.name) {\n            lllen = dateparts_master.length;\n            for (pppos = 0; pppos < lllen; pppos += 1) {\n                part = dateparts_master[pppos];\n                if (part === token.strings.name) {\n                    dateparts.push(token.strings.name);\n                }\n            }\n        }\n        if (\"date\" === token.name && CSL.START === token.tokentype) {\n            dateparts.reverse();\n            token.dateparts = dateparts;\n        }\n        token.next = (ppos + 1);\n        if (token.name && CSL.Node[token.name].configure) {\n            CSL.Node[token.name].configure.call(token, this, ppos);\n        }\n    }\n};\n\nCSL.Engine.prototype.refetchItems = function (ids) {\n    var ret = [];\n    for (var i = 0, ilen = ids.length; i < ilen; i += 1) {\n        ret.push(this.refetchItem(\"\" + ids[i]));\n    }\n    return ret;\n};\n\nCSL.ITERATION = 0;\n\n// Wrapper for sys.retrieveItem supplied by calling application.\n// Adds experimental fields embedded in the note field for\n// style development trial and testing purposes.\nCSL.Engine.prototype.retrieveItem = function (id) {\n    var Item, m, i;\n\n    if (!this.tmp.loadedItemIDs[id]) {\n        this.tmp.loadedItemIDs[id] = true;\n    } else {\n        return this.registry.refhash[id];\n    }\n\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase &&\n        \"boolean\" === typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        // This is a hack. Should properly be configured by a processor method after build.\n        for (var i=0,ilen=this.opt[\"default-locale\"].length; i<ilen; i+=1) {\n            this.opt[\"default-locale\"][i] = this.opt[\"default-locale\"][i].toLowerCase();\n        }\n        for (var i=0,ilen=this.opt[\"locale-translit\"].length; i<ilen; i+=1) {\n            this.opt[\"locale-translit\"][i] = this.opt[\"locale-translit\"][i].toLowerCase();\n        }\n        for (var i=0,ilen=this.opt[\"locale-translat\"].length; i<ilen; i+=1) {\n            this.opt[\"locale-translat\"][i] = this.opt[\"locale-translat\"][i].toLowerCase();\n        }\n        this.opt.development_extensions.normalize_lang_keys_to_lowercase = 100;\n    }\n\n    //Zotero.debug(\"XXX === ITERATION \" + CSL.ITERATION + \" \"+ id +\" ===\");\n    CSL.ITERATION += 1;\n\n    Item = JSON.parse(JSON.stringify(this.sys.retrieveItem(\"\" + id)));\n\n    // Optionally normalize keys to lowercase()\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        if (Item.multi) {\n            if (Item.multi._keys) {\n                for (var field in Item.multi._keys) {\n                    for (var key in Item.multi._keys[field]) {\n                        if (key !== key.toLowerCase()) {\n                            Item.multi._keys[field][key.toLowerCase()] = Item.multi._keys[field][key];\n                            delete Item.multi._keys[field][key];\n                        }\n                    }\n                }\n            }\n            if (Item.multi.main) {\n                for (var field in Item.multi.main) {\n                    Item.multi.main[field] = Item.multi.main[field].toLowerCase();\n                }\n            }\n        }\n        for (var i=0, ilen=CSL.NAME_VARIABLES.length; i>ilen; i+=1) {\n            var ctype = CSL.NAME_VARIABLES[i];\n            if (Item[ctype] && Item[ctype].multi) {\n                for (var j=0, jlen=Item[ctype].length; j<jlen; j+=1) {\n                    var creator = Item[ctype][j];\n                    if (creator.multi) {\n                        if (creator.multi._key) {\n                            for (var key in creator.multi._key) {\n                                if (key !== key.toLowerCase()) {\n                                    creator.multi._key[key.toLowerCase()] = creator.multi._key[key];\n                                    delete creator.multi._key[key];\n                                }\n                            }\n                        }\n                        if (creator.multi.main) {\n                            creator.multi.main = creator.multi.main.toLowerCase();\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // Normalize language field into \"language\" and \"language-original\"\n    if (Item.language && Item.language.match(/[><]/)) {\n        // Attempt to split field in two\n        var m = Item.language.match(/(.*?)([<>])(.*)/);\n        if (m[2] === \"<\") {\n            Item[\"language-name\"] = m[1];\n            Item[\"language-name-original\"] = m[3];\n        } else {\n            Item[\"language-name\"] = m[3];\n            Item[\"language-name-original\"] = m[1];\n        }\n        if (this.opt.multi_layout) {\n            if (Item[\"language-name-original\"]) {\n                Item.language = Item[\"language-name-original\"];\n            }\n        } else {\n            if (Item[\"language-name\"]) {\n                Item.language = Item[\"language-name\"];\n            }\n        }\n    }\n\n    if (Item.page) {\n        Item[\"page-first\"] = Item.page;\n        var num = \"\" + Item.page;\n        var m = num.split(/\\s*(?:&|, |-|\\u2013)\\s*/);\n        if (m[0].slice(-1) !== \"\\\\\") {\n            Item[\"page-first\"] = m[0];\n        }\n    }\n    // Optional development extensions\n    if (this.opt.development_extensions.field_hack && Item.note) {\n        // false is for validFieldsForType (all conforming entries scrubbed when false)\n        CSL.parseNoteFieldHacks(Item, false, this.opt.development_extensions.allow_field_hack_date_override);\n    }\n    // not including locator-date\n    for (var key in Item) {\n        if (CSL.DATE_VARIABLES.indexOf(key.replace(/^alt-/, \"\")) > -1) {\n            var dateobj = Item[key];\n            if (dateobj) {\n                // raw date parsing is harmless, but can be disabled if desired\n                if (this.opt.development_extensions.raw_date_parsing) {\n                    if (dateobj.raw && (!dateobj[\"date-parts\"] || dateobj[\"date-parts\"].length === 0)) {\n                        dateobj = this.fun.dateparser.parseDateToObject(dateobj.raw);\n                    }\n                }\n                Item[key] = this.dateParseArray(dateobj);\n            }\n        }\n    }\n    if (this.opt.development_extensions.consolidate_legal_items) {\n        if (Item.type && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1) {\n            var varname;\n            var elements = [\"type\", \"title\", \"jurisdiction\", \"genre\", \"volume\", \"container-title\"];\n            var legislation_id = [];\n            for (var i = 0, ilen = elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname]) {\n\t\t\t\t\tlegislation_id.push(Item[varname]);\n\t\t\t\t}\n\t\t\t}\n            elements = [\"original-date\", \"issued\"];\n\t\t\tfor (var i = 0, ilen=elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname] && Item[varname].year) {\n\t\t\t\t\tvar value = Item[varname].year;\n\t\t\t\t\tlegislation_id.push(value);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tItem.legislation_id = legislation_id.join(\"::\");\n        }\n    }\n    if (this.bibliography.opt.track_container_items) {\n        if (this.bibliography.opt.track_container_items.indexOf(Item.type) > -1) {\n            var varname;\n            var elements = [\"type\", \"container-title\", \"publisher\", \"edition\"];\n            var container_id = [];\n            for (var i = 0, ilen = elements.length; i < ilen; i += 1) {\n                varname = elements[i];\n\t\t\t\tif (Item[varname]) {\n\t\t\t\t\tcontainer_id.push(Item[varname]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tItem.container_id = container_id.join(\"::\");\n        }\n    }\n    // For authority to name shape in legal styles\n    if (this.opt.development_extensions.force_jurisdiction) {\n        if (\"string\" === typeof Item.authority) {\n            Item.authority = [\n                {\n                    literal: Item.authority,\n                    multi: {\n                        _key: {}\n                    }\n                }\n            ];\n            if (Item.multi && Item.multi._keys && Item.multi._keys.authority) {\n                Item.authority[0].multi._key = {};\n                for (var key in Item.multi._keys.authority) {\n                    Item.authority[0].multi._key[key] = {\n                        literal: Item.multi._keys.authority[key]\n                    };\n                }\n            }\n        }\n    }\n    // Add getAbbreviation() call for title-short and container-title-short\n    if (!Item[\"title-short\"]) {\n        Item[\"title-short\"] = Item.shortTitle;\n    }\n    // Add support for main_title_from_short_title\n    if (this.opt.development_extensions.main_title_from_short_title) {\n        var narrowSpaceLocale = this.opt[\"default-locale\"][0].slice(0, 2).toLowerCase() === \"fr\";\n        CSL.extractTitleAndSubtitle.call(this, Item, narrowSpaceLocale);\n    }\n    var isLegalType = [\"bill\",\"legal_case\",\"legislation\",\"gazette\",\"regulation\"].indexOf(Item.type) > -1;\n    if (this.opt.development_extensions.force_jurisdiction && isLegalType) {\n        if (!Item.jurisdiction) {\n            Item.jurisdiction = \"us\";\n        }\n    }\n    var normalizedKey;\n    if (!isLegalType && Item.title && this.sys.getAbbreviation) {\n        var noHints = false;\n        if (!Item.jurisdiction) {\n            noHints = true;\n        }\n        if (this.sys.normalizeAbbrevsKey) {\n             normalizedKey = this.sys.normalizeAbbrevsKey(\"title\", Item.title);\n        } else {\n            normalizedKey = Item.title;\n        }\n        var jurisdiction = this.transform.loadAbbreviation(Item.jurisdiction, \"title\", normalizedKey, Item.language);\n        if (this.transform.abbrevs[jurisdiction].title) {\n            if (this.transform.abbrevs[jurisdiction].title[normalizedKey]) {\n                Item[\"title-short\"] = this.transform.abbrevs[jurisdiction].title[normalizedKey];\n            }\n        }\n    }\n    if (!Item[\"container-title-short\"]) {\n        Item[\"container-title-short\"] = Item.journalAbbreviation;\n    }\n    if (Item[\"container-title\"] && this.sys.getAbbreviation) {\n        if (this.sys.normalizeAbbrevsKey) {\n            normalizedKey = this.sys.normalizeAbbrevsKey(Item[\"container-title\"]);\n        } else {\n            normalizedKey = Item[\"container-title\"];\n        }\n        var jurisdiction = this.transform.loadAbbreviation(Item.jurisdiction, \"container-title\", normalizedKey, Item.language);\n        if (this.transform.abbrevs[jurisdiction][\"container-title\"]) {\n            if (this.transform.abbrevs[jurisdiction][\"container-title\"][normalizedKey]) {\n                Item[\"container-title-short\"] = this.transform.abbrevs[jurisdiction][\"container-title\"][normalizedKey];\n            }\n        }\n    }\n    if (Item.jurisdiction) {\n        Item.country = Item.jurisdiction.split(\":\")[0];\n    }\n    if (this.registry.refhash[id]) {\n        if (JSON.stringify(this.registry.refhash[id]) != JSON.stringify(Item)) {\n            for (var key in this.registry.refhash[id]) {\n                delete this.registry.refhash[id][key];\n            }\n            this.tmp.taintedItemIDs[Item.id] = true;\n            Object.assign(this.registry.refhash[id], Item);\n        }\n    } else {\n        this.registry.refhash[id] = Item;\n    }\n    return this.registry.refhash[id];\n};\n\nCSL.Engine.prototype.refetchItem = function (id) {\n    return this.registry.refhash[id];\n};\n\n// Executed during style build\nCSL.Engine.prototype.setOpt = function (token, name, value) {\n    if (token.name === \"style\" || token.name === \"cslstyle\") {\n        this.opt.inheritedAttributes[name] = value;\n        this.citation.opt.inheritedAttributes[name] = value;\n        this.bibliography.opt.inheritedAttributes[name] = value;\n    } else if ([\"citation\", \"bibliography\"].indexOf(token.name) > -1) {\n        this[token.name].opt.inheritedAttributes[name] = value;\n    } else {\n        token.strings[name] = value;\n    }\n};\n\n// Executed at runtime, since macros can occur in the context of citation or bibliography\nCSL.Engine.prototype.inheritOpt = function (token, attrname, parentname, defaultValue) {\n    if (\"undefined\" !== typeof token.strings[attrname]) {\n        return token.strings[attrname];\n    } else {\n        var parentValue = this[this.tmp.root].opt.inheritedAttributes[parentname ? parentname : attrname];\n        if (\"undefined\" !== typeof parentValue) {\n            return parentValue;\n        } else {\n            return defaultValue;\n        }\n    }\n};\n\nCSL.Engine.prototype.remapSectionVariable = function (inputList) {\n    // We have items with a value in the section field (on Item) that must\n    // be mapped to the locator field (on item). We simply prepend it as\n    // a string here, and handle all parsing of the resulting string\n    // in processNumber(). Plurals and numeric are set in processNumber().\n    \n    // Because the target is in the citation item (lowercase), the\n    // remapping cannot take place when the Item data is received.\n    // Citation provides a list of Item/item pairs, hence the iteration\n    // used here.\n    for (var i = 0, ilen = inputList.length; i < ilen; i += 1) {\n        var Item = inputList[i][0];\n        var item = inputList[i][1];\n\n        if ([\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1) {\n             // If a locator value exists, then\n            //   (a) Leave be an overriding label at the start of the locator field, defaulting to label value\n            if (item.locator) {\n                item.locator = item.locator.trim();\n                var m = item.locator.match(CSL.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);\n                if (!m) {\n                    if (item.label) {\n                        item.locator = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[item.label] + \" \" + item.locator;\n                    } else {\n                        item.locator = \"p. \" + item.locator;\n                    }\n                }\n            }\n            // If a section value exists, then\n            //   (a) Apply an overriding label at the start of the section field, defaulting to sec.\n            var sectionMasterLabel = null;\n            if (Item.section) {\n                Item.section = Item.section.trim();\n                var m = Item.section.match(CSL.STATUTE_SUBDIV_PLAIN_REGEX_FRONT);\n                if (!m) {\n                    Item.section = \"sec. \" + Item.section;\n                    sectionMasterLabel = \"sec.\";\n                } else {\n                    sectionMasterLabel = m[0].trim();\n                }\n            }\n            // If section is nil, then\n            //   (a) Do nothing\n            if (Item.section) {\n            // If section exists and locator is nil\n            //   (a) Set section string in locator field\n                if (!item.locator) {\n                    item.locator = Item.section;\n                } else {\n            // If both section and locator exist, then\n            //   (a) If locator starts with p., remove p., merge with space or no-space, and set in locator field\n            //   (b) If locator starts with non-p., prepend section value to locator with space, and set in locator field\n                    var m = item.locator.match(/^([^ ]*)\\s*(.*)/);\n                    var space = \" \";\n                    if (m) {\n                        if (m[1] === \"p.\" && sectionMasterLabel !== \"p.\") {\n                            item.locator = m[2];\n                        }\n                        if ([\"[\", \"(\", \".\", \",\", \";\", \":\", \"?\"].indexOf(item.locator.slice(0, 1)) > -1) {\n                            space = \"\";\n                        }\n                    } else {\n                       space = \"\"; \n                    }\n                    item.locator = Item.section + space + item.locator;\n                }\n                //Item.section = \"\";\n            }\n            item.label = \"\";\n            // And that's it. Pre-parse complete.\n        }\n    }\n};\n\n\nCSL.Engine.prototype.setNumberLabels = function (Item) {\n     if (Item.number\n        && [\"bill\", \"gazette\", \"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) > -1\n        && this.opt.development_extensions.consolidate_legal_items\n        && !this.tmp.shadow_numbers[\"number\"]) {\n\n        this.tmp.shadow_numbers[\"number\"] = {};\n        this.tmp.shadow_numbers[\"number\"].values = [];\n        this.tmp.shadow_numbers[\"number\"].plural = 0;\n        this.tmp.shadow_numbers[\"number\"].numeric = false;\n        this.tmp.shadow_numbers[\"number\"].label = false;\n        \n        // Labels embedded in number variable\n        var value = \"\" + Item.number;\n        value = value.split(\"\\\\\").join(\"\");\n        // Get first word, parse out labels only if it parses\n        var firstword = value.split(/\\s+/)[0];\n        var firstlabel = CSL.STATUTE_SUBDIV_STRINGS[firstword];\n        if (firstlabel) {\n            // Get list and match\n            var splt = value.split(CSL.STATUTE_SUBDIV_PLAIN_REGEX);\n            if (splt.length > 1) {\n                // Convert matches to localized form\n                var lst = [];\n                for (var j=1, jlen=splt.length; j < jlen; j += 1) {\n                    lst.push(splt[j].replace(/\\s*$/, \"\").replace(/^\\s*/, \"\"));\n                }\n                // Preemptively save to shadow_numbers\n                value = lst.join(\" \");\n            } else {\n                value = splt[0];\n            }\n            this.tmp.shadow_numbers[\"number\"].label = firstlabel;\n            this.tmp.shadow_numbers[\"number\"].values.push([\"Blob\", value, false]);\n            this.tmp.shadow_numbers[\"number\"].numeric = false;\n        } else {\n            this.tmp.shadow_numbers[\"number\"].values.push([\"Blob\", value, false]);\n            this.tmp.shadow_numbers[\"number\"].numeric = true;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.substituteOne = function (template) {\n    return function (state, list) {\n        if (!list) {\n            return \"\";\n        } else {\n            // (\"string\" === typeof list)\n            return template.replace(\"%%STRING%%\", list);\n        }\n    };\n};\n\n\n/**\n * Two-tiered substitutions gadget.\n * <p>This is used for\n * options like (now defunct) \"font-family\", where the option value\n * cannot be determined until the attribute is processed.\n * Need for this function might be reviewed at some point ...</p>\n * @param {String} template A template containing\n * <code>%%STRING%%</code> and <code>%%PARAM%%</code>\n * placeholders.  See {@link CSL.Output.Formats.html} for\n * examples.\n */\nCSL.substituteTwo = function (template) {\n    return function (param) {\n        var template2 = template.replace(\"%%PARAM%%\", param);\n        return function (state, list) {\n            if (!list) {\n                return \"\";\n            } else {\n                //(\"string\" === typeof list){\n                return template2.replace(\"%%STRING%%\", list);\n            }\n        };\n    };\n};\n\n/**\n * Generate string functions for designated output mode.\n * <p>Only \"html\" (the default) is supported at present.</p>\n * @param {String} mode Either \"html\" or \"rtf\", eventually.\n */\nCSL.Mode = function (mode) {\n    var decorations, params, param, func, val, args;\n    decorations = {};\n    params = CSL.Output.Formats[mode];\n    for (param in params) {\n        if (true) {\n\n            if (\"@\" !== param.slice(0, 1)) {\n                decorations[param] = params[param];\n                continue;\n            }\n            func = false;\n            val = params[param];\n            args = param.split('/');\n\n            if (typeof val === \"string\" && val.indexOf(\"%%STRING%%\") > -1)  {\n                if (val.indexOf(\"%%PARAM%%\") > -1) {\n                    func = CSL.substituteTwo(val);\n                } else {\n                    func = CSL.substituteOne(val);\n                }\n            } else if (typeof val === \"boolean\" && !val) {\n                func = CSL.Output.Formatters.passthrough;\n            } else if (typeof val === \"function\") {\n                func = val;\n            } else {\n                CSL.error(\"Bad \" + mode + \" config entry for \" + param + \": \" + val);\n            }\n\n            if (args.length === 1) {\n                decorations[args[0]] = func;\n            } else if (args.length === 2) {\n                if (!decorations[args[0]]) {\n                    decorations[args[0]] = {};\n                }\n                decorations[args[0]][args[1]] = func;\n            }\n        }\n    }\n    return decorations;\n};\n\n\n/**\n * Generate a separate list of formatting attributes.\n * <p>This generates a list of tuples containing attribute\n * information relevant to output formatting, in the order\n * fixed in the constant {@link CSL.FORMAT_KEY_SEQUENCE}.\n * This function is called during {@link CSL.Core.Build}.\n * Formatting hints are distilled to functions\n * later, in the second compilation pass ({@link CSL.Core.Configure}).</p>\n * @param {Object} state The state object returned by\n * {@link CSL.Engine}.\n * @param {Object} attributes The hash object containing\n * the attributes and values extracted from an XML node.\n */\nCSL.setDecorations = function (state, attributes) {\n    var ret, key, pos;\n    // This applies a fixed processing sequence\n    ret = [];\n    for (pos in CSL.FORMAT_KEY_SEQUENCE) {\n        if (true) {\n            var key = CSL.FORMAT_KEY_SEQUENCE[pos];\n            if (attributes[key]) {\n                ret.push([key, attributes[key]]);\n                delete attributes[key];\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.Doppeler = function(rexStr, stringMangler) {\n    var matchRex = new RegExp(\"(\" + rexStr + \")\", \"g\");\n    var splitRex = new RegExp(rexStr, \"g\");\n    this.split = function (str) {\n        // Normalize markup\n        if (stringMangler) {\n            str = stringMangler(str);\n        }\n        var match = str.match(matchRex);\n        if (!match) {\n            return {\n                tags: [],\n                strings: [str]\n            };\n        }\n        var split = str.split(splitRex);\n        for (var i=match.length-1; i> -1; i--) {\n            if (typeof match[i] === \"number\") {\n                match[i] = \"\";\n            }\n            var tag = match[i];\n            if (tag === \"\\'\" && split[i+1].length > 0) {\n                // Fixes https://forums.zotero.org/discussion/comment/294317\n                split[i+1] = match[i] + split[i+1];\n                match[i] = \"\";\n            }\n        }\n        return {\n            tags: match,\n            strings: split,\n            origStrings: split.slice()\n        };\n    };\n    this.join = function (obj) {\n        var lst = obj.strings.slice(-1);\n        for (var i=obj.tags.length-1; i>-1; i--) {\n            lst.push(obj.tags[i]);\n            lst.push(obj.strings[i]);\n        }\n        lst.reverse();\n        return lst.join(\"\");\n    };\n};\n\nCSL.Engine.prototype.normalDecorIsOrphan = function (blob, params) {\n    //print(\"params: \"+JSON.stringify(params));\n    if (params[1] === \"normal\") {\n        var use_param = false;\n        var all_the_decor;\n        if (this.tmp.area === \"citation\") {\n            all_the_decor = [this.citation.opt.layout_decorations].concat(blob.alldecor);\n        } else {\n            all_the_decor = blob.alldecor;\n        }\n        for (var k = all_the_decor.length - 1; k > -1; k += -1) {\n            //print(\"  all decor: \"+JSON.stringify(all_the_decor[k]));\n            for (var n = all_the_decor[k].length - 1; n > -1; n += -1) {\n                //print(\"  superior param\"+n+\": \"+all_the_decor[k][n][0]);\n                if (all_the_decor[k][n][0] === params[0]) {\n                    //print(\"  HIT!\");\n                    if (all_the_decor[k][n][1] !== \"normal\") {\n                        use_param = true;\n                    }\n                }\n            }\n        }\n        if (!use_param) {\n            return true;\n        }\n    }\n    return false;\n};\n\n/*global CSL: true */\n\n\nCSL.Engine.prototype.getCitationLabel = function (Item) {\n    var label = \"\";\n    var params = this.getTrigraphParams();\n    var config = params[0];\n    var myname = this.getTerm(\"reference\", \"short\", 0);\n    if (\"undefined\" === typeof myname) {\n        myname = \"reference\";\n    }\n    myname = myname.replace(\".\", \"\");\n    myname = myname.slice(0, 1).toUpperCase() + myname.slice(1);\n    for (var i = 0, ilen = CSL.NAME_VARIABLES.length; i < ilen; i += 1) {\n        var n = CSL.NAME_VARIABLES[i];\n        if (Item[n]) {\n            var names = Item[n];\n            if (names.length > params.length) {\n                config = params[params.length - 1];\n            } else {\n                config = params[names.length - 1];\n            }\n            for (var j = 0, jlen = names.length; j < jlen; j += 1) {\n                if (j === config.authors.length) {\n                    break;\n                }\n                var res = this.nameOutput.getName(names[j], \"locale-translit\", true);\n                var name = res.name;\n                if (name && name.family) {\n                    myname = name.family;\n                    myname = myname.replace(/^([ \\'\\u2019a-z]+\\s+)/, \"\");\n\n                } else if (name && name.literal) {\n                    myname = name.literal;\n                }\n                var m = myname.toLowerCase().match(/^(a\\s+|the\\s+|an\\s+)/);\n                if (m) {\n                    myname = myname.slice(m[1].length);\n                }\n                myname = myname.replace(CSL.ROMANESQUE_NOT_REGEXP, \"\");\n                if (!myname) {\n                    break;\n                }\n                myname = myname.slice(0, config.authors[j]);\n                if (myname.length > 1) {\n                    myname = myname.slice(0, 1).toUpperCase() + myname.slice(1).toLowerCase();\n                } else if (myname.length === 1) {\n                    myname = myname.toUpperCase();\n                }\n                label += myname;\n            }\n            break;\n        }\n    }\n    if (!label) {\n        // Try for something using title\n        if (Item.title) {\n            var skipWords = this.locale[this.opt.lang].opts[\"skip-words\"];\n            var lst = Item.title.split(/\\s+/);\n            for (var i = lst.length - 1; i > -1; i--) {\n                if (skipWords.indexOf(lst[i]) > -1) {\n                    lst = lst.slice(0, i).concat(lst.slice(i + 1));\n                }\n            }\n            var str = lst.join('');\n            str = str.slice(0, params[0].authors[0]);\n            if (str.length > 1) {\n                str = str.slice(0, 1).toUpperCase() + str.slice(1).toLowerCase();\n            } else if (str.length === 1) {\n                str = str.toUpperCase();\n            }\n            label = str;\n        }\n    }\n    var year = \"0000\";\n    if (Item.issued) {\n        if (Item.issued.year) {\n            year = \"\" + Item.issued.year;\n        }\n    }\n    year = year.slice((config.year * -1));\n    label = label + year;\n    return label;\n};\n\nCSL.Engine.prototype.getTrigraphParams = function () {\n    var params = [];\n    var ilst = this.opt.trigraph.split(\":\");\n    if (!this.opt.trigraph || this.opt.trigraph.slice(0,1) !== \"A\") {\n        CSL.error(\"Bad trigraph definition: \"+this.opt.trigraph);\n    }\n    for (var i = 0, ilen = ilst.length; i < ilen; i += 1) {\n        var str = ilst[i];\n        var config = {authors:[], year:0};\n        for (var j = 0, jlen = str.length; j < jlen; j += 1) {\n            switch (str.slice(j,j+1)) {\n            case \"A\":\n                config.authors.push(1);\n                break;\n            case \"a\":\n                config.authors[config.authors.length - 1] += 1;\n                break;\n            case \"0\":\n                config.year += 1;\n                break;\n            default:\n                CSL.error(\"Invalid character in trigraph definition: \"+this.opt.trigraph);\n            }\n        }\n        params.push(config);\n    }\n    return params;\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.setOutputFormat = function (mode) {\n    this.opt.mode = mode;\n    this.fun.decorate = CSL.Mode(mode);\n    if (!this.output[mode]) {\n        this.output[mode] = {};\n        this.output[mode].tmp = {};\n    }\n};\n\nCSL.Engine.prototype.getSortFunc = function () {\n    return function (a,b) {\n        a = a.split(\"-\");\n        b = b.split(\"-\");\n        if (a.length < b.length) {\n            return 1;\n        } else if (a.length > b.length) {\n            return -1;\n        } else {\n            a = a.slice(-1)[0];\n            b = b.slice(-1)[0];\n            if (a.length < b.length) {\n                return 1;\n            } else if (a.length > b.length) {\n                return -1;\n            } else {\n                return 0;\n            }\n        }\n    };\n};\n\nCSL.Engine.prototype.setLangTagsForCslSort = function (tags) {\n    var i, ilen;\n    if (tags) {\n        this.opt['locale-sort'] = [];\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-sort'].push(tags[i]);\n        }\n    }\n    this.opt['locale-sort'].sort(this.getSortFunc());\n};\n    \nCSL.Engine.prototype.setLangTagsForCslTransliteration = function (tags) {\n    var i, ilen;\n    this.opt['locale-translit'] = [];\n    if (tags) {\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-translit'].push(tags[i]);\n        }\n    }\n    this.opt['locale-translit'].sort(this.getSortFunc());\n};\n    \nCSL.Engine.prototype.setLangTagsForCslTranslation = function (tags) {\n    var i, ilen;\n    this.opt['locale-translat'] = [];\n    if (tags) {\n        for (i = 0, ilen = tags.length; i < ilen; i += 1) {\n            this.opt['locale-translat'].push(tags[i]);\n        }\n    }\n    this.opt['locale-translat'].sort(this.getSortFunc());\n};\n\nCSL.Engine.prototype.setLangPrefsForCites = function (obj, conv) {\n    var opt = this.opt['cite-lang-prefs'];\n    if (!conv) {\n        conv = function (key) {\n            return key.toLowerCase();\n        };\n    }\n    var segments = ['Persons', 'Institutions', 'Titles', 'Journals', 'Publishers', 'Places'];\n    // Set values in place\n    for (var i = 0, ilen = segments.length; i < ilen; i += 1) {\n        var clientSegment = conv(segments[i]);\n        var citeprocSegment = segments[i].toLowerCase();\n        if (!obj[clientSegment]) {\n            continue;\n        }\n        //\n        // Normalize the sequence of secondary and tertiary\n        // in the provided obj segment list.\n        //\n        var supplements = [];\n        while (obj[clientSegment].length > 1) {\n            supplements.push(obj[clientSegment].pop());\n        }\n        var sortval = {orig:1,translit:2,translat:3};\n        if (supplements.length === 2 && sortval[supplements[0]] < sortval[supplements[1]]) {\n            supplements.reverse();\n        }\n        while (supplements.length) {\n            obj[clientSegment].push(supplements.pop());\n        }\n        //\n        // normalization done.\n        //\n        var lst = opt[citeprocSegment];\n        while (lst.length) {\n            lst.pop();\n        }\n        for (var j = 0, jlen = obj[clientSegment].length; j < jlen; j += 1) {\n            lst.push(obj[clientSegment][j]);\n        }\n    }\n};\n\nCSL.Engine.prototype.setLangPrefsForCiteAffixes = function (affixList) {\n    if (affixList && affixList.length === 48) {\n        var affixes = this.opt.citeAffixes;\n        var count = 0;\n        var settings = [\"persons\", \"institutions\", \"titles\", \"journals\", \"publishers\", \"places\"];\n        var forms = [\"translit\", \"orig\", \"translit\", \"translat\"];\n        var value;\n        for (var i = 0, ilen = settings.length; i < ilen; i += 1) {\n            for (var j = 0, jlen = forms.length; j < jlen; j += 1) {\n                value = \"\";\n                if ((count % 8) === 4) {\n                    if (!affixes[settings[i]][\"locale-\"+forms[j]].prefix\n                        && !affixes[settings[i]][\"locale-\"+forms[j]].suffix) {\n\n                        value = affixList[count] ? affixList[count] : \"\";\n                        affixes[settings[i]][\"locale-\" + forms[j]].prefix = value;\n                        value = affixList[count] ? affixList[count + 1] : \"\";\n                        affixes[settings[i]][\"locale-\" + forms[j]].suffix = value;\n                    }\n                } else {\n                    value = affixList[count] ? affixList[count] : \"\";\n                    affixes[settings[i]][\"locale-\" + forms[j]].prefix = value;\n                    value = affixList[count] ? affixList[count + 1] : \"\";\n                    affixes[settings[i]][\"locale-\" + forms[j]].suffix = value;\n                }\n                count += 2;\n            }\n        }\n        this.opt.citeAffixes = affixes;\n    }\n};\n\nCSL.Engine.prototype.setAutoVietnameseNamesOption = function (arg) {\n    if (arg) {\n        this.opt[\"auto-vietnamese-names\"] = true;\n    } else {\n        this.opt[\"auto-vietnamese-names\"] = false;\n    }\n};\n\nCSL.Engine.prototype.setAbbreviations = function (arg) {\n    if (this.sys.setAbbreviations) {\n        this.sys.setAbbreviations(arg);\n    }\n};\n\nCSL.Engine.prototype.setSuppressTrailingPunctuation = function (arg) {\n    this.citation.opt.suppressTrailingPunctuation = !!arg;\n};\n\n/*global CSL: true */\n\nCSL.Output = {};\n/**\n * Output queue object.\n * @class\n */\nCSL.Output.Queue = function (state) {\n    this.levelname = [\"top\"];\n    this.state = state;\n    this.queue = [];\n    this.empty = new CSL.Token(\"empty\");\n    var tokenstore = {};\n    tokenstore.empty = this.empty;\n    this.formats = new CSL.Stack(tokenstore);\n    this.current = new CSL.Stack(this.queue);\n};\n\n// XXX This works, but causes a mismatch in api_cite\n// Could insert a placeholder\n// Better to have a function that spits out an independent blob.\n// Is that possible though?\n// Okay. Use queue.append() with fake_queue instead.\nCSL.Output.Queue.prototype.pop = function () {\n    // For some reason, state.output.current.value() here can be an array, \n    // not a blob ... ?\n    var drip = this.current.value();\n    if (drip.length) {\n        return drip.pop();\n    } else {\n        return drip.blobs.pop();\n    }\n};\n\nCSL.Output.Queue.prototype.getToken = function (name) {\n    var ret = this.formats.value()[name];\n    return ret;\n};\n\nCSL.Output.Queue.prototype.mergeTokenStrings = function (base, modifier) {\n    var base_token, modifier_token, ret, key;\n    base_token = this.formats.value()[base];\n    modifier_token = this.formats.value()[modifier];\n    ret = base_token;\n    if (modifier_token) {\n        if (!base_token) {\n            base_token = new CSL.Token(base, CSL.SINGLETON);\n            base_token.decorations = [];\n        }\n        ret = new CSL.Token(base, CSL.SINGLETON);\n        var key = \"\";\n        for (var key in base_token.strings) {\n            if (base_token.strings.hasOwnProperty(key)) {\n                ret.strings[key] = base_token.strings[key];\n            }\n        }\n        for (var key in modifier_token.strings) {\n            if (modifier_token.strings.hasOwnProperty(key)) {\n                ret.strings[key] = modifier_token.strings[key];\n            }\n        }\n        ret.decorations = base_token.decorations.concat(modifier_token.decorations);\n    }\n    return ret;\n};\n\n// Store a new output format token based on another\nCSL.Output.Queue.prototype.addToken = function (name, modifier, token) {\n    var newtok, attr;\n    newtok = new CSL.Token(\"output\");\n    if (\"string\" === typeof token) {\n        token = this.formats.value()[token];\n    }\n    if (token && token.strings) {\n        for (attr in token.strings) {\n            if (token.strings.hasOwnProperty(attr)) {\n                newtok.strings[attr] = token.strings[attr];\n            }\n        }\n        newtok.decorations = token.decorations;\n\n    }\n    if (\"string\" === typeof modifier) {\n        newtok.strings.delimiter = modifier;\n    }\n    this.formats.value()[name] = newtok;\n};\n\n//\n// newFormat adds a new bundle of formatting tokens to\n// the queue's internal stack of such bundles\nCSL.Output.Queue.prototype.pushFormats = function (tokenstore) {\n    if (!tokenstore) {\n        tokenstore = {};\n    }\n    tokenstore.empty = this.empty;\n    this.formats.push(tokenstore);\n};\n\n\nCSL.Output.Queue.prototype.popFormats = function () {\n    this.formats.pop();\n};\n\nCSL.Output.Queue.prototype.startTag = function (name, token) {\n    var tokenstore = {};\n    if (this.state.tmp[\"doing-macro-with-date\"] && this.state.tmp.extension) {\n        token = this.empty;\n        name = \"empty\";\n    }\n    tokenstore[name] = token;\n    this.pushFormats(tokenstore);\n    this.openLevel(name);\n};\n\nCSL.Output.Queue.prototype.endTag = function (name) {\n    this.closeLevel(name);\n    this.popFormats();\n};\n\n//\n// newlevel adds a new blob object to the end of the current\n// list, and adjusts the current pointer so that subsequent\n// appends are made to blob list of the new object.\n\nCSL.Output.Queue.prototype.openLevel = function (token) {\n    var blob, curr;\n    if (\"object\" === typeof token) {\n        // delimiter, prefix, suffix, decorations from token\n        blob = new CSL.Blob(undefined, token);\n    } else if (\"undefined\" === typeof token) {\n        blob = new CSL.Blob(undefined, this.formats.value().empty, \"empty\");\n    } else {\n        if (!this.formats.value() || !this.formats.value()[token]) {\n            CSL.error(\"CSL processor error: call to nonexistent format token \\\"\" + token + \"\\\"\");\n        }\n        // delimiter, prefix, suffix, decorations from token\n        blob = new CSL.Blob(undefined, this.formats.value()[token], token);\n    }\n    curr = this.current.value();\n    if (!this.state.tmp.just_looking && this.checkNestedBrace) {\n        blob.strings.prefix = this.checkNestedBrace.update(blob.strings.prefix);\n    }\n    curr.push(blob);\n    this.current.push(blob);\n};\n\n/**\n * \"merge\" used to be real complicated, now it's real simple.\n */\nCSL.Output.Queue.prototype.closeLevel = function (name) {\n    // CLEANUP: Okay, so this.current.value() holds the blob at the\n    // end of the current list.  This is wrong.  It should\n    // be the parent, so that we have  the choice of reading\n    // the affixes and decorations, or appending to its\n    // content.  The code that manipulates blobs will be\n    // much simpler that way.\n    if (name && name !== this.current.value().levelname) {\n        CSL.error(\"Level mismatch error:  wanted \" + name + \" but found \" + this.current.value().levelname);\n    }\n    var blob = this.current.pop();\n    if (!this.state.tmp.just_looking && this.checkNestedBrace) {\n        blob.strings.suffix = this.checkNestedBrace.update(blob.strings.suffix);\n    }\n};\n\n//\n// append does the same thing as newlevel, except\n// that the blob it pushes has text content,\n// and the current pointer is not moved after the push.\n\nCSL.Output.Queue.prototype.append = function (str, tokname, notSerious, ignorePredecessor, noStripPeriods) {\n    var token, blob, curr;\n    var useblob = true;\n    if (notSerious) {\n        ignorePredecessor = true;\n    }\n    // XXXXX Nasty workaround, but still an improvement\n    // over the reverse calls to the cs:date node build\n    // function that we had before.\n    if (this.state.tmp[\"doing-macro-with-date\"] && !notSerious) {\n        if (tokname !== \"macro-with-date\") {\n            return false;\n        }\n        if (tokname === \"macro-with-date\") {\n            tokname = \"empty\";\n        }\n    }\n    if (\"undefined\" === typeof str) {\n        return false;\n    }\n    if (\"number\" === typeof str) {\n        str = \"\" + str;\n    }\n    if (!notSerious \n        && this.state.tmp.element_trace \n        && this.state.tmp.element_trace.value() === \"suppress-me\") {\n        \n        return false;\n    }\n    blob = false;\n    if (!tokname) {\n        token = this.formats.value().empty;\n    } else if (tokname === \"literal\") {\n        token = true;\n        useblob = false;\n    } else if (\"string\" === typeof tokname) {\n        token = this.formats.value()[tokname];\n    } else {\n        token = tokname;\n    }\n    if (!token) {\n        CSL.error(\"CSL processor error: unknown format token name: \" + tokname);\n    }\n    // Unset delimiters must be left undefined until they reach the queue\n    // in order to discriminate unset from explicitly empty delimiters\n    // when inheriting a default value from a superior node. [??? really ???]\n    if (token.strings && \"undefined\" === typeof token.strings.delimiter) {\n        token.strings.delimiter = \"\";\n    }\n    if (\"string\" === typeof str && str.length) {\n\n        // Source (;?!): http://en.wikipedia.org/wiki/Space_(punctuation)#Breaking_and_non-breaking_spaces\n        // Source (:): http://forums.zotero.org/discussion/4933/localized-quotes/#Comment_88384\n        str = str.replace(/ ([:;?!\\u00bb])/g, \"\\u202f$1\").replace(/\\u00ab /g, \"\\u00ab\\u202f\");\n\n        this.last_char_rendered = str.slice(-1);\n        // This, and not the str argument below on flipflop, is the\n        // source of the flipflopper string source.\n        str = str.replace(/\\s+'/g, \" \\'\");\n        if (!notSerious) {\n            // this condition for sort_LeadingApostropheOnNameParticle\n            str = str.replace(/^'/g, \" \\'\");\n        }\n\n        // signal whether we end with terminal punctuation?\n        if (!ignorePredecessor) {\n            this.state.tmp.term_predecessor = true;\n            this.state.tmp.in_cite_predecessor = true;\n        } else if (notSerious) {\n            this.state.tmp.term_predecessor_name = true;\n        }\n    }\n    blob = new CSL.Blob(str, token);\n    curr = this.current.value();\n    if (\"undefined\" === typeof curr && this.current.mystack.length === 0) {\n        // XXXX An operation like this is missing somewhere, this should NOT be necessary.\n        // Addresses error triggered in multi-layouts.\n        this.current.mystack.push([]);\n        curr = this.current.value();\n    }\n    if (\"string\" === typeof blob.blobs) {\n        if (!ignorePredecessor) {\n            this.state.tmp.term_predecessor = true;\n            this.state.tmp.in_cite_predecessor = true;\n        } else if (notSerious) {\n            this.state.tmp.term_predecessor_name = true;\n        }\n    }\n    //\n    // Caution: The parallel detection machinery will blow up if tracking\n    // variables are not properly initialized elsewhere.\n    //\n    if (\"string\" === typeof str) {\n        if (\"string\" === typeof blob.blobs) {\n            if (blob.blobs.slice(0, 1) !== \" \") {\n                var blobPrefix = \"\";\n                var blobBlobs = blob.blobs;\n                while (CSL.TERMINAL_PUNCTUATION.indexOf(blobBlobs.slice(0, 1)) > -1) {\n                    blobPrefix = blobPrefix + blobBlobs.slice(0, 1);\n                    blobBlobs = blobBlobs.slice(1);\n                }\n                if (blobBlobs && blobPrefix) {\n                    blob.strings.prefix = blob.strings.prefix + blobPrefix;\n                    blob.blobs = blobBlobs;\n                }\n            }\n        }\n        if (blob.strings[\"text-case\"]) {\n            //\n            // This one is _particularly_ hard to follow.  It's not obvious,\n            // but the blob already contains the input string at this\n            // point, as blob.blobs -- it's a terminal node, as it were.\n            // The str variable also contains the input string, but\n            // that copy is not used for onward processing.  We have to\n            // apply our changes to the blob copy.\n            //\n            blob.blobs = CSL.Output.Formatters[blob.strings[\"text-case\"]](this.state, str);\n        }\n        if (this.state.tmp.strip_periods && !noStripPeriods) {\n            blob.blobs = blob.blobs.replace(/\\.([^a-z]|$)/g, \"$1\");\n        }\n        for (var i = blob.decorations.length - 1; i > -1; i += -1) {\n            if (blob.decorations[i][0] === \"@quotes\" && blob.decorations[i][1] !== \"false\") {\n                blob.punctuation_in_quote = this.state.getOpt(\"punctuation-in-quote\");\n            }\n            if (!blob.blobs.match(CSL.ROMANESQUE_REGEXP)) {\n                if (blob.decorations[i][0] === \"@font-style\") {\n                    blob.decorations = blob.decorations.slice(0, i).concat(blob.decorations.slice(i + 1));\n                }\n            }\n        }\n        //\n        // XXX: Beware superfluous code in your code.  str in this\n        // case is not the source of the final rendered string.\n        // See note above.\n        //\n        curr.push(blob);\n        this.state.fun.flipflopper.processTags(blob);\n    } else if (useblob) {\n        curr.push(blob);\n    } else {\n        curr.push(str);\n    }\n    return true;\n};\n\nCSL.Output.Queue.prototype.string = function (state, myblobs, blob) {\n    var i, ilen, j, jlen, b;\n    //if (blob && blob.strings.delimiter) {\n    //    print(\"DELIMITER: \"+blob.strings.delimiter+\" on \"+[x.blobs[0].num for each (x in myblobs)]);\n    //}\n    //var blobs, ret, blob_delimiter, i, params, blobjr, last_str, last_char, b, use_suffix, qres, addtoret, span_split, j, res, blobs_start, blobs_end, key, pos, len, ppos, llen, ttype, ltype, terminal, leading, delimiters, use_prefix, txt_esc;\n    var txt_esc = CSL.getSafeEscape(this.state);\n    var blobs = myblobs.slice();\n    var ret = [];\n    \n    if (blobs.length === 0) {\n        return ret;\n    }\n\n    var blob_delimiter = \"\";\n    if (blob) {\n        blob_delimiter = blob.strings.delimiter;\n    } else {\n        //print(\"=== Setting false to start ===\");\n        state.tmp.count_offset_characters = false;\n        state.tmp.offset_characters = 0;\n    }\n\n    if (blob && blob.new_locale) {\n        blob.old_locale = state.opt.lang;\n        state.opt.lang = blob.new_locale;\n    }\n\n    var blobjr, use_suffix, use_prefix, params;\n    for (var i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        blobjr = blobs[i];\n\n        if (blobjr.strings.first_blob) {\n            // Being the Item.id of the the entry being rendered.\n            //print(\"  -- turning on counting\");\n            state.tmp.count_offset_characters = blobjr.strings.first_blob;\n        }\n\n        if (\"string\" === typeof blobjr.blobs) {\n            if (\"number\" === typeof blobjr.num) {\n                ret.push(blobjr);\n            } else if (blobjr.blobs) {\n                if (blobjr.particle) {\n                    blobjr.blobs = blobjr.particle + blobjr.blobs;\n                    blobjr.particle = \"\";\n                }\n                // (skips empty strings)\n                //b = txt_esc(blobjr.blobs);\n                b = txt_esc(blobjr.blobs);\n                var blen = b.length;\n\n                if (!state.tmp.suppress_decorations) {\n                    for (j = 0, jlen = blobjr.decorations.length; j < jlen; j += 1) {\n                        params = blobjr.decorations[j];\n                        if (params[0] === \"@showid\") {\n                            continue;\n                        }\n                        if (state.normalDecorIsOrphan(blobjr, params)) {\n                            continue;\n                        }\n                        b = state.fun.decorate[params[0]][params[1]].call(blobjr, state, b, params[2]);\n                    }\n                }\n                //\n                // because we will rip out portions of the output\n                // queue before rendering, group wrappers need\n                // to produce no output if they are found to be\n                // empty.\n                if (b && b.length) {\n                    b = txt_esc(blobjr.strings.prefix) + b + txt_esc(blobjr.strings.suffix);\n                    if (state.opt.development_extensions.csl_reverse_lookup_support && !state.tmp.suppress_decorations) {\n                        for (j = 0, jlen = blobjr.decorations.length; j < jlen; j += 1) {\n                            params = blobjr.decorations[j];\n\n                            if (params[0] === \"@showid\") {\n                                b = state.fun.decorate[params[0]][params[1]].call(blobjr, state, b, params[2]);\n                            }\n                        }\n                    }\n                    ret.push(b);\n                    if (state.tmp.count_offset_characters) {\n                        state.tmp.offset_characters += (blen + blobjr.strings.suffix.length + blobjr.strings.prefix.length);\n                    }\n                }\n            }\n        } else if (blobjr.blobs.length) {\n            var addtoret = state.output.string(state, blobjr.blobs, blobjr);\n            if (blob) {\n                // Patch up world-class weird bug in the ill-constructed code of mine.\n                if (\"string\" !== addtoret && addtoret.length > 1 && blobjr.strings.delimiter) {\n                    var numberSeen = false;\n                    for (var j=0,jlen=addtoret.length;j<jlen;j++) {\n                        if (\"string\" !== typeof addtoret[j]) {\n                            numberSeen = true;\n                        } else if (numberSeen) {\n                            addtoret[j] = (blobjr.strings.delimiter + addtoret[j]);\n                        }\n                    }\n                }\n            }\n            ret = ret.concat(addtoret);\n        }\n        if (blobjr.strings.first_blob && state.registry.registry[blobjr.strings.first_blob]) {\n            // The Item.id of the entry being rendered.\n            state.registry.registry[blobjr.strings.first_blob].offset = state.tmp.offset_characters;\n            state.tmp.count_offset_characters = false;\n        }\n    }\n\n    // Provide delimiters on adjacent numeric blobs\n    for (i=0,ilen=ret.length - 1;i<ilen;i+=1) {\n        if (\"number\" === typeof ret[i].num && \"number\" === typeof ret[i+1].num && !ret[i+1].UGLY_DELIMITER_SUPPRESS_HACK) {\n            // XXX watch this\n            ret[i].strings.suffix = ret[i].strings.suffix + (blob_delimiter ? blob_delimiter : \"\");\n            ret[i+1].successor_prefix = \"\";\n            ret[i+1].UGLY_DELIMITER_SUPPRESS_HACK = true;\n        }\n    }\n\n    var span_split = 0;\n    for (var i = 0, ilen = ret.length; i < ilen; i += 1) {\n        if (\"string\" === typeof ret[i]) {\n            span_split = (parseInt(i, 10) + 1);\n            if (i < ret.length - 1  && \"object\" === typeof ret[i + 1]) {\n                if (blob_delimiter && !ret[i + 1].UGLY_DELIMITER_SUPPRESS_HACK) {\n                    ret[i] += txt_esc(blob_delimiter);\n                }\n                // One bite of the apple\n                ret[i + 1].UGLY_DELIMITER_SUPPRESS_HACK = true;\n            }\n            //span_split = ret.length;\n            //print(\"XXX ret: \"+ret+\" -- \"+blob_delimiter);\n        }\n    }\n/*\n    if (blob && (blob.decorations.length || blob.strings.suffix || blob.strings.prefix)) {\n        span_split = ret.length;\n    }\n*/\n    if (blob && (blob.decorations.length || blob.strings.suffix)) {\n        span_split = ret.length;\n    } else if (blob && blob.strings.prefix) {\n        for (var i=0,ilen=ret.length;i<ilen;i++) {\n            if (\"undefined\" !== typeof ret[i].num) {\n                span_split = i;\n                if (i === 0) {\n                    ret[i].strings.prefix = blob.strings.prefix + ret[i].strings.prefix;\n                }\n                break;\n            }\n        }\n    }\n\n    var blobs_start = state.output.renderBlobs(ret.slice(0, span_split), blob_delimiter, false, blob);\n    if (blobs_start && blob && (blob.decorations.length || blob.strings.suffix || blob.strings.prefix)) {\n        if (!state.tmp.suppress_decorations) {\n            for (var i = 0, ilen = blob.decorations.length; i < ilen; i += 1) {\n                params = blob.decorations[i];\n                if ([\"@cite\",\"@bibliography\", \"@display\", \"@showid\"].indexOf(params[0]) > -1) {\n                    continue;\n                }\n                if (state.normalDecorIsOrphan(blobjr, params)) {\n                    continue;\n                }\n                if (!params[0]) continue;\n                if (\"string\" === typeof blobs_start) {\n                    blobs_start = state.fun.decorate[params[0]][params[1]].call(blob, state, blobs_start, params[2]);\n                }\n            }\n        }\n        //\n        // XXXX: cut-and-paste warning.  same as a code block above.\n        //\n        b = blobs_start;\n        use_suffix = blob.strings.suffix;\n        if (b && b.length) {\n            use_prefix = blob.strings.prefix;\n            b = txt_esc(use_prefix) + b + txt_esc(use_suffix);\n            if (state.tmp.count_offset_characters) {\n                state.tmp.offset_characters += (use_prefix.length + use_suffix.length);\n            }\n        }\n        blobs_start = b;\n        if (!state.tmp.suppress_decorations) {\n            for (var i = 0, ilen = blob.decorations.length; i < ilen; i += 1) {\n                params = blob.decorations[i];\n                if ([\"@cite\",\"@bibliography\", \"@display\", \"@showid\"].indexOf(params[0]) === -1) {\n                    continue;\n                }\n                if (\"string\" === typeof blobs_start) {\n                    blobs_start = state.fun.decorate[params[0]][params[1]].call(blob, state, blobs_start, params[2]);\n                }\n            }\n        }\n    }\n\n    var blobs_end = ret.slice(span_split, ret.length);\n    if (!blobs_end.length && blobs_start) {\n        ret = [blobs_start];\n    } else if (blobs_end.length && !blobs_start) {\n        ret = blobs_end;\n    } else if (blobs_start && blobs_end.length) {\n        ret = [blobs_start].concat(blobs_end);\n    }\n    //\n    // Blobs is now definitely a string with\n    // trailing blobs.  Return it.\n    if (\"undefined\" === typeof blob) {\n        this.queue = [];\n        this.current.mystack = [];\n        this.current.mystack.push(this.queue);\n        if (state.tmp.suppress_decorations) {\n            ret = state.output.renderBlobs(ret, undefined, false);\n        }\n    } else if (\"boolean\" === typeof blob) {\n        ret = state.output.renderBlobs(ret, undefined, true);\n    }\n\n    if (blob && blob.new_locale) {\n        state.opt.lang = blob.old_locale;\n    }\n    //if (!blob && !state.tmp.just_looking) {\n    //  print(\"QUEUE (\"+ state.tmp.just_looking +\"): \"+JSON.stringify(state.output.queue, [\"num\", \"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"], 2));\n    //}\n    return ret;\n};\n\nCSL.Output.Queue.prototype.clearlevel = function () {\n    var blob, pos, len;\n    blob = this.current.value();\n    len = blob.blobs.length;\n    for (pos = 0; pos < len; pos += 1) {\n        blob.blobs.pop();\n    }\n};\n\nCSL.Output.Queue.prototype.renderBlobs = function (blobs, delim, in_cite, parent) {\n    var state, ret, ret_last_char, use_delim, blob, pos, len, ppos, llen, str, params, txt_esc;\n    txt_esc = CSL.getSafeEscape(this.state);\n    if (!delim) {\n        delim = \"\";\n    }\n    state = this.state;\n    ret = \"\";\n    ret_last_char = [];\n    use_delim = \"\";\n    len = blobs.length;\n    if (this.state.tmp.area === \"citation\" && !this.state.tmp.just_looking && len === 1 && typeof blobs[0] === \"object\" && parent) {\n        blobs[0].strings.prefix = parent.strings.prefix + blobs[0].strings.prefix;\n        blobs[0].strings.suffix = blobs[0].strings.suffix + parent.strings.suffix;\n        blobs[0].decorations = blobs[0].decorations.concat(parent.decorations);\n        blobs[0].params = parent.params;\n        return blobs[0];\n    }\n    var start = true;\n    for (pos = 0; pos < len; pos += 1) {\n        if (blobs[pos].checkNext) {\n            blobs[pos].checkNext(blobs[pos + 1],start);\n            start = false;\n        } else if (blobs[pos+1] && blobs[pos+1].splice_prefix) {\n            start = false;\n            //blobs[pos+1].checkNext(blobs[pos + 1],start);\n        } else {\n            start = true;\n        }\n    }\n    \n    // print(\"LEN=\"+len+\" \"+JSON.stringify(blobs, null, 2));\n    // Fix last non-range join\n    var doit = true;\n    for (pos = blobs.length - 1; pos > 0; pos += -1) {\n        if (blobs[pos].checkLast) {\n            if (doit && blobs[pos].checkLast(blobs[pos - 1])) {\n                doit = false;\n            }\n        } else {\n            doit = true;\n        }\n    }\n    len = blobs.length;\n    for (pos = 0; pos < len; pos += 1) {\n        blob = blobs[pos];\n        if (ret) {\n            use_delim = delim;\n        }\n        if (\"string\" === typeof blob) {\n            ret += txt_esc(use_delim);\n            // XXX Blob should be run through flipflop and flattened here.\n            // (I think it must be a fragment of text around a numeric\n            // variable)\n            ret += blob;\n            if (state.tmp.count_offset_characters) {\n                //state.tmp.offset_characters += (use_delim.length + blob.length);\n                state.tmp.offset_characters += (use_delim.length);\n            }\n        } else if (in_cite) {\n            // pass\n            // Okay, so this does it -- but we're now not able to return a string!\n            if (ret) {\n                ret = [ret, blob];\n            } else {\n                ret = [blob];\n            }\n        } else if (blob.status !== CSL.SUPPRESS) {\n            if (blob.particle) {\n                str = blob.particle + blob.num;\n            } else {\n                str = blob.formatter.format(blob.num, blob.gender);\n            }\n            // Workaround to get a more or less accurate value.\n            var strlen = str.replace(/<[^>]*>/g, \"\").length;\n            // notSerious\n            this.append(str, \"empty\", true);\n            var str_blob = this.pop();\n            var count_offset_characters = state.tmp.count_offset_characters;\n            str = this.string(state, [str_blob], false);\n            state.tmp.count_offset_characters = count_offset_characters;\n            if (blob.strings[\"text-case\"]) {\n                str = CSL.Output.Formatters[blob.strings[\"text-case\"]](this.state, str);\n            }\n            if (str && this.state.tmp.strip_periods) {\n                str = str.replace(/\\.([^a-z]|$)/g, \"$1\");\n            }\n            if (!state.tmp.suppress_decorations) {\n                llen = blob.decorations.length;\n                for (ppos = 0; ppos < llen; ppos += 1) {\n                    params = blob.decorations[ppos];\n                    if (state.normalDecorIsOrphan(blob, params)) {\n                        continue;\n                    }\n                    str = state.fun.decorate[params[0]][params[1]].call(blob, state, str, params[2]);\n                }\n            }\n            str = txt_esc(blob.strings.prefix) + str + txt_esc(blob.strings.suffix);\n            var addme = \"\";\n            if (blob.status === CSL.END) {\n                //print(\"  CSL.END\");\n                addme = txt_esc(blob.range_prefix);\n            } else if (blob.status === CSL.SUCCESSOR) {\n                //print(\"  CSL.SUCCESSOR\");\n                addme = txt_esc(blob.successor_prefix);\n            } else if (blob.status === CSL.START) {\n                //print(\"  CSL.START\");\n                if (pos > 0 && !blob.suppress_splice_prefix) {\n                    addme = txt_esc(blob.splice_prefix);\n                } else {\n                    addme = \"\";\n                }\n            } else if (blob.status === CSL.SEEN) {\n                //print(\"  CSL.SEEN\");\n\n                // THIS IS NOT THE PROPER FUNCTION OF CSL.SEEN, IS IT?\n\n                addme = txt_esc(blob.splice_prefix);\n            }\n            ret += addme;\n            ret += str;\n            if (state.tmp.count_offset_characters) {\n                state.tmp.offset_characters += (addme.length + blob.strings.prefix.length + strlen + blob.strings.suffix.length);\n            }\n        }\n    }\n    return ret;\n};\n\nCSL.Output.Queue.purgeEmptyBlobs = function (parent) {\n    //print(\"START1\");\n    if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n        return;\n    }\n    // back-to-front, bottom-first\n    for (var i=parent.blobs.length-1;i>-1;i--) {\n        CSL.Output.Queue.purgeEmptyBlobs(parent.blobs[i]);\n        var child = parent.blobs[i];\n        if (!child || !child.blobs || !child.blobs.length) {\n            var buf = [];\n            while ((parent.blobs.length-1) > i) {\n                buf.push(parent.blobs.pop());\n            }\n            parent.blobs.pop();\n            while (buf.length) {\n                parent.blobs.push(buf.pop());\n            }\n        }\n    }\n    //print(\"   end\");\n};\n\n// Adjustments to be made:\n//\n// * Never migrate beyond a @quotes node\n// * Never migrate into a num node.\n\nCSL.Output.Queue.adjust = function (punctInQuote) {\n\n    var NO_SWAP_IN = {\n        \";\": true,\n        \":\": true\n    };\n\n    var NO_SWAP_OUT = {\n        \".\": true,\n        \"!\": true,\n        \"?\": true\n    };\n\n    var LtoR_MAP = {\n        \"!\": {\n            \".\": \"!\",\n            \"?\": \"!?\",\n            \":\": \"!\",\n            \",\": \"!,\",\n            \";\": \"!;\"\n        },\n        \"?\": {\n            \"!\": \"?!\",\n            \".\": \"?\",\n            \":\": \"?\",\n            \",\": \"?,\",\n            \";\": \"?;\"\n        },\n        \".\": {\n            \"!\": \".!\",\n            \"?\": \".?\",\n            \":\": \".:\",\n            \",\": \".,\",\n            \";\": \".;\"\n        },\n        \":\": {\n            \"!\": \"!\",\n            \"?\": \"?\",\n            \".\": \":\",\n            \",\": \":,\",\n            \";\": \":;\"\n        },\n        \",\": {\n            \"!\": \",!\",\n            \"?\": \",?\",\n            \":\": \",:\",\n            \".\": \",.\",\n            \";\": \",;\"\n        },\n        \";\": {\n            \"!\": \"!\",\n            \"?\": \"?\",\n            \":\": \";\",\n            \",\": \";,\",\n            \".\": \";\"\n        }\n    };\n\n    var SWAP_IN = {};\n    var SWAP_OUT = {};\n    var PUNCT = {};\n    var PUNCT_OR_SPACE = {};\n    for (var key in LtoR_MAP) {\n        PUNCT[key] = true;\n        PUNCT_OR_SPACE[key] = true;\n        if (!NO_SWAP_IN[key]) {\n            SWAP_IN[key] = true;\n        }\n        if (!NO_SWAP_OUT[key]) {\n            SWAP_OUT[key] = true;\n        }\n    }\n    PUNCT_OR_SPACE[\" \"] = true;\n    PUNCT_OR_SPACE[\"\"] = true;\n\n    var RtoL_MAP = {};\n    for (var key in LtoR_MAP) {\n        for (var subkey in LtoR_MAP[key]) {\n            if (!RtoL_MAP[subkey]) {\n                RtoL_MAP[subkey] = {};\n            }\n            RtoL_MAP[subkey][key] = LtoR_MAP[key][subkey];\n        }\n    }\n\n    function blobIsNumber(blob) {\n        return (\"number\" === typeof blob.num || (blob.blobs && blob.blobs.length === 1 && \"number\" === typeof blob.blobs[0].num));\n    }\n\n    function blobEndsInNumber(blob) {\n        if (\"number\" === typeof blob.num) {\n            return true;\n        }\n        if (!blob.blobs || \"object\" !==  typeof blob.blobs) {\n            return false;\n        }\n        if (blobEndsInNumber(blob.blobs[blob.blobs.length-1])) {\n            return true;\n        }\n    }\n    \n    function blobHasDecorations(blob,includeQuotes) {\n        var ret = false;\n        var decorlist = ['@font-style','@font-variant','@font-weight','@text-decoration','@vertical-align'];\n        if (includeQuotes) {\n            decorlist.push('@quotes');\n        }\n        if (blob.decorations) {\n            for (var i=0,ilen=blob.decorations.length;i<ilen;i++) {\n                if (decorlist.indexOf(blob.decorations[i][0]) > -1) {\n                    ret = true;\n                    break;\n                }\n            }\n        }\n        return ret;\n    }\n    \n    function blobHasDescendantQuotes(blob) {\n        if (blob.decorations) {\n            for (var i=0,ilen=blob.decorations.length;i<ilen;i++) {\n                if (blob.decorations[i][0] === '@quotes' && blob.decorations[i][1] !== \"false\") {\n                    return true;\n                }\n            }\n        }\n        if (\"object\" !== typeof blob.blobs) {\n            return false;\n        }\n        return blobHasDescendantQuotes(blob.blobs[blob.blobs.length-1]);\n        //if (blobHasDescendantQuotes(blob.blobs[blob.blobs.length-1])) {\n        //    return true\n        //};\n        //return false;\n    }\n    \n    function blobHasDescendantMergingPunctuation(parentChar,blob) {\n        var childChar = blob.strings.suffix.slice(-1);\n        if (!childChar && \"string\" === typeof blob.blobs) {\n            childChar = blob.blobs.slice(-1);\n        }\n        var mergedChars = RtoL_MAP[parentChar][childChar];\n        if (mergedChars && mergedChars.length === 1) {\n            return true;\n        }\n        if (\"object\" !== typeof blob.blobs) {\n            return false;\n        }\n        if (blobHasDescendantMergingPunctuation(parentChar,blob.blobs[blob.blobs.length-1])) {\n            return true;\n        }\n        return false;\n    }\n    \n    function matchLastChar(blob, chr) {\n        if (!PUNCT[chr]) {\n            return false;\n        }\n        if (\"string\" === typeof blob.blobs) {\n\n            if (blob.blobs.slice(-1) === chr) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            var child = blob.blobs[blob.blobs.length-1];\n            if (child) {\n                var childChar = child.strings.suffix.slice(-1);\n                if (!childChar) {\n                    return matchLastChar(child,chr);\n                } else if (child.strings.suffix.slice(-1) == chr) {\n                    return true;\n                } else {\n                    return false;\n                }\n            } else {\n                return false;\n            }\n        }\n    }\n    \n    function mergeChars (First, first, Second, second, merge_right) {\n        var FirstStrings = \"blobs\" === first ? First : First.strings;\n        var SecondStrings = \"blobs\" === second ? Second: Second.strings;\n        var firstChar = FirstStrings[first].slice(-1);\n        var secondChar = SecondStrings[second].slice(0,1);\n        function cullRight () {\n            SecondStrings[second] = SecondStrings[second].slice(1);\n        }\n        function cullLeft () {\n            FirstStrings[first] = FirstStrings[first].slice(0,-1);\n        }\n        function addRight (chr) {\n            SecondStrings[second] = chr + SecondStrings[second];\n        }\n        function addLeft (chr) {\n            FirstStrings[first] += chr;\n        }\n        var cull = merge_right ? cullLeft : cullRight;\n        function matchOnRight () {\n            return RtoL_MAP[secondChar];\n        }\n        function matchOnLeft () {\n            return LtoR_MAP[firstChar];\n        }\n        var match = merge_right ? matchOnLeft : matchOnRight;\n        function mergeToRight () {\n            var chr = LtoR_MAP[firstChar][secondChar];\n            if (\"string\" === typeof chr) {\n                cullLeft();\n                cullRight();\n                addRight(chr);\n            } else {\n                addRight(firstChar);\n                cullLeft();\n            }\n        }\n        function mergeToLeft () {\n            var chr = RtoL_MAP[secondChar][firstChar];\n            if (\"string\" === typeof chr) {\n                cullLeft();\n                cullRight();\n                addLeft(chr);\n            } else {\n                addLeft(secondChar);\n                cullRight();\n            }\n        }\n        var merge = merge_right ? mergeToRight: mergeToLeft;\n\n        var isDuplicate = firstChar === secondChar;\n        if (isDuplicate) {\n            cull();\n        } else {\n            if (match()) {\n                merge();\n            }\n        }\n    }\n\n    function upward (parent) {\n        //print(\"START2\");\n        // Terminus if no blobs\n        if (parent.blobs && \"string\" == typeof parent.blobs) {\n            if (PUNCT[parent.strings.suffix.slice(0,1)]\n                && parent.strings.suffix.slice(0,1) === parent.blobs.slice(-1)) {\n\n                parent.strings.suffix = parent.strings.suffix.slice(1);\n            }\n            return;\n        } else if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n\n        // back-to-front, bottom-first\n        var parentDecorations = blobHasDecorations(parent,true);\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            this.upward(parent.blobs[i]);\n            var parentStrings = parent.strings;\n            var childStrings = parent.blobs[i].strings;\n            if (i === 0) {\n                // Remove leading space on first-position child node prefix if there is a trailing space on the node prefix above \n                if (\" \" === parentStrings.prefix.slice(-1) && \" \" === childStrings.prefix.slice(0, 1)) {\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n                // Migrate leading punctuation or space on a first-position prefix upward\n                var childChar = childStrings.prefix.slice(0, 1);\n                if (!parentDecorations && PUNCT_OR_SPACE[childChar] && !parentStrings.prefix) {\n                    parentStrings.prefix += childChar;\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n            }\n            if (i === (parent.blobs.length - 1)) {\n                // Migrate trailing space ONLY on a last-position suffix upward, controlling for duplicates\n                var childChar = childStrings.suffix.slice(-1);\n                // ZZZ Loosened to fix initialized names wrapped in a span and followed by a period\n                if (!parentDecorations && [\" \"].indexOf(childChar) > -1) {\n                    if (parentStrings.suffix.slice(0,1) !== childChar) {\n                        parentStrings.suffix = childChar + parentStrings.suffix;\n                    }\n                    childStrings.suffix = childStrings.suffix.slice(0, -1);\n                }\n            }\n            if (parentStrings.delimiter && i > 0) {\n                // Remove leading space on mid-position child node prefix if there is a trailing space on delimiter above\n                if (PUNCT_OR_SPACE[parentStrings.delimiter.slice(-1)]\n                    && parentStrings.delimiter.slice(-1) === childStrings.prefix.slice(0, 1)) {\n\n                    childStrings.prefix = childStrings.prefix.slice(1);\n                }\n            }\n            // Siblings are handled in adjustNearsideSuffixes()\n        }\n        //print(\"   end\");\n    }\n\n    function leftward (parent) {\n        // Terminus if no blobs\n        if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            this.leftward(parent.blobs[i]);\n            // This is a delicate one.\n            //\n            // Migrate if:\n            // * there is no umbrella delimiter [ok]\n            // * neither the child nor its sibling is a number [ok]\n            // * decorations exist neither on the child nor on the sibling [ok]\n            // * sibling prefix char is a swapping char [ok]\n            //\n            // Suppress without migration if:\n            // * sibling prefix char matches child suffix char or\n            // * child suffix is empty and sibling prefix char match last field char\n            if ((i < parent.blobs.length -1) && !parent.strings.delimiter) {\n                // If there is a trailing swappable character on a sibling prefix with no intervening delimiter, copy it to suffix,\n                // controlling for duplicates\n                var child = parent.blobs[i];\n                var childChar = child.strings.suffix.slice(-1);\n                var sibling = parent.blobs[i+1];\n                var siblingChar = sibling.strings.prefix.slice(0, 1);\n                var hasDecorations = blobHasDecorations(child) || blobHasDecorations(sibling);\n                var hasNumber = \"number\" === typeof childChar || \"number\" === typeof siblingChar;\n\n                if (!hasDecorations && !hasNumber && PUNCT[siblingChar] && !hasNumber) {\n                    var suffixAndPrefixMatch = siblingChar === child.strings.suffix.slice(-1);\n                    var suffixAndFieldMatch = (!child.strings.suffix && \"string\" === typeof child.blobs && child.blobs.slice(-1) === siblingChar);\n                    if (!suffixAndPrefixMatch && !suffixAndFieldMatch) {\n                        mergeChars(child, 'suffix', sibling, 'prefix');\n                        //child.strings.suffix += siblingChar;\n                    } else {\n                        sibling.strings.prefix = sibling.strings.prefix.slice(1);\n                    }\n                }\n            }\n        }\n    }\n\n    function downward (parent) {\n        //print(\"START3\");\n        // Terminus if no blobs\n        if (parent.blobs && \"string\" == typeof parent.blobs) {\n            if (PUNCT[parent.strings.suffix.slice(0,1)]\n                && parent.strings.suffix.slice(0,1) === parent.blobs.slice(-1)) {\n\n                parent.strings.suffix = parent.strings.suffix.slice(1);\n            }\n            return;\n        } else if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n        //if (top) {\n        //    print(\"JSON \"+JSON.stringify(parent, [\"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"], 2));\n        //}\n\n        var parentStrings = parent.strings;\n        // Check for numeric child\n        var someChildrenAreNumbers = false;\n        for (var i=0,ilen=parent.blobs.length;i<ilen;i++) {\n            if (blobIsNumber(parent.blobs[i])) {\n                someChildrenAreNumbers = true;\n                break;\n            }\n        }\n        if (true || !someChildrenAreNumbers) {\n            // If there is a leading swappable character on delimiter, copy it to suffixes IFF none of the targets are numbers\n            if (parentStrings.delimiter && PUNCT[parentStrings.delimiter.slice(0, 1)]) {\n                var delimChar = parentStrings.delimiter.slice(0, 1);\n                for (var i=parent.blobs.length-2;i>-1;i--) {\n                    var childStrings = parent.blobs[i].strings;\n                    if (childStrings.suffix.slice(-1) !== delimChar) {\n                        childStrings.suffix += delimChar;\n                    }\n                }\n                parentStrings.delimiter = parentStrings.delimiter.slice(1);\n            }\n        }\n        // back-to-front, top-first\n        for (var i=parent.blobs.length-1;i>-1;i--) {\n            var child = parent.blobs[i];\n            var childStrings = parent.blobs[i].strings;\n            var childDecorations = blobHasDecorations(child, true);\n            var childIsNumber = blobIsNumber(child);\n\n            if (i === (parent.blobs.length - 1)) {\n\n                //if (blobHasDescendantQuotes(child)) {\n                //    print(\"JSON \"+JSON.stringify(parent, [\"strings\", \"decorations\", \"blobs\", \"prefix\", \"suffix\", \"delimiter\"]));\n                //}\n\n                if (true || !someChildrenAreNumbers) {\n                    // If we have decorations, drill down to see if there are quotes below.\n                    // If so, we allow migration anyway.\n                    // Original discussion is here:\n                    // https://forums.zotero.org/discussion/37091/citeproc-bug-punctuation-in-quotes/\n                    var parentChar = parentStrings.suffix.slice(0, 1);\n\n                    // Hmm.\n                    // Consider writing out the matching child from blobHasDescendant functions.\n                    // It should save some cycles, and produce the same result.\n\n                    var allowMigration = false;\n                    if (PUNCT[parentChar]) {\n                        allowMigration = blobHasDescendantMergingPunctuation(parentChar,child);\n                        if (!allowMigration && punctInQuote) {\n                            allowMigration = blobHasDescendantQuotes(child);\n                        }\n                    }\n                    if (allowMigration) {\n                        if (PUNCT[parentChar]) {\n                            if (!blobEndsInNumber(child)) {\n                                if (\"string\" === typeof child.blobs) {\n                                    mergeChars(child, 'blobs', parent, 'suffix');\n                                } else {\n                                    mergeChars(child, 'suffix', parent, 'suffix');\n                                }\n                                if (parentStrings.suffix.slice(0,1) === \".\") {\n                                    childStrings.suffix += parentStrings.suffix.slice(0,1);\n                                    parentStrings.suffix = parentStrings.suffix.slice(1);\n                                }\n                            }\n                        }\n                    }\n                    if (childStrings.suffix.slice(-1) === \"\" && parentStrings.suffix.slice(0,1) === \" \") {\n                        parentStrings.suffix = parentStrings.suffix.slice(1);\n                    }\n                    // More duplicates control\n                    if (PUNCT_OR_SPACE[childStrings.suffix.slice(0,1)]) {\n                        if (\"string\" === typeof child.blobs && child.blobs.slice(-1) === childStrings.suffix.slice(0,1)) {\n                            // Remove parent punctuation of it duplicates the last character of a field\n                            childStrings.suffix = childStrings.suffix.slice(1);\n                        }\n                        if (childStrings.suffix.slice(-1) === parentStrings.suffix.slice(0, 1)) {\n                            // Remove duplicate punctuation on child suffix\n                            parentStrings.suffix = parentStrings.suffix.slice(0, -1);\n                        }\n                    }\n                }\n                // Squash dupes\n                if (matchLastChar(parent,parent.strings.suffix.slice(0,1))) {\n                    parent.strings.suffix = parent.strings.suffix.slice(1);\n                }\n            } else if (parentStrings.delimiter) {\n                // Remove trailing space on mid-position child node suffix if there is a leading space on delimiter above\n                if (PUNCT_OR_SPACE[parentStrings.delimiter.slice(0,1)]\n                    && parentStrings.delimiter.slice(0, 1) === childStrings.suffix.slice(-1)) {\n\n                    parent.blobs[i].strings.suffix = parent.blobs[i].strings.suffix.slice(0, -1);\n                    \n                }\n            } else {\n                // Otherwise it's a sibling. We don't care about moving spaces here, just suppress a duplicate\n                var siblingStrings = parent.blobs[i+1].strings;\n                if (!blobIsNumber(child) \n                    && !childDecorations\n                    && PUNCT_OR_SPACE[childStrings.suffix.slice(-1)]\n                    && childStrings.suffix.slice(-1) === siblingStrings.prefix.slice(0, 1)) {\n\n                    siblingStrings.prefix = siblingStrings.prefix.slice(1);\n                }\n            }\n            // If field content ends with swappable punctuation, suppress swappable punctuation in style suffix.\n            if (!childIsNumber && !childDecorations && PUNCT[childStrings.suffix.slice(0,1)]\n                && \"string\" === typeof child.blobs) {\n                \n                mergeChars(child, 'blobs', child, 'suffix');\n            }\n            this.downward(parent.blobs[i]);\n        }\n/*\n        if (top) {\n\n            var seen = [];\n            print(JSON.stringify(parent, function(key, val) {\n                if (!val || key === 'alldecor') return;\n                if (typeof val == \"object\") {\n                    if (seen.indexOf(val) >= 0)\n                        return\n                    seen.push(val)\n                }\n                return val\n            },2));\n        }\n*/\n\n        //print(\"  end\");\n    }\n    // Abstract out a couple of utility functions, used in fix() below.\n    function swapToTheLeft (child) {\n        var childChar = child.strings.suffix.slice(0,1);\n        if (\"string\" === typeof child.blobs) {\n            while (SWAP_IN[childChar]) {\n                mergeChars(child, 'blobs', child, 'suffix');\n                childChar = child.strings.suffix.slice(0,1);\n            }                                \n        } else {\n            while (SWAP_IN[childChar]) {\n                mergeChars(child.blobs[child.blobs.length-1], 'suffix', child, 'suffix');\n                childChar = child.strings.suffix.slice(0,1);\n            }\n        }\n    }\n    function swapToTheRight (child) {\n        if (\"string\" === typeof child.blobs) {\n            var childChar = child.blobs.slice(-1);\n            while (SWAP_OUT[childChar]) {\n                mergeChars(child, 'blobs', child, 'suffix', true);\n                childChar = child.blobs.slice(-1);\n            }\n        } else {\n            var childChar = child.blobs[child.blobs.length-1].strings.suffix.slice(-1);\n            while (SWAP_OUT[childChar]) {\n                mergeChars(child.blobs[child.blobs.length-1], 'suffix', child, 'suffix', true);\n                childChar = child.blobs[child.blobs.length-1].strings.suffix.slice(-1);\n            }\n        }\n    }\n\n    function fix (parent) {\n        // Terminus if no blobs\n        if (\"object\" !== typeof parent || \"object\" !== typeof parent.blobs || !parent.blobs.length) {\n            return;\n        }\n        \n        //print(\"START4\");\n        // Do the swap, front-to-back, bottom-first\n        var lastChar;\n\n        // XXX Two things to fix with this:\n        // XXX (1) Stalls after one character\n        // XXX (2) Moves colon and semicolon, both of which SHOULD stall\n\n        for (var i=0,ilen=parent.blobs.length;i<ilen;i++) {\n            var child = parent.blobs[i];\n            var quoteSwap = false;\n            for (var j=0,jlen=child.decorations.length;j<jlen;j++) {\n                var decoration = child.decorations[j];\n                if (decoration[0] === \"@quotes\" && decoration[1] !== \"false\") {\n                    quoteSwap = true;\n                }\n            }\n            if (quoteSwap) {\n                if (punctInQuote) {\n                    swapToTheLeft(child);\n                } else {\n                    swapToTheRight(child);\n                }\n            }\n            lastChar = this.fix(parent.blobs[i]);\n            if (child.blobs && \"string\" === typeof child.blobs) {\n                lastChar = child.blobs.slice(-1);\n            }\n        }\n        return lastChar;\n    }\n    this.upward = upward;\n    this.leftward = leftward;\n    this.downward = downward;\n    this.fix = fix;\n};\n\n/*global CSL: true */\n\nCSL.Engine.Opt = function () {\n    this.parallel = {\n        enable: false,\n    },\n    this.has_disambiguate = false;\n    this.mode = \"html\";\n    this.dates = {};\n    this.jurisdictions_seen = {};\n    this.suppressedJurisdictions = {};\n    this.inheritedAttributes = {};\n    this[\"locale-sort\"] = [];\n    this[\"locale-translit\"] = [];\n    this[\"locale-translat\"] = [];\n    this.citeAffixes = {\n        persons:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        institutions:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        titles:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        journals:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        publishers:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        },\n        places:{\n            \"locale-orig\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translit\":{\n                prefix:\"\",\n                suffix:\"\"\n            },\n            \"locale-translat\":{\n                prefix:\"\",\n                suffix:\"\"\n            }\n        }\n    };\n    this[\"default-locale\"] = [];\n    this.update_mode = CSL.NONE;\n    this.bib_mode = CSL.NONE;\n    this.sort_citations = false;\n    /*\n     * Default values.\n     * The various et-al values are set globally,\n     * and the appropriate value is set by the names start\n     * tag at runtime, depending on whether the Item is a\n     * first or a subsequent reference.\n     */\n    this[\"et-al-min\"] = 0;\n    this[\"et-al-use-first\"] = 1;\n    this[\"et-al-use-last\"] = false;\n    this[\"et-al-subsequent-min\"] = false;\n    this[\"et-al-subsequent-use-first\"] = false;\n\n    this[\"demote-non-dropping-particle\"] = \"display-and-sort\";\n    // default of true, because none of our consuming\n    // applications so far store the various prefixes and \n    // suffixes we support in separate fields.\n    this[\"parse-names\"] = true;\n    // this[\"auto-vietnamese-names\"] = true;\n\n    this.citation_number_slug = false;\n    this.trigraph = \"Aaaa00:AaAa00:AaAA00:AAAA00\";\n\n    this.nodenames = [];\n\n    this.gender = {};\n    this['cite-lang-prefs'] = {\n        persons:['orig'],\n        institutions:['orig'],\n        titles:['orig'],\n        journals:['orig'],\n        publishers:['orig'],\n        places:['orig'],\n        number:['orig']\n    };\n\n    this.has_layout_locale = false;\n    this.disable_duplicate_year_suppression = [];\n    this.use_context_condition = false;\n\n    this.jurisdiction_fallbacks = {};\n\n    this.development_extensions = {};\n    this.development_extensions.field_hack = true;\n    this.development_extensions.allow_field_hack_date_override = true;\n    this.development_extensions.locator_date_and_revision = true;\n    this.development_extensions.locator_label_parse = true;\n    this.development_extensions.raw_date_parsing = true;\n    this.development_extensions.clean_up_csl_flaws = true;\n    this.development_extensions.consolidate_legal_items = false;\n    this.development_extensions.csl_reverse_lookup_support = false;\n    this.development_extensions.wrap_url_and_doi = false;\n    this.development_extensions.thin_non_breaking_space_html_hack = false;\n    this.development_extensions.apply_citation_wrapper = false;\n    this.development_extensions.main_title_from_short_title = false;\n    this.development_extensions.uppercase_subtitles = false;\n    this.development_extensions.normalize_lang_keys_to_lowercase = false;\n    this.development_extensions.strict_text_case_locales = false;\n    this.development_extensions.expect_and_symbol_form = false;\n    this.development_extensions.require_explicit_legal_case_title_short = false;\n    this.development_extensions.spoof_institutional_affiliations = false;\n    this.development_extensions.force_jurisdiction = false;\n    this.development_extensions.parse_names = true;\n    this.development_extensions.hanging_indent_legacy_number = false;\n    this.development_extensions.throw_on_empty = false;\n    this.development_extensions.strict_inputs = true;\n    this.development_extensions.prioritize_disambiguate_condition = false;\n    this.development_extensions.force_short_title_casing_alignment = true;\n    this.development_extensions.implicit_short_title = false;\n    this.development_extensions.force_title_abbrev_fallback = false;\n    this.development_extensions.split_container_title = false;\n    this.development_extensions.legacy_institution_name_ordering = false;\n    this.development_extensions.etal_min_etal_usefirst_hack = false;\n};\n\nCSL.Engine.Tmp = function () {\n    //\n    // scratch variable to display the total\n    // number of names in all rendered variables\n    // in a cite.  initialized to zero by the\n    // citation element, incremented by each\n    // name variable actually rendered\n    this.names_max = new CSL.Stack();\n    this.names_base = new CSL.Stack();\n    this.givens_base = new CSL.Stack();\n    //\n    // this holds the field values collected by the @value\n    // and @variable attributes, for processing by the\n    // element functions.\n    this.value = [];\n    /**\n     * Object to hold the decorations declared by a name-part\n     * element.\n     */\n    this.namepart_decorations = {};\n    /**\n     * String variable to hold the type of a name-part\n     * element.\n     */\n    this.namepart_type = false;\n    //\n    // scratch variable to flag whether we are processing\n    // a citation or a bibiliography.  this diverts token and\n    // configuration to the appropriateo objects inside\n    // state.  the default is \"citation\".\n    this.area = \"citation\";\n    this.root = \"citation\";\n    this.extension = \"\";\n    //\n    // controls the implicit conditional wrappers applied\n    // to top-level elements inside a names substitute span.\n    // false by default, names start tag pushes a new true level,\n    // names end tag pops it.  Output value check in @variable\n    // function of attributes.js sets level to false.  closing names\n    // tag maps a false value to superior level.\n    this.can_substitute = new CSL.Stack(0, CSL.LITERAL);\n    //\n    // notes whether the formatted elements of a date span\n    // rendered anything.  controls whether literal fallback\n    // is used.\n    this.element_rendered_ok = false;\n    //\n    // element_trace keeps a record of rendered elements.\n    // used to implement author-only.\n    //\n    this.element_trace = new CSL.Stack(\"style\");\n    //\n    // counter for total namesets\n    this.nameset_counter = 0;\n    //\n    /////  this.fun.check_for_output = CSL.check_for_output;\n    //\n    // stack flag used for term handling.  Set to true\n    // if at least one variable has tried to render, and\n    // no variables had content.\n    this.group_context = new CSL.Stack({\n        term_intended: false,\n        variable_attempt: false,\n        variable_success: false,\n        output_tip: undefined,\n        label_form:  undefined,\n        parallel_first: undefined,\n        parallel_last: undefined,\n        parallel_delimiter_override: undefined,\n        condition: false,\n        force_suppress: false,\n        done_vars: []\n    });\n    //\n    // boolean flag used to control first-letter capitalization\n    // of terms.  Set to true if any item preceding the term\n    // being handled has rendered successfully, otherwise\n    // false.\n    this.term_predecessor = false;\n    //\n    // boolean flag to control use of layout delimiter\n    // immediately before numbers. This hack is needed for\n    // some numeric styles.\n    this.in_cite_predecessor = false;\n    //\n    // stack flag used to control jumps in the closing\n    // token of a conditional.\n    this.jump = new CSL.Stack(0, CSL.LITERAL);\n    //\n    // holds string parameters for group formatting, between\n    // the start of a group and the closing token.\n    this.decorations = new CSL.Stack();\n    //\n    // token store stack.\n    this.tokenstore_stack = new CSL.Stack();\n\n    // for collapsing\n    this.last_suffix_used = \"\";\n    this.last_names_used = [];\n    this.last_years_used = [];\n    this.years_used = [];\n    this.names_used = [];\n\n    this.taintedItemIDs = {};\n    this.taintedCitationIDs = {};\n    //\n    // scratch stack containing initialize-with strings or null values\n    this.initialize_with = new CSL.Stack();\n    //\n    // this is used to set a requested set of\n    // disambiguation parameters in the output.\n    // for the array elements, the base array\n    // (either zero for each nameset, or full-up\n    // if givens are already used) is set\n    // during names processing, if no value\n    // is set in the processor before a rendering\n    // run.  to simplify things for the calling\n    // function, these are just bog-standard arrays,\n    // and can be safely overwritten.\n    this.disambig_request = false;\n    //\n    // scratch variable to toggle an attempt to set a\n    // name in sort order rather than display\n    // order.\n    this[\"name-as-sort-order\"] = false;\n    //\n    // suppress decorations (used for generating\n    // sort keys and disambiguation keys)\n    this.suppress_decorations = false;\n    //\n    // empty settings array, used to report settings used\n    // if disambig_request is not set at runtime\n    this.disambig_settings = new CSL.AmbigConfig();\n    //\n    // sort key array\n    this.bib_sort_keys = [];\n    //\n    // holds the prefix between the start of a group\n    // and the closing token.\n    this.prefix = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // holds the suffix between the start of a group\n    // and the closing token.\n    this.suffix = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // holds the group delimiter between the start of a group\n    // and the closing token.\n    this.delimiter = new CSL.Stack(\"\", CSL.LITERAL);\n    //\n    // Used for conditional locale switching.\n    this.cite_locales = [];\n    this.cite_affixes = {\n        citation: false, \n        bibliography: false,\n        citation_sort: false, \n        bibliography_sort: false\n    };\n    this.strip_periods = 0;\n    this.shadow_numbers = {};\n    this.authority_stop_last = 0;\n    this.loadedItemIDs = {};\n    //\n    // Push/pop array for set/unset of opt.lang setting, used\n    // in if locale=\"XX\" to force terms to language of item.\n    // @locale tests track their nesting level in a counter,\n    // and push the current value of state.opt.lang to one array,\n    // and the counter value to another. On the way back up,\n    // closing node decrements the counter, compares its value\n    // with the trailing value on the array, and pops both\n    // arrays, resetting state.opt.lang to the previous value.\n    // A hack to solve a surprisingly difficult problem caused\n    // by the use of an execution stack for the nested structure.\n    this.condition_counter = 0; //incremented/decremented on ALL conditions\n    this.condition_lang_val_arr = [];\n    this.condition_lang_counter_arr = [];\n};\n\n\nCSL.Engine.Fun = function (state) {\n    //\n    // matcher\n    this.match = new CSL.Util.Match();\n    //\n    // utility to get standard suffixes for disambiguation\n    this.suffixator = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n    //\n    // utility to romanize a numeric value\n    this.romanizer = new CSL.Util.Romanizer();\n    //\n    // utility to make an ordinal form of a number\n    this.ordinalizer = new CSL.Util.Ordinalizer(state);\n    //\n    // utility to make the long ordinal form of a number, if possible\n    this.long_ordinalizer = new CSL.Util.LongOrdinalizer();\n};\n\n\nCSL.Engine.Build = function () {\n    // Alternate et-al term\n    // Holds the localization key of the alternative term\n    // to be used for et-al in a names environment.  Reduced\n    // to a term object when the element tag is processed during\n    // Build.\n    this[\"alternate-term\"] = false;\n    //\n    // flags that we are in the bibliography area.\n    // used by sort.\n    this.in_bibliography = false;\n    //\n    // scratch variable to alter behaviour when processing\n    // locale files\n    this.in_style = false;\n    //\n    // used to ignore info\n    this.skip = false;\n    //\n    // the macro ATTRIBUTE stores a macro name on this\n    // scratch variable anywhere outside the layout area\n    // during build.  The macro name is picked up when\n    // the token is encountered inside the layout area,\n    // either through a direct call, or as part of a nested\n    // macro expansion, and the macro content is exploded\n    // into the token list.\n    this.postponed_macro = false;\n    //\n    // used especially for controlling macro expansion\n    // during Build.\n    this.layout_flag = false;\n    //\n    // (was buffer_name)\n    // scratch variable to hold the name of a macro\n    // or a term until its children have been collected.\n    this.name = false;\n    this.names_variables = [[]];\n    this.name_label = [{}];\n    //\n    // scratch variable to hold the value of a form\n    // attribute until other attributes needed for\n    // processing have been collected.\n    this.form = false;\n    this.term = false;\n    //\n    // the macros themselves are discarded after Build\n    this.macro = {};\n    //\n    // the macro build stack.  used to raise an error\n    // when macros would attempt to call themselves.\n    this.macro_stack = [];\n    //\n    // stores the content of an XML text node during processing\n    this.text = false;\n    //\n    // this is a scratch variable for holding an attribute\n    // value during processing\n    this.lang = false;\n    //\n    // should be able to run uninitialized; may attract some\n    // cruft this way.\n    this.area = \"citation\";\n    this.root = \"citation\";\n    this.extension = \"\";\n    //\n    // controls the application of implicit conditional wrappers\n    // to top-level elements inside a names substitute span.\n    // zero by default, build of names tag pushes a\n    // new level with value 1.  group start tag increments by 1,\n    // group end tag decrements by 1.  conditional wrappers are\n    // only applied if value is exactly 1.\n    this.substitute_level = new CSL.Stack(0, CSL.LITERAL);\n    this.names_level = 0;\n    this.render_nesting_level = 0;\n    this.render_seen = false;\n    this.bibliography_key_pos = 0;\n};\n\n\nCSL.Engine.Configure = function () {\n    //\n    // the fail and succeed arrays are used for stack\n    // processing during configure.\n    this.tests = [];\n    this.fail = [];\n    this.succeed = [];\n};\n\n\nCSL.Engine.Citation = function (state) {\n     // Citation options area.\n     // Holds a mixture of persistent and ephemeral\n     // options and scratch data used during processing of\n     // a citation.</p>\n    this.opt = {\n        inheritedAttributes: {}\n    };\n\n    this.tokens = [];\n    // Placeholder function\n    this.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n    //\n    // configuration array to hold the collapse\n    // options, if any.\n    this.opt.collapse = [];\n    //\n    // disambiguate options\n    this.opt[\"disambiguate-add-names\"] = false;\n    this.opt[\"disambiguate-add-givenname\"] = false;\n    this.opt[\"disambiguate-add-year-suffix\"] = false;\n    this.opt[\"givenname-disambiguation-rule\"] = \"by-cite\";\n    this.opt[\"near-note-distance\"] = 5;\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"citation\";\n};\n\n\nCSL.Engine.Bibliography = function () {\n    this.opt = {\n        inheritedAttributes: {}\n    };\n    this.tokens = [];\n\n    this.opt.collapse = [];\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    this.opt[\"line-spacing\"] = 1;\n    this.opt[\"entry-spacing\"] = 1;\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"bibliography\";\n};\n\n\nCSL.Engine.BibliographySort = function () {\n    this.tokens = [];\n    this.opt = {};\n    this.opt.sort_directions = [];\n    this.opt.topdecor = [];\n    // Holds the final citation-number sort direction, for use\n    // in applying numbers in cs:citation and cs:bibliography.\n    // Value is exclusively controlled by cs:key in bibliography_sort\n    this.opt.citation_number_sort_direction = CSL.ASCENDING;\n    this.opt.citation_number_secondary = false;\n    this.tmp = {};\n    this.keys = [];\n    this.root = \"bibliography\";\n};\n\n\nCSL.Engine.CitationSort = function () {\n    this.tokens = [];\n    this.opt = {};\n    this.opt.sort_directions = [];\n    this.keys = [];\n    this.opt.topdecor = [];\n    this.root = \"citation\";\n};\n\nCSL.Engine.InText = function () {\n     // InText options area.\n     // Holds a mixture of persistent and ephemeral\n     // options and scratch data used during processing of\n     // a citation.</p>\n    this.opt = {\n        inheritedAttributes: {}\n    };\n\n    this.tokens = [];\n    // Placeholder function\n    //this.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n    //\n    // configuration array to hold the collapse\n    // options, if any.\n    this.opt.collapse = [];\n    //\n    // disambiguate options\n    this.opt[\"disambiguate-add-names\"] = false;\n    this.opt[\"disambiguate-add-givenname\"] = false;\n    this.opt[\"disambiguate-add-year-suffix\"] = false;\n    this.opt[\"givenname-disambiguation-rule\"] = \"by-cite\";\n    this.opt[\"near-note-distance\"] = 5;\n\n    this.opt.topdecor = [];\n    this.opt.layout_decorations = [];\n    this.opt.layout_prefix = \"\";\n    this.opt.layout_suffix = \"\";\n    this.opt.layout_delimiter = \"\";\n    //\n    // sorting\n    this.opt.sort_locales = [];\n    this.opt.max_number_of_names = 0;\n    this.root = \"intext\";\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.previewCitationCluster = function (citation, citationsPre, citationsPost, newMode) {\n    // Generate output for a hypothetical citation at the current position,\n    // Leave the registry in the same state in which it was found.\n    //print(\"################### previewCitationCluster() #################\");\n    var oldMode = this.opt.mode;\n    this.setOutputFormat(newMode);\n    // Avoids generating unwanted ibids, if the citationID already exists in document\n\tif (citation.citationID) {\n\t\tdelete citation.citationID;\n\t}\n    var ret = this.processCitationCluster(citation, citationsPre, citationsPost, CSL.PREVIEW);\n\n    this.setOutputFormat(oldMode);\n    return ret[1];\n};\n\nCSL.Engine.prototype.appendCitationCluster = function (citation) {\n    var citationsPre = [];\n    var len = this.registry.citationreg.citationByIndex.length;\n    for (var pos = 0; pos < len; pos += 1) {\n        var c = this.registry.citationreg.citationByIndex[pos];\n        citationsPre.push([\"\" + c.citationID, c.properties.noteIndex]);\n    }\n    // Drop the data segment to return a list of pos/string pairs.\n    return this.processCitationCluster(citation, citationsPre, [])[1];\n};\n\n\nCSL.Engine.prototype.processCitationCluster = function (citation, citationsPre, citationsPost, flag) {\n    var c, preCitation, postCitation, i, ilen, j, jlen, k, klen, n, nlen, key, Item, item, noteCitations, textCitations, m, citationsInNote;\n    this.debug = false;\n    this.tmp.loadedItemIDs = {};\n\n    // Revert citation dereference from 2ffc4664ae\n    //citation = JSON.parse(JSON.stringify(citation));\n    \n    //print(\"################### processCitationCluster() #################\");\n    this.tmp.citation_errors = [];\n    this.registry.return_data = {\"bibchange\": false};\n\n    // make sure this citation has a unique ID, and register it in citationById.\n    this.setCitationId(citation);\n\n    var oldCitationList;\n    var oldItemList;\n    var oldAmbigs;\n    if (flag === CSL.PREVIEW) {\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start state save *********\");\n        }\n        //SNIP-END\n        //\n        // Simplify.\n\n        // Take a slice of existing citations.\n        oldCitationList = this.registry.citationreg.citationByIndex.slice();\n\n        // Take a slice of current items, for later use with update.\n        oldItemList = this.registry.reflist.slice();\n\n        // Make a list of preview citation ref objects. Omit the current\n        // citation, because it will not exist in registry if: (a) this is\n        // a new citation; or (b) the calling application is assigning\n        // new citationIDs for every transaction.\n        var newCitationList = citationsPre.concat(citationsPost);\n\n        // Make a full list of desired ids, for use in preview update,\n        // and a hash list of same while we're at it.\n        // First step through known citations, then step through\n        // the items in the citation for preview.\n        var newItemIds = {};\n        var newItemIdsList = [];\n        for (var i = 0, ilen = newCitationList.length; i < ilen; i += 1) {\n            c = this.registry.citationreg.citationById[newCitationList[i][0]];\n            for (j = 0, jlen = c.citationItems.length; j < jlen; j += 1) {\n                newItemIds[c.citationItems[j].id] = true;\n                newItemIdsList.push(\"\" + c.citationItems[j].id);\n            }\n        }\n        for (j = 0, jlen = citation.citationItems.length; j < jlen; j += 1) {\n            newItemIds[citation.citationItems[j].id] = true;\n            newItemIdsList.push(\"\" + citation.citationItems[j].id);\n        }\n\n        // Clone and save off disambigs of items that will be lost.\n        oldAmbigs = {};\n        for (var i = 0, ilen = oldItemList.length; i < ilen; i += 1) {\n            if (!newItemIds[oldItemList[i].id]) {\n                var oldAkey = this.registry.registry[oldItemList[i].id].ambig;\n                var ids = this.registry.ambigcites[oldAkey];\n                if (ids) {\n                    for (j = 0, jlen = ids.length; j < jlen; j += 1) {\n                        oldAmbigs[ids[j]] = CSL.cloneAmbigConfig(this.registry.registry[ids[j]].disambig);\n                    }\n                }\n            }\n        }\n\n        // Update items.  This will produce the base name data and sort things.\n        // Possibly unnecessary?\n        //this.updateItems(this.registry.mylist.concat(tmpItems));\n\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end state save *********\");\n        }\n        //SNIP-END\n    }\n\n    this.tmp.taintedCitationIDs = {};\n    var sortedItems = [];\n\n    // Styles that use note backreferencing with a by-cite\n    // givenname disambiguation rule include the note number\n    // in the cite for disambiguation purposes. Correct resolution\n    // of disambiguate=\"true\" conditions on first-reference cites \n    // in certain editing scenarios (e.g. where a cite is moved across\n    // notes) requires that disambiguation be rerun on cites\n    // affected by the edit.\n    var rerunAkeys = {};\n\n    // retrieve item data and compose items for use in rendering\n    // attach pointer to item data to shared copy for good measure\n    for (var i = 0, ilen = citation.citationItems.length; i < ilen; i += 1) {\n        // Protect against caller-side overwrites to locator strings etc\n        item = {};\n        for (var key in citation.citationItems[i]) {\n            item[key] = citation.citationItems[i][key];\n        }\n        Item = this.retrieveItem(\"\" + item.id);\n        if (Item.id) {\n            this.transform.loadAbbreviation(\"default\", \"hereinafter\", Item.id, Item.language);\n        }\n        item = CSL.parseLocator.call(this, item);\n        if (this.opt.development_extensions.consolidate_legal_items) {\n            this.remapSectionVariable([[Item,item]]);\n        }\n        if (this.opt.development_extensions.locator_label_parse) {\n            if (item.locator && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) === -1 && (!item.label || item.label === 'page')) {\n                var m = CSL.LOCATOR_LABELS_REGEXP.exec(item.locator);\n                if (m) {\n                    var tryLabel = CSL.LOCATOR_LABELS_MAP[m[2]];\n                    if (this.getTerm(tryLabel)) {\n                        item.label = tryLabel;\n                        item.locator = m[3];\n                    }\n                }\n            }\n        }\n        var newitem = [Item, item];\n        sortedItems.push(newitem);\n        citation.citationItems[i].item = Item;\n    }\n\n    // ZZZ sort stuff moved from here.\n\n    // attach the sorted list to the citation item\n    citation.sortedItems = sortedItems;\n\n    // build reconstituted citations list in current document order\n    var citationByIndex = [];\n    var citationById = {};\n    var lastNotePos;\n    for (i=0, ilen=citationsPre.length; i<ilen; i += 1) {\n        preCitation = citationsPre[i];\n        if (this.opt.development_extensions.strict_inputs) {\n            if (citationById[preCitation[0]]) {\n                CSL.error(\"Previously referenced citationID \" + preCitation[0] + \" encountered in citationsPre\");\n            }\n            if (preCitation[1]) {\n                if (lastNotePos > preCitation[1]) {\n                    CSL.debug(\"Note index sequence is not sane at citationsPre[\" + i + \"]\");\n                }\n                lastNotePos = preCitation[1];\n            }\n        }\n        this.registry.citationreg.citationById[preCitation[0]].properties.noteIndex = preCitation[1];\n        citationByIndex.push(this.registry.citationreg.citationById[preCitation[0]]);\n        citationById[preCitation[0]] = this.registry.citationreg.citationById[preCitation[0]];\n    }\n    if (!citation.properties) {\n        citation.properties = {\n            noteIndex: 0\n        };\n    }\n    if (this.opt.development_extensions.strict_inputs) {\n        if (citationById[citation.citationID]) {\n            CSL.error(\"Citation with previously referenced citationID \" + citation.citationID);\n        }\n        if (citation.properties.noteIndex) {\n            if (lastNotePos > citation.properties.noteIndex) {\n                CSL.debug(\"Note index sequence is not sane for citation \" + citation.citationID);\n            }\n            lastNotePos = citation.properties.noteIndex;\n        }\n    }\n    citationByIndex.push(citation);\n    citationById[citation.citationID] = citation;\n    for (i=0, ilen=citationsPost.length; i<ilen; i += 1) {\n        postCitation = citationsPost[i];\n        if (this.opt.development_extensions.strict_inputs) {\n            if (citationById[postCitation[0]]) {\n                CSL.error(\"Previously referenced citationID \" + postCitation[0] + \" encountered in citationsPost\");\n            }\n            if (postCitation[1]) {\n                if (lastNotePos > postCitation[1]) {\n                    CSL.debug(\"Note index sequence is not sane at postCitation[\" + i + \"]\");\n                }\n                lastNotePos = postCitation[1];\n            }\n        }\n        this.registry.citationreg.citationById[postCitation[0]].properties.noteIndex = postCitation[1];\n        citationByIndex.push(this.registry.citationreg.citationById[postCitation[0]]);\n        citationById[postCitation[0]] = this.registry.citationreg.citationById[postCitation[0]];\n    }\n    this.registry.citationreg.citationByIndex = citationByIndex;\n    this.registry.citationreg.citationById = citationById;\n\n    //\n    // The processor provides three facilities to support\n    // updates following position reevaluation.\n    //\n    // (1) The updateItems() function reports tainted ItemIDs\n    // to state.tmp.taintedItemIDs.\n    //\n    // (2) The processor memos the type of style referencing as\n    // CSL.NONE, CSL.NUMERIC or CSL.POSITION in state.opt.update_mode.\n    //\n    // XXXX: NO LONGER\n    // (3) For citations containing cites with backreference note numbers,\n    // a string image of the rendered citation is held in\n    // citation.properties.backref_citation, and a list of\n    // ItemIDs to be used to update the backreference note numbers\n    // is memoed at citation.properties.backref_index.  When such\n    // citations change position, they can be updated with a\n    // series of simple find and replace operations, without\n    // need for rerendering.\n    //\n\n    //\n    // Position evaluation!\n    //\n    // set positions in reconstituted list, noting taints\n    this.registry.citationreg.citationsByItemId = {};\n    if (this.opt.update_mode === CSL.POSITION) {\n        textCitations = [];\n        noteCitations = [];\n        citationsInNote = {};\n    }\n    var update_items = [];\n    for (var i = 0, ilen = citationByIndex.length; i < ilen; i += 1) {\n        citationByIndex[i].properties.index = i;\n        for (j = 0, jlen = citationByIndex[i].sortedItems.length; j < jlen; j += 1) {\n            item = citationByIndex[i].sortedItems[j];\n            if (!this.registry.citationreg.citationsByItemId[item[1].id]) {\n                this.registry.citationreg.citationsByItemId[item[1].id] = [];\n                update_items.push(\"\" + item[1].id);\n            }\n            if (this.registry.citationreg.citationsByItemId[item[1].id].indexOf(citationByIndex[i]) === -1) {\n                this.registry.citationreg.citationsByItemId[item[1].id].push(citationByIndex[i]);\n            }\n        }\n        if (this.opt.update_mode === CSL.POSITION) {\n            if (citationByIndex[i].properties.noteIndex) {\n                noteCitations.push(citationByIndex[i]);\n            } else {\n                citationByIndex[i].properties.noteIndex = 0;\n                textCitations.push(citationByIndex[i]);\n            }\n        }\n    }\n    //\n    // update bibliography items here\n    //\n    if (flag !== CSL.ASSUME_ALL_ITEMS_REGISTERED) {\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start update items *********\");\n        }\n        //SNIP-END\n        // true signals implicit updateItems (will not rerun sys.retrieveItem())\n        this.updateItems(update_items, null, null, true);\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** endo update items *********\");\n        }\n        //SNIP-END\n    }\n\n    if (!this.opt.citation_number_sort && sortedItems && sortedItems.length > 1 && this.citation_sort.tokens.length > 0) {\n        for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n            sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, sortedItems[i][0], \"citation_sort\");\n        }\n\n        /* \n         * Grouped sort stuff (start)\n         */\n\n        if (this.opt.grouped_sort &&  !citation.properties.unsorted) {\n            // Insert authorstring as key.\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                var sortkeys = sortedItems[i][1].sortkeys;\n                this.tmp.authorstring_request = true;\n                // Run getAmbiguousCite() with the current disambig\n                // parameters, and pick up authorstring from the registry.\n                var mydisambig = this.registry.registry[sortedItems[i][0].id].disambig;\n                \n                this.tmp.authorstring_request = true;\n                CSL.getAmbiguousCite.call(this, sortedItems[i][0], mydisambig);\n                var authorstring = this.registry.authorstrings[sortedItems[i][0].id];\n                this.tmp.authorstring_request = false;\n\n                sortedItems[i][1].sortkeys = [authorstring].concat(sortkeys);\n            }\n\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n            // Replace authorstring key in items with same (authorstring) with the \n            // keystring of first normal key. This forces grouped sorts,\n            // as discussed here:\n            // https://github.com/citation-style-language/schema/issues/40\n            var lastauthor = false;\n            var thiskey = false;\n            var thisauthor = false;\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                if (sortedItems[i][1].sortkeys[0] !== lastauthor) {\n                    thisauthor = sortedItems[i][1].sortkeys[0];\n                    thiskey =  sortedItems[i][1].sortkeys[1];\n                }\n                sortedItems[i][1].sortkeys[0] = \"\" + thiskey + i;\n                lastauthor = thisauthor;\n            }\n        }\n        /*\n         * Grouped sort stuff (end)\n         */\n\n        if (!citation.properties.unsorted) {\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n    }\n\n    // evaluate parallels\n\n    if (this.opt.parallel.enable) {\n        this.parallel.StartCitation(citation.sortedItems);\n    }\n\n    var citations;\n    if (this.opt.update_mode === CSL.POSITION) {\n        for (var i = 0; i < 2; i += 1) {\n            var first_ref = {};\n            var last_ref = {};\n            var first_container_ref = {};\n            citations = [textCitations, noteCitations][i];\n            for (j = 0, jlen = citations.length; j < jlen; j += 1) {\n                var onecitation = citations[j];\n                if (!citations[j].properties.noteIndex) {\n                    citations[j].properties.noteIndex = 0;\n                }\n                citations[j].properties.noteIndex = parseInt(citations[j].properties.noteIndex, 10);\n                if (j > 0 && onecitation.properties.noteIndex && citations[j - 1].properties.noteIndex > onecitation.properties.noteIndex) {\n                    citationsInNote = {};\n                    first_ref = {};\n                    last_ref = {};\n                    first_container_ref = {};\n                }\n                for (k = 0, klen = onecitation.sortedItems.length; k < klen; k += 1) {\n                    if (onecitation.sortedItems[k][1].parallel && onecitation.sortedItems[k][1].parallel !== \"first\") {\n                        continue;\n                    }\n                    if (!citationsInNote[onecitation.properties.noteIndex]) {\n                        citationsInNote[onecitation.properties.noteIndex] = 1;\n                    } else {\n                        citationsInNote[onecitation.properties.noteIndex] += 1;\n                    }\n                }\n                // Set the following:\n                //\n                // (1) position as required (as per current Zotero)\n                // (2) first-reference-note-number as required (on onecitation item)\n                // (3) near-note as required (on onecitation item, according to\n                //     state.opt[\"near-note-distance\"] parameter)\n                // (4) state.registry.citationreg.citationsByItemId.\n                //\n                // Any state changes caused by unsetting or resetting should\n                // trigger a single entry for the citations in\n                // state.tmp.taintedCitationIDs (can block on presence of\n                // state.registry.citationreg.citationsByItemId).\n                //\n                for (k = 0, klen = citations[j].sortedItems.length; k < klen; k += 1) {\n                    item = citations[j].sortedItems[k];\n                    // Okay ...\n                    // We set up three IDs for use in position evaluation.\n                    // item_id is the real Item.id\n                    // first_id is the legislation_id or Item.id (so statutes backref to first in set, chapters to specific chapter)\n                    // last_id is the legislation_id or container_id (so statute AND chapter distance is from any ref in set)\n                    // (replaces myid)\n                    var item_id = item[0].id;\n                    var first_id = item[0].legislation_id ? item[0].legislation_id : item[0].id;\n                    var last_id = item[0].legislation_id ? item[0].legislation_id : item[0].container_id ? item[0].container_id : item[0].id;\n                    var myxloc = item[1][\"locator-extra\"];\n                    var mylocator = item[1].locator;\n                    var mylabel = item[1].label;\n                    var incitationid;\n                    var incitationxloc;\n                    if (k > 0) {\n                        // incitationid is only reached in the else branch\n                        // following \"undefined\" === typeof first_ref[myid]\n                        // below\n                        if (onecitation.sortedItems[k - 1][0].legislation_id) {\n                            incitationid = onecitation.sortedItems[k - 1][0].legislation_id;\n                        } else {\n                            incitationid = onecitation.sortedItems[k - 1][1].id;\n                            incitationxloc = onecitation.sortedItems[k - 1][1][\"locator-extra\"];\n                            //if (onecitation.sortedItems[k-1][1].parallel === \"last\") {\n                                for (var l=k-2; l>-1; l--) {\n                                    if (onecitation.sortedItems[l][1].parallel === \"first\") {\n                                        incitationid = onecitation.sortedItems[l][1].id;\n                                        incitationxloc = onecitation.sortedItems[l][1][\"locator-extra\"];\n                                    }\n                                }\n                            //}\n                        }\n                    }\n                    // Don't touch item data of other cites when previewing\n                    if (flag === CSL.PREVIEW) {\n                        if (onecitation.citationID != citation.citationID) {\n                            if (\"undefined\" === typeof first_ref[item[1].id]) {\n                                first_ref[first_id] = onecitation.properties.noteIndex;\n                                last_ref[last_id] = onecitation.properties.noteIndex;\n                            } else {\n                                last_ref[last_id] = onecitation.properties.noteIndex;\n                            }\n                            continue;\n                        }\n                    }\n                    var oldvalue = {};\n                    oldvalue.position = item[1].position;\n                    oldvalue[\"first-reference-note-number\"] = item[1][\"first-reference-note-number\"];\n                    oldvalue[\"first-container-reference-note-number\"] = item[1][\"first-container-reference-note-number\"];\n                    oldvalue[\"near-note\"] = item[1][\"near-note\"];\n                    item[1][\"first-reference-note-number\"] = 0;\n                    item[1][\"first-container-reference-note-number\"] = 0;\n                    item[1][\"near-note\"] = false;\n                    if (this.registry.citationreg.citationsByItemId[item_id]) {\n                        if (this.opt.xclass === 'note' && this.opt.has_disambiguate) {\n                            var oldCount = this.registry.registry[item[0].id][\"citation-count\"];\n                            var newCount = this.registry.citationreg.citationsByItemId[item_id].length;\n                            this.registry.registry[item[0].id][\"citation-count\"] = this.registry.citationreg.citationsByItemId[item_id].length;\n                            if (\"number\" === typeof oldCount) {\n                                var oldCountCheck = (oldCount < 2);\n                                var newCountCheck = (newCount < 2);\n                                if (oldCountCheck !== newCountCheck) {\n                                    for (var l=0,llen=this.registry.citationreg.citationsByItemId[item_id].length;l<llen;l++) {\n                                        rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                        this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[item_id][l].citationID] = true;\n                                    }\n                                }\n                            } else {\n                                for (var l=0,llen=this.registry.citationreg.citationsByItemId[item_id].length;l<llen;l++) {\n                                    rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                    this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[item_id][l].citationID] = true;\n                                }\n                            }\n                        }\n                    }\n                    var oldlastid;\n                    var oldlastxloc;\n                    \n                    // Okay, chill.\n                    // The first test needs to be for presence of last_ref[last_id]. Everything\n                    // after in subsequent evaluation depends on that.\n\n                    // HOWEVER, despite starting with this test, we need to catch every member\n                    // of the set, and set its first-container-reference-note-number to point at the\n                    // first.\n\n                    // ALSO, despite starting with this test, we need to set first-reference-note-number\n                    // on every item.\n                    \n                    // So ... we run an independent test on first_ref[first_id]], and let this ride.\n                    \n                    if (\"undefined\" === typeof last_ref[last_id] && onecitation.properties.mode !== \"author-only\") {\n                        first_ref[first_id] = onecitation.properties.noteIndex;\n                        last_ref[last_id] = onecitation.properties.noteIndex;\n                        first_container_ref[last_id] = onecitation.properties.noteIndex;\n                        item[1].position = CSL.POSITION_FIRST;\n                    } else {\n                        //\n                        // backward-looking position evaluation happens here.\n                        //\n                        //\n                        //\n                        var ibidme = false;\n                        var suprame = false;\n                        var prevCitation = null;\n                        if (j > 0) {\n                            var prevCitation = citations[j-1];\n                        }\n                        var thisCitation = citations[j];\n                        // XXX Ugly, but This is used in the second else-if branch condition below.\n                        if (j > 0) {\n                            var old_last_id_offset = 1;\n                            if (prevCitation.properties.mode === \"author-only\" && j > 1) {\n                                old_last_id_offset = 2;\n                            }\n                            var adjusted_offset = (j - old_last_id_offset);\n                            if (citations[adjusted_offset].sortedItems.length) {\n                                oldlastid =  citations[adjusted_offset].sortedItems.slice(-1)[0][1].id;\n                                oldlastxloc =  citations[j - old_last_id_offset].sortedItems.slice(-1)[0][1][\"locator-extra\"];\n                            }\n                            if (prevCitation.sortedItems.length) {\n                                if (prevCitation.sortedItems[0].slice(-1)[0].legislation_id) {\n                                    oldlastid = prevCitation.sortedItems[0].slice(-1)[0].legislation_id;\n                                }\n                            }\n                        }\n                        if (j > 0 && k === 0 && prevCitation.properties.noteIndex !== thisCitation.properties.noteIndex) {\n                            // Case 1: source in previous onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be a previous onecitation with one item\n                            //     (b) this item must be the first in this onecitation\n                            //     (c) the previous onecitation must contain a reference\n                            //         to the same item ...\n                            //     (d) the note numbers must be the same or consecutive.\n                            // (this has some jiggery-pokery in it for parallels)\n                            var useme = false;\n                            // XXX Can oldid be equated with oldlastid, I wonder ...\n                            var oldid = prevCitation.sortedItems[0][0].id;\n                            if (prevCitation.sortedItems[0][0].legislation_id) {\n                                oldid = prevCitation.sortedItems[0][0].legislation_id;\n                            }\n                            if ((oldid  == first_id && prevCitation.properties.noteIndex >= (thisCitation.properties.noteIndex - 1))) {\n                                var prevxloc = prevCitation.sortedItems[0][1][\"locator-extra\"];\n                                var thisxloc = thisCitation.sortedItems[0][1][\"locator-extra\"];\n                                if ((citationsInNote[prevCitation.properties.noteIndex] === 1 || prevCitation.properties.noteIndex === 0) && prevxloc === thisxloc) {\n                                    useme = true;\n                                }\n                            }\n                            if (useme) {\n                                ibidme = true;\n                            } else {\n                                suprame = true;\n                            }\n                        } else if (k > 0 && incitationid == first_id && incitationxloc == myxloc) {\n                            // Case 2: immediately preceding source in this onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be an imediately preceding reference to  the\n                            //         same item in this onecitation; and\n                            ibidme = true;\n                        } else if (k === 0 && j > 0 && prevCitation.properties.noteIndex == thisCitation.properties.noteIndex\n                                   && prevCitation.sortedItems.length \n                                   && oldlastid == first_id && oldlastxloc == myxloc) {\n                            // ... in case there are separate citations in the same note ...\n                            // Case 2 [take 2]: immediately preceding source in this onecitation\n                            // (1) Threshold conditions\n                            //     (a) there must be an imediately preceding reference to  the\n                            //         same item in this onecitation; and\n                            ibidme = true;\n                        } else {\n                            // everything else is definitely subsequent\n                            suprame = true;\n                        }\n                        // conditions\n                        var prev, prev_locator, prev_label, curr_locator, curr_label;\n                        if (ibidme) {\n                            if (k > 0) {\n                                prev = onecitation.sortedItems[(k - 1)][1];\n                            } else {\n                                prev = citations[(j - 1)].sortedItems[0][1];\n                            }\n                            if (prev.locator) {\n                                if (prev.label) {\n                                    prev_label = prev.label;\n                                } else {\n                                    prev_label = \"\";\n                                }\n                                prev_locator = \"\" + prev.locator + prev_label;\n                            } else {\n                                prev_locator = prev.locator;\n                            }\n                            if (mylocator) {\n                                if (mylabel) {\n                                    curr_label = mylabel;\n                                } else {\n                                    curr_label = \"\";\n                                }\n                                curr_locator = \"\" + mylocator + curr_label;\n                            } else {\n                                curr_locator = mylocator;\n                            }\n                        }\n                        // triage\n                        if (ibidme && prev_locator && !curr_locator) {\n                            ibidme = false;\n                            suprame = true;\n\n                        }\n                        if (ibidme) {\n                            if (!prev_locator && curr_locator) {\n                                //     (a) if the previous onecitation had no locator\n                                //         and this onecitation has one, use ibid+pages\n                                item[1].position = CSL.POSITION_IBID_WITH_LOCATOR;\n                            } else if (!prev_locator && !curr_locator) {\n                                //     (b) if the previous onecitation had no locator\n                                //         and this onecitation also has none, use ibid\n                                item[1].position = CSL.POSITION_IBID;\n                                //print(\"setting ibid in cmd_cite()\");\n                            } else if (prev_locator && curr_locator === prev_locator) {\n                                //     (c) if the previous onecitation had a locator\n                                //         (page number, etc.) and this onecitation has\n                                //         a locator that is identical, use ibid\n\n                                item[1].position = CSL.POSITION_IBID;\n                                //print(\"setting ibid in cmd_cite() [2]\");\n                            } else if (prev_locator && curr_locator && curr_locator !== prev_locator) {\n                                //     (d) if the previous onecitation had a locator,\n                                //         and this onecitation has one that differs,\n                                //         use ibid+pages\n                                item[1].position = CSL.POSITION_IBID_WITH_LOCATOR;\n                            } else {\n                                //     (e) if the previous onecitation had a locator\n                                //         and this onecitation has none, use subsequent\n                                //\n                                //     ... and everything else would be subsequent also\n                                ibidme = false; // just to be clear\n                                suprame = true;\n                            }\n                        }\n                        if (suprame) {\n                            item[1].position = CSL.POSITION_CONTAINER_SUBSEQUENT;\n                            if (\"undefined\" === typeof first_ref[first_id]) {\n                                first_ref[first_id] = onecitation.properties.noteIndex;\n                            } else {\n                                item[1].position = CSL.POSITION_SUBSEQUENT;\n                            }\n                        }\n                        if (suprame || ibidme) {\n                            if (onecitation.properties.mode === \"author-only\") {\n                                item[1].position = CSL.POSITION_FIRST;\n                            }\n                            if (first_container_ref[last_id] != onecitation.properties.noteIndex) {\n                                item[1]['first-container-reference-note-number'] = first_container_ref[last_id];\n                                if (this.registry.registry[item[0].id]) {\n                                    this.registry.registry[item[0].id]['first-container-reference-note-number'] = first_container_ref[last_id];\n                                }\n                            }\n                            if (first_ref[first_id] != onecitation.properties.noteIndex) {\n                                item[1][\"first-reference-note-number\"] = first_ref[first_id];\n                                if (this.registry.registry[item[0].id]) {\n                                    // This is either the earliest recorded number, or the number of the current citation, whichever is smaller.\n                                    /*\n                                    var oldFirst = this.registry.citationreg.citationsByItemId[item_id][0].properties.noteIndex;\n                                    var newFirst = onecitation.properties.noteIndex;\n                                    this.registry.registry[item[0].id]['first-reference-note-number'] = newFirst < oldFirst ? newFirst: oldFirst;\n                                     */\n                                    // Try this instead?\n                                    this.registry.registry[item[0].id]['first-reference-note-number'] = first_ref[first_id];\n                                }\n                            }\n                        }\n                    }\n                    if (onecitation.properties.noteIndex) {\n                        var note_distance = parseInt(onecitation.properties.noteIndex, 10) - parseInt(last_ref[last_id], 10);\n                        if (item[1].position !== CSL.POSITION_FIRST \n                            && note_distance <= this.citation.opt[\"near-note-distance\"]) {\n                            item[1][\"near-note\"] = true;\n                        }\n                        last_ref[last_id] = onecitation.properties.noteIndex;\n                    } else if (item[1].position !== CSL.POSITION_FIRST) {\n                        item[1][\"near-note\"] = true;\n                    }\n                    if (onecitation.citationID != citation.citationID) {\n                        for (n = 0, nlen = CSL.POSITION_TEST_VARS.length; n < nlen; n += 1) {\n                            var param = CSL.POSITION_TEST_VARS[n];\n                            if (item[1][param] !== oldvalue[param]) {\n                                if (this.registry.registry[item[0].id]) {\n                                    if (param === 'first-reference-note-number') {\n                                        rerunAkeys[this.registry.registry[item[0].id].ambig] = true;\n                                        this.tmp.taintedItemIDs[item[0].id] = true;\n                                    }\n                                }\n                                this.tmp.taintedCitationIDs[onecitation.citationID] = true;\n                            }\n                        }\n                    }\n                    if (this.sys.variableWrapper) {\n                        item[1].index = onecitation.properties.index;\n                        item[1].noteIndex = onecitation.properties.noteIndex;\n                    }\n                }\n            }\n        }\n    }\n    if (this.opt.citation_number_sort && sortedItems && sortedItems.length > 1 && this.citation_sort.tokens.length > 0) {\n        if (!citation.properties.unsorted) {\n            for (var i = 0, ilen = sortedItems.length; i < ilen; i += 1) {\n                sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, sortedItems[i][0], \"citation_sort\");\n            }\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n    }\n    for (var key in this.tmp.taintedItemIDs) {\n        if (this.tmp.taintedItemIDs.hasOwnProperty(key)) {\n            citations = this.registry.citationreg.citationsByItemId[key];\n            // Current citation may be tainted but will not exist\n            // during previewing.\n            if (citations) {\n                for (var i = 0, ilen = citations.length; i < ilen; i += 1) {\n                    this.tmp.taintedCitationIDs[citations[i].citationID] = true;\n                }\n            }\n        }\n    }\n\n    var ret = [];\n    if (flag === CSL.PREVIEW) {\n        // If previewing, return only a rendered string\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start run processor *********\");\n        }\n        //SNIP-END\n        try {\n            ret = this.process_CitationCluster.call(this, citation.sortedItems, citation);\n        } catch (e) {\n            CSL.error(\"Error running CSL processor for preview: \"+e);\n        }\n            \n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end run processor *********\");\n            CSL.debug(\"****** start state restore *********\");\n        }\n        //SNIP-END\n        // Wind out anything related to new items added for the preview.\n        // This means (1) names, (2) disambig state for affected items,\n        // (3) keys registered in the ambigs pool arrays, and (4) registry\n        // items.\n        //\n\n        // restore sliced citations\n        this.registry.citationreg.citationByIndex = oldCitationList;\n        this.registry.citationreg.citationById = {};\n        for (var i = 0, ilen = oldCitationList.length; i < ilen; i += 1) {\n            this.registry.citationreg.citationById[oldCitationList[i].citationID] = oldCitationList[i];\n        }\n\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** start final update *********\");\n        }\n        //SNIP-END\n        var oldItemIds = [];\n        for (var i = 0, ilen = oldItemList.length; i < ilen; i += 1) {\n            oldItemIds.push(\"\" + oldItemList[i].id);\n        }\n        this.updateItems(oldItemIds, null, null, true);\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end final update *********\");\n        }\n        //SNIP-END\n        // Roll back disambig states\n        for (var key in oldAmbigs) {\n            if (oldAmbigs.hasOwnProperty(key)) {\n                this.registry.registry[key].disambig = oldAmbigs[key];\n            }\n        }\n        //SNIP-START\n        if (this.debug) {\n            CSL.debug(\"****** end state restore *********\");\n        }\n        //SNIP-END\n    } else {\n        // Rerun cites that have moved across citations or had a change\n        // in their number of subsequent references, so that disambiguate\n        // and subsequent-reference-count conditions are applied\n        // correctly in output.\n        for (var rerunAkey in rerunAkeys) {\n            this.disambiguate.run(rerunAkey, citation);\n        }\n        // Run taints only if not previewing\n        //\n        // Push taints to the return object\n        //\n        var obj;\n        for (var key in this.tmp.taintedCitationIDs) {\n            if (key == citation.citationID) {\n                continue;\n            }\n            var mycitation = this.registry.citationreg.citationById[key];\n            if (!mycitation.properties.unsorted) {\n                for (var i = 0, ilen = mycitation.sortedItems.length; i < ilen; i += 1) {\n                    mycitation.sortedItems[i][1].sortkeys = CSL.getSortKeys.call(this, mycitation.sortedItems[i][0], \"citation_sort\");\n                }\n                mycitation.sortedItems.sort(this.citation.srt.compareCompositeKeys);\n            }\n            // For error reporting\n            this.tmp.citation_pos = mycitation.properties.index;\n            this.tmp.citation_note_index = mycitation.properties.noteIndex;\n            this.tmp.citation_id = \"\" + mycitation.citationID;\n            obj = [];\n            obj.push(mycitation.properties.index);\n            obj.push(this.process_CitationCluster.call(this, mycitation.sortedItems, mycitation));\n            obj.push(mycitation.citationID);\n            ret.push(obj);\n        }\n        this.tmp.taintedItemIDs = {};\n        this.tmp.taintedCitationIDs = {};\n\n        // For error reporting again\n        this.tmp.citation_pos = citation.properties.index;\n        this.tmp.citation_note_index = citation.properties.noteIndex;\n        this.tmp.citation_id = \"\" + citation.citationID;\n\n        obj = [];\n        obj.push(citationsPre.length);\n        obj.push(this.process_CitationCluster.call(this, sortedItems, citation));\n        obj.push(citation.citationID);\n        ret.push(obj);\n        //\n        // note for posterity: Rhino and Spidermonkey produce different\n        // sort results for items with matching keys.  That discrepancy\n        // turned up a subtle bug in the parallel detection code, trapped\n        // at line 266, above, and in line 94 of util_parallel.js.\n        //\n        ret.sort(function (a, b) {\n            if (a[0] > b[0]) {\n                return 1;\n            } else if (a[0] < b[0]) {\n                return -1;\n            } else {\n                return 0;\n            }\n        });\n        //\n        // In normal rendering, return is a list of two-part arrays, with the first element\n        // a citation index number, and the second the text to be inserted.\n        //\n    }\n    this.registry.return_data.citation_errors = this.tmp.citation_errors.slice();\n    return [this.registry.return_data, ret];\n};\n\nCSL.Engine.prototype.process_CitationCluster = function (sortedItems, citation) {\n    var str = \"\";\n    if (citation && citation.properties && citation.properties.mode === \"composite\") {\n        citation.properties.mode = \"author-only\";\n        var firstChunk = CSL.getCitationCluster.call(this, sortedItems, citation);\n        citation.properties.mode = \"suppress-author\";\n        var secondChunk = \"\";\n        if (citation.properties.infix) {\n            this.output.append(citation.properties.infix);\n            secondChunk = this.output.string(this, this.output.queue);\n            // Had no idea this could return a single-element array! Go figure.\n            if (\"object\" === typeof secondChunk) {\n                secondChunk = secondChunk.join(\"\");\n            }\n        }\n        var thirdChunk = CSL.getCitationCluster.call(this, sortedItems, citation);\n        citation.properties.mode = \"composite\";\n        if (firstChunk && secondChunk && CSL.SWAPPING_PUNCTUATION.concat([\"\\u2019\", \"\\'\"]).indexOf(secondChunk[0]) > -1) {\n            firstChunk += secondChunk;\n            secondChunk = false;\n        }\n        str = [firstChunk, secondChunk, thirdChunk].filter(function(obj) {\n            return obj;\n        }).join(\" \");\n    } else {\n        str = CSL.getCitationCluster.call(this, sortedItems, citation);\n    }\n    return str;\n};\n\nCSL.Engine.prototype.makeCitationCluster = function (rawList) {\n    var inputList, newitem, str, pos, len, item, Item;\n    inputList = [];\n    len = rawList.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = {};\n        for (var key in rawList[pos]) {\n            item[key] = rawList[pos][key];\n        }\n        Item = this.retrieveItem(\"\" + item.id);\n        // Code block is copied from processCitationCluster() above\n        if (this.opt.development_extensions.locator_label_parse) {\n            if (item.locator && [\"bill\",\"gazette\",\"legislation\",\"regulation\",\"treaty\"].indexOf(Item.type) === -1 && (!item.label || item.label === 'page')) {\n                var m = CSL.LOCATOR_LABELS_REGEXP.exec(item.locator);\n                if (m) {\n                    var tryLabel = CSL.LOCATOR_LABELS_MAP[m[2]];\n                    if (this.getTerm(tryLabel)) {\n                        item.label = tryLabel;\n                        item.locator = m[3];\n                    }\n                }\n            }\n        }\n        if (item.locator) {\n            item.locator = (\"\" + item.locator).replace(/\\s+$/, '');\n        }\n        newitem = [Item, item];\n        inputList.push(newitem);\n    }\n    if (this.opt.development_extensions.consolidate_legal_items) {\n        this.remapSectionVariable(inputList);\n    }\n    if (inputList && inputList.length > 1 && this.citation_sort.tokens.length > 0) {\n        len = inputList.length;\n        for (pos = 0; pos < len; pos += 1) {\n            inputList[pos][1].sortkeys = CSL.getSortKeys.call(this, inputList[pos][0], \"citation_sort\");\n        }\n        inputList.sort(this.citation.srt.compareCompositeKeys);\n    }\n    this.tmp.citation_errors = [];\n    var str = CSL.getCitationCluster.call(this, inputList);\n    return str;\n};\n\n\n/**\n * Get the undisambiguated version of a cite, without decorations\n * <p>This is used internally by the Registry.</p>\n *\n * [object] CSL Item\n * [object] disambiguation parameters\n * [boolean] If true, include first-reference-note-number value in cite\n */\nCSL.getAmbiguousCite = function (Item, disambig, visualForm, item) {\n    var ret;\n    var flags = this.tmp.group_context.tip;\n    var oldTermSiblingLayer = {\n        term_intended: flags.term_intended,\n        variable_attempt: flags.variable_attempt,\n        variable_success: flags.variable_success,\n        output_tip: flags.output_tip,\n        label_form: flags.label_form,\n        non_parallel: flags.non_parallel,\n        parallel_last: flags.parallel_last,\n        parallel_first: flags.parallel_first,\n        parallel_last_override: flags.parallel_last_override,\n        parallel_delimiter_override: flags.parallel_delimiter_override,\n        parallel_delimiter_override_on_suppress: flags.parallel_delimiter_override_on_suppress,\n        condition: flags.condition,\n        force_suppress: flags.force_suppress,\n        done_vars: flags.done_vars.slice()\n    };\n    if (disambig) {\n        this.tmp.disambig_request = disambig;\n    } else {\n        this.tmp.disambig_request = false;\n    }\n    var itemSupp = {\n        position: CSL.POSITION_SUBSEQUENT,\n        \"near-note\": true\n    };\n\n    if (item) {\n        itemSupp.locator = item.locator;\n        itemSupp.label = item.label;\n    }\n\n    if (this.registry.registry[Item.id] \n        && this.registry.citationreg.citationsByItemId\n        && this.registry.citationreg.citationsByItemId[Item.id]\n        && this.registry.citationreg.citationsByItemId[Item.id].length \n        && visualForm) {\n        if (this.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\") {\n            itemSupp['first-reference-note-number'] = this.registry.registry[Item.id]['first-reference-note-number'];\n        }\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    var origSuppressDecorations = this.tmp.suppress_decorations;\n    this.tmp.suppress_decorations = true;\n    this.tmp.just_looking = true;\n\n    CSL.getCite.call(this, Item, itemSupp, null, false);\n    // !!!\n    for (var i=0,ilen=this.output.queue.length;i<ilen;i+=1) {\n        CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[i]);\n    }\n    if (this.opt.development_extensions.clean_up_csl_flaws) {\n        for (var j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            this.output.adjust.upward(this.output.queue[j]);\n            this.output.adjust.leftward(this.output.queue[j]);\n            this.output.adjust.downward(this.output.queue[j]);\n            this.output.adjust.fix(this.output.queue[j]);\n        }\n    }\n    var ret = this.output.string(this, this.output.queue);\n    this.tmp.just_looking = false;\n    this.tmp.suppress_decorations = origSuppressDecorations;\n    // Cache the result.\n    this.tmp.group_context.replace(oldTermSiblingLayer);\n    return ret;\n};\n\n/**\n * Return delimiter for use in join\n * <p>Splice evaluation is done during cite\n * rendering, and this method returns the\n * result.  Evaluation requires three items\n * of information from the preceding cite, if\n * one is present: the names used; the years\n * used; and the suffix appended to the\n * citation.  These details are copied into\n * the state object before processing begins,\n * and are cleared by the processor on\n * completion of the run.</p>\n */\n\nCSL.getSpliceDelimiter = function (last_locator, last_collapsed, pos) {\n    //print(pos +  \" after-collapse-delimiter=\"+this.citation.opt[\"after-collapse-delimiter\"] + \"\\n  cite_group_delimiter=\" + this.tmp.use_cite_group_delimiter + \"\\n  last_collapsed=\" +last_collapsed + \"\\n  have_collapsed=\" +this.tmp.have_collapsed + \"\\n  last_locator=\" + last_locator)\n    if (undefined !== this.citation.opt[\"after-collapse-delimiter\"]) {\n        if (last_locator) {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else if (last_collapsed && !this.tmp.have_collapsed) {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else if (!last_collapsed && !this.tmp.have_collapsed && this.citation.opt.collapse !== \"year-suffix\") {\n            this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n        } else {\n            this.tmp.splice_delimiter = this.citation.opt.layout_delimiter;\n        }\n    } else if (this.tmp.use_cite_group_delimiter) {\n        this.tmp.splice_delimiter = this.citation.opt.cite_group_delimiter;\n    } else {\n        if (this.tmp.have_collapsed && this.opt.xclass === \"in-text\" && this.opt.update_mode !== CSL.NUMERIC) {\n            this.tmp.splice_delimiter = \", \";\n        } else if (this.tmp.cite_locales[pos - 1]) {\n            //\n            // Must have a value to take effect.  Use zero width space to force empty delimiter.\n            var alt_affixes = this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[pos - 1]];\n            if (alt_affixes && alt_affixes.delimiter) {\n                this.tmp.splice_delimiter = alt_affixes.delimiter;\n            }\n        } else if (!this.tmp.splice_delimiter) {\n            // This happens when no delimiter is set on cs:layout under cs:citation\n            this.tmp.splice_delimiter = \"\";\n        }\n    }\n\n/*\n    if (last_locator && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"]) {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (last_collapsed && !this.tmp.have_collapsed && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"]) {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (!last_collapsed && !this.tmp.have_collapsed && \"string\" === typeof this.citation.opt[\"after-collapse-delimiter\"] && !this.citation.opt.collapse === \"year-suffix\") {\n        this.tmp.splice_delimiter = this.citation.opt[\"after-collapse-delimiter\"];\n    } else if (this.tmp.use_cite_group_delimiter) {\n        this.tmp.splice_delimiter = this.citation.opt.cite_group_delimiter;\n    } else if (this.tmp.have_collapsed && this.opt.xclass === \"in-text\" && this.opt.update_mode !== CSL.NUMERIC) {\n        this.tmp.splice_delimiter = \", \";\n    } else if (this.tmp.cite_locales[pos - 1]) {\n        //\n        // Must have a value to take effect.  Use zero width space to force empty delimiter.\n        var alt_affixes = this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[pos - 1]];\n        if (alt_affixes && alt_affixes.delimiter) {\n            this.tmp.splice_delimiter = alt_affixes.delimiter;\n        }\n    } else if (!this.tmp.splice_delimiter) {\n        // This happens when no delimiter is set on cs:layout under cs:citation\n        this.tmp.splice_delimiter = \"\";\n    }\n*/\n    // Paranoia\n    //if (!this.tmp.splice_delimiter) {\n    //    this.tmp.splice_delimiter = \"\";\n    //}\n    return this.tmp.splice_delimiter;\n};\n\n/*\n * Compose individual cites into a single string, with\n * flexible inter-cite splicing.\n */\nCSL.getCitationCluster = function (inputList, citation) {\n    var result, objects, myparams, len, pos, item, last_collapsed, params, empties, composite, compie, myblobs, Item, llen, ppos, obj, preceding_item, txt_esc, error_object, citationID, authorOnly, suppressAuthor;\n    var citation_prefix = \"\";\n    this.output.checkNestedBrace = new CSL.checkNestedBrace(this);\n    if (citation) {\n        citationID = citation.citationID;\n        authorOnly = citation.properties.mode === \"author-only\" ? !!citation.properties.mode : false;\n        if (this.opt.xclass !== \"note\") {\n            suppressAuthor = citation.properties.mode === \"suppress-author\" ? !!citation.properties.mode : false;\n        }\n        if (citation.properties.prefix) {\n            citation_prefix = CSL.checkPrefixSpaceAppend(this, citation.properties.prefix);\n        }\n    }\n    inputList = inputList ? inputList : [];\n    this.tmp.last_primary_names_string = false;\n    txt_esc = CSL.getSafeEscape(this);\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    result = \"\";\n    objects = [];\n    this.tmp.last_suffix_used = \"\";\n    this.tmp.last_names_used = [];\n    this.tmp.last_years_used = [];\n    this.tmp.backref_index = [];\n    this.tmp.cite_locales = [];\n    if (!this.tmp.just_looking) {\n        this.tmp.abbrev_trimmer = {\n            QUASHES: {}\n        };\n    }\n\n    var use_layout_prefix = this.output.checkNestedBrace.update(this.citation.opt.layout_prefix + citation_prefix);\n    //var use_layout_prefix = this.citation.opt.layout_prefix;\n\n    var suppressTrailingPunctuation = false;\n    if (this.citation.opt.suppressTrailingPunctuation) {\n        suppressTrailingPunctuation = true;\n    }\n    if (citationID) {\n        //this.registry.citationreg.citationById[citationID].properties.backref_index = false;\n        //this.registry.citationreg.citationById[citationID].properties.backref_citation = false;\n        if (this.registry.citationreg.citationById[citationID].properties[\"suppress-trailing-punctuation\"]) {\n            suppressTrailingPunctuation = true;\n        }\n    }\n\n    // Adjust locator positions if that looks like a sensible thing to do.\n    if (this.opt.xclass === \"note\") {\n        var parasets = [];\n        var lastTitle = false;\n        var lastPosition = false;\n        var lastID = false;\n        var lst = [];\n        for (var i=0, ilen = inputList.length; i < ilen; i += 1) {\n            var type = inputList[i][0].type;\n            var title = inputList[i][0].title;\n            var position = inputList[i][1].position;\n            var id = inputList[i][0].id;\n            if (title && type === \"legal_case\" && id !== lastID && position) {\n                // Start a fresh sublist if the item title does not match the last one\n                if (title !== lastTitle || parasets.length === 0) {\n                    lst = [];\n                    parasets.push(lst);\n                }\n                lst.push(inputList[i][1]);\n            }\n            lastTitle = title;\n            lastPosition = position;\n            lastID = id;\n        }\n        // We now have a list of sublists, each w/matching titles\n        for (i=0, ilen=parasets.length; i < ilen; i += 1) {\n            lst = parasets[i];\n            if (lst.length < 2) {\n                continue;\n            }\n            // Get the locator in last position, but only if it's the only one in the set.\n            var locatorInLastPosition = lst.slice(-1)[0].locator;\n            if (locatorInLastPosition) {\n                for (var j=0, jlen=lst.length - 1; j < jlen; j += 1) {\n                    if (lst[j].locator) {\n                        locatorInLastPosition = false;\n                    }\n                }\n            }\n            // move the locator here, if it's called for.\n            if (locatorInLastPosition) {\n                lst[0].locator = locatorInLastPosition;\n                delete lst.slice(-1)[0].locator;\n                lst[0].label = lst.slice(-1)[0].label;\n                if (lst.slice(-1)[0].label) {\n                    delete lst.slice(-1)[0].label;\n                }\n            }\n       }\n    }\n    myparams = [];\n    len = inputList.length;\n    if (inputList[0] && inputList[0][1]) {\n        if (authorOnly) {\n            delete inputList[0][1][\"suppress-author\"];\n            inputList[0][1][\"author-only\"] = true;\n        } else if (suppressAuthor) {\n            delete inputList[0][1][\"author-only\"];\n            inputList[0][1][\"suppress-author\"] = true;\n        }\n    }\n    if (this.opt.parallel.enable) {\n        this.parallel.StartCitation(inputList);\n    }\n    for (pos = 0; pos < len; pos += 1) {\n\n        // Also for parallels only\n        this.tmp.cite_index = pos;\n\n        Item = inputList[pos][0];\n        item = inputList[pos][1];\n        item = CSL.parseLocator.call(this, item);\n        last_collapsed = this.tmp.have_collapsed;\n        var last_locator = false;\n        if (pos > 0 && inputList[pos-1][1]) {\n            last_locator = !!inputList[pos-1][1].locator;\n        }\n        params = {};\n        \n        // Reset shadow_numbers here, suppress reset in getCite()\n        this.tmp.shadow_numbers = {};\n        if (!this.tmp.just_looking && this.opt.hasPlaceholderTerm) {\n            var output = this.output;\n            this.output = new CSL.Output.Queue(this);\n            this.output.adjust = new CSL.Output.Queue.adjust();\n            CSL.getAmbiguousCite.call(this, Item, null, false, item);\n            this.output = output;\n        }\n\n        this.tmp.in_cite_predecessor = false;\n        // true is to block reset of shadow numbers\n        \n        \n        if (pos > 0) {\n            CSL.getCite.call(this, Item, item, \"\" + inputList[(pos - 1)][0].id, true);\n        } else {\n            this.tmp.term_predecessor = false;\n            CSL.getCite.call(this, Item, item, null, true);\n        }\n\n        // Make a note of any errors\n        if (!this.tmp.cite_renders_content) {\n            error_object = {\n                citationID: \"\" + this.tmp.citation_id,\n                index: this.tmp.citation_pos,\n                noteIndex: this.tmp.citation_note_index,\n                itemID: \"\" + Item.id,\n                citationItems_pos: pos,\n                error_code: CSL.ERROR_NO_RENDERED_FORM\n            };\n            this.tmp.citation_errors.push(error_object);\n        }\n        params.splice_delimiter = CSL.getSpliceDelimiter.call(this, last_locator, last_collapsed, pos);\n        // XXX This appears to be superfluous.\n        if (item && item[\"author-only\"]) {\n            this.tmp.suppress_decorations = true;\n        }\n\n        if (pos > 0) {\n            preceding_item = inputList[pos - 1][1];\n\n            // XXX OR if preceding suffix is empty, and the current prefix begins with a full stop.\n\n            var precedingEndsInPeriodOrComma = preceding_item.suffix && [\";\", \".\", \",\"].indexOf(preceding_item.suffix.slice(-1)) > -1;\n            var currentStartsWithPeriodOrComma = !preceding_item.suffix && item.prefix && [\";\", \".\", \",\"].indexOf(item.prefix.slice(0, 1)) > -1;\n            if (precedingEndsInPeriodOrComma || currentStartsWithPeriodOrComma) {\n                var spaceidx = params.splice_delimiter.indexOf(\" \");\n                if (spaceidx > -1 && !currentStartsWithPeriodOrComma) {\n                    params.splice_delimiter = params.splice_delimiter.slice(spaceidx);\n                } else {\n                    params.splice_delimiter = \"\";\n                }\n            }\n        }\n        params.suppress_decorations = this.tmp.suppress_decorations;\n        params.have_collapsed = this.tmp.have_collapsed;\n        //\n        // XXXXX: capture parameters to an array, which\n        // will be of the same length as this.output.queue,\n        // corresponding to each element.\n        //\n        myparams.push(params);\n        if (item[\"author-only\"]) {\n            break;\n        }\n    }\n    //\n    // output.queue is a simple array.  do a slice\n    // of it to get each cite item, setting params from\n    // the array that was built in the preceding loop.\n    //\n    empties = 0;\n    myblobs = this.output.queue.slice();\n\n    var citation_suffix = \"\";\n    if (citation) {\n        citation_suffix = CSL.checkSuffixSpacePrepend(this, citation.properties.suffix);\n    }\n    var suffix = this.citation.opt.layout_suffix;\n    var last_locale = this.tmp.cite_locales[this.tmp.cite_locales.length - 1];\n    //\n    // Must have a value to take effect.  Use zero width space to force empty suffix.\n    if (last_locale && this.tmp.cite_affixes[this.tmp.area][last_locale] && this.tmp.cite_affixes[this.tmp.area][last_locale].suffix) {\n        suffix = this.tmp.cite_affixes[this.tmp.area][last_locale].suffix;\n    }\n    if (CSL.TERMINAL_PUNCTUATION.slice(0, -1).indexOf(suffix.slice(0, 1)) > -1) {\n        suffix = suffix.slice(0, 1);\n    }\n    //print(\"=== FROM CITE ===\");\n    suffix = this.output.checkNestedBrace.update(citation_suffix + suffix);\n\n\n    for (var i=0,ilen=this.output.queue.length;i<ilen;i+=1) {\n        CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[i]);\n    }\n    if (!this.tmp.suppress_decorations && this.output.queue.length) {\n        if (!(this.opt.development_extensions.apply_citation_wrapper\n              && this.sys.wrapCitationEntry\n               && !this.tmp.just_looking\n              && this.tmp.area === \"citation\")) { \n\n            if (!suppressTrailingPunctuation) {\n                this.output.queue[this.output.queue.length - 1].strings.suffix = suffix;\n            }\n            this.output.queue[0].strings.prefix = use_layout_prefix;\n        }\n    }\n    if (this.opt.development_extensions.clean_up_csl_flaws) {\n        for (var j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            //print(\"OUTPUT[5]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.upward(this.output.queue[j]);\n            //print(\"OUTPUT[4]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.leftward(this.output.queue[j]);\n            //print(\"OUTPUT[3]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.output.adjust.downward(this.output.queue[j]);\n            //print(\"OUTPUT[2]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n            this.tmp.last_chr = this.output.adjust.fix(this.output.queue[j]);\n            //print(\"OUTPUT[1]: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations','num'],2))\n        }\n    }\n    //print(\"this.tmp.last_chr=\"+this.tmp.last_chr);\n    for (pos = 0, len = myblobs.length; pos < len; pos += 1) {\n        var buffer = [];\n        this.output.queue = [myblobs[pos]];\n        this.tmp.suppress_decorations = myparams[pos].suppress_decorations;\n        this.tmp.splice_delimiter = myparams[pos].splice_delimiter;\n        //\n        // oh, one last second thought on delimiters ...\n        //\n\n        if (myblobs[pos].parallel_delimiter) {\n            this.tmp.splice_delimiter = myblobs[pos].parallel_delimiter;\n        }\n        this.tmp.have_collapsed = myparams[pos].have_collapsed;\n\n        composite = this.output.string(this, this.output.queue);\n\n        this.tmp.suppress_decorations = false;\n        // meaningless assignment\n        // this.tmp.handle_ranges = false;\n        if (\"string\" === typeof composite) {\n            this.tmp.suppress_decorations = false;\n            if (!composite) {\n                if (this.opt.development_extensions.throw_on_empty) {\n                    CSL.error(\"Citation would render no content\");\n                } else {\n                    composite = \"[NO_PRINTED_FORM]\";\n                }\n            }\n            return composite;\n        }\n        if (\"object\" === typeof composite && composite.length === 0 && !item[\"suppress-author\"]) {\n            if (pos === 0) {\n                var errStr = \"[CSL STYLE ERROR: reference with no printed form.]\";\n                var preStr = pos === 0 ? txt_esc(this.citation.opt.layout_prefix) : \"\";\n                var sufStr = pos === (myblobs.length - 1) ? txt_esc(this.citation.opt.layout_suffix) : \"\";\n                composite.push(preStr + errStr + sufStr);\n            } else if (pos === myblobs.length - 1) {\n                var tmpobj = objects[objects.length - 1];\n                if (typeof tmpobj === \"string\") {\n                    objects[objects.length -1] += (txt_esc(this.citation.opt.layout_suffix));\n                } else if (typeof tmpobj === \"object\") {\n                    tmpobj.strings.suffix += (txt_esc(this.citation.opt.layout_suffix));\n                }\n            }\n        }\n        if (buffer.length && \"string\" === typeof composite[0]) {\n            composite.reverse();\n            var tmpstr = composite.pop();\n            if (tmpstr && tmpstr.slice(0, 1) === \",\") {\n                buffer.push(tmpstr);\n            } else if (\"string\" == typeof buffer.slice(-1)[0] && buffer.slice(-1)[0].slice(-1) === \",\") {\n                buffer.push(\" \" + tmpstr);\n            } else if (tmpstr) {\n                buffer.push(txt_esc(this.tmp.splice_delimiter) + tmpstr);\n            }\n        } else {\n            composite.reverse();\n            compie = composite.pop();\n            if (\"undefined\" !== typeof compie) {\n                if (buffer.length && \"string\" === typeof buffer[buffer.length - 1]) {\n                    buffer[buffer.length - 1] += compie.successor_prefix;\n                }\n                buffer.push(compie);\n            }\n        }\n        // Seems odd, but this was unnecessary and broken.\n        //composite.reverse();\n        llen = composite.length;\n        for (ppos = 0; ppos < llen; ppos += 1) {\n            obj = composite[ppos];\n            if (\"string\" === typeof obj) {\n                buffer.push(txt_esc(this.tmp.splice_delimiter) + obj);\n                continue;\n            }\n            compie = composite.pop();\n            if (\"undefined\" !== typeof compie) {\n                buffer.push(compie);\n            }\n        }\n        if (buffer.length === 0 && !inputList[pos][1][\"suppress-author\"]) {\n            empties += 1;\n        }\n        if (buffer.length > 1 && typeof buffer[0] !== \"string\") {\n            buffer = [this.output.renderBlobs(buffer)];\n        }\n        if (buffer.length) {\n            if (\"string\" === typeof buffer[0]) {\n                if (pos > 0) {\n                    buffer[0] = txt_esc(this.tmp.splice_delimiter) + buffer[0];\n                }\n            } else {\n                if (pos > 0) {\n                    buffer[0].splice_prefix = this.tmp.splice_delimiter;\n                } else {\n                    buffer[0].splice_prefix = \"\";\n                }\n            }\n        }\n        objects = objects.concat(buffer);\n    }\n    // print(\"OBJECTS=\"+objects);\n    result += this.output.renderBlobs(objects);\n\n    if (result) {\n        //if (CSL.TERMINAL_PUNCTUATION.indexOf(this.tmp.last_chr) > -1 \n        //    && this.tmp.last_chr === use_layout_suffix.slice(0, 1)) {\n        //    use_layout_suffix = use_layout_suffix.slice(1);\n        //}\n        if (!this.tmp.suppress_decorations) {\n            len = this.citation.opt.layout_decorations.length;\n            for (pos = 0; pos < len; pos += 1) {\n                params = this.citation.opt.layout_decorations[pos];\n                // The \"normal\" formats in some output modes expect\n                // a superior nested decoration environment, and\n                // so should produce no output here.\n                if (params[1] === \"normal\") {\n                    continue;\n                }\n                if (!item || !item[\"author-only\"]) {\n                    result = this.fun.decorate[params[0]][params[1]](this, result);\n                }\n            }\n        }\n    }\n    this.tmp.suppress_decorations = false;\n    if (!result) {\n        if (this.opt.development_extensions.throw_on_empty) {\n            CSL.error(\"Citation would render no content\");\n        } else {\n            result = \"[NO_PRINTED_FORM]\"\n        }\n    }\n    return result;\n};\n\n/*\n * Render a single cite item.\n *\n * This is called on the state object, with a single\n * Item as input.  It iterates exactly once over the style\n * citation tokens, and leaves the result of rendering in\n * the top-level list in the relevant *.opt.output\n * stack, as a list item consisting of a single string.\n *\n * (This is dual-purposed for generating individual\n * entries in a bibliography.)\n */\nCSL.getCite = function (Item, item, prevItemID, blockShadowNumberReset) {\n    var next, error_object;\n    var areaOrig = this.tmp.area;\n    if (item && item[\"author-only\"] && this.intext && this.intext.tokens.length > 0) {\n            this.tmp.area = \"intext\";\n    }\n    this.tmp.cite_renders_content = false;\n    this.tmp.probably_rendered_something = false;\n    this.tmp.prevItemID = prevItemID;\n\n    CSL.citeStart.call(this, Item, item, blockShadowNumberReset);\n    next = 0;\n    this.tmp.name_node = {};\n    this.nameOutput = new CSL.NameOutput(this, Item, item);\n\n    // rerun?\n    while (next < this[this.tmp.area].tokens.length) {\n        next = CSL.tokenExec.call(this, this[this.tmp.area].tokens[next], Item, item);\n    }\n\n    CSL.citeEnd.call(this, Item, item);\n    // Odd place for this, but it seems to fit here\n    if (!this.tmp.cite_renders_content && !this.tmp.just_looking) {\n        if (this.tmp.area === \"bibliography\") {\n            error_object = {\n                index: this.tmp.bibliography_pos,\n                itemID: \"\" + Item.id,\n                error_code: CSL.ERROR_NO_RENDERED_FORM\n            };\n            this.tmp.bibliography_errors.push(error_object);\n        }\n    }\n    this.tmp.area = areaOrig;\n    return \"\" + Item.id;\n};\n\n\nCSL.citeStart = function (Item, item, blockShadowNumberReset) {\n    this.tmp.lang_array = [];\n    if (Item.language) {\n        // Guard against garbage locales in user input\n        var m = Item.language.match(/^([a-zA-Z]+).*/);\n        if (m) {\n            this.tmp.lang_array.push(m[1].toLowerCase());\n        }\n    }\n    this.tmp.lang_array.push(this.opt.lang);\n    if (!blockShadowNumberReset) {\n        this.tmp.shadow_numbers = {};\n    }\n    \n    this.tmp.disambiguate_count = 0;\n    this.tmp.disambiguate_maxMax = 0;\n    this.tmp.same_author_as_previous_cite = false;\n    if (!this.tmp.suppress_decorations) {\n        this.tmp.subsequent_author_substitute_ok = true;\n    } else {\n        this.tmp.subsequent_author_substitute_ok = false;\n    }\n    this.tmp.lastchr = \"\";\n    if (this.tmp.area === \"citation\" && this.citation.opt.collapse && this.citation.opt.collapse.length) {\n        //this.tmp.have_collapsed = \"year\";\n        this.tmp.have_collapsed = true;\n    } else {\n        this.tmp.have_collapsed = false;\n    }\n    this.tmp.render_seen = false;\n    if (this.tmp.disambig_request  && ! this.tmp.disambig_override) {\n        this.tmp.disambig_settings = this.tmp.disambig_request;\n    } else if (this.registry.registry[Item.id] && ! this.tmp.disambig_override) {\n        this.tmp.disambig_request = this.registry.registry[Item.id].disambig;\n        this.tmp.disambig_settings = this.registry.registry[Item.id].disambig;\n    } else {\n        this.tmp.disambig_settings = new CSL.AmbigConfig();\n    }\n    if (this.tmp.area !== 'citation') {\n        if (!this.registry.registry[Item.id]) {\n            this.tmp.disambig_restore = new CSL.AmbigConfig();\n        } else {\n            this.tmp.disambig_restore = CSL.cloneAmbigConfig(this.registry.registry[Item.id].disambig);\n            if (this.tmp.area === 'bibliography' && this.tmp.disambig_settings && this.tmp.disambig_override) {\n                if (this.opt[\"disambiguate-add-names\"]) {\n                    this.tmp.disambig_settings.names = this.registry.registry[Item.id].disambig.names.slice();\n                    if (this.tmp.disambig_request) {\n                        this.tmp.disambig_request.names = this.registry.registry[Item.id].disambig.names.slice();\n                    }\n                }\n                if (this.opt[\"disambiguate-add-givenname\"]) {\n                    // This is weird and delicate and not fully understood\n                    this.tmp.disambig_request = this.tmp.disambig_settings;\n                    this.tmp.disambig_settings.givens = this.registry.registry[Item.id].disambig.givens.slice();\n                    this.tmp.disambig_request.givens = this.registry.registry[Item.id].disambig.givens.slice();\n                    for (var i=0,ilen=this.tmp.disambig_settings.givens.length;i<ilen;i+=1) {\n                        this.tmp.disambig_settings.givens[i] = this.registry.registry[Item.id].disambig.givens[i].slice();\n                    }\n                    for (var i=0,ilen=this.tmp.disambig_request.givens.length;i<ilen;i+=1) {\n                        this.tmp.disambig_request.givens[i] = this.registry.registry[Item.id].disambig.givens[i].slice();\n                    }\n                }\n            }\n        }\n    }\n\n    this.tmp.names_used = [];\n    this.tmp.nameset_counter = 0;\n    this.tmp.years_used = [];\n    this.tmp.names_max.clear();\n    if (!this.tmp.just_looking) {\n        if (!item || item.parallel === \"first\" || !item.parallel) {\n            this.tmp.abbrev_trimmer = {\n                QUASHES: {}\n            };\n        }\n    }\n\n    this.tmp.splice_delimiter = this[this.tmp.area].opt.layout_delimiter;\n    //this.tmp.splice_delimiter = this[this.tmp.area].opt.delimiter;\n\n    this.bibliography_sort.keys = [];\n    this.citation_sort.keys = [];\n\n    this.tmp.has_done_year_suffix = false;\n    this.tmp.last_cite_locale = false;\n    // SAVE PARAMETERS HERE, IF APPROPRIATE\n    // (promiscuous addition of global parameters => death by a thousand cuts)\n    if (!this.tmp.just_looking && item && !item.position && this.registry.registry[Item.id]) {\n        this.tmp.disambig_restore = CSL.cloneAmbigConfig(this.registry.registry[Item.id].disambig);\n    }\n    // XXX This only applied to the \"number\" variable itself? Huh?\n    //this.setNumberLabels(Item);\n    this.tmp.first_name_string = false;\n    this.tmp.authority_stop_last = 0;\n};\n\nCSL.citeEnd = function (Item, item) {\n    // RESTORE PARAMETERS IF APPROPRIATE\n    if (this.tmp.disambig_restore && this.registry.registry[Item.id]) {\n        this.registry.registry[Item.id].disambig.names = this.tmp.disambig_restore.names.slice();\n        this.registry.registry[Item.id].disambig.givens = this.tmp.disambig_restore.givens.slice();\n        for (var i=0,ilen=this.registry.registry[Item.id].disambig.givens.length;i<ilen;i+=1) {\n            this.registry.registry[Item.id].disambig.givens[i] = this.tmp.disambig_restore.givens[i].slice();\n        }\n    }\n    this.tmp.disambig_restore = false;\n\n    if (item && item.suffix) {\n        //this.tmp.last_suffix_used = this.tmp.suffix.value();\n        this.tmp.last_suffix_used = item.suffix;\n    } else {\n        this.tmp.last_suffix_used = \"\";\n    }\n    this.tmp.last_years_used = this.tmp.years_used.slice();\n    this.tmp.last_names_used = this.tmp.names_used.slice();\n    this.tmp.cut_var = false;\n\n    // This is a hack, in a way; I have lost track of where\n    // the disambig (name rendering) settings used for rendering work their way\n    // into the registry.  This resets defaults to the subsequent form,\n    // when first cites are rendered.\n    //if (this.tmp.disambig_restore && this.registry.registry[Item.id]) {\n    //    this.registry.registry[Item.id].disambig = this.tmp.disambig_restore;\n    //}\n    //this.tmp.disambig_restore = false;\n    this.tmp.disambig_request = false;\n\n    this.tmp.cite_locales.push(this.tmp.last_cite_locale);\n\n    if (this.tmp.issued_date && this.tmp.renders_collection_number) {\n        var buf = [];\n        for (var i = this.tmp.issued_date.list.length - 1; i > this.tmp.issued_date.pos; i += -1) {\n            buf.push(this.tmp.issued_date.list.pop());\n        }\n        // Throw away the unwanted blob\n        this.tmp.issued_date.list.pop();\n        // Put the other stuff back\n        for (i = buf.length - 1; i > -1; i += -1) {\n            this.tmp.issued_date.list.push(buf.pop());\n        }\n    }\n    this.tmp.issued_date = false;\n    this.tmp.renders_collection_number = false;\n\n};\n\n/*global CSL: true */\n\nCSL.Engine.prototype.makeBibliography = function (bibsection) {\n    var debug, ret, params, maxoffset, item, len, pos, tok, tokk, tokkk, entry_ids, entry_strings;\n    debug = false;\n    if (!bibsection && (this.bibliography.opt.exclude_types || this.bibliography.opt.exclude_with_fields)) {\n        bibsection = {\n            exclude: []\n        };\n        if (this.bibliography.opt.exclude_types) {\n            for (var i in this.bibliography.opt.exclude_types) {\n                var val = this.bibliography.opt.exclude_types[i];\n                bibsection.exclude.push({\n                    field: \"type\",\n                    value: val\n                });\n            }\n        }\n        if (this.bibliography.opt.exclude_with_fields) {\n            for (var i in this.bibliography.opt.exclude_with_fields) {\n                var field = this.bibliography.opt.exclude_with_fields[i];\n                bibsection.exclude.push({\n                    field: field, value: true\n                });\n            }\n        }\n    }\n    // API change: added in version 1.0.51\n    if (!this.bibliography.tokens.length) {\n        return false;\n    }\n    if (\"string\" === typeof bibsection) {\n        this.opt.citation_number_slug = bibsection;\n        bibsection = false;\n    }\n    //SNIP-START\n    if (debug) {\n        len = this.bibliography.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tok = this.bibliography.tokens[pos];\n            CSL.debug(\"bibtok: \" + tok.name);\n        }\n        CSL.debug(\"---\");\n        len = this.citation.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tokk = this.citation.tokens[pos];\n            CSL.debug(\"cittok: \" + tok.name);\n        }\n        CSL.debug(\"---\");\n        len = this.bibliography_sort.tokens.length;\n        for (pos = 0; pos < len; pos += 1) {\n            tokkk = this.bibliography_sort.tokens[pos];\n            CSL.debug(\"bibsorttok: \" + tok.name);\n        }\n    }\n    //SNIP-END\n\n    // For paged returns\n    ret = CSL.getBibliographyEntries.call(this, bibsection);\n    entry_ids = ret[0];\n    entry_strings = ret[1];\n\n    // For paged returns\n    var done = ret[2];\n\n    params = {\n        \"maxoffset\": 0,\n        \"entryspacing\": this.bibliography.opt[\"entry-spacing\"],\n        \"linespacing\": this.bibliography.opt[\"line-spacing\"],\n        \"second-field-align\": false,\n        \"entry_ids\": entry_ids,\n        \"bibliography_errors\": this.tmp.bibliography_errors.slice(),\n        \"done\": done\n    };\n    if (this.bibliography.opt[\"second-field-align\"]) {\n        params[\"second-field-align\"] = this.bibliography.opt[\"second-field-align\"];\n    }\n    maxoffset = 0;\n    len = this.registry.reflist.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = this.registry.reflist[pos];\n        if (item.offset > params.maxoffset) {\n            params.maxoffset = item.offset;\n        }\n    }\n    if (this.bibliography.opt.hangingindent) {\n        params.hangingindent = this.bibliography.opt.hangingindent;\n    }\n    params.bibstart = this.fun.decorate.bibstart;\n    params.bibend = this.fun.decorate.bibend;\n\n    this.opt.citation_number_slug = false;\n    return [params, entry_strings];\n};\n\n/*\n * Compose individual cites into a single string.\n */\nCSL.getBibliographyEntries = function (bibsection) {\n    var ret, input, include, anymatch, allmatch, bib_entry, res, item, spec, lllen, pppos, topblobs, entry_item_ids, debug, i, ilen, siblings, skips, sortedItems, eyetem, entry_item_data, j, jlen;\n    ret = [];\n    entry_item_data = [];\n    this.tmp.area = \"bibliography\";\n    this.tmp.root = \"bibliography\";\n    this.tmp.last_rendered_name = false;\n    this.tmp.bibliography_errors = [];\n    this.tmp.bibliography_pos = 0;\n    \n    // For paged returns: disable generated entries and\n    // do not fetch full items as a batch (input variable\n    // consists of ids only in this case)\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        input = this.registry.getSortedIds();        \n    } else {\n        input = this.refetchItems(this.registry.getSortedIds());\n    }\n    \n    this.tmp.disambig_override = true;\n    function eval_string(a, b) {\n        if (a === b) {\n            return true;\n        }\n        return false;\n    }\n    function eval_list(a, lst) {\n        lllen = lst.length;\n        for (pppos = 0; pppos < lllen; pppos += 1) {\n            if (eval_string(a, lst[pppos])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    function eval_spec(a, b) {\n        if (\"boolean\" === typeof a || !a) {\n            if (a) {\n                return !!b;\n            } else {\n                return !b;\n            }\n        } else {\n            if (\"string\" === typeof b) {\n                return eval_string(a, b);\n            } else if (!b) {\n                return false;\n            } else {\n                return eval_list(a, b);\n            }\n        }\n    }\n\n    skips = {};\n\n    // For paged returns\n    var page_item_count;\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        page_item_count = 0;\n        if (bibsection.page_start !== true) {\n            for (i = 0, ilen = input.length; i < ilen; i += 1) {\n                skips[input[i]] = true;\n                if (bibsection.page_start == input[i]) {\n                    break;\n                }\n            }\n        }\n    }\n\n    var processed_item_ids = [];\n\n    var consolidatedIDs = {};\n    this.tmp.container_item_count = {};\n    input = input.filter(o => {\n        var ret = o;\n        if (o.legislation_id) {\n            if (consolidatedIDs[o.legislation_id]) {\n                ret = false;\n            } else {\n                consolidatedIDs[o.legislation_id] = true;\n            }\n        } else if (o.container_id) {\n            if (!this.tmp.container_item_count[o.container_id]) {\n                this.tmp.container_item_count[o.container_id] = 0;\n            }\n            this.tmp.container_item_count[o.container_id]++;\n            if (this.bibliography.opt.consolidate_containers.indexOf(o.type) > -1) {\n                if (consolidatedIDs[o.container_id]) {\n                    ret = false;\n                } else {\n                    consolidatedIDs[o.container_id] = true;\n                }\n            }\n        }\n        return ret;\n    });\n\n    this.tmp.container_item_pos = {};\n\n    for (i = 0, ilen = input.length; i < ilen; i += 1) {\n        \n        // For paged returns\n        if (bibsection && bibsection.page_start && bibsection.page_length) {\n            if (skips[input[i]]) {\n                continue;\n            }\n            item = this.refetchItem(input[i]);\n            if (page_item_count === bibsection.page_length) {\n                break;\n            }\n        } else {\n            item = input[i];\n            if (skips[item.id]) {\n                continue;\n            }\n        }\n        if (bibsection) {\n            include = true;\n            if (bibsection.include) {\n                //\n                // Opt-in: these are OR-ed.\n                //\n                include = false;\n                for (j = 0, jlen = bibsection.include.length; j < jlen; j += 1) {\n                    spec = bibsection.include[j];\n                    if (eval_spec(spec.value, item[spec.field])) {\n                        include = true;\n                        break;\n                    }\n                }\n            } else if (bibsection.exclude) {\n                //\n                // Opt-out: these are also OR-ed.\n                //\n                anymatch = false;\n                for (j = 0, jlen = bibsection.exclude.length; j < jlen; j += 1) {\n                    spec = bibsection.exclude[j];\n                    if (eval_spec(spec.value, item[spec.field])) {\n                        anymatch = true;\n                        break;\n                    }\n                }\n                if (anymatch) {\n                    include = false;\n                }\n            } else if (bibsection.select) {\n                //\n                // Multiple condition opt-in: these are AND-ed.\n                //\n                include = false;\n                allmatch = true;\n                for (j = 0, jlen = bibsection.select.length; j < jlen; j += 1) {\n                    spec = bibsection.select[j];\n                    if (!eval_spec(spec.value, item[spec.field])) {\n                        allmatch = false;\n                    }\n                }\n                if (allmatch) {\n                    include = true;\n                }\n            }\n            if (bibsection.quash) {\n                //\n                // Stop criteria: These are AND-ed.\n                //\n                allmatch = true;\n                for (j = 0, jlen = bibsection.quash.length; j < jlen; j += 1) {\n                    spec = bibsection.quash[j];\n                    if (!eval_spec(spec.value, item[spec.field])) {\n                        allmatch = false;\n                    }\n                }\n                if (allmatch) {\n                    include = false;\n                }\n            }\n            if (!include) {\n                continue;\n            }\n        }\n        //SNIP-START\n        if (debug) {\n            CSL.debug(\"BIB: \" + item.id);\n        }\n\n        if (item.container_id) {\n            if (!this.tmp.container_item_pos[item.container_id]) {\n                this.tmp.container_item_pos[item.container_id] = 0;\n            }\n            this.tmp.container_item_pos[item.container_id]++;\n        }\n        \n        //SNIP-END\n        bib_entry = new CSL.Token(\"group\", CSL.START);\n        bib_entry.decorations = [[\"@bibliography\", \"entry\"]].concat(this.bibliography.opt.layout_decorations);\n        this.output.startTag(\"bib_entry\", bib_entry);\n        if (item.system_id && this.sys.embedBibliographyEntry) {\n            this.output.current.value().item_id = item.system_id;\n        } else {\n            this.output.current.value().system_id = item.id;\n        }\n\n        // 2019-06-25 Hacked to conform to new parallels evaluation method\n        // 2020-04-25 Revised to work with latest, and final, parallel-first/parallel-last attributes\n        entry_item_ids = [];\n        if (this.registry.registry[item.id].master\n            && !(bibsection && bibsection.page_start && bibsection.page_length)) {\n            // Fetch item content\n            sortedItems = [[item, {id: item.id}]];\n            siblings = this.registry.registry[item.id].siblings;\n            for (var j=0,jlen=siblings.length; j<jlen; j++) {\n               sortedItems.push([this.refetchItem(siblings[j]), {id: siblings[j]}]);\n            }\n            // Adjust parameters\n            this.parallel.StartCitation(sortedItems);\n            if (this.registry.registry[item.id].parallel_delimiter_override) {\n                this.output.queue[0].strings.delimiter = this.registry.registry[item.id].parallel_delimiter_override;\n            } else {\n                this.output.queue[0].strings.delimiter = \", \";\n            }\n            this.tmp.term_predecessor = false;\n            this.tmp.cite_index = 0;\n            // Run cites\n            for (j = 0, jlen = sortedItems.length; j < jlen; j += 1) {\n                if (j < (sortedItems.length - 1)) {\n                    this.tmp.parallel_and_not_last = true;\n                } else {\n                    delete this.tmp.parallel_and_not_last;\n                }\n                entry_item_ids.push(\"\" + CSL.getCite.call(this, sortedItems[j][0], sortedItems[j][1]));\n                this.tmp.cite_index++;\n                skips[sortedItems[j][0].id] = true;\n            }\n        } else if (!this.registry.registry[item.id].siblings) {\n            this.tmp.term_predecessor = false;\n            this.tmp.cite_index = 0;\n            entry_item_ids.push(\"\" + CSL.getCite.call(this, item));\n            if (bibsection && bibsection.page_start && bibsection.page_length) {\n                page_item_count += 1;\n            }\n            //skips[item.id] = true;\n        }\n        // For RDF support\n        entry_item_data.push(\"\");\n\n        this.tmp.bibliography_pos += 1;\n\n        processed_item_ids.push(entry_item_ids);\n        //\n        // XXX: loop to render parallels goes here\n        // XXX: just have to mark them somehow ...\n        //\n        this.output.endTag(\"bib_entry\");\n        //\n        // place layout prefix on first blob of each cite, and suffix\n        // on the last non-empty blob of each cite.  there be dragons\n        // here.\n        //\n        if (this.output.queue[0].blobs.length && this.output.queue[0].blobs[0].blobs.length) {\n            // The output queue stuff needs cleaning up.  the result of\n            // output.current.value() is sometimes a blob, sometimes its list\n            // of blobs.  this inconsistency is a source of confusion, and\n            // should be cleaned up across the code base in the first\n            // instance, before making any other changes to output code.\n            if (!this.output.queue[0].blobs[0].blobs[0].strings) {\n                topblobs = this.output.queue[0].blobs;\n            } else {\n                topblobs = this.output.queue[0].blobs[0].blobs;\n            }\n            topblobs[0].strings.prefix = this.bibliography.opt.layout_prefix + topblobs[0].strings.prefix;\n        }\n        for (j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            CSL.Output.Queue.purgeEmptyBlobs(this.output.queue[j]);\n            //print(\"XXX: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n        }\n        for (j=0,jlen=this.output.queue.length;j<jlen;j+=1) {\n            this.output.adjust.upward(this.output.queue[j]);\n            this.output.adjust.leftward(this.output.queue[j]);\n            this.output.adjust.downward(this.output.queue[j],true);\n            this.output.adjust.fix(this.output.queue[j]);\n            //print(\"OUTPUT: \"+JSON.stringify(this.output.queue[j],['strings','prefix','suffix','delimiter','blobs','decorations'],2))\n        }\n\n        //print(\"DUMP \"+JSON.stringify(this.output.queue, [\"strings\", \"decorations\", \"prefix\", \"suffix\", \"delimiter\", \"blobs\"], 2));\n\n        // XXX Need to account for numeric blobs in input.\n        // XXX No idea how this could have worked previously.\n\n        //print(\"BLOBS \"+this.output.queue[0].blobs[0].blobs);\n\n        //print(\"JSON \"+JSON.stringify(this.output.queue[0].blobs, null, 2));\n\n        res = this.output.string(this, this.output.queue)[0];\n        \n        if (!res && this.opt.update_mode === CSL.NUMERIC) {\n            var err = (ret.length + 1) + \". [CSL STYLE ERROR: reference with no printed form.]\";\n            res = CSL.Output.Formats[this.opt.mode][\"@bibliography/entry\"](this, err);\n        }\n        if (res) {\n            ret.push(res);\n        }\n    }\n\n    var done = false;\n    if (bibsection && bibsection.page_start && bibsection.page_length) {\n        var last_expected_id = input.slice(-1)[0];\n        var last_seen_id = processed_item_ids.slice(-1)[0];\n        if (!last_expected_id || !last_seen_id || last_expected_id == last_seen_id) {\n            done = true;\n        }\n    }\n    this.tmp.disambig_override = false;\n\n    // XXX done\n    return [processed_item_ids, ret, done];\n};\n\n/*global CSL: true */\n\n\nCSL.Engine.prototype.setCitationId = function (citation, force) {\n    var ret, id, direction;\n    ret = false;\n    if (!citation.citationID || force) {\n        id = Math.floor(Math.random() * 100000000000000);\n        while (true) {\n            direction = 0;\n            if (!this.registry.citationreg.citationById[id]) {\n                // In case the ID is used as an HTML identifier in the\n                // calling application.\n                //   https://github.com/Juris-M/citeproc-js/issues/22\n                citation.citationID = \"a\" + id.toString(32);\n                break;\n            } else if (!direction && id < 50000000000000) {\n                direction = 1;\n            } else {\n                direction = -1;\n            }\n            if (direction === 1) {\n                id += 1;\n            } else {\n                id += -1;\n            }\n        }\n        ret = \"\" + id;\n    }\n    this.registry.citationreg.citationById[citation.citationID] = citation;\n    return ret;\n};\n\nCSL.Engine.prototype.rebuildProcessorState = function (citations, mode, uncitedItemIDs) {\n    // Rebuilds the processor from scratch, based on a list of citation\n    // objects. In a dynamic application, once the internal state of processor\n    // is established, citations should edited with individual invocations\n    // of processCitationCluster().\n\n    // citations is a list of citation objects in document order.\n    // mode is one of \"html\", \"text\" or \"rtf\".\n    // uncitedItemIDs is a list of itemIDs or a JS object with itemIDs as keys.\n    // Returns a list of [citationID,noteIndex,string] triples in document order.\n    // Set citation.properties.noteIndex to 0 for in-text citations.\n    // It is not necessary to run updateItems() before this function.\n    if (!citations) {\n        citations = [];\n    }\n    if (!mode) {\n        mode = 'html';\n    }\n    var doneIDs = {};\n    var itemIDs = [];\n    for (var i=0,ilen=citations.length;i<ilen;i+=1) {\n        for (var j=0,jlen=citations[i].citationItems.length;j<jlen;j+=1) {\n            var itemID = \"\" + citations[i].citationItems[j].id;\n            if (!doneIDs[itemID]) {\n                itemIDs.push(itemID);\n            }\n            doneIDs[itemID] = true;\n        }\n    }\n    this.updateItems(itemIDs);\n    var pre = [];\n    var post = [];\n    var ret = [];\n    var oldMode = this.opt.mode;\n    this.setOutputFormat(mode);\n    for (var i=0,ilen=citations.length;i<ilen;i+=1) {\n        // res contains a result report and a list of [index,string] pairs\n        // index begins at 0\n        var res = this.processCitationCluster(citations[i],pre,post,CSL.ASSUME_ALL_ITEMS_REGISTERED);\n        pre.push([citations[i].citationID,citations[i].properties.noteIndex]);\n        for (var j=0,jlen=res[1].length;j<jlen;j+=1) {\n            var index = res[1][j][0];\n            ret[index] = [\n                pre[index][0],\n                pre[index][1],\n                res[1][j][1]\n            ];\n        }\n    }\n    this.updateUncitedItems(uncitedItemIDs);\n    this.setOutputFormat(oldMode);\n    return ret;\n};\n\n\nCSL.Engine.prototype.restoreProcessorState = function (citations) {\n    var i, ilen, j, jlen, item, Item, newitem, citationList, itemList, sortedItems;\n    \n    // This function is deprecated.\n    // Use rebuildProcessorState() instead.\n\n    // Quickly restore state from citation details retained by\n    // calling application.\n    //\n    // if citations are provided, position details and sortkeys \n    // on the citation objects are are assumed to be correct.  Item\n    // data is retrieved, and sortedItems arrays are created and\n    // sorted as required by the current style.\n    //\n    // If citations is an empty list or nil, reset processor to\n    // empty state.\n    citationList = [];\n    itemList = [];\n    if (!citations) {\n        citations = [];\n    }\n    // Adjust citationIDs to avoid duplicates, save off index numbers\n    var indexNumbers = [];\n    var citationIds = {};\n    for (i = 0, ilen = citations.length; i < ilen; i += 1) {\n        if (citationIds[citations[i].citationID]) {\n            this.setCitationId(citations[i], true);\n        }\n        citationIds[citations[i].citationID] = true;\n        indexNumbers.push(citations[i].properties.index);\n    }\n    // Slice citations and sort by their declared index positions, if any,\n    // then reassign index and noteIndex numbers.\n    var oldCitations = citations.slice();\n    oldCitations.sort(\n        function (a,b) {\n            if (a.properties.index < b.properties.index) {\n                return -1;\n            } else if (a.properties.index > b.properties.index) {\n                return 1;\n            } else {\n                return 0;\n            }\n        }\n    );\n    for (i = 0, ilen = oldCitations.length; i < ilen; i += 1) {\n        oldCitations[i].properties.index = i;\n    }\n    for (i = 0, ilen = oldCitations.length; i < ilen; i += 1) {\n        sortedItems = [];\n        for (j = 0, jlen = oldCitations[i].citationItems.length; j < jlen; j += 1) {\n            item = oldCitations[i].citationItems[j];\n            if (\"undefined\" === typeof item.sortkeys) {\n                item.sortkeys = [];\n            }\n            Item = this.retrieveItem(\"\" + item.id);\n            newitem = [Item, item];\n            sortedItems.push(newitem);\n            oldCitations[i].citationItems[j].item = Item;\n            itemList.push(\"\" + item.id);\n        }\n        if (!oldCitations[i].properties.unsorted) {\n            sortedItems.sort(this.citation.srt.compareCompositeKeys);\n        }\n        oldCitations[i].sortedItems = sortedItems;\n        // Save citation data in registry\n        this.registry.citationreg.citationById[oldCitations[i].citationID] = oldCitations[i];\n    }\n    // Register Items\n    this.updateItems(itemList);\n\n    // Construct citationList from original copy\n    for (i = 0, ilen = citations.length; i < ilen; i += 1) {\n        citationList.push([\"\" + citations[i].citationID, citations[i].properties.noteIndex]);\n    }\n\n    var ret = [];\n    if (citations && citations.length) {\n        // Rendering one citation restores remainder of processor state.\n        // If citations is empty, rest to empty state.\n        ret = this.processCitationCluster(citations[0], [], citationList.slice(1));\n    } else {\n        this.registry = new CSL.Registry(this);\n        this.tmp = new CSL.Engine.Tmp();\n        this.disambiguate = new CSL.Disambiguation(this);\n    }\n    return ret;\n};\n\n\nCSL.Engine.prototype.updateItems = function (idList, nosort, rerun_ambigs, implicitUpdate) {\n    var debug = false;\n    var oldArea = this.tmp.area;\n    var oldRoot = this.tmp.root;\n    var oldExtension = this.tmp.extension;\n    if (this.bibliography_sort.tokens.length === 0) {\n        nosort = true;\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    this.tmp.extension = \"\";\n    if (!implicitUpdate) {\n        this.tmp.loadedItemIDs = {};\n    }\n    //CSL.debug = print\n    //SNIP-START\n    if (debug) {\n        CSL.debug(\"--> init <--\");\n    }\n    //SNIP-END\n    this.registry.init(idList);\n\n\tif (rerun_ambigs) {\n\t\tfor (var ambig in this.registry.ambigcites) {\n\t\t\tthis.registry.ambigsTouched[ambig] = true;\n\t\t}\n\t}\n\n    this.registry.dodeletes(this.registry.myhash);\n    \n    this.registry.doinserts(this.registry.mylist);\n    \n    this.registry.dorefreshes();\n\n    // *** affects reflist\n    this.registry.rebuildlist(nosort);\n    \n    this.registry.setsortkeys();\n\n    // taints always\n    this.registry.setdisambigs();\n\n    // *** affects reflist\n    this.registry.sorttokens(nosort);\n\n    // *** affects reflist\n    // taints if numbered style\n    this.registry.renumber();\n    \n    // taints always\n    //this.registry.yearsuffix();\n\n    this.tmp.extension = oldExtension;\n    this.tmp.area = oldArea;\n    this.tmp.root = oldRoot;\n\n    return this.registry.getSortedIds();\n};\n\nCSL.Engine.prototype.updateUncitedItems = function (idList, nosort) {\n    var idHash;\n    var oldArea = this.tmp.area;\n    var oldRoot = this.tmp.root;\n    var oldExtension = this.tmp.extension;\n    if (this.bibliography_sort.tokens.length === 0) {\n        nosort = true;\n    }\n    this.tmp.area = \"citation\";\n    this.tmp.root = \"citation\";\n    this.tmp.extension = \"\";\n    this.tmp.loadedItemIDs = {};\n    // This should be a utility function\n    if (!idList) {\n        idList = [];\n    }\n    if (\"object\" == typeof idList) {\n        if (\"undefined\" == typeof idList.length) {\n            idHash = idList;\n            idList = [];\n            for (var key in idHash) {\n                idList.push(key);\n            }\n        } else if (\"number\" == typeof idList.length) {\n            idHash = {};\n            for (var i=0,ilen=idList.length;i<ilen;i+=1) {\n                idHash[idList[i]] = true;\n            }\n        }\n    }\n\n    // prepare extended list of items\n    this.registry.init(idList, true);\n\n    // Use purge instead of delete.\n    // this.registry.dodeletes(this.registry.myhash);\n    this.registry.dopurge(idHash);\n\n    // everything else is the same as updateItems()\n    this.registry.doinserts(this.registry.mylist);\n\n    this.registry.dorefreshes();\n\n    this.registry.rebuildlist(nosort);\n\n    this.registry.setsortkeys();\n\n    this.registry.setdisambigs();\n\n    this.registry.sorttokens(nosort);\n\n    this.registry.renumber();\n\n    this.tmp.extension = oldExtension;\n    this.tmp.area = oldArea;\n    this.tmp.root = oldRoot;\n\n    return this.registry.getSortedIds();\n};\n\n/*global CSL: true */\n\nCSL.localeResolve = function (langstr, defaultLocale) {\n    var ret, langlst;\n    if (!defaultLocale) {\n        defaultLocale = \"en-US\";\n    }\n    if (!langstr) {\n        langstr = defaultLocale;\n    }\n    ret = {};\n    //if (\"undefined\" === typeof langstr) {\n    //    langstr = \"en_US\";\n    //}\n    langlst = langstr.split(/[\\-_]/);\n    ret.base = CSL.LANG_BASES[langlst[0]];\n    if (\"undefined\" === typeof ret.base) {\n        //CSL.debug(\"Warning: unknown locale \"+langstr+\", setting fallback to \"+defaultLocale);\n        return {base:defaultLocale, best:langstr, bare:langlst[0]};\n    }\n    if (langlst.length === 1) {\n        ret.generic = true;\n    }\n    if (langlst.length === 1 || langlst[1] === \"x\") {\n        ret.best = ret.base.replace(\"_\", \"-\");\n    } else {\n        ret.best = langlst.slice(0, 2).join(\"-\");\n    }\n    ret.base = ret.base.replace(\"_\", \"-\");\n    ret.bare = langlst[0];\n    return ret;\n};\n\n// Use call to invoke this.\nCSL.Engine.prototype.localeConfigure = function (langspec, beShy) {\n    var localexml;\n    if (beShy && this.locale[langspec.best]) {\n        return;\n    }\n    if (langspec.best === \"en-US\") {\n        localexml = CSL.setupXml(this.sys.retrieveLocale(\"en-US\"));\n        this.localeSet(localexml, \"en-US\", langspec.best);\n    } else if (langspec.best !== \"en-US\") {\n        if (langspec.base !== langspec.best) {\n            localexml = CSL.setupXml(this.sys.retrieveLocale(langspec.base));\n            this.localeSet(localexml, langspec.base, langspec.best);\n        }\n        localexml = CSL.setupXml(this.sys.retrieveLocale(langspec.best));\n        this.localeSet(localexml, langspec.best, langspec.best);        \n    }\n    this.localeSet(this.cslXml, \"\", langspec.best);\n    this.localeSet(this.cslXml, langspec.bare, langspec.best);\n    if (langspec.base !== langspec.best) {\n        this.localeSet(this.cslXml, langspec.base, langspec.best);\n    }\n    this.localeSet(this.cslXml, langspec.best, langspec.best);\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"page-range-delimiter\"]) {\n        if ([\"fr\", \"pt\"].indexOf(langspec.best.slice(0, 2).toLowerCase()) > -1) {\n            this.locale[langspec.best].terms[\"page-range-delimiter\"] = \"-\";\n        } else {\n            this.locale[langspec.best].terms[\"page-range-delimiter\"] = \"\\u2013\";\n        }\n    }\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"year-range-delimiter\"]) {\n        this.locale[langspec.best].terms[\"year-range-delimiter\"] = \"\\u2013\";\n    }\n    if (\"undefined\" === typeof this.locale[langspec.best].terms[\"citation-range-delimiter\"]) {\n        this.locale[langspec.best].terms[\"citation-range-delimiter\"] = \"\\u2013\";\n    }\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        var localeLists = [\"default-locale\",\"locale-sort\",\"locale-translit\",\"locale-translat\"];\n        for (var i=0,ilen=localeLists.length;i<ilen;i+=1) {\n            for (var j=0,jlen=this.opt[localeLists[i]].length;j<jlen;j+=1) {\n                this.opt[localeLists[i]][j] = this.opt[localeLists[i]][j].toLowerCase();\n            }\n        }\n        this.opt.lang = this.opt.lang.toLowerCase();\n    }\n};\n    \n//\n// XXXXX: Got it.  The locales objects need to be reorganized,\n// with a top-level local specifier, and terms, opts, dates\n// below.\n//\nCSL.Engine.prototype.localeSet = function (myxml, lang_in, lang_out) {\n    var blob, locale, nodes, attributes, pos, term, form, termname, styleopts, date, attrname, len, genderform, target, i, ilen;\n    lang_in = lang_in.replace(\"_\", \"-\");\n    lang_out = lang_out.replace(\"_\", \"-\");\n\n    if (this.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n        lang_in = lang_in.toLowerCase();\n        lang_out = lang_out.toLowerCase();\n    }\n\n    if (!this.locale[lang_out]) {\n        this.locale[lang_out] = {};\n        this.locale[lang_out].terms = {};\n        this.locale[lang_out].opts = {};\n        // Set default skip words. Can be overridden in locale by attribute on style-options node.\n        this.locale[lang_out].opts[\"skip-words\"] = CSL.SKIP_WORDS;\n        // Initialise leading noise word to false. Actual assignment is below. Empty by default, can be overridden in locale by attribute on style-options node.\n        if (!this.locale[lang_out].opts[\"leading-noise-words\"]) {\n            this.locale[lang_out].opts[\"leading-noise-words\"] = [];\n        }\n        this.locale[lang_out].dates = {};\n        // For ordinals\n        this.locale[lang_out].ord = {'1.0.1':false,keys:{}};\n        this.locale[lang_out][\"noun-genders\"] = {};\n    }\n\n    //\n    // Xml: Test if node is \"locale\" (nb: ns declarations need to be invoked\n    // on every access to the xml object; bundle this with the functions\n    //\n    locale = myxml.makeXml();\n    if (myxml.nodeNameIs(myxml.dataObj, 'locale')) {\n        locale = myxml.dataObj;\n    } else {\n        //\n        // Xml: get a list of all \"locale\" nodes\n        //\n        nodes = myxml.getNodesByName(myxml.dataObj, \"locale\");\n        var foundLocale = false;\n        for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n            blob = nodes[pos];\n            //\n            // Xml: get locale xml:lang\n            //\n            // Iterate over all locales, but for non-matching nodes,\n            // we set jurisdiction_preference only (processing of the\n            // chosen one will process the attribute there,\n            // separately.\n            if (!foundLocale && myxml.getAttributeValue(blob, 'lang', 'xml') === lang_in) {\n                locale = blob;\n                foundLocale = true;\n            } else {\n                var lang = myxml.getAttributeValue(blob, 'lang', 'xml');\n                var style_options = myxml.getNodesByName(blob, 'style-options');\n                if (lang && style_options && style_options.length) {\n                    var jurispref = myxml.getAttributeValue(style_options[0], 'jurisdiction-preference');\n                    if (jurispref) {\n                        if (!this.locale[lang]) {\n                            this.locale[lang] = {\n                                opts: {}\n                            };\n                        }\n                        this.locale[lang].opts[\"jurisdiction-preference\"] = jurispref.split(/\\s+/);\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get a list of any cs:type nodes within locale\n    //\n    nodes = myxml.getNodesByName(locale, 'type');\n    for (i = 0, ilen = myxml.numberofnodes(nodes); i < ilen; i += 1) {\n        var typenode = nodes[i];\n        var type = myxml.getAttributeValue(typenode, 'name');\n        var gender = myxml.getAttributeValue(typenode, 'gender');\n        this.opt.gender[type] = gender;\n    }\n    //\n    // Xml: get a list of term nodes within locale\n    //\n\n    // If we are setting CSL 1.0.1 ordinals inside a style, wipe the\n    // slate clean and start over.\n    var hasCslOrdinals101 = myxml.getNodesByName(locale, 'term', 'ordinal').length;\n    if (hasCslOrdinals101) {\n        for (var key in this.locale[lang_out].ord.keys) {\n            delete this.locale[lang_out].terms[key];\n        }\n        this.locale[lang_out].ord = {\"1.0.1\":false,keys:{}};\n    }\n\n    nodes = myxml.getNodesByName(locale, 'term');\n    // Collect ordinals info as for 1.0.1, but save only if 1.0.1 toggle triggers\n    var ordinals101 = {\"last-digit\":{},\"last-two-digits\":{},\"whole-number\":{}};\n    var ordinals101_toggle = false;\n    var genderized_terms = {};\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        term = nodes[pos];\n        //\n        // Xml: get string value of attribute\n        //\n        termname = myxml.getAttributeValue(term, 'name');\n        if (termname === \"sub verbo\") {\n            termname = \"sub-verbo\";\n        }\n        if (termname.slice(0,7) === \"ordinal\") {\n            if (termname === \"ordinal\") {\n                ordinals101_toggle = true;\n            } else {\n                var match = myxml.getAttributeValue(term, 'match');\n                var termstub = termname.slice(8);\n                var genderform = myxml.getAttributeValue(term, 'gender-form');\n                if (!genderform) {\n                    genderform = \"neuter\";\n                }\n                if (!match) {\n                    match = \"last-two-digits\";\n                    if (termstub.slice(0,1) === \"0\") {\n                        match = \"last-digit\";\n                    }\n                }\n                if (termstub.slice(0,1) === \"0\") {\n                    termstub = termstub.slice(1);\n                }\n                if (!ordinals101[match][termstub]) {\n                    ordinals101[match][termstub] = {};\n                }\n                ordinals101[match][termstub][genderform] = termname;\n            }\n            this.locale[lang_out].ord.keys[termname] = true;\n        }\n        if (\"undefined\" === typeof this.locale[lang_out].terms[termname]) {\n            this.locale[lang_out].terms[termname] = {};\n        }\n        form = \"long\";\n        genderform = false;\n        //\n        // Xml: get string value of form attribute, if any\n        //\n        if (myxml.getAttributeValue(term, 'form')) {\n            form = myxml.getAttributeValue(term, 'form');\n        }\n        //\n        // Xml: get string value of gender attribute, if any\n        // \n        if (myxml.getAttributeValue(term, 'gender-form')) {\n            genderform = myxml.getAttributeValue(term, 'gender-form');\n        }\n        //\n        // Xml: set global gender assignment for variable associated\n        // with term name\n        // \n        if (myxml.getAttributeValue(term, 'gender')) {\n            this.locale[lang_out][\"noun-genders\"][termname] = myxml.getAttributeValue(term, 'gender');\n        }\n        // Work on main segment or gender-specific sub-segment as appropriate\n        if (genderform) {\n            this.locale[lang_out].terms[termname][genderform] = {};\n            this.locale[lang_out].terms[termname][genderform][form] = [];\n            target = this.locale[lang_out].terms[termname][genderform];\n            genderized_terms[termname] = true;\n        } else {\n            this.locale[lang_out].terms[termname][form] = [];\n            target = this.locale[lang_out].terms[termname];\n        }\n        //\n        // Xml: test of existence of node\n        //\n        if (myxml.numberofnodes(myxml.getNodesByName(term, 'multiple'))) {\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form][0] = myxml.getNodeValue(term, 'single');\n            if (target[form][0].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form][1] = myxml.getNodeValue(term, 'multiple');\n            if (target[form][1].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n        } else {\n            //\n            // Xml: get string value of attribute, plus\n            // Xml: get string value of node content\n            //\n            target[form] = myxml.getNodeValue(term);\n            if (target[form].indexOf(\"%s\") > -1) {\n                this.opt.hasPlaceholderTerm = true;\n            }\n        }\n    }\n    if (!this.locale[lang_out].terms.supplement) {\n        this.locale[lang_out].terms.supplement = {};\n    }\n    if (!this.locale[lang_out].terms.supplement[\"long\"]) {\n        this.locale[lang_out].terms.supplement[\"long\"] = [\"supplement\", \"supplements\"];\n    }\n    // If locale had a CSL 1.0.1-style ordinal definition, install the logic object\n    // and iterate over gendered terms, filling in default values for use by getTerm.\n    if (ordinals101_toggle) {\n        for (var ikey in genderized_terms) {\n            var gender_segments = {};\n            var form_segments = 0;\n            for (var jkey in this.locale[lang_out].terms[ikey]) {\n                if ([\"masculine\",\"feminine\"].indexOf(jkey) > -1) {\n                    gender_segments[jkey] = this.locale[lang_out].terms[ikey][jkey];\n                } else {\n                    form_segments += 1;\n                }\n            }\n            if (!form_segments) {\n                if (gender_segments.feminine) {\n                    // Link each feminine form segment to default\n                    // (no need to filter, these will not have gender segments mixed in)\n                    for (var jkey in gender_segments.feminine) {\n                        this.locale[lang_out].terms[ikey][jkey] = gender_segments.feminine[jkey];\n                    }\n                } else if (gender_segments.masculine) {\n                    // Otherwise link each masculine form segment to default \n                    for (var jkey in gender_segments.masculine) {\n                        this.locale[lang_out].terms[ikey][jkey] = gender_segments.masculine[jkey];\n                    }\n                }\n            }\n        }\n        this.locale[lang_out].ord['1.0.1'] = ordinals101;\n    }\n\n    // Iterate over main segments, and fill in any holes in gender-specific data\n    // sub-segments\n    for (termname in this.locale[lang_out].terms) {\n        for (i = 0, ilen = 2; i < ilen; i += 1) {\n            genderform = CSL.GENDERS[i];\n            if (this.locale[lang_out].terms[termname][genderform]) {\n                for (form in this.locale[lang_out].terms[termname]) {\n                    if (!this.locale[lang_out].terms[termname][genderform][form]) {\n                        this.locale[lang_out].terms[termname][genderform][form] = this.locale[lang_out].terms[termname][form];\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get list of nodes by node type\n    //\n    nodes = myxml.getNodesByName(locale, 'style-options');\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        if (true) {\n            styleopts = nodes[pos];\n            //\n            // Xml: get list of attributes on a node\n            //\n            attributes = myxml.attributes(styleopts);\n            for (attrname in attributes) {\n                if (attributes.hasOwnProperty(attrname)) {\n                    if (attrname === \"@punctuation-in-quote\" || attrname === \"@limit-day-ordinals-to-day-1\") {\n                        if (attributes[attrname] === \"true\") {\n                            // trim off leading @\n                            this.locale[lang_out].opts[attrname.slice(1)] = true;\n                        } else {\n                            // trim off leading @\n                            this.locale[lang_out].opts[attrname.slice(1)] = false;\n                        }\n                    } else if (attrname === \"@jurisdiction-preference\") {\n                        var jurisdiction_preference = attributes[attrname].split(/\\s+/);\n                        this.locale[lang_out].opts[attrname.slice(1)] = jurisdiction_preference;\n                    } else if (attrname === \"@skip-words\") {\n                        var skip_words = attributes[attrname].split(/\\s*,\\s*/);\n                        this.locale[lang_out].opts[attrname.slice(1)] = skip_words;\n                    } else if (attrname === \"@leading-noise-words\") {\n                        var val = attributes[attrname].split(/\\s*,\\s*/);\n                        this.locale[lang_out].opts[\"leading-noise-words\"] = val;\n                    } else if (attrname === \"@name-as-sort-order\") {\n                        // Fallback is okay here.\n                        this.locale[lang_out].opts[\"name-as-sort-order\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-as-sort-order\"][lst[i]] = true;\n                        }\n                    } else if (attrname === \"@name-as-reverse-order\") {\n                        // Fallback is okay here.\n                        this.locale[lang_out].opts[\"name-as-reverse-order\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-as-reverse-order\"][lst[i]] = true;\n                        }\n                    } else if (attrname === \"@name-never-short\") {\n                        // Here too.\n                        this.locale[lang_out].opts[\"name-never-short\"] = {};\n                        var lst = attributes[attrname].split(/\\s+/);\n                        for (var i=0,ilen=lst.length;i<ilen;i+=1) {\n                            this.locale[lang_out].opts[\"name-never-short\"][lst[i]] = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    //\n    // Xml: get list of nodes by type\n    //\n    nodes = myxml.getNodesByName(locale, 'date');\n    for (pos = 0, len = myxml.numberofnodes(nodes); pos < len; pos += 1) {\n        if (true) {\n            var date = nodes[pos];\n            //\n            // Xml: get string value of attribute\n            //\n            this.locale[lang_out].dates[myxml.getAttributeValue(date, \"form\")] = date;\n        }\n    }\n    //\n    // Xml: get list of nodes by node type\n    //\n    CSL.SET_COURT_CLASSES(this, lang_out, myxml, locale);\n};\n\n\nCSL.getLocaleNames = function (myxml, preferredLocale) {\n    var stylexml = CSL.setupXml(myxml);\n\n    function extendLocaleList(localeList, locale) {\n        var forms = [\"base\", \"best\"];\n        if (locale) {\n            var normalizedLocale = CSL.localeResolve(locale);\n            for (var i=0,ilen=forms.length;i<ilen;i++) {\n                if (normalizedLocale[forms[i]] && localeList.indexOf(normalizedLocale[forms[i]]) === -1) {\n                    localeList.push(normalizedLocale[forms[i]]);\n                }\n            }\n        }\n    }\n    \n    var localeIDs = [\"en-US\"];\n    \n    function sniffLocaleOnOneNodeName(nodeName) {\n        var nodes = stylexml.getNodesByName(stylexml.dataObj, nodeName);\n        for (var i=0,ilen=nodes.length;i<ilen;i++) {\n            var nodeLocales = stylexml.getAttributeValue(nodes[i], \"locale\");\n            if (nodeLocales) {\n                nodeLocales = nodeLocales.split(/ +/);\n                for (var j=0,jlen=nodeLocales.length;j<jlen;j++) {\n                    this.extendLocaleList(localeIDs, nodeLocales[j]);\n                }\n            }\n        }\n    }\n\n    extendLocaleList(localeIDs, preferredLocale);\n\n    var styleNode = stylexml.getNodesByName(stylexml.dataObj, \"style\")[0];\n    var defaultLocale = stylexml.getAttributeValue(styleNode, \"default-locale\");\n    extendLocaleList(localeIDs, defaultLocale);\n\n    var nodeNames = [\"layout\", \"if\", \"else-if\", \"condition\"];\n    for (var i=0,ilen=nodeNames.length;i<ilen;i++) {\n        sniffLocaleOnOneNodeName(stylexml, localeIDs, nodeNames[i]);\n    }\n    return localeIDs;\n};\n\n/*global CSL: true */\n\nCSL.Node = {};\n\nCSL.Node.bibliography = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"bibliography\";\n            state.build.root = \"bibliography\";\n            state.build.extension = \"\";\n\n            var func = function(state) {\n                state.tmp.area = \"bibliography\";\n                state.tmp.root = \"bibliography\";\n                state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node.choose = {\n    build: function (state, target) {\n        var func;\n        if (this.tokentype === CSL.START) {\n            //open condition\n            func = function (state) {\n                state.tmp.jump.push(undefined, CSL.LITERAL);\n            };\n        }\n        if (this.tokentype === CSL.END) {\n            //close condition\n            func = function (state) {\n                state.tmp.jump.pop();\n            };\n        }\n        this.execs.push(func);\n        target.push(this);\n    },\n\n    configure: function (state, pos) {\n        if (this.tokentype === CSL.END) {\n            state.configure.fail.push((pos));\n            state.configure.succeed.push((pos));\n        } else {\n            state.configure.fail.pop();\n            state.configure.succeed.pop();\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.citation = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"citation\";\n            state.build.root = \"citation\";\n            state.build.extension = \"\";\n\n\n            var func = function(state) {\n                state.tmp.area = \"citation\";\n                state.tmp.root = \"citation\";\n                state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n\n/*\n            state.build.root = \"citation\";\n\n            OK state.fixOpt(this, \"names-delimiter\", \"delimiter\");\n            OK state.fixOpt(this, \"name-delimiter\", \"delimiter\");\n            OK state.fixOpt(this, \"name-form\", \"form\");\n            OK state.fixOpt(this, \"and\", \"and\");\n            OK state.fixOpt(this, \"delimiter-precedes-last\", \"delimiter-precedes-last\");\n            OK state.fixOpt(this, \"delimiter-precedes-et-al\", \"delimiter-precedes-et-al\");\n            OK state.fixOpt(this, \"initialize-with\", \"initialize-with\");\n            OK state.fixOpt(this, \"initialize\", \"initialize\");\n            OK state.fixOpt(this, \"name-as-sort-order\", \"name-as-sort-order\");\n            OK state.fixOpt(this, \"sort-separator\", \"sort-separator\");\n\n            OK state.fixOpt(this, \"et-al-min\", \"et-al-min\");\n            OK state.fixOpt(this, \"et-al-use-first\", \"et-al-use-first\");\n            OK state.fixOpt(this, \"et-al-use-last\", \"et-al-use-last\");\n            state.fixOpt(this, \"et-al-subsequent-min\", \"et-al-subsequent-min\");\n            state.fixOpt(this, \"et-al-subsequent-use-first\", \"et-al-subsequent-use-first\");\n*/\n        }\n        if (this.tokentype === CSL.END) {\n\n            // Open an extra key at first position for use in\n            // grouped sorts.\n            // print(\"in cs:citation END\");\n            state.opt.grouped_sort = state.opt.xclass === \"in-text\" \n                && (state.citation.opt.collapse \n                    && state.citation.opt.collapse.length)\n                || (state.citation.opt.cite_group_delimiter\n                    && state.citation.opt.cite_group_delimiter.length)\n                && state.opt.update_mode !== CSL.POSITION\n                && state.opt.update_mode !== CSL.NUMERIC;\n            \n            if (state.opt.grouped_sort \n                && state.citation_sort.opt.sort_directions.length) {\n                \n                var firstkey = state.citation_sort.opt.sort_directions[0].slice();\n                //print(\"extending sort keys \"+state.citation_sort.opt.sort_directions+\" with \"+firstkey);\n                state.citation_sort.opt.sort_directions = [firstkey].concat(state.citation_sort.opt.sort_directions);\n                // print(\"new key directions in effect: \"+state.citation_sort.opt.sort_directions);\n            }\n            // print(\"creating new comparifier\");\n            state.citation.srt = new CSL.Registry.Comparifier(state, \"citation_sort\");\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node[\"#comment\"] = {\n       // This is a comment in the CSL file.\n       build: function () {\n        // Save some space in the log files -- no need to mention this, really.\n        // CSL.debug(\"CSL processor warning: comment node reached\");\n       }\n};\n\n/*global CSL: true */\n\nCSL.Node.date = {\n    build: function (state, target) {\n        var func, date_obj, len, pos, part, dpx, parts, mypos, start, end;\n        if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n            // used to collect rendered date part names in node_datepart,\n            // for passing through to node_key, for use in dates embedded\n            // in macros\n            state.dateput.string(state, state.dateput.queue);\n            state.tmp.date_token = CSL.Util.cloneToken(this);\n            state.tmp.date_token.strings.prefix = \"\";\n            state.tmp.date_token.strings.suffix = \"\";\n            state.dateput.openLevel(this);\n            state.build.date_parts = [];\n            state.build.date_variables = this.variables;\n            if (!state.build.extension) {\n                CSL.Util.substituteStart.call(this, state, target);\n            }\n            if (state.build.extension) {\n                func = CSL.dateMacroAsSortKey;\n            } else {\n                func = function (state, Item, item) {\n                    var dp;\n                    state.tmp.element_rendered_ok = false;\n                    state.tmp.donesies = [];\n                    state.tmp.dateparts = [];\n                    dp = [];\n                    //if (this.variables.length && Item[this.variables[0]]){\n                    if (this.variables.length\n                        && !(state.tmp.just_looking\n                             && this.variables[0] === \"accessed\")) {\n                        \n                        date_obj = Item[this.variables[0]];\n                        if (\"undefined\" === typeof date_obj) {\n                            date_obj = {\"date-parts\": [[0]] };\n                            if (state.opt.development_extensions.locator_date_and_revision) {\n                                if (item && this.variables[0] === \"locator-date\" && item[\"locator-date\"]) {\n                                    date_obj = item[\"locator-date\"];\n                                }\n                            }\n                        }\n                        state.tmp.date_object = date_obj;\n                        //\n                        // Call a function here to analyze the\n                        // data and set the name of the date-part that\n                        // should collapse for this range, if any.\n                        //\n                        // (1) build a filtered list, in y-m-d order,\n                        // consisting only of items that are (a) in the\n                        // date-parts and (b) in the *_end data.\n                        // (note to self: remember that season is a\n                        // fallback var when month and day are empty)\n                        \n                        //if (\"undefined\" === typeof this.dateparts) {\n                        //    this.dateparts = [\"year\", \"month\", \"day\"];\n                        //}\n                        len = this.dateparts.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            part = this.dateparts[pos];\n                            if (\"undefined\" !== typeof state.tmp.date_object[(part +  \"_end\")]) {\n                                dp.push(part);\n                            } else if (part === \"month\" && \"undefined\" !== typeof state.tmp.date_object.season_end) {\n                                dp.push(part);\n                            }\n                        }\n                        dpx = [];\n                        parts = [\"year\", \"month\", \"day\"];\n                        len = parts.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            if (dp.indexOf(parts[pos]) > -1) {\n                                dpx.push(parts[pos]);\n                            }\n                        }\n                        dp = dpx.slice();\n                        //\n                        // (2) Reverse the list and step through in\n                        // reverse order, popping each item if the\n                        // primary and *_end data match.\n                        mypos = 2;\n                        len = dp.length;\n                        for (pos = 0; pos < len; pos += 1) {\n                            part = dp[pos];\n                            start = state.tmp.date_object[part];\n                            end = state.tmp.date_object[(part + \"_end\")];\n                            if (start !== end) {\n                                mypos = pos;\n                                break;\n                            }\n                        }\n                        \n                        //\n                        // (3) When finished, the first item in the\n                        // list, if any, is the date-part where\n                        // the collapse should occur.\n\n                        // XXXXX: was that it?\n                        state.tmp.date_collapse_at = dp.slice(mypos);\n                        //\n                        // The collapse itself will be done by appending\n                        // string output for the date, less suffix,\n                        // placing a delimiter on output, then then\n                        // doing the *_end of the range, dropping only\n                        // the prefix.  That should give us concise expressions\n                        // of ranges.\n                        //\n                        // Numeric dates should not collapse, though,\n                        // and should probably use a slash delimiter.\n                        // Scope for configurability will remain (all over\n                        // the place), but this will do to get this feature\n                        // started.\n                        //\n                    } else {\n                        state.tmp.date_object = false;\n                    }\n                };\n            }\n            this.execs.push(func);\n\n            // newoutput\n            func = function (state, Item) {\n                if (!Item[this.variables[0]]) {\n                    return;\n                }\n                state.output.startTag(\"date\", this);\n                if (this.variables[0] === \"issued\"\n                    && (Item.type === \"legal_case\" || Item.type === \"legislation\")\n                    && state.opt.disable_duplicate_year_suppression.indexOf(Item.country) === -1\n                    && !state.tmp.extension\n                    && \"\" + Item[\"collection-number\"] === \"\" + state.tmp.date_object.year\n                    && this.dateparts.length === 1\n                    && this.dateparts[0] === \"year\") {\n\n                    // Set up to (maybe) suppress the year if we're not sorting, and\n                    // it's the same as the collection-number, and we would render\n                    // only the year, with not month or day, and this is a legal_case item.\n                    // We save a pointer to the blob parent and its position here. The\n                    // blob will be popped from output if at the end of processing for\n                    // this cite we find that we have rendered the collection-number\n                    // variable also.\n                    for (var key in state.tmp.date_object) {\n                        if (state.tmp.date_object.hasOwnProperty(key)) {\n                            if (key.slice(0, 4) === \"year\") {\n                                state.tmp.issued_date = {};\n                                var lst = state.output.current.mystack.slice(-2)[0].blobs;\n                                state.tmp.issued_date.list = lst;\n                                state.tmp.issued_date.pos = lst.length - 1;\n                            }\n                        }\n                    }\n                }\n            };\n            this.execs.push(func);\n        }\n\n        if (!state.build.extension && (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON)) {\n            // mergeoutput\n            func = function (state, Item) {\n                if (!Item[this.variables[0]]) {\n                    return;\n                }\n                state.output.endTag();\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n\n        if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n            if (!state.build.extension) {\n                CSL.Util.substituteEnd.call(this, state, target);\n            }\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"date-part\"] = {\n    build: function (state, target) {\n        var func, pos, len, first_date, value, value_end, real, have_collapsed, invoked, precondition, known_year, bc, ad, bc_end, ad_end, ready, curr, dcurr, number, num, formatter, item;\n        if (!this.strings.form) {\n            this.strings.form = \"long\";\n        }\n        // used in node_date, to send a list of rendering date parts\n        // to node_key, for dates embedded in macros.\n        state.build.date_parts.push(this.strings.name);\n        //\n        // Set delimiter here, if poss.\n        //\n\n        var date_variable = state.build.date_variables[0];\n\n        function formatAndStrip(myform, gender, val) {\n            if (!val) {\n                return val;\n            }\n            val = \"\" + CSL.Util.Dates[this.strings.name][myform](state, val, gender, this.default_locale);\n            if (\"month\" === this.strings.name) {\n                if (state.tmp.strip_periods) {\n                    val = val.replace(/\\./g, \"\");\n                } else {\n                    for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n                        if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                            val = val.replace(/\\./g, \"\");\n                            break;\n                        }\n                    }\n                }\n            }\n            return val;\n        }\n\n        func = function (state, Item) {\n\n            if (!state.tmp.date_object) {\n                return;\n            } else {\n                state.tmp.probably_rendered_something = true;\n            }\n\n            var last_string_output = \"\";\n\n            first_date = true;\n            value = \"\";\n            value_end = \"\";\n            state.tmp.donesies.push(this.strings.name);\n\n            // Render literal only when year is included in date output\n            if (state.tmp.date_object.literal && \"year\" === this.strings.name) {\n                last_string_output = state.tmp.date_object.literal;\n                state.output.append(state.tmp.date_object.literal, this);\n            }\n\n            if (state.tmp.date_object) {\n                value = state.tmp.date_object[this.strings.name];\n                value_end = state.tmp.date_object[(this.strings.name + \"_end\")];\n            }\n            if (\"year\" === this.strings.name && value === 0 && !state.tmp.suppress_decorations) {\n                value = false;\n            }\n            real = !state.tmp.suppress_decorations;\n            have_collapsed = state.tmp.have_collapsed;\n            invoked = state[state.tmp.area].opt.collapse === \"year-suffix\" || state[state.tmp.area].opt.collapse === \"year-suffix-ranged\";\n            precondition = state.opt[\"disambiguate-add-year-suffix\"];\n            if (real && precondition && invoked) {\n                state.tmp.years_used.push(value);\n                known_year = state.tmp.last_years_used.length >= state.tmp.years_used.length;\n                if (known_year && have_collapsed) {\n                    if (state.tmp.last_years_used[(state.tmp.years_used.length - 1)] === value) {\n                        value = false;\n                    }\n                }\n            }\n            if (\"undefined\" !== typeof value) {\n                bc = false;\n                ad = false;\n                bc_end = false;\n                ad_end = false;\n                if (\"year\" === this.strings.name) {\n                    if (parseInt(value, 10) < 500 && parseInt(value, 10) > 0) {\n                        ad = state.getTerm(\"ad\");\n                    }\n                    if (parseInt(value, 10) < 0) {\n                        bc = state.getTerm(\"bc\");\n                        value = (parseInt(value, 10) * -1);\n                    }\n                    if (value_end) {\n                        if (parseInt(value_end, 10) < 500 && parseInt(value_end, 10) > 0) {\n                            ad_end = state.getTerm(\"ad\");\n                        }\n                        if (parseInt(value_end, 10) < 0) {\n                            bc_end = state.getTerm(\"bc\");\n                            value_end = (parseInt(value_end, 10) * -1);\n                        }\n                    }\n                }\n\n                // For gendered locales\n                var monthnameid = \"\"+state.tmp.date_object.month;\n                while (monthnameid.length < 2) {\n                    monthnameid = \"0\"+monthnameid;\n                }\n                monthnameid = \"month-\"+monthnameid;\n                var gender = state.locale[state.opt.lang][\"noun-genders\"][monthnameid];\n                if (this.strings.form) {\n                    var myform = this.strings.form;\n                    var myform_end = this.strings.form;\n                    if (this.strings.name === \"day\") {\n                        if (myform === \"ordinal\" && state.locale[state.opt.lang].opts[\"limit-day-ordinals-to-day-1\"]) {\n                            if (value != 1) {\n                                myform = \"numeric\";\n                            }\n                            if (value_end != 1) {\n                                myform_end = \"numeric\";\n                            }\n                        }\n                    }\n                    value = formatAndStrip.call(this, myform, gender, value);\n                    value_end = formatAndStrip.call(this, myform_end, gender, value_end);\n                }\n                state.output.openLevel(\"empty\");\n                if (state.tmp.date_collapse_at.length) {\n                    //state.output.startTag(this.strings.name,this);\n                    ready = true;\n                    len = state.tmp.date_collapse_at.length;\n                    for (pos = 0; pos < len; pos += 1) {\n                        item = state.tmp.date_collapse_at[pos];\n                        if (state.tmp.donesies.indexOf(item) === -1) {\n                            ready = false;\n                            break;\n                        }\n                    }\n                    if (ready) {\n                        if (\"\" + value_end !== \"0\") {\n                            if (state.dateput.queue.length === 0) {\n                                first_date = true;\n                            }\n\n                            // OK! So if the actual data has no month, day or season,\n                            // and we reach this block, then we can combine the dates\n                            // to a string, run minimial-two, and output the trailing\n                            // year right here. No impact on other functionality.\n                            \n                            if (state.opt[\"year-range-format\"]\n                                && state.opt[\"year-range-format\"] !== \"expanded\"\n                                && !state.tmp.date_object.day\n                                && !state.tmp.date_object.month\n                                && !state.tmp.date_object.season\n                                && this.strings.name === \"year\"\n                                && value && value_end) {\n                                \n                                // second argument adjusts collapse as required for years\n                                // See OSCOLA section 1.3.2\n                                value_end = state.fun.year_mangler(value + \"-\" + value_end, true);\n                                var range_delimiter = state.getTerm(\"year-range-delimiter\");\n                                value_end = value_end.slice(value_end.indexOf(range_delimiter) + 1);\n                            }\n                            last_string_output = value_end;\n                            state.dateput.append(value_end, this);\n                            if (first_date) {\n                                state.dateput.current.value().blobs[0].strings.prefix = \"\";\n                            }\n                        }\n                        last_string_output = value;\n                        state.output.append(value, this);\n                        curr = state.output.current.value();\n                        curr.blobs[(curr.blobs.length - 1)].strings.suffix = \"\";\n                        if (this.strings[\"range-delimiter\"]) {\n                            state.output.append(this.strings[\"range-delimiter\"]);\n                        } else {\n                            state.output.append(state.getTerm(\"year-range-delimiter\"), \"empty\");\n                        }\n                        state.dateput.closeLevel();\n                        dcurr = state.dateput.current.value();\n                        curr.blobs = curr.blobs.concat(dcurr);\n                        // This may leave the stack pointer on a lower level.\n                        // It's not a problem because the stack will be clobbered\n                        // when the queue is initialized by the next cs:date node.\n                        state.dateput.string(state, state.dateput.queue);\n                        state.dateput.openLevel(state.tmp.date_token);\n                        state.tmp.date_collapse_at = [];\n                    } else {\n                        last_string_output = value;\n                        state.output.append(value, this);\n                        // print(\"collapse_at: \"+state.tmp.date_collapse_at);\n                        if (state.tmp.date_collapse_at.indexOf(this.strings.name) > -1) {\n                            //\n                            // Use ghost dateput queue\n                            //\n                            if (\"\" + value_end !== \"0\") {\n                                //\n                                // XXXXX: It's a workaround.  It's ugly.\n                                // There's another one above.\n                                //\n                                if (state.dateput.queue.length === 0) {\n                                    first_date = true;\n                                }\n                                state.dateput.openLevel(\"empty\");\n                                last_string_output = value_end;\n                                state.dateput.append(value_end, this);\n                                if (first_date) {\n                                    state.dateput.current.value().blobs[0].strings.prefix = \"\";\n                                }\n                                if (bc) {\n                                    last_string_output = bc;\n                                    state.dateput.append(bc);\n                                }\n                                if (ad) {\n                                    last_string_output = ad;\n                                    state.dateput.append(ad);\n                                }\n                                state.dateput.closeLevel();\n                            }\n                        }\n                    }\n                } else {\n                    last_string_output = value;\n                    state.output.append(value, this);\n                }\n\n                if (bc) {\n                    last_string_output = bc;\n                    state.output.append(bc);\n                }\n                if (ad) {\n                    last_string_output = ad;\n                    state.output.append(ad);\n                }\n                state.output.closeLevel();\n                //state.output.endTag();\n            } else if (\"month\" === this.strings.name) {\n                // XXX The simpler solution here will be to\n                // directly install season and season_end on\n                // month, with a value of 13, 14, 15, 16, or\n                // (to allow correct ranging with Down Under\n                // dates) 17 or 18.  That will allow ranging\n                // to take place in the normal way.  With this\n                // \"approach\", it doesn't.\n                //\n                // No value for this target variable\n                //\n                if (state.tmp.date_object.season) {\n                    value = \"\" + state.tmp.date_object.season;\n                    if (value && value.match(/^[1-4]$/)) {\n                        // XXXXXXXXXXXXXXXXXXX was replace([false, false, true]);\n                        //state.tmp.group_context.replace([false, false, true]);\n                        state.tmp.group_context.tip.variable_success = true;\n                        last_string_output = \"winter\";\n                        state.output.append(state.getTerm((\"season-0\" + value)), this);\n                    } else if (value) {\n                        last_string_output = value;\n                        state.output.append(value, this);\n                    }\n                }\n            }\n            state.tmp.value = [];\n            if (Item[date_variable] && (value || state.tmp.have_collapsed) && !state.opt.has_year_suffix && \"year\" === this.strings.name && !state.tmp.just_looking) {\n                if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false && !state.tmp.has_done_year_suffix) {\n                    state.tmp.has_done_year_suffix = true;\n                    last_string_output = \"x\";\n                    num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n                    // first argument is for number particle [a-zA-Z], never present on dates\n                    number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n                    formatter = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n                    number.setFormatter(formatter);\n                    if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                        number.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    if (state[state.tmp.area].opt.cite_group_delimiter) {\n                        number.successor_prefix = state[state.tmp.area].opt.cite_group_delimiter;\n                    } else if (state[state.tmp.area].opt[\"year-suffix-delimiter\"]) {\n                        number.successor_prefix = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                    } else {\n                        number.successor_prefix = state[state.tmp.area].opt.layout_delimiter;\n                    }\n                    number.UGLY_DELIMITER_SUPPRESS_HACK = true;\n                    state.output.append(number, \"literal\");\n                }\n            }\n            if (last_string_output && !state.tmp.group_context.tip.condition) {\n                state.tmp.just_did_number = last_string_output.match(/[0-9]$/);\n                if (state.output.current.tip.strings.suffix) {\n                    state.tmp.just_did_number = false;\n                }\n            }\n        };\n        this.execs.push(func);\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node[\"else-if\"] = {\n    //\n    // these function are the same as those in if, might just clone\n    build: function (state, target) {\n        CSL.Conditions.TopNode.call(this, state, target);\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        CSL.Conditions.Configure.call(this, state, pos);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"else\"] = {\n    build: function (state, target) {\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        if (this.tokentype === CSL.START) {\n            state.configure.fail[(state.configure.fail.length - 1)] = pos;\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node[\"et-al\"] = {\n    build: function (state, target) {\n        if (state.build.area === \"citation\" || state.build.area === \"bibliography\") {\n            var func = function (state) {\n                state.tmp.etal_node = this;\n                if (\"string\" === typeof this.strings.term) {\n                    state.tmp.etal_term = this.strings.term;\n                }\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.group = {\n    build: function (state, target, realGroup) {\n        var func, execs;\n        this.realGroup = realGroup;\n        if (this.tokentype === CSL.START) {\n            CSL.Util.substituteStart.call(this, state, target);\n            if (state.build.substitute_level.value()) {\n                state.build.substitute_level.replace((state.build.substitute_level.value() + 1));\n            }\n            if (!this.juris) {\n                target.push(this);\n            }\n\n            // newoutput\n            func = function (state) {\n                state.output.startTag(\"group\", this);\n                \n                if (this.strings.label_form_override) {\n                    if (!state.tmp.group_context.tip.label_form) {\n                        state.tmp.group_context.tip.label_form = this.strings.label_form_override;\n                    }\n                }\n                \n                if (this.strings.label_capitalize_if_first_override) {\n                    if (!state.tmp.group_context.tip.label_capitalize_if_first) {\n                        state.tmp.group_context.tip.label_capitalize_if_first = this.strings.label_capitalize_if_first_override;\n                    }\n                }\n                \n                if (this.realGroup) {\n                    \n                    if (state.tmp.group_context.tip.condition) {\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, this.strings.prefix, null, this);\n                    }\n                    \n                    var condition = false;\n                    var force_suppress = false;\n\n                    // XXX Can we do something better for length here?\n                    if (state.tmp.group_context.mystack.length) {\n                        state.output.current.value().parent = state.tmp.group_context.tip.output_tip;\n                    }\n                    \n                    // fieldcontextflag\n                    var label_form = state.tmp.group_context.tip.label_form;\n                    if (!label_form) {\n                        label_form = this.strings.label_form_override;\n                    }\n                    \n                    var label_capitalize_if_first = state.tmp.group_context.tip.label_capitalize_if_first;\n                    if (!label_capitalize_if_first) {\n                        label_capitalize_if_first = this.strings.label_capitalize_if_first;\n                    }\n                    if (state.tmp.group_context.tip.condition) {\n                        condition = state.tmp.group_context.tip.condition;\n                        force_suppress = state.tmp.group_context.tip.force_suppress;\n                        //force_suppress: false;\n                    } else if (this.strings.reject) {\n                        condition = {\n                            test: this.strings.reject,\n                            not: true\n                        };\n                    } else if (this.strings.require) {\n                        condition = {\n                            test: this.strings.require,\n                            not: false\n                        };\n                    }\n                    var context = {\n                        old_term_predecessor: state.tmp.term_predecessor,\n                        term_intended: false,\n                        variable_attempt: false,\n                        variable_success: false,\n                        variable_success_parent: state.tmp.group_context.tip.variable_success,\n                        output_tip: state.output.current.tip,\n                        label_form: label_form,\n                        label_static: state.tmp.group_context.tip.label_static,\n                        label_capitalize_if_first: label_capitalize_if_first,\n                        parallel_delimiter_override: this.strings.set_parallel_delimiter_override,\n                        parallel_delimiter_override_on_suppress: this.strings.set_parallel_delimiter_override_on_suppress,\n                        condition: condition,\n                        force_suppress: force_suppress,\n                        done_vars: state.tmp.group_context.tip.done_vars.slice()\n                    };\n                    if(this.non_parallel) {\n                        var non_parallel = state.tmp.group_context.tip.non_parallel;\n                        if (!non_parallel) {\n                            non_parallel = {};\n                        }\n                        Object.assign(non_parallel, this.non_parallel);\n                        context.non_parallel = non_parallel;\n                    }\n                    if(this.parallel_first) {\n                        var parallel_first = state.tmp.group_context.tip.parallel_first;\n                        if (!parallel_first) {\n                            parallel_first = {};\n                        }\n                        Object.assign(parallel_first, this.parallel_first);\n                        context.parallel_first = parallel_first;\n                    }\n                    if(this.parallel_last) {\n                        var parallel_last = state.tmp.group_context.tip.parallel_last;\n                        if (!parallel_last) {\n                            parallel_last = {};\n                        }\n                        Object.assign(parallel_last, this.parallel_last);\n                        context.parallel_last = parallel_last;\n                    }\n                    if (state.tmp.abbrev_trimmer && state.tmp.abbrev_trimmer.LAST_TO_FIRST && context.parallel_last) {\n                        if (!context.parallel_first) {\n                            context.parallel_first = {};\n                        }\n                        for (var varname in state.tmp.abbrev_trimmer.LAST_TO_FIRST) {\n                            if (context.parallel_last[varname]) {\n                                context.parallel_first[varname] = true;\n                                delete context.parallel_last[varname];\n                            }\n                        }\n                    }\n                    \n                    /*\n                    if(this.parallel_last_override) {\n                        var parallel_last_override = state.tmp.group_context.tip.parallel_last_override;\n                        if (!parallel_last_override) {\n                            parallel_last_override = {};\n                        }\n                        Object.assign(parallel_last_override, this.parallel_last_override);\n                        context.parallel_last_override = parallel_last_override;\n                    }\n                     */\n                    state.tmp.group_context.push(context);\n\n                    if (state.tmp.abbrev_trimmer && this.parallel_last_to_first) {\n                        if (!state.tmp.abbrev_trimmer.LAST_TO_FIRST) {\n                            state.tmp.abbrev_trimmer.LAST_TO_FIRST = {};\n                        }\n                        for (var varname in this.parallel_last_to_first) {\n                            state.tmp.abbrev_trimmer.LAST_TO_FIRST[varname] = true;\n                        }\n                    }\n                    \n                    //if (!state.tmp.just_looking) {\n                    //    print(\"       flags=\"+JSON.stringify(state.tmp.group_context.tip, params))\n                    //}\n                }\n            };\n            //\n            // Paranoia.  Assure that this init function is the first executed.\n            execs = [];\n            execs.push(func);\n            this.execs = execs.concat(this.execs);\n\n            // \"Special handling\" for nodes that contain only\n            // publisher and place, with no affixes. For such\n            // nodes only, parallel publisher/place pairs\n            // will be parsed out and properly joined, piggybacking on\n            // join parameters set on cs:citation or cs:bibliography.\n            if (this.strings[\"has-publisher-and-publisher-place\"]) {\n                // Pass variable string values to the closing\n                // tag via a global, iff they conform to expectations.\n                state.build[\"publisher-special\"] = true;\n                if (this.strings[\"subgroup-delimiter\"]) {\n                    // Set the handling function only if name-delimiter\n                    // is set on the parent cs:citation or cs:bibliography\n                    // node.\n                    func = function (state, Item) {\n                        if (Item.publisher && Item[\"publisher-place\"]) {\n                            var publisher_lst = Item.publisher.split(/;\\s*/);\n                            var publisher_place_lst = Item[\"publisher-place\"].split(/;\\s*/);\n                            if (publisher_lst.length > 1\n                                && publisher_lst.length === publisher_place_lst.length) {\n                                state.publisherOutput = new CSL.PublisherOutput(state, this);\n                                state.publisherOutput[\"publisher-list\"] = publisher_lst;\n                                state.publisherOutput[\"publisher-place-list\"] = publisher_place_lst;\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                }\n            }\n\n            if (this.juris) {\n                // \"Special handling\" for jurisdiction macros\n                // We try to instantiate these as standalone token lists.\n                // If available, the token list is executed,\n                // the result is written directly into output,\n                // and control returns here.\n\n                // So we'll have something like this:\n                // * expandMacro() in util_node.js flags juris- macros\n                //   on build. [DONE]\n                // * Those are picked up here, and\n                //   - A runtime function attempts to fetch and instantiate\n                //     the macros in separate token lists under a segment\n                //     opened for the jurisdiction. We assume that the\n                //     jurisdiction has a full set of macros. That will need\n                //     to be enforced by validation. [DONE HERE, function is TODO]\n                //   - Success or failure is marked in a runtime flag object\n                //     (in citeproc.opt). [DONE]\n                //   - After the instantiation function comes a test, for\n                //     juris- macros only, which either runs diverted code,\n                //     or proceeds as per normal through the token list. [TODO]\n                // I think that's all there is to it.\n                \n                // Code for fetching an instantiating?\n\n                var choose_start = new CSL.Token(\"choose\", CSL.START);\n                CSL.Node.choose.build.call(choose_start, state, target);\n                \n                var if_start = new CSL.Token(\"if\", CSL.START);\n\n                func = (function (macroName) {\n                    return function (Item, item) {\n                        return CSL.INIT_JURISDICTION_MACROS(state, Item, item, macroName);\n                    }\n                }(this.juris));\n                \n                if_start.tests ? {} : if_start.tests = [];\n                if_start.tests.push(func);\n                if_start.test = state.fun.match.any(if_start, state, if_start.tests);\n                target.push(if_start);\n                var text_node = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function (state, Item, item) {\n                    // This will run the juris- token list.\n                    var itemItem = Item;\n                    if (item && item[\"best-jurisdiction\"] && this.juris === \"juris-locator\") {\n                        itemItem = item;\n                    }\n                    var next = 0;\n                    if (state.juris[itemItem[\"best-jurisdiction\"]][this.juris]) {\n                        while (next < state.juris[itemItem[\"best-jurisdiction\"]][this.juris].length) {\n                            next = CSL.tokenExec.call(state, state.juris[itemItem[\"best-jurisdiction\"]][this.juris][next], Item, item);\n                        }\n                    }\n                };\n                text_node.juris = this.juris;\n                text_node.execs.push(func);\n                target.push(text_node);\n\n                var if_end = new CSL.Token(\"if\", CSL.END);\n                CSL.Node[\"if\"].build.call(if_end, state, target);\n                var else_start = new CSL.Token(\"else\", CSL.START);\n                CSL.Node[\"else\"].build.call(else_start, state, target);\n            }\n        }\n\n        if (this.tokentype === CSL.END) {\n            \n            // Unbundle and print publisher lists\n            // Same constraints on creating the necessary function here\n            // as above. The full content of the group formatting token\n            // is apparently not available on the closing tag here,\n            // hence the global flag on state.build.\n            if (state.build[\"publisher-special\"]) {\n                state.build[\"publisher-special\"] = false;\n                func = function (state) {\n                    if (state.publisherOutput) {\n                        state.publisherOutput.render();\n                        state.publisherOutput = false;\n                    }\n                };\n                this.execs.push(func);\n            }\n            \n            // quashnonfields\n            func = function (state, Item, item) {\n                if (!state.tmp.group_context.tip.condition) {\n                    if (state.output.current.tip.strings.suffix) {\n                        state.tmp.just_did_number = false;\n                    }\n                }\n                state.output.endTag();\n                if (this.realGroup) {\n                    var flags = state.tmp.group_context.pop();\n                    if (flags.parallel_delimiter_override) {\n                        state.tmp.group_context.tip.parallel_delimiter_override = flags.parallel_delimiter_override;\n                        if (!state.tmp.just_looking && state.registry.registry[Item.id].master) {\n                            state.registry.registry[Item.id].parallel_delimiter_override = flags.parallel_delimiter_override;\n                        }\n                    }\n                    if (flags.parallel_delimiter_override_on_suppress) {\n                        state.tmp.group_context.tip.parallel_delimiter_override_on_suppress = flags.parallel_delimiter_override_on_suppress;\n                    }\n                    if (state.tmp.area === \"bibliography_sort\") {\n                        var citationNumberIdx = flags.done_vars.indexOf(\"citation-number\");\n                        if (this.strings.sort_direction && citationNumberIdx > -1 && state.tmp.group_context.length() == 1) {\n                            if (this.strings.sort_direction === CSL.DESCENDING) {\n                                state.bibliography_sort.opt.citation_number_sort_direction = CSL.DESCENDING;\n                            } else {\n                                state.bibliography_sort.opt.citation_number_sort_direction = CSL.ASCENDING;\n                            }\n                            flags.done_vars = flags.done_vars.slice(0, citationNumberIdx).concat(flags.done_vars.slice(citationNumberIdx + 1))\n                        }\n                    }\n                    //var params = [\"condition\", \"variable_success\", \"force_suppress\",\"term_intended\", \"variable_attempt\"]\n                    //if (!state.tmp.just_looking) {\n                    //    print(\"POP parent=\"+JSON.stringify(state.tmp.group_context.tip, params))\n                    //    print(\"    flags=\"+JSON.stringify(flags, params));\n                    //}\n                    if (flags.condition) {\n                        flags.force_suppress = CSL.EVALUATE_GROUP_CONDITION(state, flags);\n                    }\n                    if (state.tmp.group_context.tip.condition) {\n                        state.tmp.group_context.tip.force_suppress = flags.force_suppress;\n                    }\n                            \n                    if (!flags.force_suppress && (flags.variable_success || (flags.term_intended && !flags.variable_attempt))) {\n                        if (!this.isJurisLocatorLabel) {\n                            state.tmp.group_context.tip.variable_success = true;\n                        }\n                        var blobs = state.output.current.value().blobs;\n                        var pos = state.output.current.value().blobs.length - 1;\n\n                        if (!state.tmp.just_looking && (flags.non_parallel || flags.parallel_last || flags.parallel_first || flags.parallel_delimiter_override || flags.parallel_delimiter_override_on_suppress)) {\n                            // flags.parallel_last\n                            // flags.parallel_first\n\n                            // Returns true ONLY if all variables listed on this group are repeats.\n                            var hasRepeat = state.parallel.checkRepeats(flags);\n                            if (hasRepeat) {\n                                if (blobs) {\n                                    blobs.pop();\n                                }\n                            }\n                            if (state.tmp.cite_index > 0 && (hasRepeat || (!flags.parallel_first && !flags.parallel_last && !flags.non_parallel))) {\n                                //state.sys.print(`${state.tmp.cite_index} ${JSON.stringify(state.tmp.suppress_repeats, null, 2)}`)\n                                var info = state.tmp.suppress_repeats[state.tmp.cite_index-1];\n                                if (hasRepeat && flags.parallel_delimiter_override_on_suppress && (info.SIBLING || info.ORPHAN)) {\n                                    state.output.queue.slice(-1)[0].parallel_delimiter = flags.parallel_delimiter_override_on_suppress;\n                                } else if (flags.parallel_delimiter_override && info.SIBLING) {\n                                    state.output.queue.slice(-1)[0].parallel_delimiter = flags.parallel_delimiter_override;\n                                }\n                            }\n                        }\n                    } else {\n                        state.tmp.term_predecessor = flags.old_term_predecessor;\n                        state.tmp.group_context.tip.variable_attempt = flags.variable_attempt;\n                        if (flags.force_suppress && !state.tmp.group_context.tip.condition) {\n                            state.tmp.group_context.tip.variable_attempt = true;\n                            state.tmp.group_context.tip.variable_success = flags.variable_success_parent;\n                        }\n                        if (flags.force_suppress) {\n                            // 2019-04-15\n                            // This is removing variables done within the group we're leaveing from global\n                            // done_vars? How does that make sense?\n                            // Ah. This is a FAILURE. So removing from done_vars allows it to re-render\n                            // later in the cite if desired.\n                            // Currently no tests fail from removing the condition, but leaving it in.\n                            for (var i=0,ilen=flags.done_vars.length;i<ilen;i++) {\n                                var doneVar = flags.done_vars[i];\n                                for (var j=0,jlen=state.tmp.done_vars.length; j<jlen; j++) {\n                                    if (state.tmp.done_vars[j] === doneVar) {\n                                        state.tmp.done_vars = state.tmp.done_vars.slice(0, j).concat(state.tmp.done_vars.slice(j+1));\n                                    }\n                                }\n                            }\n                        }\n                        if (state.output.current.value().blobs) {\n                            state.output.current.value().blobs.pop();\n                        }\n                    }\n                }\n            };\n            this.execs.push(func);\n            \n            if (this.juris) {\n                var else_end = new CSL.Token(\"else\", CSL.END);\n                CSL.Node[\"else\"].build.call(else_end, state, target);\n                var choose_end = new CSL.Token(\"choose\", CSL.END);\n                CSL.Node.choose.build.call(choose_end, state, target);\n            }\n        }\n\n        if (this.tokentype === CSL.END) {\n            if (!this.juris) {\n                target.push(this);\n            }\n            if (state.build.substitute_level.value()) {\n                state.build.substitute_level.replace((state.build.substitute_level.value() - 1));\n            }\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"if\"] = {\n    build: function (state, target) {\n        CSL.Conditions.TopNode.call(this, state, target);\n        target.push(this);\n    },\n    configure: function (state, pos) {\n        CSL.Conditions.Configure.call(this, state, pos);\n    }\n};\n\n\nCSL.Node[\"conditions\"] = {\n    build: function (state) {\n        if (this.tokentype === CSL.START) {\n            state.tmp.conditions.addMatch(this.match);\n        }\n        if (this.tokentype === CSL.END) {\n            state.tmp.conditions.matchCombine();\n        }\n    }\n};\n\nCSL.Node[\"condition\"] = {\n    build: function (state) {\n        if (this.tokentype === CSL.SINGLETON) {\n            var test = state.fun.match[this.match](this, state, this.tests);\n            state.tmp.conditions.addTest(test);\n        }\n    }\n};\n\nCSL.Conditions = {};\n\nCSL.Conditions.TopNode = function (state) {\n    var func;\n    if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n        if (this.locale) {\n            state.opt.lang = this.locale;\n        }\n        if (!this.tests || !this.tests.length) {\n            // Set up the condition compiler with our current context\n            state.tmp.conditions = new CSL.Conditions.Engine(state, this);\n        } else {\n            // The usual.\n            this.test = state.fun.match[this.match](this, state, this.tests);\n        }\n        if (state.build.substitute_level.value() === 0) {\n            func = function(state) {\n                state.tmp.condition_counter++;\n            }\n            this.execs.push(func);\n        }\n    }\n    if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n        if (state.build.substitute_level.value() === 0) {\n            func = function (state) {\n                state.tmp.condition_counter--;\n                if (state.tmp.condition_lang_counter_arr.length > 0) {\n                    var counter = state.tmp.condition_lang_counter_arr.slice(-1)[0];\n                    if (counter === state.tmp.condition_counter) {\n                        state.opt.lang = state.tmp.condition_lang_val_arr.pop();\n                        state.tmp.condition_lang_counter_arr.pop();\n                    }\n                }\n                if (this.locale_default) {\n                    // Open output tag with locale marker\n                    state.output.current.value().old_locale = this.locale_default;\n                    state.output.closeLevel(\"empty\");\n                    state.opt.lang = this.locale_default;\n                }\n            };\n            this.execs.push(func);\n        }\n        // closingjump\n        func = function (state) {\n            var next = this[state.tmp.jump.value()];\n            return next;\n        };\n        this.execs.push(func);\n        if (this.locale_default) {\n            state.opt.lang = this.locale_default;\n        }\n    }\n};\n\nCSL.Conditions.Configure = function (state, pos) {\n    if (this.tokentype === CSL.START) {\n        // jump index on failure\n        this.fail = state.configure.fail.slice(-1)[0];\n        this.succeed = this.next;\n        state.configure.fail[(state.configure.fail.length - 1)] = pos;\n    } else if (this.tokentype === CSL.SINGLETON) {\n        // jump index on failure\n        this.fail = this.next;\n        this.succeed = state.configure.succeed.slice(-1)[0];\n        state.configure.fail[(state.configure.fail.length - 1)] = pos;\n    } else {\n        // jump index on success\n        this.succeed = state.configure.succeed.slice(-1)[0];\n        this.fail = this.next;\n    }\n};\n\nCSL.Conditions.Engine = function (state, token) {\n    this.token = token;\n    this.state = state;\n};\n\nCSL.Conditions.Engine.prototype.addTest = function (test) {\n    this.token.tests ? {} : this.token.tests = [];\n    this.token.tests.push(test);\n};\n\nCSL.Conditions.Engine.prototype.addMatch = function (match) {\n    this.token.match = match;\n};\n\nCSL.Conditions.Engine.prototype.matchCombine = function () {\n    this.token.test = this.state.fun.match[this.token.match](this.token, this.state, this.token.tests);\n};\n\n/*global CSL: true */\n\nCSL.Node.info = {\n    build: function (state) {\n        if (this.tokentype === CSL.START) {\n            state.build.skip = \"info\";\n        } else {\n            state.build.skip = false;\n        }\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Node.institution = {\n    build: function (state, target) {\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n\n            var func = function (state) {\n                if (\"string\" === typeof this.strings.delimiter) {\n                    state.tmp.institution_delimiter = this.strings.delimiter;\n                } else {\n                    state.tmp.institution_delimiter = state.tmp.name_delimiter;\n                }\n\n                // This is the same code for the same result as in node_name.js, \n                // but when cs:institution comes on stream, it may produce\n                // different results.\n                if (\"text\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.getTerm(\"and\", \"long\", 0);\n                } else if (\"symbol\" === state.inheritOpt(this, \"and\")) {\n                    if (state.opt.development_extensions.expect_and_symbol_form) {\n                        this.and_term = state.getTerm(\"and\", \"symbol\", 0);\n                    } else {\n                        this.and_term = \"&\";\n                    }\n                } else if (\"none\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.tmp.institution_delimiter;\n                }\n                if (\"undefined\" === typeof this.and_term && state.tmp.and_term) {\n                    // this.and_term = state.getTerm(\"and\", \"long\", 0);\n                    this.and_term = state.tmp.and_term;\n                }\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)) {\n                    this.and_prefix_single = \" \";\n                    this.and_prefix_multiple = \", \";\n                    if (\"string\" === typeof state.tmp.institution_delimiter) {\n                        this.and_prefix_multiple = state.tmp.institution_delimiter;\n                    }\n                    this.and_suffix = \" \";\n                } else {\n                    this.and_prefix_single = \"\";\n                    this.and_prefix_multiple = \"\";\n                    this.and_suffix = \"\";\n                }\n                if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"always\") {\n                    this.and_prefix_single = state.tmp.institution_delimiter;\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"never\") {\n                    // Slightly fragile: could test for charset here to make\n                    // this more certain.\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                }\n                \n                this.and = {};\n                if (\"undefined\" !== typeof this.and_term) {\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.single = state.output.pop();\n                    this.and.single.strings.prefix = this.and_prefix_single;\n                    this.and.single.strings.suffix = this.and_suffix;\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.multiple = state.output.pop();\n                    this.and.multiple.strings.prefix = this.and_prefix_multiple;\n                    this.and.multiple.strings.suffix = this.and_suffix;\n                } else if (\"undefined\" !== this.strings.delimiter) {\n                    this.and.single = new CSL.Blob(state.tmp.institution_delimiter);\n                    this.and.single.strings.prefix = \"\";\n                    this.and.single.strings.suffix = \"\";\n                    this.and.multiple = new CSL.Blob(state.tmp.institution_delimiter);\n                    this.and.multiple.strings.prefix = \"\";\n                    this.and.multiple.strings.suffix = \"\";\n                }\n                state.nameOutput.institution = this;\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    },\n    configure: function (state) {\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n            state.build.has_institution = true;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node[\"institution-part\"] = {\n    build: function (state, target) {\n        var func;\n        if (\"long\" === this.strings.name) {\n            if (this.strings[\"if-short\"]) {\n                func = function (state) {\n                    state.nameOutput.institutionpart[\"long-with-short\"] = this;\n                };\n            } else {\n                func = function (state) {\n                    state.nameOutput.institutionpart[\"long\"] = this;\n                };\n            }\n        } else if (\"short\" === this.strings.name) {\n            func = function (state) {\n                state.nameOutput.institutionpart[\"short\"] = this;\n            };\n        }\n        this.execs.push(func);\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.key = {\n    build: function (state, target) {\n        \n        target = state[state.build.root + \"_sort\"].tokens;\n\n        var func;\n        var debug = false;\n        var start_key = new CSL.Token(\"key\", CSL.START);\n\n        state.tmp.root = state.build.root;\n\n        // The params object for build and runtime (tmp) really shouldn't have been separated.\n        // Oh, well.\n        start_key.strings[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n        start_key.strings[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n        start_key.strings[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n\n\n        // initialize done vars\n        func = function (state) {\n            state.tmp.done_vars = [];\n        };\n        start_key.execs.push(func);\n\n        // initialize output queue\n        func = function (state) {\n            state.output.openLevel(\"empty\");\n        };\n        start_key.execs.push(func);\n\n        // sort direction\n        var sort_direction = [];\n        if (this.strings.sort_direction === CSL.DESCENDING) {\n            //print(\"sort: descending on \"+state.tmp.area);\n            sort_direction.push(1);\n            sort_direction.push(-1);\n        } else {\n            //print(\"sort: ascending\");\n            sort_direction.push(-1);\n            sort_direction.push(1);\n        }\n        state[state.build.area].opt.sort_directions.push(sort_direction);\n\n        if (CSL.DATE_VARIABLES.indexOf(this.variables[0]) > -1) {\n            state.build.date_key = true;\n        }\n\n        // et al init\n        func = function (state) {\n            state.tmp.sort_key_flag = true;\n            //print(\"== key node function ==\");\n            if (state.inheritOpt(this, \"et-al-min\")) {\n                state.tmp[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n            }\n            if (state.inheritOpt(this, \"et-al-use-first\")) {\n                state.tmp[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n            }\n            if (\"boolean\" === typeof state.inheritOpt(this, \"et-al-use-last\")) {\n                state.tmp[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                //print(\"  set tmp et-al-use-last: \"+this.strings[\"et-al-use-last\"])\n            }\n        };\n        start_key.execs.push(func);\n        target.push(start_key);\n        \n        //\n        // ops to initialize the key's output structures\n        if (this.variables.length) {\n            var variable = this.variables[0];\n            if (CSL.NAME_VARIABLES.indexOf(variable) > -1) {\n                //\n                // Start tag\n                var names_start_token = new CSL.Token(\"names\", CSL.START);\n                names_start_token.tokentype = CSL.START;\n                names_start_token.variables = this.variables;\n                CSL.Node.names.build.call(names_start_token, state, target);\n                //\n                // Name tag\n                var name_token = new CSL.Token(\"name\", CSL.SINGLETON);\n                name_token.tokentype = CSL.SINGLETON;\n                name_token.strings[\"name-as-sort-order\"] = \"all\";\n                name_token.strings[\"sort-separator\"] = \" \";\n                name_token.strings[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                name_token.strings[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n                name_token.strings[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n                CSL.Node.name.build.call(name_token, state, target);\n                //\n                // Institution tag\n                var institution_token = new CSL.Token(\"institution\", CSL.SINGLETON);\n                institution_token.tokentype = CSL.SINGLETON;\n                CSL.Node.institution.build.call(institution_token, state, target);\n                //\n                // End tag\n                var names_end_token = new CSL.Token(\"names\", CSL.END);\n                names_end_token.tokentype = CSL.END;\n                CSL.Node.names.build.call(names_end_token, state, target);\n            } else {\n                var single_text = new CSL.Token(\"text\", CSL.SINGLETON);\n                single_text.strings.sort_direction = this.strings.sort_direction;\n                single_text.dateparts = this.dateparts;\n                if (CSL.NUMERIC_VARIABLES.indexOf(variable) > -1) {\n                    // citation-number is virtualized. As a sort key it has no effect on registry\n                    // sort order per se, but if set to DESCENDING, it reverses the sequence of numbers representing\n                    // bib entries.\n                    if (variable === \"citation-number\") {\n                        func = function (state, Item) {\n                            if (state.tmp.area === \"bibliography_sort\") {\n                                if (this.strings.sort_direction === CSL.DESCENDING) {\n                                    state.bibliography_sort.opt.citation_number_sort_direction = CSL.DESCENDING;\n                                } else {\n                                    state.bibliography_sort.opt.citation_number_sort_direction = CSL.ASCENDING;\n                                }\n                            }\n                            if (state.tmp.area === \"citation_sort\" && state.bibliography_sort.tmp.citation_number_map) {\n                                var num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[Item.id].seq];\n                            } else {\n                                var num = state.registry.registry[Item.id].seq;\n                            }\n                            if (num) {\n                                // Code currently in util_number.js\n                                num = CSL.Util.padding(\"\" + num);\n                            }\n                            state.output.append(num, this);\n                        };\n                    } else {\n                        func = function (state, Item) {\n                            var num = false;\n                            num = Item[variable];\n                            // XXX What if this is NaN?\n                            if (num) {\n                                // Code currently in util_number.js\n                                num = CSL.Util.padding(num);\n                            }\n                            state.output.append(num, this);\n                        };\n                    }\n                } else if (variable === \"citation-label\") {\n                    func = function (state, Item) {\n                        var trigraph = state.getCitationLabel(Item);\n                        state.output.append(trigraph, this);\n                    };\n                } else if (CSL.DATE_VARIABLES.indexOf(variable) > -1) {\n                    func = CSL.dateAsSortKey;\n                    single_text.variables = this.variables;\n                } else if (\"title\" === variable) {\n                    var abbrevfam = \"title\";\n                    var abbrfall = false;\n                    var altvar = false;\n                    var transfall = true;\n                    func = state.transform.getOutputFunction(this.variables, abbrevfam, abbrfall, altvar, transfall);\n                } else if (\"court-class\" === variable) {\n                    func = function(state, Item, item) {\n                        CSL.INIT_JURISDICTION_MACROS(state, Item, item, \"juris-main\")\n                        // true is for sortKey mode\n                        var cls = CSL.GET_COURT_CLASS(state, Item, true);\n                        state.output.append(cls, \"empty\");\n                    }\n                } else {\n                    func = function (state, Item) {\n                        var varval = Item[variable];\n                        state.output.append(varval, \"empty\");\n                    };\n                }\n                single_text.execs.push(func);\n                target.push(single_text);\n            }\n        } else { // macro\n            //\n            // if it's not a variable, it's a macro\n            var token = new CSL.Token(\"text\", CSL.SINGLETON);\n            token.strings.sort_direction = this.strings.sort_direction;\n            token.postponed_macro = this.postponed_macro;\n            CSL.expandMacro.call(state, token, target);\n        }\n        //\n        // ops to output the key string result to an array go\n        // on the closing \"key\" tag before it is pushed.\n        // Do not close the level.\n        var end_key = new CSL.Token(\"key\", CSL.END);\n\n        // Eliminated at revision 1.0.159.\n        // Was causing non-fatal error \"wanted empty but found group\".\n        // Possible contributor to weird \"PAGES\" bug?\n        //func = function (state, Item) {\n        //state.output.closeLevel(\"empty\");\n        //};\n        //end_key.execs.push(func);\n        \n        // store key for use\n        func = function (state) {\n            var keystring = state.output.string(state, state.output.queue);\n            if (state.sys.normalizeUnicode) {\n                keystring = state.sys.normalizeUnicode(keystring);\n            }\n            keystring = keystring ? (keystring.split(\" \").join(state.opt.sort_sep) + state.opt.sort_sep) : \"\";\n            //SNIP-START\n            if (debug) {\n                CSL.debug(\"keystring: \" + keystring + \" \" + typeof keystring);\n            }\n            //print(\"keystring: (\" + keystring + \") \" + typeof keystring + \" \" + state.tmp.area);\n            //SNIP-END\n            //state.sys.print(\"keystring: (\" + keystring + \") \" + typeof keystring + \" \" + state.tmp.area);\n            if (\"\" === keystring) {\n                keystring = undefined;\n            }\n            if (\"string\" !== typeof keystring) {\n                keystring = undefined;\n                //state.tmp.empty_date = false;\n            }\n            state[state[state.tmp.area].root + \"_sort\"].keys.push(keystring);\n            state.tmp.value = [];\n        };\n        end_key.execs.push(func);\n\n        // Set year-suffix key on anything that looks like a date\n        if (state.build.date_key) {\n            if (state.build.area === \"citation\" && state.build.extension === \"_sort\") {\n                // ascending sort always\n                state[state.build.area].opt.sort_directions.push([-1,1]);\n                func = function (state, Item) {\n                    // year-suffix Key\n                    var year_suffix = state.registry.registry[Item.id].disambig.year_suffix;\n                    if (!year_suffix) {\n                        year_suffix = 0;\n                    }\n                    var key = CSL.Util.padding(\"\" + year_suffix);\n                    state[state.tmp.area].keys.push(key);\n                };\n                end_key.execs.push(func);\n            }\n            state.build.date_key = false;\n        }\n\n        // reset key params\n        func = function (state) {\n            // state.tmp.name_quash = new Object();\n\n            // XXX This should work, should be necessary, but doesn't and isn't.\n            //state.output.closeLevel(\"empty\");\n\n            state.tmp[\"et-al-min\"] = undefined;\n            state.tmp[\"et-al-use-first\"] = undefined;\n            state.tmp[\"et-al-use-last\"] = undefined;\n            state.tmp.sort_key_flag = false;\n        };\n        end_key.execs.push(func);\n        target.push(end_key);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.label = {\n    build: function (state, target) {\n        \n        if (this.strings.term) {\n            // Non-names labels\n            var func = function (state, Item, item) {\n                // Must accomplish this without touching strings\n                // shared with the calling application: \"sub verbo\"\n                // and \"sub-verbo\" must both pass, as they stand.\n                //if (item && item.label === \"sub verbo\") {\n                //    item.label = \"sub-verbo\";\n                //}\n                // This is abstracted away, because the same\n                // logic must be run in cs:names.\n                var termtxt = CSL.evaluateLabel(this, state, Item, item);\n                if (item && this.strings.term === \"locator\") {\n\n                    item.section_form_override = this.strings.form;\n\n                }\n                if (termtxt) {\n                    state.tmp.group_context.tip.term_intended = true;\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, termtxt, null, this);\n                if (termtxt.indexOf(\"%s\") === -1) {\n                    // ^ Suppress output here if we have an embedded term\n                    if (this.strings.capitalize_if_first) {\n                        if (!state.tmp.term_predecessor && !(state.opt[\"class\"] === \"in-text\" && state.tmp.area === \"citation\")) {\n                            termtxt = CSL.Output.Formatters[\"capitalize-first\"](state, termtxt);\n                        }\n                    }\n                    state.output.append(termtxt, this);\n                }\n            };\n            this.execs.push(func);\n        } else {\n            if (!this.strings.form) {\n                this.strings.form = \"long\";\n            }\n            // Names labels\n            // Picked up in names END\n            var namevars = state.build.names_variables[state.build.names_variables.length-1];\n            var namelabels = state.build.name_label[state.build.name_label.length-1];\n            for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                if (!namelabels[namevars[i]]) {\n                    namelabels[namevars[i]] = {};\n                }\n            }\n            if (!state.build.name_flag) {\n                for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                    namelabels[namevars[i]].before = this;\n                }\n            } else {\n                for (var i = 0, ilen = namevars.length; i < ilen; i += 1) {\n                    namelabels[namevars[i]].after = this;\n                }\n            }\n        }\n        target.push(this);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.layout = {\n    build: function (state, target) {\n        var func, prefix_token, suffix_token, tok;\n\n        function setSuffix() {\n            if (state.build.area === \"bibliography\") {\n                suffix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function(state) {\n                    // Suppress suffix on all but the last item in bibliography parallels\n                    if (!state.tmp.parallel_and_not_last) {\n                        var suffix;\n                        if (state.tmp.cite_affixes[state.tmp.area][state.tmp.last_cite_locale]) {\n                            suffix = state.tmp.cite_affixes[state.tmp.area][state.tmp.last_cite_locale].suffix;\n                        } else {\n                            suffix = state.bibliography.opt.layout_suffix;\n                        }\n\n                        // If @display is used, layout suffix is placed on the last\n                        // immediate child of the layout, which we assume will be a\n                        // @display group node.\n                        var topblob = state.output.current.value();\n                        if (state.opt.using_display) {\n                            topblob.blobs[topblob.blobs.length-1].strings.suffix = suffix;\n                        } else {\n                            topblob.strings.suffix = suffix;\n                        }\n                    }\n                    if (state.bibliography.opt[\"second-field-align\"]) {\n                        // closes bib_other\n                        state.output.endTag(\"bib_other\");\n                    }\n                };\n                suffix_token.execs.push(func);\n                target.push(suffix_token);\n            }\n        }\n\n        if (this.tokentype === CSL.START) {\n\n            if (this.locale_raw) {\n                state.build.current_default_locale = this.locale_raw;\n            } else {\n                state.build.current_default_locale = state.opt[\"default-locale\"];\n            }\n\n            func = function (state, Item, item) {\n                if (state.opt.development_extensions.apply_citation_wrapper\n                    && state.sys.wrapCitationEntry\n                    && !state.tmp.just_looking\n                    && Item.system_id \n                    && state.tmp.area === \"citation\") { \n\n                    var cite_entry = new CSL.Token(\"group\", CSL.START);\n                    cite_entry.decorations = [[\"@cite\", \"entry\"]];\n                    state.output.startTag(\"cite_entry\", cite_entry);\n                    state.output.current.value().item_id = Item.system_id;\n                    if (item) {\n                        state.output.current.value().locator_txt = item.locator_txt;\n                        state.output.current.value().suffix_txt = item.suffix_txt;\n                    }\n                }\n            };\n            this.execs.push(func);\n        }\n\n        // XXX Works, but using state.tmp looks wrong here? We're in the build layer ...\n        if (this.tokentype === CSL.START && !state.tmp.cite_affixes[state.build.area]) {\n            //\n            // done_vars is used to prevent the repeated\n            // rendering of variables\n            //\n            // initalize done vars\n            func = function (state, Item, item) {\n\n                state.tmp.done_vars = [];\n                if (item && item[\"author-only\"]) {\n                    state.tmp.done_vars.push(\"locator\");\n                }\n                if (state.opt.suppressedJurisdictions[Item[\"country\"]]\n                    && Item[\"country\"]\n                    && [\"treaty\", \"patent\"].indexOf(Item.type) === -1) {\n                    \n                    state.tmp.done_vars.push(\"country\");\n                }\n                if (!state.tmp.just_looking && state.registry.registry[Item.id] && state.registry.registry[Item.id].parallel) {\n                    state.tmp.done_vars.push(\"first-reference-note-number\");\n                }\n                // trimmer is not available in getAmbiguousCite\n                if (!state.tmp.just_looking && state.tmp.abbrev_trimmer && Item.jurisdiction) {\n                    for (var field in state.tmp.abbrev_trimmer.QUASHES[Item.jurisdiction]) {\n                        state.tmp.done_vars.push(field);\n                    }\n                }\n\n                //CSL.debug(\" === init rendered_name === \");\n                state.tmp.rendered_name = false;\n            };\n            this.execs.push(func);\n            // set opt delimiter\n            func = function (state) {\n                // just in case\n                state.tmp.sort_key_flag = false;\n            };\n            this.execs.push(func);\n            \n            // reset nameset counter [all nodes]\n            func = function (state) {\n                state.tmp.nameset_counter = 0;\n            };\n            this.execs.push(func);\n\n            func = function (state, Item) {\n                var tok = new CSL.Token();\n                state.output.openLevel(tok);\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            if (state.build.area === \"citation\") {\n                prefix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                func = function (state, Item, item) {\n                    if (item && item.prefix) {\n                        var prefix = CSL.checkPrefixSpaceAppend(state, item.prefix);\n                        if (!state.tmp.just_looking) {\n                            prefix = state.output.checkNestedBrace.update(prefix);\n                        }\n                        var ignorePredecessor = CSL.checkIgnorePredecessor(state, prefix);\n                        state.output.append(prefix, this, false, ignorePredecessor);\n                    }\n                };\n                prefix_token.execs.push(func);\n                target.push(prefix_token);\n            }\n        }\n\n        // Cast token to be used in one of the configurations below.\n        var my_tok;\n        if (this.locale_raw) {\n            my_tok = new CSL.Token(\"dummy\", CSL.START);\n            my_tok.locale = this.locale_raw;\n            my_tok.strings.delimiter = this.strings.delimiter;\n            my_tok.strings.suffix = this.strings.suffix;\n            if (!state.tmp.cite_affixes[state.build.area]) {\n                state.tmp.cite_affixes[state.build.area] = {};\n            }\n        }\n\n        if (this.tokentype === CSL.START) {\n            state.build.layout_flag = true;\n                            \n            // Only run the following once, to set up the final layout node ...\n            if (!this.locale_raw) {\n                //\n                // save out decorations for flipflop processing [final node only]\n                //\n                state[state.tmp.area].opt.topdecor = [this.decorations];\n                state[(state.tmp.area + \"_sort\")].opt.topdecor = [this.decorations];\n\n                state[state.build.area].opt.layout_prefix = this.strings.prefix;\n                state[state.build.area].opt.layout_suffix = this.strings.suffix;\n                state[state.build.area].opt.layout_delimiter = this.strings.delimiter;\n\n                state[state.build.area].opt.layout_decorations = this.decorations;\n                \n                // Only do this if we're running conditionals\n                if (state.tmp.cite_affixes[state.build.area]) {\n                    // if build_layout_locale_flag is true,\n                    // write cs:else START to the token list.\n                    tok = new CSL.Token(\"else\", CSL.START);\n                    CSL.Node[\"else\"].build.call(tok, state, target);\n                }\n\n            } // !this.locale_raw\n\n            // Conditionals\n            if (this.locale_raw) {\n                if (!state.build.layout_locale_flag) {\n                    // if layout_locale_flag is untrue,\n                    // write cs:choose START and cs:if START\n                    // to the token list.\n                    var choose_tok = new CSL.Token(\"choose\", CSL.START);\n                    CSL.Node.choose.build.call(choose_tok, state, target);\n                    my_tok.name = \"if\";\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"if\"].build.call(my_tok, state, target);\n                } else {\n                    // if build_layout_locale_flag is true,\n                    // write cs:else-if START to the token list.\n                    my_tok.name = \"else-if\";\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"else-if\"].build.call(my_tok, state, target);\n                }\n                // cite_affixes for this node\n                state.tmp.cite_affixes[state.build.area][my_tok.locale] = {};\n                state.tmp.cite_affixes[state.build.area][my_tok.locale].delimiter = this.strings.delimiter;\n                state.tmp.cite_affixes[state.build.area][my_tok.locale].suffix = this.strings.suffix;\n            }\n        }\n        if (this.tokentype === CSL.END) {\n            if (this.locale_raw) {\n                setSuffix();\n                if (!state.build.layout_locale_flag) {\n                    // If layout_locale_flag is untrue, write cs:if END\n                    // to the token list.\n                    my_tok.name = \"if\";\n                    my_tok.tokentype = CSL.END;\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"if\"].build.call(my_tok, state, target);\n                    state.build.layout_locale_flag = true;\n                } else {\n                    // If layout_locale_flag is true, write cs:else-if END\n                    // to the token list.\n                    my_tok.name = \"else-if\";\n                    my_tok.tokentype = CSL.END;\n                    CSL.Attributes[\"@locale-internal\"].call(my_tok, state, this.locale_raw);\n                    CSL.Node[\"else-if\"].build.call(my_tok, state, target);\n                }\n            }\n            if (!this.locale_raw) {\n                setSuffix();\n                // Only add this if we're running conditionals\n                if (state.tmp.cite_affixes[state.build.area]) {\n                    // If layout_locale_flag is true, write cs:else END\n                    // and cs:choose END to the token list.\n                    if (state.build.layout_locale_flag) {\n                        tok = new CSL.Token(\"else\", CSL.END);\n                        CSL.Node[\"else\"].build.call(tok, state, target);\n                        tok = new CSL.Token(\"choose\", CSL.END);\n                        CSL.Node.choose.build.call(tok, state, target);\n                    }\n                }\n                state.build_layout_locale_flag = true;\n                if (state.build.area === \"citation\") {\n                    suffix_token = new CSL.Token(\"text\", CSL.SINGLETON);\n                    func = function (state, Item, item) {\n                        var sp;\n                        if (item && item.suffix) {\n                            var suffix = CSL.checkSuffixSpacePrepend(state, item.suffix);\n                            if (!state.tmp.just_looking) {\n                                suffix = state.output.checkNestedBrace.update(suffix);\n                            }\n                            state.output.append((suffix), this);\n                        }\n                    };\n                    suffix_token.execs.push(func);\n                    target.push(suffix_token);\n                }\n\n                // Closes wrapper token\n                func = function (state) {\n                    state.output.closeLevel();\n                };\n                this.execs.push(func);\n                func = function (state, Item) {\n                    if (state.opt.development_extensions.apply_citation_wrapper\n                        && state.sys.wrapCitationEntry\n                        && !state.tmp.just_looking\n                        && Item.system_id \n                        && state.tmp.area === \"citation\") { \n                        \n                        state.output.endTag(); // closes citation link wrapper\n                    }\n                };\n                this.execs.push(func);\n                target.push(this);\n                state.build.layout_flag = false;\n                state.build.layout_locale_flag = false;\n            } // !this.layout_raw\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.macro = {\n    build: function () {}\n};\n\n/*global CSL: true */\n\nCSL.Node.alternative = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var if_tok = new CSL.Token(\"if\", CSL.START);\n            CSL.Attributes[\"@alternative-node-internal\"].call(if_tok, state);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var func = function(state, Item) {\n\n                state.tmp.oldItem = Item;\n                state.tmp.oldLang = state.opt.lang;\n                state.tmp.abort_alternative = true;\n\n                if (Item[\"language-name\"] && Item[\"language-name-original\"]) {\n\n                    var newItem = JSON.parse(JSON.stringify(Item));\n\n                    newItem.language = newItem[\"language-name\"];\n                    var langspec = CSL.localeResolve(newItem.language, state.opt[\"default-locale\"][0]);\n\n                    if (state.opt.multi_layout) {\n                        for (var i in state.opt.multi_layout) {\n                            var locale_list = state.opt.multi_layout[i];\n                            var gotlang = false;\n                            for (var j in locale_list) {\n                                var tryspec = locale_list[j];\n                                if (langspec.best === tryspec.best || langspec.base === tryspec.base || langspec.bare === tryspec.bare) {\n                                    gotlang = locale_list[0].best;\n                                    break;\n                                }\n                            }\n                            if (!gotlang) {\n                                gotlang = state.opt[\"default-locale\"][0];\n                            }\n                            state.opt.lang = gotlang;\n                        }\n                    }\n\n                    for (var key in newItem) {\n                        if ([\"id\", \"type\", \"language\", \"multi\"].indexOf(key) === -1 && key.slice(0, 4) !== \"alt-\") {\n                            if (newItem.multi && newItem.multi._keys[key]) {\n                                var deleteme = true;\n                                for (var lang in newItem.multi._keys[key]) {\n                                    if (langspec.bare === lang.replace(/^([a-zA-Z]+).*/, \"$1\")) {\n                                        deleteme = false;\n                                        break;\n                                    }\n                                }\n                                if (deleteme) {\n                                    delete newItem[key];\n                                }\n                            } else {\n                                delete newItem[key];\n                            }\n                        }\n                    }\n                    for (var key in newItem) {\n                        if (key.slice(0, 4) === \"alt-\") {\n                            newItem[key.slice(4)] = newItem[key];\n                            state.tmp.abort_alternative = false;\n                        } else {\n                            if (newItem.multi && newItem.multi._keys) {\n                                if (!newItem[\"alt-\" + key] && newItem.multi._keys[key]) {\n                                    if (newItem.multi._keys[key][langspec.best]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.best];\n                                        state.tmp.abort_alternative = false;\n                                    } else if (newItem.multi._keys[key][langspec.base]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.base];\n                                        state.tmp.abort_alternative = false;\n                                    } else if (newItem.multi._keys[key][langspec.bare]) {\n                                        newItem[key] = newItem.multi._keys[key][langspec.bare];\n                                        state.tmp.abort_alternative = false;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n\n                state.output.openLevel(this);\n                state.registry.refhash[Item.id] = newItem;\n                state.nameOutput = new CSL.NameOutput(state, newItem);\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var if_tok = new CSL.Token(\"if\", CSL.START);\n            CSL.Attributes[\"@alternative-node-internal\"].call(if_tok, state);\n            var func = function(state) {\n                state.tmp.abort_alternative = true;\n            }\n            if_tok.execs.push(func);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n        } else if (this.tokentype === CSL.END) {\n\n            var if_tok = new CSL.Token(\"if\", CSL.END);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n            var func = function(state, Item) {\n                state.output.closeLevel();\n                state.registry.refhash[Item.id] = state.tmp.oldItem;\n                state.opt.lang = state.tmp.oldLang;\n                state.nameOutput = new CSL.NameOutput(state, state.tmp.oldItem);\n                state.tmp.abort_alternative = false;\n            };\n            this.execs.push(func);\n            target.push(this);\n\n            var if_tok = new CSL.Token(\"if\", CSL.END);\n            CSL.Node[\"if\"].build.call(if_tok, state, target);\n\n            var choose_tok = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node[\"choose\"].build.call(choose_tok, state, target);\n\n        }\n    }\n};\n\nCSL.Node[\"alternative-text\"] = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.SINGLETON) {\n            // do stuff\n            var func = function(state, Item) {\n                var Item = state.refetchItem(Item.id);\n                CSL.getCite.call(state, Item);\n            };\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.NameOutput = function(state, Item, item) {\n    this.debug = false;\n    //SNIP-START\n    if (this.debug) {\n        print(\"(1)\");\n    }\n    //SNIP-END\n    this.state = state;\n    this.Item = Item;\n    this.item = item;\n    this.nameset_base = 0;\n    this.etal_spec = {};\n    this._first_creator_variable = false;\n    this._please_chop = false;\n};\n\nCSL.NameOutput.prototype.init = function (names) {\n    this.requireMatch = names.requireMatch;\n    if (this.state.tmp.term_predecessor) {\n        this.state.tmp.subsequent_author_substitute_ok = false;\n    }\n    if (this.nameset_offset) {\n        this.nameset_base = this.nameset_base + this.nameset_offset;\n    }\n    this.nameset_offset = 0;\n    this.names = names;\n    this.variables = names.variables;\n\n    this.state.tmp.value = [];\n    this.state.tmp.rendered_name = [];\n    this.state.tmp.label_blob = false;\n    this.state.tmp.etal_node = false;\n    this.state.tmp.etal_term = false;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        if (this.Item[this.variables[i]] && this.Item[this.variables[i]].length) {\n            this.state.tmp.value = this.state.tmp.value.concat(this.Item[this.variables[i]]);\n        }\n    }\n    this[\"et-al\"] = undefined;\n    // REMOVE THIS\n    this[\"with\"] = undefined;\n\n    this.name = undefined;\n    // long, long-with-short, short\n    this.institutionpart = {};\n    // family, given\n    //this.namepart = {};\n    // before, after\n    //this.label = {};\n\n    this.state.tmp.group_context.tip.variable_attempt = true;\n\n    this.labelVariable = this.variables[0];\n\n    if (!this.state.tmp.value.length) {\n        return;\n    }\n\n    // Abort and proceed to the next substitution if a match is required,\n    // two variables are called, and they do not match.\n    var checkCommonTerm = this.checkCommonAuthor(this.requireMatch);\n    if (checkCommonTerm) {\n        this.state.tmp.can_substitute.pop();\n        this.state.tmp.can_substitute.push(true);\n        //this.state.tmp.group_context.mystack[this.state.tmp.group_context.mystack.length-1].variable_success = false;\n        for (var i in this.variables) {\n            var idx = this.state.tmp.done_vars.indexOf(this.variables[i]);\n            if (idx > -1) {\n                this.state.tmp.done_vars = this.state.tmp.done_vars.slice(0, idx).concat(this.state.tmp.done_vars.slice(i+1));\n            }\n        }\n        this.state.tmp.common_term_match_fail = true;\n        this.variables = [];\n    }\n};\n\n\nCSL.NameOutput.prototype.reinit = function (names, labelVariable) {\n    this.requireMatch = names.requireMatch;\n    this.labelVariable = labelVariable;\n\n    if (this.state.tmp.can_substitute.value()) {\n        this.nameset_offset = 0;\n        // What-all should be carried across from the subsidiary\n        // names node, and on what conditions? For each attribute,\n        // and decoration, is it an override, or is it additive?\n        this.variables = names.variables;\n        \n        // Not sure why this is necessary. Guards against a memory leak perhaps?\n        var oldval = this.state.tmp.value.slice();\n        this.state.tmp.value = [];\n\n        for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n            if (this.Item[this.variables[i]] && this.Item[this.variables[i]].length) {\n                this.state.tmp.value = this.state.tmp.value.concat(this.Item[this.variables[i]]);\n            }\n        }\n        if (this.state.tmp.value.length) {\n            this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n        }\n\n        this.state.tmp.value = oldval;\n\n    }\n    // Abort and proceed to the next substitution if a match is required,\n    // two variables are called, and they do not match.\n    var checkCommonTerm = this.checkCommonAuthor(this.requireMatch);\n    if (checkCommonTerm) {\n        this.state.tmp.can_substitute.pop();\n        this.state.tmp.can_substitute.push(true);\n        for (var i in this.variables) {\n            var idx = this.state.tmp.done_vars.indexOf(this.variables[i]);\n            if (idx > -1) {\n                this.state.tmp.done_vars = this.state.tmp.done_vars.slice(0, idx).concat(this.state.tmp.done_vars.slice(i+1));\n            }\n        }\n        this.variables = [];\n    }\n};\n\nCSL.NameOutput.prototype.outputNames = function () {\n    var i, ilen;\n    var variables = this.variables;\n    if (this.institution.and) {\n        if (!this.institution.and.single.blobs || !this.institution.and.single.blobs.length) {\n            this.institution.and.single.blobs = this.name.and.single.blobs;\n        }\n        if (!this.institution.and.multiple.blobs || !this.institution.and.multiple.blobs.length) {\n            this.institution.and.multiple.blobs = this.name.and.multiple.blobs;\n        }\n    }\n\n    this.variable_offset = {};\n    if (this.family) {\n        this.family_decor = CSL.Util.cloneToken(this.family);\n        this.family_decor.strings.prefix = \"\";\n        this.family_decor.strings.suffix = \"\";\n        // Sets text-case value (text-case=\"title\" is suppressed for items\n        // non-English with non-English value in Item.language)\n        for (i = 0, ilen = this.family.execs.length; i < ilen; i += 1) {\n            this.family.execs[i].call(this.family_decor, this.state, this.Item);\n        }\n    } else {\n        this.family_decor = false;\n    }\n\n    if (this.given) {\n        this.given_decor = CSL.Util.cloneToken(this.given);\n        this.given_decor.strings.prefix = \"\";\n        this.given_decor.strings.suffix = \"\";\n        // Sets text-case value (text-case=\"title\" is suppressed for items\n        // non-English with non-English value in Item.language)\n        for (i = 0, ilen = this.given.execs.length; i < ilen; i += 1) {\n            this.given.execs[i].call(this.given_decor, this.state, this.Item);\n        }\n    } else {\n        this.given_decor = false;\n    }\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(2)\");\n    }\n    //SNIP-END\n    // util_names_etalconfig.js\n    this.getEtAlConfig();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(3)\");\n    }\n    //SNIP-END\n    // util_names_divide.js\n    this.divideAndTransliterateNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(4)\");\n    }\n    //SNIP-END\n    // util_names_truncate.js\n\n    this.truncatePersonalNameLists();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(5)\");\n    }\n    //SNIP-END\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(6)\");\n    }\n    //SNIP-END\n    // util_names_disambig.js\n    this.disambigNames();\n\n    // util_names_constraints.js\n    this.constrainNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(7)\");\n    }\n    //SNIP-END\n    // form=\"count\"\n    if (this.name.strings.form === \"count\") {\n        if (this.state.tmp.extension || this.names_count != 0) {\n            this.state.output.append(this.names_count, \"empty\");\n            this.state.tmp.group_context.tip.variable_success = true;\n        }\n        return;\n    }\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(8)\");\n    }\n    //SNIP-END\n    this.setEtAlParameters();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(9)\");\n    }\n    //SNIP-END\n    this.setCommonTerm(this.requireMatch);\n    //SNIP-START\n    if (this.debug) {\n        print(\"(10)\");\n    }\n    //SNIP-END\n    this.renderAllNames();\n    //SNIP-START\n    if (this.debug) {\n        print(\"(11)\");\n    }\n    //SNIP-END\n    var blob_list = [];\n    for (i = 0, ilen = variables.length; i < ilen; i += 1) {\n        var v = variables[i];\n        var institution_sets = [];\n        var institutions = false;\n        var varblob = null;\n        if (!this.state.opt.development_extensions.spoof_institutional_affiliations) {\n            varblob = this._join([this.freeters[v]], \"\");\n        } else {\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11a)\");\n            }\n            //SNIP-END\n            for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n                institution_sets.push(this.joinPersonsAndInstitutions([this.persons[v][j], this.institutions[v][j]]));\n            }\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11b)\");\n            }\n            //SNIP-END\n            if (this.institutions[v].length) {\n                var pos = this.nameset_base + this.variable_offset[v];\n                if (this.freeters[v].length) {\n                    pos += 1;\n                }\n                institutions = this.joinInstitutionSets(institution_sets, pos);\n            }\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11c)\");\n            }\n            //SNIP-END\n            var varblob = this.joinFreetersAndInstitutionSets([this.freeters[v], institutions]);\n            //SNIP-START\n            if (this.debug) {\n                print(\"(11d)\");\n            }\n            //SNIP-END\n        }\n        if (varblob) {\n            // Apply labels, if any\n            if (!this.state.tmp.extension) {\n                varblob = this._applyLabels(varblob, v);\n            }\n            blob_list.push(varblob);\n        }\n        //SNIP-START\n        if (this.debug) {\n            print(\"(11e)\");\n        }\n        //SNIP-END\n        if (this.common_term) {\n            break;\n        }\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(12)\");\n    }\n    //SNIP-END\n    this.state.output.openLevel(\"empty\");\n    this.state.output.current.value().strings.delimiter = this.state.inheritOpt(this.names, \"delimiter\", \"names-delimiter\");\n    //SNIP-START\n    if (this.debug) {\n        print(\"(13)\");\n    }\n    //SNIP-END\n    for (i = 0, ilen = blob_list.length; i < ilen; i += 1) {\n        // notSerious\n        this.state.output.append(blob_list[i], \"literal\", true);\n    }\n    if (!this.state.tmp.just_looking && blob_list.length > 0) {\n        this.state.tmp.probably_rendered_something = true;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(14)\");\n    }\n    //SNIP-END\n    this.state.output.closeLevel(\"empty\");\n    //SNIP-START\n    if (this.debug) {\n        print(\"(15)\");\n    }\n    //SNIP-END\n    var blob = this.state.output.pop();\n    this.state.tmp.name_node.top = blob;\n    //SNIP-START\n    if (this.debug) {\n        print(\"(16)\");\n    }\n    //SNIP-END\n\n    // Append will drop the names on the floor here if suppress-me is\n    // set on element_trace.\n    // Need to rescue the value for collapse comparison.\n    var namesToken = CSL.Util.cloneToken(this.names);\n    if (this.state.tmp.group_context.tip.condition) {\n        CSL.UPDATE_GROUP_CONTEXT_CONDITION(this.state, this.names.strings.prefix, null, this.names);\n    }\n    this.state.output.append(blob, namesToken);\n    if (this.state.tmp.term_predecessor_name) {\n        this.state.tmp.term_predecessor = true;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"(17)\");\n    }\n    //SNIP-END\n    // Also used in CSL.Util.substituteEnd (which could do with\n    // some cleanup at this writing).\n    //SNIP-START\n    if (this.debug) {\n        print(\"(18)\");\n    }\n    //SNIP-END\n    if (variables[0] !== \"authority\") {\n        // Just grab the string values in the name\n        var name_node_string = [];\n        var nameobjs = this.Item[variables[0]];\n        if (nameobjs) {\n            for (var i = 0, ilen = nameobjs.length; i < ilen; i += 1) {\n                var substring = CSL.Util.Names.getRawName(nameobjs[i]);\n                if (substring) {\n                    name_node_string.push(substring);\n                }\n            }\n        }\n        name_node_string = name_node_string.join(\", \");\n        if (name_node_string) {\n            this.state.tmp.name_node.string = name_node_string;\n        }\n    }\n    // for classic support\n    // This may be more convoluted than it needs to be. Or maybe not.\n    //\n    // Check for classic abbreviation\n    //\n    // If found, then (1) suppress title rendering, (2) replace the node\n    // with the abbreviation output [and (3) do not run this._collapseAuthor() ?]\n    if (this.state.tmp.name_node.string && !this.state.tmp.first_name_string) {\n        this.state.tmp.first_name_string = this.state.tmp.name_node.string;\n    }\n    if (\"classic\" === this.Item.type) {\n        if (this.state.tmp.first_name_string) {\n            var author_title = [];\n            author_title.push(this.state.tmp.first_name_string);\n            if (this.Item.title) {\n                author_title.push(this.Item.title);\n            }\n            author_title = author_title.join(\", \");\n            if (author_title && this.state.sys.getAbbreviation) {\n                if (this.state.sys.normalizeAbbrevsKey) {\n                    author_title = this.state.sys.normalizeAbbrevsKey(\"classic\", author_title);\n                }\n                this.state.transform.loadAbbreviation(\"default\", \"classic\", author_title, this.Item.language);\n                if (this.state.transform.abbrevs[\"default\"].classic[author_title]) {\n                    this.state.tmp.done_vars.push(\"title\");\n                    this.state.output.append(this.state.transform.abbrevs[\"default\"].classic[author_title], \"empty\", true);\n                    blob = this.state.output.pop();\n\t\t\t\t    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.top.blobs.push(blob);\n                }\n            }\n        }\n    }\n\n    // Let's try something clever here.\n    this._collapseAuthor();\n\n    // For name_SubstituteOnNamesSpanNamesSpanFail\n    this.variables = [];\n    \n    // Reset stop-last after rendering\n    this.state.tmp.authority_stop_last = 0;\n\n    //SNIP-START\n    if (this.debug) {\n        print(\"(19)\");\n    }\n    //SNIP-END\n};\n\nCSL.NameOutput.prototype._applyLabels = function (blob, v) {\n    var txt;\n    if (!this.label || !this.label[this.labelVariable]) {\n        return blob;\n    }\n    var plural = 0;\n    var num = this.freeters_count[v] + this.institutions_count[v];\n    if (num > 1) {\n        plural = 1;\n    } else {\n        for (var i = 0, ilen = this.persons[v].length; i < ilen; i += 1) {\n            num += this.persons_count[v][i];\n        }\n        if (num > 1) {\n            plural = 1;\n        }\n    }\n    // Some code duplication here, should be factored out.\n    if (this.label[this.labelVariable].before) {\n        if (\"number\" === typeof this.label[this.labelVariable].before.strings.plural) {\n            plural = this.label[this.labelVariable].before.strings.plural;\n        }\n        txt = this._buildLabel(v, plural, \"before\", this.labelVariable);\n        this.state.output.openLevel(\"empty\");\n        this.state.output.append(txt, this.label[this.labelVariable].before, true);\n        this.state.output.append(blob, \"literal\", true);\n        this.state.output.closeLevel(\"empty\");\n        blob = this.state.output.pop();\n    } else if (this.label[this.labelVariable].after) {\n        if (\"number\" === typeof this.label[this.labelVariable].after.strings.plural) {\n            plural = this.label[this.labelVariable].after.strings.plural;\n        }\n        txt = this._buildLabel(v, plural, \"after\", this.labelVariable);\n        this.state.output.openLevel(\"empty\");\n        this.state.output.append(blob, \"literal\", true);\n        this.state.output.append(txt, this.label[this.labelVariable].after, true);\n        this.state.tmp.label_blob = this.state.output.pop();\n        this.state.output.append(this.state.tmp.label_blob,\"literal\",true);\n        this.state.output.closeLevel(\"empty\");\n        blob = this.state.output.pop();\n    }\n    return blob;\n};\n\nCSL.NameOutput.prototype._buildLabel = function (term, plural, position, v) {\n    if (this.common_term) {\n        term = this.common_term;\n    }\n\n    var ret = false;\n    var node = this.label[v][position];\n    if (node) {\n        ret = CSL.castLabel(this.state, node, term, plural, CSL.TOLERANT);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype._collapseAuthor = function () {\n    var myqueue, mystr, oldchars;\n    // collapse can be undefined, an array of length zero, and probably\n    // other things ... ugh.\n    if (this.state.tmp.name_node.top.blobs.length === 0) {\n        return;\n    }\n    if (this.nameset_base === 0 && this.Item[this.variables[0]] && !this._first_creator_variable) {\n        this._first_creator_variable = this.variables[0];\n    }\n    if ((this.state[this.state.tmp.area].opt.collapse\n            && this.state[this.state.tmp.area].opt.collapse.length)\n        || (this.state[this.state.tmp.area].opt.cite_group_delimiter \n            && this.state[this.state.tmp.area].opt.cite_group_delimiter.length)) {\n\n        if (this.state.tmp.authorstring_request) {\n            // Avoid running this on every call to getAmbiguousCite()?\n            mystr = \"\";\n            myqueue = this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;\n            oldchars = this.state.tmp.offset_characters;\n            if (myqueue) {\n                mystr = this.state.output.string(this.state, myqueue, false);\n            }\n            // Avoid side-effects on character counting: we're only interested\n            // in the final rendering.\n            this.state.tmp.offset_characters = oldchars;\n            this.state.registry.authorstrings[this.Item.id] = mystr;\n        } else if (!this.state.tmp.just_looking\n                   && !this.state.tmp.suppress_decorations && ((this.state[this.state.tmp.area].opt.collapse && this.state[this.state.tmp.area].opt.collapse.length) || this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter)) {\n            // XX1 print(\"RENDER: \"+this.Item.id);\n            mystr = \"\";\n            myqueue = this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs;\n            oldchars = this.state.tmp.offset_characters;\n            if (myqueue) {\n                mystr = this.state.output.string(this.state, myqueue, false);\n            }\n            if (mystr === this.state.tmp.last_primary_names_string) {\n                if (this.item[\"suppress-author\"] || (this.state[this.state.tmp.area].opt.collapse && this.state[this.state.tmp.area].opt.collapse.length)) {\n                    // XX1 print(\"    CUT!\");\n                    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.children = [];\n                    // If popped, avoid side-effects on character counting: we're only interested\n                    // in things that actually render.\n                    this.state.tmp.offset_characters = oldchars;\n                }\n                // Needed\n                if (this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter) {\n                    this.state.tmp.use_cite_group_delimiter = true;\n                }\n            } else {\n                // XX1 print(\"remembering: \"+mystr);\n                this.state.tmp.last_primary_names_string = mystr;\n                // XXXXX A little more precision would be nice.\n                // This will clobber variable=\"author editor\" as well as variable=\"author\".\n\n                if (this.variables.indexOf(this._first_creator_variable) > -1 && this.item && this.item[\"suppress-author\"] && this.Item.type !== \"legal_case\") {\n                    this.state.tmp.name_node.top.blobs.pop();\n                    this.state.tmp.name_node.children = [];\n                    // If popped, avoid side-effects on character counting: we're only interested\n                    // in things that actually render.\n                    this.state.tmp.offset_characters = oldchars;\n\n                    // A wild guess, but will usually be correct\n                    this.state.tmp.term_predecessor = false;\n                }\n                // Arcane and probably unnecessarily complicated?\n                this.state.tmp.have_collapsed = false;\n                // Needed\n                if (this.state[this.state.tmp.area].opt.cite_group_delimiter && this.state[this.state.tmp.area].opt.cite_group_delimiter) {\n                    this.state.tmp.use_cite_group_delimiter = false;\n                }\n            }\n        }\n    }\n};\n\n/*\nCSL.NameOutput.prototype.suppressNames = function() {\n    suppress_condition = suppress_min && display_names.length >= suppress_min;\n    if (suppress_condition) {\n        continue;\n    }\n}\n*/\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.isPerson = function (value) {\n    if (value.literal\n        || (!value.given && value.family && value.isInstitution)) {\n        \n        return false;\n    } else {\n        return true;\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.truncatePersonalNameLists = function () {\n    var v, i, ilen, j, jlen, chopvar, values;\n    // XXX Before truncation, make a note of the original number\n    // of names, for use in et-al evaluation.\n    this.freeters_count = {};\n    this.persons_count = {};\n    this.institutions_count = {};\n    // By key is okay here, as we don't care about sequence.\n    for (v in this.freeters) {\n        if (this.freeters.hasOwnProperty(v)) {\n            this.freeters_count[v] = this.freeters[v].length;\n            this.freeters[v] = this._truncateNameList(this.freeters, v);\n        }\n    }\n\n    for (v in this.persons) {\n        if (this.persons.hasOwnProperty(v)) {\n            this.institutions_count[v] = this.institutions[v].length;\n            this._truncateNameList(this.institutions, v);\n            this.persons[v] = this.persons[v].slice(0, this.institutions[v].length);\n            this.persons_count[v] = [];\n            for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                this.persons_count[v][j] = this.persons[v][j].length;\n                this.persons[v][j] = this._truncateNameList(this.persons, v, j);\n            }\n        }\n    }\n    if (this.state.opt.development_extensions.etal_min_etal_usefirst_hack\n        && this.etal_min === 1 && this.etal_use_first === 1 \n        && !(this.state.tmp.extension\n             || this.state.tmp.just_looking)) {\n        chopvar = v;\n    } else {\n        chopvar = false;\n    }\n    if (chopvar || this._please_chop) {\n        for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n            v = this.variables[i];\n            if (this.freeters[v].length) {\n                if (this._please_chop === v) {\n                    this.freeters[v] = this.freeters[v].slice(1);\n                    this.freeters_count[v] += -1;\n                    this._please_chop = false;\n                } else if (chopvar && !this._please_chop) {\n                    this.freeters[v] = this.freeters[v].slice(0, 1);\n                    this.freeters_count[v] = 1;\n                    this.institutions[v] = [];\n                    this.persons[v] = [];\n                    this._please_chop = chopvar;\n                }\n            }\n            for (var j=0,jlen = this.persons[v].length;j<jlen;j++) {\n                if (this.persons[v][j].length) {\n                    if (this._please_chop === v) {\n                        this.persons[v][j] = this.persons[v][j].slice(1);\n                        this.persons_count[v][j] += -1;\n                        this._please_chop = false;\n                        break;\n                    } else if (chopvar && !this._please_chop) {\n                        this.freeters[v] = this.persons[v][j].slice(0, 1);\n                        this.freeters_count[v] = 1;\n                        this.institutions[v] = [];\n                        this.persons[v] = [];\n                        values = [];\n                        this._please_chop = chopvar;\n                        break;\n                    }\n                }\n            }\n            if (this.institutions[v].length) {\n                if (this._please_chop === v) {\n                    this.institutions[v] = this.institutions[v].slice(1);\n                    this.institutions_count[v] += -1;\n                    this._please_chop = false;\n                } else if (chopvar && !this._please_chop) {\n                    this.institutions[v] = this.institutions[v].slice(0, 1);\n                    this.institutions_count[v] = 1;\n                    values = [];\n                    this._please_chop = chopvar;\n                }\n            }\n        }\n    }\n\n    // Transliteration and abbreviation mapping\n\n    // Hmm. This could produce three lists for each nameset:\n    //   - primary (transformed in place)\n    //   - secondary\n    //   - tertiary\n    // with items that produce no result in the secondary and tertiary\n    // transforms set to false. Maybe.\n\n    // Actually that would be insane, so forget it.\n    // What we need is to add suitable parameters to getName(), and merge\n    // the single-name-level operations below into that function. Then the\n    // operation can be applied in util_names_render.js, and the logic\n    // becomes very similar to what we already have running in util_transform.js.\n\n/*\n    for (v in this.freeters) {\n        this._transformNameset(this.freeters[v]);\n    }\n    for (v in this.persons) {\n        for (i = 0, ilen = this.persons[v].length; i < ilen; i += 1) {\n            this._transformNameset(this.persons[v][i]);\n        }\n        this._transformNameset(this.institutions[v]);\n    }\n*/\n\n    // Could also be factored out to a separate function for clarity.\n    // ???? XXX Does this belong?\n    for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        if (this.institutions[v].length) {\n            this.nameset_offset += 1;\n        }\n        for (var j=0,jlen=this.persons[v].length;j<jlen;j++) {\n            if (this.persons[v][j].length) {\n                this.nameset_offset += 1;\n            }\n            // this.institutions[v][i] = this._splitInstitution(this.institutions[v][i], v, i);\n        }\n    }\n};\n\nCSL.NameOutput.prototype._truncateNameList = function (container, variable, index) {\n    var lst;\n    if (\"undefined\" === typeof index) {\n        lst = container[variable];\n    } else {\n        lst = container[variable][index];\n    }\n    if (this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names \n        && lst.length > 50 \n        && lst.length > (this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names + 2)) {\n\n        // Preserve the last name in the list, in case we're rendering with a PI ellipsis (et-al-use-last)\n        var limit = this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names;\n        lst = lst.slice(0, limit+1).concat(lst.slice(-1));\n    }\n    return lst;\n};\n\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.divideAndTransliterateNames = function () {\n    var i, ilen, j, jlen;\n    var Item = this.Item;\n    var variables = this.variables;\n    this.varnames = variables.slice();\n    this.freeters = {};\n    this.persons = {};\n    this.institutions = {};\n    for (i = 0, ilen = variables.length; i < ilen; i += 1) {\n        var v = variables[i];\n        this.variable_offset[v] = this.nameset_offset;\n        var values = this._normalizeVariableValue(Item, v);\n        if (this.name.strings[\"suppress-min\"] && values.length >= this.name.strings[\"suppress-min\"]) {\n            values = [];\n        }\n        if (this.name.strings[\"suppress-max\"] && values.length <= this.name.strings[\"suppress-max\"]) {\n            values = [];\n        }\n        this._getFreeters(v, values);\n        this._getPersonsAndInstitutions(v, values);\n        if (this.state.opt.development_extensions.spoof_institutional_affiliations) {\n            if (this.name.strings[\"suppress-min\"] === 0) {\n                this.freeters[v] = [];\n                for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                    this.persons[v][j] = [];\n                }\n            } else if (this.institution.strings[\"suppress-min\"] === 0) {\n                this.institutions[v] = [];\n                this.freeters[v] = this.freeters[v].concat(this.persons[v]);\n                for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n                    for (var k = 0, klen = this.persons[v][j].length; k < klen; k += 1) {\n                        this.freeters[v].push(this.persons[v][j][k]);\n                    }\n                }\n                this.persons[v] = [];\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._normalizeVariableValue = function (Item, variable) {\n    var names;\n    if (\"string\" === typeof Item[variable] || \"number\" === typeof Item[variable]) {\n        CSL.debug(\"name variable \\\"\" + variable + \"\\\" is string or number, not array. Attempting to fix.\");\n        names = [{literal: Item[variable] + \"\"}];\n    } else if (!Item[variable]) {\n        names = [];\n    } else if (\"number\" !== typeof Item[variable].length) {\n        CSL.debug(\"name variable \\\"\" + variable + \"\\\" is object, not array. Attempting to fix.\");\n        Item[variable] = [Item[variable]];\n        names = Item[variable].slice();\n    } else {\n        names = Item[variable].slice();\n    }\n    return names;\n};\n\nCSL.NameOutput.prototype._getFreeters = function (v, values) {\n    this.freeters[v] = [];\n    if (this.state.opt.development_extensions.spoof_institutional_affiliations) {\n        for (var i=values.length-1;i>-1;i--) {\n            if (this.isPerson(values[i])) {\n                var value = this._checkNickname(values.pop());\n                if (value) {\n                    this.freeters[v].push(value);\n                }\n            } else {\n                break;\n            }\n        }\n    } else {\n        for (var i=values.length-1;i>-1;i--) {\n            var value = values.pop();\n            if (this.isPerson(value)) {\n                var value = this._checkNickname(value);\n            }\n            this.freeters[v].push(value);\n        }\n    }\n    this.freeters[v].reverse();\n    if (this.freeters[v].length) {\n        this.nameset_offset += 1;\n    }\n};\n\nCSL.NameOutput.prototype._getPersonsAndInstitutions = function (v, values) {\n    this.persons[v] = [];\n    this.institutions[v] = [];\n    if (!this.state.opt.development_extensions.spoof_institutional_affiliations) {\n        return;\n    }\n    var persons = [];\n    var has_affiliates = false;\n    var first = true;\n    for (var i = values.length - 1; i > -1; i += -1) {\n        if (this.isPerson(values[i])) {\n            var value = this._checkNickname(values[i]);\n            if (value) {\n                persons.push(value);\n            }\n        } else {\n            has_affiliates = true;\n            this.institutions[v].push(values[i]);\n            if (!first) {\n                persons.reverse();\n                this.persons[v].push(persons);\n                persons = [];\n            }\n            first = false;\n        }\n    }\n    if (has_affiliates) {\n        persons.reverse();\n        this.persons[v].push(persons);\n        this.persons[v].reverse();\n        this.institutions[v].reverse();\n    }\n};\n\nCSL.NameOutput.prototype._clearValues = function (values) {\n    for (var i = values.length - 1; i > -1; i += -1) {\n        values.pop();\n    }\n};\n\nCSL.NameOutput.prototype._checkNickname = function (name) {\n    if ([\"interview\", \"personal_communication\"].indexOf(this.Item.type) > -1) {\n        var author = \"\";\n        author = CSL.Util.Names.getRawName(name);\n        if (author && this.state.sys.getAbbreviation && !(this.item && this.item[\"suppress-author\"])) {\n            var normalizedKey = author;\n            if (this.state.sys.normalizeAbbrevsKey) {\n                // The first argument does not have to be the exact variable name.\n                normalizedKey = this.state.sys.normalizeAbbrevsKey(\"author\", author);\n            }\n            this.state.transform.loadAbbreviation(\"default\", \"nickname\", normalizedKey, this.Item.language);\n            // XXX Why does this have to happen here?\n            var myLocalName = this.state.transform.abbrevs[\"default\"].nickname[normalizedKey];\n            if (myLocalName) {\n                if (myLocalName === \"!here>>>\") {\n                    name = false;\n                } else {\n                    name = {family:myLocalName,given:''};\n                }\n            }\n        }\n    }\n    return name;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype._purgeEmptyBlobs = function (blobs) {\n    for (var i = blobs.length - 1; i > -1; i += -1) {\n        if (!blobs[i] || blobs[i].length === 0 || !blobs[i].blobs.length) {\n            blobs = blobs.slice(0, i).concat(blobs.slice(i + 1));\n        }\n    }\n    return blobs;\n};\n\nCSL.NameOutput.prototype.joinPersons = function (blobs, pos, j, tokenname) {\n    var ret;\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (!tokenname) {\n        tokenname = \"name\";\n    }\n    if (\"undefined\" === typeof j) {\n        if (this.etal_spec[pos].freeters === 1) {\n           ret = this._joinEtAl(blobs);\n        } else if (this.etal_spec[pos].freeters === 2) {\n            ret = this._joinEllipsis(blobs);\n        } else if (!this.state.tmp.sort_key_flag) {\n            ret = this._joinAnd(blobs);\n        } else {\n            ret = this._join(blobs, this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \"));\n        }\n    } else {\n        if (this.etal_spec[pos].persons[j] === 1) {\n            ret = this._joinEtAl(blobs);\n        } else if (this.etal_spec[pos].persons[j] === 2) {\n            ret = this._joinEllipsis(blobs);\n        } else if (!this.state.tmp.sort_key_flag) {\n            ret = this._joinAnd(blobs);\n        } else {\n            ret = this._join(blobs, this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \"));\n        }\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.joinInstitutionSets = function (blobs, pos) {\n    var ret;\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (this.etal_spec[pos].institutions === 1) {\n        ret = this._joinEtAl(blobs, \"institution\");\n    } else if (this.etal_spec[pos].institutions === 2) {\n        ret = this._joinEllipsis(blobs, \"institution\");\n    } else {\n        ret = this._joinAnd(blobs);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.joinPersonsAndInstitutions = function (blobs) {\n    //\n    blobs = this._purgeEmptyBlobs(blobs);\n    var ret = this._join(blobs, this.state.tmp.name_delimiter);\n    ret.isInstitution = true;\n    return ret;\n};\n\n// LEGACY\n// This should go away eventually\nCSL.NameOutput.prototype.joinFreetersAndInstitutionSets = function (blobs) {\n    // Nothing, one or two, never more\n    blobs = this._purgeEmptyBlobs(blobs);\n    var ret = this._join(blobs, \"[never here]\", this[\"with\"].single, this[\"with\"].multiple);\n    //var ret = this._join(blobs, \"\");\n    return ret;\n};\n\nCSL.NameOutput.prototype._getAfterInvertedName = function(blobs, delimiter, finalJoin) {\n    if (finalJoin && blobs.length > 1) {\n        if (this.state.inheritOpt(this.name, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n            var prevBlob = blobs[blobs.length - 2];\n            if (prevBlob.blobs.length > 0 && prevBlob.blobs[0].isInverted) {\n                finalJoin.strings.prefix = delimiter;\n            }\n        }\n    }\n    return finalJoin;\n}\n\nCSL.NameOutput.prototype._getAndJoin = function (blobs, delimiter) {\n    var finalJoin = false;\n    if (blobs.length > 1) {\n        var singleOrMultiple = \"single\";\n        if (blobs.length > 2) {\n            singleOrMultiple = \"multiple\";\n        }\n        if (blobs[blobs.length - 1].isInstitution) {\n            finalJoin = this.institution.and[singleOrMultiple];\n        } else {\n            finalJoin = this.name.and[singleOrMultiple];\n        }\n        // finalJoin = new CSL.Blob(finalJoin);\n        finalJoin = JSON.parse(JSON.stringify(finalJoin));\n        finalJoin = this._getAfterInvertedName(blobs, delimiter, finalJoin);\n    }\n    return finalJoin;\n};\n\nCSL.NameOutput.prototype._joinEtAl = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var blob = this._join(blobs, delimiter);\n    \n    // notSerious\n    this.state.output.openLevel(this._getToken(\"name\"));\n    // Delimiter is applied from separately saved source in this case,\n    // for discriminate application of single and multiple joins.\n    this.state.output.current.value().strings.delimiter = \"\";\n    this.state.output.append(blob, \"literal\", true);\n    if (blobs.length > 1) {\n        this.state.output.append(this[\"et-al\"].multiple, \"literal\", true);\n    } else if (blobs.length === 1) {\n        this.state.output.append(this[\"et-al\"].single, \"literal\", true);\n    }\n    this.state.output.closeLevel();\n    return this.state.output.pop();\n};\n\n\nCSL.NameOutput.prototype._joinEllipsis = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var finalJoin = false;\n    if (blobs.length > 1) {\n        var singleOrMultiple = \"single\";\n        if (blobs.length > 2) {\n            singleOrMultiple = \"multiple\";\n        }\n        finalJoin = JSON.parse(JSON.stringify(this.name.ellipsis[singleOrMultiple]));\n        finalJoin = this._getAfterInvertedName(blobs, delimiter , finalJoin);\n        \n    }\n    return this._join(blobs, delimiter, finalJoin);\n};\n\nCSL.NameOutput.prototype._joinAnd = function (blobs) {\n    var delimiter = this.state.inheritOpt(this.name, \"delimiter\", \"name-delimiter\", \", \");\n    var finalJoin = this._getAndJoin(blobs, delimiter);\n    return this._join(blobs, delimiter, finalJoin);\n};\n\n\nCSL.NameOutput.prototype._join = function (blobs, delimiter, finalJoin) {\n    var i, ilen;\n    if (!blobs) {\n        return false;\n    }\n    blobs = this._purgeEmptyBlobs(blobs);\n    if (!blobs.length) {\n        return false;\n    }\n    if (blobs.length > 1) {\n        if (blobs.length === 2) {\n            if (!finalJoin) {\n                blobs[0].strings.suffix += delimiter;\n            } else {\n                blobs = [blobs[0], finalJoin, blobs[1]];\n            }\n        } else {\n            var offset;\n            if (finalJoin) {\n                offset = 1;\n            } else {\n                offset = 0;\n            }\n            var blob = blobs.pop();\n            for (var i=0,ilen=blobs.length - offset;i<ilen;i++) {\n                blobs[i].strings.suffix += delimiter;\n            }\n            blobs.push(finalJoin);\n            blobs.push(blob);\n        }\n    }\n\n    //this.state.output.openLevel(this._getToken(tokenname));\n    this.state.output.openLevel();\n\n    //this.state.output.openLevel(this._getToken(\"empty\"));\n    // Delimiter is applied from separately saved source in this case,\n    // for discriminate application of single and multiple joins.\n    for (i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        this.state.output.append(blobs[i], false, true);\n    }\n    this.state.output.closeLevel();\n    return this.state.output.pop();\n};\n\n\nCSL.NameOutput.prototype._getToken = function (tokenname) {\n    var token = this[tokenname];\n    if (tokenname === \"institution\") {\n        var newtoken = new CSL.Token();\n        // Which, hmm, is the same thing as \"empty\"\n        // Oh, well.\n        //newtoken.strings.prefix = token.prefix;\n        //newtoken.strings.suffix = token.suffix;\n        return newtoken;\n    }\n    return token;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.checkCommonAuthor = function(requireMatch) {\n    if (!requireMatch) {\n        return false;\n    }\n    var common_term = false;\n    if (this.variables.length === 2) {\n        var variables = this.variables;\n        var varnames = variables.slice();\n        varnames.sort();\n        common_term = varnames.join(\"\");\n    }\n    if (!common_term) {\n        return false;\n    }\n    var has_term = false;\n    if (this.state.locale[this.state.opt.lang].terms[common_term]) {\n        has_term = true;\n    }\n    if (!has_term) {\n        this.state.tmp.done_vars.push(this.variables[0]);\n        this.state.tmp.done_vars.push(this.variables[1]);\n        return false;\n    }\n    var firstSet = this.Item[this.variables[0]];\n    var secondSet = this.Item[this.variables[1]];\n    var perfectMatch = this._compareNamesets(firstSet, secondSet);\n    if (perfectMatch === true) {\n        this.state.tmp.done_vars.push(this.variables[0]);\n        this.state.tmp.done_vars.push(this.variables[1]);\n    }\n    // This may be counter-intuitive.\n    // This check controls whether we will fail on the this attempt at rendering\n    // and proceed with substitution. If the names match exactly (true), then\n    // we do *not* want to abort and continue with substitution.\n    return !perfectMatch;\n};\n\nCSL.NameOutput.prototype.setCommonTerm = function () {\n    var variables = this.variables;\n    var varnames = variables.slice();\n    varnames.sort();\n    this.common_term = varnames.join(\"\");\n    // When no varnames are on offer\n    if (!this.common_term) {\n        return;\n    }\n    var has_term = false;\n    if (this.label && this.label[this.variables[0]]) {\n        if (this.label[this.variables[0]].before) {\n            has_term = this.state.getTerm(this.common_term, this.label[this.variables[0]].before.strings.form, 0);\n        } else if (this.label[this.variables[0]].after) {\n            has_term = this.state.getTerm(this.common_term, this.label[this.variables[0]].after.strings.form, 0);\n        }\n     }\n\n    // When there is no common term\n    if (!this.state.locale[this.state.opt.lang].terms[this.common_term]\n        || !has_term\n        || this.variables.length < 2) {\n        this.common_term = false;\n        return;\n    }\n    var freeters_offset = 0;\n    for (var i = 0, ilen = this.variables.length - 1; i < ilen; i += 1) {\n        var v = this.variables[i];\n        var vv = this.variables[i + 1];\n        if (this.freeters[v].length || this.freeters[vv].length) {\n            if (this.etal_spec[v].freeters !== this.etal_spec[vv].freeters\n                || !this._compareNamesets(this.freeters[v], this.freeters[vv])) {\n                this.common_term = false;\n                return;\n            }\n            freeters_offset += 1;\n        }\n        if (this.persons[v].length !== this.persons[vv].length) {\n            this.common_term = false;\n            return;\n        }\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (this.etal_spec[v].persons[j] !== this.etal_spec[vv].persons[j]\n                || !this._compareNamesets(this.persons[v][j], this.persons[vv][j])) {\n                this.common_term = false;\n                return;\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._compareNamesets = function (base_nameset, nameset) {\n    if (!base_nameset || !nameset || base_nameset.length !== nameset.length) {\n        return false;\n    }\n    for (var i = 0, ilen = nameset.length; i < ilen; i += 1) {\n        for (var j = 0, jlen = CSL.NAME_PARTS.length; j < jlen; j += 1) {\n            var part = CSL.NAME_PARTS[j];\n            if (!base_nameset[i] || base_nameset[i][part] != nameset[i][part]) {\n                return false;\n            }\n        }\n    }\n    return true;\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.constrainNames = function () {\n    // figure out how many names to include, in light of the disambig params\n    //\n    this.names_count = 0;\n    //var pos = 0;\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        pos = this.nameset_base + i;\n        // Constrain independent authors here\n        if (this.freeters[v].length) {\n            this.state.tmp.names_max.push(this.freeters[v].length, \"literal\");\n            this._imposeNameConstraints(this.freeters, this.freeters_count, v, pos);\n            this.names_count += this.freeters[v].length;\n        }\n\n        // Constrain institutions here\n        if (this.institutions[v].length) {\n            this.state.tmp.names_max.push(this.institutions[v].length, \"literal\");\n            this._imposeNameConstraints(this.institutions, this.institutions_count, v, pos);\n            this.persons[v] = this.persons[v].slice(0, this.institutions[v].length);\n            this.names_count += this.institutions[v].length;\n        }\n\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            // Constrain affiliated authors here\n            if (this.persons[v][j].length) {\n                this.state.tmp.names_max.push(this.persons[v][j].length, \"literal\");\n                this._imposeNameConstraints(this.persons[v], this.persons_count[v], j, pos);\n                this.names_count += this.persons[v][j].length;\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._imposeNameConstraints = function (lst, count, key, pos) {\n    // display_names starts as the original length of this list of names.\n    var display_names = lst[key];\n    var discretionary_names_length = this.state.tmp[\"et-al-min\"];\n    \n    // Mappings, to allow existing disambiguation machinery to\n    // remain untouched.\n    if (this.state.tmp.suppress_decorations) {\n        if (this.state.tmp.disambig_request && this.state.tmp.disambig_request.names[pos]) {\n            // Oh. Trouble.\n            // state.tmp.nameset_counter is the number of the nameset\n            // in the disambiguation try-sequence. Ouch.\n            discretionary_names_length = this.state.tmp.disambig_request.names[pos];\n        } else if (count[key] >= this.etal_min) {\n            discretionary_names_length = this.etal_use_first;\n        }\n    } else {\n        if (this.state.tmp.disambig_request \n            && this.state.tmp.disambig_request.names[pos] > this.etal_use_first) {\n\n            if (count[key] < this.etal_min) {\n                discretionary_names_length = count[key];\n            } else {\n                discretionary_names_length = this.state.tmp.disambig_request.names[pos];\n            }\n        } else if (count[key] >= this.etal_min) {\n            //discretionary_names_length = this.state.tmp[\"et-al-use-first\"];\n            discretionary_names_length = this.etal_use_first;\n        }\n        // XXXX: This is a workaround. Under some conditions.\n        // Where namesets disambiguate on one of the two names\n        // dropped here, it is possible for more than one\n        // in-text citation to be close (and indistinguishable)\n        // matches to a single bibliography entry.\n        //\n        // \n        if (this.etal_use_last && discretionary_names_length > (this.etal_min - 2)) {\n            discretionary_names_length = this.etal_min - 2;\n        }\n    }\n    var sane = this.etal_min >= this.etal_use_first;\n    var overlength = count[key] > discretionary_names_length;\n    // This var is used to control contextual join, and\n    // lies about the number of names when forceEtAl is true,\n    // unless normalized.\n    if (discretionary_names_length > count[key]) {\n\n        // Use actual truncated list length, to avoid overrun.\n        discretionary_names_length = display_names.length;\n    }\n    // forceEtAl is relevant when the author list is\n    // truncated to eliminate clutter.\n    if (sane && overlength) {\n        if (this.etal_use_last) {\n            lst[key] = display_names.slice(0, discretionary_names_length).concat(display_names.slice(-1));\n        } else {\n            lst[key] = display_names.slice(0, discretionary_names_length);\n        }\n    }\n    this.state.tmp.disambig_settings.names[pos] = lst[key].length;\n    this.state.disambiguate.padBase(this.state.tmp.disambig_settings);\n    \n\n    // ???\n    //if (!this.state.tmp.disambig_request) {\n    //    this.state.tmp.disambig_settings.givens[pos] = [];\n    //}\n};\n\n// Disambiguate names (the number of names is controlled externally, by successive\n// runs of the processor).\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.disambigNames = function () {\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        pos = this.nameset_base + i;\n        if (this.freeters[v].length) {\n            this._runDisambigNames(this.freeters[v], pos);\n        }\n        // Is this even necessary???\n        if (this.institutions[v].length) {\n            if (\"undefined\" === typeof this.state.tmp.disambig_settings.givens[pos]) {\n                this.state.tmp.disambig_settings.givens[pos] = [];\n            }\n            for (var j=0,jlen=this.institutions[v].length;j<jlen;j+=1) {\n                if (\"undefined\" === typeof this.state.tmp.disambig_settings.givens[pos][j]) {\n                    this.state.tmp.disambig_settings.givens[pos].push(2);\n                }\n            }\n        }\n        for (var j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (this.persons[v][j].length) {\n                this._runDisambigNames(this.persons[v][j], pos);\n            }\n        }\n    }\n};\n\nCSL.NameOutput.prototype._runDisambigNames = function (lst, pos) {\n    var chk, myform, myinitials, param, i, ilen, paramx;\n    //if (this.state.tmp.root === \"bibliography\") {\n    //    return;\n    //}\n    for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n        //\n        // register the name in the global names disambiguation\n        // registry\n\n        if (!lst[i].given && !lst[i].family) {\n            continue;\n        }\n\n        myinitials = this.state.inheritOpt(this.name, \"initialize-with\");\n        this.state.registry.namereg.addname(\"\" + this.Item.id, lst[i], i);\n        chk = this.state.tmp.disambig_settings.givens[pos];\n        if (\"undefined\" === typeof chk) {\n            // Holes can appear in the list, probably due to institutional\n            // names that this doesn't touch. Maybe. This fills them up.\n            for (var j = 0, jlen = pos + 1; j < jlen; j += 1) {\n                if (!this.state.tmp.disambig_settings.givens[j]) {\n                    this.state.tmp.disambig_settings.givens[j] = [];\n                }\n            }\n        }\n        chk = this.state.tmp.disambig_settings.givens[pos][i];\n        //if (\"undefined\" !== typeof chk && this.state.tmp.root === 'citation') {\n            //this.state.tmp.disambig_settings.givens[pos] = [];\n            //chk = undefined;\n        //}\n        if (\"undefined\" === typeof chk) {\n            myform = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\");\n            param = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n            this.state.tmp.disambig_settings.givens[pos].push(param);\n        }\n        //\n        // set the display mode default for givennames if required\n        myform = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\");\n        paramx = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n        // this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, 0, myform, myinitials);\n        if (this.state.tmp.disambig_request) {\n            //\n            // fix a request for initials that makes no sense.\n            // can't do this in disambig, because the availability\n            // of initials is not a global parameter.\n            var val = this.state.tmp.disambig_settings.givens[pos][i];\n            // This is limited to by-cite disambiguation.\n            // 2012-09-13: added lst[i].given check to condition\n            if (val === 1 && \n                this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\" && \n                (\"undefined\" === typeof this.state.inheritOpt(this.name, \"initialize-with\")\n                 || \"undefined\" === typeof lst[i].given)) {\n                val = 2;\n            }\n            param = val;\n            // 2012-09-13: lst[i].given check protects against personal names\n            // that have no first name element. These were causing an infinite loop,\n            // this prevents that.\n            if (this.state.opt[\"disambiguate-add-givenname\"] && lst[i].given) {\n                param = this.state.registry.namereg.evalname(\"\" + this.Item.id, lst[i], i, param, this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\"), this.state.inheritOpt(this.name, \"initialize-with\"));\n            }\n        } else {\n            //\n            // it clicks.  here is where we will put the\n            // call to the names register, to get the floor value\n            // for an individual name.\n            //\n            param = paramx;\n        }\n        // Need to save off the settings based on subsequent\n        // form, when first cites are rendered.\n        if (!this.state.tmp.just_looking && this.item && this.item.position === CSL.POSITION_FIRST) {\n            if (paramx > param) {\n                param = paramx;\n            }\n        }\n        if (!this.state.tmp.sort_key_flag) {\n            this.state.tmp.disambig_settings.givens[pos][i] = param;\n            if (\"string\" === typeof myinitials\n                && (\"undefined\" === typeof this.name.strings[\"initialize\"]\n                    || true === this.name.strings[\"initialize\"])) {\n\n                this.state.tmp.disambig_settings.use_initials = true;\n            }\n        }\n    }\n    //this.state.registry.registry[this.Item.id].disambig.givens = this.state.tmp.disambig_settings.givens.slice();\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.getEtAlConfig = function () {\n    var item = this.item;\n    this[\"et-al\"] = {};\n\n    this.state.output.append(this.etal_term, this.etal_style, true);\n    this[\"et-al\"].single = this.state.output.pop();\n    this[\"et-al\"].single.strings.suffix = this.etal_suffix;\n    this[\"et-al\"].single.strings.prefix = this.etal_prefix_single;\n    \n    this.state.output.append(this.etal_term, this.etal_style, true);\n    this[\"et-al\"].multiple = this.state.output.pop();\n    this[\"et-al\"].multiple.strings.suffix = this.etal_suffix;\n    this[\"et-al\"].multiple.strings.prefix = this.etal_prefix_multiple;\n\n    // Et-al style parameters (may be sidestepped by disambiguation\n    // in util_names_constraints.js)\n    if (\"undefined\" === typeof item) {\n        item = {};\n    }\n    //print(\"== getEtAlConfig() == \"+this.state.tmp.area);\n\n    if (item.position) {\n        if (this.state.inheritOpt(this.name, \"et-al-subsequent-min\")) {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-subsequent-min\");\n        } else {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-min\");\n        }\n        if (this.state.inheritOpt(this.name, \"et-al-subsequent-use-first\")) {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-subsequent-use-first\");\n        } else {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-use-first\");\n        }\n    } else {\n        if (this.state.tmp[\"et-al-min\"]) {\n            this.etal_min = this.state.tmp[\"et-al-min\"];\n        } else {\n            // XX\n            this.etal_min = this.state.inheritOpt(this.name, \"et-al-min\");\n        }\n        if (this.state.tmp[\"et-al-use-first\"]) {\n            this.etal_use_first = this.state.tmp[\"et-al-use-first\"];\n        } else {\n            // XX\n            this.etal_use_first = this.state.inheritOpt(this.name, \"et-al-use-first\");\n        }\n        if (\"boolean\" === typeof this.state.tmp[\"et-al-use-last\"]) {\n            //print(\"  etal_use_last from tmp: \"+this.state.tmp[\"et-al-use-last\"]);\n            this.etal_use_last = this.state.tmp[\"et-al-use-last\"];\n        } else {\n            //print(\"  etal_use_last from name: \"+this.name.strings[\"et-al-use-last\"]);\n            // XX\n            this.etal_use_last = this.state.inheritOpt(this.name, \"et-al-use-last\");\n        }\n        //print(\"  etal_use_last: \"+this.etal_use_last);\n    }\n    // Provided for use as the starting level for disambiguation.\n    if (!this.state.tmp[\"et-al-min\"]) {\n        this.state.tmp[\"et-al-min\"] = this.etal_min;\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.setEtAlParameters = function () {\n    var i, ilen, j, jlen;\n    for (i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        if (\"undefined\" === typeof this.etal_spec[v]) {\n            this.etal_spec[v] = {freeters:0,institutions:0,persons:[]};\n        }\n        this.etal_spec[this.nameset_base + i] = this.etal_spec[v];\n        if (this.freeters[v].length) {\n            this._setEtAlParameter(\"freeters\", v);\n        }\n        for (j = 0, jlen = this.persons[v].length; j < jlen; j += 1) {\n            if (\"undefined\" === typeof this.etal_spec[v][j]) {\n                this.etal_spec[v].persons[j] = 0;\n            }\n            this._setEtAlParameter(\"persons\", v, j);\n        }\n        if (this.institutions[v].length) {\n            this._setEtAlParameter(\"institutions\", v);\n        }\n    }\n};\n\nCSL.NameOutput.prototype._setEtAlParameter = function (type, v, j) {\n    var lst, count;\n    if (type === \"persons\") {\n        lst = this.persons[v][j];\n        count = this.persons_count[v][j];\n    } else {\n        lst = this[type][v];\n        count = this[type + \"_count\"][v];\n    }\n    if (lst.length < count && !this.state.tmp.sort_key_flag) {\n        if (this.etal_use_last) {\n            if (type === \"persons\") {\n                this.etal_spec[v].persons[j] = 2;\n            } else {\n                this.etal_spec[v][type] = 2;\n            }\n        } else {\n            if (type === \"persons\") {\n                this.etal_spec[v].persons[j] = 1;\n            } else {\n                this.etal_spec[v][type] = 1;\n            }\n        }\n    } else {\n        if (type === \"persons\") {\n            this.etal_spec[v].persons[j] = 0;\n        } else {\n            this.etal_spec[v][type] = 0;\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.NameOutput.prototype.renderAllNames = function () {\n    // Note that et-al/ellipsis parameters are set on the basis\n    // of rendering order through the whole cite.\n    var pos;\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n\n        if (this.freeters[v].length || this.institutions[v].length) {\n            if (!this.state.tmp.group_context.tip.condition) {\n                this.state.tmp.just_did_number = false;\n            }\n        }\n        \n        pos = this.nameset_base + i;\n        if (this.freeters[v].length) {\n            this.freeters[v] = this._renderNames(v, this.freeters[v], pos);\n        }\n        for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n            this.persons[v][j] = this._renderNames(v, this.persons[v][j], pos, j);\n        }\n    }\n    this.renderInstitutionNames();\n};\n\nCSL.NameOutput.prototype.renderInstitutionNames = function () {\n    // Institutions are split to string list as\n    // this.institutions[v][\"long\"] and this.institutions[v][\"short\"]\n    for (var i = 0, ilen = this.variables.length; i < ilen; i += 1) {\n        var v = this.variables[i];\n        for (var j = 0, jlen = this.institutions[v].length; j < jlen; j += 1) {\n            var institution;\n\n            var name = this.institutions[v][j];\n\n            \n\n            // XXX Start here for institutions\n            // Figure out the three segments: primary, secondary, tertiary\n            var j, jlen, localesets;\n            if (this.state.tmp.extension) {\n                localesets = [\"sort\"];\n            } else if (name.isInstitution || name.literal) {\n                // Will never hit this in this function, but preserving\n                // in case we factor this out.\n                localesets = this.state.opt['cite-lang-prefs'].institutions;\n            } else {\n                localesets = this.state.opt['cite-lang-prefs'].persons;\n            }\n\n            var slot = {primary:'locale-orig',secondary:false,tertiary:false};\n\t        if (localesets) {\n\t\t        var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n\t\t        for (var k = 0, klen = slotnames.length; k < klen; k += 1) {\n\t\t\t        if (localesets.length - 1 <  k) {\n\t\t\t\t        break;\n\t\t\t        }\n                    if (localesets[k]) {\n\t\t\t            slot[slotnames[k]] = 'locale-' + localesets[k];\n                    }\n\t\t        }\n\t        } else {\n\t\t        slot.primary = 'locale-translat';\n\t        }\n\t        if (this.state.tmp.area !== \"bibliography\"\n\t\t        && !(this.state.tmp.area === \"citation\"\n\t\t\t         && this.state.opt.xclass === \"note\"\n\t\t\t         && this.item && !this.item.position)) {\n                \n\t\t        slot.secondary = false;\n\t\t        slot.tertiary = false;\n\t        }\n            // Get normalized name object for a start.\n            // true invokes fallback\n            this.setRenderedName(name);\n\n            // XXXX FROM HERE (instututions)\n            var institution = this._renderInstitutionName(v, name, slot, j);\n\n            //this.institutions[v][j] = this._join(institution, \"\");\n            this.institutions[v][j] = institution;\n        }\n    }\n};\n\nCSL.NameOutput.prototype._renderInstitutionName = function (v, name, slot, j) {\n    var secondary, tertiary, long_style, short_style, institution, institution_short, institution_long;\n    var res = this.getName(name, slot.primary, true);\n    var primary = res.name;\n    var usedOrig = res.usedOrig;\n    if (primary) {\n        //print(\"primary, v, j = \"+primary+\", \"+v+\", \"+j);\n        primary = this.fixupInstitution(primary, v, j);\n    }\n\tsecondary = false;\n\tif (slot.secondary) {\n        res = this.getName(name, slot.secondary, false, usedOrig);\n        var secondary = res.name;\n        usedOrig = res.usedOrig;\n        if (secondary) {\n\t\t\tsecondary = this.fixupInstitution(secondary, v, j);\n        }\n\t}\n    //Zotero.debug(\"XXX [2] secondary: \"+secondary[\"long\"].literal+\", slot.secondary: \"+slot.secondary);\n\ttertiary = false;\n\tif (slot.tertiary) {\n        res = this.getName(name, slot.tertiary, false, usedOrig);\n        tertiary = res.name;\n        if (tertiary) {\n\t\t\ttertiary = this.fixupInstitution(tertiary, v, j);\n        }\n\t}\n    var n = {\n        l: {\n            pri: false,\n            sec: false,\n            ter: false\n        },\n        s: {\n            pri: false,\n            sec: false,\n            ter: false\n        }\n    };\n    if (primary) {\n        n.l.pri = primary[\"long\"];\n        n.s.pri = primary[\"short\"].length ? primary[\"short\"] : primary[\"long\"];\n    }\n    if (secondary) {\n        n.l.sec = secondary[\"long\"];\n        n.s.sec = secondary[\"short\"].length ? secondary[\"short\"] : secondary[\"long\"];\n    }\n    if (tertiary) {\n        n.l.ter = tertiary[\"long\"];\n        n.s.ter = tertiary[\"short\"].length ? tertiary[\"short\"] : tertiary[\"long\"];\n    }\n    switch (this.institution.strings[\"institution-parts\"]) {\n    case \"short\":\n        // No multilingual for pure short form institution names.\n        if (primary[\"short\"].length) {\n            short_style = this._getShortStyle();\n            institution = [this._composeOneInstitutionPart([n.s.pri, n.s.sec, n.s.ter], slot, short_style, v)];\n        } else {\n            // Fail over to long.\n            long_style = this._getLongStyle(primary, v, j);\n            institution = [this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v)];\n        }\n        break;\n    case \"short-long\":\n        long_style = this._getLongStyle(primary, v, j);\n        short_style = this._getShortStyle();\n        institution_short = this._renderOneInstitutionPart(primary[\"short\"], short_style);\n        // true is to include multilingual supplement\n        institution_long = this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v);\n        institution = [institution_short, institution_long];\n        break;\n    case \"long-short\":\n        long_style = this._getLongStyle(primary, v, j);\n        short_style = this._getShortStyle();\n        institution_short = this._renderOneInstitutionPart(primary[\"short\"], short_style);\n        // true is to include multilingual supplement\n        institution_long = this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v);\n        institution = [institution_long, institution_short];\n        break;\n    default:\n        long_style = this._getLongStyle(primary, v, j);\n        // true is to include multilingual supplement\n        institution = [this._composeOneInstitutionPart([n.l.pri, n.l.sec, n.l.ter], slot, long_style, v)];\n        break;\n    }\n    var blob = this._join(institution, \" \");\n    if (blob) {\n        blob.isInstitution = true;\n    }\n    this.state.tmp.name_node.children.push(blob);\n    return blob;\n};\n\nCSL.NameOutput.prototype._composeOneInstitutionPart = function (names, slot, style) {\n    var primary = false, secondary = false, tertiary = false, primary_tok, secondary_tok, tertiary_tok;\n    if (names[0]) {\n        primary_tok = CSL.Util.cloneToken(style);\n        if (this.state.opt.citeAffixes[slot.primary]){\n            if (\"<i>\" === this.state.opt.citeAffixes.institutions[slot.primary].prefix) {\n                var hasItalic = false;\n                for (var i = 0, ilen = primary_tok.decorations.length; i < ilen; i += 1) {\n                    if (style.decorations[i][0] === \"@font-style\"\n                        && primary_tok.decorations[i][1] === \"italic\") {\n                        hasItalic = true;\n                    }\n                }\n                if (!hasItalic) {\n                    primary_tok.decorations.push([\"@font-style\", \"italic\"]);\n                }\n            }\n        }\n        primary = this._renderOneInstitutionPart(names[0], primary_tok);\n     }\n    if (names[1]) {\n        secondary = this._renderOneInstitutionPart(names[1], style);\n    }\n    if (names[2]) {\n        tertiary = this._renderOneInstitutionPart(names[2], style);\n    }\n    // Compose\n    var institutionblob;\n    if (secondary || tertiary) {\n        this.state.output.openLevel(\"empty\");\n\n        this.state.output.append(primary);\n\n        secondary_tok = CSL.Util.cloneToken(style);\n        if (slot.secondary) {\n            secondary_tok.strings.prefix = this.state.opt.citeAffixes.institutions[slot.secondary].prefix;\n            secondary_tok.strings.suffix = this.state.opt.citeAffixes.institutions[slot.secondary].suffix;\n            // Add a space if empty\n            if (!secondary_tok.strings.prefix) {\n                secondary_tok.strings.prefix = \" \";\n            }\n        }\n        var secondary_outer = new CSL.Token();\n        secondary_outer.decorations.push([\"@font-style\", \"normal\"]);\n        secondary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n        this.state.output.openLevel(secondary_outer);\n        this.state.output.append(secondary, secondary_tok);\n        this.state.output.closeLevel();\n\n        tertiary_tok = CSL.Util.cloneToken(style);\n        if (slot.tertiary) {\n            tertiary_tok.strings.prefix = this.state.opt.citeAffixes.institutions[slot.tertiary].prefix;\n            tertiary_tok.strings.suffix = this.state.opt.citeAffixes.institutions[slot.tertiary].suffix;\n            // Add a space if empty\n            if (!tertiary_tok.strings.prefix) {\n                tertiary_tok.strings.prefix = \" \";\n            }\n        }\n        var tertiary_outer = new CSL.Token();\n        tertiary_outer.decorations.push([\"@font-style\", \"normal\"]);\n        tertiary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n        this.state.output.openLevel(tertiary_outer);\n        this.state.output.append(tertiary, tertiary_tok);\n        this.state.output.closeLevel();\n\n        this.state.output.closeLevel();\n\n        institutionblob = this.state.output.pop();\n    } else {\n        institutionblob = primary;\n    }\n    return institutionblob;\n};\n\nCSL.NameOutput.prototype._renderOneInstitutionPart = function (blobs, style) {\n    for (var i = 0, ilen = blobs.length; i < ilen; i += 1) {\n        if (blobs[i]) {\n            var str = blobs[i];\n            // XXXXX Cut-and-paste code in multiple locations. This code block should be\n            // collected in a function.\n            // Tag: strip-periods-block\n            if (this.state.tmp.strip_periods) {\n                str = str.replace(/\\./g, \"\");\n            } else {\n                for (var j = 0, jlen = style.decorations.length; j < jlen; j += 1) {\n                    if (\"@strip-periods\" === style.decorations[j][0] && \"true\" === style.decorations[j][1]) {\n                        str = str.replace(/\\./g, \"\");\n                        break;\n                    }\n                }\n            }\n            //this.state.output.append(blobs[i], style, true);\n            this.state.tmp.group_context.tip.variable_success = true;\n            this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n            if (str === \"!here>>>\") {\n                blobs[i] = false;\n            } else {\n                this.state.output.append(str, style, true);\n                blobs[i] = this.state.output.pop();\n            }\n        }\n    }\n    if (\"undefined\" === typeof this.institution.strings[\"part-separator\"]) {\n        this.institution.strings[\"part-separator\"] = this.state.tmp.name_delimiter;\n    }\n    return this._join(blobs, this.institution.strings[\"part-separator\"]);\n};\n\nCSL.NameOutput.prototype._renderNames = function (v, values, pos, j) {\n    //\n    var ret = false;\n    if (values.length) {\n        var names = [];\n        for (var i = 0, ilen = values.length; i < ilen; i += 1) {\n            var name = values[i];\n            \n            // XXX We'll start here with attempts.\n            // Figure out the three segments: primary, secondary, tertiary\n            var ret, localesets;\n            \n            if (this.state.tmp.extension) {\n                localesets = [\"sort\"];\n            } else if (name.isInstitution || name.literal) {\n                // Will never hit this in this function, but preserving\n                // in case we factor this out.\n                localesets = this.state.opt['cite-lang-prefs'].institutions;\n            } else {\n                localesets = this.state.opt['cite-lang-prefs'].persons;\n            }\n            var slot = {primary:'locale-orig',secondary:false,tertiary:false};\n\t        if (localesets) {\n\t\t        var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n\t\t        for (var k = 0, klen = slotnames.length; k < klen; k += 1) {\n\t\t\t        if (localesets.length - 1 <  k) {\n\t\t\t\t        break;\n\t\t\t        }\n\t\t\t        slot[slotnames[k]] = 'locale-' + localesets[k];\n\t\t        }\n\t        } else {\n\t\t        slot.primary = 'locale-translat';\n\t        }\n\t        if (this.state.tmp.sort_key_flag || (this.state.tmp.area !== \"bibliography\"\n\t\t        && !(this.state.tmp.area === \"citation\"\n\t\t\t         && this.state.opt.xclass === \"note\"\n\t\t\t         && this.item && !this.item.position))) {\n                \n\t\t        slot.secondary = false;\n\t\t        slot.tertiary = false;\n\t        }\n\n            // primary\n            // true is for fallback\n            this.setRenderedName(name);\n\n            if (!name.literal && !name.isInstitution) {\n                var nameBlob = this._renderPersonalName(v, name, slot, pos, i, j);\n                var nameToken = CSL.Util.cloneToken(this.name);\n                this.state.output.append(nameBlob, nameToken, true);\n                names.push(this.state.output.pop());\n            } else {\n                names.push(this._renderInstitutionName(v, name, slot, j));\n            }\n        }\n        //ret = this._join(names, \"\");\n        ret = this.joinPersons(names, pos, j);\n    }\n    return ret;\n};\n\n\nCSL.NameOutput.prototype._renderPersonalName = function (v, name, slot, pos, i, j) {\n    // XXXX FROM HERE (persons)\n\n    var res = this.getName(name, slot.primary, true);\n    var primary = this._renderOnePersonalName(res.name, pos, i, j);\n\tvar secondary = false;\n\tif (slot.secondary) {\n        res = this.getName(name, slot.secondary, false, res.usedOrig);\n        if (res.name) {\n\t\t\tsecondary = this._renderOnePersonalName(res.name, pos, i, j);\n        }\n\t}\n\tvar tertiary = false;\n\tif (slot.tertiary) {\n        res = this.getName(name, slot.tertiary, false, res.usedOrig);\n        if (res.name) {\n\t\t\ttertiary = this._renderOnePersonalName(res.name, pos, i, j);\n        }\n\t}\n    // Now compose them to a unit\n    var personblob;\n    if (secondary || tertiary) {\n\n        this.state.output.openLevel(\"empty\");\n\n        this.state.output.append(primary);\n\n        var secondary_tok = new CSL.Token();\n        if (slot.secondary) {\n            secondary_tok.strings.prefix = this.state.opt.citeAffixes.persons[slot.secondary].prefix;\n            secondary_tok.strings.suffix = this.state.opt.citeAffixes.persons[slot.secondary].suffix;\n            // Add a space if empty\n            if (!secondary_tok.strings.prefix) {\n                secondary_tok.strings.prefix = \" \";\n            }\n        }\n        this.state.output.append(secondary, secondary_tok);\n\n        var tertiary_tok = new CSL.Token();\n        if (slot.tertiary) {\n            tertiary_tok.strings.prefix = this.state.opt.citeAffixes.persons[slot.tertiary].prefix;\n            tertiary_tok.strings.suffix = this.state.opt.citeAffixes.persons[slot.tertiary].suffix;\n            // Add a space if empty\n            if (!tertiary_tok.strings.prefix) {\n                tertiary_tok.strings.prefix = \" \";\n            }\n        }\n        this.state.output.append(tertiary, tertiary_tok);\n\n        this.state.output.closeLevel();\n\n        personblob = this.state.output.pop();\n    } else {\n        personblob = primary;\n    }\n    return personblob;\n};\n\nCSL.NameOutput.prototype._isRomanesque = function (name) {\n    // 0 = entirely non-romanesque\n    // 1 = mixed content\n    // 2 = pure romanesque\n    var ret = 2;\n    if (!name.family.replace(/\\\"/g, '').match(CSL.ROMANESQUE_REGEXP)) {\n        ret = 0;\n    }\n    if (!ret && name.given && name.given.match(CSL.STARTSWITH_ROMANESQUE_REGEXP)) {\n        ret = 1;\n    }\n    var top_locale;\n    if (ret == 2) {\n        if (name.multi && name.multi.main) {\n            top_locale = name.multi.main.slice(0, 2);\n        } else if (this.Item.language) {\n            top_locale = this.Item.language.slice(0, 2);\n        }\n        if ([\"ja\", \"zh\"].indexOf(top_locale) > -1) {\n            ret = 1;\n        }\n    }\n    //print(\"name: \"+name.given+\", multi: \"+name.multi+\", ret: \"+ret);\n    return ret;\n};\n\nCSL.NameOutput.prototype._renderOnePersonalName = function (value, pos, i, j) {\n    var name = value;\n    var dropping_particle = this._droppingParticle(name, pos, j);\n    var family = this._familyName(name);\n    var non_dropping_particle = this._nonDroppingParticle(name);\n    var givenInfo = this._givenName(name, pos, i);\n    var given = givenInfo.blob;\n    var suffix = this._nameSuffix(name);\n    if (given === false) {\n        dropping_particle = false;\n        suffix = false;\n    }\n    var sort_sep = this.state.inheritOpt(this.name, \"sort-separator\");\n    if (!sort_sep) {\n        sort_sep = \"\";\n    }\n    var suffix_sep;\n    if (name[\"comma-suffix\"]) {\n        suffix_sep = \", \";\n    } else {\n        suffix_sep = \" \";\n    }\n    var romanesque = this._isRomanesque(name);\n    function hasJoiningPunctuation(blob) {\n        if (!blob) {\n            return false;\n        } else if (\"string\" === typeof blob.blobs) {\n            if ([\"\\u2019\", \"\\'\", \"-\", \" \"].indexOf(blob.blobs.slice(-1)) > -1) {\n                return true;\n            } else {\n                return false;\n            }\n        } else {\n            return hasJoiningPunctuation(blob.blobs[blob.blobs.length-1]);\n        }\n    }\n    \n    var has_hyphenated_non_dropping_particle = hasJoiningPunctuation(non_dropping_particle);\n\n    var nbspace;\n    if ([\"fr\", \"ru\", \"cs\"].indexOf(this.state.opt[\"default-locale\"][0].slice(0, 2)) > -1) {\n        nbspace = \"\\u00a0\";\n    } else {\n        nbspace = \" \";\n    }\n\n    var blob, merged, first, second;\n    if (romanesque === 0) {\n        // XXX handle affixes for given and family\n        blob = this._join([non_dropping_particle, family, given], \"\");\n    } else if (romanesque === 1 || name[\"static-ordering\"]) { // entry likes sort order\n        merged = this._join([non_dropping_particle, family], nbspace);\n        blob = this._join([merged, given], \" \");\n    } else if (name[\"reverse-ordering\"]) { // entry likes reverse order\n        merged = this._join([non_dropping_particle, family], nbspace);\n        blob = this._join([given, merged], \" \");\n    } else if (this.state.tmp.sort_key_flag) {\n        // ok with no affixes here\n        if (this.state.opt[\"demote-non-dropping-particle\"] === \"never\") {\n            merged = this._join([non_dropping_particle, family], nbspace);\n            merged = this._join([merged, dropping_particle], \" \");\n            merged = this._join([merged, given], this.state.opt.sort_sep);\n            blob = this._join([merged, suffix], \" \");\n        } else {\n            second = this._join([given, dropping_particle, non_dropping_particle], \" \");\n            merged = this._join([family, second], this.state.opt.sort_sep);\n            blob = this._join([merged, suffix], \" \");\n        }\n    } else if (this.state.inheritOpt(this.name, \"name-as-sort-order\") === \"all\" || (this.state.inheritOpt(this.name, \"name-as-sort-order\") === \"first\" && i === 0 && (j === 0 || \"undefined\" === typeof j))) {\n        //\n        // Discretionary sort ordering and inversions\n        //\n        if ([\"Lord\", \"Lady\"].indexOf(name.given) > -1) {\n            sort_sep = \", \";\n        }\n\n        // XXX Needs a more robust solution than this\n        // XXX See https://forums.zotero.org/discussion/30974/any-idea-why-an-a-author-comes-last-in-the-bibliography/#Item_30\n\n        //if ([\"always\", \"display-and-sort\"].indexOf(this.state.opt[\"demote-non-dropping-particle\"]) > -1 && !has_hyphenated_non_dropping_particle) {\n        if ([\"always\", \"display-and-sort\"].indexOf(this.state.opt[\"demote-non-dropping-particle\"]) > -1) {\n            // Drop non-dropping particle\n            //second = this._join([given, dropping_particle, non_dropping_particle], \" \");\n            second = this._join([given, dropping_particle], (name[\"comma-dropping-particle\"] + \" \"));\n        \n            // This would be a problem with al-Ghazali. Avoided by has_hyphenated_non_dropping_particle check above.\n            second = this._join([second, non_dropping_particle], \" \");\n            if (second && this.given) {\n                second.strings.prefix = this.given.strings.prefix;\n                second.strings.suffix = this.given.strings.suffix;\n            }\n            if (family && this.family) {\n                family.strings.prefix = this.family.strings.prefix;\n                family.strings.suffix = this.family.strings.suffix;\n            }\n            merged = this._join([family, second], sort_sep);\n            blob = this._join([merged, suffix], sort_sep);\n        } else {\n            // Don't drop particle.\n            // Don't do this\n            //if (this.state.tmp.area === \"bibliography\" && !this.state.tmp.term_predecessor && non_dropping_particle) {\n            //    if (!has_hyphenated_non_dropping_particle) {\n            //        non_dropping_particle.blobs = CSL.Output.Formatters[\"capitalize-first\"](this.state, non_dropping_particle.blobs)\n            //    }\n            //}\n            if (has_hyphenated_non_dropping_particle) {\n                first = this._join([non_dropping_particle, family], \"\");\n            } else {\n                first = this._join([non_dropping_particle, family], nbspace);\n            }\n            if (first && this.family) {\n                first.strings.prefix = this.family.strings.prefix;\n                first.strings.suffix = this.family.strings.suffix;\n            }\n\n            second = this._join([given, dropping_particle], (name[\"comma-dropping-particle\"] + \" \"));\n            //second = this._join([given, dropping_particle], \" \");\n            if (second && this.given) {\n                second.strings.prefix = this.given.strings.prefix;\n                second.strings.suffix = this.given.strings.suffix;\n            }\n\n            merged = this._join([first, second], sort_sep);\n            blob = this._join([merged, suffix], sort_sep);\n        }\n        blob.isInverted = true;\n    } else { // plain vanilla\n        if (name[\"dropping-particle\"] && name.family && !name[\"non-dropping-particle\"]) {\n            var dp = name[\"dropping-particle\"];\n            var apostrophes = [\"'\",\"\\u02bc\",\"\\u2019\",\"-\"];\n            if (apostrophes.indexOf(dp.slice(-1)) > -1 && dp.slice(0, -1) !== \"de\") {\n                family = this._join([dropping_particle, family], \"\");\n                dropping_particle = false;\n            }\n        }\n\n        if (has_hyphenated_non_dropping_particle) {\n            second = this._join([non_dropping_particle, family], \"\");\n            second = this._join([dropping_particle, second], nbspace);\n        } else {\n            second = this._join([dropping_particle, non_dropping_particle, family], nbspace);\n        }\n        second = this._join([second, suffix], suffix_sep);\n        if (second && this.family) {\n            second.strings.prefix = this.family.strings.prefix;\n            second.strings.suffix = this.family.strings.suffix;\n        }\n        if (given && this.given) {\n            given.strings.prefix = this.given.strings.prefix;\n            given.strings.suffix = this.given.strings.suffix;\n        }\n        if (second.strings.prefix) {\n            name[\"comma-dropping-particle\"] = \"\";\n        }\n\n        var space;\n        if (this.state.inheritOpt(this.name, \"initialize-with\")\n            && this.state.inheritOpt(this.name, \"initialize-with\").match(/[\\u00a0\\ufeff]/)\n            && givenInfo.initializationLevel === 1) {\n            \n            space = nbspace;\n        } else {\n            space = \" \";\n        }\n        blob = this._join([given, second], (name[\"comma-dropping-particle\"] + space));\n    }\n    // XXX Just generally assume for the present that personal names render something\n    this.state.tmp.group_context.tip.variable_success = true;\n    this.state.tmp.can_substitute.replace(false, CSL.LITERAL);\n    this.state.tmp.term_predecessor = true;\n    // notSerious\n    //this.state.output.append(blob, \"literal\", true);\n    //var ret = this.state.output.pop();\n    this.state.tmp.name_node.children.push(blob);\n    return blob;\n};\n\n/*\n        // Do not include given name, dropping particle or suffix in strict short form of name\n\n        // initialize if appropriate\n*/\n\n// Input names should be touched by _normalizeNameInput()\n// exactly once: this is not idempotent.\nCSL.NameOutput.prototype._normalizeNameInput = function (value) {\n    var name = {\n        literal:value.literal,\n        family:value.family,\n        isInstitution:value.isInstitution,\n        given:value.given,\n        suffix:value.suffix,\n        \"comma-suffix\":value[\"comma-suffix\"],\n        \"non-dropping-particle\":value[\"non-dropping-particle\"],\n        \"dropping-particle\":value[\"dropping-particle\"],\n        \"static-ordering\":value[\"static-ordering\"],\n        \"static-particles\":value[\"static-particles\"],\n        \"reverse-ordering\":value[\"reverse-ordering\"],\n        \"full-form-always\": value[\"full-form-always\"],\n        \"parse-names\":value[\"parse-names\"],\n        \"comma-dropping-particle\": \"\",\n        block_initialize:value.block_initialize,\n        multi:value.multi\n    };\n    this._parseName(name);\n    return name;\n};\n\n// _transformNameset() replaced with enhanced transform.name().\n\nCSL.NameOutput.prototype._stripPeriods = function (tokname, str) {\n    var decor_tok = this[tokname + \"_decor\"];\n    if (str) {\n        if (this.state.tmp.strip_periods) {\n            str = str.replace(/\\./g, \"\");\n        } else  if (decor_tok) {\n            for (var i = 0, ilen = decor_tok.decorations.length; i < ilen; i += 1) {\n                if (\"@strip-periods\" === decor_tok.decorations[i][0] && \"true\" === decor_tok.decorations[i][1]) {\n                    str = str.replace(/\\./g, \"\");\n                    break;\n                }\n            }\n        }\n    }\n    return str;\n};\n\nCSL.NameOutput.prototype._nonDroppingParticle = function (name) {\n    var ndp = name[\"non-dropping-particle\"];\n    if (ndp && this.state.tmp.sort_key_flag) {\n        ndp = ndp.replace(/[\\'\\u2019]/, \"\");\n    }\n    var str = this._stripPeriods(\"family\", ndp);\n    if (this.state.output.append(str, this.family_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._droppingParticle = function (name, pos, j) {\n    var dp = name[\"dropping-particle\"];\n    if (dp && this.state.tmp.sort_key_flag) {\n        dp = dp.replace(/[\\'\\u2019]/, \"\");\n    }\n    var str = this._stripPeriods(\"given\", dp);\n    if (name[\"dropping-particle\"] && name[\"dropping-particle\"].match(/^et.?al[^a-z]$/)) {\n        if (this.state.inheritOpt(this.name, \"et-al-use-last\")) {\n            if (\"undefined\" === typeof j) { \n                this.etal_spec[pos].freeters = 2;\n            } else {\n                this.etal_spec[pos].persons = 2;\n            }\n        } else {\n            if (\"undefined\" === typeof j) { \n                this.etal_spec[pos].freeters = 1;\n            } else {\n                this.etal_spec[pos].persons = 1;\n            }\n        }\n        name[\"comma-dropping-particle\"] = \"\";\n    } else if (this.state.output.append(str, this.given_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._familyName = function (name) {\n    var str = this._stripPeriods(\"family\", name.family);\n    if (this.state.output.append(str, this.family_decor, true)) {\n        return this.state.output.pop();\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._givenName = function (name, pos, i) {\n    var ret;\n    // citation\n    //   use disambig as-is\n    // biblography\n    //   use disambig only if it boosts over the default\n    //   SO WHAT IS THE DEFAULT?\n    //   A: If \"form\" is short, it's 0.\n    //      If \"form\" is long, initialize-with exists (and initialize is not false) it's 1\n    //      If \"form\" is long, and initialize_with does not exist, it's 2.\n    var formIsShort = this.state.inheritOpt(this.name, \"form\", \"name-form\", \"long\") !== \"long\";\n    var initializeIsTurnedOn = this.state.inheritOpt(this.name, \"initialize\") !== false;\n    var hasInitializeWith = \"string\" === typeof this.state.inheritOpt(this.name, \"initialize-with\") && !name.block_initialize;\n    var defaultLevel;\n    var useLevel;\n    if (name[\"full-form-always\"]) {\n        useLevel = 2;\n    } else {\n        if (formIsShort) {\n            defaultLevel = 0;\n        } else if (hasInitializeWith) {\n            defaultLevel = 1;\n        } else {\n            defaultLevel = 2;\n        }\n        var requestedLevel = this.state.tmp.disambig_settings.givens[pos][i];\n        if (requestedLevel > defaultLevel) {\n            useLevel = requestedLevel;\n        } else {\n            useLevel = defaultLevel;\n        }\n    }\n    var gdropt = this.state.citation.opt[\"givenname-disambiguation-rule\"];\n   if (gdropt && gdropt.slice(-14) === \"-with-initials\") {\n        hasInitializeWith = true;\n    }\n    if (name.family && useLevel === 1) {\n        if (hasInitializeWith) {\n            var initialize_with = this.state.inheritOpt(this.name, \"initialize-with\", false, \"\");\n            name.given = CSL.Util.Names.initializeWith(this.state, name.given, initialize_with, !initializeIsTurnedOn);\n        } else {\n            name.given = CSL.Util.Names.unInitialize(this.state, name.given);\n        }\n    } else if (useLevel === 0) {\n        return {\n            blob: false\n        }\n    } else if (useLevel === 2) {\n        name.given = CSL.Util.Names.unInitialize(this.state, name.given);\n    }\n\n    var str = this._stripPeriods(\"given\", name.given);\n    var rendered = this.state.output.append(str, this.given_decor, true);\n    if (rendered) {\n        ret = this.state.output.pop();\n\t    return {\n            blob: ret,\n            initializationLevel: useLevel\n        };\n    }\n    return {\n        blob: false\n    };\n};\n\nCSL.NameOutput.prototype._nameSuffix = function (name) {\n\n    var str = name.suffix, ret;\n\n    if (str && \"string\" === typeof this.state.inheritOpt(this.name, \"initialize-with\")) {\n        str = CSL.Util.Names.initializeWith(this.state, str, this.state.inheritOpt(this.name, \"initialize-with\"), true);\n    }\n\n    str = this._stripPeriods(\"family\", str);\n    var toSuffix = '';\n    if (str && str.slice(-1) === '.') {\n\tstr = str.slice(0, -1);\n\ttoSuffix = '.';\n    }\n    var rendered = this.state.output.append(str, \"empty\", true);\n    if (rendered) {\n        ret = this.state.output.pop();\n\tret.strings.suffix = toSuffix + ret.strings.suffix;\n\treturn ret;\n    }\n    return false;\n};\n\nCSL.NameOutput.prototype._getLongStyle = function (name) {\n    var long_style;\n    if (name[\"short\"].length) {\n        if (this.institutionpart[\"long-with-short\"]) {\n            long_style = this.institutionpart[\"long-with-short\"];\n        } else {\n            long_style = this.institutionpart[\"long\"];\n        }\n    } else {\n        long_style = this.institutionpart[\"long\"];\n    }\n    if (!long_style) {\n        long_style = new CSL.Token();\n    }\n    return long_style;\n};\n\nCSL.NameOutput.prototype._getShortStyle = function () {\n    var short_style;\n    if (this.institutionpart[\"short\"]) {\n        short_style = this.institutionpart[\"short\"];\n    } else {\n        short_style = new CSL.Token();\n    }\n    return short_style;\n};\n\nCSL.NameOutput.prototype._parseName = function (name) {\n    if (!name[\"parse-names\"] && \"undefined\" !== typeof name[\"parse-names\"]) {\n        return name;\n    }\n    if (name.family && !name.given && name.isInstitution) {\n        name.literal = name.family;\n        name.family = undefined;\n        name.isInstitution = undefined;\n    }\n    var noparse;\n    if (name.family \n        && (name.family.slice(0, 1) === '\"' && name.family.slice(-1) === '\"')\n        || (!name[\"parse-names\"] && \"undefined\" !== typeof name[\"parse-names\"])) {\n\n        name.family = name.family.slice(1, -1);\n        noparse = true;\n        name[\"parse-names\"] = 0;\n    } else {\n        noparse = false;\n    }\n    if (this.state.opt.development_extensions.parse_names) {\n        if (!name[\"non-dropping-particle\"] && name.family && !noparse && name.given) {\n            if (!name[\"static-particles\"]) {\n                CSL.parseParticles(name, true);\n            }\n        }\n    }\n};\n\n/*\n * Return a single name object\n  */\n\n// The interface is a mess, but this should serve.\n\nCSL.NameOutput.prototype.getName = function (name, slotLocaleset, fallback, stopOrig) {\n\n    // Needs to tell us whether we used orig or not.\n    \n    if (stopOrig && slotLocaleset === 'locale-orig') {\n        return {name:false,usedOrig:stopOrig};\n    }\n\n    // Normalize to string\n    if (!name.family) {\n        name.family = \"\";\n    }\n    if (!name.given) {\n        name.given = \"\";\n    }\n\n    // Recognized params are:\n    //  block-initialize\n    //  transliterated\n    //  static-ordering\n    //  full-form-always\n    // All default to false, except for static-ordering, which is initialized\n    // with a sniff.\n    var name_params = {};\n    // Determines the default static-order setting based on the characters\n    // used in the headline field. Will be overridden by locale-based\n    // parameters evaluated against explicit lang tags set on the (sub)field.\n    name_params[\"static-ordering\"] = this.getStaticOrder(name);\n\n    var foundTag = true;\n    var langTag;\n    if (slotLocaleset !== 'locale-orig') {\n        foundTag = false;\n        if (name.multi) {\n            var langTags = this.state.opt[slotLocaleset];\n            for (var i = 0, ilen = langTags.length; i < ilen; i += 1) {\n                langTag = langTags[i];\n                if (name.multi._key[langTag]) {\n                    foundTag = true;\n                    var isInstitution = name.isInstitution;\n                    name = name.multi._key[langTag];\n                    name.isInstitution = isInstitution;\n                    // Set name formatting params\n                    name_params = this.getNameParams(langTag);\n                    name_params.transliterated = true;\n                    break;\n                }\n            }\n        }\n    }\n\n    if (!foundTag) {\n        langTag = false;\n        if (name.multi && name.multi.main) {\n            langTag = name.multi.main;\n        } else if (this.Item.language) {\n            langTag = this.Item.language;\n        }\n        if (langTag) {\n            name_params = this.getNameParams(langTag);\n        }\n    }\n\n    if (!fallback && !foundTag) {\n        return {name:false,usedOrig:stopOrig};\n    }\n    \n    // Normalize to string (again)\n    if (!name.family) {\n        name.family = \"\";\n    }\n    if (!name.given) {\n        name.given = \"\";\n    }\n    if (name.literal) {\n        delete name.family;\n        delete name.given;\n    }\n    // var clone the item before writing into it\n    name = {\n        family:name.family,\n        given:name.given,\n        \"non-dropping-particle\":name[\"non-dropping-particle\"],\n        \"dropping-particle\":name[\"dropping-particle\"],\n        suffix:name.suffix,\n        \"static-ordering\":name_params[\"static-ordering\"],\n        \"static-particles\":name[\"static-particles\"],\n        \"reverse-ordering\":name_params[\"reverse-ordering\"],\n        \"full-form-always\": name_params[\"full-form-always\"],\n        \"parse-names\":name[\"parse-names\"],\n        \"comma-suffix\":name[\"comma-suffix\"],\n        \"comma-dropping-particle\":name[\"comma-dropping-particle\"],\n        transliterated: name_params.transliterated,\n        block_initialize: name_params[\"block-initialize\"],\n        literal:name.literal,\n        isInstitution:name.isInstitution,\n        multi:name.multi\n    };\n    \n    if (!name.literal && (!name.given && name.family && name.isInstitution)) {\n        name.literal = name.family;\n    }\n    if (name.literal) {\n        delete name.family;\n        delete name.given;\n    }\n    name = this._normalizeNameInput(name);\n    var usedOrig;\n    if (stopOrig) {\n        usedOrig = stopOrig;\n    } else {\n        usedOrig = !foundTag;\n    }\n    return {name:name,usedOrig:usedOrig};\n};\n\nCSL.NameOutput.prototype.getNameParams = function (langTag) {\n    var ret = {};\n    var langspec = CSL.localeResolve(this.Item.language, this.state.opt[\"default-locale\"][0]);\n    var try_locale = this.state.locale[langspec.best] ? langspec.best : this.state.opt[\"default-locale\"][0];\n    var name_as_sort_order = this.state.locale[try_locale].opts[\"name-as-sort-order\"];\n    var name_as_reverse_order = this.state.locale[try_locale].opts[\"name-as-reverse-order\"];\n    var name_never_short = this.state.locale[try_locale].opts[\"name-never-short\"];\n    var field_lang_bare = langTag.split(\"-\")[0];\n    if (name_as_sort_order && name_as_sort_order[field_lang_bare]) {\n        ret[\"static-ordering\"] = true;\n        ret[\"reverse-ordering\"] = false;\n    }\n    if (name_as_reverse_order && name_as_reverse_order[field_lang_bare]) {\n        ret[\"reverse-ordering\"] = true;\n        ret[\"static-ordering\"] = false;\n    }\n    if (name_never_short && name_never_short[field_lang_bare]) {\n        ret[\"full-form-always\"] = true;\n    }\n    \n    if (ret[\"static-ordering\"]) {\n        ret[\"block-initialize\"] = true;\n    }\n    return ret;\n};\n\nCSL.NameOutput.prototype.setRenderedName = function (name) {\n    if (this.state.tmp.area === \"bibliography\") {\n        var strname = \"\";\n        for (var j=0,jlen=CSL.NAME_PARTS.length;j<jlen;j+=1) {\n            if (name[CSL.NAME_PARTS[j]]) {\n                strname += name[CSL.NAME_PARTS[j]];\n            }\n        }\n        this.state.tmp.rendered_name.push(strname);\n    }\n};\n\nCSL.NameOutput.prototype.fixupInstitution = function (name, varname, listpos) {\n    if (!name.literal && name.family) {\n        name.literal = name.family;\n        delete name.family;\n    }\n    var longNameStr = name.literal;\n    var shortNameStr = longNameStr;\n    var ret = {\n        \"long\": longNameStr.split(/\\s*\\|\\s*/),\n        \"short\": shortNameStr.split(/\\s*\\|\\s*/),\n    };\n    if (this.state.sys.getAbbreviation) {\n        // Normalize longNameStr and shortNameStr\n        if (this.institution.strings.form === \"short\") {\n            let jurisdiction = this.Item.jurisdiction;\n            jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-entire\", longNameStr, this.Item.language);\n            if (this.state.transform.abbrevs[jurisdiction][\"institution-entire\"][longNameStr]) {\n                longNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-entire\"][longNameStr];\n            } else {\n                jurisdiction = this.Item.jurisdiction;\n                jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", longNameStr, this.Item.language);\n                if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][longNameStr]) {\n                    longNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][longNameStr];\n                }\n            }\n            longNameStr = this._quashChecks(jurisdiction, longNameStr);\n        }\n        if ([\"short\", \"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n            let jurisdiction = this.Item.jurisdiction;\n            jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", shortNameStr, this.Item.language);\n            if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][shortNameStr]) {\n                shortNameStr = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][shortNameStr];\n            }\n            shortNameStr = this._quashChecks(jurisdiction, shortNameStr);\n            if ([\"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n                if (shortNameStr === longNameStr) {\n                    shortNameStr = \"\";\n                }\n            }\n        }\n        // Split abbreviated strings\n        // For pure long, split and we're done.\n        ret[\"long\"] = longNameStr.split(/\\s*\\|\\s*/);\n        // For short, split and then try abbrev with institution-part on each element\n        ret[\"short\"] = shortNameStr.split(/\\s*\\|\\s*/);\n        if ([\"short\", \"short-long\", \"long-short\"].indexOf(this.institution.strings[\"institution-parts\"]) > -1) {\n            for (var j=ret[\"short\"].length-1; j>-1; j--) {\n                let jurisdiction = this.Item.jurisdiction;\n                var abbrevKey = ret[\"short\"][j];\n                jurisdiction = this.state.transform.loadAbbreviation(jurisdiction, \"institution-part\", abbrevKey, this.Item.language);\n                if (this.state.transform.abbrevs[jurisdiction][\"institution-part\"][abbrevKey]) {\n                    ret[\"short\"][j] = this.state.transform.abbrevs[jurisdiction][\"institution-part\"][abbrevKey];\n                }\n                if (ret[\"short\"][j].indexOf(\"|\") > -1) {\n                    let retShort = ret[\"short\"];\n                    let splitShort = retShort[j].split(/\\s*\\|\\s*/);\n                    ret[\"short\"] = retShort.slice(0, j).concat(splitShort).concat(retShort.slice(j+1));\n                }\n            }\n        }\n        if (this.state.opt.development_extensions.legacy_institution_name_ordering) {\n            ret[\"short\"].reverse();\n        }\n        ret[\"short\"] = this._trimInstitution(ret[\"short\"]);\n        if (this.institution.strings[\"reverse-order\"]) {\n            ret[\"short\"].reverse();\n        }\n        // trimmer is not available in getAmbiguousCite\n        if (!this.state.tmp.just_looking) {\n            if (this.Item.jurisdiction) {\n                let jurisdiction = this.Item.jurisdiction;\n                var trimmer = this.state.tmp.abbrev_trimmer;\n                if (trimmer && trimmer[jurisdiction] && trimmer[jurisdiction][varname]) {\n                    for (var i=0,ilen=ret[\"short\"].length;i<ilen;i++) {\n                        var frag = ret[\"short\"][i];\n                        ret[\"short\"][i] = frag.replace(trimmer[jurisdiction][varname], \"\").trim();\n                    }\n                }\n            }\n        }\n    }\n    if (this.state.opt.development_extensions.legacy_institution_name_ordering) {\n        ret[\"long\"].reverse();\n    }\n    ret[\"long\"] = this._trimInstitution(ret[\"long\"]);\n    if (this.institution.strings[\"reverse-order\"]) {\n        ret[\"long\"].reverse();\n    }\n\n    return ret;\n};\n\n\nCSL.NameOutput.prototype.getStaticOrder = function (name, refresh) {\n    var static_ordering_val = false;\n    if (!refresh && name[\"static-ordering\"]) {\n        static_ordering_val = true;\n    } else if (this._isRomanesque(name) === 0) {\n        static_ordering_val = true;\n    } else if ((!name.multi || !name.multi.main) && this.Item.language && ['vi', 'hu'].indexOf(this.Item.language) > -1) {\n        static_ordering_val = true;\n    } else if (name.multi && name.multi.main && ['vi', 'hu'].indexOf(name.multi.main.slice(0,2)) > -1) {\n        static_ordering_val = true;\n    } else {\n        if (this.state.opt['auto-vietnamese-names']\n            && (CSL.VIETNAMESE_NAMES.exec(name.family + \" \" + name.given)\n                && CSL.VIETNAMESE_SPECIALS.exec(name.family + name.given))) {\n            \n            static_ordering_val = true;\n        }\n    }\n    return static_ordering_val;\n};\n\nCSL.NameOutput.prototype._quashChecks = function (jurisdiction, str) {\n    var str = this.state.transform.quashCheck(jurisdiction, str);\n    // If the abbreviation has date cut-offs, find the most recent\n    // abbreviation within scope.\n    var lst = str.split(/>>[0-9]{4}>>/);\n    var m = str.match(/>>([0-9]{4})>>/);\n    str = lst.pop();\n    var date = this.Item[\"original-date\"] ? this.Item[\"original-date\"] : this.Item[\"issued\"];\n    if (date) {\n        date = parseInt(date.year, 10);\n        date = isNaN(date) ? false : date;\n    }\n    if (date) {\n        if (lst.length > 0) {\n            for (var k=m.length-1; k>0; k--) {\n                if (date >= parseInt(m[k], 10)) {\n                    break;\n                }\n                str = lst.pop();\n            }\n        }\n        str = str.replace(/\\s*\\|\\s*/g, \"|\");\n    }\n    return str;\n}\n\nCSL.NameOutput.prototype._trimInstitution = function (subunits) {\n\t// Oh! Good catch in the tests. This happens before abbrevs.\n    // Won't work that way. Need to do abbrev substitute first,\n    // and apply this separately to long and to short.\n    var use_first = false;\n    var stop_last = false;\n    var use_last = false;\n    var stop_first = false;\n    var s = subunits.slice();\n    if (this.institution) {\n        // If use_first, apply stop_last, then apply use_first;\n        // If use_last, apply stop_first, then apply use_last;\n        if (\"undefined\" !== typeof this.institution.strings[\"use-first\"]) {\n            // this.state.sys.print(\"use-first OK\");\n            use_first = this.institution.strings[\"use-first\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"use-last\"]) {\n            // this.state.sys.print(\"use-last OK\");\n            use_last = this.institution.strings[\"use-last\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"stop-first\"]) {\n            // this.state.sys.print(\"stop-first OK\");\n            stop_first = this.institution.strings[\"stop-first\"];\n        }\n        if (\"undefined\" !== typeof this.institution.strings[\"stop-last\"]) {\n            stop_last = this.institution.strings[\"stop-last\"];\n        }\n\n        if (use_first) {\n            if (stop_last) {\n                s = s.slice(0, stop_last * -1);\n            }\n            s = s.slice(0, use_first);\n        }\n        \n        if (use_last) {\n            var ss = subunits.slice();\n            if (use_first) {\n                stop_first = use_first;\n            } else {\n                s = [];\n            }\n            if (stop_first) {\n                ss = ss.slice(stop_first);\n            }\n            ss = ss.slice(use_last * -1);\n            s = s.concat(ss);\n        }\n        subunits = s;\n    }\n    return subunits;\n};\n\n/*global CSL: true */\n\nCSL.PublisherOutput = function (state, group_tok) {\n    this.state = state;\n    this.group_tok = group_tok;\n    this.varlist = [];\n};\n\nCSL.PublisherOutput.prototype.render = function () {\n    this.clearVars();\n    this.composeAndBlob();\n    this.composeElements();\n    this.composePublishers();\n    this.joinPublishers();\n};\n\n\n// XXX Figure out how to adapt this to the House of Lords / House of Commons\n// joint committee case\n\n// name_delimiter\n// delimiter_precedes_last\n// and\n\nCSL.PublisherOutput.prototype.composeAndBlob = function () {\n    this.and_blob = {};\n    var and_term = false;\n    if (this.group_tok.strings.and === \"text\") {\n        and_term = this.state.getTerm(\"and\");\n    } else if (this.group_tok.strings.and === \"symbol\") {\n        and_term = \"&\";\n    }\n    var tok = new CSL.Token();\n    tok.strings.suffix = \" \";\n    tok.strings.prefix = \" \";\n    this.state.output.append(and_term, tok, true);\n    var no_delim = this.state.output.pop();\n\n    tok.strings.prefix = this.group_tok.strings[\"subgroup-delimiter\"];\n    this.state.output.append(and_term, tok, true);\n    var with_delim = this.state.output.pop();\n    \n    this.and_blob.single = false;\n    this.and_blob.multiple = false;\n    if (and_term) {\n        if (this.group_tok.strings[\"subgroup-delimiter-precedes-last\"] === \"always\") {\n            this.and_blob.single = with_delim;\n        } else if (this.group_tok.strings[\"subgroup-delimiter-precedes-last\"] === \"never\") {\n            this.and_blob.single = no_delim;\n            this.and_blob.multiple = no_delim;\n        } else {\n            this.and_blob.single = no_delim;\n            this.and_blob.multiple = with_delim;\n        }\n    }\n};\n\n\nCSL.PublisherOutput.prototype.composeElements = function () {\n    for (var i = 0, ilen = 2; i < ilen; i += 1) {\n        var varname = [\"publisher\", \"publisher-place\"][i];\n        for (var j = 0, jlen = this[\"publisher-list\"].length; j < jlen; j += 1) {\n            var str = this[varname + \"-list\"][j];\n            var tok = this[varname + \"-token\"];\n            // notSerious\n            this.state.output.append(str, tok, true);\n            this[varname + \"-list\"][j] = this.state.output.pop();\n        }\n    }\n};\n\n\nCSL.PublisherOutput.prototype.composePublishers = function () {\n    var blobs;\n    for (var i = 0, ilen = this[\"publisher-list\"].length; i < ilen; i += 1) {\n        blobs = [this[this.varlist[0] + \"-list\"][i], this[this.varlist[1] + \"-list\"][i]];\n        this[\"publisher-list\"][i] = this._join(blobs, this.group_tok.strings.delimiter);\n    }\n};\n\n\nCSL.PublisherOutput.prototype.joinPublishers = function () {\n    var blobs = this[\"publisher-list\"];\n    var publishers = this._join(blobs, this.group_tok.strings[\"subgroup-delimiter\"], this.and_blob.single, this.and_blob.multiple, this.group_tok);\n    this.state.output.append(publishers, \"literal\");\n};\n\n\n// blobs, delimiter, single, multiple, tokenname\n// Tokenname is a key at top level of this object.\nCSL.PublisherOutput.prototype._join = CSL.NameOutput.prototype._join;\nCSL.PublisherOutput.prototype._getToken = CSL.NameOutput.prototype._getToken;\n\n\nCSL.PublisherOutput.prototype.clearVars = function () {\n    this.state.tmp[\"publisher-list\"] = false;\n    this.state.tmp[\"publisher-place-list\"] = false;\n    this.state.tmp[\"publisher-group-token\"] = false;\n    this.state.tmp[\"publisher-token\"] = false;\n    this.state.tmp[\"publisher-place-token\"] = false;\n};\n\n/*global CSL: true */\n\nCSL.evaluateLabel = function (node, state, Item, item) {\n    var myterm;\n    if (\"locator\" === node.strings.term) {\n        if (item && item.label) {\n            if (item.label === \"sub verbo\") {\n                myterm = \"sub-verbo\";\n            } else {\n                myterm = item.label;\n            }\n        }\n        if (!myterm) {\n            myterm = \"page\";\n        }\n    } else {\n        myterm = node.strings.term;\n    }\n    \n    // Plurals detection.\n    var plural = node.strings.plural;\n    if (\"number\" !== typeof plural) {\n        // (node, ItemObject, variable, type)\n        var theItem = (item && node.strings.term === \"locator\") ? item : Item;\n        if (theItem[node.strings.term]) {\n            state.processNumber(false, theItem, node.strings.term, Item.type);\n            plural = state.tmp.shadow_numbers[node.strings.term].plural;\n            if (!state.tmp.shadow_numbers[node.strings.term].labelForm\n                && !state.tmp.shadow_numbers[node.strings.term].labelDecorations) {\n                if (node.strings.form) {\n                    state.tmp.shadow_numbers[node.strings.term].labelForm = node.strings.form;\n                } else if (state.tmp.group_context.tip.label_form) {\n                    state.tmp.shadow_numbers[node.strings.term].labelForm = state.tmp.group_context.tip.label_form;\n                }\n                state.tmp.shadow_numbers[node.strings.term].labelCapitalizeIfFirst = node.strings.capitalize_if_first;\n                state.tmp.shadow_numbers[node.strings.term].labelDecorations = node.decorations.slice();\n            }\n            \n            if ([\"locator\", \"number\", \"page\"].indexOf(node.strings.term) > -1 && state.tmp.shadow_numbers[node.strings.term].label) {\n                myterm = state.tmp.shadow_numbers[node.strings.term].label;\n            }\n            if (node.decorations && state.opt.development_extensions.csl_reverse_lookup_support) {\n                node.decorations.reverse();\n                node.decorations.push([\"@showid\",\"true\", node.cslid]);\n                node.decorations.reverse();\n            }\n        }\n    }\n    return CSL.castLabel(state, node, myterm, plural, CSL.TOLERANT);\n};\n\nCSL.castLabel = function (state, node, term, plural, mode) {\n    var label_form = node.strings.form;\n    var label_capitalize_if_first = node.strings.capitalize_if_first;\n    if (state.tmp.group_context.tip.label_form) {\n        if (label_form === \"static\") {\n            state.tmp.group_context.tip.label_static = true;\n        } else {\n            label_form = state.tmp.group_context.tip.label_form;\n        }\n    }\n\n    if (state.tmp.group_context.tip.label_capitalize_if_first) {\n        label_capitalize_if_first = state.tmp.group_context.tip.label_capitalize_if_first;\n    }\n    var ret = state.getTerm(term, label_form, plural, false, mode, node.default_locale);\n    if (label_capitalize_if_first) {\n        ret = CSL.Output.Formatters[\"capitalize-first\"](state, ret);\n    }\n    // XXXXX Cut-and-paste code in multiple locations. This code block should be\n    // collected in a function.\n    // Tag: strip-periods-block\n    if (state.tmp.strip_periods) {\n        ret = ret.replace(/\\./g, \"\");\n    } else {\n        for (var i = 0, ilen = node.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === node.decorations[i][0] && \"true\" === node.decorations[i][1]) {\n                ret = ret.replace(/\\./g, \"\");\n                break;\n            }\n        }\n    }\n    return ret;\n};\n\n/*global CSL: true */\n\nCSL.Node.name = {\n    build: function (state, target) {\n        var func;\n        if ([CSL.SINGLETON, CSL.START].indexOf(this.tokentype) > -1) {\n            var oldTmpRoot;\n            if (\"undefined\" === typeof state.tmp.root) {\n                oldTmpRoot = undefined;\n                state.tmp.root = \"citation\";\n            } else {\n                oldTmpRoot = state.tmp.root;\n            }\n            // Many CSL styles set et-al-[min|use-first]\n            // and et-al-subsequent-[min|use-first] to the same\n            // value.\n            // Set state.opt.update_mode = CSL.POSITION if\n            // et-al-subsequent-min or et-al-subsequent-use-first\n            // are set AND their value differs from their plain\n            // counterparts.\n            if (state.inheritOpt(this, \"et-al-subsequent-min\")\n                && (state.inheritOpt(this, \"et-al-subsequent-min\") !== state.inheritOpt(this, \"et-al-min\"))) {\n                \n                state.opt.update_mode = CSL.POSITION;\n            }\n            if (state.inheritOpt(this, \"et-al-subsequent-use-first\")\n                && (state.inheritOpt(this, \"et-al-subsequent-use-first\") !== state.inheritOpt(this, \"et-al-use-first\"))) {\n                \n                state.opt.update_mode = CSL.POSITION;\n            }\n\n            state.tmp.root = oldTmpRoot;\n\n            func = function (state) {\n                // Et-al (onward processing in node_etal.js and node_names.js)\n                // XXXXX Why is this necessary? This is available on this.name, right?\n                state.tmp.etal_term = \"et-al\";\n\n                // Use default delimiter as fallback, in a way that allows explicit\n                // empty strings.\n                state.tmp.name_delimiter = state.inheritOpt(this, \"delimiter\", \"name-delimiter\", \", \");\n                state.tmp[\"delimiter-precedes-et-al\"] = state.inheritOpt(this, \"delimiter-precedes-et-al\");\n                \n                // And\n                if (\"text\" === state.inheritOpt(this, \"and\")) {\n                    this.and_term = state.getTerm(\"and\", \"long\", 0);\n                } else if (\"symbol\" === state.inheritOpt(this, \"and\")) {\n                    if (state.opt.development_extensions.expect_and_symbol_form) {\n                        this.and_term = state.getTerm(\"and\", \"symbol\", 0);\n                    } else {\n                        this.and_term = \"&\";\n                    }\n                }\n                state.tmp.and_term = this.and_term;\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)) {\n                    this.and_prefix_single = \" \";\n                    this.and_prefix_multiple = \", \";\n                    // Workaround to allow explicit empty string\n                    // on cs:name delimiter.\n                    if (\"string\" === typeof state.tmp.name_delimiter) {\n                        this.and_prefix_multiple = state.tmp.name_delimiter;\n                    }\n                    this.and_suffix = \" \";\n\n                    // Really can't inspect these values in the build phase. Sorry.\n                    //state.build.name_delimiter = this.strings.delimiter;\n\n                } else {\n                    this.and_prefix_single = \"\";\n                    this.and_prefix_multiple = \"\";\n                    this.and_suffix = \"\";\n                }\n                if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"always\") {\n                    this.and_prefix_single = state.tmp.name_delimiter;\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"never\") {\n                    // Slightly fragile: could test for charset here to make\n                    // this more certain.\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                } else if (state.inheritOpt(this, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n                    if (this.and_prefix_single) {\n                        this.and_prefix_single = state.tmp.name_delimiter;\n                    }\n                    if (this.and_prefix_multiple) {\n                        this.and_prefix_multiple = \" \";\n                    }\n                }\n\n                this.and = {};\n                if (state.inheritOpt(this, \"and\")) {\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.single = state.output.pop();\n                    this.and.single.strings.prefix = this.and_prefix_single;\n                    this.and.single.strings.suffix = this.and_suffix;\n                    state.output.append(this.and_term, \"empty\", true);\n                    this.and.multiple = state.output.pop();\n                    this.and.multiple.strings.prefix = this.and_prefix_multiple;\n                    this.and.multiple.strings.suffix = this.and_suffix;\n                } else if (state.tmp.name_delimiter) {\n                    // This is a little weird, but it works.\n                    this.and.single = new CSL.Blob(state.tmp.name_delimiter);\n                    this.and.single.strings.prefix = \"\";\n                    this.and.single.strings.suffix = \"\";\n                    this.and.multiple = new CSL.Blob(state.tmp.name_delimiter);\n                    this.and.multiple.strings.prefix = \"\";\n                    this.and.multiple.strings.suffix = \"\";\n                }\n\n                this.ellipsis = {};\n                if (state.inheritOpt(this, \"et-al-use-last\")) {\n                    // We use the dedicated Unicode ellipsis character because\n                    // it is recommended by some editors, and can be more easily\n                    // identified for find and replace operations.\n                    // Source: http://en.wikipedia.org/wiki/Ellipsis#Computer_representations\n                    //\n                    \n                    // Eventually, this should be localized as a term in CSL, with some\n                    // mechanism for triggering appropriate punctuation handling around\n                    // the ellipsis placeholder (Polish is a particularly tough case for that).\n                    this.ellipsis_term = \"\\u2026\";\n                    // Similar treatment to \"and\", above, will be needed\n                    // here when this becomes a locale term.\n                    this.ellipsis_prefix_single = \" \";\n                    this.ellipsis_prefix_multiple =  state.inheritOpt(this, \"delimiter\", \"name-delimiter\", \", \");\n                    this.ellipsis_suffix = \" \";\n                    this.ellipsis.single = new CSL.Blob(this.ellipsis_term);\n                    this.ellipsis.single.strings.prefix = this.ellipsis_prefix_single;\n                    this.ellipsis.single.strings.suffix = this.ellipsis_suffix;\n                    this.ellipsis.multiple = new CSL.Blob(this.ellipsis_term);\n                    this.ellipsis.multiple.strings.prefix = this.ellipsis_prefix_multiple;\n                    this.ellipsis.multiple.strings.suffix = this.ellipsis_suffix;\n                }\n\n                // et-al parameters are annoyingly incomprehensible\n                // again.\n                //\n                // Explanation probably just adds a further layer of\n                // irritation, but what's INTENDED here is that\n                // the state.tmp et-al variables are set from the\n                // cs:key element when composing sort keys, and a\n                // macro containing a name can be called from cs:key.\n                // So when cs:key sets et-al attributes, they are\n                // set on state.tmp, and when the key is finished\n                // processing, the state.tmp variables are reset to\n                // undefined. IN THEORY the state.tmp et-al variables\n                // will not be used in other contexts. I hope.\n                //\n                // Anyway, the current tests now seem to pass.\n                if (\"undefined\" === typeof state.tmp[\"et-al-min\"]) {\n                    state.tmp[\"et-al-min\"] = state.inheritOpt(this, \"et-al-min\");\n                }\n                if (\"undefined\" === typeof state.tmp[\"et-al-use-first\"]) {\n                    state.tmp[\"et-al-use-first\"] = state.inheritOpt(this, \"et-al-use-first\");\n                }\n                if (\"undefined\" === typeof state.tmp[\"et-al-use-last\"]) {\n                    //print(\"  setting et-al-use-last from name: \"+this.strings[\"et-al-use-last\"]);\n                    state.tmp[\"et-al-use-last\"] = state.inheritOpt(this, \"et-al-use-last\");\n                }\n\n                state.nameOutput.name = this;\n            };\n            \n            state.build.name_flag = true;\n\n            this.execs.push(func);\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node[\"name-part\"] = {\n    build: function (state) {\n        state.build[this.strings.name] = this;\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.names = {\n    build: function (state, target) {\n        var func;\n        // CSL.debug = print;\n\n        if (this.tokentype === CSL.START || this.tokentype === CSL.SINGLETON) {\n            CSL.Util.substituteStart.call(this, state, target);\n            state.build.substitute_level.push(1);\n        }\n        \n        if (this.tokentype === CSL.SINGLETON) {\n            state.build.names_variables[state.build.names_variables.length-1].concat(this.variables);\n            for (var i in this.variables) {\n                var variable = this.variables[i];\n                var name_labels = state.build.name_label[state.build.name_label.length-1];\n                if (Object.keys(name_labels).length) {\n                    name_labels[variable] = name_labels[Object.keys(name_labels)[0]];\n                }\n            }\n            func = function (state) {\n                state.nameOutput.reinit(this, this.variables_real[0]);\n            };\n            this.execs.push(func);\n        }\n\n        if (this.tokentype === CSL.START) {\n\n            state.build.names_flag = true;\n            state.build.name_flag = false;\n            state.build.names_level += 1;\n            state.build.names_variables.push(this.variables);\n            state.build.name_label.push({});\n            // init can substitute\n            // init names\n            func = function (state) {\n                state.tmp.can_substitute.push(true);\n                state.tmp.name_node = {};\n                state.tmp.name_node.children = [];\n                state.nameOutput.init(this);\n            };\n            this.execs.push(func);\n\n        }\n        \n        if (this.tokentype === CSL.END) {\n\n            // Set/reset name blobs if they exist, for processing\n            // by namesOutput()\n            for (var i = 0, ilen = 3; i < ilen; i += 1) {\n                var key = [\"family\", \"given\", \"et-al\"][i];\n                this[key] = state.build[key];\n                if (state.build.names_level === 1) {\n                    state.build[key] = undefined;\n                }\n            }\n            // Labels, if any\n            this.label = state.build.name_label[state.build.name_label.length-1];\n            state.build.names_level += -1;\n            state.build.names_variables.pop();\n            state.build.name_label.pop();\n\n            // The with term. This isn't the right place\n            // for this, but it's all hard-wired at the\n            // moment.\n\n            // \"and\" and \"ellipsis\" are set in node_name.js\n            func = function (state) {\n                // Et-al (strings only)\n                // Blob production has to happen inside nameOutput()\n                // since proper escaping requires access to the output\n                // queue.\n                if (state.tmp.etal_node) {\n                    this.etal_style = state.tmp.etal_node;\n                } else {\n                    this.etal_style = \"empty\";\n                }\n\n                this.etal_term = state.getTerm(state.tmp.etal_term, \"long\", 0);\n                this.etal_prefix_single = \" \";\n                // Should be name delimiter, not hard-wired.\n                this.etal_prefix_multiple = state.tmp.name_delimiter;\n                if (state.tmp[\"delimiter-precedes-et-al\"] === \"always\") {\n                    this.etal_prefix_single = state.tmp.name_delimiter;\n                } else if (state.tmp[\"delimiter-precedes-et-al\"] === \"never\") {\n                    this.etal_prefix_multiple = \" \";\n                } else if (state.tmp[\"delimiter-precedes-et-al\"] === \"after-inverted-name\") {\n                    this.etal_prefix_single = state.tmp.name_delimiter;\n                    this.etal_prefix_multiple = \" \";\n                }\n                this.etal_suffix = \"\";\n                if (!CSL.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)) {\n                    // Not sure what the correct treatment is here, but we should not suppress\n                    // a comma-space.\n                    // https://forums.zotero.org/discussion/76679/delimiter-precedes-et-al-always-dose-not-work-in-locale-zh-cn\n                    if (this.etal_prefix_single === \" \") {\n                        this.etal_prefix_single = \"\";\n                    }\n                    if (this.etal_prefix_multiple === \" \") {\n                        this.etal_prefix_multiple = \"\";\n                    }\n                    if (this.etal_suffix === \" \") {\n                        this.etal_suffix = \"\";\n                    }\n                }\n                // et-al affixes are further adjusted in nameOutput(),\n                // after the term (possibly changed in cs:et-al) is known.\n\n\n                for (var i = 0, ilen = 3; i < ilen; i += 1) {\n                    var key = [\"family\", \"given\"][i];\n                    state.nameOutput[key] = this[key];\n                }\n                state.nameOutput[\"with\"] = this[\"with\"];\n\n                // REMOVE THIS\n                var mywith = \"with\";\n                var with_default_prefix = \"\";\n                var with_suffix = \"\";\n                if (CSL.STARTSWITH_ROMANESQUE_REGEXP.test(mywith)) {\n                    with_default_prefix = \" \";\n                    with_suffix = \" \";\n                }\n                var thewith = {};\n                thewith.single = new CSL.Blob(mywith);\n                thewith.single.strings.suffix = with_suffix;\n                thewith.multiple = new CSL.Blob(mywith);\n                thewith.multiple.strings.suffix = with_suffix;\n                if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"always\") {\n                    thewith.single.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                    thewith.multiple.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                } else if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"contextual\") {\n                    thewith.single.strings.prefix = with_default_prefix;\n                    thewith.multiple.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                } else if (state.inheritOpt(state.nameOutput.name, \"delimiter-precedes-last\") === \"after-inverted-name\") {\n                    thewith.single.strings.prefix = state.inheritOpt(this, \"delimiter\", \"names-delimiter\");\n                    thewith.multiple.strings.prefix = with_default_prefix;\n                } else {\n                    thewith.single.strings.prefix = with_default_prefix;\n                    thewith.multiple.strings.prefix = with_default_prefix;\n                }\n                state.nameOutput[\"with\"] = thewith;\n\n\n                // XXX label style should be set per variable, since they may differ\n                // XXX with full-form nested names constructs\n                state.nameOutput.label = this.label;\n\n                state.nameOutput.etal_style = this.etal_style;\n                state.nameOutput.etal_term = this.etal_term;\n                state.nameOutput.etal_prefix_single = this.etal_prefix_single;\n                state.nameOutput.etal_prefix_multiple = this.etal_prefix_multiple;\n                state.nameOutput.etal_suffix = this.etal_suffix;\n                state.nameOutput.outputNames();\n                state.tmp[\"et-al-use-first\"] = undefined;\n                state.tmp[\"et-al-min\"] = undefined;\n                state.tmp[\"et-al-use-last\"] = undefined;\n            };\n            this.execs.push(func);\n\n            // unsets\n            func = function (state) {\n                if (!state.tmp.can_substitute.pop()) {\n                    state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                }\n                \n                // For posterity ...\n                //\n                // This was enough to fix the issue reported here:\n                //\n                //   http://forums.zotero.org/discussion/25223/citeproc-bug-substitute-doesnt-work-correctly-for-title-macro/\n                //\n                // The remainder of the changes applied in the same patch\n                // relate to a label assignments, which were found to be\n                // buggy while working on the issue. The test covering\n                // both problems is here:\n                //\n                //   https://bitbucket.org/bdarcus/citeproc-test/src/ab136a6aa8f2/processor-tests/humans/substitute_SuppressOrdinaryVariable.txt\n                if (state.tmp.can_substitute.mystack.length === 1) {\n                    state.tmp.can_block_substitute = false;\n                }\n            };\n            this.execs.push(func);\n\n            state.build.name_flag = false;\n        }\n        target.push(this);\n\n        if (this.tokentype === CSL.END || this.tokentype === CSL.SINGLETON) {\n            state.build.substitute_level.pop();\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n/*global CSL: true */\n\nCSL.Node.number = {\n    build: function (state, target) {\n        var func;\n        CSL.Util.substituteStart.call(this, state, target);\n        //\n        // This should push a rangeable object to the queue.\n        //\n        if (this.strings.form === \"roman\") {\n            this.formatter = state.fun.romanizer;\n        } else if (this.strings.form === \"ordinal\") {\n            this.formatter = state.fun.ordinalizer;\n        } else if (this.strings.form === \"long-ordinal\") {\n            this.formatter = state.fun.long_ordinalizer;\n        }\n        if (\"undefined\" === typeof this.successor_prefix) {\n            this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n        }\n        if (\"undefined\" === typeof this.splice_prefix) {\n            this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n        }\n        // is this needed?\n        //if (\"undefined\" === typeof this.splice_prefix){\n        //    this.splice_prefix = state[state.tmp.area].opt.layout_delimiter;\n        //}\n        //\n        // Whether we actually stick a number object on\n        // the output queue depends on whether the field\n        // contains a pure number.\n        //\n        // push number or text\n        func = function (state, Item, item) {\n            // NOTE: this works because this is the ONLY function in this node.\n            // If further functions are added, they need to start with the same\n            // abort condition.\n            if (this.variables.length === 0) {\n                return;\n            }\n            var varname;\n            varname = this.variables[0];\n            if (\"undefined\" === typeof item) {\n                var item = {};\n            }\n            if ([\"locator\", \"locator-extra\"].indexOf(varname) > -1) {\n                if (state.tmp.just_looking) {\n                    return;\n                }\n                if (!item[varname]) {\n                    return;\n                }\n            } else {\n                if (!Item[varname]) {\n                    return;\n                }\n            }\n\n            if (varname === 'collection-number' && Item.type === 'legal_case') {\n                state.tmp.renders_collection_number = true;\n            }\n            \n            // For bill or legislation items that have a label-form\n            // attribute set on the cs:number node rendering the locator,\n            // the form and pluralism of locator terms are controlled\n            // separately from those of the initial label. Form is\n            // straightforward: the label uses the value set on\n            // the cs:label node that renders it, and the embedded\n            // labels use the value of label-form set on the cs:number\n            // node. Both default to \"long\".\n            //\n            // Pluralism is more complicated. For embedded labels,\n            // pluralism is evaluated using a simple heuristic that\n            // can be found below (it just looks for comma, ampersand etc).\n            // The item.label rendered independently via cs:label\n            // defaults to singular. It is always singular if embedded\n            // labels exist that (when expanded to their valid CSL\n            // value) do not match the value of item.label. Otherwise,\n            // if one or more matching embedded labels exist, the\n            // cs:label is set to plural.\n            //\n            // The code that does all this is divided between this module,\n            // util_static_locator.js, and util_label.js. It's not easy\n            // to follow, but seems to do the job. Let's home for good\n            // luck out there in the wild.\n            \n            var node = this;\n\n            if (state.tmp.group_context.tip.force_suppress) {\n                return false;\n            }\n\n            if ([\"locator\", \"locator-extra\"].indexOf(varname) > -1) {\n                // amazing that we reach this. should abort sooner if no content?\n                state.processNumber.call(state, node, item, varname, Item.type);\n            } else {\n                if (!state.tmp.group_context.tip.condition && Item[varname]) {\n                    state.tmp.just_did_number = (\"\" + Item[varname]).match(/[0-9]$/);\n                }\n                // UPDATE_GROUP_CONTEXT_CONDITION is run by processNumber\n                state.processNumber.call(state, node, Item, varname, Item.type);\n            }\n\n            if (this.substring) {\n                var val = Item[varname].slice(this.substring);\n                state.output.append(val, node);\n            } else {\n                CSL.Util.outputNumericField(state, varname, Item.id);\n            }\n\n            if ([\"locator\", \"locator-extra\"].indexOf(this.variables_real[0]) > -1\n               && !state.tmp.just_looking) {\n                state.tmp.done_vars.push(this.variables_real[0]);\n                state.tmp.group_context.tip.done_vars.push(this.variables_real[0]);\n            }\n        };\n        this.execs.push(func);\n        target.push(this);\n        \n        CSL.Util.substituteEnd.call(this, state, target);\n    }\n};\n\n/*global CSL: true */\n\n/*\n * Yikes, these functions were running out of scope for yonks.\n * now that they are set in the correct token list,\n * they might be useful for things.\n * FB 2013.11.09\n*/\n\nCSL.Node.sort = {\n    build: function (state, target) {\n        target = state[state.build.root + \"_sort\"].tokens;\n        if (this.tokentype === CSL.START) {\n            if (state.build.area === \"citation\") {\n                state.opt.sort_citations = true;\n            }\n            state.build.area = state.build.root + \"_sort\";\n            state.build.extension = \"_sort\";\n            \n            var func = function (state, Item) {\n                //state.tmp.area = state.tmp.root + \"_sort\";\n                //state.tmp.extension = \"_sort\";\n                if (state.opt.has_layout_locale) {\n                    var langspec = CSL.localeResolve(Item.language, state.opt[\"default-locale\"][0]);\n                    var sort_locales = state[state.tmp.area.slice(0,-5)].opt.sort_locales;\n                    var langForItem;\n                    for (var i=0,ilen=sort_locales.length;i<ilen;i+=1) {\n                        langForItem = sort_locales[i][langspec.bare];\n                        if (!langForItem) {\n                            langForItem = sort_locales[i][langspec.best];\n                        }\n                        if (langForItem) {\n                            break;\n                        }\n                    }\n                    if (!langForItem) {\n                        langForItem = state.opt[\"default-locale\"][0];\n                    }\n                    state.tmp.lang_sort_hold = state.opt.lang;\n                    state.opt.lang = langForItem;\n                }\n            };\n            this.execs.push(func);\n            \n        }\n        if (this.tokentype === CSL.END) {\n            state.build.area = state.build.root;\n            state.build.extension = \"\";\n            var func = function (state) {\n                if (state.opt.has_layout_locale) {\n                    state.opt.lang = state.tmp.lang_sort_hold;\n                    delete state.tmp.lang_sort_hold;\n                }\n                //state.tmp.area = state.tmp.root;\n                //state.tmp.extension = \"\";\n            };\n            this.execs.push(func);\n            /*\n            var func = function (state, Item) {\n                state.tmp.area = state.tmp.root;\n                state.tmp.extension = \"\";\n            }\n            this.execs.push(func);\n            */\n        }\n        target.push(this);\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.substitute = {\n    build: function (state, target) {\n        var func;\n        if (this.tokentype === CSL.START) {\n            /* */\n            // set conditional\n            var choose_start = new CSL.Token(\"choose\", CSL.START);\n            CSL.Node.choose.build.call(choose_start, state, target);\n            var if_singleton = new CSL.Token(\"if\", CSL.SINGLETON);\n            func = function() {\n                if (state.tmp.value.length && !state.tmp.common_term_match_fail) {\n                    return true;\n                }\n                return false;\n            }\n            if_singleton.tests = [func];\n            if_singleton.test = state.fun.match.any(if_singleton, state, if_singleton.tests);\n            target.push(if_singleton);\n\n            func = function (state) {\n                state.tmp.can_block_substitute = true;\n                if (state.tmp.value.length && !state.tmp.common_term_match_fail) {\n                    state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                }\n                state.tmp.common_term_match_fail = false;\n            };\n            this.execs.push(func);\n            target.push(this);\n            /* */\n        }\n        if (this.tokentype === CSL.END) {\n            //var if_end = new CSL.Token(\"if\", CSL.END);\n            //CSL.Node[\"if\"].build.call(if_end, state, target);\n            /* */\n            target.push(this);\n            var choose_end = new CSL.Token(\"choose\", CSL.END);\n            CSL.Node.choose.build.call(choose_end, state, target);\n            /* */\n        }\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.text = {\n    build: function (state, target) {\n        var func, form, plural, id, num, number, formatter, firstoutput, specialdelimiter, label, suffix, term;\n        if (this.postponed_macro) {\n            var group_start = CSL.Util.cloneToken(this);\n            group_start.name = \"group\";\n            group_start.tokentype = CSL.START;\n            CSL.Node.group.build.call(group_start, state, target);\n\n            CSL.expandMacro.call(state, this, target);\n\n            var group_end = CSL.Util.cloneToken(this);\n            group_end.name = \"group\";\n            group_end.tokentype = CSL.END;\n            if (this.postponed_macro === 'juris-locator-label') {\n                group_end.isJurisLocatorLabel = true;\n            }\n            CSL.Node.group.build.call(group_end, state, target);\n\n        } else {\n            CSL.Util.substituteStart.call(this, state, target);\n            // ...\n            //\n            // Do non-macro stuff\n            \n            // Guess again. this.variables is ephemeral, adjusted by an initial\n            // function set on the node via @variable attribute setup.\n            //variable = this.variables[0];\n            \n            if (!this.variables_real) {\n                this.variables_real = [];\n            }\n            if (!this.variables) {\n                this.variables = [];\n            }\n\n            form = \"long\";\n            plural = 0;\n            if (this.strings.form) {\n                form = this.strings.form;\n            }\n            if (this.strings.plural) {\n                plural = this.strings.plural;\n            }\n            if (\"citation-number\" === this.variables_real[0] || \"year-suffix\" === this.variables_real[0] || \"citation-label\" === this.variables_real[0]) {\n                //\n                // citation-number and year-suffix are super special,\n                // because they are rangeables, and require a completely\n                // different set of formatting parameters on the output\n                // queue.\n                if (this.variables_real[0] === \"citation-number\") {\n\n                    if (state.build.root === \"citation\") {\n                        state.opt.update_mode = CSL.NUMERIC;\n                    }\n                    if (state.build.root === \"bibliography\") {\n                        state.opt.bib_mode = CSL.NUMERIC;\n                    }\n                    //this.strings.is_rangeable = true;\n                    if (\"citation-number\" === state[state.tmp.area].opt.collapse) {\n                        this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    this.splice_prefix = state[state.build.area].opt.layout_delimiter;\n                    func = function (state, Item, item) {\n\n                        id = \"\" + Item.id;\n                        if (!state.tmp.just_looking) {\n                            if (state.tmp.area.slice(-5) === \"_sort\" && this.variables[0] === \"citation-number\") {\n                                if (state.tmp.area === \"bibliography_sort\") {\n                                    state.tmp.group_context.tip.done_vars.push(\"citation-number\");\n                                }\n                                if (state.tmp.area === \"citation_sort\" && state.bibliography_sort.tmp.citation_number_map) {\n                                    var num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[Item.id].seq];\n                                } else {\n                                    var num = state.registry.registry[Item.id].seq;\n                                }\n                                if (num) {\n                                    // Code currently in util_number.js\n                                    num = CSL.Util.padding(\"\" + num);\n                                }\n                                state.output.append(num, this);\n                                return;\n                            }\n                            if (item && item[\"author-only\"]) {\n                                state.tmp.element_trace.replace(\"suppress-me\");\n                            }\n                            if (state.tmp.area !== \"bibliography_sort\" && state.bibliography_sort.tmp.citation_number_map && state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n                                num = state.bibliography_sort.tmp.citation_number_map[state.registry.registry[id].seq];\n                            } else {\n                                num = state.registry.registry[id].seq;\n                            }\n                            if (state.opt.citation_number_slug) {\n                                state.output.append(state.opt.citation_number_slug, this);\n                            } else {\n                                number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                                if (state.tmp.in_cite_predecessor) {\n                                    number.suppress_splice_prefix = true;\n                                }\n                                state.output.append(number, \"literal\");\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                } else if (this.variables_real[0] === \"year-suffix\") {\n\n                    state.opt.has_year_suffix = true;\n\n                    if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                        //this.range_prefix = \"-\";\n                        this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                    }\n                    this.successor_prefix = state[state.build.area].opt.layout_delimiter;\n                    if (state[state.tmp.area].opt[\"year-suffix-delimiter\"]) {\n                        this.successor_prefix = state[state.build.area].opt[\"year-suffix-delimiter\"];\n                    }\n                    func = function (state, Item) {\n                        if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false && !state.tmp.just_looking) {\n                            //state.output.append(state.registry.registry[Item.id].disambig[2],this);\n                            num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n\n                            //if (state[state.tmp.area].opt.collapse === \"year-suffix-ranged\") {\n                            //    //this.range_prefix = \"-\";\n                            //    this.range_prefix = state.getTerm(\"citation-range-delimiter\");\n                            //}\n                            //this.successor_prefix = state[state.tmp.area].opt.layout_delimiter;\n                            if (state[state.tmp.area].opt.cite_group_delimiter) {\n                                this.successor_prefix = state[state.tmp.area].opt.cite_group_delimiter;\n                            }\n                            number = new CSL.NumericBlob(state, false, num, this, Item.id);\n                            formatter = new CSL.Util.Suffixator(CSL.SUFFIX_CHARS);\n                            number.setFormatter(formatter);\n                            state.output.append(number, \"literal\");\n                            firstoutput = false;\n                            // XXX Can we do something better for length here?\n                            for (var i=0,ilen=state.tmp.group_context.mystack.length; i<ilen; i++) {\n                                var flags = state.tmp.group_context.mystack[i];\n                                if (!flags.variable_success && (flags.variable_attempt || (!flags.variable_attempt && !flags.term_intended))) {\n                                    firstoutput = true;\n                                    break;\n                                }\n                            }\n                            specialdelimiter = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                            if (firstoutput && specialdelimiter && !state.tmp.sort_key_flag) {\n                                state.tmp.splice_delimiter = state[state.tmp.area].opt[\"year-suffix-delimiter\"];\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n                } else if (this.variables_real[0] === \"citation-label\") {\n                    if (state.build.root === \"bibliography\") {\n                        state.opt.bib_mode = CSL.TRIGRAPH;\n                    }\n                    state.opt.has_year_suffix = true;\n                    func = function (state, Item) {\n                        label = Item[\"citation-label\"];\n                        if (!label) {\n                            label = state.getCitationLabel(Item);\n                        }\n                        if (!state.tmp.just_looking) {\n                            suffix = \"\";\n                            if (state.registry.registry[Item.id] && state.registry.registry[Item.id].disambig.year_suffix !== false) {\n                                num = parseInt(state.registry.registry[Item.id].disambig.year_suffix, 10);\n                                suffix = state.fun.suffixator.format(num);\n                            }\n                            label += suffix;\n                        }\n                        state.output.append(label, this);\n                    };\n                    this.execs.push(func);\n                }\n            } else {\n                if (this.strings.term) {\n                    \n                    // printterm\n                    func = function (state, Item) {\n                        var gender = state.opt.gender[Item.type];\n                        var term = this.strings.term;\n                        term = state.getTerm(term, form, plural, gender, CSL.TOLERANT, this.default_locale);\n                        var myterm;\n                        // if the term is not an empty string, say\n                        // that we rendered a term\n                        if (term !== \"\") {\n                            state.tmp.group_context.tip.term_intended = true;\n                        }\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, term, null, this);\n                        \n                        // capitalize the first letter of a term, if it is the\n                        // first thing rendered in a citation (or if it is\n                        // being rendered immediately after terminal punctuation,\n                        // I guess, actually).\n                        if (!state.tmp.term_predecessor && !(state.opt[\"class\"] === \"in-text\" && state.tmp.area === \"citation\")) {\n                            myterm = CSL.Output.Formatters[\"capitalize-first\"](state, term);\n                            //CSL.debug(\"Capitalize\");\n                        } else {\n                            myterm = term;\n                        }\n                        \n                        // XXXXX Cut-and-paste code in multiple locations. This code block should be\n                        // collected in a function.\n                        // Tag: strip-periods-block\n                        if (state.tmp.strip_periods) {\n                            myterm = myterm.replace(/\\./g, \"\");\n                        } else {\n                            for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n                                if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                                    myterm = myterm.replace(/\\./g, \"\");\n                                    break;\n                                }\n                            }\n                        }\n                        state.output.append(myterm, this);\n                        if (state.tmp.can_block_substitute) {\n                            // Black magic here. This causes the cs:substitution condition to pass,\n                            // blocking further rendering within its scope. \n                            state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                        }\n                    };\n                    this.execs.push(func);\n                    state.build.term = false;\n                    state.build.form = false;\n                    state.build.plural = false;\n                } else if (this.variables_real.length) {\n                    func = function (state, Item) {\n\n                        // If some text variable is rendered, we're not collapsing.\n                        if (this.variables_real[0] !== \"locator\") {\n                            state.tmp.have_collapsed = false;\n                        }\n\n                        if (!state.tmp.group_context.tip.condition && Item[this.variables[0]]) {\n                            state.tmp.just_did_number = false;\n                        }\n                        var val = Item[this.variables[0]];\n                        if (val && !state.tmp.group_context.tip.condition) {\n                            if ((\"\" + val).slice(-1).match(/[0-9]/)) {\n                                state.tmp.just_did_number = true;\n                            } else {\n                                state.tmp.just_did_number = false;\n                            }\n                        }\n                    };\n                    this.execs.push(func);\n\n                    // plain string fields\n\n                    // Deal with multi-fields and ordinary fields separately.\n                    if (CSL.MULTI_FIELDS.indexOf(this.variables_real[0]) > -1\n                        || this.variables_real[0].indexOf(\"-main\") > -1\n                        || this.variables_real[0].indexOf(\"-sub\") > -1\n                        || [\"language-name\", \"language-name-original\"].indexOf(this.variables_real[0]) > -1\n                       ) {\n\n                        // multi-fields\n                        // Initialize transform factory according to whether\n                        // abbreviation is desired.\n                        var abbrevfam = this.variables[0];\n                        var abbrfall = false;\n                        var altvar = false;\n                        var transfall = false;\n                        if (form === \"short\") {\n                            if (this.variables_real[0].slice(-6) !== \"-short\") {\n                                altvar = this.variables_real[0] + \"-short\";\n                            }\n                        } else {\n                            abbrevfam = false;\n                        }\n                        if (state.build.extension) {\n                            // multi-fields for sorting get a sort transform,\n                            // (abbreviated if the short form was selected)\n                            transfall = true;\n                        } else {\n                            transfall = true;\n                            abbrfall = true;\n\t\t\t\t\t\t}\n\n                        func = state.transform.getOutputFunction(this.variables, abbrevfam, abbrfall, altvar, transfall);\n                    } else {\n                        // ordinary fields\n                        if (CSL.CITE_FIELDS.indexOf(this.variables_real[0]) > -1) {\n                            // per-cite fields are read from item, rather than Item\n                            func = function (state, Item, item) {\n                                if (item && item[this.variables[0]]) {\n                                    // Code copied to page variable as well; both\n                                    // become cs:number in MLZ extended schema\n                                    \n                                    // If locator, use cs:number. Otherwise, render\n                                    // normally.\n\n                                    // XXX The code below is pretty-much copied from\n                                    // XXX node_number.js. Should be a common function.\n                                    // XXX BEGIN\n                                    state.processNumber(this, item, this.variables[0], Item.type);\n                                    CSL.Util.outputNumericField(state, this.variables[0], Item.id);\n                                    // XXX END\n\n                                    if ([\"locator\", \"locator-extra\"].indexOf(this.variables_real[0]) > -1\n                                       && !state.tmp.just_looking) { \n                                        state.tmp.done_vars.push(this.variables_real[0]);\n                                    }\n                                }\n                            };\n                        } else  if ([\"page\", \"page-first\", \"chapter-number\", \"collection-number\", \"edition\", \"issue\", \"number\", \"number-of-pages\", \"number-of-volumes\", \"volume\"].indexOf(this.variables_real[0]) > -1) {\n                            // page gets mangled with the correct collapsing\n                            // algorithm\n                            func = function(state, Item) {\n                                state.processNumber(this, Item, this.variables[0], Item.type);\n                                CSL.Util.outputNumericField(state, this.variables[0], Item.id);\n                            };\n                        } else if ([\"URL\", \"DOI\"].indexOf(this.variables_real[0]) > -1) {\n                            func = function (state, Item) {\n                                var value;\n                                if (this.variables[0]) {\n                                    value = state.getVariable(Item, this.variables[0], form);\n                                    if (value) {\n                                        if (this.variables[0] === \"URL\" && form === \"short\") {\n                                            value = value.replace(/(.*\\.[^\\/]+)\\/.*/, \"$1\");\n                                            if (value.match(/\\/\\/www\\./)) {\n                                                value = value.replace(/https?:\\/\\//, \"\");\n                                            }\n                                        }\n                                        // true is for non-suppression of periods\n                                        if (state.opt.development_extensions.wrap_url_and_doi) {\n                                            if (!this.decorations.length || this.decorations[0][0] !== \"@\" + this.variables[0]) {\n                                                // Special-casing to fix https://github.com/Juris-M/citeproc-js/issues/57\n                                                // clone current token, to avoid collateral damage\n                                                var clonetoken = CSL.Util.cloneToken(this);\n                                                // cast a group blob\n                                                var groupblob = new CSL.Blob(null, null, \"url-wrapper\");\n                                                // set the DOI decoration on the blob\n                                                groupblob.decorations.push([\"@DOI\", \"true\"]);\n                                                if (this.variables_real[0] === \"DOI\") {\n                                                    // strip a proper DOI prefix\n                                                    var prefix;\n                                                    if (this.strings.prefix && this.strings.prefix.match(/^.*https:\\/\\/doi\\.org\\/$/)) {\n                                                        value = value.replace(/^https?:\\/\\/doi\\.org\\//, \"\");\n                                                        if (value.match(/^https?:\\/\\//)) {\n                                                            // Do not tamper with another protocol + domain if already set in field value\n                                                            prefix = \"\";\n                                                        } else {\n                                                            // Otherwise https + domain\n                                                            prefix = \"https://doi.org/\";\n                                                        }\n                                                        // set any string prefix on the clone\n                                                        clonetoken.strings.prefix = this.strings.prefix.slice(0, clonetoken.strings.prefix.length-16);\n                                                    }\n                                                    // cast a text blob\n                                                    // set the prefix as the content of the blob\n                                                    var prefixblob = new CSL.Blob(prefix);\n                                                    // cast another text blob\n                                                    // set the value as the content of the second blob\n                                                    var valueblob = new CSL.Blob(value);\n                                                    // append new text token and clone to group token\n                                                    groupblob.push(prefixblob);\n                                                    groupblob.push(valueblob);\n                                                    // append group token to output\n                                                    state.output.append(groupblob, clonetoken, false, false, true);\n                                                } else {\n                                                    var valueblob = new CSL.Blob(value);\n                                                    // append new text token and clone to group token\n                                                    groupblob.push(valueblob);\n                                                    // append group token to output\n                                                    //this.decorations = [[\"@\" + this.variables[0], \"true\"]].concat(this.decorations);\n                                                    state.output.append(groupblob, clonetoken, false, false, true);\n                                                }\n                                            } else {\n                                                state.output.append(value, this, false, false, true);\n                                            }\n                                        } else {\n                                            // This is totally unnecessary, isn't it?\n                                            if (this.decorations.length) {\n                                                for (var i=this.decorations.length-1; i>-1; i--) {\n                                                    if (this.decorations[i][0] === \"@\" + this.variables[0]) {\n                                                        this.decorations = this.decorations.slice(0, i).concat(this.decorations.slice(i+1));\n                                                    }\n                                                }\n                                            }\n                                            state.output.append(value, this, false, false, true);\n                                        }\n                                    }\n                                }\n                            };\n                        } else if (this.variables_real[0] === \"section\") {\n                            // Sections for statutes are special. This is an uncommon\n                            // variable, so we save the cost of the runtime check\n                            // unless it's being used.\n                            func = function (state, Item) {\n                                var value;\n                                value = state.getVariable(Item, this.variables[0], form);\n                                if (value) {\n                                    state.output.append(value, this);\n                                }\n                            };\n                        } else if (this.variables_real[0] === \"hereinafter\") {\n                            func = function (state, Item) {\n                                var value = state.transform.abbrevs[\"default\"][\"hereinafter\"][Item.id];\n                                if (value) {\n                                    state.output.append(value, this);\n                                    state.tmp.group_context.tip.variable_success = true;\n                                }\n                            };\n                        } else {\n                            // anything left over just gets output in the normal way.\n                            func = function (state, Item) {\n                                var value;\n                                if (this.variables[0]) {\n                                    value = state.getVariable(Item, this.variables[0], form);\n                                    if (value) {\n                                        value = \"\" + value;\n                                        value = value.split(\"\\\\\").join(\"\");\n                                        state.output.append(value, this);\n                                    }\n                                }\n                            };\n                        }\n                    }\n                    this.execs.push(func);\n                } else if (this.strings.value) {\n                    // for the text value attribute.\n                    func = function (state) {\n                        state.tmp.group_context.tip.term_intended = true;\n                        // true flags that this is a literal-value term\n                        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, this.strings.value, true, this);\n                        state.output.append(this.strings.value, this);\n                        if (state.tmp.can_block_substitute) {\n                            // Black magic here. This causes the cs:substitution condition to pass,\n                            // blocking further rendering within its scope. \n                            state.tmp.can_substitute.replace(false, CSL.LITERAL);\n                        }\n                    };\n                    this.execs.push(func);\n                    // otherwise no output\n                }\n            }\n            target.push(this);\n            CSL.Util.substituteEnd.call(this, state, target);\n        }\n    }\n};\n\n\n\n/*global CSL: true */\n\nCSL.Node.intext = {\n    build: function (state, target) {\n        if (this.tokentype === CSL.START) {\n\n            state.build.area = \"intext\";\n            state.build.root = \"intext\";\n            state.build.extension = \"\";\n\n            var func = function(state, Item) {\n                state.tmp.area = \"intext\";\n                state.tmp.root = \"intext\";\n                state.tmp.extension = \"\";\n            }\n            this.execs.push(func);\n        }\n        if (this.tokentype === CSL.END) {\n\n            // Do whatever cs:citation does with sorting.\n            state.intext_sort = {\n                opt: {\n                    sort_directions: state.citation_sort.opt.sort_directions\n                }\n            }\n            state.intext.srt = state.citation.srt;\n        }\n        target.push(this);\n    }\n};\n\n\n/*global CSL: true */\n\nCSL.Attributes = {};\n\nCSL.Attributes[\"@disambiguate\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    if (arg === \"true\") {\n        state.opt.has_disambiguate = true;\n        var func = function (Item) {\n            if (state.tmp.area === \"bibliography\") {\n                if (state.tmp.disambiguate_count < state.registry.registry[Item.id].disambig.disambiguate) {\n                    state.tmp.disambiguate_count += 1;\n                    return true;\n                }\n            } else {\n                state.tmp.disambiguate_maxMax += 1;\n                if (state.tmp.disambig_settings.disambiguate\n                    && state.tmp.disambiguate_count < state.tmp.disambig_settings.disambiguate) {\n                    state.tmp.disambiguate_count += 1;\n                    return true;\n                }\n            }\n            return false;\n        };\n        this.tests.push(func);\n    } else if (arg === \"check-ambiguity-and-backreference\") {\n        var func = function (Item) {\n            if (state.registry.registry[Item.id].disambig.disambiguate && state.registry.registry[Item.id][\"citation-count\"] > 1) {\n                return true;\n            }\n            return false;\n        };\n        this.tests.push(func);\n    }\n};\n\nCSL.Attributes[\"@is-numeric\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var variables = arg.split(/\\s+/);\n    var maketest = function(variable) {\n        return function (Item, item) {\n            var myitem = Item;\n            if (item && [\"locator\",\"locator-extra\"].indexOf(variable) > -1) {\n                myitem = item;\n            }\n            if (!myitem[variable]) {\n                return false;\n            }\n            if (CSL.NUMERIC_VARIABLES.indexOf(variable) > -1) {\n                if (!state.tmp.shadow_numbers[variable]) {\n                    state.processNumber(false, myitem, variable, Item.type);\n                }\n                if (state.tmp.shadow_numbers[variable].numeric) {\n                    return true;\n                }\n            } else if ([\"title\",\"version\"].indexOf(variable) > -1) {\n                if (myitem[variable].slice(-1) === \"\" + parseInt(myitem[variable].slice(-1), 10)) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    for (var i=0; i<variables.length; i+=1) {\n        this.tests.push(maketest(variables[i]));\n    }\n};\n\n\nCSL.Attributes[\"@is-uncertain-date\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var variables = arg.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (myvariable) {\n        return function(Item) {\n            if (Item[myvariable] && Item[myvariable].circa) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=variables.length;i<ilen;i+=1) {\n        this.tests.push(maketest(variables[i]));\n    }\n};\n\n\nCSL.Attributes[\"@locator\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.replace(\"sub verbo\", \"sub-verbo\");\n    trylabels = trylabels.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (trylabel) {\n        return function(Item, item) {\n            var label;\n            state.processNumber(false, item, \"locator\");\n            label = state.tmp.shadow_numbers.locator.label;\n            if (label && trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\n\nCSL.Attributes[\"@position\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var tryposition;\n    state.opt.update_mode = CSL.POSITION;\n    var trypositions = arg.split(/\\s+/);\n    var testSubsequentNear = function (Item, item) {\n        if (item && CSL.POSITION_MAP[item.position] >= CSL.POSITION_MAP[CSL.POSITION_SUBSEQUENT] && item[\"near-note\"]) {\n            return true;\n        }\n        return false;\n    };\n    var testSubsequentNotNear = function (Item, item) {\n        if (item && CSL.POSITION_MAP[item.position] == CSL.POSITION_MAP[CSL.POSITION_SUBSEQUENT] && !item[\"near-note\"]) {\n            return true;\n        }\n        return false;\n    };\n    var maketest = function(tryposition) {\n        return function (Item, item) {\n            if (state.tmp.area === \"bibliography\") {\n                return false;\n            }\n            if (item && \"undefined\" === typeof item.position) {\n                item.position = 0;\n            }\n            if (item && typeof item.position === \"number\") {\n                if (item.position === 0 && tryposition === 0) {\n                    return true;\n                } else if (tryposition > 0 && CSL.POSITION_MAP[item.position] >= CSL.POSITION_MAP[tryposition]) {\n                    return true;\n                }\n            } else if (tryposition === 0) {\n                return true;\n            }\n            return false;\n        };\n    };\n    for (var i=0,ilen=trypositions.length;i<ilen;i+=1) {\n        var tryposition = trypositions[i];\n        if (tryposition === \"first\") {\n            tryposition = CSL.POSITION_FIRST;\n        } else if (tryposition === \"container-subsequent\") {\n            tryposition = CSL.POSITION_CONTAINER_SUBSEQUENT;\n        } else if (tryposition === \"subsequent\") {\n            tryposition = CSL.POSITION_SUBSEQUENT;\n        } else if (tryposition === \"ibid\") {\n            tryposition = CSL.POSITION_IBID;\n        } else if (tryposition === \"ibid-with-locator\") {\n            tryposition = CSL.POSITION_IBID_WITH_LOCATOR;\n        }\n        if (\"near-note\" === tryposition) {\n            this.tests.push(testSubsequentNear);\n        } else if (\"far-note\" === tryposition) {\n            this.tests.push(testSubsequentNotNear);\n        } else {\n            this.tests.push(maketest(tryposition));\n        }\n    }\n};\n\nCSL.Attributes[\"@type\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    // XXX This is ALWAYS composed as an \"any\" match\n    var types = arg.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (mytype) {\n        return function(Item) {\n            var ret = (Item.type === mytype);\n            if (ret) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    var tests = [];\n    for (var i=0,ilen=types.length;i<ilen;i+=1) {\n        tests.push(maketest(types[i]));\n    }\n    this.tests.push(state.fun.match.any(this, state, tests));\n};\n\nCSL.Attributes[\"@variable\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func;\n    this.variables = arg.split(/\\s+/);\n    this.variables_real = this.variables.slice();\n\n    // First the non-conditional code.\n    if (\"label\" === this.name && this.variables[0]) {\n        this.strings.term = this.variables[0];\n    } else if ([\"names\", \"date\", \"text\", \"number\"].indexOf(this.name) > -1) {\n        //\n        // An oddity of variable handling is that this.variables\n        // is actually ephemeral; the full list of variables is\n        // held in the variables_real var, and pushed into this.variables\n        // conditionally in order to suppress repeat renderings of\n        // the same item variable.  [STILL FUNCTIONAL? 2010.01.15]\n        //\n        // set variable names\n        func = function (state, Item, item) {\n            // Clear this.variables in place\n            for (var i = this.variables.length - 1; i > -1; i += -1) {\n                this.variables.pop();\n            }\n            for (var i=0,ilen=this.variables_real.length;i<ilen;i++) {\n                // set variable name if not quashed, and if not the title of a legal case w/suppress-author\n                if (state.tmp.done_vars.indexOf(this.variables_real[i]) === -1 \n// This looks nuts. Why suppress a case name if not required by context?\n//                    && !(item && Item.type === \"legal_case\" && item[\"suppress-author\"] && this.variables_real[i] === \"title\")\n                   ) {\n                    this.variables.push(this.variables_real[i]);\n                }\n                if (state.tmp.can_block_substitute) {\n                    state.tmp.done_vars.push(this.variables_real[i]);\n                }\n            }\n        };\n        this.execs.push(func);\n\n        // check for output\n        func = function (state, Item, item) {\n            var output = false;\n            for (var i=0,ilen=this.variables.length;i<ilen;i++) {\n                var variable = this.variables[i];\n                if ([\"authority\", \"committee\"].indexOf(variable) > -1\n                    && \"string\" === typeof Item[variable]\n                    && \"names\" === this.name) {\n\n                    // Great! So for each of these, we split.\n                    // And we only recombine everything if the length\n                    // of all the splits matches.\n                    \n                    // Preflight\n                    var isValid = true;\n                    var rawNames = Item[variable].split(/\\s*;\\s*/);\n                    var rawMultiNames = {};\n                    if (Item.multi && Item.multi._keys[variable]) {\n                        for (var langTag in Item.multi._keys[variable]) {\n                            rawMultiNames[langTag] = Item.multi._keys[variable][langTag].split(/\\s*;\\s*/);\n                            if (rawMultiNames[langTag].length !== rawNames.length) {\n                                isValid = false;\n                                break;\n                            }\n                        }\n                    }\n                    if (!isValid) {\n                        rawNames = [Item[variable]];\n                        rawMultiNames = Item.multi._keys[variable];\n                    }\n                    for (var j = 0, jlen = rawNames.length; j < jlen; j++) {\n                        var creatorParent = {\n                            literal:rawNames[j],\n                            multi:{\n                                _key:{}\n                            }\n                        };\n                        for (var langTag in rawMultiNames) {\n                            var creatorChild = {\n                                literal:rawMultiNames[langTag][j]\n                            };\n                            creatorParent.multi._key[langTag] = creatorChild;\n                        }\n                        rawNames[j] = creatorParent;\n                    }\n                    Item[variable] = rawNames;\n                }\n                if (this.strings.form === \"short\" && !Item[variable]) {\n                    if (variable === \"title\") {\n                        variable = \"title-short\";\n                    } else if (variable === \"container-title\") {\n                        variable = \"container-title-short\";\n                    }\n                }\n                if (variable === \"year-suffix\") {\n                    // year-suffix always signals that it produces output,\n                    // even when it doesn't. This permits it to be used with\n                    // the \"no date\" term inside a group used exclusively\n                    // to control formatting.\n                    output = true;\n                    break;\n                } else if (CSL.DATE_VARIABLES.indexOf(variable) > -1) {\n                    if (state.opt.development_extensions.locator_date_and_revision && \"locator-date\" === variable) {\n                        // If locator-date is set, it's valid.\n                        output = true;\n                        break;\n                    }\n                    if (Item[variable]) {\n                        for (var key in Item[variable]) {\n                            if (this.dateparts.indexOf(key) === -1 && \"literal\" !== key) {\n                                continue;\n                            }\n                            if (Item[variable][key]) {\n                                output = true;\n                                break;\n                            }\n                        }\n                        if (output) {\n                            break;\n                        }\n                    }\n                } else if (\"locator\" === variable) {\n                    if (item && item.locator) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"locator-extra\" === variable) {\n                    if (item && item[\"locator-extra\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if ([\"citation-number\",\"citation-label\"].indexOf(variable) > -1) {\n                    output = true;\n                    break;\n                } else if (\"first-reference-note-number\" === variable) {\n                    if (item && item[\"first-reference-note-number\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"first-container-reference-note-number\" === variable) {\n                    if (item && item[\"first-container-reference-note-number\"]) {\n                        output = true;\n                    }\n                    break;\n                } else if (\"hereinafter\" === variable) {\n                    if (state.transform.abbrevs[\"default\"].hereinafter[Item.id]\n                        && state.sys.getAbbreviation\n                        && Item.id) {\n\t\t\t\t\t\t\n                        output = true;\n                    }\n                    break;\n                } else if (\"object\" === typeof Item[variable]) {\n                    break;\n                } else if (\"string\" === typeof Item[variable] && Item[variable]) {\n                    output = true;\n                    break;\n                } else if (\"number\" === typeof Item[variable]) {\n                    output = true;\n                    break;\n                }\n                if (output) {\n                    break;\n                }\n            }\n            //print(\"-- VAR: \"+variable);\n            //flag = state.tmp.group_context.tip;\n            if (output) {\n                for (var i=0,ilen=this.variables_real.length;i<ilen;i++) {\n                    var variable = this.variables_real[i];\n                    if (variable !== \"citation-number\" || state.tmp.area !== \"bibliography\") {\n                        state.tmp.cite_renders_content = true;\n                    }\n                    //print(\"  setting [2] to true based on: \" + arg);\n                    state.tmp.group_context.tip.variable_success = true;\n                    // For util_substitute.js, subsequent-author-substitute\n                    if (state.tmp.can_substitute.value() \n                        && state.tmp.area === \"bibliography\"\n                        && \"string\" === typeof Item[variable]) {\n\n                        state.tmp.name_node.top = state.output.current.value();\n                        state.tmp.rendered_name.push(Item[variable]);\n                    }\n                }\n                state.tmp.can_substitute.replace(false,  CSL.LITERAL);\n            } else {\n                //print(\"  setting [1] to true based on: \" + arg);\n                state.tmp.group_context.tip.variable_attempt = true;\n            }\n            //state.tmp.group_context.replace(flag);\n        };\n        this.execs.push(func);\n    } else if ([\"if\",  \"else-if\", \"condition\"].indexOf(this.name) > -1) {\n        // Strip off any boolean prefix.\n        // Now the conditionals.\n        var maketest = function (variable) {\n            return function(Item,item){\n                var myitem = Item;\n                if (item && [\"locator\", \"locator-extra\", \"first-reference-note-number\", \"first-container-reference-note-number\", \"locator-date\"].indexOf(variable) > -1) {\n                    myitem = item;\n                }\n                // We don't run loadAbbreviation() here; it is run by the application-supplied\n                // retrieveItem() if hereinafter functionality is to be used, so this key will\n                // always exist in memory, possibly with a nil value.\n                if (variable === \"hereinafter\" && state.sys.getAbbreviation && myitem.id) {\n                    if (state.transform.abbrevs[\"default\"].hereinafter[myitem.id]) {\n                        return true;\n                    }\n                } else if (myitem[variable]) {\n                    if (\"number\" === typeof myitem[variable] || \"string\" === typeof myitem[variable]) {\n                        return true;\n                    } else if (\"object\" === typeof myitem[variable]) {\n                        //\n                        // this will turn true only for hash objects\n                        // that have at least one attribute, or for a\n                        // non-zero-length list\n                        //\n                        for (var key in myitem[variable]) {\n                            if (myitem[variable][key]) {\n                                return true;\n                            }\n                        }\n                    }\n                }\n                return false;\n            };\n        };\n        for (var i=0,ilen=this.variables.length;i<ilen;i+=1) {\n            this.tests.push(maketest(this.variables[i]));\n        }\n    }\n};\n\n\nCSL.Attributes[\"@page\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.replace(\"sub verbo\", \"sub-verbo\");\n    trylabels = trylabels.split(/\\s+/);\n    // Strip off any boolean prefix.\n    var maketest = function (trylabel) {\n        return function(Item) {\n            var label;\n            state.processNumber(false, Item, \"page\", Item.type);\n            if (!state.tmp.shadow_numbers.page.label) {\n                label = \"page\";\n            } else if (state.tmp.shadow_numbers.page.label === \"sub verbo\") {\n                label = \"sub-verbo\";\n            } else {\n                label = state.tmp.shadow_numbers.page.label;\n            }\n            if (state.tmp.shadow_numbers.page.values.length > 0) {\n                if (state.tmp.shadow_numbers.page.values[0].gotosleepability) {\n                    state.tmp.shadow_numbers.page.values[0].labelVisibility = false;\n                }\n            }\n            if (trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\n\n// a near duplicate of code above\nCSL.Attributes[\"@number\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trylabels = arg.split(/\\s+/);\n    var maketest = function(trylabel) {\n        return function (Item) {\n            var label;\n            state.processNumber(false, Item, \"number\", Item.type);\n            if (!state.tmp.shadow_numbers.number.label) {\n                label = \"number\";\n            } else {\n                label = state.tmp.shadow_numbers.number.label;\n            }\n            if (trylabel === label) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=trylabels.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trylabels[i]));\n    }\n};\n\nCSL.Attributes[\"@jurisdiction\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var tryjurisdictions = arg.split(/\\s+/);\n    \n    // This forces a match=any method, similar to @type\n    var maketests = function (tryjurisdictions) {\n        return function(Item) {\n            if (!Item.jurisdiction) {\n                return false;\n            }\n            var jurisdiction = Item.jurisdiction;\n            for (var i=0,ilen=tryjurisdictions.length;i<ilen;i++) {\n                if (jurisdiction === tryjurisdictions[i]) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketests(tryjurisdictions));\n};\n\nCSL.Attributes[\"@country\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trycountries = arg.split(/\\s+/);\n    \n    // This forces a match=any method, similar to @type\n    var maketests = function (trycountries) {\n        return function(Item) {\n            if (!Item.country) {\n                return false;\n            }\n            var country = Item.country;\n            for (var i=0,ilen=trycountries.length;i<ilen;i++) {\n                if (country === trycountries[i]) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketests(trycountries));\n};\n\nCSL.Attributes[\"@context\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function () {\n        if ([\"bibliography\", \"citation\"].indexOf(arg) > -1) {\n\t\t    var area = state.tmp.area.slice(0, arg.length);\n\t\t    if (area === arg) {\n\t\t\t    return true;\n\t\t    }\n\t\t    return false;\n        } else if (\"alternative\" === arg) {\n            return !!state.tmp.abort_alternative;\n        }\n    };\n    this.tests.push(func);\n};\n\nCSL.Attributes[\"@has-year-only\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || date.month || date.season) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@has-to-month-or-season\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || (!date.month && !date.season) || date.day) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@has-day\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var trydates = arg.split(/\\s+/);\n    var maketest = function (trydate) {\n        return function(Item) {\n            var date = Item[trydate];\n            if (!date || !date.day) {\n                return false;\n            } else {\n                return true;\n            }\n        };\n    };\n    for (var i=0,ilen=trydates.length;i<ilen;i+=1) {\n        this.tests.push(maketest(trydates[i]));\n    }\n};\n\nCSL.Attributes[\"@is-plural\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function (Item) {\n        var nameList = Item[arg];\n        if (nameList && nameList.length) {\n            var persons = 0;\n            var institutions = 0;\n            var last_is_person = false;\n            for (var i = 0, ilen = nameList.length; i < ilen; i += 1) {\n                if (state.opt.development_extensions.spoof_institutional_affiliations\n                    && (nameList[i].literal || (nameList[i].isInstitution && nameList[i].family && !nameList[i].given))) {\n                    institutions += 1;\n                    last_is_person = false;\n                } else {\n                    persons += 1;\n                    last_is_person = true;\n                }\n            }\n            if (persons > 1) {\n                return true;\n            } else if (institutions > 1) {\n                return true;\n            } else if (institutions && last_is_person) {\n                return true;\n            }\n        }\n        return false;\n    };\n    this.tests.push(func);\n};\n\nCSL.Attributes[\"@is-multiple\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var func = function (Item) {\n        var val = (\"\" + Item[arg]);\n        var lst = val.split(/(?:,\\s|\\s(?:tot\\sen\\smet|ldz|oraz|and|bis|||och|a|do|en|et|in|ir|ja|og|sa|to|un|und|s|i|i|u|y||e|a||-|)\\s||\\&)/);\n        if (lst.length > 1) {\n            return true;\n        }\n        return false;\n    };\n    this.tests.push(func);\n};\n\n\n\n\nCSL.Attributes[\"@locale\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var ret, langspec, lang, lst, i, ilen;\n    // Style default\n    var locale_default = state.opt[\"default-locale\"][0];\n\n    if (this.name === \"layout\") {\n        // For layout\n        this.locale_raw = arg;\n        if (this.tokentype === CSL.START) {\n            if (!state.opt.multi_layout) {\n                state.opt.multi_layout = [];\n            }\n            var locale_data = [];\n            // Register the primary locale in the set, and others that \"map\" to it, \n            // so that they can be used when generating sort keys. See node_sort.js.\n            // Not idempotent. Only do this once.\n            var locales = arg.split(/\\s+/);\n            var sort_locale = {};\n            var localeMaster = CSL.localeResolve(locales[0], locale_default);\n            locale_data.push(localeMaster);\n            if (localeMaster.generic) {\n                sort_locale[localeMaster.generic] = localeMaster.best;\n            } else {\n                sort_locale[localeMaster.best] = localeMaster.best;\n            }\n            for (var i=1,ilen=locales.length;i<ilen;i+=1) {\n                var localeServant = CSL.localeResolve(locales[i], locale_default);\n                locale_data.push(localeServant);\n                if (localeServant.generic) {\n                    sort_locale[localeServant.generic] = localeMaster.best;\n                } else {\n                    sort_locale[localeServant.best] = localeMaster.best;\n                }\n\n            }\n            state[state.build.area].opt.sort_locales.push(sort_locale);\n            state.opt.multi_layout.push(locale_data);\n        }\n        state.opt.has_layout_locale = true;\n    } else {\n        // For if and if-else\n\n        // Split argument\n        lst = arg.split(/\\s+/);\n\n        // Expand each list element\n        var locale_bares = [];\n        for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n            // Parse out language string\n            lang = lst[i];\n        \n            // Analyze the locale\n            langspec = CSL.localeResolve(lang, locale_default);\n            if (lst[i].length === 2) {\n                // For fallback\n                locale_bares.push(langspec.bare);\n            }\n            // Load the locale terms etc.\n            // (second argument causes immediate return if locale already exists)\n            state.localeConfigure(langspec, true);\n            \n            // Replace string with locale spec object\n            lst[i] = langspec;\n        }\n        // Locales to test\n        var locale_list = lst.slice();\n\n        // check for variable value\n        // Closure probably not necessary here.\n        var maketest = function (locale_list, locale_default,locale_bares) {\n            return function (Item) {\n                var res;\n                ret = [];\n                res = false;\n                var langspec = false;\n\n                var lang;\n                if (!Item.language) {\n                    lang = locale_default;\n                } else {\n                    lang = Item.language;\n                }\n                langspec = CSL.localeResolve(lang, locale_default);\n                for (i = 0, ilen = locale_list.length; i < ilen; i += 1) {\n                    if (langspec.best === locale_list[i].best) {\n                        state.tmp.condition_lang_counter_arr.push(state.tmp.condition_counter);\n                        state.tmp.condition_lang_val_arr.push(state.opt.lang);\n                        state.opt.lang = locale_list[0].best;\n                        res = true;\n                        break;\n                    }\n                }\n                if (!res && locale_bares.indexOf(langspec.bare) > -1) {\n                    state.tmp.condition_lang_counter_arr.push(state.tmp.condition_counter);\n                    state.tmp.condition_lang_val_arr.push(state.opt.lang);\n                    state.opt.lang = locale_list[0].best;\n                    res = true;\n                }\n                return res;\n            };\n        };\n        this.tests.push(maketest(locale_list,locale_default,locale_bares));\n    }\n};\n\nCSL.Attributes[\"@alternative-node-internal\"] = function (state) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function () {\n        return function() {\n            return !state.tmp.abort_alternative;\n        };\n    };\n    var me = this;\n    this.tests.push(maketest(me));\n};\n\nCSL.Attributes[\"@locale-internal\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var langspec, lang, lst, i, ilen;\n        // For if and if-else\n\n        // Split argument\n        lst = arg.split(/\\s+/);\n\n        // Expand each list element\n        this.locale_bares = [];\n        for (i = 0, ilen = lst.length; i < ilen; i += 1) {\n            // Parse out language string\n            lang = lst[i];\n        \n            // Analyze the locale\n            langspec = CSL.localeResolve(lang, state.opt[\"default-locale\"][0]);\n            if (lst[i].length === 2) {\n                // For fallback\n                this.locale_bares.push(langspec.bare);\n            }\n            // Load the locale terms etc.\n            state.localeConfigure(langspec);\n            \n            // Replace string with locale spec object\n            lst[i] = langspec;\n        }\n        // Set locale tag on node\n        this.locale_default = state.opt[\"default-locale\"][0];\n        // The locale to set on node children if match is successful\n        this.locale = lst[0].best;\n        // Locales to test\n        this.locale_list = lst.slice();\n        \n        // check for variable value\n        // Closure probably not necessary here.\n        var maketest = function (me) {\n            return function (Item) {\n                var ret, res;\n                ret = [];\n                res = false;\n                var langspec = false;\n                if (Item.language) {\n                    lang = Item.language;\n                    langspec = CSL.localeResolve(lang, state.opt[\"default-locale\"][0]);\n                    if (langspec.best === state.opt[\"default-locale\"][0]) {\n                        langspec = false;\n                    }\n                }\n                if (langspec) {\n                    // We attempt to match a specific locale from the\n                    // list of parameters.  If that fails, we fall back\n                    // to the base locale of the first element.  The\n                    // locale applied is always the first local \n                    // in the list of parameters (or base locale, for a \n                    // single two-character language code) \n                    for (i = 0, ilen = me.locale_list.length; i < ilen; i += 1) {\n                        if (langspec.best === me.locale_list[i].best) {\n                            state.opt.lang = me.locale;\n                            state.tmp.last_cite_locale = me.locale;\n                            // Set empty group open tag with locale set marker\n                            state.output.openLevel(\"empty\");\n                            state.output.current.value().new_locale = me.locale;\n                            res = true;\n                            break;\n                        }\n                    }\n                    if (!res && me.locale_bares.indexOf(langspec.bare) > -1) {\n                        state.opt.lang = me.locale;\n                        state.tmp.last_cite_locale = me.locale;\n                        // Set empty group open tag with locale set marker\n                        state.output.openLevel(\"empty\");\n                        state.output.current.value().new_locale = me.locale;\n                        res = true;\n                    }\n                }\n                return res;\n            };\n        };\n        var me = this;\n        this.tests.push(maketest(me));\n};\n\n\nCSL.Attributes[\"@court-class\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar tryclasses = arg.split(/\\s+/);\n    var maketest = function (tryclass) {\n        return function(Item) {\n            var cls = CSL.GET_COURT_CLASS(state, Item);\n            if (cls === tryclass) {\n                return true;\n            } else {\n                return false;\n            }\n        };\n    };\n    for (var i=0,ilen=tryclasses.length; i<ilen; i++) {\n        this.tests.push(maketest(tryclasses[i]));\n    }\n};\n\nCSL.Attributes[\"@container-multiple\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar retval = \"true\" === arg ? true : false;\n    var maketest = function (retval) {\n        return function(Item) {\n            if (!state.tmp.container_item_count[Item.container_id]) {\n                return !retval;\n            } else if (state.tmp.container_item_count[Item.container_id] > 1) {\n                return retval;\n            }\n            return !retval;\n        };\n    };\n    this.tests.push(maketest(retval));\n};\n\nCSL.Attributes[\"@container-subsequent\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n\tvar retval = \"true\" === arg ? true : false;\n    var maketest = function (retval) {\n        return function(Item) {\n            if (state.tmp.container_item_pos[Item.container_id] > 1) {\n                return retval;\n            }\n            return !retval;\n        };\n    };\n    this.tests.push(maketest(retval));\n};\n\nCSL.Attributes[\"@has-subunit\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function(namevar) {\n        return function (Item) {\n            var subunit_count = 0;\n            for (var i in Item[namevar]) {\n                var name = Item[namevar][i];\n                if (!name.given) {\n                    var institution = name.literal ? name.literal : name.family;\n                    var length = institution.split(\"|\").length;\n                    if (subunit_count === 0 || length < subunit_count) {\n                        subunit_count = length;\n                    }\n                }\n            }\n            return (subunit_count > 1);\n        };\n    };\n    this.tests.push(maketest(arg));\n}\n\nCSL.Attributes[\"@cite-form\"] = function (state, arg) {\n    if (!this.tests) {this.tests = []; };\n    var maketest = function(citeForm) {\n        return function (Item) {\n            if (Item[\"cite-form\"] === citeForm) {\n                return true;\n            }\n            return false;\n        };\n    };\n    this.tests.push(maketest(arg));\n}\n\nCSL.Attributes[\"@disable-duplicate-year-suppression\"] = function (state, arg) {\n\tstate.opt.disable_duplicate_year_suppression = arg.split(/\\s+/);\n}\n\nCSL.Attributes[\"@consolidate-containers\"] = function (state, arg) {\n    CSL.Attributes[\"@track-containers\"](state, arg);\n    var args = arg.split(/\\s+/);\n    state.bibliography.opt.consolidate_containers = args;\n}\n\nCSL.Attributes[\"@track-containers\"] = function (state, arg) {\n    var args = arg.split(/\\s+/);\n    if (!state.bibliography.opt.track_container_items) {\n        state.bibliography.opt.track_container_items = [];\n    }\n    if (!state.bibliography.opt.consolidate_containers) {\n        state.bibliography.opt.consolidate_containers = [];\n    }\n    state.bibliography.opt.track_container_items = state.bibliography.opt.track_container_items.concat(args);\n}\n\n// These are not evaluated as conditions immediately: they only\n// set parameters that are picked up during processing.\nCSL.Attributes[\"@parallel-first\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.parallel_first = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.parallel_first[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\nCSL.Attributes[\"@parallel-last\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.parallel_last = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.parallel_last[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\nCSL.Attributes[\"@parallel-last-to-first\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    this.parallel_last_to_first = {};\n    for (var i=0,ilen=vars.length;i<ilen;i++) {\n        this.parallel_last_to_first[vars[i]] = true;\n    }\n};\nCSL.Attributes[\"@parallel-delimiter-override\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    this.strings.set_parallel_delimiter_override = arg;\n};\nCSL.Attributes[\"@parallel-delimiter-override-on-suppress\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    this.strings.set_parallel_delimiter_override_on_suppress = arg;\n};\nCSL.Attributes[\"@no-repeat\"] = function (state, arg) {\n    state.opt.parallel.enable = true;\n    var vars = arg.split(/\\s+/);\n    if (!state.opt.track_repeat) {\n        state.opt.track_repeat = {};\n    }\n    this.non_parallel = {};\n    for (var i in vars) {\n        var v = vars[i];\n        this.non_parallel[v] = true;\n        state.opt.track_repeat[v] = true;\n    }\n};\n\nCSL.Attributes[\"@require\"] = function (state, arg) {\n    state.opt.use_context_condition = true;\n    this.strings.require = arg;\n\n    // Introduced to constrain rendering of the group with a\n    // requirement that it either render an alpha term via cs:label or\n    // cs:text at least once, or render without any label. That\n    // behaviour is invoked with \"label-empty-or-alpha\" as arg.\n\n    // This attribute is a complement to @label-form and modular\n    // jurisdiction support, as it makes macros that adapt to shifting\n    // local term definitions possible.\n};\n\nCSL.Attributes[\"@reject\"] = function (state, arg) {\n    state.opt.use_context_condition = true;\n    this.strings.reject = arg;\n\n    // Introduced to constrain rendering of the group with a\n    // requirement that it render some label via cs:label or cs:text,\n    // and that it NOT be alpha. That behaviour is invoked with\n    // \"label-empty-or-alpha\" as arg.\n\n    // This attribute is a complement to @label-form and modular\n    // jurisdiction support, as it makes macros that adapt to shifting\n    // local term definitions possible.\n};\n\nCSL.Attributes[\"@require-comma-on-symbol\"] = function (state, arg) {\n    state.opt.require_comma_on_symbol = arg;\n}\n\nCSL.Attributes[\"@gender\"] = function (state, arg) {\n    this.gender = arg;\n};\n\nCSL.Attributes[\"@cslid\"] = function (state, arg) {\n    // @cslid is a noop\n    // The value set on this attribute is used to\n    // generate reverse lookup wrappers on output when \n    // this.development_extensions.csl_reverse_lookup_support is\n    // set to true in state.js (there is no runtime option,\n    // it must be set in state.js)\n    //\n    // See the @showid method in the html output\n    // section of formats.js for the function that\n    // renders the wrappers.\n    this.cslid = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@capitalize-if-first\"] = function (state, arg) {\n    this.strings.capitalize_if_first_override = arg;\n};\n\nCSL.Attributes[\"@label-capitalize-if-first\"] = function (state, arg) {\n    this.strings.label_capitalize_if_first_override = arg;\n};\n\nCSL.Attributes[\"@label-form\"] = function (state, arg) {\n    this.strings.label_form_override = arg;\n};\n\nCSL.Attributes[\"@part-separator\"] = function (state, arg) {\n    this.strings[\"part-separator\"] = arg;\n};\n\nCSL.Attributes[\"@leading-noise-words\"] = function (state, arg) {\n    this[\"leading-noise-words\"] = arg;\n};\n\nCSL.Attributes[\"@name-never-short\"] = function (state, arg) {\n    this[\"name-never-short\"] = arg;\n};\n\nCSL.Attributes[\"@class\"] = function (state, arg) {\n    state.opt[\"class\"] = arg;\n};\n\nCSL.Attributes[\"@version\"] = function (state, arg) {\n    state.opt.version = arg;\n};\n\n/**\n * Store the value attribute on the token.\n * @name CSL.Attributes.@value\n * @function\n */\nCSL.Attributes[\"@value\"] = function (state, arg) {\n    this.strings.value = arg;\n};\n\n\n/**\n * Store the name attribute (of a macro or term node)\n * on the state object.\n * <p>For reference when the closing node of a macro\n * or locale definition is encountered.</p>\n * @name CSL.Attributes.@name\n * @function\n */\nCSL.Attributes[\"@name\"] = function (state, arg) {\n    this.strings.name = arg;\n};\n\n/**\n * Store the form attribute (of a term node) on the state object.\n * <p>For reference when the closing node of a macro\n * or locale definition is encountered.</p>\n * @name CSL.Attributes.@form\n * @function\n */\nCSL.Attributes[\"@form\"] = function (state, arg) {\n    this.strings.form = arg;\n};\n\nCSL.Attributes[\"@date-parts\"] = function (state, arg) {\n    this.strings[\"date-parts\"] = arg;\n};\n\nCSL.Attributes[\"@range-delimiter\"] = function (state, arg) {\n    this.strings[\"range-delimiter\"] = arg;\n};\n\n/**\n * Store macro tokens in a buffer on the state object.\n * <p>For reference when the enclosing text token is\n * processed.</p>\n * @name CSL.Attributes.@macro\n * @function\n */\nCSL.Attributes[\"@macro\"] = function (state, arg) {\n    this.postponed_macro = arg;\n};\n\n/*\n * CSL.Attributes[\"@prefer-jurisdiction\"] = function (state, arg) {\n *    this.prefer_jurisdiction = true;\n * };\n */\n\nCSL.Attributes[\"@term\"] = function (state, arg) {\n    if (arg === \"sub verbo\") {\n        this.strings.term = \"sub-verbo\";\n    } else {\n        this.strings.term = arg;\n    }\n};\n\n\n/*\n * Ignore xmlns attribute.\n * <p>This should always be <p>http://purl.org/net/xbiblio/csl</code>\n * anyway.  At least for the present we will blindly assume\n * that it is.</p>\n * @name CSL.Attributes.@xmlns\n * @function\n */\nCSL.Attributes[\"@xmlns\"] = function () {};\n\n\n/*\n * Store language attribute to a buffer field.\n * <p>Will be placed in the appropriate location\n * when the element is processed.</p>\n * @name CSL.Attributes.@lang\n * @function\n */\nCSL.Attributes[\"@lang\"] = function (state, arg) {\n    if (arg) {\n        state.build.lang = arg;\n    }\n};\n\n\n// Used as a flag during dates processing\nCSL.Attributes[\"@lingo\"] = function () {};\n\n// Used as a flag during dates processing\nCSL.Attributes[\"@macro-has-date\"] = function () {\n    this[\"macro-has-date\"] = true;\n};\n\n/*\n * Store suffix string on token.\n * @name CSL.Attributes.@suffix\n * @function\n */\nCSL.Attributes[\"@suffix\"] = function (state, arg) {\n    this.strings.suffix = arg;\n};\n\n\n/*\n * Store prefix string on token.\n * @name CSL.Attributes.@prefix\n * @function\n */\nCSL.Attributes[\"@prefix\"] = function (state, arg) {\n    this.strings.prefix = arg;\n};\n\n\n/*\n * Store delimiter string on token.\n * @name CSL.Attributes.@delimiter\n * @function\n */\nCSL.Attributes[\"@delimiter\"] = function (state, arg) {\n    this.strings.delimiter = arg;\n};\n\n\n/*\n * Store match evaluator on token.\n */\nCSL.Attributes[\"@match\"] = function (state, arg) {\n    this.match = arg;\n};\n\n\nCSL.Attributes[\"@names-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    this.strings[\"et-al-min\"] = val;\n};\n\nCSL.Attributes[\"@names-use-first\"] = function (state, arg) {\n    this.strings[\"et-al-use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@names-use-last\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.strings[\"et-al-use-last\"] = true;\n    } else {\n        this.strings[\"et-al-use-last\"] = false;\n    }\n};\n\nCSL.Attributes[\"@sort\"] = function (state, arg) {\n    if (arg === \"descending\") {\n        this.strings.sort_direction = CSL.DESCENDING;\n    }\n};\n\nCSL.Attributes[\"@plural\"] = function (state, arg) {\n    // Accepted values of plural attribute differ on cs:text\n    // and cs:label nodes.\n    if (\"always\" === arg || \"true\" === arg) {\n        this.strings.plural = 1;\n    } else if (\"never\" === arg || \"false\" === arg) {\n        this.strings.plural = 0;\n    } else if (\"contextual\" === arg) {\n        this.strings.plural = false;\n    }\n};\n\nCSL.Attributes[\"@has-publisher-and-publisher-place\"] = function () {\n    this.strings[\"has-publisher-and-publisher-place\"] = true;\n};\n\nCSL.Attributes[\"@publisher-delimiter-precedes-last\"] = function (state, arg) {\n    this.strings[\"publisher-delimiter-precedes-last\"] = arg;\n};\n\nCSL.Attributes[\"@publisher-delimiter\"] = function (state, arg) {\n    this.strings[\"publisher-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@publisher-and\"] = function (state, arg) {\n    this.strings[\"publisher-and\"] = arg;\n};\n\nCSL.Attributes[\"@givenname-disambiguation-rule\"] = function (state, arg) {\n    if (CSL.GIVENNAME_DISAMBIGUATION_RULES.indexOf(arg) > -1) {\n        state.citation.opt[\"givenname-disambiguation-rule\"] = arg;\n    }\n};\n\nCSL.Attributes[\"@collapse\"] = function (state, arg) {\n    // only one collapse value will be honoured.\n    if (arg) {\n        state[this.name].opt.collapse = arg;\n    }\n};\n\nCSL.Attributes[\"@cite-group-delimiter\"] = function (state, arg) {\n    if (arg) {\n        state[state.tmp.area].opt.cite_group_delimiter = arg;\n    }\n};\n\n\n\nCSL.Attributes[\"@names-delimiter\"] = function (state, arg) {\n    state.setOpt(this, \"names-delimiter\", arg);\n};\n\nCSL.Attributes[\"@name-form\"] = function (state, arg) {\n    state.setOpt(this, \"name-form\", arg);\n};\n\nCSL.Attributes[\"@subgroup-delimiter\"] = function (state, arg) {\n    this.strings[\"subgroup-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@subgroup-delimiter-precedes-last\"] = function (state, arg) {\n    this.strings[\"subgroup-delimiter-precedes-last\"] = arg;\n};\n\n\nCSL.Attributes[\"@name-delimiter\"] = function (state, arg) {\n    state.setOpt(this, \"name-delimiter\", arg);\n};\n\nCSL.Attributes[\"@et-al-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    state.setOpt(this, \"et-al-min\", val);\n};\n\nCSL.Attributes[\"@et-al-use-first\"] = function (state, arg) {\n    state.setOpt(this, \"et-al-use-first\", parseInt(arg, 10));\n};\n\nCSL.Attributes[\"@et-al-use-last\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.setOpt(this, \"et-al-use-last\", true);\n    } else {\n        state.setOpt(this, \"et-al-use-last\", false);\n    }\n};\n\nCSL.Attributes[\"@et-al-subsequent-min\"] = function (state, arg) {\n    var val = parseInt(arg, 10);\n    if (state[state.build.area].opt.max_number_of_names < val) {\n        state[state.build.area].opt.max_number_of_names = val;\n    }\n    state.setOpt(this, \"et-al-subsequent-min\", val);\n};\n\nCSL.Attributes[\"@et-al-subsequent-use-first\"] = function (state, arg) {\n    state.setOpt(this, \"et-al-subsequent-use-first\", parseInt(arg, 10));\n};\n\nCSL.Attributes[\"@suppress-min\"] = function (state, arg) {\n    this.strings[\"suppress-min\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@suppress-max\"] = function (state, arg) {\n    this.strings[\"suppress-max\"] = parseInt(arg, 10);\n};\n\n\nCSL.Attributes[\"@and\"] = function (state, arg) {\n    state.setOpt(this, \"and\", arg);\n};\n\nCSL.Attributes[\"@delimiter-precedes-last\"] = function (state, arg) {\n    state.setOpt(this, \"delimiter-precedes-last\", arg);\n};\n\nCSL.Attributes[\"@delimiter-precedes-et-al\"] = function (state, arg) {\n    state.setOpt(this, \"delimiter-precedes-et-al\", arg);\n};\n\nCSL.Attributes[\"@initialize-with\"] = function (state, arg) {\n    state.setOpt(this, \"initialize-with\", arg);\n};\n\nCSL.Attributes[\"@initialize\"] = function (state, arg) {\n    if (arg === \"false\") {\n        state.setOpt(this, \"initialize\", false);\n    }\n};\n\nCSL.Attributes[\"@name-as-reverse-order\"] = function (state, arg) {\n    this[\"name-as-reverse-order\"] = arg;\n};\n\nCSL.Attributes[\"@name-as-sort-order\"] = function (state, arg) {\n    if (this.name === \"style-options\") {\n        this[\"name-as-sort-order\"] = arg;\n    } else {\n        state.setOpt(this, \"name-as-sort-order\", arg);\n    }\n};\n\nCSL.Attributes[\"@sort-separator\"] = function (state, arg) {\n    state.setOpt(this, \"sort-separator\", arg);\n};\n\nCSL.Attributes[\"@require-match\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.requireMatch = true;\n    }\n};\n\nCSL.Attributes[\"@exclude-types\"] = function (state, arg) {\n    state.bibliography.opt.exclude_types = arg.split(/\\s+/);\n};\n\nCSL.Attributes[\"@exclude-with-fields\"] = function (state, arg) {\n    state.bibliography.opt.exclude_with_fields = arg.split(/\\s+/);\n};\n\n\nCSL.Attributes[\"@year-suffix-delimiter\"] = function (state, arg) {\n    state[this.name].opt[\"year-suffix-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@after-collapse-delimiter\"] = function (state, arg) {\n    state[this.name].opt[\"after-collapse-delimiter\"] = arg;\n};\n\nCSL.Attributes[\"@subsequent-author-substitute\"] = function (state, arg) {\n    state[this.name].opt[\"subsequent-author-substitute\"] = arg;\n};\n\nCSL.Attributes[\"@subsequent-author-substitute-rule\"] = function (state, arg) {\n    state[this.name].opt[\"subsequent-author-substitute-rule\"] = arg;\n};\n\nCSL.Attributes[\"@disambiguate-add-names\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.opt[\"disambiguate-add-names\"] = true;\n    }\n};\n\nCSL.Attributes[\"@disambiguate-add-givenname\"] = function (state, arg) {\n    if (arg === \"true\") {\n        state.opt[\"disambiguate-add-givenname\"] = true;\n    }\n};\n\nCSL.Attributes[\"@disambiguate-add-year-suffix\"] = function (state, arg) {\n    if (arg === \"true\" && state.opt.xclass !== \"numeric\") {\n        state.opt[\"disambiguate-add-year-suffix\"] = true;\n    }\n};\n\n\nCSL.Attributes[\"@second-field-align\"] = function (state, arg) {\n    if (arg === \"flush\" || arg === \"margin\") {\n        state[this.name].opt[\"second-field-align\"] = arg;\n    }\n};\n\n\nCSL.Attributes[\"@hanging-indent\"] = function (state, arg) {\n    if (arg === \"true\") {\n        if (state.opt.development_extensions.hanging_indent_legacy_number) {\n            state[this.name].opt.hangingindent = 2;\n\t    } else {\n            state[this.name].opt.hangingindent = true;\n\t    }\n    }\n};\n\n\nCSL.Attributes[\"@line-spacing\"] = function (state, arg) {\n    if (arg && arg.match(/^[.0-9]+$/)) {\n        state[this.name].opt[\"line-spacing\"] = parseFloat(arg, 10);\n    }\n};\n\n\nCSL.Attributes[\"@entry-spacing\"] = function (state, arg) {\n    if (arg && arg.match(/^[.0-9]+$/)) {\n        state[this.name].opt[\"entry-spacing\"] = parseFloat(arg, 10);\n    }\n};\n\n\nCSL.Attributes[\"@near-note-distance\"] = function (state, arg) {\n    state[this.name].opt[\"near-note-distance\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@substring\"] = function (state, arg) {\n    this.substring = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@text-case\"] = function (state, arg) {\n    var func = function (state, Item) {\n        if (arg === \"normal\") {\n            this.text_case_normal = true;\n        } else {\n            this.strings[\"text-case\"] = arg;\n            if (arg === \"title\") {\n                if (Item.jurisdiction) {\n                    this.strings[\"text-case\"] = \"passthrough\";\n                }\n            }\n        }\n    };\n    this.execs.push(func);\n};\n\n\nCSL.Attributes[\"@page-range-format\"] = function (state, arg) {\n    state.opt[\"page-range-format\"] = arg;\n};\n\n\nCSL.Attributes[\"@year-range-format\"] = function (state, arg) {\n    state.opt[\"year-range-format\"] = arg;\n};\n\n\nCSL.Attributes[\"@default-locale\"] = function (state, arg) {\n    if (this.name === 'style') {\n        var lst, len, pos, m, ret;\n        //\n        // Workaround for Internet Exploder 6 (doesn't recognize\n        // groups in str.split(/something(braced-group)something/)\n        //\n        var m = arg.match(/-x-(sort|translit|translat)-/g);\n        if (m) {\n            for (pos = 0, len = m.length; pos < len; pos += 1) {\n                m[pos] = m[pos].replace(/^-x-/, \"\").replace(/-$/, \"\");\n            }\n        }\n        lst = arg.split(/-x-(?:sort|translit|translat)-/);\n        ret = [lst[0]];\n        for (pos = 1, len = lst.length; pos < len; pos += 1) {\n            ret.push(m[pos - 1]);\n            ret.push(lst[pos]);\n        }\n        lst = ret.slice();\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            state.opt[(\"locale-\" + lst[pos])].push(lst[(pos + 1)].replace(/^\\s*/g, \"\").replace(/\\s*$/g, \"\"));\n        }\n        if (lst.length) {\n            state.opt[\"default-locale\"] = lst.slice(0, 1);\n        } else {\n            state.opt[\"default-locale\"] = [\"en\"];\n        }\n    } else if (arg === \"true\") {\n        this.default_locale = true;\n    }\n};\n\nCSL.Attributes[\"@default-locale-sort\"] = function (state, arg) {\n    state.opt[\"default-locale-sort\"] = arg;\n};\n\nCSL.Attributes[\"@demote-non-dropping-particle\"] = function (state, arg) {\n    state.opt[\"demote-non-dropping-particle\"] = arg;\n};\n\nCSL.Attributes[\"@initialize-with-hyphen\"] = function (state, arg) {\n    if (arg === \"false\") {\n        state.opt[\"initialize-with-hyphen\"] = false;\n    }\n};\n\nCSL.Attributes[\"@institution-parts\"] = function (state, arg) {\n    this.strings[\"institution-parts\"] = arg;\n};\n\nCSL.Attributes[\"@if-short\"] = function (state, arg) {\n    if (arg === \"true\") {\n        this.strings[\"if-short\"] = true;\n    }\n};\n\nCSL.Attributes[\"@substitute-use-first\"] = function (state, arg) {\n    this.strings[\"substitute-use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@use-first\"] = function (state, arg) {\n    this.strings[\"use-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@use-last\"] = function (state, arg) {\n    this.strings[\"use-last\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@stop-first\"] = function (state, arg) {\n    this.strings[\"stop-first\"] = parseInt(arg, 10);\n};\n\nCSL.Attributes[\"@stop-last\"] = function (state, arg) {\n    this.strings[\"stop-last\"] = parseInt(arg, 10) * -1;\n};\n\n\nCSL.Attributes[\"@reverse-order\"] = function (state, arg) {\n    if (\"true\" === arg) {\n        this.strings[\"reverse-order\"] = true;\n    }\n};\n\nCSL.Attributes[\"@display\"] = function (state, arg) {\n    if (state.bibliography.tokens.length === 2) {\n        state.opt.using_display = true;\n    }\n    this.strings.cls = arg;\n};\n\n\n/*global CSL: true */\n\n\n/**\n * String stack object.\n * <p>Numerous string stacks are used to track nested\n * parameters at runtime.  This class provides methods\n * that remove some of the aggravation of managing\n * them.</p>\n * @class\n */\nCSL.Stack = function (val, literal) {\n    this.mystack = [];\n    if (literal || val) {\n        this.mystack.push(val);\n    }\n    this.tip = this.mystack[0];\n};\n\n/**\n * Push a value onto the stack.\n * <p>This just does what it says.</p>\n */\nCSL.Stack.prototype.push = function (val, literal) {\n    if (literal || val) {\n        this.mystack.push(val);\n    } else {\n        this.mystack.push(\"\");\n    }\n    this.tip = this.mystack[this.mystack.length - 1];\n};\n\n/**\n * Clear the stack\n */\nCSL.Stack.prototype.clear = function () {\n    this.mystack = [];\n    this.tip = {};\n};\n\n/**\n * Replace the top value on the stack.\n * <p>This removes some ugly syntax from the\n * main code.</p>\n */\nCSL.Stack.prototype.replace = function (val, literal) {\n    //\n    // safety fix after a bug was chased down.  Rhino\n    // JS will process a negative index without error (!).\n    if (this.mystack.length === 0) {\n        CSL.error(\"Internal CSL processor error: attempt to replace nonexistent stack item with \" + val);\n    }\n    if (literal || val) {\n        this.mystack[(this.mystack.length - 1)] = val;\n    } else {\n        this.mystack[(this.mystack.length - 1)] = \"\";\n    }\n    this.tip = this.mystack[this.mystack.length - 1];\n};\n\n\n/**\n * Remove the top value from the stack.\n * <p>Just does what it says.</p>\n */\nCSL.Stack.prototype.pop = function () {\n    var ret = this.mystack.pop();\n    if (this.mystack.length) {\n        this.tip = this.mystack[this.mystack.length - 1];\n    } else {\n        this.tip = {};\n    }\n    return ret;\n};\n\n\n/**\n * Return the top value on the stack.\n * <p>Removes a little hideous complication from\n * the main code.</p>\n */\nCSL.Stack.prototype.value = function () {\n    return this.mystack.slice(-1)[0];\n};\n\n\n/**\n * Return length (depth) of stack.\n * <p>Used to identify if there is content to\n * be handled on the stack</p>\n */\nCSL.Stack.prototype.length = function () {\n    return this.mystack.length;\n};\n\n/*global CSL: true */\n\n/**\n * Initializes the parallel cite tracking arrays\n */\nCSL.Parallel = function (state) {\n    this.state = state;\n};\n\nCSL.Parallel.prototype.StartCitation = function (sortedItems, out) {\n    // This array carries the repeat markers used in rendering the cite.\n    this.state.tmp.suppress_repeats = [];\n    if (sortedItems.length < 2) return;\n    var idxEnd = 0;\n    var parallelMatchList = false;\n    var siblingRanges = [];\n\n    for (var i=0,ilen=sortedItems.length-1;i<ilen;i++) {\n        var currItem = sortedItems[i][0];\n        var nextItem = sortedItems[i+1][0];\n        var freshMatchList = false;\n        var info = {};\n        if (sortedItems[i][0].seeAlso && sortedItems[i][0].seeAlso.length > 0 && !parallelMatchList) {\n            freshMatchList = true;\n            parallelMatchList = [sortedItems[i][0].id].concat(sortedItems[i][0].seeAlso);\n            var tempMatchList = parallelMatchList.slice();\n            var remainder = sortedItems.slice(i);\n            remainder[0][1].parallel = \"first\";\n            for (var j=0,jlen=remainder.length;j<jlen;j++) {\n                var itemID = remainder[j][0].id;\n                var ididx = tempMatchList.indexOf(itemID);\n                idxEnd = false;\n                if (ididx === -1) {\n                    idxEnd = (i+j-1);\n                } else if ((i+j) === (sortedItems.length-1)) {\n                    idxEnd = (i+j);\n                }\n                if (idxEnd) {\n                    siblingRanges.push([i, idxEnd]);\n                    break;\n                } else {\n                    tempMatchList = tempMatchList.slice(0, ididx).concat(tempMatchList.slice(ididx+1));\n                }\n            }\n        }\n        // parallelMatchList/freshMatchList relate only to parallels.\n        // no-repeat non-parallels are handled in a separate block.\n        if (i > 0 && freshMatchList) {\n            this.state.tmp.suppress_repeats[i-1].START = true;\n            freshMatchList = false;\n        }\n        for (var varname in this.state.opt.track_repeat) {\n            if (!currItem[varname] || !nextItem[varname]) {\n                // Go ahead and render any value with an empty partner\n                info[varname] = false;\n            } else if (\"string\" === typeof nextItem[varname] || \"number\" === typeof nextItem[varname]) {\n                // Simple comparison of string values\n                if (varname === \"title\" && currItem[\"title-short\"] && nextItem[\"title-short\"]) {\n                    var currVal = currItem[\"title-short\"];\n                    var nextVal = nextItem[\"title-short\"];\n                } else {\n                    var currVal = currItem[varname];\n                    var nextVal = nextItem[varname];\n                }\n                if (currVal == nextVal) {\n                    info[varname] = true;\n                } else {\n                    info[varname] = false;\n                }\n            } else if (\"undefined\" === typeof currItem[varname].length) {\n                // If a date, use only the year\n                info[varname] = false;\n                var currYear = currItem[varname].year;\n                var nextYear = nextItem[varname].year;\n                if (currYear && nextYear) {\n                    if (currYear == nextYear) {\n                        info[varname] = true;\n                    }\n                }\n            } else {\n                // If a creator value, kludge it\n                var currVal = JSON.stringify(currItem[varname]);\n                var nextVal = JSON.stringify(nextItem[varname]);\n                if (currVal === nextVal) {\n                    info[varname] = true;\n                } else {\n                    info[varname] = false;\n                }\n            }\n        }\n        if (!parallelMatchList) {\n            info.ORPHAN = true;\n        }\n        if (idxEnd === i) {\n            info.END = true;\n            parallelMatchList = false;\n        }\n        this.state.tmp.suppress_repeats.push(info);\n    }\n    \n    // if (!this.state.tmp.just_looking) {\n    //     this.state.sys.print(`${JSON.stringify(this.state.tmp.suppress_repeats, null, 2)}`);\n    // }\n    \n    // Set no-repeat info here?\n    for (var j=0,jlen=siblingRanges.length;j<jlen;j++) {\n        var masterID = sortedItems[siblingRanges[j][0]][0].id;\n        this.state.registry.registry[masterID].master = true;\n        this.state.registry.registry[masterID].siblings = [];\n        var start = siblingRanges[j][0];\n        var end = siblingRanges[j][1];\n        for (var k=start; k<end; k++) {\n            this.state.tmp.suppress_repeats[k].SIBLING = true;\n            var siblingID = sortedItems[k+1][0].id;\n            sortedItems[k+1][1].parallel = \"other\";\n            this.state.registry.registry[masterID].siblings.push(siblingID);\n        }\n    }\n    // this.state.sys.print(JSON.stringify(this.state.tmp.suppress_repeats, null, 2));\n};\n\nCSL.Parallel.prototype.checkRepeats = function(params) {\n    var idx = this.state.tmp.cite_index;\n    if (this.state.tmp.suppress_repeats) {\n        if (params.parallel_first && Object.keys(params.parallel_first).length > 0) {\n            var arr = [{}].concat(this.state.tmp.suppress_repeats);\n            var ret = true;\n            for (var varname in params.parallel_first) {\n                if (!arr[idx][varname] || arr[idx].START) {\n                    // true --> suppress the entry\n                    // Test here evaluates as \"all\", not \"any\"\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n        if (params.parallel_last && Object.keys(params.parallel_last).length > 0) {\n            var arr = this.state.tmp.suppress_repeats.concat([{}]);\n            var ret = Object.keys(params.parallel_last).length > 0 ? true : false;\n            for (var varname in params.parallel_last) {\n                if (!arr[idx][varname] || arr[idx].END) {\n                    // \"all\" match, as above.\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n        if (params.non_parallel && Object.keys(params.non_parallel).length > 0) {\n            var arr = [{}].concat(this.state.tmp.suppress_repeats);\n            var ret = true;\n            for (var varname in params.non_parallel) {\n                if (!arr[idx][varname]) {\n                    ret = false;\n                }\n            }\n            return ret;\n        }\n    }\n    return false;\n};\n\n/*global CSL: true */\n\n\nCSL.Util = {};\n\nCSL.Util.Match = function () {\n\n    this.any = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0, ilen=tests.length; i < ilen; i += 1) {\n                var result = tests[i](Item, item);\n                if (result) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n\n    this.none = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (result) {\n                    return false;\n                }\n            }\n            return true;\n        };\n    };\n\n    this.all = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (!result) {\n                    return false;\n                }\n            }\n            return true;\n        };\n    };\n\n    this[undefined] = this.all;\n\n    this.nand = function (token, state, tests) {\n        return function (Item, item) {\n            for (var i=0,ilen=tests.length;i<ilen;i+=1) {\n                var result = tests[i](Item,item);\n                if (!result) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    };\n\n};\n\n/*global CSL: true */\n\n/*\n * Fields can be transformed by translation/transliteration, or by\n * abbreviation.  Transformations are performed in that order.\n *\n * Renderings of original, translated or transliterated content\n * (followed by abbreviation if requested) are placed in the primary\n * output slot or the (implicitly punctuated) secondary and tertiary\n * output slots according to the settings registered in the\n * state.opt['cite-lang-prefs'] arrays. The array has six segments:\n * 'persons', 'institutions', 'titles', 'journals', 'publishers', and\n * 'places'. Each segment always contains at least one item, and may\n * hold values 'orig', 'translit' or 'translat'. The array defaults to\n * a single item 'orig'.\n *\n * All multilingual variables are associated with segments,\n * with the exception of 'edition' and 'genre'. These two\n * exceptions are always rendered with the first matching\n * language form found in state.opt['locale-translit'] or, if\n * composing a sort key, state.opt['locale-sort']. No secondary\n * slot rendering is performed for this two variables.\n *\n * The balance of multilingual variables are rendered with\n * the first matching value in the transform locales spec\n * (no transform, state.opt['locale-translit'], or \n * state.opt['locale-translat']) mapped to the target\n * slot.\n *\n * Full primary+secondary+tertiary rendering is performed only in\n * note-style citations and the bibliography.  In-text citations are\n * rendered in the primary output slot only, following the same spec\n * parameters.\n *\n *   Optional setters:\n *     .setAbbreviationFallback(); fallback flag\n *       (if true, a failed abbreviation will fallback to long)\n *\n *     .setAlternativeVariableName(): alternative variable name in Item,\n *       for use as a fallback abbreviation source\n *\n * Translation/transliteration\n *\n *   Optional setter:\n *     .setTransformFallback():\n *       default flag (if true, the original field value will be used as a fallback)\n *\n * The getTextSubField() method may be used to obtain a string transform\n * of a field, without abbreviation, as needed for setting sort keys\n * (for example).\n *\n */\n\nCSL.Transform = function (state) {\n    // Abbreviation families\n    this.abbrevs = {};\n    this.abbrevs[\"default\"] = new state.sys.AbbreviationSegments();\n\n    function getCountryOrJurisdiction(variable, normalizedKey, quashCountry) {\n        var value = \"\";\n        if (state.sys.getHumanForm) {\n            if (variable === \"country\") {\n                value = state.sys.getHumanForm(normalizedKey.toLowerCase(), false, true);\n                value = value.split(\"|\")[0];\n            } else if (variable === \"jurisdiction\") {\n                value = state.sys.getHumanForm(normalizedKey.toLowerCase(), false, true);\n                if (!quashCountry) {\n                    value = value.split(\"|\").slice(1).join(\", \");\n                } else {\n                    // Bare country name is rendered by \"country\", not \"jurisdiction\"\n                    value = \"\";\n                }\n            }\n\t    }\n\t    return value;\n    }\n    \n    // Internal function\n    function abbreviate(state, tok, Item, altvar, basevalue, family_var, use_field) {\n\n        var value = \"\";\n        var myabbrev_family = CSL.FIELD_CATEGORY_REMAP[family_var];\n        var preferredJurisdiction;\n        if (!myabbrev_family) {\n            return basevalue;\n        }\n\n        var variable = family_var;\n        var normalizedKey = basevalue;\n\n        if (state.sys.normalizeAbbrevsKey) {\n            normalizedKey = state.sys.normalizeAbbrevsKey(family_var, basevalue);\n        }\n        var quashCountry = false;\n        if (variable === \"jurisdiction\" && normalizedKey) {\n            quashCountry = normalizedKey.indexOf(\":\") === -1;\n        }\n        // Fix up jurisdiction codes\n        if ([\"jurisdiction\", \"country\"].indexOf(family_var) > -1 && basevalue === basevalue.toLowerCase()) {\n            normalizedKey = basevalue.toUpperCase();\n        }\n        \n        \n        // Lazy retrieval of abbreviations.\n        if (state.sys.getAbbreviation) {\n\n            if ([\"jurisdiction\", \"country\", \"language-name\", \"language-name-original\"].indexOf(variable) > -1) {\n                preferredJurisdiction = \"default\";\n            } else if (Item.jurisdiction) {\n                preferredJurisdiction = Item.jurisdiction;\n            } else {\n                preferredJurisdiction = \"default\";\n            }\n            var jurisdiction = state.transform.loadAbbreviation(preferredJurisdiction, myabbrev_family, normalizedKey, Item.language);\n\n            // Some rules:\n            // # variable === \"country\"\n            // (1) If an abbreviation is associated with the code, then:\n            //     (a) return the abbreviated form if form=\"short\"\n            // (2) Otherwise:\n            //     (a) return the human-readable country name, or whatever is there if it's not a code\n            // # variable === \"jurisdiction\"\n            // (1) If !!getHumanForm(jurisdictionID, false, false):\n            //     (a) If the code is top-level (i.e. a country):\n            //         (i) return nothing -- this is what the \"country\" variable is for.\n            //     (b) otherwise:\n            //         (i) If an abbreviation is associated with the code, then:\n            //             (A) return the abbreviated form\n            //         (ii) Otherwise\n            //             (A) return the human-readable form, with the country name & code removed from the front\n            // (2) Otherwise:\n            //     (a) abbreviate as per normal.\n            // # other variables\n            // (1) Abbreviate as per normal.\n\n            if (state.transform.abbrevs[jurisdiction][myabbrev_family] && normalizedKey) {\n                // Safe to test presence of abbrev against raw object in this block\n                var abbrev = state.transform.abbrevs[jurisdiction][myabbrev_family][normalizedKey];\n                if (tok.strings.form === \"short\" && abbrev) {\n                    if (quashCountry) {\n                        value = \"\";\n                    } else {\n                        value = abbrev;\n                    }\n                } else {\n\t                value = getCountryOrJurisdiction(variable, normalizedKey, quashCountry);\n                }\n            }\n        }\n        \n        // Was for: \n        if (!value \n            && (!state.opt.development_extensions.require_explicit_legal_case_title_short || Item.type !== 'legal_case') \n            && altvar && Item[altvar] && use_field) {\n            value = Item[altvar];\n        }\n        if (!value && !state.sys.getAbbreviation && state.sys.getHumanForm) {\n\t        value = getCountryOrJurisdiction(variable, normalizedKey, quashCountry);\n\t    }\n        if (!value && !quashCountry && (!state.sys.getHumanForm || variable !== \"jurisdiction\")) {\n            value = basevalue;\n        }\n        if (state.opt.development_extensions.force_title_abbrev_fallback) {\n            if (variable === \"title\" && value === basevalue && Item[\"title-short\"]) {\n                value = Item[\"title-short\"];\n            }\n        }\n        return value;\n    }\n\n    function getFieldLocale(Item,field) {\n        var ret = state.opt[\"default-locale\"][0].slice(0, 2);\n        var localeRex;\n        if (state.opt.development_extensions.strict_text_case_locales) {\n            localeRex = new RegExp(\"^([a-zA-Z]{2})(?:$|-.*| .*)\");\n        } else {\n            localeRex = new RegExp(\"^([a-zA-Z]{2})(?:$|-.*|.*)\");\n        }\n        if (Item.language) {\n            var m = (\"\" + Item.language).match(localeRex);\n            if (m) {\n                ret = m[1];\n            } else {\n                // Set garbage to \"Klingon\".\n                ret = \"tlh\";\n            }\n        }\n        if (Item.multi && Item.multi && Item.multi.main && Item.multi.main[field]) {\n            ret = Item.multi.main[field];\n        }\n        if (!state.opt.development_extensions.strict_text_case_locales\n            || state.opt.development_extensions.normalize_lang_keys_to_lowercase) {\n\n            ret = ret.toLowerCase();\n        }\n        return ret;\n    }\n\n    // Internal functions\n    function getTextSubField (Item, field, locale_type, use_default, stopOrig, family_var) {\n        var opt, o, ret, opts;\n        var usedOrig = stopOrig;\n        var usingOrig = false;\n\n        if (!Item[field]) {\n            return {\n                name:\"\",\n                usedOrig:stopOrig,\n                token: CSL.Util.cloneToken(this)\n            };\n        }\n        // If form=\"short\" is selected (\"family_var\" is a misnomer\n        // here, it means short-form requested), and the variable\n        // has a short-form partner (i.e. it is in array\n        // VARIABLES_WITH_SHORT_FORM), then it is run here as *-short\".\n        var stickyLongForm = false;\n        if (CSL.VARIABLES_WITH_SHORT_FORM.indexOf(field) > -1\n            && family_var) {\n\n            field = field + \"-short\";\n            stickyLongForm = true;\n        }\n        var breakMe = false;\n        var firstValue = null;\n        var fieldsToTry = [];\n        if (field.slice(-6) === \"-short\") {\n            fieldsToTry.push(field);\n            fieldsToTry.push(field.slice(0, -6))\n        } else {\n            fieldsToTry.push(field);\n        }\n\n        for (var h=0,hlen=fieldsToTry.length; h<hlen; h++) {\n            var variantMatch = false;\n            var field = fieldsToTry[h];\n\n            ret = {name:\"\", usedOrig:stopOrig,locale:getFieldLocale(Item,field)};\n\n            opts = state.opt[locale_type] ? state.opt[locale_type].slice() : [];\n            var hasVal = false;\n\n            if (locale_type === 'locale-orig') {\n                if (!stopOrig) {\n                    ret.name = Item[field];\n                    ret.usedOrig = false;\n                }\n                hasVal = true;\n                usingOrig = true;\n            } else if (use_default && (\"undefined\" === typeof opts || opts.length === 0)) {\n                // If we want the original, or if we don't have any specific guidance and we \n                // definitely want output, just return the original value.\n                ret.name = Item[field];\n                ret.usedOrig = true;\n                hasVal = true;\n                usingOrig = true;\n            }\n\n            if (!hasVal) {\n                for (var i = 0, ilen = opts.length; i < ilen; i += 1) {\n                    opt = opts[i];\n                    o = opt.split(/[\\-_]/)[0];\n                    if (opt && Item.multi && Item.multi._keys[field] && Item.multi._keys[field][opt]) {\n                        ret.name = Item.multi._keys[field][opt];\n                        ret.locale = opt;\n                        hasVal = true;\n                        variantMatch = true;\n                        usingOrig = false;\n                        break;\n                    } else if (o && Item.multi && Item.multi._keys[field] && Item.multi._keys[field][o]) {\n                        ret.name = Item.multi._keys[field][o];\n                        ret.locale = o;\n                        hasVal = true;\n                        variantMatch = true;\n                        usingOrig = false;\n                        break;\n                    }\n                }\n                if (!ret.name && use_default) {\n                    ret = {name:Item[field], usedOrig:true, locale:getFieldLocale(Item,field)};\n                    usingOrig = true;\n                }\n            }\n            ret.token = CSL.Util.cloneToken(this);\n            if (h === 0) {\n                if (variantMatch) {\n                    ret.found_variant_ok = true;\n                }\n                firstValue = ret;\n                if (!stickyLongForm && (\"undefined\" === typeof opts || opts.length === 0)) {\n                    breakMe = true;\n                }\n                if (variantMatch) {\n                    breakMe = true;\n                }\n            } else {\n                if (!stickyLongForm && !variantMatch && firstValue) {\n                    ret = firstValue;\n                    field = fieldsToTry[0];\n                } else if (variantMatch) {\n                    ret.found_variant_ok = true;\n                }\n            }\n            if ([\"title\", \"container-title\"].indexOf(field) > -1) {\n                if (!usedOrig\n                    && (!ret.token.strings[\"text-case\"]\n                        || ret.token.strings[\"text-case\"] === \"sentence\"\n                        || ret.token.strings[\"text-case\"] === \"normal\")) {\n                    var locale = state.opt.lang;\n                    var lang;\n                    if (usingOrig) {\n                        lang = false;\n                    } else {\n                        lang = ret.locale;\n                    }\n                    var seg = field.slice(0,-5);\n                    var sentenceCase = ret.token.strings[\"text-case\"] === \"sentence\" ? true : false;\n                    ret.name = CSL.titlecaseSentenceOrNormal(state, Item, seg, lang, sentenceCase);\n                    delete ret.token.strings[\"text-case\"];\n                }\n            }\n            if (breakMe) {\n                break;\n            }\n        }\n        return ret;\n    }\n    this.getTextSubField = getTextSubField;\n    \n    // Setter for abbreviation lists\n    // This initializes a single abbreviation based on known\n    // data.\n    function loadAbbreviation(jurisdiction, category, orig, lang) {\n        if (!jurisdiction) {\n            jurisdiction = \"default\";\n        }\n        var country = jurisdiction.split(\":\")[0];\n        var domain = CSL.getAbbrevsDomain(state, country, lang);\n        if (domain) {\n            jurisdiction += (\"@\" + domain);\n        }\n        if (!orig) {\n            if (!state.transform.abbrevs[jurisdiction]) {\n                state.transform.abbrevs[jurisdiction] = new state.sys.AbbreviationSegments();\n            }\n            if (!state.transform.abbrevs[jurisdiction][category]) {\n                state.transform.abbrevs[jurisdiction][category] = {};\n            }\n            return jurisdiction;\n        }\n        // The getAbbreviation() function should check the\n        // external DB for the content key. If a value exists\n        // in this[category] and no value exists in DB, the entry\n        // in memory is left untouched. If a value does exist in\n        // DB, the memory value is created.\n        //\n        // See testrunner_stdrhino.js for an example.\n        if (state.sys.getAbbreviation) {\n            jurisdiction = state.sys.getAbbreviation(state.opt.styleID, state.transform.abbrevs, jurisdiction, category, orig);\n            if (!jurisdiction) {\n                jurisdiction = \"default\";\n                if (domain) {\n                    jurisdiction += (\"@\" + domain);\n                }\n            }\n        }\n        return jurisdiction;\n    }\n    this.loadAbbreviation = loadAbbreviation;\n\n    function publisherCheck (tok, Item, primary, family_var) {\n        var varname = tok.variables[0];\n        if (state.publisherOutput && primary) {\n            if ([\"publisher\",\"publisher-place\"].indexOf(varname) === -1) {\n                return false;\n            } else {\n                // In this case, the publisher bundle will be rendered\n                // at the close of the group, by the closing group node.\n                state.publisherOutput[varname + \"-token\"] = tok;\n                state.publisherOutput.varlist.push(varname);\n                var lst = primary.split(/;\\s*/);\n                if (lst.length === state.publisherOutput[varname + \"-list\"].length) {\n                    state.publisherOutput[varname + \"-list\"] = lst;\n                }\n                // Abbreviate each of the items in the list here!\n                for (var i = 0, ilen = lst.length; i < ilen; i += 1) {\n                    lst[i] = abbreviate(state, tok, Item, false, lst[i], family_var, true);\n                }\n                state.tmp[varname + \"-token\"] = tok;\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function citeFormCheck(Item, value) {\n        var m = value.match(/^#([0-9]+).*>>>/);\n        if (m && m[1]) {\n            Item[\"cite-form\"] = m[1];\n        }\n    }\n    \n    // The name transform code is placed here to keep similar things\n    // in one place.  Obviously this module could do with a little\n    // tidying up.\n    function quashCheck(jurisdiction, value) {\n        var m = value.match(/^(?:#[0-9]+)*(?:!((?:[-_a-z]+(?:(?:.*)))(?:,(?:[-_a-z]+(?:(?:.*))))*))*>>>/);\n        if (m) {\n            value = value.slice(m[0].length);\n            if (m[1]) {\n                var fields = m[1].split(\",\");\n                for (var i = 0, ilen = fields.length; i < ilen; i += 1) {\n                    var rawField = fields[i];\n                    var mm = rawField.match(/^([-_a-z]+)(?:\\:(.*))*$/);\n                    var field = mm[1];\n                    // trimmer is not available in getAmbiguousCite\n                    var trimmer = state.tmp.abbrev_trimmer;\n                    if (mm[2]) {\n                        if (trimmer && jurisdiction) {\n                            if (!trimmer[jurisdiction]) {\n                                trimmer[jurisdiction] = {};\n                            }\n                            trimmer[jurisdiction][field] = mm[2];\n                        }\n                    } else if (state.tmp.done_vars.indexOf(field) === -1) {\n                        if (trimmer && jurisdiction) {\n                            if (!trimmer.QUASHES[jurisdiction]) {\n                                trimmer.QUASHES[jurisdiction] = {};\n                            }\n                            trimmer.QUASHES[jurisdiction][field] = true;\n                        }\n                        state.tmp.done_vars.push(field);\n                    }\n                }\n            }\n        }\n        return value;\n    }\n    this.quashCheck = quashCheck;\n\n    // Return function appropriate to selected options\n    function getOutputFunction(variables, family_var, abbreviation_fallback, alternative_varname) {\n        // var mytoken;\n\n        // Set the primary_locale and secondary_locale lists appropriately.\n        // No instance helper function for this; everything can be derived\n        // from processor settings and rendering context.\n\n        var localesets;\n        var langPrefs = CSL.LangPrefsMap[variables[0]];\n        if (!langPrefs) {\n            localesets = false;\n        } else {\n            localesets = state.opt['cite-lang-prefs'][langPrefs];\n        }\n\n        return function (state, Item, item) {\n            var primary, primary_locale, secondary, secondary_locale, tertiary, tertiary_locale, primary_tok;\n            if (!variables[0] || (!Item[variables[0]] && !Item[alternative_varname])) {\n                return null;\n            }\n            //\n            // Exploring the edges here.\n            // \"suppress-author\" for string variables (mostly titles).\n            //\n            if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                if (!state.tmp.probably_rendered_something && state.tmp.can_substitute.length() > 1) {\n                    return null;\n                }\n            }\n            var slot = {primary:false, secondary:false, tertiary:false};\n            if (state.tmp.area.slice(-5) === \"_sort\") {\n                slot.primary = 'locale-sort';\n            } else {\n                if (localesets && localesets.length === 1 && localesets[0] === \"locale-orig\") {\n                    slot.primary = \"locale-orig\";\n                    localesets = false;\n                } else if (localesets && !state.tmp.multi_layout) {\n                    var slotnames = [\"primary\", \"secondary\", \"tertiary\"];\n                    for (var i = 0, ilen = slotnames.length; i < ilen; i += 1) {\n                        if (localesets.length - 1 <  i) {\n                            break;\n                        }\n                        if (localesets[i]) {\n                            slot[slotnames[i]] = 'locale-' + localesets[i];\n                        }\n                    }\n                } else {\n                    slot.primary = 'locale-orig';\n                }\n            }\n            \n            if (variables[0] === \"title-short\" \n                || (state.tmp.area !== \"bibliography\"\n                    && !(state.tmp.area === \"citation\"\n                         && state.opt.xclass === \"note\"\n                         && item && !item.position))) {\n                \n                slot.secondary = false;\n                slot.tertiary = false;\n            }\n\n            if (state.tmp.multi_layout) {\n                slot.secondary = false;\n                slot.tertiary = false;\n            }\n            \n            // Problem for multilingual: we really should be\n            // checking for sanity on the basis of the output\n            // strings to be actually used. (also below)\n            if (state.tmp[\"publisher-list\"]) {\n                if (variables[0] === \"publisher\") {\n                    state.tmp[\"publisher-token\"] = this;\n                } else if (variables[0] === \"publisher-place\") {\n                    state.tmp[\"publisher-place-token\"] = this;\n                }\n                return null;\n            }\n            \n            // tmp.lang_array carries the current locale IDs of the style\n            // and the item. Field-level locale IDs are added here, so\n            // we clone it to allow reset.\n            var oldLangArray = state.tmp.lang_array.slice();\n\n            // True is for transform fallback\n            var res = getTextSubField.call(this, Item, variables[0], slot.primary, true, null, family_var);\n            primary = res.name;\n            primary_locale = res.locale;\n            var primary_tok = res.token;\n            var primaryUsedOrig = res.usedOrig;\n            if (family_var && !res.found_variant_ok) {\n                primary = abbreviate(state, primary_tok, Item, alternative_varname, primary, family_var, true);\n                // Suppress subsequent use of another variable if requested by\n                // hack syntax in this abbreviation short form.\n                if (primary) {\n                    // We run quash-check in getAmbiguousCite, to possibly pick up a cite-form value.\n                    citeFormCheck(Item, primary);\n                    if (!state.tmp.just_looking) {\n                        primary = quashCheck(Item.jurisdiction, primary);\n                    }\n                }\n            }\n            if (publisherCheck(this, Item, primary, family_var)) {\n                state.tmp.lang_array = oldLangArray;\n                return null;\n            }\n\n            // No fallback for secondary and tertiary\n            secondary = false;\n            tertiary = false;\n            var secondary_tok;\n            var tertiary_tok;\n            if (slot.secondary) {\n                res = getTextSubField.call(this, Item, variables[0], slot.secondary, false, res.usedOrig, null, family_var);\n                secondary = res.name;\n                secondary_locale = res.locale;\n                secondary_tok = res.token;\n                if (family_var && !res.found_variant_ok) {\n                    if (secondary) {\n                        // The abbreviate() function could use a cleanup, after Zotero correct to use title-short\n                        secondary = abbreviate(state, secondary_tok, Item, false, secondary, family_var, true);\n                    }\n                }\n                //print(\"XXX secondary_locale: \"+secondary_locale);\n            }\n            if (slot.tertiary) {\n                res = getTextSubField.call(this, Item, variables[0], slot.tertiary, false, res.usedOrig, null, family_var);\n                tertiary = res.name;\n                tertiary_locale = res.locale;\n                tertiary_tok = res.token;\n                if (family_var && !res.found_variant_ok) {\n                    if (tertiary) {\n                        // The abbreviate() function could use a cleanup, after Zotero correct to use title-short\n                        tertiary = abbreviate(state, tertiary_tok, Item, false, tertiary, family_var, true);\n                    }\n                }\n                //print(\"XXX tertiary_locale: \"+tertiary_locale);\n            }\n            \n            // Decoration of primary (currently translit only) goes here\n            var primaryPrefix;\n            if (slot.primary === \"locale-translit\") {\n                primaryPrefix = state.opt.citeAffixes[langPrefs][slot.primary].prefix;\n            }                \n            // XXX This should probably protect against italics at higher\n            // levels.\n\n            if (primaryPrefix === \"<i>\" && variables[0] === 'title' && !primaryUsedOrig) {\n                var hasItalic = false;\n                for (var i = 0, ilen = primary_tok.decorations.length; i < ilen; i += 1) {\n                    if (primary_tok.decorations[i][0] === \"@font-style\"\n                        && primary_tok.decorations[i][1] === \"italic\") {\n                        \n                        hasItalic = true;\n                    }\n                }\n                if (!hasItalic) {\n                    primary_tok.decorations.push([\"@font-style\", \"italic\"]);\n                }\n            }\n\n            //print(\"XXX \"+primary_tok.strings[\"text-case\"]);\n            if (primary_locale !== \"en\" && primary_tok.strings[\"text-case\"] === \"title\") {\n                primary_tok.strings[\"text-case\"] = \"passthrough\";\n            }\n            \n            if (\"title\" === variables[0]) {\n                primary = CSL.demoteNoiseWords(state, primary, this[\"leading-noise-words\"]);\n            }\n            if (secondary || tertiary) {\n\n                state.output.openLevel(\"empty\");\n\n                // A little too aggressive maybe.\n                primary_tok.strings.suffix = primary_tok.strings.suffix.replace(/[ .,]+$/,\"\");\n                if (primary_locale) {\n                    state.tmp.lang_array = [primary_locale].concat(oldLangArray);\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, null, null, primary_tok, primary_tok.strings.prefix + primary);\n                state.output.append(primary, primary_tok);\n                state.tmp.probably_rendered_something = true;\n\n                if (primary === secondary) {\n                    secondary = false;\n                }\n                if (secondary) {\n                    secondary_tok.strings.prefix = state.opt.citeAffixes[langPrefs][slot.secondary].prefix;\n                    secondary_tok.strings.suffix = state.opt.citeAffixes[langPrefs][slot.secondary].suffix;\n                    // Add a space if empty\n                    if (!secondary_tok.strings.prefix) {\n                        secondary_tok.strings.prefix = \" \";\n                    }\n                    // Remove quotes\n                    for (var i = secondary_tok.decorations.length - 1; i > -1; i += -1) {\n                        if (['@quotes/true', '@font-style/italic', '@font-style/oblique', '@font-weight/bold'].indexOf(secondary_tok.decorations[i].join('/')) > -1) {\n                            secondary_tok.decorations = secondary_tok.decorations.slice(0, i).concat(secondary_tok.decorations.slice(i + 1));\n                        }\n                    }\n                    if (secondary_locale !== \"en\" && secondary_tok.strings[\"text-case\"] === \"title\") {\n                        secondary_tok.strings[\"text-case\"] = \"passthrough\";\n                    }\n                    if (secondary_locale) {\n                        state.tmp.lang_array = [secondary_locale].concat(oldLangArray);\n                    }\n                    var secondary_outer = new CSL.Token();\n                    secondary_outer.decorations.push([\"@font-style\", \"normal\"]);\n                    secondary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n                    state.output.openLevel(secondary_outer);\n                    state.output.append(secondary, secondary_tok);\n                    state.output.closeLevel();\n\n                    var blob_obj = state.output.current.value();\n                    var blobs_pos = state.output.current.value().blobs.length - 1;\n                    // Suppress supplementary multilingual info on subsequent\n                    // partners of a parallel cite?\n                }\n                if (primary === tertiary) {\n                    tertiary = false;\n                }\n                \n                if (tertiary) {\n                    tertiary_tok.strings.prefix = state.opt.citeAffixes[langPrefs][slot.tertiary].prefix;\n                    tertiary_tok.strings.suffix = state.opt.citeAffixes[langPrefs][slot.tertiary].suffix;\n                    // Add a space if empty\n                    if (!tertiary_tok.strings.prefix) {\n                        tertiary_tok.strings.prefix = \" \";\n                    }\n                    // Remove quotes\n                    for (var i = tertiary_tok.decorations.length - 1; i > -1; i += -1) {\n                        if (['@quotes/true', '@font-style/italic', '@font-style/oblique', '@font-weight/bold'].indexOf(tertiary_tok.decorations[i].join('/')) > -1) {\n                            tertiary_tok.decorations = tertiary_tok.decorations.slice(0, i).concat(tertiary_tok.decorations.slice(i + 1));\n                        }\n                    }\n                    if (tertiary_locale !== \"en\" && tertiary_tok.strings[\"text-case\"] === \"title\") {\n                        tertiary_tok.strings[\"text-case\"] = \"passthrough\";\n                    }\n                    if (tertiary_locale) {\n                        state.tmp.lang_array = [tertiary_locale].concat(oldLangArray);\n                    }\n                    var tertiary_outer = new CSL.Token();\n                    tertiary_outer.decorations.push([\"@font-style\", \"normal\"]);\n                    tertiary_outer.decorations.push([\"@font-weight\", \"normal\"]);\n                    state.output.openLevel(tertiary_outer);\n                    state.output.append(tertiary, tertiary_tok);\n                    state.output.closeLevel();\n\n                    var blob_obj = state.output.current.value();\n                    var blobs_pos = state.output.current.value().blobs.length - 1;\n                    // Suppress supplementary multilingual info on subsequent\n                    // partners of a parallel cite?\n                    // See note above.\n                }\n\n                state.output.closeLevel();\n            } else {\n                if (primary_locale) {\n                    state.tmp.lang_array = [primary_locale].concat(oldLangArray);\n                }\n                CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, null, null, primary_tok, primary_tok.strings.prefix + primary);\n                state.output.append(primary, primary_tok);\n                state.tmp.probably_rendered_something = true;\n            }\n\n            state.tmp.lang_array = oldLangArray;\n                \n            if (state.tmp.can_block_substitute) {\n                state.tmp.name_node.children.push(state.output.current.value());\n            }\n            return null;\n        };\n    }\n    this.getOutputFunction = getOutputFunction;\n};\n\n/*global CSL: true */\n\n/**\n * Style token.\n * <p>This class provides the tokens that define\n * the runtime version of the style.  The tokens are\n * instantiated by {@link CSL.Core.Build}, but the token list\n * must be post-processed with\n * {@link CSL.Core.Configure} before it can be used to generate\n * citations.</p>\n * @param {String} name The node name represented by this token.\n * @param {Int} tokentype A flag indicating whether this token\n * marks the start of a node, the end of a node, or is a singleton.\n * @class\n */\nCSL.Token = function (name, tokentype, conditional) {\n    /**\n     * Name of the element.\n     * <p>This corresponds to the element name of the\n     * relevant tag in the CSL file.\n     */\n    this.name = name;\n    /**\n     * Strings and other static content specific to the element.\n     */\n    this.strings = {};\n    this.strings.delimiter = undefined;\n    this.strings.prefix = \"\";\n    this.strings.suffix = \"\";\n    /**\n     * Formatting parameters.\n     * <p>This is a placeholder at instantiation.  It is\n     * replaced by the result of {@link CSL.setDecorations}\n     * when the tag is created and configured during {@link CSL.Core.Build}\n     * by {@link CSL.XmlToToken}.  The parameters for particular\n     * formatting attributes are stored as string arrays, which\n     * map to formatting functions at runtime,\n     * when the output format is known.  Note that the order in which\n     * parameters are registered is fixed by the constant\n     * {@link CSL.FORMAT_KEY_SEQUENCE}.\n     */\n    this.decorations = [];\n    this.variables = [];\n    /**\n     * Element functions.\n     * <p>Functions implementing the styling behaviour of the element\n     * are pushed into this array in the {@link CSL.Core.Build} phase.\n     */\n    this.execs = [];\n    /**\n     * Token type.\n     * <p>This is a flag constant indicating whether the token represents\n     * a start tag, an end tag, or is a singleton.</p>\n     */\n    this.tokentype = tokentype;\n\n    // Conditional attributes added to bare tokens at runtime\n    \n    /**\n     * Condition evaluator.\n     * <p>This is a placeholder that receives a single function, and is\n     * only relevant for a conditional branching tag (<code>if</code> or\n     * <code>else-if</code>).  The function implements the argument to\n     * the <code>match=</code> attribute (<code>any</code>, <code>all</code>\n     * or <code>none</code>), by executing the functions registered in the\n     * <code>tests</code> array (see below), and reacting accordingly.  This\n     * function is invoked by the execution wrappers found in\n     * {@link CSL.Engine}.</p>\n     */\n    // this.evaluator = false;\n    /**\n     * Conditions.\n     * <p>Functions that evaluate to true or false, implementing\n     * various posisble attributes to the conditional branching tags,\n     * are registered here during {@link CSL.Core.Build}.\n     * </p>\n     */\n    // this.tests = [];\n    /**\n     * Jump point on success.\n     * <p>This holds the list jump point to be used when the\n     * <code>evaluator</code> function of a conditional tag\n     * returns true (success).  The jump index value is set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.succeed = false;\n    /**\n     * Jump point on failure.\n     * <p>This holds the list jump point to be used when the\n     * <code>evaluator</code> function of a conditional tag\n     * returns false (failure).  Jump index values are set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.fail = false;\n    /**\n     * Index of next token.\n     * <p>This holds the index of the next token in the\n     * token list, which is the default \"jump-point\" for ordinary\n     * processing.  Jump index values are set during the\n     * back-to-front token pass performed during {@link CSL.Core.Configure}.\n     * </p>\n     */\n    // this.next = false;\n};\n\n// Have needed this for yonks\nCSL.Util.cloneToken = function (token) {\n    var newtok, key, pos, len;\n    if (\"string\" === typeof token) {\n        return token;\n    }\n    newtok = new CSL.Token(token.name, token.tokentype);\n    for (var key in token.strings) {\n        if (token.strings.hasOwnProperty(key)) {\n            newtok.strings[key] = token.strings[key];\n        }\n    }\n    if (token.decorations) {\n        newtok.decorations = [];\n        for (pos = 0, len = token.decorations.length; pos < len; pos += 1) {\n            newtok.decorations.push(token.decorations[pos].slice());\n        }\n    }\n    if (token.variables) {\n        newtok.variables = token.variables.slice();\n    }\n    // Probably overkill; this is only used for cloning formatting\n    // tokens.\n    if (token.execs) {\n        newtok.execs = token.execs.slice();\n        if (token.tests) {\n            newtok.tests = token.tests.slice();\n        }\n    }\n    return newtok;\n};\n\n/*global CSL: true */\n\n/**\n * Ambiguous Cite Configuration Object\n * @class\n */\nCSL.AmbigConfig = function () {\n    this.maxvals = [];\n    this.minval = 1;\n    this.names = [];\n    this.givens = [];\n    this.year_suffix = false;\n    this.disambiguate = 0;\n};\n\n/*global CSL: true */\n\nCSL.Blob = function (str, token, levelname) {\n    var len, pos, key;\n    this.levelname = levelname;\n    //print(levelname);\n    if (token) {\n        this.strings = {\"prefix\":\"\",\"suffix\":\"\"};\n        for (var key in token.strings) {\n            if (token.strings.hasOwnProperty(key)) {\n                this.strings[key] = token.strings[key];\n            }\n        }\n        this.decorations = [];\n        if (token.decorations === undefined) {\n            len = 0;\n        } else {\n            len = token.decorations.length;\n        }\n        for (pos = 0; pos < len; pos += 1) {\n            this.decorations.push(token.decorations[pos].slice());\n        }\n    } else {\n        this.strings = {};\n        this.strings.prefix = \"\";\n        this.strings.suffix = \"\";\n        this.strings.delimiter = \"\";\n        this.decorations = [];\n    }\n    if (\"string\" === typeof str) {\n        this.blobs = str;\n    } else if (str) {\n        this.blobs = [str];\n    } else {\n        this.blobs = [];\n    }\n    this.alldecor = [this.decorations];\n};\n\n\nCSL.Blob.prototype.push = function (blob) {\n    if (\"string\" === typeof this.blobs) {\n        CSL.error(\"Attempt to push blob onto string object\");\n    } else if (false !== blob) {\n        blob.alldecor = blob.alldecor.concat(this.alldecor);\n        this.blobs.push(blob);\n    }\n};\n\n/*global CSL: true */\n\n/**\n * An output instance object representing a number or a range\n *\n * with attributes next and start, and\n * methods isRange(), renderStart(), renderEnd() and renderRange().\n * At render time, the output queue will perform optional\n * collapsing of these objects in the queue, according to\n * configurable options, and apply any decorations registered\n * in the object to the output elements.\n * @namespace Range object and friends.\n */\n\nCSL.NumericBlob = function (state, particle, num, mother_token, id) {\n    // item id is used to assure that prefix delimiter is invoked only\n    // when joining blobs across items\n    this.id = id;\n    this.alldecor = [];\n    this.num = num;\n    this.particle = particle;\n    this.blobs = num.toString();\n    this.status = CSL.START;\n    this.strings = {};\n    if (mother_token) {\n        if (mother_token.strings[\"text-case\"]) {\n            var textCase = mother_token.strings[\"text-case\"];\n            this.particle = CSL.Output.Formatters[textCase](state, this.particle);\n            this.blobs = CSL.Output.Formatters[textCase](state, this.blobs);\n        }\n        this.gender = mother_token.gender;\n        this.decorations = mother_token.decorations;\n        this.strings.prefix = mother_token.strings.prefix;\n        this.strings.suffix = mother_token.strings.suffix;\n        this.strings[\"text-case\"] = mother_token.strings[\"text-case\"];\n        this.successor_prefix = mother_token.successor_prefix;\n        this.range_prefix = mother_token.range_prefix;\n        this.splice_prefix = mother_token.splice_prefix;\n        this.formatter = mother_token.formatter;\n        if (!this.formatter) {\n            this.formatter =  new CSL.Output.DefaultFormatter();\n        }\n        if (this.formatter) {\n            this.type = this.formatter.format(1);\n        }\n    } else {\n        this.decorations = [];\n        this.strings.prefix = \"\";\n        this.strings.suffix = \"\";\n        this.successor_prefix = \"\";\n        this.range_prefix = \"\";\n        this.splice_prefix = \"\";\n        this.formatter = new CSL.Output.DefaultFormatter();\n    }\n};\n\n\nCSL.NumericBlob.prototype.setFormatter = function (formatter) {\n    this.formatter = formatter;\n    this.type = this.formatter.format(1);\n};\n\n\nCSL.Output.DefaultFormatter = function () {};\n\nCSL.Output.DefaultFormatter.prototype.format = function (num) {\n    return num.toString();\n};\n\nCSL.NumericBlob.prototype.checkNext = function (next,start) {\n    if (start) {\n        this.status = CSL.START;\n        if (\"object\" === typeof next) {\n            if (next.num === (this.num + 1)) {\n                next.status = CSL.SUCCESSOR;\n            } else {\n                next.status = CSL.SEEN;\n            }\n        }\n    } else if (! next || !next.num || this.type !== next.type || next.num !== (this.num + 1)) {\n        if (this.status === CSL.SUCCESSOR_OF_SUCCESSOR) {\n            this.status = CSL.END;\n        }\n        if (\"object\" === typeof next) { \n           next.status = CSL.SEEN;\n        }\n    } else { // next number is in the sequence\n        if (this.status === CSL.START || this.status === CSL.SEEN) {\n            next.status = CSL.SUCCESSOR;\n        } else if (this.status === CSL.SUCCESSOR || this.status === CSL.SUCCESSOR_OF_SUCCESSOR) {\n            if (this.range_prefix) {\n                next.status = CSL.SUCCESSOR_OF_SUCCESSOR;\n                this.status = CSL.SUPPRESS;\n            } else {\n                next.status = CSL.SUCCESSOR;\n            }\n        }\n        // wakes up the correct delimiter.\n        //if (this.status === CSL.SEEN) {\n        //    this.status = CSL.SUCCESSOR;\n        //}\n    }\n};\n\n\nCSL.NumericBlob.prototype.checkLast = function (last) {\n    // Used to adjust final non-range join\n    if (this.status === CSL.SEEN \n    || (last.num !== (this.num - 1) && this.status === CSL.SUCCESSOR)) {\n        this.status = CSL.SUCCESSOR;\n        return true;\n    }\n    return false;\n};\n\n/*global CSL: true */\n\nCSL.Util.fixDateNode = function (parent, pos, node) {\n    var form, variable, datexml, subnode, partname, attr, val, prefix, suffix, children, subchildren, display, cslid;\n    \n    var lingo = this.cslXml.getAttributeValue(node, \"lingo\");\n\n    var default_locale = this.cslXml.getAttributeValue(node, \"default-locale\");\n\n    // Raise date flag, used to control inclusion of year-suffix key in sorts\n    // This may be a little reckless: not sure what happens on no-date conditions\n    this.build.date_key = true;\n\n    form = this.cslXml.getAttributeValue(node, \"form\");\n    var lingo;\n    if (default_locale) {\n        lingo = this.opt[\"default-locale\"][0];\n    } else {\n        lingo = this.cslXml.getAttributeValue(node, \"lingo\");\n    }\n\n    if (!this.getDate(form, default_locale)) {\n        return parent;\n    }\n\n    var dateparts = this.cslXml.getAttributeValue(node, \"date-parts\");\n\n    variable = this.cslXml.getAttributeValue(node, \"variable\");\n    prefix = this.cslXml.getAttributeValue(node, \"prefix\");\n    suffix = this.cslXml.getAttributeValue(node, \"suffix\");\n    display = this.cslXml.getAttributeValue(node, \"display\");\n    cslid = this.cslXml.getAttributeValue(node, \"cslid\");\n\n    //\n    // Xml: Copy a node\n    //\n    datexml = this.cslXml.nodeCopy(this.getDate(form, default_locale));\n    this.cslXml.setAttribute(datexml, 'lingo', this.opt.lang);\n    this.cslXml.setAttribute(datexml, 'form', form);\n    this.cslXml.setAttribute(datexml, 'date-parts', dateparts);\n    this.cslXml.setAttribute(datexml, \"cslid\", cslid);\n    //\n    // Xml: Set attribute\n    //\n    this.cslXml.setAttribute(datexml, 'variable', variable);\n    this.cslXml.setAttribute(datexml, 'default-locale', default_locale);\n    //\n    // Xml: Set flag\n    //\n    if (prefix) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"prefix\", prefix);\n    }\n    if (suffix) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"suffix\", suffix);\n    }\n    if (display) {\n        //\n        // Xml: Set attribute\n        //\n        this.cslXml.setAttribute(datexml, \"display\", display);\n    }\n    //\n    // Step through any date-part children of the layout date node,\n    // and lay their attributes onto the corresponding node in the\n    // locale template node copy.\n    //\n    // tests: language_BaseLocale\n    // tests: date_LocalizedTextInStyleLocaleWithTextCase\n    //\n    children = this.cslXml.children(datexml);\n    for (var key in children) {\n        subnode = children[key];\n        if (\"date-part\" === this.cslXml.nodename(subnode)) {\n            partname = this.cslXml.getAttributeValue(subnode, \"name\");\n            if (default_locale) {\n                this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(datexml, \"date-part\", partname, \"@default-locale\", \"true\");\n            }\n        }\n    }\n\n    children = this.cslXml.children(node);\n    for (var key in children) {\n        subnode = children[key];\n        if (\"date-part\" === this.cslXml.nodename(subnode)) {\n            partname = this.cslXml.getAttributeValue(subnode, \"name\");\n            subchildren = this.cslXml.attributes(subnode);\n            for (attr in subchildren) {\n                if (\"@name\" === attr) {\n                    continue;\n                }\n                if (lingo && lingo !== this.opt.lang) {\n                    if ([\"@suffix\", \"@prefix\", \"@form\"].indexOf(attr) > -1) {\n                        continue;\n                    }\n                }\n                val = subchildren[attr];\n                this.cslXml.setAttributeOnNodeIdentifiedByNameAttribute(datexml, \"date-part\", partname, attr, val);\n            }\n        }\n    }\n    \n    if (\"year\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'month');\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'day');\n        \n    } else if (\"year-month\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'day');\n    } else if (\"month-day\" === this.cslXml.getAttributeValue(node, \"date-parts\")) {\n        //\n        // Xml: Get child nodes\n        //\n        var childNodes = this.cslXml.children(datexml);\n        for (var i=1,ilen=this.cslXml.numberofnodes(childNodes);i<ilen;i++) {\n            //\n            // Xml: Get attribute value (for string comparison)\n            //\n            if (this.cslXml.getAttributeValue(childNodes[i], 'name') === \"year\") {\n                //\n                // Xml: Set attribute value\n                //\n                this.cslXml.setAttribute(childNodes[i-1], \"suffix\", \"\");\n                break;\n            }\n        }\n        //\n        // Xml: Find one node by attribute and delete\n        //\n        this.cslXml.deleteNodeByNameAttribute(datexml, 'year');\n    }\n    return this.cslXml.insertChildNodeAfter(parent, node, pos, datexml);\n};\n\n/*global CSL: true */\n\nCSL.dateMacroAsSortKey = function (state, Item) {\n    CSL.dateAsSortKey.call(this, state, Item, true);\n};\n\n\nCSL.dateAsSortKey = function (state, Item, isMacro) {\n    var dp, elem, value, e, yr, prefix, i, ilen;\n    var variable = this.variables[0];\n    var macroFlag = \"empty\";\n    if (isMacro && state.tmp.extension) {\n        macroFlag = \"macro-with-date\";\n    }\n    dp = Item[variable];\n    if (\"undefined\" === typeof dp) {\n        dp = {\"date-parts\": [[0]] };\n    }\n    if (\"undefined\" === typeof this.dateparts) {\n        this.dateparts = [\"year\", \"month\", \"day\"];\n    }\n    if (dp.raw) {\n        dp = state.fun.dateparser.parseDateToArray(dp.raw);\n    } else if (dp[\"date-parts\"]) {\n        dp = state.dateParseArray(dp);\n    }\n    if (\"undefined\" === typeof dp) {\n        dp = {};\n    }\n    if (dp.year) {\n        for (i = 0, ilen = CSL.DATE_PARTS_INTERNAL.length; i < ilen; i += 1) {\n            elem = CSL.DATE_PARTS_INTERNAL[i];\n            value = 0;\n            e = elem;\n            if (e.slice(-4) === \"_end\") {\n                e = e.slice(0, -4);\n            }\n            if (dp[elem] && this.dateparts.indexOf(e) > -1) {\n                value = dp[elem];\n            }\n            if (elem.slice(0, 4) === \"year\") {\n                yr = CSL.Util.Dates[e].numeric(state, value);\n                var prefix = \"1\";\n                if (yr[0] === \"-\") {\n                    prefix = \"0\";\n                    yr = yr.slice(1);\n                    yr = 9999 - parseInt(yr, 10);\n                }\n                state.output.append(CSL.Util.Dates[elem.slice(0, 4)].numeric(state, (prefix + yr)), macroFlag);\n            } else {\n                value = CSL.Util.Dates[e][\"numeric-leading-zeros\"](state, value);\n                // Ugh.\n                if (!value) {\n                    value = \"00\";\n                }\n                state.output.append(value, macroFlag);\n            }\n        }\n    }\n};\n\nCSL.Engine.prototype.dateParseArray = function (date_obj) {\n    var ret, field, dp, exts;\n    ret = {};\n    for (field in date_obj) {\n        if (field === \"date-parts\") {\n            dp = date_obj[\"date-parts\"];\n            if (dp.length > 1) {\n                if (dp[0].length !== dp[1].length) {\n                    CSL.error(\"CSL data error: element mismatch in date range input.\");\n                }\n            }\n            exts = [\"\", \"_end\"];\n            for (var i = 0, ilen = dp.length; i < ilen; i += 1) {\n                for (var j = 0, jlen = CSL.DATE_PARTS.length; j < jlen; j += 1) {\n                    if (isNaN(parseInt(dp[i][j], 10))) {\n                        ret[(CSL.DATE_PARTS[j] + exts[i])] = undefined;\n                    } else {\n                        ret[(CSL.DATE_PARTS[j] + exts[i])] = parseInt(dp[i][j], 10);\n                    }\n                }\n            }\n        } else if (date_obj.hasOwnProperty(field)) {\n\n            // XXXX: temporary workaround\n\n            if (field === \"literal\" && \"object\" === typeof date_obj.literal && \"string\" === typeof date_obj.literal.part) {\n                CSL.debug(\"Warning: fixing up weird literal date value\");\n                ret.literal = date_obj.literal.part;\n            } else {\n                ret[field] = date_obj[field];\n            }\n        }\n    }\n    return ret;\n};\n\n/*global CSL: true */\n\nCSL.Util.Names = {};\n\nCSL.Util.Names.compareNamesets = CSL.NameOutput.prototype._compareNamesets;\n\n/**\n * Un-initialize a name (quash caps after first character)\n */\nCSL.Util.Names.unInitialize = function (state, name) {\n    var i, ilen, namelist, punctlist, ret;\n    if (!name) {\n        return \"\";\n    }\n    namelist = name.split(/(?:\\-|\\s+)/);\n    punctlist = name.match(/(\\-|\\s+)/g);\n    ret = \"\";\n    for (i = 0, ilen = namelist.length; i < ilen; i += 1) {\n        // if (CSL.ALL_ROMANESQUE_REGEXP.exec(namelist[i].slice(0,-1)) \n        //    && namelist[i] \n        //    && namelist[i] !== namelist[i].toUpperCase()) {\n\n            // More or less like this, to address the following fault report:\n            // http://forums.zotero.org/discussion/17610/apsa-problems-with-capitalization-of-mc-mac-etc/\n\n            // Leaving the name string untouched because name capitalization is varied and wonderful.\n            // https://github.com/Juris-M/citeproc-js/issues/43\n            \n            //namelist[i] = namelist[i].slice(0, 1) + namelist[i].slice(1, 2).toLowerCase() + namelist[i].slice(2);\n        // }\n        ret += namelist[i];\n        if (i < ilen - 1) {\n            ret += punctlist[i];\n        }\n    }\n    return ret;\n};\n\n/**\n * Initialize a name.\n */\nCSL.Util.Names.initializeWith = function (state, name, terminator, normalizeOnly) {\n    var i, ilen, mm, lst, ret;\n    if (!name) {\n        return \"\";\n    }\n    if (!terminator) {\n        terminator = \"\";\n    }\n    if ([\"Lord\", \"Lady\"].indexOf(name) > -1\n        || (!name.replace(/^(?:<[^>]+>)*/, \"\").match(CSL.STARTSWITH_ROMANESQUE_REGEXP)\n            && !terminator.match(\"%s\"))) {\n        return name;\n    }\n\n    if (state.opt[\"initialize-with-hyphen\"] === false) {\n        name = name.replace(/\\-/g, \" \");\n    }\n\n    // We need to suss out what is a set of initials or abbreviation,\n    // so that they can be selectively normalized. Steps might be:\n    //   (1) Split the string\n    //   (2) Step through the string, deleting periods and, if initalize=\"false\", then\n    //       (a) note abbreviations and initials (separately).\n    //   (3) If initialize=\"false\" then:\n    //       (a) Do the thing below, but only pushing terminator; or else\n    //       (b) Do the thing below\n\n    name = name.replace(/\\s*\\-\\s*/g, \"-\").replace(/\\s+/g, \" \");\n    name = name.replace(/-([a-z])/g, \"\\u2013$1\");\n\n    for (var i=name.length-2; i>-1; i += -1) {\n        if (name.slice(i, i+1) === \".\" && name.slice(i+1, i+2) !== \" \") {\n            name = name.slice(0, i) + \". \" + name.slice(i+1);\n        }\n    }\n\n    // (1) Split the string\n    var nameSplits = CSL.Output.Formatters.nameDoppel.split(name);\n    var namelist = [];\n    namelist = [nameSplits.strings[0]];\n\n    if (nameSplits.tags.length === 0) {\n        var mmm = namelist[0].match(/[^\\.]+$/);\n        if (mmm && mmm[0].length === 1 && mmm[0] !== mmm[0].toLowerCase()) {\n            namelist[0] += \".\";\n        }\n    }\n\n    for (i = 1, ilen = nameSplits.strings.length; i < ilen; i += 1) {\n        namelist.push(nameSplits.tags[i - 1]);\n        namelist.push(nameSplits.strings[i]);\n    }\n\n    // Use doInitializeName or doNormalizeName, depending on requirements.\n    if (normalizeOnly) {\n        ret = this.doNormalize(state, namelist, terminator);\n    } else {\n        ret = this.doInitialize(state, namelist, terminator);\n    }\n    ret = ret.replace(/\\u2013([a-z])/g, \"-$1\");\n    return ret;\n};\n\nCSL.Util.Names.notag = function(str) {\n    return str.replace(/^(?:<[^>]+>)*/, \"\");\n};\n\nCSL.Util.Names.mergetag = function(state, tagstr, newstr) {\n    var m = tagstr.match(/(?:-*<[^>]+>-*)/g);\n    if (!m) {\n        return newstr;\n    } else {\n        tagstr = m.join(\"\");\n    }\n    m = newstr.match(/^(.*[^\\s])*(\\s+)$/);\n    if (m) {\n        m[1] = m[1] ? m[1] : \"\";\n        newstr = m[1] + tagstr + m[2];\n    } else {\n        newstr = newstr + tagstr;\n    }\n    return newstr;\n};\n\nCSL.Util.Names.tagonly = function(state, str) {\n    var m = str.match(/(?:<[^>]+>)+/);\n    if (!m) {\n        return str;\n    } else {\n        return m.join(\"\");\n    }\n};\n\nCSL.Util.Names.doNormalize = function (state, namelist, terminator) {\n    var i, ilen;\n    // namelist is a flat list of given-name elements and space-like separators between them\n    terminator = terminator ? terminator : \"\";\n    // Flag elements that look like abbreviations\n    var isAbbrev = [];\n    for (i = 0, ilen = namelist.length; i < ilen; i += 1) {\n        if (this.notag(namelist[i]).length > 1 && this.notag(namelist[i]).slice(-1) === \".\") {\n            // namelist[i] = namelist[i].slice(0, -1);\n            namelist[i] = namelist[i].replace(/^(.*)\\.(.*)$/, \"$1$2\");\n            isAbbrev.push(true);\n        } else if (namelist[i].length === 1 && namelist[i].toUpperCase() === namelist[i]) {\n            isAbbrev.push(true);\n        } else {\n            isAbbrev.push(false);\n        }\n    }\n    // Step through the elements of the givenname array\n    for (i = 0, ilen = namelist.length; i < ilen; i += 2) {\n        // If the element is not an abbreviation, leave it and its trailing spaces alone\n        if (isAbbrev[i]) {\n            // For all elements but the last\n            if (i < namelist.length - 2) {\n                // Start from scratch on space-like things following an abbreviation\n                namelist[i + 1] = this.tagonly(state, namelist[i+1]);\n                if (!isAbbrev[i+2]) {\n                    namelist[i + 1] = this.tagonly(state, namelist[i+1]) + \" \";\n                }\n                \n                // Add the terminator to the element\n                // If the following element is not a single-character abbreviation, remove a trailing zero-width non-break space, if present\n                // These ops may leave some duplicate cruft in the elements and separators. This will be cleaned at the end of the function.\n                if (namelist[i + 2].length > 1) {\n                    namelist[i+1] = terminator.replace(/\\ufeff$/, \"\") + namelist[i+1];\n                } else {\n                    namelist[i+1] = this.mergetag(state, namelist[i+1], terminator);\n                }\n            }\n            // For the last element (if it is an abbreviation), just append the terminator\n            if (i === namelist.length - 1) {\n                namelist[i] = namelist[i] + terminator;\n            }\n        }\n    }\n    // Remove trailing cruft and duplicate spaces, and return\n    return namelist.join(\"\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020\\ufeff\\u00a0]+$/,\"\").replace(/\\s*\\-\\s*/g, \"-\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020]+/g, \" \");\n};\n\nCSL.Util.Names.doInitialize = function (state, namelist, terminator) {\n    var i, ilen, m, j, jlen, lst, n;\n    for (i = 0, ilen = namelist.length; i < ilen; i += 2) {\n        n = namelist[i];\n        if (!n) {\n            continue;\n        }\n        m = n.match(CSL.NAME_INITIAL_REGEXP);\n        if (!m && (!n.match(CSL.STARTSWITH_ROMANESQUE_REGEXP) && n.length > 1 && terminator.match(\"%s\"))) {\n            m = n.match(/(.)(.*)/);\n        }\n        if (m && m[2] && m[3]) {\n            m[1] = m[1] + m[2];\n            m[2] = \"\";\n        }\n        if (m && m[1].slice(0, 1) === m[1].slice(0, 1).toUpperCase()) {\n            var extra = \"\";\n            if (m[2]) {\n                var s = \"\";\n                lst = m[2].split(\"\");\n                for (j = 0, jlen = lst.length; j < jlen; j += 1) {\n                    var c = lst[j];\n                    if (c === c.toUpperCase()) {\n                        s += c;\n                    } else {\n                        break;\n                    }\n                }\n                if (s.length < m[2].length) {\n                    extra = CSL.toLocaleLowerCase.call(state, s);\n                }\n            }\n            namelist[i] = m[1] + extra;\n            if (i < (ilen - 1)) {\n                if (terminator.match(\"%s\")) {\n                    namelist[i] = terminator.replace(\"%s\", namelist[i]);\n                } else {\n                    if (namelist[i + 1].indexOf(\"-\") > -1) {\n                        namelist[i + 1] = this.mergetag(state, namelist[i+1].replace(\"-\", \"\"), terminator) + \"-\";\n                    } else {\n                        namelist[i + 1] = this.mergetag(state, namelist[i+1], terminator);\n                    }\n                }\n            } else {\n                if (terminator.match(\"%s\")) {\n                    namelist[i] = terminator.replace(\"%s\", namelist[i]);\n                } else {\n                    namelist.push(terminator);\n                }\n            }\n        } else if (n.match(CSL.ROMANESQUE_REGEXP) && (!m || !m[3])) {\n            namelist[i] = \" \" + n;\n        }\n    }\n    var ret = namelist.join(\"\");\n    ret = ret.replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020\\ufeff\\u00a0]+$/,\"\").replace(/\\s*\\-\\s*/g, \"-\").replace(/[\\u0009\\u000a\\u000b\\u000c\\u000d\\u0020]+/g, \" \");\n    return ret;\n};\n\nCSL.Util.Names.getRawName = function (name) {\n    var ret = [];\n    if (name.literal) {\n        ret.push(name.literal);\n    } else {\n        if (name.given) {\n            ret.push(name.given);\n        }\n        if (name.family) {\n            ret.push(name.family);\n        }\n    }\n    return ret.join(\" \");\n};\n\n/*global CSL: true */\n\n/**\n * Date mangling functions.\n * @namespace Date construction utilities\n */\nCSL.Util.Dates = {};\n\n/**\n * Year manglers\n * <p>short, long</p>\n */\nCSL.Util.Dates.year = {};\n\n/**\n * Convert year to long form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.year[\"long\"] = function (state, num) {\n    if (!num) {\n        if (\"boolean\" === typeof num) {\n            num = \"\";\n        } else {\n            num = 0;\n        }\n    }\n    return num.toString();\n};\n\n/**\n * Crudely convert to Japanese Imperial form.\n * <p>Returns the result as a string.</p>\n */\nCSL.Util.Dates.year.imperial = function (state, num, end) {\n    var year = \"\";\n    if (!num) {\n        if (\"boolean\" === typeof num) {\n            num = \"\";\n        } else {\n            num = 0;\n        }\n    }\n    end = end ? \"_end\" : \"\";\n    var month = state.tmp.date_object[\"month\" + end];\n    month = month ? \"\"+month : \"1\";\n    while (month.length < 2) {\n        month = \"0\" + month;\n    }\n    var day = state.tmp.date_object[\"day\" + end];\n    day = day ? \"\"+day : \"1\";\n    while (day.length < 2) {\n        day = \"0\" + day;\n    }\n    var date = parseInt(num + month + day, 10);\n    var label;\n    var offset;\n    if (date >= 18680908 && date < 19120730) {\n        label = '\\u660e\\u6cbb';\n        offset = 1867;\n    } else if (date >= 19120730 && date < 19261225) {\n        label = '\\u5927\\u6b63';\n        offset = 1911;\n    } else if (date >= 19261225 && date < 19890108) {\n        label = '\\u662d\\u548c';\n        offset = 1925;\n    } else if (date >= 19890108) {\n        label = '\\u5e73\\u6210';\n        offset = 1988;\n    }\n    // This entire \"imperial\" code block should be cut. Scraped input\n    // for this will be too ratty to be useful anyway.\n    if (label && offset) {\n        var normalizedKey = label;\n        if (state.sys.normalizeAbbrevsKey) {\n            // The first argument does not need to specify the exact variable\n            // name.\n            normalizedKey = state.sys.normalizeAbbrevsKey(\"number\", label);\n        }\n        if (!state.transform.abbrevs['default']['number'][normalizedKey]) {\n            // loadAbbreviation normally takes an item as fourth argument.\n            // It is not available here, \n            state.transform.loadAbbreviation('default', \"number\", normalizedKey, null);\n        }\n        if (state.transform.abbrevs['default']['number'][normalizedKey]) {\n            label = state.transform.abbrevs['default']['number'][normalizedKey];\n        }\n        year = label + (num - offset);\n    }\n    return year;\n};\n\n/**\n * Convert year to short form\n * <p>Just crops any 4-digit year to the last two digits.</p>\n */\nCSL.Util.Dates.year[\"short\"] = function (state, num) {\n    num = num.toString();\n    if (num && num.length === 4) {\n        return num.substr(2);\n    }\n};\n\n\n/**\n * Convert year to short form\n * <p>Just crops any 4-digit year to the last two digits.</p>\n */\nCSL.Util.Dates.year.numeric = function (state, num) {\n    var m, pre;\n    num = \"\" + num;\n    var m = num.match(/([0-9]*)$/);\n    if (m) {\n        pre = num.slice(0, m[1].length * -1);\n        num = m[1];\n    } else {\n        pre = num;\n        num = \"\";\n    }\n    while (num.length < 4) {\n        num = \"0\" + num;\n    }\n    return (pre + num);\n};\n\n\n/*\n * MONTH manglers\n * normalize\n * long, short, numeric, numeric-leading-zeros\n */\nCSL.Util.Dates.normalizeMonth = function (num, useSeason) {\n    var ret;\n    if (!num) {\n        num = 0;\n    }\n    num = \"\" + num;\n    if (!num.match(/^[0-9]+$/)) {\n        num = 0;\n    }\n    num = parseInt(num, 10);\n    if (useSeason) {\n        var res = {stub: \"month-\", num: num};\n        if (res.num < 1 || res.num > 24) {\n            res.num = 0;\n        } else {\n            while (res.num > 16) {\n                res.num = res.num - 4;\n            }\n            if (res.num > 12) {\n                res.stub = \"season-\";\n                res.num = res.num - 12;\n            }\n        }\n        ret = res;\n    } else {\n        if (num < 1 || num > 12) {\n            num = 0;\n        }\n        ret = num;\n    }\n    return ret;\n};\n\nCSL.Util.Dates.month = {};\n\n/**\n * Convert month to numeric form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.month.numeric = function (state, num) {\n    var num = CSL.Util.Dates.normalizeMonth(num);\n    if (!num) {\n        num = \"\";\n    }\n    return num;\n};\n\n/**\n * Convert month to numeric-leading-zeros form\n * <p>This just passes the number back as string padded with zeros.</p>\n */\nCSL.Util.Dates.month[\"numeric-leading-zeros\"] = function (state, num) {\n    var num = CSL.Util.Dates.normalizeMonth(num);\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n    }\n    return num;\n};\n\n/**\n * Convert month to long form\n * <p>This passes back the month of the locale in long form.</p>\n */\n\n// Gender is not currently used. Is it needed?\n\nCSL.Util.Dates.month[\"long\"] = function (state, num, gender, forceDefaultLocale) {\n    var res = CSL.Util.Dates.normalizeMonth(num, true);\n    var num = res.num;\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n        num = state.getTerm(res.stub + num, \"long\", 0, 0, false, forceDefaultLocale);\n    }\n    return num;\n};\n\n/**\n * Convert month to long form\n * <p>This passes back the month of the locale in short form.</p>\n */\n\n// See above.\n\nCSL.Util.Dates.month[\"short\"] = function (state, num, gender, forceDefaultLocale) {\n    var res = CSL.Util.Dates.normalizeMonth(num, true);\n    var num = res.num;\n    if (!num) {\n        num = \"\";\n    } else {\n        num = \"\" + num;\n        while (num.length < 2) {\n            num = \"0\" + num;\n        }\n        num = state.getTerm(res.stub + num, \"short\", 0, 0, false, forceDefaultLocale);\n    }\n    return num;\n};\n\n/*\n * DAY manglers\n * numeric, numeric-leading-zeros, ordinal\n */\nCSL.Util.Dates.day = {};\n\n/**\n * Convert day to numeric form\n * <p>This just passes the number back as a string.</p>\n */\nCSL.Util.Dates.day.numeric = function (state, num) {\n    return num.toString();\n};\n\nCSL.Util.Dates.day[\"long\"] = CSL.Util.Dates.day.numeric;\n\n/**\n * Convert day to numeric-leading-zeros form\n * <p>This just passes the number back as a string padded with zeros.</p>\n */\nCSL.Util.Dates.day[\"numeric-leading-zeros\"] = function (state, num) {\n    if (!num) {\n        num = 0;\n    }\n    num = num.toString();\n    while (num.length < 2) {\n        num = \"0\" + num;\n    }\n    return num.toString();\n};\n\n/**\n * Convert day to ordinal form\n * <p>This will one day pass back the number as a string with the\n * ordinal suffix appropriate to the locale.  For the present,\n * it just does what is most of the time right for English.</p>\n */\nCSL.Util.Dates.day.ordinal = function (state, num, gender) {\n    return state.fun.ordinalizer.format(num, gender);\n};\n\n/*global CSL: true */\n\n/**\n * Helper functions for constructing sort keys.\n * @namespace Sort key utilities\n */\nCSL.Util.Sort = {};\n\n/**\n * Strip prepositions from a string\n * <p>Used when generating sort keys.</p>\n */\nCSL.Util.Sort.strip_prepositions = function (str) {\n    var m;\n    if (\"string\" === typeof str) {\n        m = str.match(/^(([aA]|[aA][nN]|[tT][hH][eE])\\s+)/);\n    }\n    if (m) {\n        str = str.substr(m[1].length);\n    }\n    return str;\n};\n\n/*global CSL: true */\n\nCSL.Util.substituteStart = function (state, target) {\n    var element_trace, display, bib_first, func, choose_start, if_start, nodetypes;\n    func = function (state, Item, item) {\n        for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                state.tmp.strip_periods += 1;\n                break;\n            }\n        }\n    };\n    this.execs.push(func);\n    if (this.decorations && state.opt.development_extensions.csl_reverse_lookup_support) {\n        this.decorations.reverse();\n        this.decorations.push([\"@showid\",\"true\", this.cslid]);\n        this.decorations.reverse();\n    }\n    //\n    // Contains body code for both substitute and first-field/remaining-fields\n    // formatting.\n    //\n\n    nodetypes = [\"number\", \"date\", \"names\"];\n    if ((\"text\" === this.name && !this.postponed_macro) || nodetypes.indexOf(this.name) > -1) {\n        element_trace = function (state, Item, item) {\n            if (state.tmp.element_trace.value() === \"author\" || \"names\" === this.name) {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    if (!state.tmp.probably_rendered_something) {\n                    } else {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                    if (!state.tmp.probably_rendered_something) {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n            }\n            else if (\"date\" === this.name) {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    if (state.tmp.probably_rendered_something) {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                /*\n                if (!state.tmp.just_looking && item && item[\"suppress-author\"]) {\n                    if (state.tmp.probably_rendered_something) {\n                        //state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                }\n                */\n            } else {\n                if (!state.tmp.just_looking && item && item[\"author-only\"] && state.tmp.area !== \"intext\") {\n                    // XXX can_block_substitute probably is doing nothing here. The value is always true.\n                    if (!state.tmp.probably_rendered_something && state.tmp.can_block_substitute) {\n                    } else {\n                        state.tmp.element_trace.push(\"suppress-me\");\n                    }\n                } else if (item && item[\"suppress-author\"]) {\n                    state.tmp.element_trace.push(\"do-not-suppress-me\");\n                }\n            }\n        };\n        this.execs.push(element_trace);\n    }\n    display = this.strings.cls;\n    this.strings.cls = false;\n    if (state.build.render_nesting_level === 0) {\n        //\n        // The markup formerly known as @bibliography/first\n        //\n        // Separate second-field-align from the generic display logic.\n        // There will be some code replication, but not in the\n        // assembled style.\n        //\n        if (state.build.area === \"bibliography\" && state.bibliography.opt[\"second-field-align\"]) {\n            bib_first = new CSL.Token(\"group\", CSL.START);\n            bib_first.decorations = [[\"@display\", \"left-margin\"]];\n            func = function (state, Item) {\n                if (!state.tmp.render_seen) {\n                    bib_first.strings.first_blob = Item.id;\n                    state.output.startTag(\"bib_first\", bib_first);\n                }\n            };\n            bib_first.execs.push(func);\n            target.push(bib_first);\n        } else if (CSL.DISPLAY_CLASSES.indexOf(display) > -1) {\n            bib_first = new CSL.Token(\"group\", CSL.START);\n            bib_first.decorations = [[\"@display\", display]];\n            func = function (state, Item) {\n                bib_first.strings.first_blob = Item.id;\n                state.output.startTag(\"bib_first\", bib_first);\n            };\n            bib_first.execs.push(func);\n            target.push(bib_first);\n        }\n        state.build.cls = display;\n    }\n    state.build.render_nesting_level += 1;\n    // Should this be render_nesting_level, with the increment\n    // below? ... ?\n    if (state.build.substitute_level.value() === 1) {\n        //\n        // All top-level elements in a substitute environment get\n        // wrapped in conditionals.  The substitute_level variable\n        // is a stack, because spanned names elements (with their\n        // own substitute environments) can be nested inside\n        // a substitute environment.\n        //\n        // (okay, we use conditionals a lot more than that.\n        // we slot them in for author-only as well...)\n        choose_start = new CSL.Token(\"choose\", CSL.START);\n        CSL.Node.choose.build.call(choose_start, state, target);\n        if_start = new CSL.Token(\"if\", CSL.START);\n        //\n        // Set a test of the shadow if token to skip this\n        // macro if we have acquired a name value.\n\n        // check for variable\n        func = function () {\n            if (state.tmp.can_substitute.value()) {\n                return true;\n            }\n            return false;\n        };\n        if_start.tests ? {} : if_start.tests = [];\n        if_start.tests.push(func);\n        if_start.test = state.fun.match.any(this, state, if_start.tests);\n        target.push(if_start);\n    }\n\n    if (state.sys.variableWrapper\n        && this.variables_real\n        && this.variables_real.length) {\n\n        func = function (state, Item, item) {\n            if (!state.tmp.just_looking && !state.tmp.suppress_decorations) {\n                // Attach item data and variable names.\n                // Do with them what you will.\n                var variable_entry = new CSL.Token(\"text\", CSL.START);\n                variable_entry.decorations = [[\"@showid\", \"true\"]];\n                state.output.startTag(\"variable_entry\", variable_entry);\n                var position = null;\n                if (item) {\n                    position = item.position;\n                }\n                if (!position) {\n                    position = 0;\n                }\n                var positionMap = [\n                    \"first\",\n                    \"container-subsequent\",\n                    \"subsequent\",\n                    \"ibid\",\n                    \"ibid-with-locator\"\n                ];\n                var noteNumber = 0;\n                if (item && item.noteIndex) {\n                    noteNumber = item.noteIndex;\n                }\n                var firstReferenceNoteNumber = 0;\n                if (item && item['first-reference-note-number']) {\n                    firstReferenceNoteNumber = item['first-reference-note-number'];\n                }\n                var firstContainerReferenceNoteNumber = 0;\n                if (item && item['first-container-reference-note-number']) {\n                    firstContainerReferenceNoteNumber = item['first-container-reference-note-number'];\n                }\n                var citationNumber = 0;\n                // XXX Will this EVER happen?\n                if (item && item['citation-number']) {\n                    citationNumber = item['citation-number'];\n                }\n                var index = 0;\n                if (item && item.index) {\n                    index = item.index;\n                }\n                var params = {\n                    itemData: Item,\n                    variableNames: this.variables,\n                    context: state.tmp.area,\n                    xclass: state.opt.xclass,\n                    position: positionMap[position],\n                    \"note-number\": noteNumber,\n                    \"first-reference-note-number\": firstReferenceNoteNumber,\n                    \"first-container-reference-note-number\": firstContainerReferenceNoteNumber,\n                    \"citation-number\": citationNumber,\n                    \"index\": index,\n                    \"mode\": state.opt.mode\n                };\n                state.output.current.value().params = params;\n            }\n        };\n        this.execs.push(func);\n    }\n};\n\n\nCSL.Util.substituteEnd = function (state, target) {\n    var func, bib_first_end, bib_other, if_end, choose_end, author_substitute, str;\n\n    if (state.sys.variableWrapper\n        && (this.hasVariable || (this.variables_real && this.variables_real.length))) {\n        \n        func = function (state) {\n            if (!state.tmp.just_looking && !state.tmp.suppress_decorations) {\n                state.output.endTag(\"variable_entry\");\n            }\n        };\n        this.execs.push(func);\n    }\n\n    func = function (state) {\n        for (var i = 0, ilen = this.decorations.length; i < ilen; i += 1) {\n            if (\"@strip-periods\" === this.decorations[i][0] && \"true\" === this.decorations[i][1]) {\n                state.tmp.strip_periods += -1;\n                break;\n            }\n        }\n    };\n    this.execs.push(func);\n\n    state.build.render_nesting_level += -1;\n    if (state.build.render_nesting_level === 0) {\n        if (state.build.cls) {\n            func = function (state) {\n                state.output.endTag(\"bib_first\");\n            };\n            this.execs.push(func);\n            state.build.cls = false;\n        } else if (state.build.area === \"bibliography\" && state.bibliography.opt[\"second-field-align\"]) {\n            bib_first_end = new CSL.Token(\"group\", CSL.END);\n            // first func end\n            func = function (state) {\n                if (!state.tmp.render_seen) {\n                    state.output.endTag(\"bib_first\"); // closes bib_first\n                }\n            };\n            bib_first_end.execs.push(func);\n            target.push(bib_first_end);\n            bib_other = new CSL.Token(\"group\", CSL.START);\n            bib_other.decorations = [[\"@display\", \"right-inline\"]];\n            func = function (state) {\n                if (!state.tmp.render_seen) {\n                    state.tmp.render_seen = true;\n                    state.output.startTag(\"bib_other\", bib_other);\n                }\n            };\n            bib_other.execs.push(func);\n            target.push(bib_other);\n        }\n    }\n    if (state.build.substitute_level.value() === 1) {\n        if_end = new CSL.Token(\"if\", CSL.END);\n        target.push(if_end);\n        choose_end = new CSL.Token(\"choose\", CSL.END);\n        CSL.Node.choose.build.call(choose_end, state, target);\n    }\n\n    if (\"names\" === this.name || (\"text\" === this.name && this.variables_real !== \"title\")) {\n        author_substitute = new CSL.Token(\"text\", CSL.SINGLETON);\n        var substitution_name = this.name;\n        func = function (state, Item) {\n            if (state.tmp.area !== \"bibliography\") {\n                return;\n            }\n            if (\"string\" !== typeof state.bibliography.opt[\"subsequent-author-substitute\"]) {\n                return;\n            }\n            if (this.variables_real && !Item[this.variables_real]) {\n                return;\n            }\n            // The logic of these two is not obvious. The effect is to enable placeholder substitution\n            // on a text macro name substitution, without printing both the text macro AND the placeholder.\n            // See https://forums.zotero.org/discussion/comment/350407\n            if (this.variables_real && substitution_name === \"names\") {\n                return;\n            }\n\n            var subrule = state.bibliography.opt[\"subsequent-author-substitute-rule\"];\n            var i, ilen;\n            //var text_esc = CSL.getSafeEscape(state);\n            var printing = !state.tmp.suppress_decorations;\n            if (printing && state.tmp.subsequent_author_substitute_ok) {\n                if (state.tmp.rendered_name) {\n                    if (\"partial-each\" === subrule || \"partial-first\" === subrule) {\n                        var dosub = true;\n                        var rendered_name = [];\n                        // This is a wee bit risky, as we're assuming that the name\n                        // children and the list of stringified names are congruent.\n                        // That *should* always be true, but you never know.\n                        for (i = 0, ilen = state.tmp.name_node.children.length; i < ilen; i += 1) {\n                            var name = state.tmp.rendered_name[i];\n                            if (dosub\n                                && state.tmp.last_rendered_name && state.tmp.last_rendered_name.length > (i - 1)\n                                && name && !name.localeCompare(state.tmp.last_rendered_name[i])) {\n                                str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                state.tmp.name_node.children[i].blobs = [str];\n                                if (\"partial-first\" === subrule) {\n                                    dosub = false;\n                                }\n                            } else {\n                                dosub = false;\n                            }\n                            rendered_name.push(name);\n                        }\n                        // might want to slice this?\n                        state.tmp.last_rendered_name = rendered_name;\n                    } else if (\"complete-each\" === subrule) {\n                        var rendered_name = state.tmp.rendered_name.join(\",\");\n                        if (rendered_name) {\n                            if (state.tmp.last_rendered_name && !rendered_name.localeCompare(state.tmp.last_rendered_name)) {\n                                for (i = 0, ilen = state.tmp.name_node.children.length; i < ilen; i += 1) {\n                                    str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                    state.tmp.name_node.children[i].blobs = [str];\n                                }\n                            }\n                            state.tmp.last_rendered_name = rendered_name;\n                        }\n                    } else {\n                        var rendered_name = state.tmp.rendered_name.join(\",\");\n                        if (rendered_name) {\n                            if (state.tmp.last_rendered_name && !rendered_name.localeCompare(state.tmp.last_rendered_name)) {\n                                str = new CSL.Blob(state[state.tmp.area].opt[\"subsequent-author-substitute\"]);\n                                if (state.tmp.label_blob) {\n                                    state.tmp.name_node.top.blobs = [str,state.tmp.label_blob];\n                                } else if (state.tmp.name_node.top.blobs.length) {\n                                    state.tmp.name_node.top.blobs[0].blobs = [str];\n                                } else {\n                                    state.tmp.name_node.top.blobs = [str];\n                                }\n                                state.tmp.substituted_variable = substitution_name;\n                            }\n                            state.tmp.last_rendered_name = rendered_name;\n                        }\n                    }\n                    state.tmp.subsequent_author_substitute_ok = false;\n                }\n            }\n        };\n        this.execs.push(func);\n    }\n\n    if ((\"text\" === this.name && !this.postponed_macro) || [\"number\", \"date\", \"names\"].indexOf(this.name) > -1) {\n        // element trace\n        func = function (state, Item) {\n            // element_trace is a mess, but it's trying to do something simple.\n            // A queue append is done, and element_trace.value() returns \"suppress-me\"\n            // the append is aborted. That's it.\n            // It seems only to be used on numeric elements of numeric styles ATM.\n            // If used only for that purpose, it could be greatly simplified.\n            // If cleaned up, it could do more interesting things, like control\n            // the suppression of names set later than first position.\n            if (state.tmp.element_trace.mystack.length>1) {\n                state.tmp.element_trace.pop();\n            }\n        };\n        this.execs.push(func);\n    }\n};\n\n/*global CSL: true */\n\nCSL.Util.padding = function (num) {\n    var m = num.match(/\\s*(-{0,1}[0-9]+)/);\n    if (m) {\n        num = parseInt(m[1], 10);\n        if (num < 0) {\n            num = 99999999999999999999 + num;\n        }\n        num = \"\" + num;\n        while (num.length < 20) {\n            num = \"0\" + num;\n        }\n    }\n    return num;\n};\n\nCSL.Util.LongOrdinalizer = function () {};\n\nCSL.Util.LongOrdinalizer.prototype.init = function (state) {\n    this.state = state;\n};\n\nCSL.Util.LongOrdinalizer.prototype.format = function (num, gender) {\n    if (num < 10) {\n        num = \"0\" + num;\n    }\n    // Argument true means \"loose\".\n    var ret = CSL.Engine.getField(\n        CSL.LOOSE, \n        this.state.locale[this.state.opt.lang].terms,\n        \"long-ordinal-\" + num,\n        \"long\", \n        0, \n        gender\n    );\n    if (!ret) {\n        ret = this.state.fun.ordinalizer.format(num, gender);\n    }\n    // Probably too optimistic -- what if only renders in _sort?\n    this.state.tmp.cite_renders_content = true;\n    return ret;\n};\n\n\nCSL.Util.Ordinalizer = function (state) {\n    this.state = state;\n    this.suffixes = {};\n};\n\nCSL.Util.Ordinalizer.prototype.init = function () {\n    if (!this.suffixes[this.state.opt.lang]) {\n        this.suffixes[this.state.opt.lang] = {};\n        for (var i = 0, ilen = 3; i < ilen; i += 1) {\n            var gender = [undefined, \"masculine\", \"feminine\"][i];\n            this.suffixes[this.state.opt.lang][gender] = [];\n            for (var j = 1; j < 5; j += 1) {\n                var ordinal = this.state.getTerm(\"ordinal-0\" + j, \"long\", false, gender);\n                if (\"undefined\" === typeof ordinal) {\n                    delete this.suffixes[this.state.opt.lang][gender];\n                    break;\n                }\n                this.suffixes[this.state.opt.lang][gender].push(ordinal);\n            }\n        }\n    }\n};\n\nCSL.Util.Ordinalizer.prototype.format = function (num, gender) {\n    var str;\n    num = parseInt(num, 10);\n    str = \"\" + num;\n    var suffix = \"\";\n    var trygenders = [];\n    if (gender) {\n        trygenders.push(gender);\n    }\n    trygenders.push(\"neuter\");\n    if (this.state.locale[this.state.opt.lang].ord[\"1.0.1\"]) {\n        suffix = this.state.getTerm(\"ordinal\",false,0,gender);\n        var trygender;\n        for (var i = 0, ilen = trygenders.length; i < ilen; i += 1) {\n            trygender = trygenders[i];\n            var ordinfo = this.state.locale[this.state.opt.lang].ord[\"1.0.1\"];\n            if (ordinfo[\"whole-number\"][str] && ordinfo[\"whole-number\"][str][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"whole-number\"][str][trygender],false,0,gender);\n            } else if (ordinfo[\"last-two-digits\"][str.slice(str.length - 2)] && ordinfo[\"last-two-digits\"][str.slice(str.length - 2)][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"last-two-digits\"][str.slice(str.length - 2)][trygender],false,0,gender);\n            } else if (ordinfo[\"last-digit\"][str.slice(str.length - 1)] && ordinfo[\"last-digit\"][str.slice(str.length - 1)][trygender]) {\n                suffix = this.state.getTerm(this.state.locale[this.state.opt.lang].ord[\"1.0.1\"][\"last-digit\"][str.slice(str.length - 1)][trygender],false,0,gender);\n            }\n            if (suffix) {\n                break;\n            }\n        }\n    } else {\n        if (!gender) {\n            // XXX hack to prevent crash on CSL 1.0 styles.\n            // Reported by Carles.\n            gender = undefined;\n        }\n        this.state.fun.ordinalizer.init();\n        if ((num / 10) % 10 === 1 || (num > 10 && num < 20)) {\n            suffix = this.suffixes[this.state.opt.lang][gender][3];\n        } else if (num % 10 === 1 && num % 100 !== 11) {\n            suffix = this.suffixes[this.state.opt.lang][gender][0];\n        } else if (num % 10 === 2 && num % 100 !== 12) {\n            suffix = this.suffixes[this.state.opt.lang][gender][1];\n        } else if (num % 10 === 3 && num % 100 !== 13) {\n            suffix = this.suffixes[this.state.opt.lang][gender][2];\n        } else {\n            suffix = this.suffixes[this.state.opt.lang][gender][3];\n        }\n    }\n    str = str += suffix;\n    return str;\n};\n\nCSL.Util.Romanizer = function () {};\n\nCSL.Util.Romanizer.prototype.format = function (num) {\n    var ret, pos, n, numstr, len;\n    ret = \"\";\n    if (num < 6000) {\n        numstr = num.toString().split(\"\");\n        numstr.reverse();\n        pos = 0;\n        n = 0;\n        len = numstr.length;\n        for (pos = 0; pos < len; pos += 1) {\n            n = parseInt(numstr[pos], 10);\n            ret = CSL.ROMAN_NUMERALS[pos][n] + ret;\n        }\n    }\n    return ret;\n};\n\n\n/**\n * Create a suffix formed from a list of arbitrary characters of arbitrary length.\n * <p>This is a <i>lot</i> harder than it seems.</p>\n */\nCSL.Util.Suffixator = function (slist) {\n    if (!slist) {\n        slist = CSL.SUFFIX_CHARS;\n    }\n    this.slist = slist.split(\",\");\n};\n\n/**\n * The format method.\n * <p>This method is used in generating ranges.  Every numeric\n * formatter (of which Suffixator is one) must be an instantiated\n * object with such a \"format\" method.</p>\n */\n\nCSL.Util.Suffixator.prototype.format = function (N) {\n    // Many thanks to Avram Lyon for this code, and good\n    // riddance to the several functions that it replaces.\n    var X;\n    N += 1;\n    var key = \"\";\n    do {\n        X = ((N % 26) === 0) ? 26 : (N % 26);\n        var key = this.slist[X-1] + key;\n        N = (N - X) / 26;\n    } while ( N !== 0 );\n    return key;\n};\n\n\nCSL.Engine.prototype.processNumber = function (node, ItemObject, variable) {\n    //print(\"** processNumber() ItemObject[variable]=\"+ItemObject[variable]);\n    var val;\n\n    var me = this;\n\n    var realVariable = variable;\n    variable = (variable === \"page-first\") ? \"page\" : variable;\n\n    var fullformAnd = \",\\\\s+and\\\\s+|\\\\s+and\\\\s+\";\n    if (this.opt.lang.slice(0, 2) !== \"en\") {\n        fullformAnd += \"|,\\\\s+\" + this.getTerm(\"and\") + \"\\\\s+|\\\\s+\" + this.getTerm(\"and\") + \"\\\\s+\";\n    }\n    var symbolAnd = \"\\\\s*&\\\\s*\";\n    var andRex = new RegExp(\"^\" + symbolAnd+ \"$\");\n    var joinerMatchRex = new RegExp(\"(\" + symbolAnd + \"|\" + fullformAnd + \"|;\\\\s+|,\\\\s+|\\\\s*\\\\\\\\*[\\\\-\\\\u2013]+\\\\s*)\", \"g\");\n    var joinerSplitRex = new RegExp(\"(?:\" + symbolAnd + \"|\" + fullformAnd + \"|;\\\\s+|,\\\\s+|\\\\s*\\\\\\\\*[\\\\-\\\\u2013]+\\\\s*)\");\n\n    // This guesses whether the symbol form is defined or not.\n    // It's the best we can do, because when locales are built, all of the\n    // holes are filled explictly with fallback values: the symbol form is never undefined.\n    var localeAnd = this.getTerm(\"and\");\n    var localeAmpersand = this.getTerm(\"and\", \"symbol\");\n    if (localeAnd === localeAmpersand) {\n        localeAmpersand = \"&\";\n    }\n\n    // XXXX shadow_numbers should carry an array of objects with\n    // XXXX full data for each. The test of a number should be\n    // XXXX a separate function, possibly supported by a splitter\n    // XXXX method also used here. Keep code for each action in one place,\n    // XXXX to prevent debugging from becoming a nightmare.\n\n    // The capture pattern below would apply affixes to all sub-elements,\n    // which is not what we want. Sub-elements should nest within, or\n    // affixes should be edited. The latter is probably easier to handle.\n    \n    // values = [\n    //   {\n    //     label: \"sec.\",\n    //     label-form: \"plural\",\n    //     value: 100,\n    //     styling: [object],\n    //     numeric: true\n    //     joiningSuffix: \" & \",\n    //   },\n    //   {\n    //     label: \"sec.\",\n    //     label-form: \"none\",\n    //     value: 103,\n    //     styling: [object],\n    //     numeric: true,\n    //     joiningSuffix: \"\"\n    //   }\n    // ]\n    \n    function normalizeFieldValue(str) {\n        str = str.trim();\n        var m = str.match(/^([^ ]+)/);\n        if (m && !CSL.STATUTE_SUBDIV_STRINGS[m[1]]) {\n            var embeddedLabel = null;\n            if ([\"locator\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n                if (ItemObject.label) {\n                    embeddedLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[ItemObject.label];\n                } else {\n                    embeddedLabel = \"p.\";\n                }\n            } else {\n                embeddedLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable];\n            }\n            if (embeddedLabel) {\n                str = embeddedLabel + \" \" + str;\n            }\n        }\n        return str;\n    }\n    \n\n    function composeNumberInfo(origLabel, label, val, joiningSuffix, parsePosition) {\n        joiningSuffix = joiningSuffix ? joiningSuffix : \"\";\n        var info = {};\n\n        if (!label && !CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable]) {\n            label = \"var:\"+ variable;\n        }\n\n        if (label) {\n            var m = label.match(/(\\s*)([^\\s]+)(\\s*)/);\n            if (realVariable === \"page\" && parsePosition === 0 && [\"p.\", \"pp.\"].indexOf(m[2]) === -1) {\n                info.gotosleepability = true;\n                info.labelVisibility = true;\n            } else {\n                info.labelVisibility = false;\n            }\n            info.label = m[2];\n            info.origLabel = origLabel;\n            info.labelSuffix = m[3] ? m[3] : \"\";\n            info.plural = 0;\n        }\n        \n        var m = val.match(/^([0-9]*[a-zA-Z]+0*)?([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);\n        //var m = val.match(/^([0-9]*[a-zA-Z]0*)([0-9]+(?:[a-zA-Z]*|[-,a-zA-Z]+))$/);\n        if (m) {\n            info.particle = m[1] ? m[1] : \"\";\n            info.value = m[2];\n        } else {\n            info.particle = \"\";\n            info.value = val;\n        }\n        info.joiningSuffix = joiningSuffix.replace(/\\s*-\\s*/, \"-\");\n        return info;\n    }\n\n    function fixupSubsections(elems) {\n        // This catches things like p. 12a-c, recombining content to yield\n        // numeric true despite the hyphen.\n        for (var i=elems.length-2;i>-1;i-=2) {\n            if (elems[i] === \"-\"\n               && elems[i-1].match(/^(?:(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z])\\.  *)*[0-9]+[,a-zA-Z]+$/)\n               && elems[i+1].match(/^[,a-zA-Z]+$/)) {\n                elems[i-1] = elems.slice(i-1,i+2).join(\"\");\n                elems = elems.slice(0,i).concat(elems.slice(i+2));\n            }\n        }\n        return elems;\n    }\n\n    function parseString(str, defaultLabel) {\n        defaultLabel = defaultLabel ? defaultLabel : \"\";\n        \n        str = normalizeFieldValue(str, defaultLabel);\n\n        var jmrex, jsrex, mystr;\n        if (\"page\" === variable) {\n            if (str.indexOf(\"\\u2013\") > -1) {\n                str = str.replace(/\\u2013/g, \"-\");\n            }\n        }\n        if (str.indexOf(\"\\\\-\") > -1) {\n            jmrex = new RegExp(joinerMatchRex.source.replace(\"\\\\-\", \"\"));\n            jsrex = new RegExp(joinerSplitRex.source.replace(\"\\\\-\", \"\"));\n            var lst = str.split(\"\\\\-\");\n            for (var i=0,ilen=lst.length;i<ilen;i++) {\n                lst[i] = lst[i].replace(/\\-/g, \"\\u2013\");\n            }\n            mystr = lst.join(\"\\\\-\");\n            mystr = mystr.replace(/\\\\/g, \"\");\n        } else {\n            jmrex = joinerMatchRex;\n            jsrex = joinerSplitRex;\n            mystr = str;\n        }\n        // jmrex = joinerMatchRex;\n        // jsrex = joinerSplitRex;\n        \n        // Split chunks and collate delimiters.\n        var elems = [];\n        var m = mystr.match(jmrex);\n        if (m) {\n            var lst = mystr.split(jsrex);\n            for (var i=0, ilen=m.length; i<ilen; i++) {\n                if (m[i].match(andRex)) {\n                    if (lst[i].match(/[a-zA-Z]$/) && lst[i].match(/^[a-zA-Z]/)) {\n                        m[i] = localeAmpersand;\n                    } else {\n                        m[i] = \" \" + localeAmpersand + \" \";\n                    }\n                }\n            }\n            var recombine = false;\n            for (var i in lst) {\n                if ((\"\" + lst[i]).replace(/^[a-z]\\.\\s+/, \"\").match(/[^\\s0-9ivxlcmIVXLCM]/)) {\n                    //recombine = true;\n                    break;\n                }\n            }\n            if (recombine) {\n                elems = [mystr];\n            } else {\n                for (var i=0,ilen=lst.length-1; i<ilen; i++) {\n                    elems.push(lst[i]);\n                    elems.push(m[i]);\n                }\n                elems.push(lst[lst.length-1]);\n                //print(\"ELEMS: \"+elems);\n                elems = fixupSubsections(elems);\n                //print(\"  fixup: \"+elems);\n            }\n        } else {\n            var elems = [mystr];\n        }\n        // Split elements within each chunk build list of value objects.\n        var values = [];\n        var label = defaultLabel;\n        var origLabel = \"\";\n        for (var i=0,ilen=elems.length;i<ilen;i += 2) {\n            \n            // AHA! HERE'S THE CULPRIT!!!\n            // Words up to four characters are treated as honorary short-form labels.\n            // Some valid labels are longer than four chars, so we stir those in explicitly\n            \n            var m = elems[i].match(/((?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\\.| ) *)/g);\n            if (m) {\n                var lst = elems[i].split(/(?:(?:^| )(?:[a-z]|[a-z][a-z]|[a-z][a-z][a-z]|[a-z][a-z][a-z][a-z]|subpara|subch|amend|bibliog|annot|illus|princ|intro|sched|subdiv|subsec)(?:\\.| ) *)/);\n                // Head off disaster by merging parsed labels on non-numeric values into content\n                for (var j=lst.length-1;j>0;j--) {\n                    if (lst[j-1] && (!lst[j].match(/^[0-9]+([-;,:a-zA-Z]*)$/) || !lst[j-1].match(/^[0-9]+([-;,:a-zA-Z]*)$/))) {\n                        lst[j-1] = lst[j-1] + m[j-1] + lst[j];\n                        lst = lst.slice(0,j).concat(lst.slice(j+1));\n                        m = m.slice(0,j-1).concat(m.slice(j));\n                    }\n                }\n                // merge bad leading label into content\n                if (m.length > 0) {\n                    var slug = m[0].trim();\n                    var notAlabel = !CSL.STATUTE_SUBDIV_STRINGS[slug]\n                        || \"undefined\" === typeof me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[slug])\n                        || ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) === -1 && CSL.STATUTE_SUBDIV_STRINGS[slug] !== variable);\n                    if (notAlabel) {\n                        if (i === 0) {\n                            m = m.slice(1);\n                            lst[0] = lst[0] + \" \" + slug + \" \" + lst[1];\n                            lst = lst.slice(0,1).concat(lst.slice(2));\n                        }\n                    } else {\n                        origLabel = slug;\n                    }\n                }\n\n                for (var j=0,jlen=lst.length; j<jlen; j++) {\n                    if (lst[j] || j === (lst.length-1)) {\n                        var filteredOrigLabel;\n                        label = m[j-1] ? m[j-1] : label;\n                        if (origLabel === label.trim()) {\n                            filteredOrigLabel = \"\";\n                        } else {\n                            filteredOrigLabel = origLabel;\n                        }\n                        //var origLabel = j > 1 ? m[j-1] : \"\";\n                        mystr = lst[j] ? lst[j].trim() : \"\";\n                        if (j === (lst.length-1)) {\n                            values.push(composeNumberInfo(filteredOrigLabel, label, mystr, elems[i+1], i));\n                        } else {\n                            values.push(composeNumberInfo(filteredOrigLabel, label, mystr, null, i));\n                        }\n                    }\n                }\n            } else {\n                var filteredOrigLabel;\n                if (origLabel === label.trim()) {\n                    filteredOrigLabel = \"\";\n                } else {\n                    filteredOrigLabel = origLabel;\n                }\n                values.push(composeNumberInfo(filteredOrigLabel, label, elems[i], elems[i+1]));\n            }\n        }\n        return values;\n    }\n\n    function setSpaces(values) {\n        // Add space joins (is this really right?)\n        for (var i=0,ilen=values.length-1;i<ilen;i++) {\n            if (!values[i].joiningSuffix && values[i+1].label) {\n                values[i].joiningSuffix = \" \";\n            }\n        }\n    }\n\n    function fixNumericAndCount(values, i, currentLabelInfo) {\n        var master = values[currentLabelInfo.pos];\n        var val = values[i].value;\n        var isEscapedHyphen = master.joiningSuffix === \"\\\\-\";\n        if (val.particle && val.particle !== master.particle) {\n            currentLabelInfo.collapsible = false;\n        }\n        var mVal = val.match(/^[0-9]+([-,:a-zA-Z]*)$/);\n        var mCurrentLabel = master.value.match(/^(?:[0-9]+|[ixv]+)([-,:a-zA-Z]*|\\-[\\-0-9]+)$/);\n        if (!val || !mVal || !mCurrentLabel || isEscapedHyphen) {\n            currentLabelInfo.collapsible = false;\n            if (!val || !mCurrentLabel) {\n                currentLabelInfo.numeric = false;\n            }\n            if (isEscapedHyphen) {\n                currentLabelInfo.count--;\n            }\n        }\n        if ((mVal && mVal[1]) || (mCurrentLabel && mCurrentLabel[1])) {\n            currentLabelInfo.collapsible = false;\n        }\n        if (undefined === values[i].collapsible) {\n            for (var j=i,jlen=i+currentLabelInfo.count;j<jlen;j++) {\n                if (isNaN(parseInt(values[j].value)) && !values[j].value.match(/^[ivxlcmIVXLCM]+$/)) {\n                    values[j].collapsible = false;\n                } else {\n                    values[j].collapsible = true;\n                }\n            }\n            currentLabelInfo.collapsible = values[i].collapsible;\n        }\n        var isCollapsible = currentLabelInfo.collapsible;\n        for (var j=currentLabelInfo.pos,jlen=(currentLabelInfo.pos + currentLabelInfo.count); j<jlen; j++) {\n            if (currentLabelInfo.count > 1 && isCollapsible) {\n                values[j].plural = 1;\n            }\n            values[j].numeric = currentLabelInfo.numeric;\n            values[j].collapsible = currentLabelInfo.collapsible;\n        }\n    }\n\n    function fixLabelVisibility(values, groupStartPos, currentLabelInfo) {\n        if (currentLabelInfo.label.slice(0, 4) !== \"var:\") {\n            if (currentLabelInfo.pos === 0) {\n                if ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n                    // Actually, shouldn't we do this always?\n                    if (\"undefined\" === typeof me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[currentLabelInfo.label])) {\n                        values[currentLabelInfo.pos].labelVisibility = true;\n                    }\n                }\n                // If there is an explicit\n                // label embedded at the start of a field that\n                // does not match the context, it should be\n                // marked for rendering.\n                if ([\"locator\", \"number\", \"locator-extra\", \"page\"].indexOf(variable) === -1) {\n                    if (CSL.STATUTE_SUBDIV_STRINGS[currentLabelInfo.label] !== variable) {\n                        values[0].labelVisibility = true;\n                    }\n                }\n            } else {\n                // Also, mark initial mid-field labels for\n                // rendering.\n                //if (values[i-1].label !== values[i].label && currentLabelInfo.label.slice(0, 4) !== \"var:\") {\n                values[currentLabelInfo.pos].labelVisibility = true;\n                //}\n            }\n        }\n    }\n    \n    function setPluralsAndNumerics(values) {\n        if (values.length === 0) {\n            return;\n        }\n        var groupStartPos = 0;\n        var groupCount = 1;\n        \n        for (var i=1,ilen=values.length;i<ilen;i++) {\n            var lastVal = values[i-1];\n            var thisVal = values[i];\n            if (lastVal.label === thisVal.label && lastVal.particle === lastVal.particle) {\n                groupCount++;\n            } else {\n                var currentLabelInfo = JSON.parse(JSON.stringify(values[groupStartPos]));\n                currentLabelInfo.pos = groupStartPos;\n                currentLabelInfo.count = groupCount;\n                currentLabelInfo.numeric = true;\n                fixNumericAndCount(values, groupStartPos, currentLabelInfo);\n                if (lastVal.label !== thisVal.label) {\n                    fixLabelVisibility(values, groupStartPos, currentLabelInfo);\n                }\n                groupStartPos = i;\n                groupCount = 1;\n            }\n        }\n        // Not sure why this repetition is necessary?\n        var currentLabelInfo = JSON.parse(JSON.stringify(values[groupStartPos]));\n        currentLabelInfo.pos = groupStartPos;\n        currentLabelInfo.count = groupCount;\n        currentLabelInfo.numeric = true;\n        fixNumericAndCount(values, groupStartPos, currentLabelInfo);\n        fixLabelVisibility(values, groupStartPos, currentLabelInfo);\n        if (values.length && values[0].numeric && variable.slice(0, 10) === \"number-of-\") {\n            if (parseInt(ItemObject[realVariable], 10) > 1) {\n                values[0].plural = 1;\n            }\n        }\n    }        \n\n    function stripHyphenBackslash(joiningSuffix) {\n        return joiningSuffix.replace(\"\\\\-\", \"-\");\n    }\n\n    function setStyling(values) {\n        var masterNode = CSL.Util.cloneToken(node);\n        var masterStyling = new CSL.Token();\n        if (!me.tmp.just_looking) {\n            // Per discussion @ https://discourse.citationstyles.org/t/formatting-attributes-and-hyphen/1518\n            masterStyling.decorations = masterNode.decorations;\n            masterNode.decorations = [];\n            //for (var j=masterNode.decorations.length-1;j>-1;j--) {\n            //    if (masterNode.decorations[j][0] === \"@quotes\") {\n            //        // Add to styling\n            //        masterStyling.decorations = masterStyling.decorations.concat(masterNode.decorations.slice(j, j+1));\n            //        // Remove from node\n            //        masterNode.decorations = masterNode.decorations.slice(0, j).concat(masterNode.decorations.slice(j+1));\n            //    }\n            //}\n            masterStyling.strings.prefix = masterNode.strings.prefix;\n            masterNode.strings.prefix = \"\";\n            masterStyling.strings.suffix = masterNode.strings.suffix;\n            masterNode.strings.suffix = \"\";\n        }\n        var masterLabel = values.length ? values[0].label : null;\n        if (values.length) {\n            for (var i=0,ilen=values.length; i<ilen; i++) {\n                var val = values[i];\n                // Clone node, make styling parameters on each instance sane.\n                var newnode = CSL.Util.cloneToken(masterNode);\n                newnode.gender = node.gender;\n                if (masterLabel === val.label) {\n                    newnode.formatter = node.formatter;\n                }\n                if (val.numeric) {\n                    newnode.successor_prefix = val.successor_prefix;\n                }\n                newnode.strings.suffix = newnode.strings.suffix + stripHyphenBackslash(val.joiningSuffix);\n                val.styling = newnode;\n            }\n            if (!me.tmp.just_looking) {\n                if (values[0].value.slice(0,1) === \"\\\"\" && values[values.length-1].value.slice(-1) === \"\\\"\") {\n                    values[0].value = values[0].value.slice(1);\n                    values[values.length-1].value = values[values.length-1].value.slice(0,-1);\n                    masterStyling.decorations.push([\"@quotes\", true]);\n                }\n            }\n        }\n        return masterStyling;\n    }\n\n    function checkTerm(variable, val) {\n        var ret = true;\n        if ([\"locator\", \"locator-extra\", \"page\"].indexOf(variable) > -1) {\n            var label;\n            if (val.origLabel) {\n                label = val.origLabel;\n            } else {\n                label = val.label;\n            }\n            ret = !!me.getTerm(CSL.STATUTE_SUBDIV_STRINGS[label]);\n        }\n        return ret;\n    }\n\n    function checkPage(variable, val) {\n        return \"page\" === variable\n            || ([\"locator\", \"locator-extra\"].indexOf(variable) > -1 && ([\"p.\"].indexOf(val.label) > -1 || [\"p.\"].indexOf(val.origLabel) > -1));\n    }\n    \n    function fixupRangeDelimiter(variable, val, rangeDelimiter, isNumeric) {\n        var isPage = checkPage(variable, val);\n        var hasTerm = checkTerm(variable, val);\n        if (hasTerm && rangeDelimiter === \"-\") {\n            if (isNumeric) {\n                if (isPage || [\"locator\", \"locator-extra\", \"issue\", \"volume\", \"edition\", \"number\"].indexOf(variable) > -1) {\n                    rangeDelimiter = me.getTerm(\"page-range-delimiter\");\n                    if (!rangeDelimiter) {\n                        rangeDelimiter = \"\\u2013\";\n                    }\n                }\n                if (variable === \"collection-number\") {\n                    rangeDelimiter = me.getTerm(\"year-range-delimiter\");\n                    if (!rangeDelimiter) {\n                        rangeDelimiter = \"\\u2013\";\n                    }\n                }\n            }\n        }\n        //if (rangeDelimiter === \"\\\\-\") {\n        //    rangeDelimiter = \"-\";\n        //}\n        return rangeDelimiter;\n    }\n\n    function manglePageNumbers(values, i, currentInfo) {\n        if (i<1) {\n            return;\n        }\n        if (currentInfo.count !== 2) {\n            return;\n        }\n        if (values[i-1].particle !== values[i].particle) {\n            return;\n        }\n        if (values[i-1].joiningSuffix !== \"-\") {\n            currentInfo.count = 1;\n            return;\n        }\n        if (!me.opt[\"page-range-format\"] && (parseInt(values[i-1].value, 10) > parseInt(values[i].value, 10))) {\n            values[i-1].joiningSuffix = fixupRangeDelimiter(variable, values[i], values[i-1].joiningSuffix, true);\n            return;\n        }\n        var val = values[i];\n\n        var isPage = checkPage(variable, val);\n        var str;\n        if (isPage && !isNaN(parseInt(values[i-1].value)) && !isNaN(parseInt(values[i].value))) {\n            str = values[i-1].particle + values[i-1].value + \" - \" + values[i].particle + values[i].value;\n            str = me.fun.page_mangler(str);\n        } else {\n            // if ((\"\" + values[i-1].value).match(/[0-9]$/) && (\"\" + values[i].value).match(/^[0-9]/)) {\n            if ((\"\" + values[i-1].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/) && (\"\" + values[i].value).match(/^([0-9]+|[ivxlcmIVXLCM]+)$/)) {\n                values[i-1].joiningSuffix = me.getTerm(\"page-range-delimiter\");\n            }\n            str = values[i-1].value + stripHyphenBackslash(values[i-1].joiningSuffix) + values[i].value;\n        }\n        var m = str.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\\s*[^0-9]+\\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);\n        // var m = str.match(/^((?:[0-9]*[a-zA-Z]+0*))?([0-9]+[a-z]*)(\\s*[^0-9]+\\s*)([-,a-zA-Z]?0*)([0-9]+[a-z]*)$/);\n        if (m) {\n            var rangeDelimiter = m[3];\n            rangeDelimiter = fixupRangeDelimiter(variable, val, rangeDelimiter, values[i].numeric);\n            values[i-1].particle = m[1];\n            values[i-1].value = m[2];\n            values[i-1].joiningSuffix = rangeDelimiter;\n            values[i].particle = m[4];\n            values[i].value = m[5];\n        }\n        currentInfo.count = 0;\n    }\n    \n    function fixRanges(values) {\n\n        if (!node) {\n            return;\n        }\n        if ([\"page\", \"chapter-number\", \"collection-number\", \"edition\", \"issue\", \"number\", \"number-of-pages\", \"number-of-volumes\", \"volume\", \"locator\", \"locator-extra\"].indexOf(variable) === -1) {\n            return;\n        }\n\n        var currentInfo = {\n            count: 0,\n            label: null,\n            lastHadRangeDelimiter: false\n        };\n\n        for (var i=0,ilen=values.length; i<ilen; i++) {\n            var val = values[i];\n            if (!val.collapsible) {\n                currentInfo.count = 0;\n                currentInfo.label = null;\n                var isNumeric = val.numeric;\n                val.joiningSuffix = fixupRangeDelimiter(variable, val, val.joiningSuffix, isNumeric);\n            } else if (currentInfo.label === val.label && val.joiningSuffix === \"-\") {\n                // So if there is a hyphen here, and none previous, reset to 1\n                currentInfo.count = 1;\n            } else if (currentInfo.label === val.label && val.joiningSuffix !== \"-\") {\n                // If there is NO hyphen here, count up\n                currentInfo.count++;\n                if (currentInfo.count === 2) {\n                    manglePageNumbers(values, i, currentInfo);\n                }\n            } else if (currentInfo.label !== val.label) {\n                // If the label doesn't match and count is 2, process\n                currentInfo.label = val.label;\n                currentInfo.count = 1;\n            } else {\n                // Safety belt: label doesn't match and count is some other value, so reset to 1\n                // This never happens, though.\n                currentInfo.count = 1;\n                currentInfo.label = val.label;\n            }\n        }\n        // Finally clear, if needed\n        if (currentInfo.count === 2) {\n            manglePageNumbers(values, values.length-1, currentInfo);\n        }\n    }\n\n    function setVariableParams(shadow_numbers, realVariable, values) {\n        var obj = shadow_numbers[realVariable];\n        if (values.length) {\n            obj.numeric = values[0].numeric;\n            obj.collapsible = values[0].collapsible;\n            obj.plural = values[0].plural;\n            obj.label = CSL.STATUTE_SUBDIV_STRINGS[values[0].label];\n            if (variable === \"number\" && obj.label === \"issue\" && me.getTerm(\"number\")) {\n                obj.label = \"number\";\n            }\n        }\n    }\n\n    // Split out the labels and values.\n\n    // short-circuit if object exists: if numeric, set styling, no other action\n    if (node && this.tmp.shadow_numbers[realVariable] && this.tmp.shadow_numbers[realVariable].values.length) {\n        var values = this.tmp.shadow_numbers[realVariable].values;\n        fixRanges(values);\n        //if (!this.tmp.shadow_numbers[variable].masterStyling && !this.tmp.just_looking) {\n            this.tmp.shadow_numbers[realVariable].masterStyling = setStyling(values);\n        //}\n        return;\n    }\n\n    // info.styling = node;\n\n    // This carries value, pluralization and numeric info for use in other contexts.\n    // XXX We used to use one set of params for the entire variable value.\n    // XXX Now params are set on individual objects, of which there may be several after parsing.\n    if (!this.tmp.shadow_numbers[realVariable]) {\n        this.tmp.shadow_numbers[realVariable] = {\n            values:[]\n        };\n    }\n    //this.tmp.shadow_numbers[variable].values = [];\n    //this.tmp.shadow_numbers[variable].plural = 0;\n    //this.tmp.shadow_numbers[variable].numeric = false;\n    //this.tmp.shadow_numbers[variable].label = false;\n\n    if (!ItemObject) {\n        return;\n    }\n\n    // Possibly apply multilingual transform\n    var languageRole = CSL.LangPrefsMap[variable];\n    if (languageRole) {\n        var localeType = this.opt[\"cite-lang-prefs\"][languageRole][0];\n        val = this.transform.getTextSubField(ItemObject, realVariable, \"locale-\"+localeType, true);\n        val = val.name;\n    } else {\n        val = ItemObject[realVariable];\n    }\n\n    if (val && realVariable === \"number\" && ItemObject.type === \"legal_case\") {\n        val = val.replace(/[\\\\]*-/g, \"\\\\-\");\n    }\n\n    // XXX HOLDING THIS\n    // Apply short form ONLY if first element tests is-numeric=false\n    if (val && this.sys.getAbbreviation) {\n        // RefMe bug report: print(\"XX D'oh! (3): \"+num);\n        // true as the fourth argument suppresses update of the UI\n\n        // No need for this.\n        //val = (\"\" + val).replace(/^\\\"/, \"\").replace(/\\\"$/, \"\");\n        if (this.sys.normalizeAbbrevsKey) {\n            var normval = this.sys.normalizeAbbrevsKey(realVariable, val);\n        } else {\n            var normval = val;\n        }\n        var jurisdiction = this.transform.loadAbbreviation(ItemObject.jurisdiction, \"number\", normval, ItemObject.language);\n        if (this.transform.abbrevs[jurisdiction].number) {\n            if (this.transform.abbrevs[jurisdiction].number[normval]) {\n                val = this.transform.abbrevs[jurisdiction].number[normval];\n            } else {\n                \n                // *** This is terrible ***\n                \n                // Strings rendered via cs:number should not be added to the abbreviations\n                // UI unless they test non-numeric. The test happens below.\n                if (\"undefined\" !== typeof this.transform.abbrevs[jurisdiction].number[normval]) {\n                    delete this.transform.abbrevs[jurisdiction].number[normval];\n                }\n            }\n        }\n    }\n\n    //   {\n    //     label: \"sec.\",\n    //     labelForm: \"plural\",\n    //     labelVisibility: true,\n    //     value: 100,\n    //     styling: [object],\n    //     numeric: true\n    //     joiningSuffix: \" & \",\n    //   },\n\n    // Process only if there is a value.\n    if (\"undefined\" !== typeof val && (\"string\" === typeof val || \"number\" === typeof val)) {\n        if (\"number\" === typeof val) {\n            val = \"\" + val;\n        }\n        var defaultLabel = CSL.STATUTE_SUBDIV_STRINGS_REVERSE[variable];\n\n        if (this.tmp.shadow_numbers[realVariable].values.length === 0) {\n            // XXX\n            var values = parseString(val, defaultLabel);\n\n            setSpaces(values);\n            //print(\"setSpaces(): \"+JSON.stringify(values, null, 2));\n\n            setPluralsAndNumerics(values);\n            //print(\"setPluralsAndNumerics(): \"+JSON.stringify(values, null, 2));\n\n            for (var obj of values) {\n                if (!obj.numeric) obj.plural = 0;\n            }\n            this.tmp.shadow_numbers[realVariable].values = values;\n            // me.sys.print(JSON.stringify(values))\n\n            if (node) {\n                fixRanges(values);\n                \n                this.tmp.shadow_numbers[realVariable].masterStyling = setStyling(values);\n                // me.sys.print(\"setStyling(): \"+JSON.stringify(values, null, 2));\n            }\n            setVariableParams(this.tmp.shadow_numbers, realVariable, values);\n        }\n        \n        // hack in support for non-numeric numerics like \"91 Civ. 5442 (RPP)|91 Civ. 5471\"\n        var info = this.tmp.shadow_numbers[realVariable];\n        if (variable === \"number\") {\n            if (info.values.length === 1 && info.values[0].value.indexOf(\"|\") > -1) {\n                info.values[0].value = info.values[0].value.replace(/\\|/g, \", \");\n                info.values[0].numeric = true;\n                info.values[0].plural = 1;\n                info.values[0].collapsible = false;\n                info.numeric = true;\n                info.plural = 1;\n                info.collapsible = false;\n            }\n        }\n        if (info.values.length === 1) {\n            if (info.values[0].value.match(/^[0-9]+(?:\\/[0-9]+)+$/)) {\n                info.values[0].numeric = true;\n                info.values[0].plural = 0;\n                info.values[0].collapsible = false;\n                info.numeric = true;\n                info.plural = 0;\n                info.collapsible = false;\n            }\n        }\n        if (variable === \"page\") {\n            if (info.values.length > 0) {\n                if (info.values[0].gotosleepability) {\n                    info.labelForm = \"short\";\n                }\n            }\n        }\n        //this.sys.print(\"OK \"+JSON.stringify(values, [\"label\", \"origLabel\", \"labelSuffix\", \"particle\", \"collapsible\", \"value\", \"numeric\", \"joiningSuffix\", \"labelVisibility\", \"plural\"], 2));\n    }\n};\n\nCSL.Util.outputNumericField = function(state, varname, itemID) {\n\n    state.output.openLevel(state.tmp.shadow_numbers[varname].masterStyling);\n    var masterStyling = state.tmp.shadow_numbers[varname].masterStyling;\n    var nums = state.tmp.shadow_numbers[varname].values;\n    var masterLabel = nums.length ? nums[0].label : null;\n    var labelForm = state.tmp.shadow_numbers[varname].labelForm;\n    var tryStatic = state.tmp.group_context.tip.label_static;\n    var embeddedLabelForm;\n    if (labelForm) {\n        embeddedLabelForm = labelForm;\n    } else {\n        embeddedLabelForm = \"short\";\n        //labelForm = \"short\";\n    }\n    var labelCapitalizeIfFirst = state.tmp.shadow_numbers[varname].labelCapitalizeIfFirst;\n    var labelDecorations = state.tmp.shadow_numbers[varname].labelDecorations;\n    var lastLabelName = null;\n\n    for (var i=0,ilen=nums.length;i<ilen;i++) {\n        var num = nums[i];\n        var label = \"\";\n        var labelName;\n        if (num.label) {\n            if ('var:' === num.label.slice(0,4)) {\n                labelName = num.label.slice(4);\n            } else {\n                labelName = CSL.STATUTE_SUBDIV_STRINGS[num.label];\n            }\n            if (labelName) {\n                // Simplify this some day.\n                if (num.label === masterLabel) {\n                    if (tryStatic) {\n                        label = state.getTerm(labelName, \"static\", num.plural);\n                        if (label.indexOf(\"%s\") === -1) {\n                            label = \"\";\n                        }\n                    }\n                    if (!label) {\n                        label = state.getTerm(labelName, labelForm, num.plural);\n                    }\n                } else {\n                    if (tryStatic) {\n                        label = state.getTerm(labelName, \"static\", num.plural);\n                        if (label.indexOf(\"%s\") === -1) {\n                            label = \"\";\n                        }\n                    }\n                    if (!label) {\n                        label = state.getTerm(labelName, embeddedLabelForm, num.plural);\n                    }\n                }\n                if (labelCapitalizeIfFirst) {\n                    label = CSL.Output.Formatters[\"capitalize-first\"](state, label);\n                }\n            }\n        }\n        var labelPlaceholderPos = -1;\n        if (label) {\n            labelPlaceholderPos = label.indexOf(\"%s\");\n        }\n        var numStyling = CSL.Util.cloneToken(num.styling);\n        numStyling.formatter = num.styling.formatter;\n        numStyling.type = num.styling.type;\n        numStyling.num = num.styling.num;\n        numStyling.gender = num.styling.gender;\n        \n        if (labelPlaceholderPos > 0 && labelPlaceholderPos < (label.length-2)) {\n            numStyling.strings.prefix += label.slice(0,labelPlaceholderPos);\n            numStyling.strings.suffix = label.slice(labelPlaceholderPos+2) + numStyling.strings.suffix;\n        } else if (num.labelVisibility) {\n            if (!label) {\n                label = num.label;\n                labelName = num.label;\n            }\n            if (labelPlaceholderPos > 0) {\n                var prefixLabelStyling = new CSL.Token();\n                prefixLabelStyling.decorations = labelDecorations;\n                state.output.append(label.slice(0,labelPlaceholderPos), prefixLabelStyling);\n            } else if (labelPlaceholderPos === (label.length-2) || labelPlaceholderPos === -1) {\n                // And add a trailing delimiter.\n                state.output.append(label+num.labelSuffix, \"empty\");\n            }\n        }\n        CSL.UPDATE_GROUP_CONTEXT_CONDITION(state, masterStyling.strings.prefix, null, masterStyling, `${num.particle}${num.value}`);\n        if (num.collapsible) {\n            var blob;\n            if (num.value.match(/^[1-9][0-9]*$/)) {\n                blob = new CSL.NumericBlob(state, num.particle, parseInt(num.value, 10), numStyling, itemID);\n            } else {\n                blob = new CSL.NumericBlob(state, num.particle, num.value, numStyling, itemID);\n            }\n            if (\"undefined\" === typeof blob.gender) {\n                blob.gender = state.locale[state.opt.lang][\"noun-genders\"][varname];\n            }\n            state.output.append(blob, \"literal\");\n        } else {\n            state.output.append(num.particle + num.value, numStyling);\n        }\n        if (labelPlaceholderPos === 0 && labelPlaceholderPos < (label.length-2)) {\n            // Only and always if this is the last entry of this label\n            if (lastLabelName === null) {\n                lastLabelName = labelName;\n            }\n            if (labelName !== lastLabelName || i === (nums.length-1)) {\n                var suffixLabelStyling = new CSL.Token();\n                suffixLabelStyling.decorations = labelDecorations;\n                state.output.append(label.slice(labelPlaceholderPos+2), suffixLabelStyling);\n            }\n        }\n        lastLabelName = labelName;\n        state.tmp.term_predecessor = true;\n    }\n    state.output.closeLevel();\n};\n\n/*global CSL: true */\n\nCSL.Util.PageRangeMangler = {};\n\nCSL.Util.PageRangeMangler.getFunction = function (state, rangeType) {\n    var rangerex, pos, len, stringify, listify, expand, minimize, minimize_internal, chicago, lst, m, b, e, ret, begin, end, ret_func;\n    \n    var range_delimiter = state.getTerm(rangeType + \"-range-delimiter\");\n\n    rangerex = /([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)\\s*(?:\\u2013|-)\\s*([0-9]*[a-zA-Z]+0*)?([0-9]+[a-z]*)/;\n\n    stringify = function (lst) {\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            if (\"object\" === typeof lst[pos]) {\n                lst[pos] = lst[pos].join(\"\");\n            }\n        }\n        var ret = lst.join(\"\");\n        ret = ret.replace(/([^\\\\])\\-/g, \"$1\"+state.getTerm(rangeType + \"-range-delimiter\"));\n        return ret;\n    };\n\n    listify = function (str) {\n        var m, lst, ret;\n        // Normalized delimiter form, for use in regexps\n        var hyphens = \"\\\\s+\\\\-\\\\s+\";\n        // Normalize delimiters to hyphen wrapped in single spaces\n        var this_range_delimiter = range_delimiter === \"-\" ? \"\" : range_delimiter;\n        var delimRex = new RegExp(\"([^\\\\\\\\])[-\" + this_range_delimiter + \"\\\\u2013]\", \"g\");\n        str = str.replace(delimRex, \"$1 - \").replace(/\\s+-\\s+/g, \" - \");\n        // Workaround for Internet Explorer\n        //var rexm = new RegExp(\"((?:[0-9]*[a-zA-Z]+)?[0-9]+\" + hyphens + \"(?:[0-9]*[a-zA-Z]+)?[0-9]+)\", \"g\");\n        //var rexlst = new RegExp(\"(?:[0-9]*[a-zA-Z]+)?[0-9]+\" + hyphens + \"(?:[0-9]*[a-zA-Z]+)?[0-9]+\");\n        var rexm = new RegExp(\"((?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\" + hyphens + \"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*)\", \"g\");\n        var rexlst = new RegExp(\"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\" + hyphens + \"(?:[0-9]*[a-zA-Z]+0*)?[0-9]+[a-z]*\");\n        m = str.match(rexm);\n        lst = str.split(rexlst);\n        if (lst.length === 0) {\n            ret = m;\n        } else {\n            ret = [lst[0]];\n            for (pos = 1, len = lst.length; pos < len; pos += 1) {\n                ret.push(m[pos - 1].replace(/\\s*\\-\\s*/g, \"-\"));\n                ret.push(lst[pos]);\n            }\n        }\n        return ret;\n    };\n\n    expand = function (str) {\n        str = \"\" + str;\n        lst = listify(str);\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            m = lst[pos].match(rangerex);\n            if (m) {\n                if (!m[3] || m[1] === m[3]) {\n                    if (m[4].length < m[2].length) {\n                        m[4] = m[2].slice(0, (m[2].length - m[4].length)) + m[4];\n                    }\n                    if (parseInt(m[2], 10) < parseInt(m[4], 10)) {\n                        m[3] = range_delimiter + (m[1] ? m[1] : \"\");\n                        lst[pos] = m.slice(1);\n                    }\n                }\n            }\n            if (\"string\" === typeof lst[pos]) {\n                lst[pos] = lst[pos].replace(/\\-/g, range_delimiter);\n            }\n        }\n        return lst;\n    };\n\n    minimize = function (lst, minchars, isyear) {\n        len = lst.length;\n        for (var i = 1, ilen = lst.length; i < ilen; i += 2) {\n            if (\"object\" === typeof lst[i]) {\n                lst[i][3] = minimize_internal(lst[i][1], lst[i][3], minchars, isyear);\n                if (lst[i][2].slice(1) === lst[i][0]) {\n                    lst[i][2] = range_delimiter;\n                }\n            }\n        }\n        return stringify(lst);\n    };\n\n    minimize_internal = function (begin, end, minchars, isyear) {\n        if (!minchars) {\n            minchars = 0;\n        }\n        b = (\"\" + begin).split(\"\");\n        e = (\"\" + end).split(\"\");\n        ret = e.slice();\n        ret.reverse();\n        if (b.length === e.length) {\n            for (var i = 0, ilen = b.length; i < ilen; i += 1) {\n                if (b[i] === e[i] && ret.length > minchars) {\n                    ret.pop();\n                } else {\n                    if (minchars && isyear && ret.length === 3) {\n                        var front = b.slice(0, i);\n                        front.reverse();\n                        ret = ret.concat(front);\n                    }\n                    break;\n                }\n            }\n        }\n        ret.reverse();\n        return ret.join(\"\");\n    };\n\n    chicago = function (lst) {\n        len = lst.length;\n        for (pos = 1; pos < len; pos += 2) {\n            if (\"object\" === typeof lst[pos]) {\n                m = lst[pos];\n                begin = parseInt(m[1], 10);\n                end = parseInt(m[3], 10);\n                if (begin > 100 && begin % 100 && parseInt((begin / 100), 10) === parseInt((end / 100), 10)) {\n                    m[3] = \"\" + (end % 100);\n                } else if (begin >= 10000) {\n                    m[3] = \"\" + (end % 1000);\n                }\n            }\n            if (m[2].slice(1) === m[0]) {\n                m[2] = range_delimiter;\n            }\n        }\n        return stringify(lst);\n    };\n\n    //\n    // The top-level option handlers.\n    //\n    var sniff = function (str, func, minchars, isyear) {\n        var ret;\n\t\tstr = \"\" + str;\n\t\tvar lst = expand(str);\n        var ret = func(lst, minchars, isyear);\n        return ret;\n    };\n    if (!state.opt[rangeType + \"-range-format\"]) {\n        ret_func = function (str) {\n            //return str.replace(\"-\", \"\\u2013\", \"g\");\n            return sniff(str, stringify);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"expanded\") {\n        ret_func = function (str) {\n            return sniff(str, stringify);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"minimal\") {\n        ret_func = function (str) {\n            return sniff(str, minimize);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"minimal-two\") {\n        ret_func = function (str, isyear) {\n            return sniff(str, minimize, 2, isyear);\n        };\n    } else if (state.opt[rangeType + \"-range-format\"] === \"chicago\") {\n        ret_func = function (str) {\n            return sniff(str, chicago);\n        };\n    }\n\n    return ret_func;\n};\n\n\n/*global CSL: true */\n\n// Use a state machine\n\n// Okay, good!\n// Needs some tweaks:\n// 1. First pass: quotes only\n//    Special: Convert all sandwiched single-quote markup to apostrophe\n// 2. Second pass: tags\n\nCSL.Util.FlipFlopper = function(state) {\n    \n    /**\n     * INTERNAL\n     */\n\n    var _nestingState = [];\n\n    var _nestingData = {\n        \"<span class=\\\"nocase\\\">\": {\n            type: \"nocase\",\n            opener: \"<span class=\\\"nocase\\\">\",\n            closer: \"</span>\",\n            attr: null,\n            outer: null,\n            flipflop: null\n        },\n        \"<span class=\\\"nodecor\\\">\": {\n            type: \"nodecor\",\n            opener: \"<span class=\\\"nodecor\\\">\",\n            closer: \"</span>\",\n            attr: \"@class\",\n            outer: \"nodecor\",\n            flipflop: {\n                \"nodecor\": \"nodecor\"\n            }\n        },\n        \"<span style=\\\"font-variant:small-caps;\\\">\": {\n            type: \"tag\",\n            opener: \"<span style=\\\"font-variant:small-caps;\\\">\",\n            closer: \"</span>\",\n            attr: \"@font-variant\",\n            outer: \"small-caps\",\n            flipflop: {\n                \"small-caps\": \"normal\",\n                \"normal\": \"small-caps\"\n            }\n        },\n        \"<sc>\": {\n            type: \"tag\",\n            opener: \"<sc>\",\n            closer: \"</sc>\",\n            attr: \"@font-variant\",\n            outer: \"small-caps\",\n            flipflop: {\n                \"small-caps\": \"normal\",\n                \"normal\": \"small-caps\"\n            }\n        },\n        \"<i>\": {\n            type: \"tag\",\n            opener: \"<i>\",\n            closer: \"</i>\",\n            attr: \"@font-style\",\n            outer: \"italic\",\n            flipflop: {\n                \"italic\": \"normal\",\n                \"normal\": \"italic\"\n            }\n        },\n        \"<b>\": {\n            type: \"tag\",\n            opener: \"<b>\",\n            closer: \"</b>\",\n            attr: \"@font-weight\",\n            outer: \"bold\",\n            flipflop: {\n                \"bold\": \"normal\",\n                \"normal\": \"bold\"\n            }\n        },\n        \"<sup>\": {\n            type: \"tag\",\n            opener: \"<sup>\",\n            closer: \"</sup>\",\n            attr: \"@vertical-align\",\n            outer: \"sup\",\n            flipflop: {\n                \"sub\": \"sup\",\n                \"sup\": \"sup\"\n            }\n        },\n        \"<sub>\": {\n            type: \"tag\",\n            opener: \"<sub>\",\n            closer: \"</sub>\",\n            attr: \"@vertical-align\",\n            outer: \"sub\",\n            flipflop: {\n                \"sup\": \"sub\",\n                \"sub\": \"sub\"\n            }\n        },\n        \" \\\"\": {\n            type: \"quote\",\n            opener: \" \\\"\",\n            closer: \"\\\"\",\n            attr: \"@quotes\",\n            outer: \"true\",\n            flipflop: {\n                \"true\": \"inner\",\n                \"inner\": \"true\",\n                \"false\": \"true\"\n            }\n        },\n        \" \\'\": {\n            type: \"quote\",\n            opener: \" \\'\",\n            closer: \"\\'\",\n            attr: \"@quotes\",\n            outer: \"inner\",\n            flipflop: {\n                \"true\": \"inner\",\n                \"inner\": \"true\",\n                \"false\": \"true\"\n            }\n        }\n    };\n\n    _nestingData[\"(\\\"\"] = _nestingData[\" \\\"\"];\n    _nestingData[\"(\\'\"] = _nestingData[\" \\'\"];\n\n    var localeOpenQuote = state.getTerm(\"open-quote\");\n    var localeCloseQuote = state.getTerm(\"close-quote\");\n    var localeOpenInnerQuote = state.getTerm(\"open-inner-quote\");\n    var localeCloseInnerQuote = state.getTerm(\"close-inner-quote\");\n\n    // If locale uses straight quotes, do not register them. All will be well.\n    // Otherwise, clone straight-quote data, and adjust.\n    if (localeOpenQuote && localeCloseQuote && [\" \\\"\",\" \\'\",\"\\\"\",\"\\'\"].indexOf(localeOpenQuote) === -1) {\n        _nestingData[localeOpenQuote] = JSON.parse(JSON.stringify(_nestingData[\" \\\"\"]));\n        _nestingData[localeOpenQuote].opener = localeOpenQuote;\n        _nestingData[localeOpenQuote].closer = localeCloseQuote;\n    }\n    \n    if (localeOpenInnerQuote && localeCloseInnerQuote && [\" \\\"\",\" \\'\",\"\\\"\",\"\\'\"].indexOf(localeOpenInnerQuote) === -1) {\n        _nestingData[localeOpenInnerQuote] = JSON.parse(JSON.stringify(_nestingData[\" \\'\"]));\n        _nestingData[localeOpenInnerQuote].opener = localeOpenInnerQuote;\n        _nestingData[localeOpenInnerQuote].closer = localeCloseInnerQuote;\n    }\n    \n    function _setOuterQuoteForm(quot) {\n        var flip = {\n            \" \\'\": \" \\\"\",\n            \" \\\"\": \" \\'\",\n            \"(\\\"\": \"(\\'\",\n            \"(\\'\": \"(\\\"\"\n        };\n        _nestingData[quot].outer = \"true\";\n        _nestingData[flip[quot]].outer = \"inner\";\n    }\n    \n    function _getNestingOpenerParams(opener) {\n        var openers = [];\n        var keys = Object.keys(_nestingData);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var key = keys[i];\n            if (_nestingData[opener].type !== \"quote\" || !_nestingData[opener]) {\n                openers.push(key);\n            }\n        }\n        var ret = _nestingData[opener];\n        ret.opener = new RegExp(\"^(?:\" + openers.map(function(str){\n            return str.replace(\"(\", \"\\\\(\");\n        }).join(\"|\") + \")\");\n        return ret;\n    }\n\n    var _nestingParams = (function() {\n        var ret = {};\n        var keys = Object.keys(_nestingData);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var key = keys[i];\n            ret[key] = _getNestingOpenerParams(key);\n        }\n        return ret;\n    }());\n\n    var _tagRex = (function() {\n        var openers = [];\n        var closers = [];\n        var vals = {};\n        for (var opener in _nestingParams) {\n            openers.push(opener);\n            vals[_nestingParams[opener].closer] = true;\n        }\n        var keys = Object.keys(vals);\n        for (var i = 0, l = keys.length; i < l; i++) {\n            var closer = keys[i];\n            closers.push(closer);\n        }\n\n        var all = openers.concat(closers).map(function(str){\n            return str.replace(\"(\", \"\\\\(\");\n        }).join(\"|\");\n\n        return {\n            matchAll: new RegExp(\"((?:\" + all + \"))\", \"g\"),\n            splitAll: new RegExp(\"(?:\" + all + \")\", \"g\"),\n            open: new RegExp(\"(^(?:\" + openers.map(function(str){\n                return str.replace(\"(\", \"\\\\(\");\n            }).join(\"|\") + \")$)\"),\n            close: new RegExp(\"(^(?:\" + closers.join(\"|\") + \")$)\"),\n        };\n    }());\n\n    function _tryOpen(tag, pos) {\n        var params = _nestingState[_nestingState.length - 1];\n        if (!params || tag.match(params.opener)) {\n            _nestingState.push({\n                type: _nestingParams[tag].type,\n                opener: _nestingParams[tag].opener,\n                closer: _nestingParams[tag].closer,\n                pos: pos\n            });\n            return false;\n        } else {\n            _nestingState.pop();\n            _nestingState.push({\n                type: _nestingParams[tag].type,\n                opener: _nestingParams[tag].opener,\n                closer: _nestingParams[tag].closer,\n                pos: pos\n            });\n            return {\n                fixtag: params.pos\n            };\n        }\n    }\n    \n    function _tryClose(tag, pos) {\n        var params = _nestingState[_nestingState.length - 1];\n        if (params && tag === params.closer) {\n            _nestingState.pop();\n            if (params.type === \"nocase\") {\n                return {\n                    nocase: {\n                        open: params.pos,\n                        close: pos\n                    }\n                };\n            } else {\n                return false;\n            }\n        } else {\n            if (params) {\n                return {\n                    fixtag: params.pos\n                };\n            } else {\n                return {\n                    fixtag: pos\n                };\n            }\n        }\n    }\n    \n    function _pushNestingState(tag, pos) {\n        if (tag.match(_tagRex.open)) {\n            return _tryOpen(tag, pos);\n        } else {\n            return _tryClose(tag, pos);\n        }\n    }\n    \n    function _doppelString(str) {\n        var forcedSpaces = [];\n        // Normalize markup\n        str = str.replace(/(<span)\\s+(style=\\\"font-variant:)\\s*(small-caps);?\\\"[^>]*(>)/g, \"$1 $2$3;\\\"$4\");\n        str = str.replace(/(<span)\\s+(class=\\\"no(?:case|decor)\\\")[^>]*(>)/g, \"$1 $2$3\");\n\n        var match = str.match(_tagRex.matchAll);\n        if (!match) {\n            return {\n                tags: [],\n                strings: [str],\n                forcedSpaces: []\n            };\n        }\n        var split = str.split(_tagRex.splitAll);\n\n        for (var i=0,ilen=match.length-1;i<ilen;i++) {\n            if (_nestingData[match[i]]) {\n                if (split[i+1] === \"\" && [\"\\\"\", \"'\"].indexOf(match[i+1]) > -1) {\n                    match[i+1] = \" \" + match[i+1];\n                    forcedSpaces.push(true);\n                } else {\n                    forcedSpaces.push(false);\n                }\n            }\n        }\n        return {\n            tags: match,\n            strings: split,\n            forcedSpaces: forcedSpaces\n        };\n    }\n\n    var TagReg = function(blob) {\n        var _stack = [];\n        this.set = function (tag) {\n            var attr = _nestingData[tag].attr;\n            var decor = null;\n            for (var i=_stack.length-1;i>-1;i--) {\n                var _decor = _stack[i];\n                if (_decor[0] === attr) {\n                    decor = _decor;\n                    break;\n                }\n            }\n            if (!decor) {\n                var allTheDecor = [state[state.tmp.area].opt.layout_decorations].concat(blob.alldecor);\n                outer:\n                for (var i=allTheDecor.length-1;i>-1;i--) {\n                    var decorset = allTheDecor[i];\n                    if (!decorset) {\n                        continue;\n                    }\n                    for (var j=decorset.length-1;j>-1;j--) {\n                        var _decor = decorset[j];\n                        if (_decor[0] === attr) {\n                            decor = _decor;\n                            break outer;\n                        }\n                    }\n                }\n            }\n            if (!decor) {\n                decor = [attr, _nestingData[tag].outer];\n            } else {\n                decor = [attr, _nestingData[tag].flipflop[decor[1]]];\n            }\n            _stack.push(decor);\n        };\n        this.pair = function () {\n            return _stack[_stack.length-1];\n        };\n        this.pop = function () {\n            _stack.pop();\n        };\n    };\n    \n    function _apostropheForce(tag, str) {\n        if (tag === \"\\'\") {\n            if (str && str.match(/^[^\\,\\.\\?\\:\\;\\ ]/)) {\n                return \"\\u2019\";\n            }\n        } else if (tag === \" \\'\" && str && str.match(/^[\\ ]/)) {\n            return \" \\u2019\";\n        }\n        return false;\n    }\n\n    function _undoppelToQueue(blob, doppel, leadingSpace) {\n        var firstString = true;\n        var tagReg = new TagReg(blob);\n        blob.blobs = [];\n        function Stack (blob) {\n            this.stack = [blob];\n            this.latest = blob;\n            this.addStyling = function(str, decor) {\n                if (firstString) {\n                    if (str.slice(0, 1) === \" \") {\n                        str = str.slice(1);\n                    }\n                    if (str.slice(0, 1) === \" \") {\n                        str = str.slice(1);\n                    }\n                    firstString = false;\n                }\n                this.latest = this.stack[this.stack.length-1];\n                if (decor) {\n                    if (\"string\" === typeof this.latest.blobs) {\n                        var child = new CSL.Blob();\n                        child.blobs = this.latest.blobs;\n                        child.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs = [child];\n                    }\n                    var tok = new CSL.Token();\n                    var newblob = new CSL.Blob(null, tok);\n                    newblob.alldecor = this.latest.alldecor.slice();\n                    \n                    // AHA! Bad naming. There is _decorset from the list, and\n                    // there WAS decorset that we are building. Dumb. Fix the\n                    // names and fix it up.\n                    \n                    if (decor[0] === \"@class\" && decor[1] === \"nodecor\") {\n                        var newdecorset = [];\n                        var seen = {};\n                        var allTheDecor = [state[state.tmp.area].opt.layout_decorations].concat(newblob.alldecor);\n                        for (var i=allTheDecor.length-1;i>-1;i--) {\n                            var _decorset = allTheDecor[i];\n                            if (!_decorset) {\n                                continue;\n                            }\n                            for (var j=_decorset.length-1;j>-1;j--) {\n                                var _olddecor = _decorset[j];\n                                if ([\"@font-weight\", \"@font-style\", \"@font-variant\"].indexOf(_olddecor[0]) > -1\n                                    && !seen[_olddecor[0]]) {\n                                    \n                                    if (decor[1] !== \"normal\") {\n                                        newblob.decorations.push([_olddecor[0], \"normal\"]);\n                                        newdecorset.push([_olddecor[0], \"normal\"]);\n                                    }\n                                    seen[_olddecor[0]] = true;\n                                }\n                            }\n                        }\n                        newblob.alldecor.push(newdecorset);\n                        \n                    } else {\n                        newblob.decorations.push(decor);\n                        newblob.alldecor.push([decor]);\n                    }\n                    this.latest.blobs.push(newblob);\n                    this.stack.push(newblob);\n                    this.latest = newblob;\n                    if (str) {\n                        var tok = new CSL.Token();\n                        var newblob = new CSL.Blob(null, tok);\n                        newblob.blobs = str;\n                        newblob.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs.push(newblob);\n                    }\n                } else {\n                    if (str) {\n                        var child = new CSL.Blob();\n                        child.blobs = str;\n                        child.alldecor = this.latest.alldecor.slice();\n                        this.latest.blobs.push(child);\n                    }\n                }\n            };\n            this.popStyling = function() {\n                this.stack.pop();\n            };\n        }\n        var stack = new Stack(blob);\n        if (doppel.strings.length) {\n            var str = doppel.strings[0];\n            if (leadingSpace) {\n                str = \" \" + str;\n            }\n            stack.addStyling(str);\n        }\n        for (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var str = doppel.strings[i+1];\n            if (tag.match(_tagRex.open)) {\n                tagReg.set(tag);\n                stack.addStyling(str, tagReg.pair());\n            } else {\n                tagReg.pop();\n                stack.popStyling();\n                stack.addStyling(str);\n            }\n        }\n    }\n\n    /**\n     * PUBLIC\n     */\n\n    this.processTags = function (blob) {\n        var str = blob.blobs;\n        var leadingSpace = false;\n        if (str.slice(0, 1) === \" \" && !str.match(/^\\s+[\\'\\\"]/)) {\n            leadingSpace = true;\n        }\n        var rex = new RegExp(\"(\" + CSL.ROMANESQUE_REGEXP.source + \")\\u2019(\" + CSL.ROMANESQUE_REGEXP.source + \")\", \"g\");\n        var str = \" \" + str.replace(rex, \"$1\\'$2\");\n        var doppel = _doppelString(str);\n        if (doppel.tags.length === 0) {\n            return;\n        }\n        var quoteFormSeen = false;\n        \n    \tfor (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var str = doppel.strings[i+1];\n            var apostrophe = _apostropheForce(tag, str);\n            if (apostrophe) {\n                doppel.strings[i+1] = apostrophe + doppel.strings[i+1];\n                doppel.tags[i] = \"\";\n            } else {\n                var tagInfo;\n                while (true) {\n                    tagInfo = _pushNestingState(tag, i);\n                    if (tagInfo) {\n                        if (Object.keys(tagInfo).indexOf(\"fixtag\") > -1) {\n                            if (tag.match(_tagRex.close)\n                                && tag === \"\\'\") {\n                                \n                                doppel.strings[i+1] = \"\\u2019\" + doppel.strings[i+1];\n                                doppel.tags[i] = \"\";\n                            } else {\n                                var failedTag = doppel.tags[tagInfo.fixtag];\n                                if (doppel.forcedSpaces[tagInfo.fixtag-1]) {\n                                    failedTag = failedTag.slice(1);\n                                }\n                                doppel.strings[tagInfo.fixtag+1] = failedTag + doppel.strings[tagInfo.fixtag+1];\n                                doppel.tags[tagInfo.fixtag] = \"\";\n                            }\n                            if (_nestingState.length > 0) {\n                                if (tag !== \"\\'\") {\n                                    _nestingState.pop();\n                                } else {\n                                    break;\n                                }\n                            } else {\n                                break;\n                            }\n                        } else if (tagInfo.nocase) {\n                            doppel.tags[tagInfo.nocase.open] = \"\";\n                            doppel.tags[tagInfo.nocase.close] = \"\";\n                            break;\n                        } else {\n                            break;\n                        }\n                    } else {\n                        break;\n                    }\n                }\n                if (tagInfo && (tagInfo.fixtag|| tagInfo.fixtag === 0)) {\n                    doppel.strings[i+1] = doppel.tags[i] + doppel.strings[i+1];\n                    doppel.tags[i] = \"\";\n                }\n            }\n        }\n        // Stray tags are neutralized here\n        for (var i=_nestingState.length-1;i>-1;i--) {\n            var tagPos = _nestingState[i].pos;\n            var tag = doppel.tags[tagPos];\n            if (tag === \" \\'\" || tag === \"\\'\") {\n\n                doppel.strings[tagPos+1] = \" \\u2019\" + doppel.strings[tagPos+1];\n            } else {\n                doppel.strings[tagPos+1] = doppel.tags[tagPos] + doppel.strings[tagPos+1];\n            }\n            doppel.tags[tagPos] = \"\";\n            _nestingState.pop();\n        }\n        for (var i=doppel.tags.length-1;i>-1;i--) {\n            if (!doppel.tags[i]) {\n                doppel.tags = doppel.tags.slice(0,i).concat(doppel.tags.slice(i+1));\n                doppel.strings[i] = doppel.strings[i] + doppel.strings[i+1];\n                doppel.strings = doppel.strings.slice(0,i+1).concat(doppel.strings.slice(i+2));\n            }\n        }\n        // Sniff initial (outer) quote form (single or double) and configure parser\n        // Also add leading spaces.\n        for (var i=0,ilen=doppel.tags.length;i<ilen;i++) {\n            var tag = doppel.tags[i];\n            var forcedSpace = doppel.forcedSpaces[i-1];\n            if ([\" \\\"\", \" \\'\", \"(\\\"\", \"(\\'\"].indexOf(tag) > -1) {\n                if (!quoteFormSeen) {\n                    _setOuterQuoteForm(tag);\n                    quoteFormSeen = true;\n                }\n                if (!forcedSpace) {\n                    doppel.strings[i] += tag.slice(0, 1);\n                }\n            }\n        }\n        //print(JSON.stringify(doppel, null, 2))\n        //print(_undoppelString(doppel));\n        _undoppelToQueue(blob, doppel, leadingSpace);\n    };\n};\n\n/*global CSL: true */\n\nCSL.Output.Formatters = (function () {\n    var rexStr = \"(?:\\u2018|\\u2019|\\u201C|\\u201D| \\\"| \\'|\\\"|\\'|[-\\u2013\\u2014\\/.,;?!:]|\\\\[|\\\\]|\\\\(|\\\\)|<span style=\\\"font-variant: small-caps;\\\">|<span class=\\\"no(?:case|decor)\\\">|<\\/span>|<\\/?(?:i|sc|b|sub|sup)>)\";\n    var tagDoppel = new CSL.Doppeler(rexStr, function(str) {\n        return str.replace(/(<span)\\s+(class=\\\"no(?:case|decor)\\\")[^>]*(>)/g, \"$1 $2$3\").replace(/(<span)\\s+(style=\\\"font-variant:)\\s*(small-caps);?(\\\")[^>]*(>)/g, \"$1 $2 $3;$4$5\");\n    });\n    var rexNameStr = \"(?:[-\\\\s]*<\\\\/*(?:span\\s+class=\\\"no(?:case|decor)\\\"|i|sc|b|sub|sup)>[-\\\\s]*|[-\\\\s]+)\";\n    var nameDoppel = new CSL.Doppeler(rexNameStr);\n    \n    var wordDoppel = new CSL.Doppeler(\"(?:[\\u00A0\\u0020\\u00A0\\u2000-\\u200B\\u205F\\u3000]+)\");\n    \n    /**\n     * INTERNAL\n     */\n\n    var _tagParams = {\n        \"<span style=\\\"font-variant: small-caps;\\\">\": \"</span>\",\n        \"<span class=\\\"nocase\\\">\": \"</span>\",\n        \"<span class=\\\"nodecor\\\">\": \"</span>\",\n        \"<sc>\": \"</sc>\",\n        \"<sub>\": \"</sub>\",\n        \"<sup>\": \"</sup>\"\n    };\n\n    function _capitalise (word) {\n        // Weird stuff is (.) transpiled with regexpu\n        //   https://github.com/mathiasbynens/regexpu\n        var m = word.match(/(^\\s*)((?:[\\0-\\t\\x0B\\f\\x0E-\\u2027\\u202A-\\uD7FF\\uE000-\\uFFFF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?:[^\\uD800-\\uDBFF]|^)[\\uDC00-\\uDFFF]))(.*)/);\n        // Do not uppercase lone Greek letters\n        // (No case transforms in Greek citations, but chars used in titles to science papers)\n        if (m && !(m[2].match(/^[\\u0370-\\u03FF]$/) && !m[3])) {\n            return m[1] + CSL.toLocaleUpperCase.call(this, m[2]) + m[3];\n        }\n        return word;\n    }\n\n    function _textcaseEngine(config, string) {\n        if (!string) {\n            return \"\";\n        }\n        config.doppel = tagDoppel.split(string);\n        var quoteParams = {\n            \" \\\"\": {\n                opener: \" \\'\",\n                closer: \"\\\"\"\n            },\n            \" \\'\": {\n                opener: \" \\\"\",\n                closer: \"\\'\"\n            },\n            \"\\u2018\": {\n                opener: \"\\u2018\",\n                closer: \"\\u2019\"\n            },\n            \"\\u201C\": {\n                opener: \"\\u201C\",\n                closer: \"\\u201D\"\n            },\n        };\n        function tryOpen(tag, pos) {\n            if (config.quoteState.length === 0 || tag === config.quoteState[config.quoteState.length - 1].opener) {\n                config.quoteState.push({\n                    opener: quoteParams[tag].opener,\n                    closer: quoteParams[tag].closer,\n                    pos: pos\n                });\n                return false;\n            } else {\n                var prevPos = config.quoteState[config.quoteState.length-1].pos;\n                config.quoteState.pop();\n                config.quoteState.push({\n                    opener: quoteParams[tag].opener,\n                    closer: quoteParams[tag].closer,\n                    positions: pos\n                });\n                return prevPos;\n            }\n        }\n        function tryClose(tag, pos) {\n            if (config.quoteState.length > 0 && tag === config.quoteState[config.quoteState.length - 1].closer) {\n                config.quoteState.pop();\n            } else {\n                return pos;\n            }\n        }\n        function pushQuoteState(tag, pos) {\n            var isOpener = [\"\\u201C\", \"\\u2018\", \" \\\"\", \" \\'\"].indexOf(tag) > -1 ? true : false;\n            if (isOpener) {\n                return tryOpen(tag, pos);\n            } else {\n                return tryClose(tag, pos);\n            }\n        }\n        function quoteFix (tag, positions) {\n            var m = tag.match(/(^(?:\\u2018|\\u2019|\\u201C|\\u201D|\\\"|\\')|(?: \\\"| \\')$)/);\n            if (m) {\n                return pushQuoteState(m[1], positions);\n            }\n        }\n        // Run state machine\n        if (config.doppel.strings.length && config.doppel.strings[0].trim()) {\n            config.doppel.strings[0] = config.capitaliseWords(config.doppel.strings[0], 0, config.doppel.tags[0]);\n        }\n\n    \tfor (var i=0,ilen=config.doppel.tags.length;i<ilen;i++) {\n            var tag = config.doppel.tags[i];\n            var str = config.doppel.strings[i+1];\n\n            if (config.tagState !== null) {\n                // Evaluate tag state for current string\n                if (_tagParams[tag]) {\n                    config.tagState.push(_tagParams[tag]);\n                } else if (config.tagState.length && tag === config.tagState[config.tagState.length - 1]) {\n                    config.tagState.pop();\n                }\n            }\n\n            if (config.afterPunct !== null) {\n                // Evaluate punctuation state of current string\n                if (tag.match(/[\\!\\?\\:]$/)) {\n                    config.afterPunct = true;\n                }\n            }\n\n            // Process if outside tag scope, else noop for upper-casing\n            if (config.tagState.length === 0) {\n                config.doppel.strings[i+1] = config.capitaliseWords(str, i+1, config.doppel,config.doppel.tags[i+1]);\n                \n            } else if (config.doppel.strings[i+1].trim()) {\n                config.lastWordPos = null;\n            }\n            \n            if (config.quoteState !== null) {\n                // Evaluate quote state of current string and fix chars that have flown\n                var quotePos = quoteFix(tag, i);\n                if (quotePos || quotePos === 0) {\n                    var origChar = config.doppel.origStrings[quotePos+1].slice(0, 1);\n                    config.doppel.strings[quotePos+1] = origChar + config.doppel.strings[quotePos+1].slice(1);\n                    config.lastWordPos = null;\n                }\n            }\n\n            // If there was a printable string, unset first-word and after-punctuation\n            if (config.isFirst) {\n                if (str.trim()) {\n                    config.isFirst = false;\n                }\n            }\n            if (config.afterPunct) {\n                if (str.trim()) {\n                    config.afterPunct = false;\n                }\n            }\n        }\n        if (config.quoteState) {\n            for (var i=0,ilen=config.quoteState.length;i<ilen;i++) {\n                var quotePos = config.quoteState[i].pos;\n                // Test for quotePos avoids a crashing error:\n                //   https://github.com/citation-style-language/test-suite/blob/master/processor-tests/humans/flipflop_OrphanQuote.txt\n                if (typeof quotePos !== 'undefined') {\n                    var origChar = config.doppel.origStrings[quotePos+1].slice(0, 1);\n                    config.doppel.strings[quotePos+1] = origChar + config.doppel.strings[quotePos+1].slice(1);\n                }\n            }\n        }\n        // Specially capitalize the last word if necessary (invert stop-word list)\n        if (config.lastWordPos) {\n            var lastWords = wordDoppel.split(config.doppel.strings[config.lastWordPos.strings]);\n            var lastWord = lastWords.strings[config.lastWordPos.words];\n            if (lastWord.length > 1 && CSL.toLocaleLowerCase.call(this, lastWord).match(config.skipWordsRex)) {\n                lastWord = _capitalise.call(this, lastWord);\n                lastWords.strings[config.lastWordPos.words] = lastWord;\n            }\n            config.doppel.strings[config.lastWordPos.strings] = wordDoppel.join(lastWords);\n        }\n\n        // Recombine the string\n        return tagDoppel.join(config.doppel);\n    }\n\n    /**\n     * PUBLIC\n     */\n\n    /**\n     * A noop that just delivers the string.\n     */\n    function passthrough (state, str) {\n        return str;\n    }\n\n    /**\n     * Force all letters in the string to lowercase, skipping nocase spans\n     */\n    function lowercase(state, string) {\n        var config = {\n            quoteState: null,\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        words[i] = CSL.toLocaleLowerCase.call(state, word);\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Force all letters in the string to uppercase.\n     */\n    function uppercase(state, string) {\n        var config = {\n            quoteState: null,\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        // Okay.\n                        // So we need to pick up an array of locales from state.tmp.\n                        // This function is invoked in the context of queue.js, so\n                        // the item is not available here. Three levels to be included\n                        // in the array:\n                        // 1. Field language tag, if any\n                        // 2. Item language tag, if any\n                        // 3. Value of state.opt.lang\n                        words[i] = CSL.toLocaleUpperCase.call(state, word);\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Similar to <b>capitalize_first</b>, but force the\n     * subsequent characters to lowercase.\n     */\n    function sentence(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var words = str.split(\" \");\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        if (config.isFirst) {\n                            words[i] = _capitalise.call(state, word);\n                            config.isFirst = false;\n                        } else {\n                            words[i] = CSL.toLocaleLowerCase.call(state, word);\n                        }\n                    }\n                }\n                return words.join(\" \");\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    function title(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str, i, followingTag) {\n                if (str.trim()) {\n                    var wordle = wordDoppel.split(str);\n                    var words = wordle.strings;\n                    for (var j=0,jlen=words.length;j<jlen;j++) {\n                        var word = words[j];\n                        if (!word) {\n                            continue;\n                        }\n                        let lcase = CSL.toLocaleLowerCase.call(state, word);\n                        let capitalize = false;\n                        if (word.length > 1 && !lcase.match(config.skipWordsRex)) {\n                            // Capitalize every word that is not a stop-word\n                            capitalize = true;\n                        } else if (j === (words.length - 1) && followingTag === \"-\") {\n                            capitalize = true;\n                        } else if (config.isFirst) {\n                            // Capitalize first word, even if a stop-word\n                            capitalize = true;\n                        } else if (config.afterPunct) {\n                            // Capitalize after punctuation\n                            capitalize = true;\n                        }\n                        // Don't capitalize if word already contains capitalization\n                        if (capitalize && word === lcase) {\n                            words[j] = _capitalise.call(state, word);\n                        }\n                        config.afterPunct = false;\n                        config.isFirst = false;\n                        config.lastWordPos = {\n                            strings: i,\n                            words: j\n                        };\n                    }\n                    str = wordDoppel.join(wordle);\n                }\n                return str;\n            },\n            skipWordsRex: state.locale[state.opt.lang].opts[\"skip-words-regexp\"],\n            tagState: [],\n            afterPunct: false,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n    \n    \n    /**\n     * Force capitalization of the first letter in the string, leave\n     * the rest of the characters untouched.\n     */\n    function capitalizeFirst(state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var wordle = wordDoppel.split(str);\n                var words = wordle.strings;\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        if (config.isFirst) {\n                            // Don't capitalize if word already contains capitalization\n                            if (word === CSL.toLocaleLowerCase.call(state, word)) {\n                                words[i] = _capitalise.call(state, word);\n                            }\n                            config.isFirst = false;\n                            break;\n                        }\n                    }\n                }\n                return wordDoppel.join(wordle);\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: true\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n\n    /**\n     * Force the first letter of each space-delimited\n     * word in the string to uppercase, and leave the remainder\n     * of the string untouched.  Single characters are forced\n     * to uppercase.\n     */\n    function capitalizeAll (state, string) {\n        var config = {\n            quoteState: [],\n            capitaliseWords: function(str) {\n                var wordle = wordDoppel.split(str);\n                var words = wordle.strings;\n                for (var i=0,ilen=words.length;i<ilen;i++) {\n                    var word = words[i];\n                    if (word) {\n                        // Don't capitalize if word already contains capitalization\n                        if (word === CSL.toLocaleLowerCase.call(state, word)) {\n                            words[i] = _capitalise.call(state, word);\n                        }\n                    }\n                }\n                return wordDoppel.join(wordle);\n            },\n            skipWordsRex: null,\n            tagState: [],\n            afterPunct: null,\n            isFirst: null\n        };\n        return _textcaseEngine.call(state, config, string);\n    }\n    return {\n        nameDoppel: nameDoppel,\n        passthrough: passthrough,\n        lowercase: lowercase,\n        uppercase: uppercase,\n        sentence: sentence,\n        title: title,\n        \"capitalize-first\": capitalizeFirst,\n        \"capitalize-all\": capitalizeAll\n    };\n}());\n\n/*global CSL: true */\n\n\n/**\n * Output specifications.\n * @class\n */\nCSL.Output.Formats = function () {};\n\n/**\n * HTML output format specification.\n * <p>The headline says it all.  The source code for this\n * object can be used as a template for producing other\n * output modes.</p>\n */\nCSL.Output.Formats.prototype.html = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        // Numeric entities, in case the output is processed as\n        // xml in an environment in which HTML named entities are\n        // not declared.\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(/&/g, \"&#38;\")\n            .replace(/</g, \"&#60;\")\n            .replace(/>/g, \"&#62;\")\n            .replace(/\\s\\s/g, \"\\u00A0 \")\n            .replace(CSL.SUPERSCRIPTS_REGEXP,\n                     function(aChar) {\n                         // return \"&#60;sup&#62;\" + CSL.SUPERSCRIPTS[aChar] + \"&#60;/sup&#62;\";\n                         return \"<sup>\" + CSL.SUPERSCRIPTS[aChar] + \"</sup>\";\n                     });\n    },\n    \"bibstart\": \"<div class=\\\"csl-bib-body\\\">\\n\",\n    \"bibend\": \"</div>\",\n    \"@font-style/italic\": \"<i>%%STRING%%</i>\",\n    \"@font-style/oblique\": \"<em>%%STRING%%</em>\",\n    \"@font-style/normal\": \"<span style=\\\"font-style:normal;\\\">%%STRING%%</span>\",\n    \"@font-variant/small-caps\": \"<span style=\\\"font-variant:small-caps;\\\">%%STRING%%</span>\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": \"<span style=\\\"font-variant:normal;\\\">%%STRING%%</span>\",\n    \"@font-weight/bold\": \"<b>%%STRING%%</b>\",\n    \"@font-weight/normal\": \"<span style=\\\"font-weight:normal;\\\">%%STRING%%</span>\",\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": \"<span style=\\\"text-decoration:none;\\\">%%STRING%%</span>\",\n    \"@text-decoration/underline\": \"<span style=\\\"text-decoration:underline;\\\">%%STRING%%</span>\",\n    \"@vertical-align/sup\": \"<sup>%%STRING%%</sup>\",\n    \"@vertical-align/sub\": \"<sub>%%STRING%%</sub>\",\n    \"@vertical-align/baseline\": \"<span style=\\\"baseline\\\">%%STRING%%</span>\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        // Test for this.item_id to add decorations to\n        // bibliography output of individual entries.\n        //\n        // Full item content can be obtained from\n        // state.registry.registry[id].ref, using\n        // CSL variable keys.\n        //\n        // Example:\n        //\n        //   print(state.registry.registry[this.item_id].ref[\"title\"]);\n        //\n        // At present, for parallel citations, only the\n        // id of the master item is supplied on this.item_id.\n        var insert = \"\";\n        if (state.sys.embedBibliographyEntry) {\n            insert = state.sys.embedBibliographyEntry(this.item_id) + \"\\n\";\n        }\n        return \"  <div class=\\\"csl-entry\\\">\" + str + \"</div>\\n\" + insert;\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\\n    <div class=\\\"csl-block\\\">\" + str + \"</div>\\n\";\n    },\n    \"@display/left-margin\": function (state, str) {\n        return \"\\n    <div class=\\\"csl-left-margin\\\">\" + str + \"</div>\";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \"<div class=\\\"csl-right-inline\\\">\" + str + \"</div>\\n  \";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"<div class=\\\"csl-indent\\\">\" + str + \"</div>\\n  \";\n    },\n    \"@showid/true\": function (state, str, cslid) {\n        if (!state.tmp.just_looking && ! state.tmp.suppress_decorations) {\n            if (cslid) {\n                return \"<span class=\\\"\" + state.opt.nodenames[cslid] + \"\\\" cslid=\\\"\" + cslid + \"\\\">\" + str + \"</span>\";\n            } else if (this.params && \"string\" === typeof str) {\n                var prePunct = \"\";\n                if (str) {\n                    var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                    prePunct = m[1];\n                    str = m[2];\n                }\n                var postPunct = \"\";\n                if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                    postPunct = str.slice(-1);\n                    str = str.slice(0,-1);\n                }\n                return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n            } else {\n                return str;\n            }\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return \"<a href=\\\"\" + str + \"\\\">\" + str + \"</a>\";\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return \"<a href=\\\"\" + doiurl + \"\\\">\" + str + \"</a>\";\n    }\n};\n\n/**\n * Plain text output specification.\n *\n * (Code contributed by Simon Kornblith, Center for History and New Media,\n * George Mason University.)\n */\nCSL.Output.Formats.prototype.text = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text;\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@font-style/italic\": false,\n    \"@font-style/oblique\": false,\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": false,\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": false,\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": false,\n    \"@vertical-align/baseline\": false,\n    \"@vertical-align/sup\": false,\n    \"@vertical-align/sub\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        return str+\"\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\"+str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n    \"+str;\n    },\n    \"@showid/true\": function (state, str) {\n        return str;\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\n/**\n * Plain text output specification.\n *\n * (Code contributed by Simon Kornblith, Center for History and New Media,\n * George Mason University.)\n */\nCSL.Output.Formats.prototype.rtf = {\n    //\n    // text_escape: Format-specific function for escaping text destined\n    // for output.  Takes the text to be escaped as sole argument.  Function\n    // will be run only once across each portion of text to be escaped, it\n    // need not be idempotent.\n    //\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text\n        .replace(/([\\\\{}])/g, \"\\\\$1\")\n        .replace(CSL.SUPERSCRIPTS_REGEXP,\n                 function(aChar) {\n                     return \"\\\\super \" + CSL.SUPERSCRIPTS[aChar] + \"\\\\nosupersub{}\";\n                 })\n        .replace(/[\\u007F-\\uFFFF]/g,\n                 function(aChar) { return \"\\\\uc0\\\\u\"+aChar.charCodeAt(0).toString()+\"{}\"; })\n        .split(\"\\t\").join(\"\\\\tab{}\");\n    },\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\":\"{\\\\i{}%%STRING%%}\",\n    \"@font-style/normal\":\"{\\\\i0{}%%STRING%%}\",\n    \"@font-style/oblique\":\"{\\\\i{}%%STRING%%}\",\n    \"@font-variant/small-caps\":\"{\\\\scaps %%STRING%%}\",\n    \"@font-variant/normal\":\"{\\\\scaps0{}%%STRING%%}\",\n    \"@font-weight/bold\":\"{\\\\b{}%%STRING%%}\",\n    \"@font-weight/normal\":\"{\\\\b0{}%%STRING%%}\",\n    \"@font-weight/light\":false,\n    \"@text-decoration/none\":false,\n    \"@text-decoration/underline\":\"{\\\\ul{}%%STRING%%}\",\n    \"@vertical-align/baseline\":false,\n    \"@vertical-align/sup\":\"\\\\super %%STRING%%\\\\nosupersub{}\",\n    \"@vertical-align/sub\":\"\\\\sub %%STRING%%\\\\nosupersub{}\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-quote\"));\n        }\n        return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-quote\")) + str + CSL.Output.Formats.rtf.text_escape(state.getTerm(\"close-quote\"));\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return CSL.Output.Formats.rtf.text_escape(\"\\u2019\");\n        }\n        return CSL.Output.Formats.rtf.text_escape(state.getTerm(\"open-inner-quote\")) + str + CSL.Output.Formats.rtf.text_escape(state.getTerm(\"close-inner-quote\"));\n    },\n    \"@quotes/false\": false,\n    \"bibstart\":\"{\\\\rtf \",\n    \"bibend\":\"}\",\n    \"@display/block\": \"\\\\line{}%%STRING%%\\\\line\\r\\n\",\n    \"@cite/entry\": function (state, str) {\n        // If wrapCitationEntry does not exist, cite/entry \n        // is not applied.\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function(state,str){\n        return str;\n    },\n    \"@display/left-margin\": function(state,str){\n        return str+\"\\\\tab \";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str+\"\\r\\n\";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n\\\\tab \"+str+\"\\\\line\\r\\n\";\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && ! state.tmp.suppress_decorations) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\n/*\n\n    This does not seem to work in Zotero plugins. For some reason the scope of the link does not\n    close when interpreted by the LibreOffice. Perhaps this creates a field within a field,\n    and that is not allowed?\n\n    \"@URL/true\": function (state, str) {\n        return \"\\\\field{\\\\*\\\\fldinst{HYPERLINK \\\"\" + str + \"\\\"}}{\\\\fldrslt{\"+ str +\"}}\";\n    },\n    \"@DOI/true\": function (state, str) {\n        return \"\\\\field{\\\\*\\\\fldinst{HYPERLINK \\\"https://doi.org/\" + str + \"\\\"}}{\\\\fldrslt{\"+ str +\"}}\";\n    }\n*/\n\n/**\n * AsciiDoc output specification.\n *\n * See http://asciidoc.org/ or https://asciidoctor.org/\n */\nCSL.Output.Formats.prototype.asciidoc = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(\"*\", \"pass:[*]\", \"g\")\n            .replace(\"_\", \"pass:[_]\", \"g\")\n            .replace(\"#\", \"pass:[#]\", \"g\")\n            .replace(\"^\", \"pass:[^]\", \"g\")\n            .replace(\"~\", \"pass:[~]\", \"g\")\n            .replace(\"[[\", \"pass:[[[]\", \"g\")\n            .replace(\"  \", \"&#160; \", \"g\")\n            .replace(CSL.SUPERSCRIPTS_REGEXP, function(aChar) {\n                return \"^\" + CSL.SUPERSCRIPTS[aChar] + \"^\";\n            });\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\": \"__%%STRING%%__\",\n    \"@font-style/oblique\": \"__%%STRING%%__\",\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": \"[small-caps]#%%STRING%%#\",\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": \"**%%STRING%%**\",\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": \"[underline]##%%STRING%%##\",\n    \"@vertical-align/sup\": \"^^%%STRING%%^^\",\n    \"@vertical-align/sub\": \"~~%%STRING%%~~\",\n    \"@vertical-align/baseline\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"``\";\n        }\n        return \"``\" + str + \"''\";\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"`\";\n        }\n        return \"`\" + str + \"'\";\n    },\n    \"@quotes/false\": false,\n    \"@cite/entry\": function (state, str) {\n        // if wrapCitationEntry does not exist, cite/entry is not applied\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n    },\n    \"@bibliography/entry\": function (state, str) {\n        return str + \"\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \" \" + str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \" \" + str;\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && !state.tmp.suppress_decorations && this.params && \"string\" === typeof str) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        // AsciiDoc renders URLs automatically as links\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return doiurl + \"[\" + str + \"]\";\n    }\n};\n\n/**\n * Output specification for XSL-FO (Extensible Stylesheet\n * Language - Formatting Objects)\n *\n * See https://www.w3.org/TR/xsl11/#fo-section\n */\nCSL.Output.Formats.prototype.fo = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text.replace(/&/g, \"&#38;\")\n            .replace(/</g, \"&#60;\")\n            .replace(/>/g, \"&#62;\")\n            .replace(\"  \", \"&#160; \", \"g\")\n            .replace(CSL.SUPERSCRIPTS_REGEXP, function(aChar) {\n                return \"<fo:inline vertical-align=\\\"super\\\">\" + CSL.SUPERSCRIPTS[aChar] + \"</fo:inline>\";\n            });\n    },\n    \"bibstart\": \"\",\n    \"bibend\": \"\",\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-style/italic\": \"<fo:inline font-style=\\\"italic\\\">%%STRING%%</fo:inline>\",\n    \"@font-style/oblique\": \"<fo:inline font-style=\\\"oblique\\\">%%STRING%%</fo:inline>\",\n    \"@font-style/normal\": \"<fo:inline font-style=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-variant/small-caps\": \"<fo:inline font-variant=\\\"small-caps\\\">%%STRING%%</fo:inline>\",\n    \"@font-variant/normal\": \"<fo:inline font-variant=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/bold\": \"<fo:inline font-weight=\\\"bold\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/normal\": \"<fo:inline font-weight=\\\"normal\\\">%%STRING%%</fo:inline>\",\n    \"@font-weight/light\": \"<fo:inline font-weight=\\\"lighter\\\">%%STRING%%</fo:inline>\",\n    \"@text-decoration/none\": \"<fo:inline text-decoration=\\\"none\\\">%%STRING%%</fo:inline>\",\n    \"@text-decoration/underline\": \"<fo:inline text-decoration=\\\"underline\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/sup\": \"<fo:inline vertical-align=\\\"super\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/sub\": \"<fo:inline vertical-align=\\\"sub\\\">%%STRING%%</fo:inline>\",\n    \"@vertical-align/baseline\": \"<fo:inline vertical-align=\\\"baseline\\\">%%STRING%%</fo:inline>\",\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    \"@cite/entry\": function (state, str) {\n        return state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n    },\n    \"@bibliography/entry\": function (state, str) {\n        var indent = \"\";\n        if (state.bibliography && state.bibliography.opt && state.bibliography.opt.hangingindent) {\n            var hi = state.bibliography.opt.hangingindent;\n            indent = \" start-indent=\\\"\" + hi +\"em\\\" text-indent=\\\"-\" + hi + \"em\\\"\";\n        }\n        var insert = \"\";\n        if (state.sys.embedBibliographyEntry) {\n            insert = state.sys.embedBibliographyEntry(this.item_id) + \"\\n\";\n        }\n        return \"<fo:block id=\\\"\" + this.system_id + \"\\\"\" + indent + \">\" + str + \"</fo:block>\\n\" + insert;\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n  <fo:block>\" + str + \"</fo:block>\\n\";\n    },\n    \"@display/left-margin\": function (state, str) {\n        return \"\\n  <fo:table table-layout=\\\"fixed\\\" width=\\\"100%\\\">\\n    \" +\n                \"<fo:table-column column-number=\\\"1\\\" column-width=\\\"$$$__COLUMN_WIDTH_1__$$$\\\"/>\\n    \" +\n                \"<fo:table-column column-number=\\\"2\\\" column-width=\\\"proportional-column-width(1)\\\"/>\\n    \" +\n                \"<fo:table-body>\\n      \" +\n                    \"<fo:table-row>\\n        \" +\n                        \"<fo:table-cell>\\n          \" +\n                            \"<fo:block>\" + str + \"</fo:block>\\n        \" +\n                        \"</fo:table-cell>\\n        \";\n    },\n    \"@display/right-inline\": function (state, str) {\n        return \"<fo:table-cell>\\n          \" +\n                \"<fo:block>\" + str + \"</fo:block>\\n        \" +\n            \"</fo:table-cell>\\n      \" +\n            \"</fo:table-row>\\n    \" +\n            \"</fo:table-body>\\n  \" +\n            \"</fo:table>\\n\";\n    },\n    \"@display/indent\": function (state, str) {\n        return \"<fo:block margin-left=\\\"2em\\\">\" + str + \"</fo:block>\\n\";\n    },\n    \"@showid/true\": function (state, str) {\n        if (!state.tmp.just_looking && !state.tmp.suppress_decorations && this.params && \"string\" === typeof str) {\n            var prePunct = \"\";\n            if (str) {\n                var m = str.match(CSL.VARIABLE_WRAPPER_PREPUNCT_REX);\n                prePunct = m[1];\n                str = m[2];\n            }\n            var postPunct = \"\";\n            if (str && CSL.SWAPPING_PUNCTUATION.indexOf(str.slice(-1)) > -1) {\n                postPunct = str.slice(-1);\n                str = str.slice(0,-1);\n            }\n            return state.sys.variableWrapper(this.params, prePunct, str, postPunct);\n        } else {\n            return str;\n        }\n    },\n    \"@URL/true\": function (state, str) {\n        return \"<fo:basic-link external-destination=\\\"url('\" + str + \"')\\\">\" + str + \"</fo:basic-link>\";\n    },\n    \"@DOI/true\": function (state, str) {\n        var doiurl = str;\n        if (!str.match(/^https?:\\/\\//)) {\n            doiurl = \"https://doi.org/\" + str;\n        }\n        return \"<fo:basic-link external-destination=\\\"url('\" + doiurl + \"')\\\">\" + str + \"</fo:basic-link>\";\n    }\n};\n\n/**\n * LaTeX .bbl output.\n *\n * (Code contributed by Egon Willighagen, based on the prototype.text code.)\n */\nCSL.Output.Formats.prototype.latex = {\n    \"text_escape\": function (text) {\n        if (!text) {\n            text = \"\";\n        }\n        return text;\n    },\n    \"bibstart\": \"\\\\begin{thebibliography}{4}\",\n    \"bibend\": \"\\end{thebibliography}\",\n    \"@font-style/italic\": \"{\\\\em %%STRING%%}\",\n    \"@font-style/oblique\": false,\n    \"@font-style/normal\": false,\n    \"@font-variant/small-caps\": false,\n    \"@passthrough/true\": CSL.Output.Formatters.passthrough,\n    \"@font-variant/normal\": false,\n    \"@font-weight/bold\": \"{\\\\bf %%STRING%%}\",\n    \"@font-weight/normal\": false,\n    \"@font-weight/light\": false,\n    \"@text-decoration/none\": false,\n    \"@text-decoration/underline\": false,\n    \"@vertical-align/baseline\": false,\n    \"@vertical-align/sup\": false,\n    \"@vertical-align/sub\": false,\n    \"@strip-periods/true\": CSL.Output.Formatters.passthrough,\n    \"@strip-periods/false\": CSL.Output.Formatters.passthrough,\n    \"@quotes/true\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            return state.getTerm(\"open-quote\");\n        }\n        return state.getTerm(\"open-quote\") + str + state.getTerm(\"close-quote\");\n    },\n    \"@quotes/inner\": function (state, str) {\n        if (\"undefined\" === typeof str) {\n            //\n            // Mostly right by being wrong (for apostrophes)\n            //\n            return \"\\u2019\";\n        }\n        return state.getTerm(\"open-inner-quote\") + str + state.getTerm(\"close-inner-quote\");\n    },\n    \"@quotes/false\": false,\n    //\"@bibliography/body\": function (state,str){\n    //    return \"<div class=\\\"csl-bib-body\\\">\\n\"+str+\"</div>\";\n    //},\n    \"@cite/entry\": function (state, str) {\n\t\treturn state.sys.wrapCitationEntry(str, this.item_id, this.locator_txt, this.suffix_txt);\n\t},\n    \"@bibliography/entry\": function (state, str) {\n        return \"\\\\bibitem{\" + state.sys.embedBibliographyEntry(this.item_id) + \"}\\n\";\n    },\n    \"@display/block\": function (state, str) {\n        return \"\\n\"+str;\n    },\n    \"@display/left-margin\": function (state, str) {\n        return str;\n    },\n    \"@display/right-inline\": function (state, str) {\n        return str;\n    },\n    \"@display/indent\": function (state, str) {\n        return \"\\n    \"+str;\n    },\n    \"@showid/true\": function (state, str, cslid) {\n        return str;\n    },\n    \"@URL/true\": function (state, str) {\n        return str;\n    },\n    \"@DOI/true\": function (state, str) {\n        return str;\n    }\n};\n\nCSL.Output.Formats = new CSL.Output.Formats();\n\n/*global CSL: true */\n\n\n//\n// Time for a rewrite of this module.\n//\n// Simon has pointed out that list and hash behavior can\n// be obtained by ... just using a list and a hash.  This\n// is faster for batched operations, because sorting is\n// greatly optimized.  Since most of the interaction\n// with plugins at runtime will involve batches of\n// references, there will be solid gains if the current,\n// one-reference-at-a-time approach implemented here\n// can be replaced with something that leverages the native\n// sort method of the Array() type.\n//\n// That's going to take some redesign, but it will simplify\n// things in the long run, so it might as well happen now.\n//\n// We'll keep makeCitationCluster and makeBibliography as\n// simple methods that return a string.  Neither should\n// have any effect on internal state.  This will be a change\n// in behavior for makeCitationCluster.\n//\n// A new updateItems command will be introduced, to replace\n// insertItems.  It will be a simple list of IDs, in the\n// sequence of first reference in the document.\n//\n// The calling application should always invoke updateItems\n// before makeCitationCluster.\n//\n\n//\n// should allow batched registration of items by\n// key.  should behave as an update, with deletion\n// of items and the tainting of disambiguation\n// partner sets affected by a deletes and additions.\n//\n//\n// we'll need a reset method, to clear the decks\n// in the citation area and start over.\n\n/**\n * Registry of cited items.\n * <p>This is a persistent store of disambiguation and\n * sort order information relating to individual items\n * for which rendering is requested.  Item data is stored\n * in a hash, with the item key as hash key, for quick\n * retrieval.  A virtual sequence within the hashed store\n * is maintained on the fly as items are added to the\n * store, using <code>*_next</code> and <code>*_prev</code>\n * attributes on each item.  A separate hash of items\n * based on their undisambiguated cite form is\n * maintained, and the item id list and disambiguation\n * level for each set of disambiguation partners is shared\n * through the registry item.</p>\n * @class\n */\nCSL.Registry = function (state) {\n    this.debug = false;\n    this.state = state;\n    this.registry = {};\n    this.reflist = [];\n    this.refhash = {};\n    this.namereg = new CSL.Registry.NameReg(state);\n    this.citationreg = new CSL.Registry.CitationReg(state);\n    // See CSL.NameOutput.prototype.outputNames\n    // and CSL.Registry.prototype.doinserts\n    this.authorstrings = {};\n    \n    // for parallel delimiter support\n    this.masterMap = {};\n    \n    //\n    // shared scratch vars\n    this.mylist = [];\n    this.myhash = {};\n    this.deletes = [];\n    this.inserts = [];\n    this.uncited = {};\n    this.refreshes = {};\n    this.akeys = {};\n    this.oldseq = {};\n    this.return_data = {};\n    //\n    // each ambig is a list of the ids of other objects\n    // that have the same base-level rendering\n    this.ambigcites = {};\n    this.ambigresets = {};\n    this.sorter = new CSL.Registry.Comparifier(state, \"bibliography_sort\");\n    //this.modes = CSL.getModes.call(this.state);\n    //this.checkerator = new CSL.Checkerator();\n\n    this.getSortedIds = function () {\n        var ret = [];\n        for (var i = 0, ilen = this.reflist.length; i < ilen; i += 1) {\n            ret.push(\"\" + this.reflist[i].id);\n        }\n        return ret;\n    };\n\n    this.getSortedRegistryItems = function () {\n        var ret = [];\n        for (var i = 0, ilen = this.reflist.length; i < ilen; i += 1) {\n            ret.push(this.reflist[i]);\n        }\n        return ret;\n    };\n};\n\n//\n// Here's the sequence of operations to be performed on\n// update:\n//\n//  1.  (o) [init] Receive list as function argument, store as hash and as list.\n//  2.  (o) [init] Initialize refresh list.  Never needs sorting, only hash required.\n\n//  3.  (o) [dodeletes] Delete loop.\n//  3a. (o) [dodeletes] Delete names in items to be deleted from names reg.\n//  3b. (o) [dodeletes] Complement refreshes list with items affected by\n//      possible name changes.  We'll actually perform the refresh once\n//      all of the necessary data and parameters have been established\n//      in the registry.\n//  3c. (o) [dodeletes] Delete all items to be deleted from their disambig pools.\n//  3d. (o) [dodeletes] Delete all items in deletion list from hash.\n\n//  4.  (o) [doinserts] Insert loop.\n//  4a. (o) [doinserts] Retrieve entries for items to insert.\n//  4b. (o) [doinserts] Generate ambig key.\n//  4c. (o) [doinserts] Add names in items to be inserted to names reg\n//      (implicit in getAmbiguousCite).\n//  4d. (o) [doinserts] Record ambig pool key on akey list (used for updating further\n//      down the chain).\n//  4e. (o) [doinserts] Create registry token.\n//  4f. (o) [doinserts] Add item ID to hash.\n//  4g. (o) [doinserts] Set and record the base token to hold disambiguation\n//      results (\"disambig\" in the object above).\n//  5.  (o) [rebuildlist] Create \"new\" list of hash pointers, in the order given\n//          in the argument to the update function.\n//  6.  (o) [rebuildlist] Apply citation numbers to new list.\n//  7.  (o) [dorefreshes] Refresh items requiring update.\n\n\n\n//  5. (o) [delnames] Delete names in items to be deleted from names reg, and obtain IDs\n//         of other items that would be affected by changes around that surname.\n//  6. (o) [delnames] Complement delete and insert lists with items affected by\n//         possible name changes.\n//  7. (o) [delambigs] Delete all items to be deleted from their disambig pools.\n//  8. (o) [delhash] Delete all items in deletion list from hash.\n\n//  9. (o) [addtohash] Retrieve entries for items to insert.\n// 10. (o) [addtohash] Add items to be inserted to their disambig pools.\n// 11. (o) [addtohash] Add names in items to be inserted to names reg\n//         (implicit in getAmbiguousCite).\n// 12. (o) [addtohash] Create registry token for each item to be inserted.\n// 13. (o) [addtohash] Add items for insert to hash.\n\n// 14. (o) [buildlist] Create \"new\" list of hash pointers, in the order given in the argument\n//         to the update function.\n// 15. (o) [renumber] Apply citation numbers to new list.\n// 16. (o) [setdisambigs] Set disambiguation parameters on each inserted item token.\n// 17. (o) [setsortkeys] Set sort keys on each item token.\n// 18. (o) [sorttokens] Resort token list\n// 19. (o) [renumber] Reset citation numbers on list items\n//\n\nCSL.Registry.prototype.init = function (itemIDs, uncited_flag) {\n    var i, ilen;\n    this.oldseq = {};\n    //  1. Receive list as function argument, store as hash and as list.\n    //\n    // Result:\n    //   this.mylist: a list of all itemIDs of referenced items, cited and uncited.\n    //   this.myhash: a hash of index positions in this.mylist.\n    //   this.uncited: hash of uncited itemIDs.\n    //\n    // Proceed as follows.\n    //\n    if (uncited_flag) {\n        // If uncited_flag is non-nil, add any missing itemIDs to this.mylist\n        // from itemIDs input list, and set the itemIDs in itemIDs on this.uncited.\n        this.uncited = {};\n        for (var i=0,ilen=itemIDs.length;i<ilen; i += 1) {\n            if (!this.myhash[itemIDs[i]]) {\n                this.mylist.push(\"\" + itemIDs[i]);\n            }\n            this.uncited[itemIDs[i]] = true;\n            this.myhash[itemIDs[i]] = true;\n        }\n    } else {\n        // If uncited_flag is nil, remove duplicate itemIDs from itemIDs input\n        // list, set the result on this.mylist, and add missing itemIDs to\n        // this.mylist from itemIDs input list.\n        for (var key in this.uncited) {\n            itemIDs.push(key);\n        }\n        var myhash = {};\n        for (i=itemIDs.length-1;i>-1; i += -1) {\n            if (myhash[itemIDs[i]]) {\n                itemIDs = itemIDs.slice(0, i).concat(itemIDs.slice(i + 1));\n            } else {\n                myhash[itemIDs[i]] = true;\n            }\n        }\n        this.mylist = itemIDs;\n        this.myhash = myhash;\n    }\n    //\n    //  2. Initialize refresh list.  Never needs sorting, only hash required.\n    //\n    this.refreshes = {};\n    this.touched = {};\n    this.ambigsTouched = {};\n    this.ambigresets = {};\n};\n\nCSL.Registry.prototype.dopurge = function (myhash) {\n    // Remove any uncited items not in myhash\n    for (var i=this.mylist.length-1;i>-1;i+=-1) {\n        // Might not want to be quite this restrictive.\n        if (this.citationreg.citationsByItemId) {\n            if ((!this.citationreg.citationsByItemId || !this.citationreg.citationsByItemId[this.mylist[i]]) && !myhash[this.mylist[i]]) {\n                delete this.myhash[this.mylist[i]];\n                delete this.uncited[this.mylist[i]];\n                this.mylist = this.mylist.slice(0,i).concat(this.mylist.slice(i+1));\n            }\n        }\n    }\n    this.dodeletes(this.myhash);\n};\n\nCSL.Registry.prototype.dodeletes = function (myhash) {\n    var otheritems, key, ambig, pos, len, items, kkey, mypos, id;\n    if (\"string\" === typeof myhash) {\n        var key = myhash;\n        myhash = {};\n        myhash[key] = true;\n    }\n    //\n    //  3. Delete loop.\n    //\n    for (var key in this.registry) {\n        if (!myhash[key]) {\n            // skip items explicitly marked as uncited\n            if (this.uncited[key]) {\n                continue;\n            }\n            //\n            //  3a. Delete names in items to be deleted from names reg.\n            //\n            otheritems = this.namereg.delitems(key);\n            //\n            //  3b. Complement refreshes list with items affected by\n            //      possible name changes.  We'll actually perform the refresh once\n            //      all of the necessary data and parameters have been established\n            //      in the registry.\n            //\n            for (kkey in otheritems) {\n                this.refreshes[kkey] = true;\n            }\n            //\n            //  3c. Delete all items to be deleted from their disambig pools.\n            //\n            ambig = this.registry[key].ambig;\n            mypos = this.ambigcites[ambig].indexOf(key);\n            if (mypos > -1) {\n                items = this.ambigcites[ambig].slice();\n                this.ambigcites[ambig] = items.slice(0, mypos).concat(items.slice(mypos+1, items.length));\n                this.ambigresets[ambig] = this.ambigcites[ambig].length;\n            }\n            //\n            // XX. What we've missed is to provide an update of all\n            // items sharing the same ambig  += -1 the remaining items in\n            // ambigcites.  So let's do that here, just in case the\n            // names update above doesn't catch them all.\n            //\n            len = this.ambigcites[ambig].length;\n            for (pos = 0; pos < len; pos += 1) {\n                id = \"\" + this.ambigcites[ambig][pos];\n                this.refreshes[id] = true;\n            }\n            //\n            // 3d-0. Remove parallel id references and realign\n            // parallel ID refs.\n            //\n            if (this.registry[key].siblings) {\n                if (this.registry[key].siblings.length == 1) {\n                    var loneSiblingID = this.registry[key].siblings[0];\n                    if (this.registry[loneSiblingID].siblings) {\n                        this.registry[loneSiblingID].siblings.pop();\n                        this.registry[loneSiblingID].master = true;\n                        // this.registry[loneSiblingID].parallel = false;\n                    }\n                } else if (this.registry[key].siblings.length > 1) {\n                    var removeIDs = [key];\n                    if (this.registry[key].master) {\n                        var newmasterID = this.registry[key].siblings[0];\n                        var newmaster = this.registry[newmasterID];\n                        newmaster.master = true;\n                        // newmaster.parallel_delimiter is set externally, if at all\n                        // newmaster.parallel = false;\n                        removeIDs.push(newmasterID);\n                        // for (var k = 0, klen = this.registry[key].siblings.length; k < klen; k += 1) {\n                        //     this.registry[this.registry[key].siblings[k]].parallel = newmasterID;\n                        // }\n                    }\n                    var buffer = [];\n                    for (var k = this.registry[key].siblings.length - 1; k > -1; k += -1) {\n                        var siblingID = this.registry[key].siblings.pop();\n                        if (removeIDs.indexOf(siblingID) === -1) {\n                            buffer.push(siblingID);\n                        }\n                    }\n                    for (var k = buffer.length - 1; k > -1; k += -1) {\n                        this.registry[key].siblings.push(buffer[k]);\n                    }\n                }\n            }\n            //\n            // 3d-1. Remove item from reflist\n            for (var i=this.reflist.length-1;i>-1;i--) {\n                if (this.reflist[i].id === key) {\n                    this.reflist = this.reflist.slice(0, i).concat(this.reflist.slice(i+1));\n                }\n            }\n            //\n            //  3d. Delete all items in deletion list from hash.\n            //\n            delete this.registry[key];\n            delete this.refhash[key];\n\n            // For processCitationCluster()\n            this.return_data.bibchange = true;\n        }\n    }\n    // Disabled.  See formats.js for code.\n    // this.state.fun.decorate.items_delete( this.state.output[this.state.opt.mode].tmp, myhash );\n};\n\nCSL.Registry.prototype.doinserts = function (mylist) {\n    var item, Item, akey, newitem, abase, i, ilen;\n    if (\"string\" === typeof mylist) {\n        mylist = [mylist];\n    }\n    //\n    //  4. Insert loop.\n    //\n    for (var i = 0, ilen = mylist.length; i < ilen; i += 1) {\n        item = mylist[i];\n        if (!this.registry[item]) {\n            //\n            //  4a. Retrieve entries for items to insert.\n            //\n            Item = this.state.retrieveItem(item);\n\n            //\n            //  4b. Generate ambig key.\n            //\n            // AND\n            //\n            //  4c. Add names in items to be inserted to names reg\n            //      (implicit in getAmbiguousCite).\n            //\n            akey = CSL.getAmbiguousCite.call(this.state, Item);\n            this.ambigsTouched[akey] = true;\n            //\n            //  4d. Record ambig pool key on akey list (used for updating further\n            //      down the chain).\n            //\n            if (!Item.legislation_id) {\n                this.akeys[akey] = true;\n            }\n            //\n            //  4e. Create registry token.\n            //\n            newitem = {\n                \"id\": \"\" + item,\n                \"seq\": 0,\n                \"offset\": 0,\n                \"sortkeys\": false,\n                \"ambig\": false,\n                \"rendered\": false,\n                \"disambig\": false,\n                \"ref\": Item,\n                \"newItem\": true\n            };\n            //\n            //\n            //  4f. Add item ID to hash.\n            //\n            this.registry[item] = newitem;\n            //\n            //  4f(a). Add first reference note number\n            //         (this may be redundant)\n            if (this.citationreg.citationsByItemId && this.citationreg.citationsByItemId[item]) {\n                this.registry[item][\"first-reference-note-number\"] = this.citationreg.citationsByItemId[item][0].properties.noteIndex;\n            }\n\n            //\n            //  4g. Set and record the base token to hold disambiguation\n            //      results (\"disambig\" in the object above).\n            //\n            abase = CSL.getAmbigConfig.call(this.state);\n            this.registerAmbigToken(akey, item, abase);\n\n            //if (!this.ambigcites[akey]){\n            //    this.ambigcites[akey] = [];\n            //}\n            //CSL.debug(\"Run: \"+item+\"(\"+this.ambigcites[akey]+\")\");\n            //if (this.ambigcites[akey].indexOf(item) === -1){\n            //    CSL.debug(\"  Add: \"+item);\n            //    this.ambigcites[akey].push(item);\n            //}\n            //\n            //  4h. Make a note that this item needs its sort keys refreshed.\n            //\n            this.touched[item] = true;\n            // For processCitationCluster()\n            this.return_data.bibchange = true;\n        }\n    }\n    // Disabled.  See formats.js for code.\n    // this.state.fun.decorate.items_add( this.state.output[this.state.opt.mode].tmp, mylist );\n};\n\n/*\n// No longer required.\nCSL.Registry.prototype.douncited = function () {\n    var pos, len;\n    var cited_len = this.mylist.length - this.uncited.length;\n    for (pos = 0, len = cited_len; pos < len; pos += 1) {\n        this.registry[this.mylist[pos]].uncited = false;\n    }\n    for (pos = cited_len, len = this.mylist.length; pos < len; pos += 1) {\n        this.registry[this.mylist[pos]].uncited = true;\n    }\n};\n*/\n\nCSL.Registry.prototype.rebuildlist = function (nosort) {\n    var len, pos, item, Item;\n    //\n    //  5. Create \"new\" list of hash pointers, in the order given in the argument\n    //     to the update function.\n    //\n    //\n    // XXX Keep reflist in place.\n    //\n    if (!nosort) {\n        this.reflist_inserts = [];\n        //\n        //  6. Apply citation numbers to new list,\n        //     saving off old sequence numbers as we go.\n        //\n        // XXX Just memo inserts -- actual insert happens below, at last \"sort\"\n        //\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            if (Item.newItem) {\n                this.reflist_inserts.push(Item);\n            }\n            this.oldseq[item] = this.registry[item].seq;\n            this.registry[item].seq = (pos + 1);\n        }\n    } else {\n        this.reflist = [];\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            this.reflist.push(Item);\n            this.oldseq[item] = this.registry[item].seq;\n            this.registry[item].seq = (pos + 1);\n        }\n    }\n};\n\n/*\n * Okay, at this point we should have a numbered list\n * of registry tokens in the notional order requested,\n * with sequence numbers to reconstruct the ordering\n * if the list is remangled.  So far so good.\n */\n\nCSL.Registry.prototype.dorefreshes = function () {\n    var key, regtoken, Item, akey, abase;\n    //\n    //  7. Refresh items requiring update.\n    //\n    // It looks like we need to do four things on each cite for refresh:\n    // (1) Generate the akey for the cite.\n    // (2) Register it on the ambig token.\n    // (3) Register the akey in this.akeys\n    // (4) Register the item ID in this.touched\n    //\n    for (var key in this.refreshes) {\n        regtoken = this.registry[key];\n        if (!regtoken) {\n            continue;\n        }\n        regtoken.sortkeys = undefined;\n        Item = this.state.refetchItem(key);\n        var akey = regtoken.ambig;\n\n        if (\"undefined\" === typeof akey) {\n            this.state.tmp.disambig_settings = false;\n            akey = CSL.getAmbiguousCite.call(this.state, Item);\n            abase = CSL.getAmbigConfig.call(this.state);\n            this.registerAmbigToken(akey, key, abase);\n        }\n        for (var akkey in this.ambigresets) {\n            if (this.ambigresets[akkey] === 1) {\n                var loneKey = this.ambigcites[akey][0];\n                var Item = this.state.refetchItem(loneKey);\n                this.registry[loneKey].disambig = new CSL.AmbigConfig();\n                this.state.tmp.disambig_settings = false;\n                var akey = CSL.getAmbiguousCite.call(this.state, Item);\n                var abase = CSL.getAmbigConfig.call(this.state);\n                this.registerAmbigToken(akey, loneKey, abase);\n            }\n        }\n        this.state.tmp.taintedItemIDs[key] = true;\n        this.ambigsTouched[akey] = true;\n        if (!Item.legislation_id) {\n            this.akeys[akey] = true;\n        }\n        this.touched[key] = true;\n    }\n};\n\n/*\n * Main disambiguation  += -1 can everything for disambiguation be\n * crunched into this function?\n */\nCSL.Registry.prototype.setdisambigs = function () {\n    //\n    // Okay, more changes.  Here is where we resolve all disambiguation\n    // issues for cites touched by the update.  The this.ambigcites set is\n    // based on the complete short form of citations, and is the basis on\n    // which names are added and minimal adding of initials or given names\n    // is performed.\n    //\n\n    //\n    //  8.  Set disambiguation parameters on each inserted item token.\n    //\n    for (var akey in this.ambigsTouched) {\n        //\n        // Disambiguation is fully encapsulated.\n        // Disambiguator will run only if there are multiple\n        // items, and at least one disambiguation mode is\n        // in effect.\n        this.state.disambiguate.run(akey);\n    }\n    this.ambigsTouched = {};\n    this.akeys = {};\n};\n\n\n\nCSL.Registry.prototype.renumber = function () {\n    var len, pos, item;\n    //\n    // 19. Reset citation numbers on list items\n    //\n    if (this.state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n        this.state.bibliography_sort.tmp.citation_number_map = {};\n    }\n    len = this.reflist.length;\n    for (pos = 0; pos < len; pos += 1) {\n        item = this.reflist[pos];\n        // save the overhead of rerenderings if citation-number is not\n        // used in the style.\n        item.seq = (pos + 1);\n        if (this.state.bibliography_sort.opt.citation_number_sort_direction === CSL.DESCENDING) {\n            this.state.bibliography_sort.tmp.citation_number_map[item.seq] = (this.reflist.length - item.seq + 1);\n        }\n        // update_mode is set to CSL.NUMERIC if citation-number is rendered\n        // in citations.\n        if (this.state.opt.update_mode === CSL.NUMERIC && item.seq != this.oldseq[item.id]) {\n            this.state.tmp.taintedItemIDs[item.id] = true;\n        }\n        if (item.seq != this.oldseq[item.id]) {\n            this.return_data.bibchange = true;\n        }\n    }\n};\n\nCSL.Registry.prototype.setsortkeys = function () {\n    var key;\n    //\n    // 17. Set sort keys on each item token.\n    //\n    for (var i = 0, ilen = this.mylist.length; i < ilen; i += 1) {\n        var key = this.mylist[i];\n        // The last of these conditions may create some thrashing on styles that do not require sorting.\n        if (this.touched[key] || this.state.tmp.taintedItemIDs[key] || !this.registry[key].sortkeys) {\n            this.registry[key].sortkeys = CSL.getSortKeys.call(this.state, this.state.retrieveItem(key), \"bibliography_sort\");\n        }\n    }\n};\n\nCSL.Registry.prototype._insertItem = function(element, array) {\n    array.splice(this._locationOf(element, array) + 1, 0, element);\n    return array;\n};\n\nCSL.Registry.prototype._locationOf = function(element, array, start, end) {\n    if (array.length === 0) {\n        return -1;\n    }\n    start = start || 0;\n    end = end || array.length;\n    var pivot = (start + end) >> 1;  // should be faster than dividing by 2\n    \n    var c = this.sorter.compareKeys(element, array[pivot]);\n    if (end - start <= 1) {\n        return c == -1 ? pivot - 1 : pivot;\n    }\n    switch (c) {\n        case -1: return this._locationOf(element, array, start, pivot);\n        case 0: return pivot;\n        case 1: return this._locationOf(element, array, pivot, end);\n    }\n};\n\nCSL.Registry.prototype.sorttokens = function (nosort) {\n    var len, item, Item, pos;\n    //\n    // 18. Resort token list.\n    //\n    if (!nosort) {\n        this.reflist_inserts = [];\n        len = this.mylist.length;\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            if (Item.newItem) {\n                this.reflist_inserts.push(Item);\n            }\n        }\n        // There is a thin possibility that tainted items in a sorted list\n        // will change position due to disambiguation. We cover for that here.\n        for (var key in this.state.tmp.taintedItemIDs) {\n            if (this.registry[key] && !this.registry[key].newItem) {\n                // Move tainted items from reflist to reflist_inserts\n                for (var i=this.reflist.length-1;i>-1;i--) {\n                    if (this.reflist[i].id === key) {\n                        this.reflist_inserts.push(this.reflist[i]);\n                        this.reflist = this.reflist.slice(0, i).concat(this.reflist.slice(i+1));\n                    }\n                }\n            }\n        }\n        for (var i=0,ilen=this.reflist_inserts.length;i<ilen;i++) {\n            var Item = this.reflist_inserts[i];\n            delete Item.newItem;\n            this.reflist = this._insertItem(Item, this.reflist);\n        }\n        for (pos = 0; pos < len; pos += 1) {\n            item = this.mylist[pos];\n            Item = this.registry[item];\n            this.registry[item].seq = (pos + 1);\n        }\n    }\n};\n\n/**\n * Compare two sort keys\n * <p>Nested, because keys are an array.</p>\n */\nCSL.Registry.Comparifier = function (state, keyset) {\n    var sort_directions, len, pos, compareKeys;\n    var sortCompare = CSL.getSortCompare.call(state, state.opt[\"default-locale-sort\"]);\n    sort_directions = state[keyset].opt.sort_directions;\n    this.compareKeys = function (a, b) {\n        len = a.sortkeys ? a.sortkeys.length : 0;\n        for (pos = 0; pos < len; pos += 1) {\n            //\n            // for ascending sort 1 uses 1, -1 uses -1.\n            // For descending sort, the values are reversed.\n            //\n            // Need to handle undefined values.  No way around it.\n            // So have to screen .localeCompare (which is also\n            // needed) from undefined values.  Everywhere, in all\n            // compares.\n            //\n            var cmp = 0;\n            if (a.sortkeys[pos] === b.sortkeys[pos]) {\n                cmp = 0;\n            } else if (\"undefined\" === typeof a.sortkeys[pos]) {\n                cmp = sort_directions[pos][1];\n            } else if (\"undefined\" === typeof b.sortkeys[pos]) {\n                cmp = sort_directions[pos][0];\n            } else {\n                // cmp = a.sortkeys[pos].localeCompare(b.sortkeys[pos]);\n                cmp = sortCompare(a.sortkeys[pos], b.sortkeys[pos]);\n            }\n            if (0 < cmp) {\n                return sort_directions[pos][1];\n            } else if (0 > cmp) {\n                return sort_directions[pos][0];\n            }\n        }\n        if (a.seq > b.seq) {\n            return 1;\n        } else if (a.seq < b.seq) {\n            return -1;\n        }\n        return 0;\n    };\n    compareKeys = this.compareKeys;\n    this.compareCompositeKeys = function (a, b) {\n        return compareKeys(a[1], b[1]);\n    };\n};\n\n\n/**\n * Compare two disambiguation tokens by their registry sort order\n * <p>Disambiguation lists need to be sorted this way, to\n * obtain the correct year-suffix when that's used.</p>\n */\nCSL.Registry.prototype.compareRegistryTokens = function (a, b) {\n    if (a.seq > b.seq) {\n        return 1;\n    } else if (a.seq < b.seq) {\n        return -1;\n    }\n    return 0;\n};\n\nCSL.Registry.prototype.registerAmbigToken = function (akey, id, ambig_config) {\n    //SNIP-START\n    if (!this.registry[id]) {\n        CSL.debug(\"Warning: unregistered item: itemID=(\"+id+\"), akey=(\"+akey+\")\");\n    }\n    //SNIP-END\n    // Taint if number of names to be included has changed\n    if (this.registry[id] && this.registry[id].disambig && this.registry[id].disambig.names) {\n        for (var i = 0, ilen = ambig_config.names.length; i < ilen; i += 1) {\n            var new_names_params = ambig_config.names[i];\n            var old_names_params = this.registry[id].disambig.names[i];\n            if (new_names_params !== old_names_params) {\n                this.state.tmp.taintedItemIDs[id] = true;\n            } else if (ambig_config.givens[i]) {\n                // Compare givenses only if the number of names is aligned.\n                for (var j=0,jlen=ambig_config.givens[i].length;j<jlen;j+=1) {\n                    var new_gnames_params = ambig_config.givens[i][j];\n                    var old_gnames_params = this.registry[id].disambig.givens[i][j];\n                    if (new_gnames_params !== old_gnames_params) {\n                        this.state.tmp.taintedItemIDs[id] = true;\n                    }\n                }\n            }\n        }\n    }\n\n    if (!this.ambigcites[akey]) {\n        this.ambigcites[akey] = [];\n    }\n    if (this.ambigcites[akey].indexOf(\"\" + id) === -1) {\n        this.ambigcites[akey].push(\"\" + id);\n    }\n    this.registry[id].ambig = akey;\n    this.registry[id].disambig = CSL.cloneAmbigConfig(ambig_config);\n};\n\n\n/**\n * Get the sort key of an item, without decorations\n * <p>This is used internally by the Registry.</p>\n */\nCSL.getSortKeys = function (Item, key_type) {\n    var area, root, extension, strip_prepositions, len, pos;\n    //SNIP-START\n    if (false) {\n        CSL.debug(\"KEY TYPE: \" + key_type);\n    }\n    //SNIP-END\n    area = this.tmp.area;\n    root = this.tmp.root;\n    extension = this.tmp.extension;\n    strip_prepositions = CSL.Util.Sort.strip_prepositions;\n    this.tmp.area = key_type;\n    // Gawdawful, this.\n    this.tmp.root = key_type.indexOf(\"_\") > -1 ? key_type.slice(0,-5) : key_type;\n    this.tmp.extension = \"_sort\";\n    this.tmp.disambig_override = true;\n    this.tmp.disambig_request = false;\n    this.tmp.suppress_decorations = true;\n    CSL.getCite.call(this, Item);\n    this.tmp.suppress_decorations = false;\n    this.tmp.disambig_override = false;\n    len = this[key_type].keys.length;\n    for (pos = 0; pos < len; pos += 1) {\n        this[key_type].keys[pos] = strip_prepositions(this[key_type].keys[pos]);\n    }\n    //SNIP-START\n    if (false) {\n        CSL.debug(\"sort keys (\" + key_type + \"): \" + this[key_type].keys);\n    }\n    //SNIP-END\n    \n    this.tmp.area = area;\n    this.tmp.root = root;\n    this.tmp.extension = extension;\n    return this[key_type].keys;\n};\n\n\n/*global CSL: true */\n\nCSL.Registry.NameReg = function (state) {\n    var pkey, ikey, skey, dagopt, gdropt, items, strip_periods, set_keys, evalname, delitems, addname, myitems;\n    this.state = state;\n    this.namereg = {};\n    this.nameind = {};\n    // used for restoring state following preview\n    this.nameindpkeys = {};\n    //\n    // family, initials form, fullname (with given stripped of periods)\n    //\n    // keys registered, indexed by ID\n    this.itemkeyreg = {};\n\n    strip_periods = function (str) {\n        if (!str) {\n            str = \"\";\n        }\n        return str.replace(/\\./g, \" \").replace(/\\s+/g, \" \").replace(/\\s+$/,\"\");\n    };\n\n    set_keys = function (state, itemid, nameobj) {\n        pkey = strip_periods(nameobj.family);\n        skey = strip_periods(nameobj.given);\n        // Drop lowercase suffixes (such as et al.) from given name field\n        // for disambiguation purposes.\n        var m = skey.match(/[,\\!]* ([^,]+)$/);\n        if (m && m[1] === m[1].toLowerCase()) {\n            skey = skey.replace(/[,\\!]* [^,]+$/, \"\");\n        }\n        // The %s terminator enables normal initialization behavior\n        // with non-Byzantine names.\n        ikey = CSL.Util.Names.initializeWith(state, skey, \"%s\");\n        if (state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\") {\n            pkey = \"\" + itemid + pkey;\n        }\n    };\n\n    evalname = function (item_id, nameobj, namenum, request_base, form, initials) {\n        var param;\n        // XXX THIS CAN NO LONGER HAPPEN\n        if (state.tmp.area.slice(0, 12) === \"bibliography\" && !form) {\n            if (\"string\" === typeof initials) {\n                return 1;\n            } else {\n                return 2;\n            }\n        }\n        var res = state.nameOutput.getName(nameobj, \"locale-translit\", true);\n        nameobj = res.name;\n        set_keys(this.state, \"\" + item_id, nameobj);\n        //\n        // possible options are:\n        //\n        // <option disambiguate-add-givenname value=\"true\"/> (a)\n        // <option disambiguate-add-givenname value=\"all-names\"/> (a)\n        // <option disambiguate-add-givenname value=\"all-names-with-initials\"/> (b)\n        // <option disambiguate-add-givenname value=\"primary-name\"/> (d)\n        // <option disambiguate-add-givenname value=\"primary-name-with-initials\"/> (e)\n        // <option disambiguate-add-givenname value=\"by-cite\"/> (g)\n        //\n        param = 2;\n        dagopt = state.opt[\"disambiguate-add-givenname\"];\n        gdropt = state.citation.opt[\"givenname-disambiguation-rule\"];\n        var gdropt_orig = gdropt;\n        if (gdropt === \"by-cite\") {\n            gdropt = \"all-names\";\n        }\n        //\n        // set initial value\n        //\n        if (\"short\" === form) {\n            param = 0;\n        } else if (\"string\" === typeof initials) {\n            param = 1;\n        }\n        //\n        // give literals a pass\n        if (\"undefined\" === typeof this.namereg[pkey] || \"undefined\" === typeof this.namereg[pkey].ikey[ikey]) {\n            return param;\n        }\n        //\n        // adjust value upward if appropriate -- only if running\n        // a non-names-global disambiguation strategy\n        //\n        if (gdropt_orig === \"by-cite\" && param <= request_base) {\n            //param = request_base;\n            return request_base;\n        }\n        if (!dagopt) {\n            return param;\n        }\n        if (\"string\" === typeof gdropt && gdropt.slice(0, 12) === \"primary-name\" && namenum > 0) {\n            return param;\n        }\n        //\n        // the last composite condition is for backward compatibility\n        //\n        if (!gdropt || gdropt === \"all-names\" || gdropt === \"primary-name\") {\n            if (this.namereg[pkey].count > 1) {\n                param = 1;\n            }\n            if ((this.namereg[pkey].ikey \n                 && this.namereg[pkey].ikey[ikey].count > 1)\n                || (this.namereg[pkey].count > 1 \n                    && \"string\" !== typeof initials)) {\n\n                param = 2;\n            }\n        } else if (gdropt === \"all-names-with-initials\" || gdropt === \"primary-name-with-initials\") {\n            if (this.namereg[pkey].count > 1) {\n                param = 1;\n            } else {\n                param = 0;\n            }\n        }\n        if (!state.registry.registry[item_id]) {\n            if (form == \"short\") {\n                return 0;\n            } else if (\"string\" == typeof initials) {\n                return 1;\n            }\n        } else {\n            return param;\n        }\n    };\n\n    //\n    // The operation of this function does not show up in the\n    // standard test suite, but it has been hand-tested with\n    // a print trace, and seems to work okay.\n    //\n    delitems = function (ids) {\n        var pos, len, posB, id, fullkey;\n        if (\"string\" === typeof ids || \"number\" === typeof ids) {\n            ids = [\"\" + ids];\n        }\n        // ret carries the IDs of other items using this name.\n        var ret = {};\n        len = ids.length;\n        for (pos = 0; pos < len; pos += 1) {\n            id = \"\" + ids[pos];\n            if (!this.nameind[id]) {\n                continue;\n            }\n            for (fullkey in this.nameind[id]) {\n                if (this.nameind[id].hasOwnProperty(fullkey)) {\n                    var key = fullkey.split(\"::\");\n                    pkey = key[0];\n                    ikey = key[1];\n                    skey = key[2];\n                    // Skip names that have been deleted already.\n                    // Needed to clear integration DisambiguateAddGivenname1.txt\n                    // and integration DisambiguateAddGivenname2.txt\n                    if (\"undefined\" === typeof this.namereg[pkey]) {\n                        continue;\n                    }\n\n                    // ????\n                    //posA = this.namereg[pkey].items.indexOf(posA);\n\n                    items = this.namereg[pkey].items;\n                    // This was really, really unperceptive. They key elements\n                    // have absolutely nothing to do with whether there was ever\n                    // a registration at each key level.\n                    if (skey && this.namereg[pkey].ikey[ikey] && this.namereg[pkey].ikey[ikey].skey[skey]) {\n                        myitems = this.namereg[pkey].ikey[ikey].skey[skey].items;\n                        posB = myitems.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            this.namereg[pkey].ikey[ikey].skey[skey].items = myitems.slice(0, posB).concat(myitems.slice([(posB + 1)]));\n                        }\n                        if (this.namereg[pkey].ikey[ikey].skey[skey].items.length === 0) {\n                            delete this.namereg[pkey].ikey[ikey].skey[skey];\n                            this.namereg[pkey].ikey[ikey].count += -1;\n                            if (this.namereg[pkey].ikey[ikey].count < 2) {\n                                for (var i = 0, ilen = this.namereg[pkey].ikey[ikey].items.length; i < ilen; i += 1) {\n                                    state.tmp.taintedItemIDs[this.namereg[pkey].ikey[ikey].items[i]] = true;\n                                }\n                            }\n                        }\n                    }\n                    if (ikey && this.namereg[pkey].ikey[ikey]) {\n                        posB = this.namereg[pkey].ikey[ikey].items.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            items = this.namereg[pkey].ikey[ikey].items.slice();\n                            this.namereg[pkey].ikey[ikey].items = items.slice(0, posB).concat(items.slice([posB + 1]));\n                        }\n                        if (this.namereg[pkey].ikey[ikey].items.length === 0) {\n                            delete this.namereg[pkey].ikey[ikey];\n                            this.namereg[pkey].count += -1;\n                            if (this.namereg[pkey].count < 2) {\n                                for (var i = 0, ilen = this.namereg[pkey].items.length; i < ilen; i += 1) {\n                                    state.tmp.taintedItemIDs[this.namereg[pkey].items[i]] = true;\n                                }\n                            }\n                        }\n                    }\n                    if (pkey) {\n                        posB = this.namereg[pkey].items.indexOf(\"\" + id);\n                        if (posB > -1) {\n                            items = this.namereg[pkey].items.slice();\n                            this.namereg[pkey].items = items.slice(0, posB).concat(items.slice([posB + 1], items.length));\n                        }\n                        if (this.namereg[pkey].items.length < 2) {\n                            delete this.namereg[pkey];\n                        }\n                    }\n                    delete this.nameind[id][fullkey];\n                }\n            }\n            delete this.nameind[id];\n            delete this.nameindpkeys[id];\n        }\n        return ret;\n    };\n    //\n    // Run ALL\n    // renderings with disambiguate-add-givenname set to a value\n    // with the by-cite behaviour, and then set the names-based\n    // expanded form when the final makeCitationCluster rendering\n    // is output.  This could be done with a single var set on\n    // the state object in the execution wrappers that run the\n    // style.\n    //\n    addname = function (item_id, nameobj, pos) {\n        var i, ilen;\n        var res = state.nameOutput.getName(nameobj, \"locale-translit\", true);\n        nameobj = res.name;\n\n        if (state.citation.opt[\"givenname-disambiguation-rule\"]\n            && state.citation.opt[\"givenname-disambiguation-rule\"].slice(0, 8) === \"primary-\"\n            && pos !== 0) {\n                return;\n        }\n        \n        // A hack. Safe if the name object is used only here, for disambiguation purposes.\n        if (state.opt[\"demote-non-dropping-particle\"] === \"never\" && nameobj[\"non-dropping-particle\"] && nameobj[\"family\"]) {\n            nameobj[\"family\"] = nameobj[\"non-dropping-particle\"] + \" \" + nameobj[\"family\"];\n        }\n        \n        //CSL.debug(\"INS\");\n        set_keys(this.state, \"\" + item_id, nameobj);\n        // pkey, ikey and skey should be stored in separate cascading objects.\n        // there should also be a kkey, on each, which holds the item ids using\n        // that form of the name.\n        //\n        // (later note: well, we seem to have slipped a notch here.\n        // Adding lists of IDs all over the place here makes no sense;\n        // the lists need to include _only_ the items currently rendered\n        // at the given level, and the place to do that is in evalname,\n        // and in delnames, not here.)\n        if (pkey) {\n            if (\"undefined\" === typeof this.namereg[pkey]) {\n                this.namereg[pkey] = {};\n                this.namereg[pkey].count = 0;\n                this.namereg[pkey].ikey = {};\n                this.namereg[pkey].items = [item_id];\n            } else if (this.namereg[pkey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].items.push(item_id);\n//            }\n        }\n        if (pkey && ikey) {\n            if (\"undefined\" === typeof this.namereg[pkey].ikey[ikey]) {\n                this.namereg[pkey].ikey[ikey] = {};\n                this.namereg[pkey].ikey[ikey].count = 0;\n                this.namereg[pkey].ikey[ikey].skey = {};\n                this.namereg[pkey].ikey[ikey].items = [item_id];\n                this.namereg[pkey].count += 1;\n                if (this.namereg[pkey].count === 2) {\n                    for (var i = 0, ilen = this.namereg[pkey].items.length; i < ilen; i += 1) {\n                        state.tmp.taintedItemIDs[this.namereg[pkey].items[i]] = true;\n                    }\n                }\n            } else if (this.namereg[pkey].ikey[ikey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].ikey[ikey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].ikey[ikey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].ikey[ikey].items.push(item_id);\n//            }\n        }\n        if (pkey && ikey && skey) {\n            if (\"undefined\" === typeof this.namereg[pkey].ikey[ikey].skey[skey]) {\n                this.namereg[pkey].ikey[ikey].skey[skey] = {};\n                this.namereg[pkey].ikey[ikey].skey[skey].items = [item_id];\n                this.namereg[pkey].ikey[ikey].count += 1;\n                if (this.namereg[pkey].ikey[ikey].count === 2) {\n                    for (var i = 0, ilen = this.namereg[pkey].ikey[ikey].items.length; i < ilen; i += 1) {\n                        state.tmp.taintedItemIDs[this.namereg[pkey].ikey[ikey].items[i]] = true;\n                    }\n                }\n            } else if (this.namereg[pkey].ikey[ikey].skey[skey].items.indexOf(item_id) === -1) {\n                this.namereg[pkey].ikey[ikey].skey[skey].items.push(item_id);\n            }\n//            if (this.namereg[pkey].ikey[ikey].skey[skey].items.indexOf(item_id) === -1) {\n//                this.namereg[pkey].ikey[ikey].skey[skey].items.push(item_id);\n//            }\n        }\n        if (\"undefined\" === typeof this.nameind[item_id]) {\n            this.nameind[item_id] = {};\n            this.nameindpkeys[item_id] = {};\n        }\n        //CSL.debug(\"INS-A: [\" + pkey + \"] [\" + ikey + \"] [\" + skey + \"]\");\n        if (pkey) {\n            this.nameind[item_id][pkey + \"::\" + ikey + \"::\" + skey] = true;\n            this.nameindpkeys[item_id][pkey] = this.namereg[pkey];\n        }\n        //CSL.debug(\"INS-B\");\n    };\n    this.addname = addname;\n    this.delitems = delitems;\n    this.evalname = evalname;\n};\n\n/*global CSL: true */\n\nCSL.Registry.CitationReg = function () {\n    this.citationById = {};\n    this.citationByIndex = [];\n};\n\n/*global CSL: true */\n\nCSL.Disambiguation = function (state) {\n    this.state = state;\n    this.sys = this.state.sys;\n    this.registry = state.registry.registry;\n    this.ambigcites = state.registry.ambigcites;\n    this.configModes();\n    this.debug = false;\n};\n\nCSL.Disambiguation.prototype.run = function(akey) {\n    if (!this.modes.length) {\n        return;\n    }\n    //SNIP-START\n    if (this.debug) {\n        print(\"[A] === RUN ===\");\n    }\n    //SNIP-END\n    this.akey = akey;\n    if (this.initVars(akey)) {\n        this.runDisambig();\n    }\n\n};\n\nCSL.Disambiguation.prototype.runDisambig = function () {\n    var ismax;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[C] === runDisambig() ===\");\n    }\n    //SNIP-END\n    this.initGivens = true;\n    //\n    // Length of list may change during processing\n    while (this.lists.length) {\n        this.gnameset = 0;\n        this.gname = 0;\n        this.clashes = [1, 0];\n        // each list is scanned repeatedly until all\n        // items either succeed or ultimately fail.\n        while(this.lists[0][1].length) {\n            this.listpos = 0;\n            if (!this.base) {\n                this.base = this.lists[0][0];\n            }\n            ismax = this.incrementDisambig();\n            this.scanItems(this.lists[0]);\n            this.evalScan(ismax);\n        }\n        this.lists = this.lists.slice(1);\n    }\n};\n\nCSL.Disambiguation.prototype.scanItems = function (list) {\n    var pos, len, otherItem;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[2] === scanItems() ===\");\n    }\n    //SNIP-END\n\n    this.Item = list[1][0];\n    this.ItemCite = CSL.getAmbiguousCite.call(this.state, this.Item, this.base, true);\n\n    this.scanlist = list[1];\n    this.partners = [];\n    this.partners.push(this.Item);\n    this.nonpartners = [];\n    var clashes = 0;\n\n    for (var pos = 1, len = list[1].length; pos < len; pos += 1) {\n        otherItem = list[1][pos];\n        var otherItemCite = CSL.getAmbiguousCite.call(this.state, otherItem, this.base, true);\n        //SNIP-START\n        if (this.debug) {\n            if (pos > 1) {\n                print(\"  -----------\");\n            }\n        }\n        //SNIP-END\n        if (this.ItemCite === otherItemCite) {\n            //SNIP-START\n            if (this.debug) {\n                print(\"  [CLASH]--> \"+this.Item.id+\": \"+this.ItemCite);\n                print(\"             \"+otherItem.id+\": \"+otherItemCite);\n            }\n            //SNIP-END\n            clashes += 1;\n            this.partners.push(otherItem);\n        } else {\n            //SNIP-START\n            if (this.debug) {\n                print(\"  [clear]--> \"+this.Item.id+\": \"+this.ItemCite);\n                print(\"             \"+otherItem.id+\": \"+otherItemCite);\n            }\n            //SNIP-END\n            this.nonpartners.push(otherItem);\n        }\n    }\n    this.clashes[0] = this.clashes[1];\n    this.clashes[1] = clashes;\n};\n\nCSL.Disambiguation.prototype.evalScan = function (maxed) {\n    this[this.modes[this.modeindex]](maxed);\n    if (maxed) {\n        if (this.modeindex < this.modes.length - 1) {\n            this.modeindex += 1;\n        } else {\n            this.lists[this.listpos + 1] = [this.base, []];\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disNames = function (ismax) {\n    var i, ilen;\n    \n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] == disNames() ==\");\n        //print(\"       partners: \"+[this.partners[i].id for (i in this.partners)].join(\", \"));\n        //print(\"    nonpartners: \"+[this.nonpartners[i].id for (i in this.nonpartners)].join(\", \"));\n    }\n    //SNIP-END\n\n    // New design\n    // this.base is a forward-only counter. Values are never\n    // reduced, and the counter object is never overwritten.\n    // It is methodically pushed forward in single-unit increments\n    // in incrementDisambig() until disNames() wipes out the list.\n\n    // this.betterbase is cloned from this.base exactly once,\n    // at the start of a disambiguation run. Whenever an operation\n    // results in improvement, the just-incremented elements\n    // identified as this.base.names[this.gnameset] (number of\n    // names)and as this.base.givens[this.gnameset][this.gname]\n    // (level of given name) are copied from this.base.\n\n    // The this.base object is used to control disambiguation\n    // renderings. These will be more fully expanded than the final\n    // text, but the flip side of the fact that the extra data does\n    // not contribute anything to disambiguation is that leaving\n    // it in does no harm -- think of it as the Cold Dark Matter of\n    // disambiguation.\n\n    if (this.clashes[1] === 0 && this.nonpartners.length === 1) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [a]: lone partner, one nonpartner\");\n            print(\"  registering \"+this.partners[0].id+\" and \"+this.nonpartners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.nonpartners[0].id, this.betterbase);\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[0].id, this.betterbase);\n        this.lists[this.listpos] = [this.betterbase, []];\n    } else if (this.clashes[1] === 0) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [b]: lone partner, unknown number of remaining nonpartners\");\n            print(\"  registering \"+this.partners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[0].id, this.betterbase);\n        this.lists[this.listpos] = [this.betterbase, this.nonpartners];\n        if (this.nonpartners.length) {\n            this.initGivens = true;\n        }\n    } else if (this.nonpartners.length === 1) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [c]: lone nonpartner, unknown number of partners remaining\");\n            print(\"  registering \"+this.nonpartners[0].id);\n        }\n        //SNIP-END\n        this.state.registry.registerAmbigToken(this.akey, \"\" + this.nonpartners[0].id, this.betterbase);\n        //this.lists[this.listpos] = [this.betterbase, this.partners];\n        this.lists[this.listpos] = [this.betterbase, this.partners];\n    } else if (this.clashes[1] < this.clashes[0]) {\n        this.captureStepToBase();\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [d]: better result, but no entries safe to register\");\n        }\n        //SNIP-END\n        this.lists[this.listpos] = [this.betterbase, this.partners];\n        this.lists.push([this.betterbase, this.nonpartners]);\n    } else {\n        //SNIP-START\n        if (this.debug) {\n            print(\"  ** RESOLUTION [e]: no improvement, and clashes remain\");\n        }\n        //SNIP-END\n        if (ismax) {\n            this.lists[this.listpos] = [this.betterbase, this.nonpartners];\n            this.lists.push([this.betterbase, this.partners]);\n            if (this.modeindex === this.modes.length - 1) {\n                //SNIP-START\n                if (this.debug) {\n                    print(\"     (registering clashing entries because we've run out of options)\");\n                }\n                //SNIP-END\n                for (var i = 0, ilen = this.partners.length; i < ilen; i += 1) {\n                    this.state.registry.registerAmbigToken(this.akey, \"\" + this.partners[i].id, this.betterbase);\n                }\n                this.lists[this.listpos] = [this.betterbase, []];\n            }\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disExtraText = function () {\n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] === disExtraText ==\");\n    }\n    //SNIP-END\n    \n    var done = false;\n\n    if (this.clashes[1] === 0 && this.nonpartners.length < 2) {\n        done = true;\n    }\n\n    // If first encounter in this cycle and multiple modes are\n    // available, decrement mode and reset base\n    if (!done && (!this.base.disambiguate || this.state.tmp.disambiguate_count !== this.state.tmp.disambiguate_maxMax)) {\n        // Rerun everything on each subcycle? This doesn't work currently.\n        //this.initVars(this.akey)\n        this.modeindex = 0;\n        this.base.disambiguate = this.state.tmp.disambiguate_count;\n        this.betterbase.disambiguate = this.state.tmp.disambiguate_count;\n        if (!this.base.disambiguate) {\n            // Evaluate here?\n            this.initGivens = true;\n            // If disambiguate is false set to true\n            this.base.disambiguate = 1;\n            // There may be changes\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n            }\n        } else {\n            this.disNames();\n        }\n    } else if (done || this.state.tmp.disambiguate_count === this.state.tmp.disambiguate_maxMax) {\n        if (done || this.modeindex === this.modes.length - 1) {\n            // If this is the end, disambiguation failed.\n            // Discard disambiguate=true (?) and set parameters\n            var base = this.lists[this.listpos][0];\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n                this.state.registry.registerAmbigToken(this.akey, \"\" + this.lists[this.listpos][1][i].id, base);\n            }\n            this.lists[this.listpos] = [this.betterbase, []];\n        } else {\n            // If this is followed by year-suffix, keep\n            // parameters and set disambiguate=true since it MIGHT\n            // include the date, needed for year-suffix.\n            // This may be a bit over-aggressive for cases in which the\n            // disambiguate condition does not add the date\n            this.modeindex = this.modes.length - 1;\n            var base = this.lists[this.listpos][0];\n            base.disambiguate = true;\n            for (var i = 0, ilen = this.lists[this.listpos][1].length; i < ilen; i += 1) {\n                // Always tainting here might be a little over-aggressive, but a taint may be required.\n                this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id] = true;\n                this.state.registry.registerAmbigToken(this.akey, \"\" + this.lists[this.listpos][1][i].id, base);\n            }\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.disYears = function () {\n    var pos, len, tokens, token;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[3] === disYears ==\");\n    }\n    //SNIP-END\n    tokens = [];\n    var base = this.lists[this.listpos][0];\n    if (this.clashes[1]) {\n        // That is, if the initial increment on the ambigs group returns no\n        // clashes, don't apply suffix. The condition is a necessary failsafe.\n\t\t// In original submission order\n\t\tfor (var i = 0, ilen = this.state.registry.mylist.length; i < ilen; i += 1) {\n\t\t\tvar origid = this.state.registry.mylist[i];\n\t\t\tfor (var j = 0, jlen = this.lists[this.listpos][1].length; j < jlen; j += 1) {\n\t\t\t\tvar token = this.lists[this.listpos][1][j];\n\t\t\t\t// Warning: token.id can be number. This should be fixed at a higher level in citeproc-js if poss.\n\t\t\t\tif (token.id == origid) {\n\t\t\t\t\ttokens.push(this.registry[token.id]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n    }\n    tokens.sort(this.state.registry.sorter.compareKeys);\n    for (var pos = 0, len = tokens.length; pos < len; pos += 1) {\n        base.year_suffix = \"\"+pos;\n        var oldBase = this.state.registry.registry[tokens[pos].id].disambig;\n        this.state.registry.registerAmbigToken(this.akey, \"\" + tokens[pos].id, base);\n        if (CSL.ambigConfigDiff(oldBase,base)) {\n            this.state.tmp.taintedItemIDs[tokens[pos].id] = true;\n        }\n    }\n    this.lists[this.listpos] = [this.betterbase, []];\n};\n\nCSL.Disambiguation.prototype.incrementDisambig = function () {\n    //SNIP-START\n    if (this.debug) {\n        print(\"\\n[1] === incrementDisambig() ===\");\n    }\n    //SNIP-END\n    if (this.initGivens) {\n        this.initGivens = false;\n        return false;\n    }\n    var maxed = false;\n    var increment_names = true;\n    if (\"disNames\" === this.modes[this.modeindex]) {\n        // this.gnameset: the index pos of the current nameset\n        // this.gname: the index pos of the current name w/in the current nameset\n        \n        // Stages:\n        // - Increment givenname (optional)\n        // - Add a name (optional)\n        // - Move to next nameset\n\n        // Incrementing is done forward-only on this.base. Values\n        // that improve disambiguation results are copied to\n        // this.betterbase, which is used to set the disambig parameters\n        // in the processor registry.\n        \n\n        // Increment\n        // Max val is always true if a level is inactive.\n        increment_names = false;\n        if (\"number\" !== typeof this.givensMax) {\n            increment_names = true;\n        }\n        var increment_namesets = false;\n        if (\"number\" !== typeof this.namesMax) {\n            increment_namesets = true;\n        }\n        if (\"number\" === typeof this.givensMax) {\n            if (this.base.givens.length && this.base.givens[this.gnameset][this.gname] < this.givensMax) {\n                this.base.givens[this.gnameset][this.gname] += 1;\n            } else {\n                increment_names = true;\n            }\n        }\n        if (\"number\" === typeof this.namesMax \n            && increment_names) {\n            if (this.state.opt[\"disambiguate-add-names\"]) {\n                increment_namesets = false;\n                if (this.gname < this.namesMax) {\n                    this.base.names[this.gnameset] += 1;\n                    this.gname += 1;\n                } else {\n                    increment_namesets = true;\n                }\n            } else {\n                increment_namesets = true;\n            }\n        }\n        if (\"number\" === typeof this.namesetsMax && increment_namesets) {\n            if (this.gnameset < this.namesetsMax) {\n                this.gnameset += 1;\n                this.base.names[this.gnameset] = 1;\n                this.gname = 0;\n            }\n        }\n        //SNIP-START\n        if (this.debug) {\n            print(\"    ------------------\");\n            print(\"    incremented values\");\n            print(\"    ------------------\");\n            print(\"    | gnameset: \"+this.gnameset);\n            print(\"    | gname: \"+this.gname);\n            print(\"    | names value: \"+this.base.names[this.gnameset]);\n            if (this.base.givens.length) {\n                print(\"    | givens value: \"+this.base.givens[this.gnameset][this.gname]);\n            } else {\n                print(\"    | givens value: nil\");\n            }\n            print(\"    | namesetsMax: \"+this.namesetsMax);\n            print(\"    | namesMax: \"+this.namesMax);\n            print(\"    | givensMax: \"+this.givensMax);\n        }\n        //SNIP-END\n        if ((\"number\" !== typeof this.namesetsMax || this.namesetsMax === -1 || this.gnameset === this.namesetsMax)\n            && (!this.state.opt[\"disambiguate-add-names\"] || \"number\" !== typeof this.namesMax || this.gname === this.namesMax)\n            && (\"number\" != typeof this.givensMax || \"undefined\" === typeof this.base.givens[this.gnameset] || \"undefined\" === typeof this.base.givens[this.gnameset][this.gname] || this.base.givens[this.gnameset][this.gname] === this.givensMax)) {\n  \n\n            maxed = true;\n            //SNIP-START\n            if (this.debug) {\n                print(\"    MAXED\");\n            }\n            //SNIP-END\n        }\n    } else if (\"disExtraText\" === this.modes[this.modeindex]) {\n        this.base.disambiguate += 1;\n        this.betterbase.disambiguate += 1;\n    }\n    return maxed;\n};\n\nCSL.Disambiguation.prototype.initVars = function (akey) {\n    var i, ilen, myIds, myItemBundles, myItems;\n    //SNIP-START\n    if (this.debug) {\n        print(\"[B] === initVars() ===\");\n    }\n    //SNIP-END\n    this.lists = [];\n    this.base = false;\n    this.betterbase = false;\n    this.akey = akey;\n\n    this.maxNamesByItemId = {};\n\n\n    myItemBundles = [];\n    myIds = this.ambigcites[akey];\n    if (!myIds || !myIds.length) {\n        return false;\n    }\n    var myItem = this.state.refetchItem(\"\" + myIds[0]);\n    this.getCiteData(myItem);\n    this.base = CSL.getAmbigConfig.call(this.state);\n    if (myIds && myIds.length > 1) {\n        myItemBundles.push([this.maxNamesByItemId[myItem.id], myItem]);\n        // Build a composite list of Items and associated\n        // max names. This is messy, but it's the only\n        // way to get the items sorted by the number of names\n        // to be disambiguated. If they are in descending order\n        // with name expansions, the processor will hang.\n        for (var i = 1, ilen = myIds.length; i < ilen; i += 1) {\n            myItem = this.state.refetchItem(\"\" + myIds[i]);\n            this.getCiteData(myItem, this.base);\n            myItemBundles.push([this.maxNamesByItemId[myItem.id], myItem]);\n        }\n        myItemBundles.sort(\n            function (a, b) {\n                if (a[0] > b[0]) {\n                    return 1;\n                } else if (a[0] < b[0]) {\n                    return -1;\n                } else {\n                    if (a[1].id > b[1].id) {\n                        return 1;\n                    } else if (a[1].id < b[1].id) {\n                        return -1;\n                    } else {\n                        return 0;\n                    }\n                }\n            }\n        );\n        myItems = [];\n        for (var i = 0, ilen = myItemBundles.length; i < ilen; i += 1) {\n            myItems.push(myItemBundles[i][1]);\n        }\n        this.lists.push([this.base, myItems]);\n        this.Item = this.lists[0][1][0];\n    } else {\n        this.Item = this.state.refetchItem(\"\" + myIds[0]);\n    }\n\n    this.modeindex = 0;\n    if (this.state.citation.opt[\"disambiguate-add-names\"] || true) {\n        this.namesMax = this.maxNamesByItemId[this.Item.id][0];\n    } else {\n        var namesMax = this.base.names[0];\n        for (var i=1,ilen=this.base.names.length;i<ilen;i+=1){\n            namesMax = Math.max(namesMax,this.base.names.names[i]);\n        }\n    }\n\n\n    this.padBase(this.base);\n    this.padBase(this.betterbase);\n    this.base.year_suffix = false;\n    this.base.disambiguate = false;\n    this.betterbase.year_suffix = false;\n    this.betterbase.disambiguate = false;\n    if (this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\"\n       && this.state.opt[\"disambiguate-add-givenname\"]) {\n        this.givensMax = 2;\n    }\n    return true;\n};\n\n\nCSL.Disambiguation.prototype.padBase = function (base) {\n    for (var i = 0, ilen = base.names.length; i < ilen; i += 1) {\n        if (!base.givens[i]) {\n            base.givens[i] = [];\n        }\n        for (var j=0,jlen=base.names[i];j<jlen;j+=1) {\n            if (!base.givens[i][j]) {\n                base.givens[i][j] = 0;\n            }\n        }\n    }\n};\n\n/**\n * Set available modes for disambiguation\n */\nCSL.Disambiguation.prototype.configModes = function () {\n    var dagopt, gdropt;\n    // Modes are function names prototyped to this instance.\n    this.modes = [];\n    dagopt = this.state.opt[\"disambiguate-add-givenname\"];\n    gdropt = this.state.citation.opt[\"givenname-disambiguation-rule\"];\n    if (this.state.opt['disambiguate-add-names'] || (dagopt && gdropt === \"by-cite\")) {\n        this.modes.push(\"disNames\");\n    }\n\n    if (this.state.opt.development_extensions.prioritize_disambiguate_condition) {\n        if (this.state.opt.has_disambiguate) {\n            this.modes.push(\"disExtraText\");\n        }\n        if (this.state.opt[\"disambiguate-add-year-suffix\"]) {\n            this.modes.push(\"disYears\");\n        }\n    } else {\n        if (this.state.opt[\"disambiguate-add-year-suffix\"]) {\n            this.modes.push(\"disYears\");\n        }\n        if (this.state.opt.has_disambiguate) {\n            this.modes.push(\"disExtraText\");\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.getCiteData = function(Item, base) {\n    // Initialize base if first set item seen\n    if (!this.maxNamesByItemId[Item.id]) {\n        CSL.getAmbiguousCite.call(this.state, Item, base);\n        base = CSL.getAmbigConfig.call(this.state);\n        this.maxNamesByItemId[Item.id] = CSL.getMaxVals.call(this.state);\n        this.state.registry.registry[Item.id].disambig.givens = this.state.tmp.disambig_settings.givens.slice();\n        // Slice the nested lists as well. Without this, disambiguate_YearSuffixFiftyTwoEntriesByCite fails.\n        for (var i=0,ilen=this.state.registry.registry[Item.id].disambig.givens.length;i<ilen;i+=1) {\n            this.state.registry.registry[Item.id].disambig.givens[i] = this.state.tmp.disambig_settings.givens[i].slice();\n        }\n        this.namesetsMax = this.state.registry.registry[Item.id].disambig.names.length - 1;\n        if (!this.base) {\n            this.base = base;\n            this.betterbase = CSL.cloneAmbigConfig(base);\n        }\n        if (base.names.length < this.base.names.length) {\n            // I don't know what would happen with discrepancies in the number\n            // of namesets rendered on items, so we use the fewer of the two\n            // and limit the other to that size.\n            this.base = base;\n        }\n        // Padding. Within namesets, we use the longer of the two throughout.\n        for (var i = 0, ilen = base.names.length; i < ilen; i += 1) {\n            if (base.names[i] > this.base.names[i]) {\n                // XXX The old must have been wrong surely. The new, I'm not sure.\n                //this.base.givens[i] = this.base.givens[i].concat(this.base.givens[i].slice(this.base.names[i]));\n                this.base.givens[i] = base.givens[i].slice();\n                this.base.names[i] = base.names[i];\n                this.betterbase.names = this.base.names.slice();\n                this.betterbase.givens = this.base.givens.slice();\n                this.padBase(this.base);\n                this.padBase(this.betterbase);\n            }\n        }\n        // This shouldn't be necessary\n        // getAmbiguousCite() should return a valid and complete\n        // givens segment under all conditions, but it does not\n        // do so for institution authors, so we clean up after it\n        // here.\n        // Relevant test: sort_ChicagoYearSuffix2\n        this.betterbase.givens = this.base.givens.slice();\n        for (var j = 0, jlen = this.base.givens.length; j < jlen; j += 1) {\n            this.betterbase.givens[j] = this.base.givens[j].slice();\n        }\n    }\n};\n\nCSL.Disambiguation.prototype.captureStepToBase = function() {\n    // Be paranoid about the presence of givens\n    if (this.state.citation.opt[\"givenname-disambiguation-rule\"] === \"by-cite\"\n        && this.base.givens && this.base.givens.length) {\n        if (\"undefined\" !== typeof this.base.givens[this.gnameset][this.gname]) {\n            if (this.betterbase.givens.length < this.base.givens.length) {\n                this.betterbase.givens = JSON.parse(JSON.stringify(this.base.givens));\n            }\n            this.betterbase.givens[this.gnameset][this.gname] = this.base.givens[this.gnameset][this.gname];\n        }\n    }\n    this.betterbase.names[this.gnameset] = this.base.names[this.gnameset];\n};\n\nCSL.Engine.prototype.getJurisdictionList = function (jurisdiction) {\n    var jurisdictionList = [];\n    var jurisdictionElems = jurisdiction.split(\":\");\n    for (var j=jurisdictionElems.length;j>0;j--) {\n        var composedID = jurisdictionElems.slice(0,j).join(\":\");\n        jurisdictionList.push(composedID);\n        if (this.opt.jurisdiction_fallbacks[composedID]) {\n            var fallback = this.opt.jurisdiction_fallbacks[composedID];\n            jurisdictionList.push(fallback);\n        }\n    }\n    if (jurisdictionList.indexOf(\"us\") === -1) {\n        jurisdictionList.push(\"us\");\n    }\n    return jurisdictionList;\n};\n\nCSL.Engine.prototype.loadStyleModule = function (jurisdiction, xmlSource, skipFallback) {\n    var myFallback = null;\n    var macroCount = 0;\n    this.juris[jurisdiction] = {};\n    var myXml = CSL.setupXml(xmlSource);\n    myXml.addMissingNameNodes(myXml.dataObj);\n    myXml.addInstitutionNodes(myXml.dataObj);\n    myXml.insertPublisherAndPlace(myXml.dataObj);\n    myXml.flagDateMacros(myXml.dataObj);\n    var myNodes = myXml.getNodesByName(myXml.dataObj, \"law-module\");\n    for (var i=0,ilen=myNodes.length;i<ilen;i++) {\n        var myTypes = myXml.getAttributeValue(myNodes[i],\"types\");\n        if (myTypes) {\n            this.juris[jurisdiction].types = {};\n            myTypes =  myTypes.split(/\\s+/);\n            for (var j=0,jlen=myTypes.length;j<jlen;j++) {\n                this.juris[jurisdiction].types[myTypes[j]] = true;\n            }\n        }\n        if (!skipFallback) {\n            myFallback = myXml.getAttributeValue(myNodes[i],\"fallback\");\n            if (myFallback) {\n                if (jurisdiction !== \"us\") {\n                    this.opt.jurisdiction_fallbacks[jurisdiction] = myFallback;\n                }\n            }\n        }\n    }\n    var lang = this.opt.lang ? this.opt.lang : this.opt[\"default-locale\"][0];\n    CSL.SET_COURT_CLASSES(this, lang, myXml, myXml.dataObj);\n    \n    if (!this.juris[jurisdiction].types) {\n        this.juris[jurisdiction].types = CSL.MODULE_TYPES;\n    }\n    var myNodes = myXml.getNodesByName(myXml.dataObj, \"macro\");\n    for (var i=0,ilen=myNodes.length;i<ilen;i++) {\n        var myName = myXml.getAttributeValue(myNodes[i], \"name\");\n        if (!CSL.MODULE_MACROS[myName]) {\n            CSL.debug(\"CSL: skipping non-modular macro name \\\"\" + myName + \"\\\" in module context\");\n            continue;\n        }\n        macroCount++;\n        this.juris[jurisdiction][myName] = [];\n        // Must use the same XML parser for style and modules.\n        this.buildTokenLists(myNodes[i], this.juris[jurisdiction][myName]);\n        this.configureTokenList(this.juris[jurisdiction][myName]);\n    }\n    //if (macroCount < Object.keys(CSL.MODULE_MACROS).length) {\n    //    var missing = [];\n    //    throw \"CSL ERROR: Incomplete jurisdiction style module for: \" + jurisdiction;\n    //}\n    return myFallback;\n};\n\nCSL.Engine.prototype.retrieveAllStyleModules = function (jurisdictionList) {\n    var ret = {};\n    var preferences = this.locale[this.opt.lang].opts[\"jurisdiction-preference\"];\n    preferences = preferences ? preferences : [];\n    preferences = [\"\"].concat(preferences);\n    for (var i=preferences.length-1;i>-1;i--) {\n        var preference = preferences[i];\n        for (var j=0,jlen=jurisdictionList.length;j<jlen;j++) {\n            var jurisdiction = jurisdictionList[j];\n            // If we've \"seen\" it, we have it already, or we're not going to get it.\n            if (this.opt.jurisdictions_seen[jurisdiction]) {\n                continue;\n            }\n            // Try to get the module\n            var res = this.sys.retrieveStyleModule(jurisdiction, preference);\n            // If we fail and we've run out of preferences, mark as \"seen\"\n            // Otherwise mark as \"seen\" if we get something.\n            if ((!res && !preference) || res) {\n                this.opt.jurisdictions_seen[jurisdiction] = true;\n            }\n            // Don't memo unless get got style code.\n            if (!res) {\n                continue;\n            }\n            ret[jurisdiction] = res;\n        }\n    }\n    // Give 'em what we got.\n    return ret;\n};\n\nCSL.ParticleList = (function() {\n\tvar always_dropping_1 = [[[0,1], null]];\n\tvar always_dropping_3 = [[[0,3], null]];\n\tvar always_non_dropping_1 = [[null, [0,1]]];\n\tvar always_non_dropping_2 = [[null, [0,2]]];\n\tvar always_non_dropping_3 = [[null, [0,3]]];\n\tvar either_1 = [[null, [0,1]],[[0,1],null]];\n\tvar either_2 = [[null, [0,2]],[[0,2],null]];\n\tvar either_1_dropping_best = [[[0,1],null],[null, [0,1]]];\n\tvar either_2_dropping_best = [[[0,2],null],[null, [0,2]]];\n\tvar either_3_dropping_best = [[[0,3],null],[null, [0,3]]];\n\tvar non_dropping_2_alt_dropping_1_non_dropping_1 = [[null, [0,2]], [[0,1], [1,2]]];\n\tvar PARTICLES = [\n\t\t[\"'s\", always_non_dropping_1],\n\t\t[\"'s-\", always_non_dropping_1],\n\t\t[\"'t\", always_non_dropping_1],\n\t\t[\"a\", \talways_non_dropping_1],\n\t\t[\"aan 't\", always_non_dropping_2],\n\t\t[\"aan de\", always_non_dropping_2],\n\t\t[\"aan den\", always_non_dropping_2],\n\t\t[\"aan der\", always_non_dropping_2],\n\t\t[\"aan het\", always_non_dropping_2],\n\t\t[\"aan t\", always_non_dropping_2],\n\t\t[\"aan\", always_non_dropping_1],\n\t\t[\"ad-\", either_1],\n\t\t[\"adh-\", either_1],\n\t\t[\"af\", either_1],\n\t\t[\"al\", either_1],\n\t\t[\"al-\", either_1],\n\t\t[\"am de\", always_non_dropping_2],\n\t\t[\"am\", always_non_dropping_1],\n\t\t[\"an-\", either_1],\n\t\t[\"ar-\", either_1],\n\t\t[\"as-\", either_1],\n\t\t[\"ash-\", either_1],\n\t\t[\"at-\", either_1],\n\t\t[\"ath-\", either_1],\n\t\t[\"auf dem\", either_2_dropping_best],\n\t\t[\"auf den\", either_2_dropping_best],\n\t\t[\"auf der\", either_2_dropping_best],\n\t\t[\"auf ter\", always_non_dropping_2],\n\t\t[\"auf\", either_1_dropping_best],\n\t\t[\"aus 'm\", either_2_dropping_best],\n\t\t[\"aus dem\", either_2_dropping_best],\n\t\t[\"aus den\", either_2_dropping_best],\n\t\t[\"aus der\", either_2_dropping_best],\n\t\t[\"aus m\", either_2_dropping_best],\n\t\t[\"aus\", either_1_dropping_best],\n\t\t[\"aus'm\", either_2_dropping_best],\n\t\t[\"az-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"a-\", either_1],\n\t\t[\"ben\", always_non_dropping_1],\n\t\t[\"bij 't\", always_non_dropping_2],\n\t\t[\"bij de\", always_non_dropping_2],\n\t\t[\"bij den\", always_non_dropping_2],\n\t\t[\"bij het\", always_non_dropping_2],\n\t\t[\"bij t\", always_non_dropping_2],\n\t\t[\"bij\", always_non_dropping_1],\n\t\t[\"bin\", always_non_dropping_1],\n\t\t[\"boven d\", always_non_dropping_2],\n\t\t[\"boven d'\", always_non_dropping_2],\n\t\t[\"d\", always_non_dropping_1],\n\t\t[\"d'\", either_1],\n\t\t[\"da\", either_1],\n\t\t[\"dal\", always_non_dropping_1],\n\t\t[\"dal'\", always_non_dropping_1],\n\t\t[\"dall'\", always_non_dropping_1],\n\t\t[\"dalla\", always_non_dropping_1],\n\t\t[\"das\", either_1],\n\t\t[\"de die le\", always_non_dropping_3],\n\t\t[\"de die\", always_non_dropping_2],\n\t\t[\"de l\", always_non_dropping_2],\n\t\t[\"de l'\", always_non_dropping_2],\n\t\t[\"de la\", non_dropping_2_alt_dropping_1_non_dropping_1],\n\t\t[\"de las\", non_dropping_2_alt_dropping_1_non_dropping_1],\n\t\t[\"de le\", always_non_dropping_2],\n\t\t[\"de li\", either_2],\n\t\t[\"de van der\", always_non_dropping_3],\n\t\t[\"de\", either_1],\n\t\t[\"de'\", either_1],\n\t\t[\"deca\", always_non_dropping_1],\n\t\t[\"degli\", either_1],\n\t\t[\"dei\", either_1],\n\t\t[\"del\", either_1],\n\t\t[\"dela\", always_dropping_1],\n\t\t[\"dell'\", either_1],\n\t\t[\"della\", either_1],\n\t\t[\"delle\", either_1],\n\t\t[\"dello\", either_1],\n\t\t[\"den\", either_1],\n\t\t[\"der\", either_1],\n\t\t[\"des\", either_1],\n\t\t[\"di\", either_1],\n\t\t[\"die le\", always_non_dropping_2],\n\t\t[\"do\", always_non_dropping_1],\n\t\t[\"don\", always_non_dropping_1],\n\t\t[\"dos\", either_1],\n\t\t[\"du\", either_1],\n\t\t[\"ed-\", either_1],\n\t\t[\"edh-\", either_1],\n\t\t[\"el\", either_1],\n\t\t[\"el-\", either_1],\n\t\t[\"en-\", either_1],\n\t\t[\"er-\", either_1],\n\t\t[\"es-\", either_1],\n\t\t[\"esh-\", either_1],\n\t\t[\"et-\", either_1],\n\t\t[\"eth-\", either_1],\n\t\t[\"ez-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"e-\", either_1],\n\t\t[\"het\", always_non_dropping_1],\n\t\t[\"i\", always_non_dropping_1],\n\t\t[\"il\", always_dropping_1],\n\t\t[\"im\", always_non_dropping_1],\n\t\t[\"in 't\", always_non_dropping_2],\n\t\t[\"in de\", always_non_dropping_2],\n\t\t[\"in den\", always_non_dropping_2],\n\t\t[\"in der\", either_2],\n\t\t[\"in het\", always_non_dropping_2],\n\t\t[\"in t\", always_non_dropping_2],\n\t\t[\"in\", always_non_dropping_1],\n\t\t[\"l\", always_non_dropping_1],\n\t\t[\"l'\", always_non_dropping_1],\n\t\t[\"la\", always_non_dropping_1],\n\t\t[\"las\", always_non_dropping_1],\n\t\t[\"le\", always_non_dropping_1],\n\t\t[\"les\", either_1],\n\t\t[\"lo\", either_1],\n\t\t[\"los\", always_non_dropping_1],\n\t\t[\"lou\", always_non_dropping_1],\n\t\t[\"of\", always_non_dropping_1],\n\t\t[\"onder 't\", always_non_dropping_2],\n\t\t[\"onder de\", always_non_dropping_2],\n\t\t[\"onder den\", always_non_dropping_2],\n\t\t[\"onder het\", always_non_dropping_2],\n\t\t[\"onder t\", always_non_dropping_2],\n\t\t[\"onder\", always_non_dropping_1],\n\t\t[\"op 't\", always_non_dropping_2],\n\t\t[\"op de\", either_2],\n\t\t[\"op den\", always_non_dropping_2],\n\t\t[\"op der\", always_non_dropping_2],\n\t\t[\"op gen\", always_non_dropping_2],\n\t\t[\"op het\", always_non_dropping_2],\n\t\t[\"op t\", always_non_dropping_2],\n\t\t[\"op ten\", always_non_dropping_2],\n\t\t[\"op\", always_non_dropping_1],\n\t\t[\"over 't\", always_non_dropping_2],\n\t\t[\"over de\", always_non_dropping_2],\n\t\t[\"over den\", always_non_dropping_2],\n\t\t[\"over het\", always_non_dropping_2],\n\t\t[\"over t\", always_non_dropping_2],\n\t\t[\"over\", always_non_dropping_1],\n\t\t[\"s\", always_non_dropping_1],\n\t\t[\"s'\", always_non_dropping_1],\n\t\t[\"sen\", always_dropping_1],\n\t\t[\"t\", always_non_dropping_1],\n\t\t[\"te\", always_non_dropping_1],\n\t\t[\"ten\", always_non_dropping_1],\n\t\t[\"ter\", always_non_dropping_1],\n\t\t[\"tho\", always_non_dropping_1],\n\t\t[\"thoe\", always_non_dropping_1],\n\t\t[\"thor\", always_non_dropping_1],\n\t\t[\"to\", always_non_dropping_1],\n\t\t[\"toe\", always_non_dropping_1],\n\t\t[\"tot\", always_non_dropping_1],\n\t\t[\"uijt 't\", always_non_dropping_2],\n\t\t[\"uijt de\", always_non_dropping_2],\n\t\t[\"uijt den\", always_non_dropping_2],\n\t\t[\"uijt te de\", always_non_dropping_3],\n\t\t[\"uijt ten\", always_non_dropping_2],\n\t\t[\"uijt\", always_non_dropping_1],\n\t\t[\"uit 't\", always_non_dropping_2],\n\t\t[\"uit de\", always_non_dropping_2],\n\t\t[\"uit den\", always_non_dropping_2],\n\t\t[\"uit het\", always_non_dropping_2],\n\t\t[\"uit t\", always_non_dropping_2],\n\t\t[\"uit te de\", always_non_dropping_3],\n\t\t[\"uit ten\", always_non_dropping_2],\n\t\t[\"uit\", always_non_dropping_1],\n\t\t[\"unter\", always_non_dropping_1],\n\t\t[\"v\", always_non_dropping_1],\n\t\t[\"v.\", always_non_dropping_1],\n\t\t[\"v.d.\", always_non_dropping_1],\n\t\t[\"van 't\", always_non_dropping_2],\n\t\t[\"van de l\", always_non_dropping_3],\n\t\t[\"van de l'\", always_non_dropping_3],\n\t\t[\"van de\", always_non_dropping_2],\n\t\t[\"van de\", always_non_dropping_2],\n\t\t[\"van den\", always_non_dropping_2],\n\t\t[\"van der\", always_non_dropping_2],\n\t\t[\"van gen\", always_non_dropping_2],\n\t\t[\"van het\", always_non_dropping_2],\n\t\t[\"van la\", always_non_dropping_2],\n\t\t[\"van t\", always_non_dropping_2],\n\t\t[\"van ter\", always_non_dropping_2],\n\t\t[\"van van de\", always_non_dropping_3],\n\t\t[\"van\", either_1],\n\t\t[\"vander\", always_non_dropping_1],\n\t\t[\"vd\", always_non_dropping_1],\n\t\t[\"ver\", always_non_dropping_1],\n\t\t[\"vom und zum\", always_dropping_3],\n\t\t[\"vom\", either_1],\n\t\t[\"von 't\", always_non_dropping_2],\n\t\t[\"von dem\", either_2_dropping_best],\n\t\t[\"von den\", either_2_dropping_best],\n\t\t[\"von der\", either_2_dropping_best],\n\t\t[\"von t\", always_non_dropping_2],\n\t\t[\"von und zu\", either_3_dropping_best],\n\t\t[\"von zu\", either_2_dropping_best],\n\t\t[\"von\", either_1_dropping_best],\n\t\t[\"voor 't\", always_non_dropping_2],\n\t\t[\"voor de\", always_non_dropping_2],\n\t\t[\"voor den\", always_non_dropping_2],\n\t\t[\"voor in 't\", always_non_dropping_3],\n\t\t[\"voor in t\", always_non_dropping_3],\n\t\t[\"voor\", always_non_dropping_1],\n\t\t[\"vor der\", either_2_dropping_best],\n\t\t[\"vor\", either_1_dropping_best],\n\t\t[\"z\", always_dropping_1],\n\t\t[\"ze\", always_dropping_1],\n\t\t[\"zu\", either_1_dropping_best],\n\t\t[\"zum\", either_1],\n\t\t[\"zur\", either_1]\n\t];\n    return PARTICLES;\n}());\n\nCSL.parseParticles = (function(){\n    function splitParticles(nameValue, firstNameFlag, caseOverride) {\n\t\t// Parse particles out from name fields.\n\t\t// * nameValue (string) is the field content to be parsed.\n\t\t// * firstNameFlag (boolean) parse trailing particles\n\t\t//\t (default is to parse leading particles)\n\t\t// * caseOverride (boolean) include all but one word in particle set\n\t\t//\t (default is to include only words with lowercase first char)\n        //   [caseOverride is not used in this application]\n\t\t// Returns an array with:\n\t\t// * (boolean) flag indicating whether a particle was found\n\t\t// * (string) the name after removal of particles\n\t\t// * (array) the list of particles found\n\t\tvar origNameValue = nameValue;\n\t\tnameValue = caseOverride ? nameValue.toLowerCase() : nameValue;\n\t\tvar particleList = [];\n\t\tvar rex;\n        var hasParticle;\n\t\tif (firstNameFlag) {\n\t\t\tnameValue = nameValue.split(\"\").reverse().join(\"\");\n\t\t\trex = CSL.PARTICLE_GIVEN_REGEXP;\n\t\t} else {\n\t\t\trex = CSL.PARTICLE_FAMILY_REGEXP;\n\t\t}\n\t\tvar m = nameValue.match(rex);\n\t\twhile (m) {\n\t\t\tvar m1 = firstNameFlag ? m[1].split(\"\").reverse().join(\"\") : m[1];\n\t\t\tvar firstChar = m ? m1 : false;\n\t\t\tvar firstChar = firstChar ? m1.replace(/^[-\\'\\u02bb\\u2019\\s]*(.).*$/, \"$1\") : false;\n\t\t\thasParticle = firstChar ? firstChar.toUpperCase() !== firstChar : false;\n\t\t\tif (!hasParticle) {\n                break;\n            }\n\t\t\tif (firstNameFlag) {\n\t\t\t\tparticleList.push(origNameValue.slice(m1.length * -1));\n\t\t\t\torigNameValue = origNameValue.slice(0,m1.length * -1);\n\t\t\t} else {\n\t\t\t\tparticleList.push(origNameValue.slice(0,m1.length));\n\t\t\t\torigNameValue = origNameValue.slice(m1.length);\n\t\t\t}\n\t\t\t//particleList.push(m1);\n\t\t\tnameValue = m[2];\n\t\t\tm = nameValue.match(rex);\n\t\t}\n\t\tif (firstNameFlag) {\n\t\t\tnameValue = nameValue.split(\"\").reverse().join(\"\");\n\t\t\tparticleList.reverse();\n\t\t\tfor (var i=1,ilen=particleList.length;i<ilen;i++) {\n\t\t\t\tif (particleList[i].slice(0, 1) == \" \") {\n\t\t\t\t\tparticleList[i-1] += \" \";\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i=0,ilen=particleList.length;i<ilen;i++) {\n\t\t\t\tif (particleList[i].slice(0, 1) == \" \") {\n\t\t\t\t\tparticleList[i] = particleList[i].slice(1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tnameValue = origNameValue.slice(0, nameValue.length);\n\t\t} else {\n\t\t\tnameValue = origNameValue.slice(nameValue.length * -1);\n\t\t}\n\t\treturn [hasParticle, nameValue, particleList];\n\t}\n    function trimLast(str) {\n        var lastChar = str.slice(-1);\n        str = str.trim();\n        if (lastChar === \" \" && [\"\\'\", \"\\u2019\"].indexOf(str.slice(-1)) > -1) {\n            str += \" \";\n        }\n        return str;\n    }\n    function parseSuffix(nameObj) {\n        if (!nameObj.suffix && nameObj.given) {\n            var m = nameObj.given.match(/(\\s*,!*\\s*)/);\n            if (m) {\n                var idx = nameObj.given.indexOf(m[1]);\n                var possible_suffix = nameObj.given.slice(idx + m[1].length);\n                var possible_comma = nameObj.given.slice(idx, idx + m[1].length).replace(/\\s*/g, \"\");\n                if (possible_suffix.replace(/\\./g, \"\") === 'et al' && !nameObj[\"dropping-particle\"]) {\n                    // This hack covers the case where \"et al.\" is explicitly used in the\n                    // authorship information of the work.\n                    nameObj[\"dropping-particle\"] = possible_suffix;\n                    nameObj[\"comma-dropping-particle\"] = \",\";\n                } else {\n                    if (possible_comma.length === 2) {\n                        nameObj[\"comma-suffix\"] = true;\n                    }\n                    nameObj.suffix = possible_suffix;\n                }\n                nameObj.given = nameObj.given.slice(0, idx);\n            }\n        }\n    }\n    return function(nameObj) {\n        // Extract and set non-dropping particle(s) from family name field\n        var res = splitParticles(nameObj.family);\n        var lastNameValue = res[1];\n        var lastParticleList = res[2];\n        nameObj.family = lastNameValue;\n        var nonDroppingParticle = trimLast(lastParticleList.join(\"\"));\n        if (nonDroppingParticle) {\n            nameObj['non-dropping-particle'] = nonDroppingParticle;\n        }\n        // Split off suffix first of all\n        parseSuffix(nameObj);\n        // Extract and set dropping particle(s) from given name field\n        var res = splitParticles(nameObj.given, true);\n        var firstNameValue = res[1];\n        var firstParticleList = res[2];\n        nameObj.given = firstNameValue;\n        var droppingParticle = firstParticleList.join(\"\").trim();\n        if (droppingParticle) {\n            nameObj['dropping-particle'] = droppingParticle;\n        }\n    };\n}());\n\n\nmodule.exports = CSL"],"names":["splits","always_dropping_1","always_non_dropping_1","always_non_dropping_2","always_non_dropping_3","either_1","either_2","either_1_dropping_best","either_2_dropping_best","non_dropping_2_alt_dropping_1_non_dropping_1","CSL","PROCESSOR_VERSION","error","str","Error","debug","console","dump","log","toLocaleUpperCase","arr","this","tmp","lang_array","e","toUpperCase","toLocaleLowerCase","toLowerCase","LOCATOR_LABELS_REGEXP","RegExp","STATUTE_SUBDIV_PLAIN_REGEX","STATUTE_SUBDIV_PLAIN_REGEX_FRONT","STATUTE_SUBDIV_STRINGS","STATUTE_SUBDIV_STRINGS_REVERSE","LOCATOR_LABELS_MAP","MODULE_MACROS","MODULE_TYPES","checkNestedBrace","state","opt","xclass","depth","update","lst","split","i","ilen","length","join","MULTI_FIELDS","LangPrefsMap","AbbreviationSegments","nickname","number","title","place","hereinafter","classic","getAbbrevsDomain","country","lang","domain","availableAbbrevDomains","globalDomainPreference","locale","opts","itemDomainPreference","j","indexOf","FIELD_CATEGORY_REMAP","parseLocator","item","development_extensions","locator_date_and_revision","locator","idx","raw_locator","slice","m","match","fun","dateparser","parseDateToObject","replace","normalizeLocaleStr","parseNoteFieldHacks","Item","validFieldsForType","allowDateOverride","note","elems","lines","line","NOTE_FIELDS_REGEXP","splt","jlen","push","trim","NOTE_FIELD_REGEXP","offset","names","mm","key","val","type","DATE_VARIABLES","DateParser","parseDateToArray","isDateString","NAME_VARIABLES","literal","name","family","given","parseParticles","concat","checkPrefixSpaceAppend","prefix","sp","test_prefix","test_char","ENDSWITH_ROMANESQUE_REGEXP","TERMINAL_PUNCTUATION","checkIgnorePredecessor","term_predecessor","checkSuffixSpacePrepend","suffix","STARTSWITH_ROMANESQUE_REGEXP","GENDERS","ERROR_NO_RENDERED_FORM","PREVIEW","ASSUME_ALL_ITEMS_REGISTERED","START","END","SINGLETON","SEEN","SUCCESSOR","SUCCESSOR_OF_SUCCESSOR","SUPPRESS","SINGULAR","PLURAL","LITERAL","BEFORE","AFTER","DESCENDING","ASCENDING","PRIMARY","SECONDARY","POSITION_FIRST","POSITION_SUBSEQUENT","POSITION_IBID","POSITION_IBID_WITH_LOCATOR","POSITION_CONTAINER_SUBSEQUENT","POSITION_MAP","POSITION_TEST_VARS","AREAS","CITE_FIELDS","SWAPPING_PUNCTUATION","NONE","NUMERIC","POSITION","TRIGRAPH","DATE_PARTS","DATE_PARTS_ALL","DATE_PARTS_INTERNAL","NAME_PARTS","DISAMBIGUATE_OPTIONS","GIVENNAME_DISAMBIGUATION_RULES","NAME_ATTRIBUTES","LOOSE","STRICT","TOLERANT","PREFIX_PUNCTUATION","SUFFIX_PUNCTUATION","NUMBER_REGEXP","NAME_INITIAL_REGEXP","ROMANESQUE_REGEXP","ROMANESQUE_NOT_REGEXP","ALL_ROMANESQUE_REGEXP","VIETNAMESE_SPECIALS","VIETNAMESE_NAMES","PARTICLE_GIVEN_REGEXP","PARTICLE_FAMILY_REGEXP","DISPLAY_CLASSES","CREATORS","NUMERIC_VARIABLES","VARIABLES_WITH_SHORT_FORM","TITLE_FIELD_SPLITS","seg","keys","ret","demoteNoiseWords","fld","drop_or_demote","SKIP_WORDS","reverse","toEnd","pop","start","end","extractTitleAndSubtitle","narrowSpaceLocale","narrowSpace","segments","split_container_title","langs","multi","_keys","short","vals","main","sub","shortTitle","subjoin","tail","top","TITLE_SPLIT_REGEXP","matchfirst","exec","force_short_title_casing_alignment","splitTitle","TITLE_SPLIT","implicit_short_title","punct","titlecaseSentenceOrNormal","sentenceCase","mainTitle","subJoin","subTitle","Output","Formatters","sentence","uppercase_subtitles","getSafeEscape","area","callbacks","thin_non_breaking_space_html_hack","mode","txt","Formats","text_escape","FORMAT_KEY_SEQUENCE","INSTITUTION_KEYS","SUFFIX_CHARS","ROMAN_NUMERALS","LANGS","LANG_BASES","af","ar","bg","ca","cs","da","de","el","en","es","et","eu","fa","fi","fr","he","hr","hu","is","it","ja","km","ko","lt","lv","mn","nb","nl","nn","pl","pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh","SUPERSCRIPTS","SUPERSCRIPTS_REGEXP","UPDATE_GROUP_CONTEXT_CONDITION","valueTerm","token","value","use_context_condition","flags","group_context","tip","condition","termtxt","value_seen","test","just_did_number","decorations","filter","o","strings","EVALUATE_GROUP_CONDITION","testres","numbersOnly","locale_term","termStartAlpha","require_comma_on_symbol","force_suppress","not","SYS_OPTIONS","GET_COURT_CLASS","sortKey","cls","authority","jurisdiction","classType","SET_COURT_CLASSES","myxml","dataObj","nodes","getNodesByName","pos","len","numberofnodes","courtclass","attributes","courts","registry","INIT_JURISDICTION_MACROS","macroName","sys","retrieveStyleModule","jurisdictionList","getJurisdictionList","jurisdictions_seen","res","retrieveAllStyleModules","fallback","loadStyleModule","Object","assign","parallel","enable","Parallel","juris","types","XmlJSON","institution","attrs","children","prototype","clean","json","getStyleId","myjson","styleName","tagName","grandkids","nodename","attrname","content","namespace","getAttributeValue","getNodeValue","setAttributeOnNodeIdentifiedByNameAttribute","partname","deleteNodeByNameAttribute","deleteAttribute","setAttribute","attr","nodeCopy","clone","nameattrval","nodeNameIs","makeXml","jsonStringWalker","walkToObject","JSON","parse","insertChildNodeAfter","parent","node","datejson","insertPublisherAndPlace","useme","mustHaves","haveVarname","variable","isChildOfSubstitute","parents","myparents","addMissingNameNodes","addName","addInstitutionNodes","insertPos","delimiter","and","k","klen","flagDateMacros","inspectDateMacros","stripXmlProcessingInstruction","xml","parseXml","_obj","_stack","_decodeHtmlEntities","numStr","num","parseInt","String","fromCharCode","_getAttribute","elem","rex","_getTagName","_castObjectFromOpeningTag","obj","_getAttributes","_extractTextFromCompositeElement","_appendToChildren","processElement","_extendStackWithNewChildren","stylePos","stub","_listifyString","XmlDOM","DOMParser","parseFromString","contentType","xmldata","ActiveXObject","async","loadXML","XMLHttpRequest","open","encodeURIComponent","overrideMimeType","send","responseXML","marknote","Parser","hasAttributes","importNode","doc","srcElement","_importNode","allChildren","nodeType","newNode","createElement","nodeName","il","getAttribute","childNodes","appendChild","parser","inst_doc","inst_node","getElementsByTagName","inst_part_node","institutionpart","ns","text","textContent","innerText","innerHTML","getAttributeName","firstChild","TEXT_NODE","removeChild","removeAttribute","ownerDocument","cloneNode","datexml","replaceChild","group","skippers","twovars","child","subskippers","parentNode","nameslist","namelist","thenames","theinstitution","theinstitutionpart","thename","insertBefore","nextSibling","attrval","nameparts","thenode","setupXml","xmlObject","toXMLString","XmlE4X","getSortCompare","default_locale","stringCompare","strcmp","me","strcmp_opts","sensitivity","ignorePunctuation","numeric","stripPunct","bracketPreSort","a","b","call","localeCompare","ambigConfigDiff","ppos","llen","givens","disambiguate","year_suffix","cloneAmbigConfig","config","oldconfig","param","getAmbigConfig","disambig_request","disambig_settings","getMaxVals","names_max","mystack","getMinVal","tokenExec","next","maybenext","result","jump","succeed","fail","execs","expandMacro","macro_key_token","target","mkey","macro_nodes","end_of_macro","postponed_macro","sort_direction","Token","hasDate","macroid","cslXml","build","current_default_locale","func","extension","macro_stack","cslid","update_mode","Node","macro_name","mytarget","getMacroTarget","buildMacro","configureMacro","macros","text_node","root","tokens","makeBuilder","builder","configureTokenList","XmlToToken","tokentype","explicitTarget","var_stack","skip","setDecorations","hasOwnProperty","Attributes","variables","hasVariable","epochPairs","epochYearByName","epochMatchStrings","epochMap","pair","epochMatchString","epochSplitter","epochMatcher","kanjiMonthDay","kanjiYear","kanjiRange","rexString","rexDash","rexDashSlash","rexSlashDash","monthStrings","setOrderDayMonth","monthGuess","dayGuess","setOrderMonthDay","resetDateParserMonths","monthSets","monthAbbrevs","monthRexes","addDateParserMonths","abbrevLength","insert","extendedSets","jKey","kKey","monthRexStrs","convertDateObjectToArray","thedate","part","slicelen","convertDateObjectToString","_parseNumericDate","delim","suff","month","day","orig","slashPos","dashPos","yearIsNegative","slst","mmx","mmpos","rangeDelim","dateDelim","delimPos","delims","isRange","date","outer","element","circa","year","parts","parseDateToString","Engine","style","forceLang","langspec","processor_version","csl_version","defineProperty","TypeError","to","index","arguments","nextSource","nextKey","writable","configurable","variableWrapper","VARIABLE_WRAPPER_PREPUNCT_REX","getAbbreviation","transform","Transform","setParseNames","Opt","Tmp","Build","Fun","configure","Configure","citation_sort","CitationSort","bibliography_sort","BibliographySort","citation","Citation","bibliography","Bibliography","intext","InText","output","Queue","dateput","option","main_title_from_short_title","csl_reverse_lookup_support","cslNodeId","setCslNodeIds","nodenames","setStyleAttributes","styleID","version","consolidate_legal_items","consolidate_container_items","expect_and_symbol_form","require_explicit_legal_case_title_short","force_jurisdiction","force_title_abbrev_fallback","localeResolve","best","sort_sep","localeConfigure","adjust","getOpt","Registry","area_nodes","buildTokenLists","configureTokenLists","Disambiguation","splice_delimiter","flipflopper","Util","FlipFlopper","setCloseQuotesArray","ordinalizer","init","long_ordinalizer","page_mangler","PageRangeMangler","getFunction","year_mangler","setOutputFormat","getTerm","close_quotes_array","node_stack","runStart","runEnd","runSingle","buildStyle","fixDateNode","dummy","term","form","plural","gender","forceDefaultLocale","getField","terms","cite_renders_content","getDate","dates","arg","getVariable","varname","getDateNum","ItemField","hash","forms","f","hashterm","dateparts_master","dateparts","pppos","lllen","refetchItems","ids","refetchItem","ITERATION","retrieveItem","id","loadedItemIDs","refhash","normalize_lang_keys_to_lowercase","stringify","field","ctype","creator","_key","language","multi_layout","page","field_hack","allow_field_hack_date_override","dateobj","raw_date_parsing","raw","dateParseArray","legislation_id","elements","track_container_items","container_id","normalizedKey","isLegalType","normalizeAbbrevsKey","loadAbbreviation","abbrevs","journalAbbreviation","taintedItemIDs","setOpt","inheritedAttributes","inheritOpt","parentname","defaultValue","parentValue","remapSectionVariable","inputList","label","sectionMasterLabel","section","space","setNumberLabels","shadow_numbers","values","firstword","firstlabel","substituteOne","template","list","substituteTwo","template2","Mode","params","args","passthrough","Doppeler","rexStr","stringMangler","matchRex","splitRex","tags","origStrings","normalDecorIsOrphan","blob","all_the_decor","use_param","layout_decorations","alldecor","n","getCitationLabel","getTrigraphParams","myname","authors","nameOutput","getName","skipWords","issued","ilst","trigraph","decorate","getSortFunc","setLangTagsForCslSort","sort","setLangTagsForCslTransliteration","setLangTagsForCslTranslation","setLangPrefsForCites","conv","clientSegment","citeprocSegment","supplements","sortval","translit","translat","setLangPrefsForCiteAffixes","affixList","affixes","citeAffixes","count","settings","setAutoVietnameseNamesOption","setAbbreviations","setSuppressTrailingPunctuation","suppressTrailingPunctuation","levelname","queue","empty","tokenstore","formats","Stack","current","drip","blobs","getToken","mergeTokenStrings","base","modifier","base_token","modifier_token","addToken","newtok","pushFormats","popFormats","startTag","openLevel","endTag","closeLevel","curr","Blob","undefined","just_looking","append","tokname","notSerious","ignorePredecessor","noStripPeriods","useblob","element_trace","last_char_rendered","term_predecessor_name","in_cite_predecessor","blobPrefix","blobBlobs","strip_periods","punctuation_in_quote","processTags","string","myblobs","txt_esc","blobjr","use_suffix","use_prefix","blob_delimiter","count_offset_characters","offset_characters","new_locale","old_locale","first_blob","particle","blen","suppress_decorations","addtoret","numberSeen","UGLY_DELIMITER_SUPPRESS_HACK","successor_prefix","span_split","blobs_start","renderBlobs","blobs_end","clearlevel","in_cite","use_delim","checkNext","splice_prefix","doit","checkLast","status","strlen","formatter","format","str_blob","addme","range_prefix","suppress_splice_prefix","purgeEmptyBlobs","buf","punctInQuote","NO_SWAP_IN","NO_SWAP_OUT","LtoR_MAP","SWAP_IN","SWAP_OUT","PUNCT","PUNCT_OR_SPACE","RtoL_MAP","subkey","blobIsNumber","blobEndsInNumber","blobHasDecorations","includeQuotes","decorlist","blobHasDescendantQuotes","blobHasDescendantMergingPunctuation","parentChar","childChar","mergedChars","matchLastChar","chr","mergeChars","First","first","Second","second","merge_right","FirstStrings","SecondStrings","firstChar","secondChar","cullRight","cullLeft","addRight","addLeft","merge","swapToTheLeft","swapToTheRight","upward","parentDecorations","parentStrings","childStrings","leftward","sibling","siblingChar","hasNumber","suffixAndPrefixMatch","suffixAndFieldMatch","downward","delimChar","childDecorations","childIsNumber","allowMigration","siblingStrings","fix","lastChar","quoteSwap","decoration","has_disambiguate","suppressedJurisdictions","persons","institutions","titles","journals","publishers","places","bib_mode","sort_citations","citation_number_slug","has_layout_locale","disable_duplicate_year_suppression","jurisdiction_fallbacks","locator_label_parse","clean_up_csl_flaws","wrap_url_and_doi","apply_citation_wrapper","strict_text_case_locales","spoof_institutional_affiliations","parse_names","hanging_indent_legacy_number","throw_on_empty","strict_inputs","prioritize_disambiguate_condition","legacy_institution_name_ordering","etal_min_etal_usefirst_hack","names_base","givens_base","namepart_decorations","namepart_type","can_substitute","element_rendered_ok","nameset_counter","term_intended","variable_attempt","variable_success","output_tip","label_form","parallel_first","parallel_last","parallel_delimiter_override","done_vars","tokenstore_stack","last_suffix_used","last_names_used","last_years_used","years_used","names_used","taintedCitationIDs","initialize_with","AmbigConfig","bib_sort_keys","cite_locales","cite_affixes","authority_stop_last","condition_counter","condition_lang_val_arr","condition_lang_counter_arr","Match","suffixator","Suffixator","romanizer","Romanizer","Ordinalizer","LongOrdinalizer","in_bibliography","in_style","layout_flag","names_variables","name_label","macro","substitute_level","names_level","render_nesting_level","render_seen","bibliography_key_pos","tests","srt","Comparifier","collapse","topdecor","layout_prefix","layout_suffix","layout_delimiter","sort_locales","max_number_of_names","sort_directions","citation_number_sort_direction","citation_number_secondary","previewCitationCluster","citationsPre","citationsPost","newMode","oldMode","citationID","processCitationCluster","appendCitationCluster","citationreg","citationByIndex","c","properties","noteIndex","flag","preCitation","postCitation","nlen","noteCitations","textCitations","citationsInNote","oldCitationList","oldItemList","oldAmbigs","citation_errors","return_data","setCitationId","reflist","newCitationList","newItemIds","newItemIdsList","citationById","citationItems","oldAkey","ambig","ambigcites","disambig","sortedItems","rerunAkeys","tryLabel","newitem","lastNotePos","citationsByItemId","citations","update_items","updateItems","citation_number_sort","sortkeys","getSortKeys","grouped_sort","unsorted","authorstring_request","mydisambig","getAmbiguousCite","authorstring","authorstrings","compareCompositeKeys","lastauthor","thiskey","thisauthor","StartCitation","first_ref","last_ref","first_container_ref","onecitation","incitationid","incitationxloc","item_id","first_id","last_id","myxloc","mylocator","mylabel","l","oldlastid","oldlastxloc","oldvalue","position","oldCount","newCount","ibidme","suprame","prevCitation","prev","prev_locator","prev_label","curr_locator","thisCitation","old_last_id_offset","adjusted_offset","oldid","prevxloc","thisxloc","note_distance","process_CitationCluster","oldItemIds","rerunAkey","run","mycitation","citation_pos","citation_note_index","citation_id","firstChunk","getCitationCluster","secondChunk","infix","thirdChunk","makeCitationCluster","rawList","visualForm","oldTermSiblingLayer","non_parallel","parallel_last_override","parallel_delimiter_override_on_suppress","itemSupp","origSuppressDecorations","getCite","getSpliceDelimiter","last_locator","last_collapsed","have_collapsed","use_cite_group_delimiter","cite_group_delimiter","alt_affixes","objects","myparams","composite","compie","preceding_item","error_object","authorOnly","suppressAuthor","citation_prefix","last_primary_names_string","backref_index","abbrev_trimmer","QUASHES","use_layout_prefix","parasets","lastTitle","lastID","locatorInLastPosition","cite_index","hasPlaceholderTerm","itemID","citationItems_pos","error_code","precedingEndsInPeriodOrComma","currentStartsWithPeriodOrComma","spaceidx","citation_suffix","last_locale","wrapCitationEntry","last_chr","buffer","parallel_delimiter","preStr","sufStr","tmpobj","tmpstr","prevItemID","blockShadowNumberReset","areaOrig","probably_rendered_something","citeStart","name_node","NameOutput","citeEnd","bibliography_pos","bibliography_errors","disambiguate_count","disambiguate_maxMax","same_author_as_previous_cite","subsequent_author_substitute_ok","lastchr","disambig_override","disambig_restore","clear","has_done_year_suffix","last_cite_locale","first_name_string","cut_var","issued_date","renders_collection_number","makeBibliography","bibsection","entry_ids","entry_strings","exclude_types","exclude_with_fields","exclude","getBibliographyEntries","done","maxoffset","hangingindent","bibstart","bibend","input","include","anymatch","allmatch","bib_entry","spec","topblobs","entry_item_ids","siblings","skips","entry_item_data","page_item_count","eval_string","eval_spec","eval_list","last_rendered_name","page_start","page_length","getSortedIds","processed_item_ids","consolidatedIDs","container_item_count","consolidate_containers","container_item_pos","select","quash","system_id","embedBibliographyEntry","master","parallel_and_not_last","err","last_expected_id","last_seen_id","force","direction","Math","floor","random","toString","rebuildProcessorState","uncitedItemIDs","doneIDs","itemIDs","pre","post","updateUncitedItems","restoreProcessorState","citationList","itemList","indexNumbers","citationIds","oldCitations","idList","nosort","rerun_ambigs","implicitUpdate","oldArea","oldRoot","oldExtension","ambigsTouched","dodeletes","myhash","doinserts","mylist","dorefreshes","rebuildlist","setsortkeys","setdisambigs","sorttokens","renumber","idHash","dopurge","langstr","defaultLocale","langlst","bare","generic","beShy","localexml","retrieveLocale","localeSet","localeLists","lang_in","lang_out","termname","styleopts","ord","foundLocale","style_options","jurispref","typenode","ordinals101","ordinals101_toggle","genderized_terms","genderform","termstub","supplement","ikey","gender_segments","form_segments","jkey","feminine","masculine","jurisdiction_preference","skip_words","getLocaleNames","preferredLocale","stylexml","extendLocaleList","localeList","normalizedLocale","localeIDs","sniffLocaleOnOneNodeName","nodeLocales","styleNode","nodeNames","choose","firstkey","date_obj","dpx","mypos","date_token","cloneToken","date_parts","date_variables","substituteStart","dateMacroAsSortKey","dp","donesies","date_object","season_end","date_collapse_at","substituteEnd","first_date","value_end","real","invoked","precondition","bc","ad","ready","dcurr","date_variable","formatAndStrip","myform","Dates","last_string_output","monthnameid","myform_end","season","range_delimiter","has_year_suffix","NumericBlob","setFormatter","Conditions","TopNode","etal_node","etal_term","realGroup","label_form_override","label_capitalize_if_first_override","label_capitalize_if_first","reject","require","context","old_term_predecessor","variable_success_parent","label_static","set_parallel_delimiter_override","set_parallel_delimiter_override_on_suppress","LAST_TO_FIRST","parallel_last_to_first","publisher","publisher_lst","publisher_place_lst","publisherOutput","PublisherOutput","choose_start","if_start","any","itemItem","if_end","else_start","render","citationNumberIdx","isJurisLocatorLabel","hasRepeat","checkRepeats","info","suppress_repeats","SIBLING","ORPHAN","doneVar","else_end","choose_end","conditions","addMatch","matchCombine","addTest","locale_default","institution_delimiter","name_delimiter","and_term","and_prefix_single","and_prefix_multiple","and_suffix","single","multiple","has_institution","start_key","date_key","sort_key_flag","names_start_token","name_token","institution_token","names_end_token","single_text","citation_number_map","seq","padding","dateAsSortKey","getOutputFunction","varval","end_key","keystring","normalizeUnicode","evaluateLabel","section_form_override","capitalize_if_first","namevars","namelabels","name_flag","after","before","layout","prefix_token","suffix_token","tok","my_tok","setSuffix","topblob","using_display","locale_raw","cite_entry","locator_txt","suffix_txt","rendered_name","layout_locale_flag","choose_tok","build_layout_locale_flag","alternative","if_tok","oldItem","oldLang","abort_alternative","newItem","locale_list","gotlang","tryspec","deleteme","print","nameset_base","etal_spec","_first_creator_variable","_please_chop","requireMatch","nameset_offset","label_blob","labelVariable","checkCommonAuthor","common_term_match_fail","reinit","oldval","outputNames","variable_offset","family_decor","given_decor","getEtAlConfig","divideAndTransliterateNames","truncatePersonalNameLists","disambigNames","constrainNames","setEtAlParameters","setCommonTerm","renderAllNames","blob_list","v","institution_sets","varblob","joinPersonsAndInstitutions","freeters","joinInstitutionSets","joinFreetersAndInstitutionSets","_join","_applyLabels","common_term","namesToken","name_node_string","nameobjs","substring","Names","getRawName","author_title","_collapseAuthor","names_count","freeters_count","institutions_count","persons_count","_buildLabel","castLabel","myqueue","mystr","oldchars","isPerson","isInstitution","chopvar","_truncateNameList","etal_min","etal_use_first","container","limit","varnames","_normalizeVariableValue","_getFreeters","_getPersonsAndInstitutions","_checkNickname","has_affiliates","_clearValues","author","myLocalName","_purgeEmptyBlobs","joinPersons","tokenname","_joinEtAl","_joinEllipsis","_joinAnd","_getAfterInvertedName","finalJoin","prevBlob","isInverted","_getAndJoin","singleOrMultiple","_getToken","ellipsis","has_term","firstSet","secondSet","perfectMatch","_compareNamesets","vv","base_nameset","nameset","_imposeNameConstraints","display_names","discretionary_names_length","etal_use_last","sane","overlength","padBase","_runDisambigNames","myinitials","paramx","namereg","addname","evalname","use_initials","etal_style","etal_suffix","etal_prefix_single","etal_prefix_multiple","_setEtAlParameter","_renderNames","renderInstitutionNames","localesets","slot","primary","secondary","tertiary","slotnames","setRenderedName","_renderInstitutionName","long_style","short_style","institution_short","usedOrig","fixupInstitution","pri","sec","ter","s","_getShortStyle","_composeOneInstitutionPart","_getLongStyle","_renderOneInstitutionPart","primary_tok","secondary_tok","tertiary_tok","institutionblob","hasItalic","secondary_outer","tertiary_outer","nameBlob","_renderPersonalName","nameToken","_renderOnePersonalName","personblob","_isRomanesque","top_locale","dropping_particle","_droppingParticle","_familyName","non_dropping_particle","_nonDroppingParticle","givenInfo","_givenName","_nameSuffix","suffix_sep","romanesque","nbspace","merged","has_hyphenated_non_dropping_particle","hasJoiningPunctuation","initializationLevel","_normalizeNameInput","block_initialize","_parseName","_stripPeriods","decor_tok","ndp","defaultLevel","useLevel","formIsShort","initializeIsTurnedOn","hasInitializeWith","requestedLevel","gdropt","initializeWith","unInitialize","toSuffix","noparse","slotLocaleset","stopOrig","name_params","getStaticOrder","langTag","foundTag","langTags","getNameParams","transliterated","try_locale","name_as_sort_order","name_as_reverse_order","name_never_short","field_lang_bare","strname","listpos","longNameStr","shortNameStr","_quashChecks","abbrevKey","retShort","splitShort","_trimInstitution","trimmer","frag","refresh","static_ordering_val","quashCheck","isNaN","subunits","use_first","stop_last","use_last","stop_first","ss","group_tok","varlist","clearVars","composeAndBlob","composeElements","composePublishers","joinPublishers","and_blob","no_delim","with_delim","myterm","theItem","processNumber","labelForm","labelDecorations","labelCapitalizeIfFirst","oldTmpRoot","ellipsis_term","ellipsis_prefix_single","ellipsis_prefix_multiple","ellipsis_suffix","name_labels","variables_real","names_flag","mywith","with_default_prefix","with_suffix","thewith","can_block_substitute","outputNumericField","langForItem","lang_sort_hold","substitute","if_singleton","firstoutput","specialdelimiter","group_start","group_end","abbrevfam","abbrfall","altvar","transfall","clonetoken","groupblob","prefixblob","valueblob","intext_sort","maketest","myitem","myvariable","trylabels","trylabel","trypositions","testSubsequentNear","testSubsequentNotNear","tryposition","mytype","isValid","rawNames","rawMultiNames","creatorParent","creatorChild","gotosleepability","labelVisibility","tryjurisdictions","maketests","trycountries","trydates","trydate","nameList","last_is_person","locale_data","locales","sort_locale","localeMaster","localeServant","locale_bares","tryclasses","tryclass","retval","namevar","subunit_count","citeForm","vars","track_repeat","capitalize_if_first_override","parseFloat","text_case_normal","out","idxEnd","parallelMatchList","siblingRanges","currItem","nextItem","freshMatchList","seeAlso","tempMatchList","remainder","ididx","currVal","nextVal","currYear","nextYear","masterID","siblingID","none","all","nand","getCountryOrJurisdiction","quashCountry","getHumanForm","abbreviate","basevalue","family_var","use_field","preferredJurisdiction","myabbrev_family","abbrev","getFieldLocale","localeRex","getTextSubField","locale_type","use_default","usingOrig","stickyLongForm","breakMe","firstValue","fieldsToTry","h","hlen","variantMatch","hasVal","found_variant_ok","publisherCheck","fields","category","abbreviation_fallback","alternative_varname","langPrefs","primary_locale","secondary_locale","tertiary_locale","oldLangArray","primaryPrefix","primaryUsedOrig","citeFormCheck","conditional","maxvals","minval","mother_token","textCase","DefaultFormatter","last","subnode","subchildren","display","lingo","isMacro","yr","macroFlag","exts","compareNamesets","punctlist","terminator","normalizeOnly","nameSplits","nameDoppel","mmm","doNormalize","doInitialize","notag","mergetag","tagstr","newstr","tagonly","isAbbrev","extra","imperial","substr","normalizeMonth","useSeason","ordinal","Sort","strip_prepositions","bib_first","nodetypes","variable_entry","noteNumber","firstReferenceNoteNumber","firstContainerReferenceNoteNumber","citationNumber","itemData","variableNames","bib_first_end","bib_other","substitution_name","subrule","dosub","substituted_variable","suffixes","trygenders","trygender","ordinfo","numstr","slist","N","X","ItemObject","realVariable","fullformAnd","symbolAnd","andRex","joinerMatchRex","joinerSplitRex","localeAnd","localeAmpersand","composeNumberInfo","origLabel","joiningSuffix","parsePosition","labelSuffix","fixNumericAndCount","currentLabelInfo","isEscapedHyphen","collapsible","mVal","mCurrentLabel","isCollapsible","fixLabelVisibility","groupStartPos","stripHyphenBackslash","setStyling","masterNode","masterStyling","masterLabel","newnode","styling","checkPage","fixupRangeDelimiter","rangeDelimiter","isNumeric","isPage","hasTerm","checkTerm","manglePageNumbers","currentInfo","fixRanges","lastHadRangeDelimiter","languageRole","localeType","normval","defaultLabel","jmrex","jsrex","embeddedLabel","normalizeFieldValue","source","fixupSubsections","slug","filteredOrigLabel","parseString","setSpaces","groupCount","lastVal","thisVal","setPluralsAndNumerics","setVariableParams","embeddedLabelForm","nums","tryStatic","lastLabelName","labelName","labelPlaceholderPos","numStyling","prefixLabelStyling","suffixLabelStyling","rangeType","rangerex","listify","expand","minimize","minimize_internal","chicago","begin","ret_func","hyphens","delimRex","rexm","rexlst","minchars","isyear","front","sniff","_nestingState","_nestingData","opener","closer","flipflop","localeOpenQuote","localeCloseQuote","localeOpenInnerQuote","localeCloseInnerQuote","_getNestingOpenerParams","openers","map","_nestingParams","_tagRex","closers","matchAll","splitAll","close","_pushNestingState","tag","fixtag","_tryOpen","nocase","_tryClose","TagReg","set","decor","_decor","allTheDecor","decorset","_apostropheForce","leadingSpace","doppel","forcedSpaces","_doppelString","quot","quoteFormSeen","apostrophe","tagInfo","failedTag","tagPos","forcedSpace","firstString","tagReg","stack","latest","addStyling","newblob","newdecorset","seen","_decorset","_olddecor","popStyling","_undoppelToQueue","tagDoppel","wordDoppel","_tagParams","_capitalise","word","_textcaseEngine","quoteParams","pushQuoteState","quoteState","prevPos","positions","tryOpen","tryClose","quoteFix","capitaliseWords","tagState","afterPunct","lastWordPos","quotePos","origChar","isFirst","lastWords","lastWord","words","skipWordsRex","lowercase","uppercase","followingTag","wordle","lcase","capitalize","html","aChar","prePunct","postPunct","doiurl","rtf","charCodeAt","asciidoc","fo","indent","hi","latex","NameReg","CitationReg","masterMap","deletes","inserts","uncited","refreshes","akeys","oldseq","ambigresets","sorter","getSortedRegistryItems","uncited_flag","touched","items","kkey","delitems","loneSiblingID","removeIDs","newmasterID","bibchange","akey","abase","registerAmbigToken","reflist_inserts","regtoken","akkey","loneKey","_insertItem","array","splice","_locationOf","pivot","compareKeys","keyset","sortCompare","cmp","compareRegistryTokens","ambig_config","key_type","pkey","skey","dagopt","set_keys","myitems","nameind","nameindpkeys","itemkeyreg","itemid","nameobj","namenum","request_base","initials","gdropt_orig","posB","fullkey","configModes","modes","initVars","runDisambig","ismax","initGivens","lists","gnameset","gname","clashes","incrementDisambig","scanItems","evalScan","otherItem","ItemCite","scanlist","partners","nonpartners","otherItemCite","maxed","modeindex","disNames","captureStepToBase","betterbase","disExtraText","disYears","origid","oldBase","increment_names","givensMax","increment_namesets","namesMax","namesetsMax","myIds","myItemBundles","myItems","maxNamesByItemId","myItem","getCiteData","jurisdictionElems","composedID","xmlSource","skipFallback","myFallback","myXml","myNodes","myTypes","myName","preferences","preference","ParticleList","splitParticles","nameValue","firstNameFlag","caseOverride","origNameValue","hasParticle","particleList","m1","nameObj","lastNameValue","lastParticleList","nonDroppingParticle","possible_suffix","possible_comma","parseSuffix","firstNameValue","firstParticleList","droppingParticle","module","exports"],"sourceRoot":""}